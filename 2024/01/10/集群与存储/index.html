



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="运维" />


<link rel="canonical" href="http://example.com/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/">



  <title>
集群与存储 - 运维 |
Yume Shoka = Hexo</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">集群与存储
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-01-10 13:38:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-01-10T13:38:45+08:00">2024-01-10</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/536315e4defca264dab1b39dc99bb2dc.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6481fffb5173a5621c7af0848ed50fa7.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/df90fbe0bf0d8c96355b06f9318f97e6.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/ccb0052481047ba79b4121da73ca7e5e.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/471188138f7f9597f65d16889f1ade0e.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/e9387f53393624bd88390036d7943fad.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="item" rel="index" title="In 运维"><span itemprop="name">运维</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="集群与存储"><a class="markdownIt-Anchor" href="#集群与存储">#</a> 集群与存储</h1>
<p>集群</p>
<p>提高性能</p>
<p>降低成本</p>
<p>提高可扩展性</p>
<p>增加可靠性</p>
<p>集群分类</p>
<p>高性能计算集群</p>
<p>负载均衡集群 (LB)   平均分配请求</p>
<p>高可用集群 (HA)   避免单点故障，在整个集群里不能有单点故障</p>
<h2 id="lvs"><a class="markdownIt-Anchor" href="#lvs">#</a> LVS</h2>
<h3 id="lvs集群组成"><a class="markdownIt-Anchor" href="#lvs集群组成">#</a> lvs 集群组成</h3>
<p>前端：负载均衡层</p>
<p>​	- 由一台或多台负载调度器构成</p>
<p>中间：服务器群组层</p>
<p>​	- 由一组实际运行应用服务的服务器组成</p>
<p>底端：数据共享存储层</p>
<p>​	- 提供共享存储空间的存储区域</p>
<h3 id="lvs名词解释"><a class="markdownIt-Anchor" href="#lvs名词解释">#</a> lvs 名词解释</h3>
<p>Director Server : 调度服务器   —  将负载分发到 Real Server 的服务器   （nginx  lvs）</p>
<p>Real Server: 真实服务器  - 真正捷供应用服务的服务器</p>
<p>VIP: 虚拟 IP 地址  - 公布给用户访问的虚拟 IP 地址</p>
<p>RIP: 真实 IP 地址  - 集群节点上使用的 IP 地址</p>
<p>DIP: 调度器连接节点服务器的 IP 地址     （nginx 的真实 IP）</p>
<p>CIP：client ip</p>
<h3 id="lvs-工作模式"><a class="markdownIt-Anchor" href="#lvs-工作模式">#</a> lvs 工作模式</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240106195157706.png" alt="image-20240106195157706" style="zoom:50%;" /> 
<p>lvs 原理是路由，数据包转发，可以理解为路由器，后端服务器看到的 ip 是 client 的。lvs 具有 nat 功能。路由器没有负载均衡调度功能</p>
<p>nginx 的原理是代理，nginx 访问的后端服务器，后端服务器看到的 ip 是 ngx 的</p>
<p>两者实现的效果基本一致，但是实现原理完全不一致</p>
<p>lsv 效率更高，lvs 在内核中，但是只能做转发，功能比 ngx 少，没有健康检查</p>
<p>nat 模式会导致 lvs 的带宽成为网络瓶颈，适合于中小型集群</p>
<p>DR - 直连路由，回包不走调度器，直接回给用户</p>
<p>tun 模式：调度器和集群不在一个网络中。用户访问调度器，集群返回给用户数据。需要在调度器和集群间做隧道</p>
<h3 id="lvs调度算法"><a class="markdownIt-Anchor" href="#lvs调度算法">#</a> LVS 调度算法</h3>
<p>轮询：Lvs 里轮询不能加权重，加了也不生效</p>
<p>加权轮询</p>
<p>最少连接</p>
<p>加权最少连接</p>
<p>源地址 hash</p>
<p>目标地址 hash</p>
<p>基于局部性的最少链接</p>
<p>带复制的基于局部性最少链接</p>
<p>目标地址散列 (Destination Hashing)</p>
<p>最短的期望的延迟</p>
<p>最少队列调度</p>
<h3 id="ipvsadm"><a class="markdownIt-Anchor" href="#ipvsadm">#</a> ipvsadm</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">ipvsadm 是一个lvs命令行工具，调度最终还是ipvs实现的</span><br><span class="line"></span><br><span class="line">yum install -y ipvsadm</span><br><span class="line"></span><br><span class="line">[root@iZuf60im9c63xjnpkubjq7Z ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  139.196.42.189:80 rr</span><br><span class="line">TCP  139.196.42.189:15021 rr</span><br><span class="line">TCP  192.168.0.1:443 rr</span><br><span class="line">  -&gt; 10.0.0.236:6443              Masq    1      3          1         </span><br><span class="line">  -&gt; 10.0.0.239:6443              Masq    1      4          1     </span><br><span class="line">  </span><br><span class="line">ipvs  </span><br><span class="line">-A 创建虚拟服务器(类似于upstream)</span><br><span class="line">-D 删除虚拟服务器</span><br><span class="line">-E 修改虚拟服务器</span><br><span class="line">-C 清空所有</span><br><span class="line">-a 添加真实服务器</span><br><span class="line">-e 修改真实服务器</span><br><span class="line">-d 删除真实服务器</span><br><span class="line">-L 查看规则</span><br><span class="line">-s [rr/wrr/lc/wlc/sh] 制定集群算法</span><br><span class="line">-t tcp</span><br><span class="line">-u udp</span><br><span class="line"></span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -A -t 172.1.1.1:38888 -s wrr</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -a -t 172.1.1.1:38888 -r 172.1.2.1 -w 3</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -a -t 172.1.1.1:38888 -r 172.1.2.2  -w 4</span><br><span class="line"></span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  172.1.1.1:38888 wrr</span><br><span class="line">  -&gt; 172.1.2.1:38888              Route   3      0          0         </span><br><span class="line">  -&gt; 172.1.2.2:38888              Route   4      0          0        </span><br><span class="line">  </span><br><span class="line">如果不指定工作模式，默认是dr模式</span><br><span class="line"></span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -a -t 172.1.1.1:38888 -r 172.1.2.3  -w 4 -m </span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  172.1.1.1:38888 wrr</span><br><span class="line">  -&gt; 172.1.2.1:38888              Route   3      0          0         </span><br><span class="line">  -&gt; 172.1.2.2:38888              Route   4      0          0         </span><br><span class="line">  -&gt; 172.1.2.3:38888              Masq    4      0          0      </span><br><span class="line"></span><br><span class="line">-g 默认，直连路由模式</span><br><span class="line">-m 地址欺骗  指定此时为nat模式</span><br><span class="line">-i tun模式</span><br><span class="line"></span><br><span class="line">// 修改算法为LC</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -E  -t 172.1.1.1:38888 -s lc </span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  172.1.1.1:38888 lc</span><br><span class="line">  -&gt; 172.1.2.1:38888              Route   3      0          0         </span><br><span class="line">  -&gt; 172.1.2.2:38888              Route   4      0          0         </span><br><span class="line">  -&gt; 172.1.2.3:38888              Masq    4      0          0         </span><br><span class="line">  -&gt; 172.1.2.4:38888              Tunnel  4      0          0   </span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -e -t 172.1.1.1:38888 -r 172.1.2.1 -m -w 2</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  172.1.1.1:38888 lc</span><br><span class="line">  -&gt; 172.1.2.1:38888              Masq    2      0          0         </span><br><span class="line">  -&gt; 172.1.2.2:38888              Route   4      0          0         </span><br><span class="line">  -&gt; 172.1.2.3:38888              Masq    4      0          0         </span><br><span class="line">  -&gt; 172.1.2.4:38888              Tunnel  4      0          0   </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -d -t 172.1.1.1:38888 -r 172.1.2.2</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  172.1.1.1:38888 lc</span><br><span class="line">  -&gt; 172.1.2.1:38888              Masq    2      0          0         </span><br><span class="line">  -&gt; 172.1.2.3:38888              Masq    4      0          0         </span><br><span class="line">  -&gt; 172.1.2.4:38888              Tunnel  4      0          0         </span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -D -t  172.1.1.1:38888 </span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">  </span><br><span class="line">// 永久保存</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm-save -n &gt; /etc/sysconfig/ipvsadm</span><br><span class="line"></span><br><span class="line">// 清除所有</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -C</span><br></pre></td></tr></table></figure>
<h3 id="实验-nat模式"><a class="markdownIt-Anchor" href="#实验-nat模式">#</a> 实验 nat 模式</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240107162401789.png" alt="image-20240107162401789" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">net.ipv4.ip_forward = 1 开启路由转发功能</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# echo 1 &gt; /proc/sys/net/ipv4/ip_forward     // 临时生效</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# cat /proc/sys/net/ipv4/ip_forward			// 查看</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf	// 永久生效，千万别vim这个文件 </span><br><span class="line"></span><br><span class="line">1.开启web服务器 apache/ngx</span><br><span class="line"></span><br><span class="line">2.systemctl stop firewalld </span><br><span class="line">setenforce 0</span><br><span class="line"></span><br><span class="line">3.ipvsadm -A -t 192.168.4.5:80 -s wrr</span><br><span class="line">ipvsadm -a -t 192.168.4.5:80 -r 192.168.2.100:80 -w 1 -m</span><br></pre></td></tr></table></figure>
<h3 id="实验-lvs-dr"><a class="markdownIt-Anchor" href="#实验-lvs-dr">#</a> 实验 lvs-dr</h3>
<p>使用 LVS 实现 DR 模式的集群调度服务器﹐为用户提供 Web 服务∶</p>
<p>客户端 IP 地址为 192.168.4.10</p>
<p>LVS 调度器 VIP 地址为 192.168.4.15</p>
<p>LVs 调度器 DIP 地址设置为 192.168.4.5</p>
<p>真实 web 服务器地址分别为 192.168.4.100、192.168.4.200</p>
<p>使用加权轮询调度算法，web1 的权重为 1 ， web2 的权重为 2</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240107162617649.png" alt="image-20240107162617649" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">最简单情况下，pc和web服务器要在同一个网段，如果pc在公网，web服务器也要有公网IP</span><br><span class="line">可以加入路由器，实现web服务器返回数据给client</span><br><span class="line">web服务器需要给自己增加一个ip，把自己伪装成VIP，避免pc直接丢弃web服务器的回包</span><br><span class="line">但是会导致地址冲突，需要修改内核参数，并且把vip配在辅助IP上</span><br><span class="line">调度器上vip必须隐藏，一个网卡上第一个IP是主ip，后面的是辅助ip</span><br><span class="line">别人ping我们的所有IP都能通，但是我们访问别人的时候用的是主IP作为sip</span><br><span class="line"></span><br><span class="line">PC-&gt;eth0:0  ,eth0-&gt;web server 此时DIP是eth0，DIP永远是主接口的IP</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240107164721501.png" alt="image-20240107164721501"></p>
<p>比如 Windows 上可以增加多个 IP</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">调度器上</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# cp   /etc/sysconfig/network-scripts/ifcfg-eth0&#123;,:0&#125;</span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ll /etc/sysconfig/network-scripts/ifcfg-eth0</span><br><span class="line">ifcfg-eth0  // 主接口    ifcfg-eth0:0 //虚拟接口 </span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-eth0:0</span><br><span class="line">BOOTPROTO=none</span><br><span class="line">DEVICE=eth0:0</span><br><span class="line">ONBOOT=yes</span><br><span class="line">NAME=eth0:0</span><br><span class="line">STARTMODE=auto</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">USERCTL=no</span><br><span class="line"></span><br><span class="line">systemctl restart  network</span><br><span class="line"></span><br><span class="line">centos7里面network NetworkManager 都可以管理网卡</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240107172524756.png" alt="image-20240107172524756"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240107180845742.png" alt="image-20240107180845742"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">web server上 伪装 回client地址</span><br><span class="line">在lo上增加vip</span><br><span class="line">cp /etc/sysconfig/network-scripts/ifcfg-lo&#123;,:0&#125;</span><br><span class="line">IPADDR=192.168.4.15</span><br><span class="line">NETMASK=255.255.255.255   // 必须是全255</span><br><span class="line">NETWORK=192.168.4.15</span><br><span class="line">NAME=lo:0</span><br><span class="line"></span><br><span class="line">webserver 上设置不回应4.15的请求，忽略arp广播</span><br><span class="line">vim /etc/sysctl.conf</span><br><span class="line">net.ipv4.conf.all.arp_ignore = 1    忽略arp广播</span><br><span class="line">net.ipv4.conf.lo.arp_ignore = 1</span><br><span class="line">net.ipv4.conf.lo.arp_announce = 2	不向外宣告自己的lo地址    </span><br><span class="line">net.ipv4.conf.all.arp_announce = 2</span><br><span class="line"></span><br><span class="line">sysctl -p </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">调度器</span><br><span class="line">ipvsadm -A -t 192.168.4.15:80 -s wrr</span><br><span class="line">ipvsadm -a -t 192.168.4.15:80 -r 192.168.4.100 -g -w 2</span><br><span class="line">ipvsadm -a -t 192.168.4.15:80 -r 192.168.4.200 -g -w 2</span><br><span class="line"></span><br><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  192.168.4.15:80 wrr</span><br><span class="line">  -&gt; 192.168.4.100:80             Route   2      0          0         </span><br><span class="line">  -&gt; 192.168.4.200:80             Route   2      0          0     </span><br></pre></td></tr></table></figure>
<h2 id="keepalived"><a class="markdownIt-Anchor" href="#keepalived">#</a> keepalived</h2>
<p>1. 自动配置 lvs 规则</p>
<p>2. 健康检查</p>
<p>3.VRRP</p>
<h3 id="实验"><a class="markdownIt-Anchor" href="#实验">#</a> 实验</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240109211709823.png" alt="image-20240109211709823" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">// web1 &amp;&amp; web2</span><br><span class="line">yum install keepalived</span><br><span class="line"></span><br><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">! 全局配置</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.200.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL        // 修改router-id，两端router-id不一样</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line">! VRRP configure</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER     			// master / backup</span><br><span class="line">    interface eth0				// VIP 网卡</span><br><span class="line">    virtual_router_id 51		// 两边 VRID 一样</span><br><span class="line">    priority 100				// 越大越优</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;			//两边密码一样</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.200.16</span><br><span class="line">        192.168.200.17</span><br><span class="line">        192.168.200.18</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">systemctl restart keepalived</span><br><span class="line"></span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# iptables -nxvL</span><br><span class="line">Chain INPUT (policy ACCEPT 59 packets, 2888 bytes)</span><br><span class="line">    pkts      bytes target     prot opt in     out     source               destination         </span><br><span class="line">       0        0 DROP       all  --  *      *       0.0.0.0/0            0.0.0.0/0            match-set keepalived dst</span><br><span class="line">清除这条规则</span><br><span class="line"></span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# ip a s eth0</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:26:8f:50 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.250/24 brd 10.0.0.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315253049sec preferred_lft 315253049sec</span><br><span class="line">    inet 192.168.200.16/32 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.200.17/32 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet 192.168.200.18/32 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::216:3eff:fe26:8f50/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">       </span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# systemctl stop keepalived.service </span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# ip -c a </span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:26:8f:50 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.0.250/24 brd 10.0.0.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 315253013sec preferred_lft 315253013sec</span><br><span class="line">    inet6 fe80::216:3eff:fe26:8f50/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<h3 id="实验-2"><a class="markdownIt-Anchor" href="#实验-2">#</a> 实验</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240109214250312.png" alt="image-20240109214250312" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">! Configuration File for keepalived</span><br><span class="line"></span><br><span class="line">! 全局配置</span><br><span class="line">global_defs &#123;</span><br><span class="line">   notification_email &#123;</span><br><span class="line">     acassen@firewall.loc</span><br><span class="line">     failover@firewall.loc</span><br><span class="line">     sysadmin@firewall.loc</span><br><span class="line">   &#125;</span><br><span class="line">   notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">   smtp_server 192.168.200.1</span><br><span class="line">   smtp_connect_timeout 30</span><br><span class="line">   router_id LVS_DEVEL        // 修改router-id，两端router-id不一样</span><br><span class="line">   vrrp_skip_check_adv_addr</span><br><span class="line">   vrrp_strict</span><br><span class="line">   vrrp_garp_interval 0</span><br><span class="line">   vrrp_gna_interval 0</span><br><span class="line">&#125;</span><br><span class="line">! VRRP configure</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state MASTER     			// master / backup</span><br><span class="line">    interface eth0				// VIP 网卡</span><br><span class="line">    virtual_router_id 51		// 两边 VRID 一样</span><br><span class="line">    priority 100				// 越大越优</span><br><span class="line">    advert_int 1</span><br><span class="line">    authentication &#123;			//两边密码一样</span><br><span class="line">        auth_type PASS</span><br><span class="line">        auth_pass 1111</span><br><span class="line">    &#125;</span><br><span class="line">    virtual_ipaddress &#123;</span><br><span class="line">        192.168.200.16</span><br><span class="line">        192.168.200.17</span><br><span class="line">        192.168.200.18</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">virtual_server 192.168.200.100 443 &#123;</span><br><span class="line">    delay_loop 6</span><br><span class="line">    lb_algo rr					// 调度算法</span><br><span class="line">    lb_kind NAT					// lvs模式</span><br><span class="line">    !persistence_timeout 50		 // 保持连接</span><br><span class="line">    protocol TCP				// -t == tcp</span><br><span class="line"></span><br><span class="line">    real_server 192.168.201.101 443 &#123;</span><br><span class="line">        weight 1					// weight</span><br><span class="line">        SSL_GET &#123;					// health check   tcp_check http_get ssl_get </span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              digest ff20ad2481f97b1754ef3e12ecd3a9cc</span><br><span class="line">            &#125;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /mrtg/</span><br><span class="line">              digest 9b3a0c85a887a256d6939da88aabd8cd</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3		// 每隔3s一次</span><br><span class="line">            nb_get_retry 3			// 重试 3 次</span><br><span class="line">            delay_before_retry 3	 // 隔3s再试</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    real_server 192.168.201.100 443 &#123;</span><br><span class="line">        weight 1</span><br><span class="line">        SSL_GET &#123;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /</span><br><span class="line">              digest ff20ad2481f97b1754ef3e12ecd3a9cc</span><br><span class="line">            &#125;</span><br><span class="line">            url &#123;</span><br><span class="line">              path /mrtg/</span><br><span class="line">              digest 9b3a0c85a887a256d6939da88aabd8cd</span><br><span class="line">            &#125;</span><br><span class="line">            connect_timeout 3</span><br><span class="line">            nb_get_retry 3</span><br><span class="line">            delay_before_retry 3</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>健康检查方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">tcp_check http_get ssl_get 			// 全部是大写</span><br><span class="line"></span><br><span class="line">real server 192.168.1.1 80 &#123;</span><br><span class="line"> 	TCP_CHECK &#123;</span><br><span class="line">        connect_timeout 3</span><br><span class="line">        nb_get_retry 3</span><br><span class="line">        delay_before_retry 3</span><br><span class="line"> 	&#125;   			// 只检查tcp端口</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">real server 192.168.1.1 80 &#123;</span><br><span class="line"> 	http_get &#123; 				// 检查url和对应返回内容的md5</span><br><span class="line"> 		url &#123;</span><br><span class="line"> 			path /index.html</span><br><span class="line"> 			digest md5xxx</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;   			</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">real server 192.168.1.1 443 &#123;</span><br><span class="line"> 	ssl_get &#123; 				// 检查url和对应返回内容的md5,但是https</span><br><span class="line"> 		url &#123;</span><br><span class="line"> 			path /index.html</span><br><span class="line"> 			digest md5xxx</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;   			</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="haproxy"><a class="markdownIt-Anchor" href="#haproxy">#</a> haproxy</h2>
<h3 id="ngx-lvs-haproxy-对比"><a class="markdownIt-Anchor" href="#ngx-lvs-haproxy-对比">#</a> ngx - lvs - haproxy 对比</h3>
<p>ngx</p>
<p>优点</p>
<p>工作在 7 层，可以针对 http 做分流策略</p>
<p>1.9 版本开始支持 4 层代理</p>
<p>正则表达式比 HAProxy 强大</p>
<p>安装、配置、测试简单，通过日志可以解决多数问题</p>
<p>并发量可以达到几万次</p>
<p>Nginx 还可以作为 Web 服务器使用</p>
<p>缺点</p>
<p>仅支持 http、https、mail 协议，应用面小</p>
<p>监控检查仅通过端口，无法使用 url 检查</p>
<p>lvs</p>
<p>优点</p>
<p>负载能力强工作在 4 层，对内存、CPU 消耗低</p>
<p>配置性低，没有太多可配置性，减少人为错误</p>
<p>应用面广，几乎可以为所有应用提供负载均衡</p>
<p>缺点</p>
<p>不支持正则表达式，不能实现动静分离</p>
<p>如果网站架构庞大，LVS-DR 配置比较繁琐</p>
<p>haproxy</p>
<p>优点</p>
<p>支持 session、cookie 功能</p>
<p>可以通过 url 进行健康检查</p>
<p>效率、负载均衡速度，高于 Nginx，低于 LVS</p>
<p>HAProxy 支持 TCP，可以对 MySQL 进行负载均衡</p>
<p>调度算法丰富</p>
<p>缺点</p>
<p>正则弱于 Nginx</p>
<p>日志依赖于 syslogd</p>
<h3 id="实验-3"><a class="markdownIt-Anchor" href="#实验-3">#</a> 实验</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240110122630687.png" alt="image-20240110122630687" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2ze79b6r8gdeaxivwkxoZ ~]# yum install  haproxy -y </span><br><span class="line"></span><br><span class="line">vim /etc/haproxy/haprox.cfg</span><br><span class="line">global											# 全局设置</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line">    chroot      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line">    maxconn     4000</span><br><span class="line"></span><br><span class="line">defaults										# 默认设置</span><br><span class="line">    mode                    http					# tcp http health 四层 七层  只做健康检查，默认http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    5s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         5s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 5s</span><br><span class="line">    timeout check           5s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line">frontend main</span><br><span class="line">    bind *:80</span><br><span class="line">    default_backend         http_back</span><br><span class="line"></span><br><span class="line">backend http_back</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server  node1 127.0.0.1:5001 check</span><br><span class="line">    server  node2 127.0.0.1:5002 check</span><br><span class="line">    server  node3 127.0.0.1:5003 check</span><br><span class="line">    server  node4 127.0.0.1:5004 check</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">[root@iZ2zeemxfrv2vvgeutzfnpZ ~]# cat  /etc/haproxy/haproxy.cfg </span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Example configuration for a possible web application.  See the</span><br><span class="line"># full configuration options online.</span><br><span class="line">#</span><br><span class="line">#   http://haproxy.1wt.eu/download/1.4/doc/configuration.txt</span><br><span class="line">#</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># Global settings</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">global</span><br><span class="line">    # to have these messages end up in /var/log/haproxy.log you will</span><br><span class="line">    # need to:</span><br><span class="line">    #</span><br><span class="line">    # 1) configure syslog to accept network log events.  This is done</span><br><span class="line">    #    by adding the &#x27;-r&#x27; option to the SYSLOGD_OPTIONS in</span><br><span class="line">    #    /etc/sysconfig/syslog</span><br><span class="line">    #</span><br><span class="line">    # 2) configure local2 events to go to the /var/log/haproxy.log</span><br><span class="line">    #   file. A line like the following can be added to</span><br><span class="line">    #   /etc/sysconfig/syslog</span><br><span class="line">    #</span><br><span class="line">    #    local2.*                       /var/log/haproxy.log</span><br><span class="line">    #</span><br><span class="line">    log         127.0.0.1 local2</span><br><span class="line"></span><br><span class="line">    chroot      /var/lib/haproxy</span><br><span class="line">    pidfile     /var/run/haproxy.pid</span><br><span class="line">    maxconn     4000</span><br><span class="line">    user        haproxy</span><br><span class="line">    group       haproxy</span><br><span class="line">    daemon</span><br><span class="line"></span><br><span class="line">    # turn on stats unix socket</span><br><span class="line">    stats socket /var/lib/haproxy/stats</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># common defaults that all the &#x27;listen&#x27; and &#x27;backend&#x27; sections will</span><br><span class="line"># use if not designated in their block</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">defaults</span><br><span class="line">    mode                    http</span><br><span class="line">    log                     global</span><br><span class="line">    option                  httplog</span><br><span class="line">    option                  dontlognull</span><br><span class="line">    option http-server-close</span><br><span class="line">    option forwardfor       except 127.0.0.0/8</span><br><span class="line">    option                  redispatch</span><br><span class="line">    retries                 3</span><br><span class="line">    timeout http-request    10s</span><br><span class="line">    timeout queue           1m</span><br><span class="line">    timeout connect         10s</span><br><span class="line">    timeout client          1m</span><br><span class="line">    timeout server          1m</span><br><span class="line">    timeout http-keep-alive 10s</span><br><span class="line">    timeout check           10s</span><br><span class="line">    maxconn                 3000</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># main frontend which proxys to the backends</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">frontend  main *:5000</span><br><span class="line">    acl url_static       path_beg       -i /static /images /javascript /stylesheets</span><br><span class="line">    acl url_static       path_end       -i .jpg .gif .png .css .js</span><br><span class="line"></span><br><span class="line">    use_backend static          if url_static</span><br><span class="line">    default_backend             app</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># static backend for serving up images, stylesheets and such</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend static</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      static 127.0.0.1:4331 check</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># round robin balancing between the various backends</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend app</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server  app1 127.0.0.1:5001 check</span><br><span class="line">    server  app2 127.0.0.1:5002 check</span><br><span class="line">    server  app3 127.0.0.1:5003 check</span><br><span class="line">    server  app4 127.0.0.1:5004 check </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">集群格式1：</span><br><span class="line">frontend  main *:5000</span><br><span class="line">    acl url_static       path_beg       -i /static /images /javascript /stylesheets</span><br><span class="line">    acl url_static       path_end       -i .jpg .gif .png .css .js</span><br><span class="line"></span><br><span class="line">    use_backend static          if url_static</span><br><span class="line">    default_backend             app</span><br><span class="line"></span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line"># static backend for serving up images, stylesheets and such</span><br><span class="line">#---------------------------------------------------------------------</span><br><span class="line">backend static</span><br><span class="line">    balance     roundrobin</span><br><span class="line">    server      static 127.0.0.1:4331 check</span><br><span class="line"></span><br><span class="line">集群格式2：</span><br><span class="line">listen servers *:80</span><br><span class="line">	balance roundrobin</span><br><span class="line">	server web1 1.1.1.1 check inter 2000 rise 2 fall 5    5次失败认为server挂了，连续两次成功认为他又好了</span><br><span class="line">	server web2 1.1.1.2 check inter 2000 rise 2 fall 5</span><br></pre></td></tr></table></figure>
<p>haproxy 状态检查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">listen stats 0.0.0.0:1080</span><br><span class="line">	stats refresh 30s</span><br><span class="line">	stats uri /stats</span><br><span class="line">	stats  realm Haproxy Manager</span><br><span class="line">	stats auth admin:admin</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240114190408600.png" alt="image-20240114190408600"></p>
<p>Queue 队列数据的信息（当刖队列数量，最大值，队列限制数量);</p>
<p>Session rate 每秒会话率（当前值﹐最大值﹐限制数量);</p>
<p>Sessions 总会话量（当前值﹐最大值﹐总量，Lbtot: total numberof times a server was selected 选中一台服务器所用的总时间);</p>
<p>Bytes (入站、出站流量);</p>
<p>Denied (拒绝请求、拒绝回应);</p>
<p>Errors (错误请求、错误连接、错误回应);</p>
<p>Warnings (重新尝试警告 retry、重新连接 redispatches) ;</p>
<p>Server (状态、最后检查的时间（多久前执行的最后一次检查)、权重、备份服务器数量、down 机服务器数量、down 机时长)。</p>
<h2 id="存储"><a class="markdownIt-Anchor" href="#存储">#</a> 存储</h2>
<p>存储类型</p>
<p>​	DAS 直连存储，ide，sata，sas</p>
<p>​	NAS (网络附加存储) samba nfs ftp   共享文件系统</p>
<p>​	SAN (存储区域网络) iscsi    块</p>
<p>​	(SDS - 软件定义存储) 分布式存储       ceph glusterfs hadoop</p>
<p>格式化前叫做块 ，格式化后叫做文件系统 (xfs,ext4,ext3,fat32,ntfs)。块不能直接用</p>
<p>分布式文件系统 (Distributed File System) 是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连</p>
<p>分布式文件系统的设计基于客户机 / 服务器模式</p>
<p>Ceph 是一个分布式文件系统</p>
<p>具有高扩展、高可用、高性能的特点</p>
<p>Ceph 可以提供对象存储、块存储、文件系统存储</p>
<p>Ceph 可以提供 EB 级别的存储空间 (PB→TB→GB)- 1024G*1024G=1048576G</p>
<h3 id="ceph组件"><a class="markdownIt-Anchor" href="#ceph组件">#</a> ceph 组件</h3>
<p>OSDs 存储设备</p>
<p>Monitors 集群监控组件</p>
<p>RadosGateway (RGW)- 对象存储网关</p>
<p>MDSs 存放文件系统的元数据（对象存储和块存储不需要该组件)</p>
<p>Client ceph 客户端</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240114200314394.png" alt=" "></p>
<p>Mon 和 osd 是必须的组件</p>
<p>Mon 必须是奇数个，过半原则，集群中必须有一半以上 mon 是好的，至少三个起步</p>
<p>ceph 会把文件切分成很多个 4M 小块，小块同时存储到不同的存储，所以存储 osd 越多，速度越快</p>
<p>可以理解成 raid 0</p>
<p>ceph 默认有 3 副本</p>
<h3 id="实验-4"><a class="markdownIt-Anchor" href="#实验-4">#</a> 实验</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240115210243404.png" alt="image-20240115210243404"></p>
<p>每台机器都有 ceph 和 mon</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">yum install createrepo</span><br><span class="line">createrepo /opt/repo   // 建立repo源,产生repodata</span><br><span class="line"></span><br><span class="line">vim /etc/chronyd.conf</span><br><span class="line">server ntp.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line"></span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# systemctl restart chronyd.service </span><br><span class="line"></span><br><span class="line">[root@iZuf62eeabxrpfw1zarmjsZ ~]# chronyc sources</span><br><span class="line">210 Number of sources = 15</span><br><span class="line">MS Name/IP address         Stratum Poll Reach LastRx Last sample               </span><br><span class="line">===============================================================================</span><br><span class="line">^* 100.100.61.88                 1   4    77    13   +427us[ +123us] +/-   10ms</span><br><span class="line">^+ 203.107.6.88                  2   4    77    11   +354us[ +354us] +/-   19ms</span><br><span class="line">^- 120.25.115.20                 2   4   146    39  +1189us[ +652us] +/-   15ms</span><br><span class="line">^? 10.143.33.49                  0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^+ 100.100.3.1                   2   4    77    14   +186us[ -119us] +/- 4027us</span><br><span class="line">^+ 100.100.3.2                   2   4    77    12   +374us[ +374us] +/- 3623us</span><br><span class="line">^- 100.100.3.3                   2   4   137     8  +1220us[+1220us] +/- 4204us</span><br><span class="line">^? 10.143.33.50                  0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^? 10.143.33.51                  0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^? 10.143.0.44                   0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^? 10.143.0.45                   0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^? 10.143.0.46                   0   6     0     -     +0ns[   +0ns] +/-    0ns</span><br><span class="line">^+ 100.100.5.1                   2   4    77    14    -86us[ -391us] +/- 4384us</span><br><span class="line">^? 100.100.5.2                   2   5    10    42    +30us[ -507us] +/- 3984us</span><br><span class="line">^+ 100.100.5.3                   2   4    77    12   +894us[ +894us] +/- 4213us</span><br><span class="line"></span><br><span class="line">yum install virt-manager</span><br><span class="line">virt-manager</span><br><span class="line"></span><br><span class="line">lsblk  // 增加三个磁盘</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">在一个可以无密码远程所有机器的机器上</span><br><span class="line">// chenge-port-engine</span><br><span class="line">yum install -y ceph-deploy</span><br><span class="line">curl https://bootstrap.pypa.io/ez_setup.py -o - | python</span><br><span class="line"></span><br><span class="line">// ceph-deploy 是一个自动部署脚本</span><br><span class="line">[root@iZuf69j04rlrdiwile6mjfZ ~]# cat /usr/bin/ceph-deploy </span><br><span class="line">#!/usr/bin/python2</span><br><span class="line"># EASY-INSTALL-ENTRY-SCRIPT: &#x27;ceph-deploy==1.5.25&#x27;,&#x27;console_scripts&#x27;,&#x27;ceph-deploy&#x27;</span><br><span class="line">__requires__ = &#x27;ceph-deploy==1.5.25&#x27;</span><br><span class="line">import sys</span><br><span class="line">from pkg_resources import load_entry_point</span><br><span class="line"></span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    sys.exit(</span><br><span class="line">        load_entry_point(&#x27;ceph-deploy==1.5.25&#x27;, &#x27;console_scripts&#x27;, &#x27;ceph-deploy&#x27;)()</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">ceph-deploy --help</span><br><span class="line"></span><br><span class="line">// 编辑所有的node hostname和/etc/hosts</span><br><span class="line">vim /etc/hosts</span><br><span class="line">47.116.119.177   node1</span><br><span class="line">139.224.202.165  node2</span><br><span class="line">47.116.198.184   node3</span><br><span class="line"></span><br><span class="line">// 编辑所有yum源</span><br><span class="line">vim /etc/yum.repos.d/ceph.repo</span><br><span class="line">[ceph]</span><br><span class="line">baseurl = https://mirrors.aliyun.com/ceph/rpm-luminous/el7/x86_64</span><br><span class="line">enabled = 1</span><br><span class="line">gpgcheck = 0</span><br><span class="line">name = Ceph packages</span><br><span class="line">priority = 1</span><br><span class="line"></span><br><span class="line">yum makecache fast</span><br><span class="line">yum install ceph-mon.x86_64  ceph-osd.x86_64  ceph-mds.x86_64 ceph-selinux.x86_64  ceph-common.x86_64 ceph-base.x86_64  ceph-radosgw.x86_64  -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 ceph-cluster]# for i in node2 node3</span><br><span class="line">&gt; do</span><br><span class="line">&gt;   ssh $i &quot; yum install ceph-mon.x86_64  ceph-osd.x86_64  ceph-mds.x86_64 ceph-selinux.x86_64  ceph-common.x86_64 ceph-base.x86_64  ceph-radosgw.x86_64  -y&quot;</span><br><span class="line">&gt; done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir ceph-cluster</span><br><span class="line">cd ceph-cluster   // 以后所有的ceph-deploy都需要在这个目录执行</span><br><span class="line"></span><br><span class="line">ceph-deploy new node1 node2 node3 --no-ssh-copykey   </span><br><span class="line"></span><br><span class="line">// 验证</span><br><span class="line">[root@node1 ceph-cluster]# cat ceph.conf </span><br><span class="line">[global]</span><br><span class="line">fsid = 9bfb5b39-ada6-4d34-b08b-3fb83c7952d3</span><br><span class="line">mon_initial_members = node1, node2, node3</span><br><span class="line">mon_host = 47.116.119.177,139.224.202.165,47.116.198.184</span><br><span class="line">auth_cluster_required = cephx				// none 访问无需密码，cephx访问需要密码，他是一个密码占位符</span><br><span class="line">auth_service_required = cephx</span><br><span class="line">auth_client_required = cephx</span><br><span class="line">filestore_xattr_use_omap = true</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 主配置文件</span><br><span class="line">[root@node3 ~]# ls /etc/ceph/</span><br><span class="line"></span><br><span class="line">[root@node1 ceph-cluster]# ceph-deploy mon create-initial </span><br><span class="line"></span><br><span class="line">// 如果这步报错[ceph_deploy.mon][ERROR ] Failed to execute command: /usr/sbin/service ceph -c /etc/ceph/ceph.conf start mon.ceph1  说明ceph-deploy版本有问题，别用1.5.25</span><br><span class="line">参考这篇更新ceph</span><br><span class="line">https://www.cnblogs.com/weiwei2021/p/14060186.html</span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cDovL3d3dy5qcy1jb2RlLmNvbS94aW5kZWppcWlhby94aW5kZWppcWlhb18yNDY0ODguaHRtbA==">http://www.js-code.com/xindejiqiao/xindejiqiao_246488.html</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9jbG91ZC50ZW5jZW50LmNvbS9kZXZlbG9wZXIvYXJ0aWNsZS8xOTY1MTY0">https://cloud.tencent.com/developer/article/1965164</span></p>
<p><strong>注意：目前版本用 ceph-deploy 装会有报错，ceph-deploy 1.5.25 会有 lsb 的错，ceph 2.0 也会报错。目前版本使用 cephadm 安装</strong></p>
<p>参考以下链接可以安装，别装 17 版本，node-exporter 会报错，装 18</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmNlcGguY29tL2VuL2xhdGVzdC9jZXBoYWRtL2luc3RhbGwvI2NlcGhhZG0tZGVwbG95aW5nLW5ldy1jbHVzdGVy">Deploying a new Ceph cluster — Ceph Documentation</span></p>
<p>[Linux | Ceph | Ubuntu 中部署 Ceph 集群 - 隔江千万里 - 博客园 (<span class="exturl" data-url="aHR0cDovL2NuYmxvZ3MuY29t">cnblogs.com</span>)](<span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vRnV0dXJlSG9sbWVzL3AvMTU0MjQ1NTkuaHRtbCM6fjp0ZXh0PUNlcGg=">https://www.cnblogs.com/FutureHolmes/p/15424559.html#:~:text=Ceph</span> 部署 %3A 手动 1 1. 配置 Ceph,7 7. 安装 Cephadm (所有节点) 8 8. 安装 Ceph)</p>
<p><span class="exturl" data-url="aHR0cHM6Ly94d2xzLmdpdGh1Yi5pby8yMDIzLzAyLzE2L2NlcGgtY2x1c3Rlci1pbnN0YWxsLw==">Ubuntu 22.04 安装 ceph 集群 | 小汪老师 (xwls.github.io)</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"># 验证</span><br><span class="line">每个节点上：</span><br><span class="line">root@ceph-node2:~# systemctl status ceph-ed3dd87c-b48a-11ee-9675-056f4225bb69@mon.ceph-node2.service </span><br><span class="line">● ceph-ed3dd87c-b48a-11ee-9675-056f4225bb69@mon.ceph-node2.service - Ceph mon.ceph-node2 for ed3dd87c-b48a-11ee-9675-056f4225bb69</span><br><span class="line">     Loaded: loaded (/etc/systemd/system/ceph-ed3dd87c-b48a-11ee-9675-056f4225bb69@.service; enabled; vendor preset: enabled)</span><br><span class="line">     Active: active (running) since Thu 2024-01-18 21:37:02 CST; 5min ago</span><br><span class="line">   Main PID: 26494 (bash)</span><br><span class="line">      Tasks: 9 (limit: 8672)</span><br><span class="line">     Memory: 8.1M</span><br><span class="line">        CPU: 97ms</span><br><span class="line">     CGroup: /system.slice/system-ceph\x2ded3dd87c\x2db48a\x2d11ee\x2d9675\x2d056f4225bb69.slice/ceph-ed3dd87c-b48a-11ee-9675-056f4225bb69@mon.ceph-node2.service</span><br><span class="line">             ├─26494 /bin/bash /var/lib/ceph/ed3dd87c-b48a-11ee-9675-056f4225bb69/mon.ceph-node2/unit.run</span><br><span class="line">             └─26510 /usr/bin/docker run --rm --ipc=host --stop-signal=SIGTERM --ulimit nofile=1048576 --net=host --entrypoint /usr/bin/ceph-mon --privileged --group-add=disk --init --name ceph-ed3dd87c-b48a-11ee-9675-056f4225bb69-mon-ceph-node2 --pids-limit=0 -e CONTAIN&gt;</span><br><span class="line"></span><br><span class="line">mon上</span><br><span class="line">root@ceph-node1:~# ceph -s </span><br><span class="line">  cluster:</span><br><span class="line">    id:     ed3dd87c-b48a-11ee-9675-056f4225bb69</span><br><span class="line">    health: HEALTH_OK</span><br><span class="line"> </span><br><span class="line">  services:</span><br><span class="line">    mon: 3 daemons, quorum ceph-node1,ceph-node2,ceph-node3 (age 4m)</span><br><span class="line">    mgr: ceph-node1.lhhwcs(active, since 45h), standbys: ceph-node2.svhmyy</span><br><span class="line">    osd: 9 osds: 9 up (since 3m), 9 in (since 3m)</span><br><span class="line"> </span><br><span class="line">  data:</span><br><span class="line">    pools:   1 pools, 1 pgs</span><br><span class="line">    objects: 2 objects, 449 KiB</span><br><span class="line">    usage:   640 MiB used, 359 GiB / 360 GiB avail</span><br><span class="line">    pgs:     1 active+clean</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">root@ceph-node1:/etc/ceph# cat ceph.client.admin.keyring </span><br><span class="line">[client.admin]</span><br><span class="line">        key = AQCerKZlXFkFBxAADiQXY27WFREVjjpPg8gikg==					// ceph用户名密码</span><br><span class="line">        caps mds = &quot;allow *&quot;</span><br><span class="line">        caps mgr = &quot;allow *&quot;</span><br><span class="line">        caps mon = &quot;allow *&quot;</span><br><span class="line">        caps osd = &quot;allow *&quot;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240118220439463.png" alt="image-20240118220439463"></p>
<p>添加到 osd 中后变为 lvm 格式</p>
<p>添加一块 ESSD AutoPL 作为缓存盘</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">for i in ceph-node1  ceph-node2  ceph-node3</span><br><span class="line">do</span><br><span class="line">	ssh $i &quot;parted /dev/vde mklabel gpt&quot;</span><br><span class="line">	ssh $i &quot;parted /dev/vde mkpart primary 1 50%&quot;</span><br><span class="line">	ssh $i &quot;parted /dev/vde mkpart primary 50% 100%&quot;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240118220608104.png" alt="image-20240118220608104"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 全局node执行</span><br><span class="line">root@ceph-node1:/etc/ceph# ll /dev/vde*</span><br><span class="line">brw-rw---- 1 root disk 252, 64 Jan 18 22:05 /dev/vde</span><br><span class="line">brw-rw---- 1 root disk 252, 65 Jan 18 22:05 /dev/vde1</span><br><span class="line">brw-rw---- 1 root disk 252, 66 Jan 18 22:05 /dev/vde2</span><br><span class="line"></span><br><span class="line">注意权限</span><br><span class="line">for i in ceph-node1  ceph-node2  ceph-node3; do   chown ceph.ceph /dev/vde1 /dev/vde2  done;</span><br><span class="line"></span><br><span class="line">永久生效</span><br><span class="line">vim /etc/udev/rules.d/70-vde.rules</span><br><span class="line">ENV&#123;DEVICENAME&#125;==&quot;/dev/vde1&quot;,OWNER=&quot;ceph&quot;,GROUP=&quot;ceph&quot;</span><br><span class="line">ENV&#123;DEVICENAME&#125;==&quot;/dev/vde2&quot;,OWNER=&quot;ceph&quot;,GROUP=&quot;ceph&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@ceph-node3:~# ll /dev/vde*</span><br><span class="line">brw-rw---- 1 root disk 252, 64 Jan 18 22:05 /dev/vde</span><br><span class="line">brw-rw---- 1 ceph ceph 252, 65 Jan 18 22:05 /dev/vde1</span><br><span class="line">brw-rw---- 1 ceph ceph 252, 66 Jan 18 22:05 /dev/vde2</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240118223644384.png" alt="image-20240118223644384"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">查看共享池</span><br><span class="line">root@ceph-node1:/etc/ceph# ceph osd lspools </span><br><span class="line"></span><br><span class="line">创建共享池</span><br><span class="line">root@ceph-node1:/etc/ceph# ceph osd pool create pool-name</span><br><span class="line"></span><br><span class="line">qcow2 创建虚拟机，虚拟机镜像格式 layering 开启cow功能，支持快照</span><br><span class="line"></span><br><span class="line">root@ceph-node1:/etc/ceph# rbd create pool-name/demo --image-feature layering   --size 20G</span><br><span class="line">root@ceph-node1:/etc/ceph# rbd create pool-name/images --image-feature layering   --size 30G</span><br><span class="line"></span><br><span class="line">root@ceph-node1:/etc/ceph# rbd list pool-name </span><br><span class="line">demo</span><br><span class="line">images</span><br><span class="line"></span><br><span class="line">root@ceph-node1:/etc/ceph# rbd info pool-name/demo </span><br><span class="line">rbd image &#x27;demo&#x27;:</span><br><span class="line">        size 20 GiB in 5120 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        id: 3885ef2f25ef</span><br><span class="line">        block_name_prefix: rbd_data.3885ef2f25ef</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        access_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        modify_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        </span><br><span class="line">// 动态扩容rbd</span><br><span class="line">root@ceph-node1:/etc/ceph# rbd resize --size 25G pool-name/demo</span><br><span class="line">Resizing image: 100% complete...done.</span><br><span class="line">root@ceph-node1:/etc/ceph# rbd info pool-name/demo </span><br><span class="line">rbd image &#x27;demo&#x27;:</span><br><span class="line">        size 25 GiB in 6400 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        id: 3885ef2f25ef</span><br><span class="line">        block_name_prefix: rbd_data.3885ef2f25ef</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        access_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        modify_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        </span><br><span class="line">// 动态缩容rbd</span><br><span class="line">root@ceph-node1:/etc/ceph# rbd resize --size 17G pool-name/demo --allow-shrink </span><br><span class="line">Resizing image: 100% complete...done.</span><br><span class="line">root@ceph-node1:/etc/ceph# rbd info pool-name/demo </span><br><span class="line">rbd image &#x27;demo&#x27;:</span><br><span class="line">        size 17 GiB in 4352 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        id: 3885ef2f25ef</span><br><span class="line">        block_name_prefix: rbd_data.3885ef2f25ef</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        access_timestamp: Thu Jan 18 22:59:25 2024</span><br><span class="line">        modify_timestamp: Thu Jan 18 22:59:25 2024</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">// 访问 在client上执行</span><br><span class="line">yum install ceph-common -y </span><br><span class="line"></span><br><span class="line">// 把conf 和 keying 复制到client</span><br><span class="line">root@ceph-node1:/etc/ceph# scp ceph.conf root@10.0.0.251:/root</span><br><span class="line">                                                                                                                                         </span><br><span class="line">root@ceph-node1:/etc/ceph# scp ceph.client.admin.keyring  root@10.0.0.251:/root</span><br><span class="line"></span><br><span class="line">复制到 /etc/ceph</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 ceph]# lsblk </span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">vdd    253:48   0   40G  0 disk </span><br><span class="line">vdb    253:16   0   40G  0 disk </span><br><span class="line">vdc    253:32   0   40G  0 disk </span><br><span class="line">vda    253:0    0  140G  0 disk </span><br><span class="line">└─vda1 253:1    0  140G  0 part /</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@node1 ceph]# rbd map pool-name/demo</span><br><span class="line">/dev/rbd0</span><br><span class="line"></span><br><span class="line">[root@node1 ceph]# lsblk </span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">rbd0   252:0    0   17G  0 disk </span><br><span class="line">vdd    253:48   0   40G  0 disk </span><br><span class="line">vdb    253:16   0   40G  0 disk </span><br><span class="line">vdc    253:32   0   40G  0 disk </span><br><span class="line">vda    253:0    0  140G  0 disk </span><br><span class="line">└─vda1 253:1    0  140G  0 part /</span><br><span class="line"></span><br><span class="line">[root@node1 ceph]# rbd showmapped </span><br><span class="line">id pool      namespace image snap device    </span><br><span class="line">0  pool-name           demo  -    /dev/rbd0 </span><br><span class="line"></span><br><span class="line">// 取消映射</span><br><span class="line">[root@node1 ceph]# rbd device unmap /dev/rbd1 </span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FsZXhfeWFuZ2NodWFuc2hlbmcvYXJ0aWNsZS9kZXRhaWxzLzEyMzUxNjAyNQ==">https://blog.csdn.net/alex_yangchuansheng/article/details/123516025</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// 快照</span><br><span class="line">root@ceph-node1:~# rbd snap create  pool-name/demo --snap snap1 </span><br><span class="line">Creating snap: 100% complete...done.</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd snap ls pool-name/demo</span><br><span class="line">SNAPID  NAME   SIZE    PROTECTED  TIMESTAMP               </span><br><span class="line">     4  snap1  17 GiB             Sat Jan 20 14:26:44 2024</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 客户端模拟误删</span><br><span class="line">[root@node1 ppp]# rm -rf shabi </span><br><span class="line"></span><br><span class="line">[root@node1 /]# umount /ppp </span><br><span class="line"></span><br><span class="line">// ceph 上回滚</span><br><span class="line">root@ceph-node1:~# rbd snap rollback pool-name/demo --snap snap1</span><br><span class="line">Rolling back to snapshot: 100% complete...done.</span><br><span class="line"></span><br><span class="line">// 去client 上查看</span><br><span class="line">[root@node1 /]# mount /dev/rbd0 /ppp</span><br><span class="line">[root@node1 /]# cd /ppp/</span><br><span class="line">[root@node1 ppp]# ls </span><br><span class="line">lost+found  shabi</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">// 用旧的快照克隆新的镜像</span><br><span class="line">root@ceph-node1:~# rbd snap  protect pool-name/demo --snap snap1  </span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd snap rm  pool-name/demo --snap snap1</span><br><span class="line">Removing snap: 0% complete...failed.2024-01-20T14:38:40.687+0800 7f788903be00 -1 librbd::Operations: snapshot is protected</span><br><span class="line">rbd: snapshot &#x27;snap1&#x27; is protected from removal.</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd clone pool-name/demo@snap1  pool-name/snap2 </span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd list  pool-name </span><br><span class="line">demo</span><br><span class="line">images</span><br><span class="line">snap2</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd info pool-name/snap2</span><br><span class="line">rbd image &#x27;snap2&#x27;:</span><br><span class="line">        size 17 GiB in 4352 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        id: 39cf34833fff</span><br><span class="line">        block_name_prefix: rbd_data.39cf34833fff</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        access_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        modify_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        parent: pool-name/demo@snap1</span><br><span class="line">        overlap: 17 GiB</span><br><span class="line">        </span><br><span class="line"># 如果希望克隆的镜像独立工作，需要将父快照中的数据全局拷贝一份</span><br><span class="line">root@ceph-node1:~# rbd flatten pool-name/snap2</span><br><span class="line">Image flatten: 100% complete...done.</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# rbd info pool-name/snap2</span><br><span class="line">rbd image &#x27;snap2&#x27;:</span><br><span class="line">        size 17 GiB in 4352 objects</span><br><span class="line">        order 22 (4 MiB objects)</span><br><span class="line">        snapshot_count: 0</span><br><span class="line">        id: 39cf34833fff</span><br><span class="line">        block_name_prefix: rbd_data.39cf34833fff</span><br><span class="line">        format: 2</span><br><span class="line">        features: layering</span><br><span class="line">        op_features: </span><br><span class="line">        flags: </span><br><span class="line">        create_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        access_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        modify_timestamp: Sat Jan 20 14:55:39 2024</span><br><span class="line">        </span><br><span class="line">// 取消保护，删除snap</span><br><span class="line">root@ceph-node1:~# rbd snap unprotect pool-name/demo --snap snap1 </span><br><span class="line">root@ceph-node1:~# rbd snap rm pool-name/demo --snap snap1</span><br><span class="line">Removing snap: 100% complete...done.</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 客户段取消映射</span><br><span class="line">[root@node1 /]# umount /ppp </span><br><span class="line">[root@node1 /]# rbd unmap pool-name/demo </span><br><span class="line">[root@node1 /]# lsblk </span><br><span class="line">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">vdd    253:48   0   40G  0 disk </span><br><span class="line">vdb    253:16   0   40G  0 disk </span><br><span class="line">vdc    253:32   0   40G  0 disk </span><br><span class="line">vda    253:0    0  140G  0 disk </span><br><span class="line">└─vda1 253:1    0  140G  0 part /</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240120154500944.png" alt="image-20240120154500944" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">// 通过虚拟机访问ceph</span><br><span class="line"></span><br><span class="line">// node1</span><br><span class="line">[root@node1 /]# rbd create pool-name/vm1-image --image-feature layering --size 10G</span><br><span class="line"></span><br><span class="line">// client</span><br><span class="line">&lt;secret ephemeral=&#x27;no&#x27; private=&#x27;no&#x27;&gt;</span><br><span class="line">        &lt;usage type=&#x27;ceph&#x27;&gt;</span><br><span class="line">                &lt;name&gt;client.admin secret&lt;/name&gt;</span><br><span class="line">        &lt;/usage&gt;</span><br><span class="line">&lt;/secret&gt;</span><br><span class="line"></span><br><span class="line">virsh secret-define secret.xml</span><br><span class="line">virsh secret-list </span><br><span class="line"></span><br><span class="line">// 绑定密码</span><br><span class="line">virsh secret-set-value -secret xxx-xxx-xxx --base64 xxxxxx</span><br><span class="line"></span><br><span class="line">virsh edit  xxx.xml</span><br><span class="line"></span><br><span class="line">在kvm中 virtio 接口速率是最高的</span><br><span class="line"></span><br><span class="line">&lt;disk type=&#x27;network&#x27; device=&#x27;disk&#x27;&gt;</span><br><span class="line">	&lt;driver name=&#x27;qemu&#x27; type=&#x27;raw&#x27; /&gt;</span><br><span class="line">	&lt;auth username=&#x27;admin&#x27;&gt;</span><br><span class="line">	&lt;secret type=&#x27;ceph&#x27; uuid=&#x27;&#x27; /&gt;     # virsh secret list 获取刚刚创建的secret</span><br><span class="line">	&lt;/auth&gt;</span><br><span class="line">	&lt;source protocol=&#x27;rbd&#x27; name=&#x27;rbd/vm1&#x27;&gt;</span><br><span class="line">	&lt;host name=&#x27;1.1.1.1&#x27; port=&#x27;6789&#x27; /&gt;</span><br><span class="line">	&lt;/source&gt;</span><br><span class="line">	&lt;target dev=&#x27;vda&#x27; bus=&#x27;virtio&#x27; /&gt;</span><br><span class="line">&lt;/disk&gt;</span><br><span class="line"></span><br><span class="line">虚拟机reboot生效</span><br></pre></td></tr></table></figure>
<h3 id="ceph文件系统"><a class="markdownIt-Anchor" href="#ceph文件系统">#</a> ceph 文件系统</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240121144521974.png" alt="image-20240121144521974"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ ceph osd pool create cephfs_data</span><br><span class="line">$ ceph osd pool create cephfs_metadata</span><br><span class="line"></span><br><span class="line">ceph fs new cephfs cephfs_metadata cephfs_data  128    // metadata 存元数据，data存数据,128是pg数量，为2^x ，可以理解为目录数量，默认64</span><br><span class="line">ceph fs ls</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# ceph osd lspools </span><br><span class="line">1 .mgr</span><br><span class="line">2 pool-name</span><br><span class="line">3 cephfs_data</span><br><span class="line">4 cephfs_metadata</span><br><span class="line"></span><br><span class="line">root@ceph-node1:~# ceph fs ls </span><br><span class="line">name: cephfs, metadata pool: cephfs_metadata, data pools: [cephfs_data ]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@client ~]# mount -t ceph 10.0.0.4:6789:/ /000/ -o name=admin,secret=AQCerKZlXFkFBxAADiQXY27WFREVjjpPg8gikg==</span><br></pre></td></tr></table></figure>
<h3 id="对象存储"><a class="markdownIt-Anchor" href="#对象存储">#</a> 对象存储</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">对象存储 ceph-radosgw</span><br><span class="line"></span><br><span class="line">启动ceph-radosgw 即可</span><br><span class="line"></span><br><span class="line">修改端口为8000</span><br><span class="line"></span><br><span class="line">[client.rgw.ceph-node1]</span><br><span class="line">host = ceph-node1</span><br><span class="line">rgw_frontends = &quot;civetweb port=8000&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s3tools.org 测试</span><br></pre></td></tr></table></figure>

      <div class="tags">
          <a href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag"><i class="ic i-tag"></i> 运维</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-01-21 23:36:56" itemprop="dateModified" datetime="2024-01-21T23:36:56+08:00">2024-01-21</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="John Doe WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="John Doe Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="John Doe PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/" title="集群与存储">http://example.com/2024/01/10/集群与存储/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/01/01/istio/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;0e7c33417077333d006139c148caf559.jpg" title="istio">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> 运维</span>
  <h3>istio</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;e9387f53393624bd88390036d7943fad.jpg" title="虚拟化">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> 运维</span>
  <h3>虚拟化</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8"><span class="toc-number">1.</span> <span class="toc-text"> 集群与存储</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#lvs"><span class="toc-number">1.1.</span> <span class="toc-text"> LVS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lvs%E9%9B%86%E7%BE%A4%E7%BB%84%E6%88%90"><span class="toc-number">1.1.1.</span> <span class="toc-text"> lvs 集群组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lvs%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A"><span class="toc-number">1.1.2.</span> <span class="toc-text"> lvs 名词解释</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lvs-%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.3.</span> <span class="toc-text"> lvs 工作模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lvs%E8%B0%83%E5%BA%A6%E7%AE%97%E6%B3%95"><span class="toc-number">1.1.4.</span> <span class="toc-text"> LVS 调度算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ipvsadm"><span class="toc-number">1.1.5.</span> <span class="toc-text"> ipvsadm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-nat%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.6.</span> <span class="toc-text"> 实验 nat 模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-lvs-dr"><span class="toc-number">1.1.7.</span> <span class="toc-text"> 实验 lvs-dr</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keepalived"><span class="toc-number">1.2.</span> <span class="toc-text"> keepalived</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C"><span class="toc-number">1.2.1.</span> <span class="toc-text"> 实验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-2"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#haproxy"><span class="toc-number">1.3.</span> <span class="toc-text"> haproxy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ngx-lvs-haproxy-%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.1.</span> <span class="toc-text"> ngx - lvs - haproxy 对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-3"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 实验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8"><span class="toc-number">1.4.</span> <span class="toc-text"> 存储</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ceph%E7%BB%84%E4%BB%B6"><span class="toc-number">1.4.1.</span> <span class="toc-text"> ceph 组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E9%AA%8C-4"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 实验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ceph%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.4.3.</span> <span class="toc-text"> ceph 文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8"><span class="toc-number">1.4.4.</span> <span class="toc-text"> 对象存储</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2022/11/27/CDN/" rel="bookmark" title="CDN&DNS">CDN&DNS</a></li><li><a href="/2023/04/03/iptables2/" rel="bookmark" title="iptables">iptables</a></li><li><a href="/2023/04/05/Docker/" rel="bookmark" title="docker">docker</a></li><li><a href="/2023/04/15/Nginx_new/" rel="bookmark" title="Nginx">Nginx</a></li><li><a href="/2023/05/20/Kubernetes/" rel="bookmark" title="Kubernetes">Kubernetes</a></li><li><a href="/2023/05/30/jenkins/" rel="bookmark" title="Jenkins">Jenkins</a></li><li><a href="/2023/06/02/k8s%E9%AB%98%E7%BA%A7/" rel="bookmark" title="k8s高级">k8s高级</a></li><li><a href="/2024/01/01/istio/" rel="bookmark" title="istio">istio</a></li><li class="active"><a href="/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/" rel="bookmark" title="集群与存储">集群与存储</a></li><li><a href="/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="bookmark" title="虚拟化">虚拟化</a></li><li><a href="/2024/02/01/%E7%9B%91%E6%8E%A7/" rel="bookmark" title="监控">监控</a></li><li><a href="/2024/02/15/Elastic%20Stack/" rel="bookmark" title="Elastic stack">Elastic stack</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">46</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">6</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">6</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/01/01/istio/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2024/01/01/istio/" title="istio">istio</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%86%85%E7%BD%91/" title="In 内网">内网</a>
</div>

    <span><a href="/2022/12/25/%E5%86%85%E7%BD%91/" title="内网渗透">内网渗透</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/02/21/https%E5%8E%9F%E7%90%86/" title="https+TLS">https+TLS</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2023/04/15/Nginx_new/" title="Nginx">Nginx</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/03/27/http/" title="http">http</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%86%85%E7%BD%91/" title="In 内网">内网</a>
</div>

    <span><a href="/2022/05/27/emergency%20response/" title="应急响应">应急响应</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/05/17/include/" title="file include">file include</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/04/16/Upload/" title="File upload">File upload</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2023/06/02/k8s%E9%AB%98%E7%BA%A7/" title="k8s高级">k8s高级</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E7%BD%91%E7%BB%9C/" title="In 网络">网络</a>
</div>

    <span><a href="/2023/01/17/Segment%20Routing/" title="Segment Routing">Segment Routing</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/01/10/集群与存储/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>

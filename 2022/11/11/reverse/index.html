



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="逆向" />


<link rel="canonical" href="http://example.com/2022/11/11/reverse/">



  <title>
逆向 - 逆向 |
Yume Shoka = Hexo</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">逆向
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2022-11-11 13:38:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2022-11-11T13:38:45+08:00">2022-11-11</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6e7c7d241bbd3f8bacac3372cbe3c6ba.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/9d916994e193f2640e3660e986b3226d.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/d6ac20b715622e2d46f27dc717ab9484.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/ade7d346ca6d48abc5474c3e1c02f68c.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/626f157a4ff74c7984f4110e38031524.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/6481fffb5173a5621c7af0848ed50fa7.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E9%80%86%E5%90%91/" itemprop="item" rel="index" title="In 逆向"><span itemprop="name">逆向</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2022/11/11/reverse/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h2 id="c与汇编的关系"><a class="markdownIt-Anchor" href="#c与汇编的关系">#</a> C 与汇编的关系</h2>
<h3 id="应用层技术栈"><a class="markdownIt-Anchor" href="#应用层技术栈">#</a> 应用层技术栈：</h3>
<ol>
<li>加密与解密（四）看雪论坛</li>
<li>X86/X64/arm 汇编语言</li>
<li>windows 核心编程</li>
<li>c 语言从入门到精通 (第三版) （清华）</li>
</ol>
<h3 id="学习逆向环境配置"><a class="markdownIt-Anchor" href="#学习逆向环境配置">#</a> 学习逆向环境配置</h3>
<p>工具类：</p>
<ul>
<li>吾爱破解工具类</li>
<li>Hxd (十六进制编辑工具)</li>
</ul>
<p>开发类：</p>
<ol>
<li>VS2008 IDE</li>
<li>VC6.0 SP6 IDE</li>
</ol>
<h3 id="进制转换"><a class="markdownIt-Anchor" href="#进制转换">#</a> 进制转换</h3>
<ol>
<li>十进制的定义：由十个符号组成，分别是 0 1 2 3 4 5 6 7 8 9 逢十进一</li>
<li>九进制的定义：由九个符号组成，分别是 0 1 2 3 4 5 6 7 8 逢九进一</li>
<li>十六进制的定义：由十六个符号组成，分别是 0 1 2 3 4 5 6 7 8 9 A B C D E F</li>
<li>N 进制的定义：由 N 个符号组成 逢 N 进一</li>
</ol>
<h3 id="数据类型与逻辑运算"><a class="markdownIt-Anchor" href="#数据类型与逻辑运算">#</a> 数据类型与逻辑运算</h3>
<p>在计算机中，由于硬件的制约，数据是有长度限制的，超过数据宽度的数据会被丢弃</p>
<p>同一个数据，表示无符号数和有符号数则其含义不同</p>
<ol>
<li>无符号数：正数</li>
<li>有符号数：正数、负数</li>
</ol>
<h3 id="常见的数据类型重要"><a class="markdownIt-Anchor" href="#常见的数据类型重要">#</a> 常见的数据类型（重要）</h3>
<ul>
<li>BYTE                    字节          8BIT</li>
<li>WORD                 字             16BIT 2 字节</li>
<li>DWORD              双字          32BIT 4 字节</li>
</ul>
<h3 id="常见的运算符类型重要"><a class="markdownIt-Anchor" href="#常见的运算符类型重要">#</a> <strong>常见的运算符类型（重要）</strong></h3>
<p><strong>或运算（or |）</strong></p>
<p>只要有一个为 1 则结果为 1</p>
<p><strong>与运算（and &amp;）</strong></p>
<p>两个都是 1 结果才为 1</p>
<p><strong>异或运算（xor ^）</strong></p>
<p>相同为 0 不同为 1</p>
<p><strong>非运算 (not !)</strong></p>
<p>取反 1 是 0 0 是 1</p>
<h3 id="32位寄存器"><a class="markdownIt-Anchor" href="#32位寄存器">#</a> 32 位寄存器</h3>
<p>EAX</p>
<p>EBX</p>
<p>ECX</p>
<p>EDX</p>
<p>只有通用寄存器能拆成高位和低位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mov byte [local.3+2],ah     //由于只是高位地址，因此是3+2</span><br><span class="line">mov byte [local.3+3],ah     //同时注意是byte，所以是2</span><br></pre></td></tr></table></figure>
<p>command 中</p>
<p>?al 可以显示 al 中的值，即查看寄存器中的值</p>
<p>dd  内存 display dword</p>
<p>dw 内存</p>
<p>db 内存</p>
<h3 id="cpu计算23"><a class="markdownIt-Anchor" href="#cpu计算23">#</a> CPU 计算 2+3</h3>
<p>1. 先异或，得到 R</p>
<p>2. 在与运算，将结果左移一位</p>
<p>3. 如果 (2) 的结果为全 0，那么 R 就是最终答案，如果不是，将 R 赋值给 x，将 (2) 的结果赋值给 y</p>
<p>4. 重复操作直至 (2) 的结果为全 0，那么此时 R 就是我们的答案</p>
<h3 id="cpu计算2-3"><a class="markdownIt-Anchor" href="#cpu计算2-3">#</a> CPU 计算 2-3</h3>
<p>1. 异或，得到 R</p>
<p>2. 在与运算，将结果再左移一位</p>
<p>3. 如果结果为全 0，那么 R 就是结果，否则重复</p>
<p>在 debug 的模式下是用常量来分配的 print hello world</p>
<h3 id="堆栈的原理"><a class="markdownIt-Anchor" href="#堆栈的原理">#</a> 堆栈的原理：</h3>
<ol>
<li>临时存放一些寄存器已无法存放的数据，比如超过内存对齐的数据类型</li>
<li>存放临时数据，野指针，指针初始化时的数据</li>
</ol>
<p>Windows 分配栈时 是从高地址往低地址分配:</p>
<ol>
<li>MOV EBX,0x13FFDC        BASE</li>
<li>MOV EDX,0x13FFDC        TOP</li>
</ol>
<p>EBP 和 ESP：</p>
<p>ESP：该指针永远指向系统栈最上面一个栈帧的栈顶。</p>
<p>EBP：该指针永远指向系统栈最上面一个栈帧的底部。</p>
<p>栈底和栈顶原理：</p>
<ol>
<li>控制栈顶和栈底分别为两个固定的寄存器 (EBP 基址指针寄存器 和 ESP 堆栈指针寄存器）</li>
</ol>
<p>ebp = esp</p>
<p>esp -= 0x40</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1654236227177-d37c824f-e09f-4e3d-9a41-c4d81ee6de30.png" alt="img"></p>
<p>ESP 和 EBP 不够的时候会相互借用，两个都用作传参</p>
<p>初始状态下，ebp 指向高地址，ESP 指向低地址</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095016154.png" alt="image-20221105095016154"></p>
<p>push eax</p>
<blockquote>
<p>先把 esp-4，再把 eax 中的值压栈</p>
</blockquote>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095049237.png" alt="image-20221105095049237"></p>
<p>pop eax</p>
<blockquote>
<p>将 esp 指向的值给 eax，esp+4</p>
</blockquote>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095144317.png" alt="image-20221105095144317"></p>
<h4 id="一个helloworld的main函数"><a class="markdownIt-Anchor" href="#一个helloworld的main函数">#</a> 一个 helloworld 的 main 函数</h4>
<p>一般来说，VC 6.0 的 main 函数在  <code>call 00401005</code></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105093859109.png" alt="image-20221105093859109"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">00401005  /$ /E9 06000000   jmp     main</span><br><span class="line">0040100A  |  |CC            int3</span><br><span class="line">0040100B  |  |CC            int3</span><br><span class="line">0040100C  |  |CC            int3</span><br><span class="line">0040100D  |  |CC            int3</span><br><span class="line">0040100E  |  |CC            int3</span><br><span class="line">0040100F  |  |CC            int3</span><br><span class="line">00401010 &gt;|&gt; \55            push    ebp</span><br><span class="line">00401011  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401013  |.  83EC 40       sub     esp,0x40</span><br><span class="line">00401016  |.  53            push    ebx</span><br><span class="line">00401017  |.  56            push    esi</span><br><span class="line">00401018  |.  57            push    edi</span><br><span class="line">00401019  |.  8D7D C0       lea     edi,[local.16]</span><br><span class="line">0040101C  |.  B9 10000000   mov     ecx,0x10</span><br><span class="line">00401021  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401026  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">00401028  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class="line">&quot;</span><br><span class="line">0040102D  |.  E8 2E000000   call    printf                           ; \printf</span><br><span class="line">00401032  |.  83C4 04       add     esp,0x4</span><br><span class="line">00401035  |.  33C0          xor     eax,eax</span><br><span class="line">00401037  |.  5F            pop     edi</span><br><span class="line">00401038  |.  5E            pop     esi</span><br><span class="line">00401039  |.  5B            pop     ebx</span><br><span class="line">0040103A  |.  83C4 40       add     esp,0x40</span><br><span class="line">0040103D  |.  3BEC          cmp     ebp,esp</span><br><span class="line">0040103F  |.  E8 9C000000   call    _chkesp</span><br><span class="line">00401044  |.  8BE5          mov     esp,ebp</span><br><span class="line">00401046  |.  5D            pop     ebp</span><br><span class="line">00401047  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>假设当前我们有这样一个程序</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// add_main.cpp : Defines the entry point for the console application.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> m, <span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> a, b;</span><br><span class="line">    a = m;</span><br><span class="line">    b = n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> m=<span class="number">3</span>,n=<span class="number">4</span>;</span><br><span class="line">	<span class="built_in">func</span>(m,n);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在调用 func 之前，main 的栈帧：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105100143457.png" alt="image-20221105100143457"></p>
<p>从低地址 esp 到高地址 ebp 的这块区域，就是当前 main 函数的栈帧。当 main 中调用 func 时，写成汇编大致是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">push m</span><br><span class="line">push n; 两个参数压入栈</span><br><span class="line">call func; 调用func，将返回地址填入栈，并跳转到func</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">00401078  |.  C745 FC 03000&gt;mov     dword ptr ss:[ebp-0x4],0x3</span><br><span class="line">0040107F  |.  C745 F8 04000&gt;mov     dword ptr ss:[ebp-0x8],0x4</span><br><span class="line">00401086  |.  8B45 F8       mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">00401089  |.  50            push    eax</span><br><span class="line">0040108A  |.  8B4D FC       mov     ecx,dword ptr ss:[ebp-0x4]</span><br><span class="line">0040108D  |.  51            push    ecx</span><br><span class="line">0040108E  |.  E8 72FFFFFF   call    00401005</span><br><span class="line">00401093  |.  83C4 08       add     esp,0x8</span><br><span class="line">00401096  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class="line">&quot;</span><br><span class="line">0040109B  |.  E8 30000000   call    printf                           ; \printf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105100732747.png" alt="image-20221105100732747"></p>
<p>当跳转到了 func，来看看 func 的汇编大致的样子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">00401020 &gt;/&gt; \55            push    ebp</span><br><span class="line">00401021  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401023  |.  83EC 48       sub     esp,0x48</span><br><span class="line">00401026  |.  53            push    ebx</span><br><span class="line">00401027  |.  56            push    esi</span><br><span class="line">00401028  |.  57            push    edi</span><br></pre></td></tr></table></figure>
<p>push ebp 需要保存 main 的栈底，因为现在到了一个新的函数，但栈顶不需要保存，因为上一个栈帧的顶部讲会是 func 的栈帧底部。（两栈帧相邻的）</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105101018994.png" alt="image-20221105101018994"></p>
<p>到这里，新的栈帧开始了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">mov     dword ptr ss:[ebp-0x4],eax</span><br><span class="line">mov     ecx,dword ptr ss:[ebp+0xC]</span><br><span class="line">mov     dword ptr ss:[ebp-0x8],ecx</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105101240579.png" alt="image-20221105101240579"></p>
<p>retn   ; 返回，然后 8 是什么意思呢，就是参数占用的字节数，当返回后，esp-n，释放参数 m,n 的空间</p>
<p>由此可见，通过 ebp，能够很容易定位到上面的参数。当从 func 函数返回时，首先 esp 移动到栈帧底部（即释放局部变量），然后把上一个函数的栈帧底部指针弹出到 ebp, 再弹出返回地址到 cs:ip 上，esp 继续移动划过参数，这样，ebp,esp 就回到了调用函数前的状态，即现在恢复了原来的 main 的栈帧</p>
<p>大佬的文章：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1R1eGVkb0xpbnV4L2FydGljbGUvZGV0YWlscy8xMDA5MjE5OTQ=">栈帧 ebp,esp 详解_TuxedoLinux 的博客 - CSDN 博客_ebp esp</span></p>
<h4 id="提升堆栈"><a class="markdownIt-Anchor" href="#提升堆栈">#</a> <strong>提升堆栈</strong></h4>
<p>对应语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00401060 &gt;/&gt; \55            push    ebp</span><br><span class="line">00401061  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401063  |.  83EC 48       sub     esp,0x40</span><br></pre></td></tr></table></figure>
<p>将堆栈提升了 0x40</p>
<p>将 esp 的值减去 0x40=64，我们这里的相差的数据宽度为 4 即 16,64/4=16，因此堆栈图里多了 16 格（蓝色部分），这种操作常被叫做<strong>提升堆栈</strong>，此时堆栈图为：</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20210228212917496.png" alt="image-20210228212917496" style="zoom:50%;" />
<p>此时 ESP 指向新的栈顶，蓝色区域为我们 CALL 0040100A 之后新的栈，下面的区域为原来的栈</p>
<p>此时蓝色中的数据为脏数据，因为栈中放的是临时数据，可能是之前没有清理的数据</p>
<h4 id="保护现场"><a class="markdownIt-Anchor" href="#保护现场">#</a> <strong>保护现场</strong></h4>
<p>对应语句为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00401066  |.  53            push    ebx</span><br><span class="line">00401067  |.  56            push    esi</span><br><span class="line">00401068  |.  57            push    edi</span><br></pre></td></tr></table></figure>
<p>将 ebx、esi、edi 三个通用寄存器保存到堆栈中，前面的 push ebp 其实也属于保护现场</p>
<h4 id="初始化提升的堆栈"><a class="markdownIt-Anchor" href="#初始化提升的堆栈">#</a> <strong>初始化提升的堆栈</strong></h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00401069  |.  8D7D B8       lea     edi,dword ptr ss:[ebp-0x48]  ;就是将刚开始的esp给的edi</span><br><span class="line">0040106C  |.  B9 12000000   mov     ecx,0x12     ;ecx是为了之后的rep做准备的，ecx是rep循环次数</span><br><span class="line">00401071  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC     ;使用CC防止缓冲溢出</span><br><span class="line">00401076  |.  F3:AB         rep     stos dword ptr es:[edi]  ;将eax的值赋值给edi所指向的内存地址里的值，并且每执行一次edi都会增加4（D标志位为0所以是增加</span><br></pre></td></tr></table></figure>
<p>这里将我们提升的堆栈中的内容全部初始化为 CCCCCCCC</p>
<p>为什么是初始化为 CC？防止<strong>缓冲</strong>溢出</p>
<p>CC 的<strong>硬编码</strong>对应的指令为 int 3，即断点</p>
<p>这么做有什么好处呢？当程序执行超过缓冲区时，遇到 int 3 就会自动停下来</p>
<h4 id="执行实际的内容"><a class="markdownIt-Anchor" href="#执行实际的内容">#</a> 执行实际的内容</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">00401058 |. 8B45 08    mov eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">0040105B |. 0345 0C    add eax,dword ptr ss:[ebp+0xC]</span><br></pre></td></tr></table></figure>
<p>就是将前面压入的参数 2 和 1 进行相加得到 3</p>
<h4 id="恢复现场"><a class="markdownIt-Anchor" href="#恢复现场">#</a> 恢复现场</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">00401145  |.  5F            pop     edi</span><br><span class="line">00401146  |.  5E            pop     esi</span><br><span class="line">00401147  |.  5B            pop     ebx</span><br><span class="line">00401148  |.  8BE5          mov     esp,ebp</span><br><span class="line">0040114A  |.  5D            pop     ebp</span><br></pre></td></tr></table></figure>
<p>与前面保护现场相对应</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20210228224826624.png" alt="image-20210228224826624" style="zoom:50%;" />
<h4 id="返回"><a class="markdownIt-Anchor" href="#返回">#</a> 返回</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0040114B  \.  C3            retn</span><br></pre></td></tr></table></figure>
<h4 id="call返回后"><a class="markdownIt-Anchor" href="#call返回后">#</a> CALL 返回后</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0040112B  |.  83C4 0C       add     esp,0xC</span><br></pre></td></tr></table></figure>
<p>作用为平衡堆栈</p>
<p>注意 CALL 之前和 CALL 之后，其前后环境要一致，这就是所谓的<strong>堆栈平衡</strong></p>
<h4 id="堆栈平衡"><a class="markdownIt-Anchor" href="#堆栈平衡">#</a> 堆栈平衡</h4>
<p>如果通过堆栈传递参数了。那么在程序执行完毕后，要平衡因参数导致的堆栈变化</p>
<p>当我们使用堆栈传参的时候，在程序执行完毕后这些参数应该一起被清理掉，也就是加了几条参数，就要在堆栈中加几个地址，这么做可以理解为清理垃圾。</p>
<p>处理方法：</p>
<p>第一种 ：在函数外部添加 ADD 处理</p>
<p>第二种：在函数内部添加 ret8</p>
<h4 id="逆推c语言代码"><a class="markdownIt-Anchor" href="#逆推c语言代码">#</a> 逆推 C 语言代码</h4>
<p>根据我们前面的分析，我们不难发现这其实就是个简单的加法函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">void func(int m, int n) &#123;</span><br><span class="line">    int a, b;</span><br><span class="line">    a = m;</span><br><span class="line">    b = n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuNTJwb2ppZS5jbi90aHJlYWQtMTM3OTk1Mi0xLTEuaHRtbA==">逆向基础笔记七 堆栈图（重点） - 『软件调试区』 - 吾爱破解 - LCG - LSG | 安卓破解 | 病毒分析 | www.52pojie.cn</span></p>
<p>我们最后在总结一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">00401060 &gt;/&gt; \55            push    ebp</span><br><span class="line">;现在到了一个新的函数，需要有自己的栈底，因此需要把上一个栈底保存起来，栈顶不用保存，因为栈顶是新函数的栈底</span><br><span class="line">00401061  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401063  |.  83EC 48       sub     esp,0x48</span><br><span class="line">;堆栈提升</span><br><span class="line">00401066  |.  53            push    ebx</span><br><span class="line">00401067  |.  56            push    esi</span><br><span class="line">00401068  |.  57            push    edi</span><br><span class="line">;保护现场，为了retn后回恢复</span><br><span class="line">00401069  |.  8D7D B8       lea     edi,[local.18]</span><br><span class="line">0040106C  |.  B9 12000000   mov     ecx,0x12</span><br><span class="line">00401071  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401076  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">;初始化堆栈，防止脏数据</span><br><span class="line">00401078  |.  C745 FC 03000&gt;mov     [local.1],0x3</span><br><span class="line">0040107F  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class="line">00401086  |.  8B45 F8       mov     eax,[local.2]</span><br><span class="line">00401089  |.  50            push    eax</span><br><span class="line">0040108A  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">0040108D  |.  51            push    ecx</span><br><span class="line">;形参压入栈中</span><br><span class="line">0040108E  |.  E8 72FFFFFF   call    00401005</span><br><span class="line">;调用add函数</span><br><span class="line">00401093  |.  83C4 08       add     esp,0x8</span><br><span class="line">;堆栈平衡，将esp带回call以前的位置，call之前push了两次，2*4=8</span><br><span class="line">00401096  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class="line">0040109B  |.  E8 30000000   call    printf                           ; \printf</span><br><span class="line">;嗲用printf函数，操作和上面调用add一样</span><br><span class="line">004010A0  |.  83C4 04       add     esp,0x4</span><br><span class="line">;堆栈平衡</span><br><span class="line">004010A3  |.  33C0          xor     eax,eax</span><br><span class="line">004010A5  |.  5F            pop     edi</span><br><span class="line">004010A6  |.  5E            pop     esi</span><br><span class="line">004010A7  |.  5B            pop     ebx</span><br><span class="line">;恢复现场</span><br><span class="line">004010A8  |.  83C4 48       add     esp,0x48</span><br><span class="line">004010AB  |.  3BEC          cmp     ebp,esp</span><br><span class="line">004010AD  |.  E8 9E000000   call    _chkesp</span><br><span class="line">004010B2  |.  8BE5          mov     esp,ebp</span><br><span class="line">004010B4  |.  5D            pop     ebp</span><br><span class="line">004010B5  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>分配堆栈向下减少。堆栈传递参数向上相加</p>
<h4 id="堆栈结构图重点"><a class="markdownIt-Anchor" href="#堆栈结构图重点">#</a> 堆栈结构图（重点）</h4>
<ol>
<li>调用 CALL 又可以分为六个部分：</li>
<li>提升堆栈</li>
<li>保护现场</li>
<li>初始化提升的堆栈</li>
<li>执行实际内容</li>
<li>恢复现场</li>
<li>返回</li>
</ol>
<h3 id="如何右键启动od"><a class="markdownIt-Anchor" href="#如何右键启动od">#</a> 如何右键启动 od</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108181646294.png" alt="image-20221108181646294"></p>
<p>通过以上方式右键启动 od</p>
<h3 id="标志寄存器"><a class="markdownIt-Anchor" href="#标志寄存器">#</a> 标志寄存器</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108181822816.png" alt="image-20221108181822816"></p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108193731856.png" alt="image-20221108193731856" style="zoom:80%;" />
<ol>
<li>进位标志 CF (Carry Flag)</li>
<li>奇偶标志 PF (Parity  Flag)</li>
<li>辅助进位标志 AF (Auxiliary  Carry Flag)</li>
<li>零标志 ZF (Zero  Flag)</li>
<li>符号标志 SF (Sign  Flag)</li>
<li>溢出标志 OF (Overflow  Flag)</li>
<li>方向标志 DF (Direction Flag)</li>
</ol>
<h4 id="进位标志cfcarry-flag"><a class="markdownIt-Anchor" href="#进位标志cfcarry-flag">#</a> 进位标志 CF (Carry Flag)</h4>
<p>如果运算结果的<strong>最高位</strong>产生了一个进位或借位，那么，其值为 1，否则其值为 0</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">		pushad   <span class="comment">//通用寄存器入栈</span></span><br><span class="line">		pushfd   <span class="comment">//标志寄存器入栈</span></span><br><span class="line">		mov al,<span class="number">0xff</span></span><br><span class="line">		add al,<span class="number">1</span> <span class="comment">//C,P,A,Z = 1</span></span><br><span class="line">		popad</span><br><span class="line">		popfd</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="奇偶标志pfparity-flag"><a class="markdownIt-Anchor" href="#奇偶标志pfparity-flag">#</a> 奇偶标志 PF (Parity Flag)</h4>
<p>奇偶标志 PF 用于反映运算结果中<strong>最低有效字节</strong>中 “1” 的个数的奇偶性，如果 “1” 的个数为偶数，则 PF 的值为 1，否则其值为 0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MOV AX,803</span><br><span class="line">ADD AX,1</span><br><span class="line">0x804: 0000 1000 0000 0100        总共2个1 ,PF应为1，但实际运行结果PF为0</span><br><span class="line">因为PF是根据最低有效字节来看，即804后面04的这部分</span><br></pre></td></tr></table></figure>
<h4 id="辅助进位标志afauxiliary-carry-flag"><a class="markdownIt-Anchor" href="#辅助进位标志afauxiliary-carry-flag">#</a> 辅助进位标志 AF (Auxiliary Carry Flag)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">在发生下列情况时，辅助进位标志AF的值被置为1，否则其值为0：</span><br><span class="line"></span><br><span class="line">在字操作时，发生低字节向高字节进位或借位时</span><br><span class="line">在字节操作时，发生低4位向高4位进位或借位时</span><br></pre></td></tr></table></figure>
<blockquote>
<p>AF 与<strong>数据宽度</strong>相关</p>
<p>32 位时 FFFF <strong>F</strong> FFF</p>
<p>16 位时 FF <strong>F</strong> F</p>
<p>8 位时 F <strong>F</strong></p>
<p>加黑的字体为 AF 标志位判断的位置，如果该位置要向前进位则 AF 为 1，否则为 0，和 CF 相似，不过判断的位置不同</p>
</blockquote>
<h4 id="零标志zfzero-flag"><a class="markdownIt-Anchor" href="#零标志zfzero-flag">#</a> 零标志 ZF (Zero Flag)</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">零标志ZF用来反映运算结果是否为0</span><br><span class="line">如果运算结果为0，则其值为1，否则其值为0</span><br><span class="line">作用：在判断运算结果是否为0时，可使用此标志位</span><br><span class="line">XOR EAX,EAX   //通过xor将eax清零，会改变zf标志位为1</span><br><span class="line">MOV EAX,0     //通过MOV将EAX赋值为0，非运算，不改变zf标志位</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="符号标志sfsign-flag"><a class="markdownIt-Anchor" href="#符号标志sfsign-flag">#</a> 符号标志 SF (Sign Flag)</h4>
<blockquote>
<p>符号标志 SF 用来反映运算结果的符号位，它与运算结果的最高位相同</p>
</blockquote>
<h4 id="溢出标志ofoverflow-flag"><a class="markdownIt-Anchor" href="#溢出标志ofoverflow-flag">#</a> 溢出标志 OF (Overflow Flag)</h4>
<blockquote>
<p>溢出标志 OF 用于反映有符号数加减运算所得结果是否溢出</p>
<p>进位标志表示<strong>无符号数</strong>运算结果是否超出范围.</p>
<p>溢出标志表示<strong>有符号数</strong>运算结果是否超出范围.</p>
<ul>
<li>正 + 正 = 正 如果结果是负数，则说明有溢出</li>
<li>负 + 负 = 负 如果结果是正数，则说明有溢出</li>
<li>正 + 负 永远都不会有溢出</li>
</ul>
<p>CPU 如何计算 OF</p>
<ul>
<li>符号位有进位</li>
<li>最高有效数值位向符号位产生的进位</li>
</ul>
<p>对于一个有符号数：如 0x80 和 0xC0</p>
<p>符号位有进位</p>
<p>0x80:<strong>1</strong> 000 0000</p>
<p>0xC0:<strong>1</strong> 100 0000</p>
<p>最高有效数值位向符号位产生的进位</p>
<p>0x80:1 <strong>0</strong> 00 0000</p>
<p>0xC0:1 <strong>1</strong> 00 0000</p>
<p>就是运算 0x80+0xc0</p>
<p>0x80:<strong>1</strong> <strong>0</strong> 00 0000</p>
<p>0xC0:<strong>1</strong> <strong>1</strong> 00 0000</p>
<p>符号位 1+1 有产生进位，于是符号位有进位为 1</p>
<p>最高有效数值位向符号位产生的进位 0+1 没有产生进位，于是最高有效数值位向符号位产生的进位为 0</p>
<p><strong>OF = 符号位有进位 xor 最高有效数值位向符号位产生的进位</strong></p>
<p>OF = 1 xor 0 = 1 所以此时 OF=1</p>
</blockquote>
<h4 id="方向标志dfdirection-flag"><a class="markdownIt-Anchor" href="#方向标志dfdirection-flag">#</a> 方向标志 DF (Direction Flag)</h4>
<blockquote>
<p>DF=1 时串操作为减地址方式 DF=0 为增地址方式</p>
</blockquote>
<h3 id="相关汇编指令"><a class="markdownIt-Anchor" href="#相关汇编指令">#</a> 相关汇编指令</h3>
<blockquote>
<p>ADC 指令：带进位加法</p>
<p>SBB 指令：带借位减法</p>
<p>XCHG 指令：交换数据</p>
<p>格式：XCHG R/M,R/M 两边不能同时为内存  <strong>数据宽度</strong>要一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOV AL,1</span><br><span class="line">MOV CL,2</span><br><span class="line">XCHG AL,CL</span><br><span class="line">执行前：AL=1 CL=2</span><br><span class="line">执行后：AL=2 CL=1</span><br></pre></td></tr></table></figure>
<p>MOVS 指令：移动数据 内存 - 内存</p>
<p>MOVS 指令常用于复制字符串</p>
<p>可以将不同宽度的指令简写为 movsb movsw movsd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">MOV EDI,12FFD8</span><br><span class="line">MOV ESI,12FFD0</span><br><span class="line">MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI]</span><br><span class="line">EDI内存里的值被修改为ESI内存里的值，且EDI和ESI各加4,和DOWRD数据宽度相关，如果为WORD 则各加2</span><br><span class="line">由DF（Direction Flag）方向标志位决定，当DF位为1时为减，当DF位为0时，则为加</span><br></pre></td></tr></table></figure>
<p>movsx 操作数 A，操作数 B  符号扩展传送</p>
<p>movzx 零扩展传送</p>
<p>movsx，movzx 操作数 A 的空间必须大于操作数 b</p>
<p>如果大的给小的，会产生截断</p>
<p>STOS 指令</p>
<p>将 Al/AX/EAX 的值存储到 [EDI] 指定的内存单元，和<strong>数据宽度</strong>相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">STOS BYTE PTR ES:[EDI]                将AL存储到[EDI]</span><br><span class="line">STOS WORD PTR ES:[EDI]                将AX存储到[EDI]</span><br><span class="line">STOS DWORD PTR ES:[EDI]                将EAX存储到[EDI]</span><br><span class="line">注意这里使用的是ES</span><br><span class="line">当后面为[EDI]时要使用ES</span><br><span class="line">存储完数据后EDI地址的变化方向也受DF标志控制，1减0增</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">00401019  |.  8D7D C0       lea     edi,[local.16]</span><br><span class="line">0040101C  |.  B9 10000000   mov     ecx,0x10</span><br><span class="line">00401021  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401026  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">现在在看看这几行代码，先把eax的值变为cccccccc，stos将其存储到es中，通过rep循环存储</span><br></pre></td></tr></table></figure>
<p>REP 指令</p>
<p>按计数寄存器 (ECX) 中指定的次数重复执行指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MOV ECX,10</span><br><span class="line">REP MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI]        也可以写成REP MOVSD</span><br><span class="line">代码将会重复执行16次</span><br><span class="line">因为每执行一次EDI和ESI都会变化4，变化方向由DF决定</span><br></pre></td></tr></table></figure>
<p>LEA 指令</p>
<p>地址传送指令</p>
<p>将操作数 B 的有效地址传送到指定的某个寄存器，操作数 A 必须是寄存器</p>
</blockquote>
<h3 id="跳转和比较指令"><a class="markdownIt-Anchor" href="#跳转和比较指令">#</a> 跳转和比较指令</h3>
<h4 id="jcc指令"><a class="markdownIt-Anchor" href="#jcc指令">#</a> JCC 指令</h4>
<blockquote>
<p>cc 代表 condition code (状态码)</p>
<p>Jcc 不是单个指令，它只是描述了跳转之前检查条件代码的跳转助记符</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221031210918994.png" alt="image-20221031210918994" style="zoom: 50%;" />
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuY3MucHJpbmNldG9uLmVkdS9jb3Vyc2VzL2FyY2hpdmUvZmFsbDEyL2NvczM3NS9JQTMySmNjLnBkZg==">https://www.cs.princeton.edu/courses/archive/fall12/cos375/IA32Jcc.pdf</span></p>
<p>JCC 指令用于改变 EIP（CPU 要读取的指令地址）</p>
</blockquote>
<h4 id="jmp指令"><a class="markdownIt-Anchor" href="#jmp指令">#</a> JMP 指令</h4>
<p>JMP 指令：修改 EIP 的值</p>
<p>JMP 指令只影响了 EIP，不影响堆栈和其它通用寄存器</p>
<p>JMP 寄存器 / 立即数相当于 MOV EIP, 寄存器 / 立即数</p>
<h4 id="call指令"><a class="markdownIt-Anchor" href="#call指令">#</a> CALL 指令</h4>
<p>CALL 指令和 JMP 指令都会修改 EIP 的值</p>
<p>但 CALL 指令会将返回地址（CALL 指令的下一条指令地址）压入堆栈</p>
<p>因此也会引起 esp 的变化</p>
<h4 id="ret指令"><a class="markdownIt-Anchor" href="#ret指令">#</a> RET 指令</h4>
<p>call 调用跳转后执行完相关代码完要返回到 call 的下一条指令时使用 ret 指令</p>
<p>ret 指令相当于 pop eip</p>
<h4 id="cmp指令"><a class="markdownIt-Anchor" href="#cmp指令">#</a> CMP 指令</h4>
<p>指令格式：CMP R/M,R/M/IMM</p>
<p>CMP 指令只改变标志寄存器的值</p>
<p>该指令是比较两个操作数，实际上，它相当于 SUB 指令，但是相减的结果并不保存到第一个操作数中</p>
<p>只是根据相减的结果来改变 ZF 零标志位的，当两个操作数相等的时候，零标志位置 1</p>
<h4 id="test指令"><a class="markdownIt-Anchor" href="#test指令">#</a> TEST 指令</h4>
<p>指令格式：TEST R/M,R/M/IMM</p>
<p>该指令在一定程度上和 CMP 指令时类似的，两个数值进行与操作，结果不保存，但是会改变相应标志位</p>
<p>常见用法：用这个指令，可以确定某寄存器是否等于 0</p>
<p>观察 ZF（零标志位）就可以判断 EAX 是否为 0</p>
<h3 id="if指令编译结果"><a class="markdownIt-Anchor" href="#if指令编译结果">#</a> if 指令编译结果</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int a = 1;</span><br><span class="line">	if (a == 1) &#123;</span><br><span class="line">		printf(&quot;%d\n&quot;,11);</span><br><span class="line">	&#125;</span><br><span class="line">	else &#123;</span><br><span class="line">		printf(&quot;%d\n&quot;,22);</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">0040D440 &gt;/&gt; \55            push    ebp</span><br><span class="line">0040D441  |.  8BEC          mov     ebp,esp</span><br><span class="line">0040D443  |.  83EC 44       sub     esp,0x44</span><br><span class="line">0040D446  |.  53            push    ebx</span><br><span class="line">0040D447  |.  56            push    esi</span><br><span class="line">0040D448  |.  57            push    edi</span><br><span class="line">0040D449  |.  8D7D BC       lea     edi,[local.17]</span><br><span class="line">0040D44C  |.  B9 11000000   mov     ecx,0x11</span><br><span class="line">0040D451  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">0040D456  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">//上面都是堆栈提升，初始化堆栈，if从这里开始</span><br><span class="line"></span><br><span class="line">// a=1</span><br><span class="line">0040D458  |.  C745 FC 01000&gt;mov     dword ptr ss:[ebp-0x4],0x1</span><br><span class="line">// a==1?a=11:a=22</span><br><span class="line">// 如果a!=1 jmp 0040D476</span><br><span class="line">// 如果a!=1 printf(11) jmp(0040D485)</span><br><span class="line">// jmp(0040D485)就是跳转到if判断结束的地方，继续执行下面的语句</span><br><span class="line">0040D45F  |.  837D FC 01    cmp     dword ptr ss:[ebp-0x4],0x1</span><br><span class="line">0040D463  |.  75 11         jnz     short 0040D476</span><br><span class="line">0040D465  |.  6A 0B         push    0xB                              ; /&lt;%d&gt; = B (11.)</span><br><span class="line">0040D467  |.  68 0C214200   push    0042210C                         ; |format = &quot;%d</span><br><span class="line"></span><br><span class="line">0040D46C  |.  E8 4F020000   call    printf                           ; \printf</span><br><span class="line">0040D471  |.  83C4 08       add     esp,0x8</span><br><span class="line">0040D474  |.  EB 0F         jmp     short 0040D485</span><br><span class="line">0040D476  |&gt;  6A 16         push    0x16                             ; /&lt;%d&gt; = 16 (22.)</span><br><span class="line">0040D478  |.  68 0C214200   push    0042210C                         ; |format = &quot;%d</span><br><span class="line"></span><br><span class="line">0040D47D  |.  E8 3E020000   call    printf                           ; \printf</span><br><span class="line">0040D482  |.  83C4 08       add     esp,0x8</span><br><span class="line">0040D485  |&gt;  33C0          xor     eax,eax</span><br><span class="line">0040D487  |.  5F            pop     edi</span><br><span class="line">0040D488  |.  5E            pop     esi</span><br><span class="line">0040D489  |.  5B            pop     ebx</span><br><span class="line">0040D48A  |.  83C4 44       add     esp,0x44</span><br><span class="line">0040D48D  |.  3BEC          cmp     ebp,esp</span><br><span class="line">0040D48F  |.  E8 BC3BFFFF   call    _chkesp</span><br><span class="line">0040D494  |.  8BE5          mov     esp,ebp</span><br><span class="line">0040D496  |.  5D            pop     ebp</span><br><span class="line">0040D497  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="反汇编分析c语言"><a class="markdownIt-Anchor" href="#反汇编分析c语言">#</a> 反汇编分析 C 语言</h3>
<p>有了之前画堆栈图的经验，我们不难看出，尽管我们的函数是个空函数，但其汇编代码依然完成了以下流程：</p>
<ol>
<li>提升堆栈</li>
<li>保护现场</li>
<li>初始化提升的堆栈</li>
<li>恢复现场</li>
<li>返回</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">提升堆栈</span><br><span class="line"> 复制代码 隐藏代码</span><br><span class="line"><span class="number">00401010</span>   push        ebp</span><br><span class="line"><span class="number">00401011</span>   mov         ebp,esp</span><br><span class="line"><span class="number">00401013</span>   sub         esp,<span class="number">40</span>h</span><br><span class="line">保护现场</span><br><span class="line"> 复制代码 隐藏代码</span><br><span class="line"><span class="number">00401016</span>   push        ebx</span><br><span class="line"><span class="number">00401017</span>   push        esi</span><br><span class="line"><span class="number">00401018</span>   push        edi</span><br><span class="line">PS：前面的push        ebp也是保护现场</span><br><span class="line"></span><br><span class="line">初始化提升的堆栈</span><br><span class="line"> 复制代码 隐藏代码</span><br><span class="line"><span class="number">00401019</span>   lea         edi,[ebp<span class="number">-40</span>h]</span><br><span class="line"><span class="number">0040101</span>C   mov         ecx,<span class="number">10</span>h</span><br><span class="line"><span class="number">00401021</span>   mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">00401026</span>   rep stos    dword ptr [edi]</span><br><span class="line">恢复现场</span><br><span class="line"> 复制代码 隐藏代码</span><br><span class="line"><span class="number">00401028</span>   pop         edi</span><br><span class="line"><span class="number">00401029</span>   pop         esi</span><br><span class="line"><span class="number">0040102</span>A   pop         ebx</span><br><span class="line"><span class="number">0040102</span>B   mov         esp,ebp</span><br><span class="line"><span class="number">0040102</span>D   pop         ebp</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108201930358.png" alt="image-20221108201930358"></p>
<h3 id="内联汇编"><a class="markdownIt-Anchor" href="#内联汇编">#</a> 内联汇编</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">		pushad   <span class="comment">//通用寄存器入栈</span></span><br><span class="line">		pushfd   <span class="comment">//标志寄存器入栈</span></span><br><span class="line">		mov al,<span class="number">0xff</span></span><br><span class="line">		add al,<span class="number">1</span> <span class="comment">//C,P,A,Z = 1</span></span><br><span class="line">		popad</span><br><span class="line">		popfd</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用 VS2008 创建一个 win32 application</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108192317976.png" alt="image-20221108192317976"></p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1654239398565-0af1e19d-f2a4-4772-b49a-495dcdf19dca.png" alt="img"></p>
<p>使用多线程 /mt 之后，用户运行时不需要库既可运行，但文件会变大</p>
<p>编译一个内联函数</p>
<p>nake 声明一个裸函数，即堆栈的申请释放都需要我们自己进行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int __declspec (naked) Plus()&#123;</span><br><span class="line">                __asm&#123;</span><br><span class="line">						pushad</span><br><span class="line">						xor     eax,eax</span><br><span class="line">						cmp     byte ptr ds:[0x4F040],al</span><br><span class="line">						retn</span><br><span class="line">						popad</span><br><span class="line">        &#125;        </span><br><span class="line">&#125;</span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Plus();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Plus () 对应的汇编代码为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">00FC2240 &gt; &gt; \60            pushad</span><br><span class="line">00FC2241   .  33C0          xor     eax,eax</span><br><span class="line">00FC2243      61            popad                       </span><br></pre></td></tr></table></figure>
<p>正常的函数：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line"></span><br><span class="line">int Plus()</span><br><span class="line">&#123;</span><br><span class="line">	int x=1+2;</span><br><span class="line">	return 1;</span><br><span class="line">&#125;</span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Plus();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">003813A0 &gt;  55              push    ebp</span><br><span class="line">003813A1    8BEC            mov     ebp,esp</span><br><span class="line">003813A3    81EC CC000000   sub     esp,0xCC</span><br><span class="line">003813A9    53              push    ebx</span><br><span class="line">003813AA    56              push    esi</span><br><span class="line">003813AB    57              push    edi</span><br><span class="line">003813AC    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">003813B2    B9 33000000     mov     ecx,0x33</span><br><span class="line">003813B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">003813BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">003813BE    C745 F8 0300000&gt;mov     dword ptr ss:[ebp-0x8],0x3</span><br><span class="line">003813C5    B8 01000000     mov     eax,0x1</span><br><span class="line">003813CA    5F              pop     edi</span><br><span class="line">003813CB    5E              pop     esi</span><br><span class="line">003813CC    5B              pop     ebx</span><br><span class="line">003813CD    8BE5            mov     esp,ebp</span><br><span class="line">003813CF    5D              pop     ebp</span><br><span class="line">003813D0    C3              retn</span><br></pre></td></tr></table></figure>
<p>正常的函数系统会自动帮我们进行堆栈的操作我们只需要关系自己的代码即可</p>
<h3 id="寻找c程序入口"><a class="markdownIt-Anchor" href="#寻找c程序入口">#</a> 寻找 C 程序入口</h3>
<p>为什么能看到 wmain 的名称</p>
<p>因为有 pdb 文件，od 读取 pdb 读取 debug 信息</p>
<p>PDB 全称为程序数据库文件，存储了被编译文件的调试信息，一般用在调式程序中</p>
<p>1. 找到 wmainCRTStartup</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210348946.png" alt="image-20221108210348946"></p>
<p>2. 找到__tmainCRTStartup</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210432400.png" alt="image-20221108210432400"></p>
<p>3. 这个 call 002C108C 就是我们的 main 函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">002C260E   .  FF35 70F02D00 push    dword ptr ds:[__wargv]</span><br><span class="line">002C2614   .  FF35 68F02D00 push    dword ptr ds:[__argc]</span><br><span class="line">002C261A   .  E8 6DEAFFFF   call    002C108C</span><br></pre></td></tr></table></figure>
<p>4.wmain 就是我们的 main 函数</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210639094.png" alt="image-20221108210639094"></p>
<blockquote>
<p>mainCRTStartup 和 wmainCRTStartup 是控制台环境下多字节编码和 Unicode 编码的启动函数</p>
<p>而 WinMainCRTStartup 和 wWinMainCRTStartup 是 windows 环境下多字节编码和 Unicode 编码的启动函数</p>
<p>mainCRTStartup 做了哪些事：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210737730.png" alt="image-20221108210737730"></p>
<ol>
<li>前面我们已经知道了 mainCRTStartup 也就是程序入口，那么如何通过 mainCRTStartup 来找到 main 函数入口</li>
<li>根据函数的参数来进行判断</li>
<li>main 函数貌似只有两个参数，但实际上 main 函数一共有三个参数，只不过一般第三个参数我们并没有用到，于是在使用 main 函数时并没有加上，完整的 main 函数原型如下:</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc,char *argv[],char *envp[])&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>这里的 argv 和 envp 对应 mainCRTStartup 里_setargv () 和_setenvp ()</p>
<p>main 中参数</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210850705.png" alt="image-20221108210850705"></p>
</blockquote>
<p>另一种歪门邪道：</p>
<p>找一个有标示性的断点</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221111213357060.png" alt="image-20221111213357060"></p>
<p>下断，跳转到断点，F9 执行到断点</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221111213436905.png" alt="image-20221111213436905"></p>
<p>在堆栈窗口中选中，enter 建进入 main</p>
<p>或者在有 printf 或者 MessageBox 时可以 F9   CTRL+F9</p>
<h3 id="调试方式"><a class="markdownIt-Anchor" href="#调试方式">#</a> 调试方式</h3>
<p>1.OD 直接打开</p>
<p>2. 附加到已经打开的进程</p>
<h3 id="od常用操作"><a class="markdownIt-Anchor" href="#od常用操作">#</a> OD 常用操作</h3>
<p>F9 程序运行到所设断点处</p>
<p>F2 设置软件断点</p>
<p>ALT+C 初始页面</p>
<p>bp  指令地址    设置软件断点</p>
<p>bc 清除断点</p>
<p>dd ecx / 内存地址  查看 ecx 寄存器，寄存器中值 以双字显示</p>
<p>dw 以字显示</p>
<p>db 以字节显示</p>
<p>dc 以字符串显示数据</p>
<p>? 计算表达式</p>
<p>F8 单步步过</p>
<p>F7 单步步入</p>
<p>CTRL + F9  执行到返回</p>
<p>ALT + F9 执行到用户代码</p>
<p>CTRL+F2 重新开始</p>
<p>转到地址 Ctrl +G</p>
<p>断点窗口 Alt +B</p>
<p><code>-</code>  到上一步</p>
<p><code>* </code> 转到当前指令地址</p>
<p><code>+</code>  转到下一步</p>
<p>选中汇编，按空格，输入汇编代码</p>
<h3 id="函数调用"><a class="markdownIt-Anchor" href="#函数调用">#</a> 函数调用</h3>
<p>注意先关闭 c/c++ 优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">int add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">	return a+b;</span><br><span class="line">&#125;</span><br><span class="line">int aaa=1;</span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	MessageBox(0,NULL,NULL,MB_OK);</span><br><span class="line">	aaa = add(3,4);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="release"><a class="markdownIt-Anchor" href="#release">#</a> release</h4>
<p>优化的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00371000 &gt;/$  6A 00         push    0x0                              ; /Style = MB_OK|MB_APPLMODAL</span><br><span class="line">00371002  |.  6A 00         push    0x0                              ; |Title = NULL</span><br><span class="line">00371004  |.  6A 00         push    0x0                              ; |Text = NULL</span><br><span class="line">00371006  |.  6A 00         push    0x0                              ; |hOwner = NULL</span><br><span class="line">00371008  |.  FF15 A4203700 call    dword ptr ds:[&lt;&amp;USER32.MessageBo&gt;; \MessageBoxW</span><br><span class="line">0037100E  |.  C705 18303700&gt;mov     dword ptr ds:[aaa],0x7</span><br><span class="line">00371018  |.  33C0          xor     eax,eax</span><br><span class="line">0037101A  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>未被优化的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">012B1010 &gt;/$  55            push    ebp</span><br><span class="line">012B1011  |.  8BEC          mov     ebp,esp</span><br><span class="line">012B1013  |.  6A 00         push    0x0                                            ; /Style = MB_OK|MB_APPLMODAL</span><br><span class="line">012B1015  |.  6A 00         push    0x0                                            ; |Title = NULL</span><br><span class="line">012B1017  |.  6A 00         push    0x0                                            ; |Text = NULL</span><br><span class="line">012B1019  |.  6A 00         push    0x0                                            ; |hOwner = NULL</span><br><span class="line">012B101B  |.  FF15 E4802B01 call    dword ptr ds:[&lt;&amp;USER32.MessageBoxW&gt;]           ; \MessageBoxW</span><br><span class="line">012B1021  |.  6A 04         push    0x4</span><br><span class="line">012B1023  |.  6A 03         push    0x3</span><br><span class="line">012B1025  |.  E8 D6FFFFFF   call    add</span><br><span class="line">012B102A  |.  83C4 08       add     esp,0x8</span><br><span class="line">012B102D  |.  A3 40AC2B01   mov     dword ptr ds:[aaa],eax</span><br><span class="line">012B1032  |.  33C0          xor     eax,eax</span><br><span class="line">012B1034  |.  5D            pop     ebp</span><br><span class="line">012B1035  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>如果我们此时将代码改为如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">int add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">	return a+b;</span><br><span class="line">&#125;</span><br><span class="line">int aaa=1;</span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	MessageBox(0,NULL,NULL,MB_OK);</span><br><span class="line">	aaa = add(aaa,4);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">00EB13F0 &gt;  55              push    ebp</span><br><span class="line">00EB13F1    8BEC            mov     ebp,esp</span><br><span class="line">00EB13F3    81EC C0000000   sub     esp,0xC0</span><br><span class="line">00EB13F9    53              push    ebx</span><br><span class="line">00EB13FA    56              push    esi</span><br><span class="line">00EB13FB    57              push    edi</span><br><span class="line">00EB13FC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class="line">00EB1402    B9 30000000     mov     ecx,0x30</span><br><span class="line">00EB1407    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00EB140C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00EB140E    8BF4            mov     esi,esp</span><br><span class="line">00EB1410    6A 00           push    0x0</span><br><span class="line">00EB1412    6A 00           push    0x0</span><br><span class="line">00EB1414    6A 00           push    0x0</span><br><span class="line">00EB1416    6A 00           push    0x0</span><br><span class="line">00EB1418    FF15 3883EB00   call    dword ptr ds:[&lt;&amp;USER32.MessageBoxW&gt;]    ; user32.MessageBoxW</span><br><span class="line">00EB141E    3BF4            cmp     esi,esp</span><br><span class="line">00EB1420    E8 25FDFFFF     call    00EB114A</span><br><span class="line">00EB1425    6A 04           push    0x4</span><br><span class="line">00EB1427    A1 0070EB00     mov     eax,dword ptr ds:[aaa]</span><br><span class="line">00EB142C    50              push    eax</span><br><span class="line">00EB142D    E8 69FCFFFF     call    00EB109B</span><br><span class="line">00EB1432    83C4 08         add     esp,0x8</span><br><span class="line">00EB1435    A3 0070EB00     mov     dword ptr ds:[aaa],eax</span><br><span class="line">00EB143A    33C0            xor     eax,eax</span><br><span class="line">00EB143C    5F              pop     edi</span><br><span class="line">00EB143D    5E              pop     esi</span><br><span class="line">00EB143E    5B              pop     ebx</span><br><span class="line">00EB143F    81C4 C0000000   add     esp,0xC0</span><br><span class="line">00EB1445    3BEC            cmp     ebp,esp</span><br><span class="line">00EB1447    E8 FEFCFFFF     call    00EB114A</span><br><span class="line">00EB144C    8BE5            mov     esp,ebp</span><br><span class="line">00EB144E    5D              pop     ebp</span><br><span class="line">00EB144F    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">00EB13B0 &gt;  55              push    ebp</span><br><span class="line">00EB13B1    8BEC            mov     ebp,esp</span><br><span class="line">00EB13B3    81EC C0000000   sub     esp,0xC0</span><br><span class="line">00EB13B9    53              push    ebx</span><br><span class="line">00EB13BA    56              push    esi</span><br><span class="line">00EB13BB    57              push    edi</span><br><span class="line">00EB13BC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class="line">00EB13C2    B9 30000000     mov     ecx,0x30</span><br><span class="line">00EB13C7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00EB13CC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00EB13CE    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">00EB13D1    0345 0C         add     eax,dword ptr ss:[ebp+0xC]</span><br><span class="line">00EB13D4    5F              pop     edi                                     ; 0038FB84</span><br><span class="line">00EB13D5    5E              pop     esi</span><br><span class="line">00EB13D6    5B              pop     ebx</span><br><span class="line">00EB13D7    8BE5            mov     esp,ebp</span><br><span class="line">00EB13D9    5D              pop     ebp</span><br><span class="line">00EB13DA    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="进制与内存单元长度修饰"><a class="markdownIt-Anchor" href="#进制与内存单元长度修饰">#</a> 进制与内存单元长度修饰</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add [ebx],0x333</span><br><span class="line">然在实际汇编出来： add byte ptr [ebx], 33</span><br><span class="line"></span><br><span class="line">eax是双字</span><br><span class="line">内存单元访问，默认byte</span><br><span class="line">因此会截断</span><br></pre></td></tr></table></figure>
<h3 id="补充"><a class="markdownIt-Anchor" href="#补充">#</a> 补充</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">int a = 0x109     //a = local.1</span><br><span class="line">int b = 8         //b = local.2</span><br><span class="line"></span><br><span class="line">sub 会影响zf</span><br><span class="line"></span><br><span class="line">je/jz 如果zf=1跳转</span><br><span class="line">jne/jnz</span><br><span class="line"></span><br><span class="line">__asm &#123;</span><br><span class="line">	mob eax,3</span><br><span class="line">	sub eax,a</span><br><span class="line">	jz end</span><br><span class="line">end:</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">无符号JL/JNGE  小于/不大于等于跳转 根据sf，of跳转</span><br><span class="line">有符号JNG/JLE  不大于/小于等于  sf=1||zf=1|||OF=1      ZF=1 || sf!=of</span><br><span class="line">有符号JG/JNLE  大于/不小于等于   ZF=0 &amp;&amp; SF=OF</span><br><span class="line">无符号JA/JG  无符号大于</span><br><span class="line">无符号JBE/JNA 小于等于/大于</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221115213554357.png" alt="image-20221115213554357"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221115213632575.png" alt="image-20221115213632575"></p>
<blockquote>
<p>EBP 栈底指针 base pointer</p>
<p>ESP 栈顶指针</p>
<p>EBP  -/+ 偏移量可以访问 call 里的局部变量</p>
<p>ESP 栈顶指针与 EBP 构成了一段空间，一般就是本 call 局部变量的空间大小总和</p>
<p>空函数中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push ebp   //保存上一个函数的栈底，上一个函数的栈顶就是新的ebp，即原来的esp</span><br><span class="line">mov ebp,esp  //确定新的栈底</span><br><span class="line">pop ebp</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116195359372.png" alt="image-20221116195359372"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116200409461.png" alt="image-20221116200409461"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int a = 3</span><br><span class="line">int b = 5</span><br><span class="line">char c = 1</span><br><span class="line"></span><br><span class="line">char s[17]  //如果微软编译器可能会多分配几个字节防止数组越界导致程序崩溃</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sub esp,0C   //0c因为内存对齐</span><br><span class="line">mov dword ptr [local.1],3   //local.1 == ebp-4</span><br><span class="line">mov dword ptr [local.2],5   //local.2 == ebp-4</span><br><span class="line">mov byte ptr [local.3+3],1 //local.3 == ebp+3   //因为只使用了一个字节，从顶往下减少三个</span><br><span class="line">mov esp,ebp</span><br><span class="line">pop ebp</span><br><span class="line">ret</span><br></pre></td></tr></table></figure>
<p>每个 call 分配独立的栈段空间，供局部变量使用</p>
<p>call 平衡，pop 后 ebp 和 esp 不变</p>
<p>栈的上面小，下面大</p>
<p>push ebp      //sub esp,4  mov esp,[ebp]</p>
<p>pop ebp       //mov ebp,[esp] add esp,4</p>
<p>参数入栈又右向左入栈</p>
<p>ecx 放 this 指针，eax 放返回值</p>
<p>call 执行 push eIP</p>
<p>retn pop eip</p>
<p>32 位内存中，EIP (32 位) 已经能表达所有内存地址。而 16 位系统中的内存地址是 20 位，所以需要 IP 和 CS 同时入栈</p>
<p><strong>参数局部变量的表示   [EBP - x] 本 call 中的局部变量      [EBP+x] 上一个 call 的局部变量作为传入参数</strong></p>
<p>[ebp +4] 是父函数 EBP 的值，[EBP+8] 大概率是外部传进来的参数值</p>
<p>调用约定：</p>
<p>​	__cdecl 是 c declaration 缩写，所有参数从右到左依次入栈，这些参数由调用者清除，称为手动清栈，即清栈是在 call 后面   call 0010000h   add esp+x   VC 默认约定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl add(int a, int b)</span><br></pre></td></tr></table></figure>
<p>​	__stdcall api 函数调用约定，是 c++ 标准调用方式，所有参数从右到左依次入栈，如果调用类成员，最后一个入栈的是 this 指针，这些堆栈由被调用者在返回后清除，retx，x 代表参数占用字节数，cpu 在 ret 之后自动弹出 x 个栈空间，称为自动清栈</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int __stdcall add2(int a, int b)</span><br></pre></td></tr></table></figure>
<p>​	__fastcall 调用约定，是编译器指定的快速调用方式。fastcall 规定将前两个 (若干个参数由寄存器传递，其余参数通过堆栈传递)，返回方式和 stdcall 一样，如果只有两个参数，不用栈，不需要堆栈平衡，如果有很多参数，还需要用堆栈平衡部分堆栈</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int __fastcall add3(int a, int b)</span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116223933037.png" alt="image-20221116223933037" style="zoom: 67%;" />
<p>c 中不加默认说明为_cedcl 方式，c++ 也一样，默认调用方式可以在 ide 中设置</p>
<p>带有可变参数的函数必须使用_cdecl 方式，比如 printf (char *fmtstr, …) scanf</p>
</blockquote>
<h4 id="if-else"><a class="markdownIt-Anchor" href="#if-else">#</a> if-else</h4>
<blockquote>
<p><strong>if-else:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;haha&quot;);</span><br><span class="line">	int a=1, b=2;</span><br><span class="line">	if (a&gt;b)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;shabi&quot;);</span><br><span class="line">	&#125; else &#123;</span><br><span class="line">		printf(&quot;zhizhang&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>debug</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">00EF13A0 &gt;  55              push    ebp</span><br><span class="line">00EF13A1    8BEC            mov     ebp,esp</span><br><span class="line">00EF13A3    81EC D8000000   sub     esp,0xD8</span><br><span class="line">00EF13A9    53              push    ebx</span><br><span class="line">00EF13AA    56              push    esi</span><br><span class="line">00EF13AB    57              push    edi</span><br><span class="line">00EF13AC    8DBD 28FFFFFF   lea     edi,dword ptr ss:[ebp-0xD8]</span><br><span class="line">00EF13B2    B9 36000000     mov     ecx,0x36</span><br><span class="line">00EF13B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00EF13BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">//堆栈操作上面有写，自己看啊</span><br><span class="line"></span><br><span class="line">00EF13BE    8BF4            mov     esi,esp</span><br><span class="line">00EF13C0    68 5057EF00     push    00EF5750                              ; ASCII &quot;haha&quot;</span><br><span class="line">00EF13C5    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00EF13CB    83C4 04         add     esp,0x4</span><br><span class="line">//printf调用结束后保护现场，属于手动清栈</span><br><span class="line"></span><br><span class="line">00EF13CE    3BF4            cmp     esi,esp</span><br><span class="line">00EF13D0    E8 70FDFFFF     call    00EF1145</span><br><span class="line">//00EF1145   /E9 16030000     jmp     _RTC_CheckEsp</span><br><span class="line"></span><br><span class="line">00EF13D5    C745 F8 0100000&gt;mov     dword ptr ss:[ebp-0x8],0x1</span><br><span class="line">00EF13DC    C745 EC 0200000&gt;mov     dword ptr ss:[ebp-0x14],0x2</span><br><span class="line">//局部变量a,b入栈</span><br><span class="line"></span><br><span class="line">00EF13E3    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">00EF13E6    3B45 EC         cmp     eax,dword ptr ss:[ebp-0x14]</span><br><span class="line">比较a 和 b的大小</span><br><span class="line">00EF13E9    7E 19           jle     short 00EF1404</span><br><span class="line">00EF13EB    8BF4            mov     esi,esp</span><br><span class="line">00EF13ED    68 4857EF00     push    00EF5748                              ; ASCII &quot;shabi&quot;</span><br><span class="line">00EF13F2    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00EF13F8    83C4 04         add     esp,0x4</span><br><span class="line">00EF13FB    3BF4            cmp     esi,esp</span><br><span class="line">00EF13FD    E8 43FDFFFF     call    00EF1145</span><br><span class="line">00EF1402    EB 17           jmp     short 00EF141B</span><br><span class="line">00EF1404    8BF4            mov     esi,esp</span><br><span class="line">00EF1406    68 3C57EF00     push    00EF573C                              ; ASCII &quot;zhizhang&quot;</span><br><span class="line">00EF140B    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00EF1411    83C4 04         add     esp,0x4</span><br><span class="line">00EF1414    3BF4            cmp     esi,esp</span><br><span class="line">00EF1416    E8 2AFDFFFF     call    00EF1145</span><br><span class="line">00EF141B    33C0            xor     eax,eax</span><br><span class="line">00EF141D    5F              pop     edi</span><br><span class="line">00EF141E    5E              pop     esi</span><br><span class="line">00EF141F    5B              pop     ebx</span><br><span class="line">00EF1420    81C4 D8000000   add     esp,0xD8</span><br><span class="line">00EF1426    3BEC            cmp     ebp,esp</span><br><span class="line">00EF1428    E8 18FDFFFF     call    00EF1145</span><br><span class="line">00EF142D    8BE5            mov     esp,ebp</span><br><span class="line">00EF142F    5D              pop     ebp</span><br><span class="line">00EF1430    C3              retn</span><br></pre></td></tr></table></figure>
<p>release</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">000E1000 &gt;/$  56            push    esi</span><br><span class="line">000E1001  |.  8B35 A0200E00 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]    ;  msvcr90.printf</span><br><span class="line">000E1007  |.  68 F4200E00   push    000E20F4                                ; /format = &quot;haha&quot;</span><br><span class="line">000E100C  |.  FFD6          call    esi                                     ; \printf</span><br><span class="line">000E100E  |.  68 FC200E00   push    000E20FC                                ;  ASCII &quot;zhizhang&quot;</span><br><span class="line">000E1013  |.  FFD6          call    esi</span><br><span class="line">000E1015  |.  83C4 08       add     esp,0x8</span><br><span class="line">000E1018  |.  33C0          xor     eax,eax</span><br><span class="line">000E101A  |.  5E            pop     esi</span><br><span class="line">000E101B  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>OD 文件夹中有 UDD 作为缓存</p>
</blockquote>
<h4 id="switch-case"><a class="markdownIt-Anchor" href="#switch-case">#</a> switch case</h4>
<blockquote>
<p><strong>switch-case</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;haha&quot;);</span><br><span class="line">	int a=1, b=2;</span><br><span class="line">	switch(a)</span><br><span class="line">	&#123;</span><br><span class="line">	case 1:</span><br><span class="line">		printf(&quot;1111&quot;);</span><br><span class="line">		break;</span><br><span class="line">	case 2:</span><br><span class="line">		printf(&quot;2222&quot;);</span><br><span class="line">		break;</span><br><span class="line">	case 3:</span><br><span class="line">		printf(&quot;3333&quot;);</span><br><span class="line">		break;</span><br><span class="line">	default:</span><br><span class="line">		printf(&quot;shabi&quot;);</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">00FF13BE    8BF4            mov     esi,esp</span><br><span class="line">00FF13C0    <span class="number">68</span> 5C57FF00     push    00FF575C                                ; ASCII <span class="string">&quot;haha&quot;</span></span><br><span class="line">00FF13C5    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">00FF13CB    83C4 04         add     esp,<span class="number">0x4</span></span><br><span class="line">00FF13CE    3BF4            cmp     esi,esp</span><br><span class="line">00FF13D0    E8 70FDFFFF     call    00FF1145</span><br><span class="line"></span><br><span class="line">00FF13D5    C745 F8 <span class="number">0</span>100000&gt;mov     dword ptr ss:[ebp-<span class="number">0x8</span>],<span class="number">0x1</span></span><br><span class="line">00FF13DC    C745 EC 0200000&gt;mov     dword ptr ss:[ebp-<span class="number">0x14</span>],<span class="number">0x2</span></span><br><span class="line">//局部变量a,b入栈</span><br><span class="line">00FF13E3    8B45 F8         mov     eax,dword ptr ss:[ebp-<span class="number">0x8</span>]</span><br><span class="line">00FF13E6    <span class="number">8985</span> 24FFFFFF   mov     dword ptr ss:[ebp-<span class="number">0xDC</span>],eax</span><br><span class="line">//[ebp-<span class="number">0xdc</span>] = a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00FF13EC    83BD 24FFFFFF <span class="number">0</span>&gt;cmp     dword ptr ss:[ebp-<span class="number">0xDC</span>],<span class="number">0x1</span></span><br><span class="line">00FF13F3    <span class="number">74</span> <span class="number">14</span>           je      short 00FF1409</span><br><span class="line">00FF13F5    83BD 24FFFFFF <span class="number">0</span>&gt;cmp     dword ptr ss:[ebp-<span class="number">0xDC</span>],<span class="number">0x2</span></span><br><span class="line">00FF13FC    <span class="number">74</span> <span class="number">24</span>           je      short 00FF1422</span><br><span class="line">00FF13FE    83BD 24FFFFFF <span class="number">0</span>&gt;cmp     dword ptr ss:[ebp-<span class="number">0xDC</span>],<span class="number">0x3</span></span><br><span class="line">00FF1405    <span class="number">74</span> <span class="number">34</span>           je      short 00FF143B</span><br><span class="line">//比较a和<span class="keyword">case</span>中值，如果相等那么跳转</span><br><span class="line"></span><br><span class="line">00FF1407    EB 4B           jmp     short 00FF1454</span><br><span class="line">//<span class="keyword">case</span></span><br><span class="line"></span><br><span class="line">00FF1409    8BF4            mov     esi,esp</span><br><span class="line">00FF140B    <span class="number">68</span> 5457FF00     push    00FF5754                                ; ASCII <span class="string">&quot;1111&quot;</span></span><br><span class="line">00FF1410    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">00FF1416    83C4 04         add     esp,<span class="number">0x4</span></span><br><span class="line"></span><br><span class="line">00FF1419    3BF4            cmp     esi,esp</span><br><span class="line">00FF141B    E8 25FDFFFF     call    00FF1145</span><br><span class="line"></span><br><span class="line">00FF1420    EB <span class="number">49</span>           jmp     short 00FF146B</span><br><span class="line">//<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">00FF1422    8BF4            mov     esi,esp</span><br><span class="line">00FF1424    <span class="number">68</span> 4C57FF00     push    00FF574C                                ; ASCII <span class="string">&quot;2222&quot;</span></span><br><span class="line">00FF1429    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">00FF142F    83C4 04         add     esp,<span class="number">0x4</span></span><br><span class="line"></span><br><span class="line">00FF1432    3BF4            cmp     esi,esp</span><br><span class="line">00FF1434    E8 0CFDFFFF     call    00FF1145</span><br><span class="line"></span><br><span class="line">00FF1439    EB <span class="number">30</span>           jmp     short 00FF146B</span><br><span class="line"></span><br><span class="line">00FF143B    8BF4            mov     esi,esp</span><br><span class="line">00FF143D    <span class="number">68</span> 4457FF00     push    00FF5744                                ; ASCII <span class="string">&quot;3333&quot;</span></span><br><span class="line">00FF1442    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">00FF1448    83C4 04         add     esp,<span class="number">0x4</span></span><br><span class="line">00FF144B    3BF4            cmp     esi,esp</span><br><span class="line">00FF144D    E8 F3FCFFFF     call    00FF1145</span><br><span class="line">00FF1452    EB <span class="number">17</span>           jmp     short 00FF146B</span><br><span class="line">00FF1454    8BF4            mov     esi,esp</span><br><span class="line">00FF1456    <span class="number">68</span> 3C57FF00     push    00FF573C                                ; ASCII <span class="string">&quot;shabi&quot;</span></span><br><span class="line">00FF145B    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">00FF1461    83C4 04         add     esp,<span class="number">0x4</span></span><br><span class="line">00FF1464    3BF4            cmp     esi,esp</span><br><span class="line">00FF1466    E8 DAFCFFFF     call    00FF1145</span><br><span class="line"></span><br><span class="line">00FF146B    33C0            xor     eax,eax</span><br><span class="line">00FF146D    5F              pop     edi</span><br><span class="line">00FF146E    5E              pop     esi</span><br><span class="line">00FF146F    5B              pop     ebx</span><br><span class="line">00FF1470    81C4 DC000000   add     esp,<span class="number">0xDC</span></span><br><span class="line">00FF1476    3BEC            cmp     ebp,esp</span><br><span class="line">00FF1478    E8 C8FCFFFF     call    00FF1145</span><br><span class="line">00FF147D    8BE5            mov     esp,ebp</span><br><span class="line">00FF147F    5D              pop     ebp</span><br><span class="line">00FF1480    C3              retn</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>release</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">011C1000 &gt;/$  56            push    esi</span><br><span class="line">011C1001  |.  8B35 A0201C01 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]   ;  msvcr90.printf</span><br><span class="line">011C1007  |.  68 F4201C01   push    011C20F4                               ; /format = &quot;haha&quot;</span><br><span class="line">011C100C  |.  FFD6          call    esi                                    ; \printf</span><br><span class="line">011C100E  |.  68 FC201C01   push    011C20FC                               ;  ASCII &quot;1111&quot;</span><br><span class="line">011C1013  |.  FFD6          call    esi</span><br><span class="line">011C1015  |.  83C4 08       add     esp,0x8</span><br><span class="line">011C1018  |.  33C0          xor     eax,eax</span><br><span class="line">011C101A  |.  5E            pop     esi</span><br><span class="line">011C101B  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>如果 case 很多的时候，会使用导出表</p>
<p>用 case 最大的 - case 最小的，得出的范围称为 k，如果要判断的值 - case 最小的值不在范围 k 之内，直接 default</p>
<p>其实这样的，edx 存放的是 a 与 case 中最小值的差值，而 eax*4 + 地址存放的是每个 case 的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;haha&quot;);</span><br><span class="line">	int a=5;</span><br><span class="line">	switch(a)</span><br><span class="line">	&#123;</span><br><span class="line">	case 1:</span><br><span class="line">		printf(&quot;1&quot;);</span><br><span class="line">	case 5:</span><br><span class="line">		printf(&quot;5&quot;);</span><br><span class="line">	case 9:</span><br><span class="line">		printf(&quot;9&quot;);</span><br><span class="line">	case 2:</span><br><span class="line">		printf(&quot;2&quot;);</span><br><span class="line">	case 7:</span><br><span class="line">		printf(&quot;7&quot;);</span><br><span class="line">		break;</span><br><span class="line">	case 13:</span><br><span class="line">		printf(&quot;13&quot;);</span><br><span class="line">		break;</span><br><span class="line">	default:</span><br><span class="line">		printf(&quot;shabi&quot;);</span><br><span class="line">		break;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">00F713A0 &gt;  55              push    ebp</span><br><span class="line">00F713A1    8BEC            mov     ebp,esp</span><br><span class="line">00F713A3    81EC D0000000   sub     esp,0xD0</span><br><span class="line">00F713A9    53              push    ebx</span><br><span class="line">00F713AA    56              push    esi</span><br><span class="line">00F713AB    57              push    edi</span><br><span class="line">00F713AC    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class="line">00F713B2    B9 34000000     mov     ecx,0x34</span><br><span class="line">00F713B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00F713BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00F713BE    8BF4            mov     esi,esp</span><br><span class="line">00F713C0    68 5C57F700     push    00F7575C                              ; ASCII &quot;haha&quot;</span><br><span class="line">00F713C5    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F713CB    83C4 04         add     esp,0x4</span><br><span class="line">00F713CE    3BF4            cmp     esi,esp</span><br><span class="line">00F713D0    E8 70FDFFFF     call    00F71145</span><br><span class="line">00F713D5    C745 F8 0500000&gt;mov     dword ptr ss:[ebp-0x8],0x5            ; a = 5</span><br><span class="line">00F713DC    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">00F713DF    8985 30FFFFFF   mov     dword ptr ss:[ebp-0xD0],eax</span><br><span class="line">00F713E5    8B8D 30FFFFFF   mov     ecx,dword ptr ss:[ebp-0xD0]           ; ecx = eax = 5</span><br><span class="line">00F713EB    83E9 01         sub     ecx,0x1                               ; ecx = ecx - 1 计算a与case中最小值的差值</span><br><span class="line">00F713EE    898D 30FFFFFF   mov     dword ptr ss:[ebp-0xD0],ecx           ; [ebp-0x0d] = 4 4在13-1的范围之间</span><br><span class="line">00F713F4    83BD 30FFFFFF 0&gt;cmp     dword ptr ss:[ebp-0xD0],0xC           ; 将a 与case 中最小值的差1值和case最大最小差值12相比</span><br><span class="line">00F713FB    0F87 A2000000   ja      00F714A3                              ; 如果当前要比较的值和case最小值的差值&gt;12,直接default</span><br><span class="line">00F71401    8B95 30FFFFFF   mov     edx,dword ptr ss:[ebp-0xD0]           ; edx中存放的就是a与case最小值的差值 0xF714EC存放导出表地址</span><br><span class="line">00F71407    0FB682 EC14F700 movzx   eax,byte ptr ds:[edx+0xF714EC]        ; eax=2</span><br><span class="line">00F7140E    FF2485 D014F700 jmp     dword ptr ds:[eax*4+0xF714D0]         ; 2*4 + 0xF714D0</span><br><span class="line">00F71415    8BF4            mov     esi,esp</span><br><span class="line">00F71417    68 5857F700     push    00F75758                              ; UNICODE &quot;1&quot;</span><br><span class="line">00F7141C    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F71422    83C4 04         add     esp,0x4</span><br><span class="line">00F71425    3BF4            cmp     esi,esp</span><br><span class="line">00F71427    E8 19FDFFFF     call    00F71145</span><br><span class="line">00F7142C    8BF4            mov     esi,esp</span><br><span class="line">00F7142E    68 5457F700     push    00F75754                              ; UNICODE &quot;5&quot;</span><br><span class="line">00F71433    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F71439    83C4 04         add     esp,0x4</span><br><span class="line">00F7143C    3BF4            cmp     esi,esp</span><br><span class="line">00F7143E    E8 02FDFFFF     call    00F71145</span><br><span class="line">00F71443    8BF4            mov     esi,esp</span><br><span class="line">00F71445    68 5057F700     push    00F75750                              ; UNICODE &quot;9&quot;</span><br><span class="line">00F7144A    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F71450    83C4 04         add     esp,0x4</span><br><span class="line">00F71453    3BF4            cmp     esi,esp</span><br><span class="line">00F71455    E8 EBFCFFFF     call    00F71145</span><br><span class="line">00F7145A    8BF4            mov     esi,esp</span><br><span class="line">00F7145C    68 4C57F700     push    00F7574C                              ; UNICODE &quot;2&quot;</span><br><span class="line">00F71461    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F71467    83C4 04         add     esp,0x4</span><br><span class="line">00F7146A    3BF4            cmp     esi,esp</span><br><span class="line">00F7146C    E8 D4FCFFFF     call    00F71145</span><br><span class="line">00F71471    8BF4            mov     esi,esp</span><br><span class="line">00F71473    68 4857F700     push    00F75748                              ; UNICODE &quot;7&quot;</span><br><span class="line">00F71478    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F7147E    83C4 04         add     esp,0x4</span><br><span class="line">00F71481    3BF4            cmp     esi,esp</span><br><span class="line">00F71483    E8 BDFCFFFF     call    00F71145</span><br><span class="line">00F71488    EB 30           jmp     short printf</span><br><span class="line">00F7148A    8BF4            mov     esi,esp</span><br><span class="line">00F7148C    68 4457F700     push    00F75744                              ; ASCII &quot;13&quot;</span><br><span class="line">00F71491    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F71497    83C4 04         add     esp,0x4</span><br><span class="line">00F7149A    3BF4            cmp     esi,esp</span><br><span class="line">00F7149C    E8 A4FCFFFF     call    00F71145</span><br><span class="line">00F714A1    EB 17           jmp     short printf</span><br><span class="line">00F714A3    8BF4            mov     esi,esp</span><br><span class="line">00F714A5    68 3C57F700     push    00F7573C                              ; ASCII &quot;shabi&quot;</span><br><span class="line">00F714AA    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">00F714B0    83C4 04         add     esp,0x4</span><br><span class="line">00F714B3    3BF4            cmp     esi,esp</span><br><span class="line">00F714B5    E8 8BFCFFFF     call    00F71145</span><br><span class="line">00F714BA &gt;  33C0            xor     eax,eax</span><br><span class="line">00F714BC    5F              pop     edi</span><br><span class="line">00F714BD    5E              pop     esi</span><br><span class="line">00F714BE    5B              pop     ebx</span><br><span class="line">00F714BF    81C4 D0000000   add     esp,0xD0</span><br><span class="line">00F714C5    3BEC            cmp     ebp,esp</span><br><span class="line">00F714C7    E8 79FCFFFF     call    00F71145</span><br><span class="line">00F714CC    8BE5            mov     esp,ebp</span><br><span class="line">00F714CE    5D              pop     ebp</span><br><span class="line">00F714CF    C3              retn</span><br><span class="line">	</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果 a=9, 9-1=8<br>
db 8+0xF714EC   ==  4      db 8+0xF714EC</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102654407.png" alt="image-20221119102654407"><a href=""></a></p>
<p>dd 4 * 4 + 0xF714D0 ==</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102748365.png" alt="image-20221119102748365">\</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102822429.png" alt="image-20221119102822429">`</p>
<p>也就是说 F714EC 中存放的就是导出表</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119103208537.png" alt="image-20221119103208537">·</p>
</blockquote>
</blockquote>
<h4 id="for"><a class="markdownIt-Anchor" href="#for">#</a> for</h4>
<blockquote>
<p>for 循环</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i=1;i&lt;=10;++i) &#123;</span><br><span class="line">	printf(&quot;%d&quot;,i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>debug，禁止优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">013013BE    C745 F8 0100000&gt;mov     dword ptr ss:[ebp-0x8],0x1</span><br><span class="line">013013C5    EB 09           jmp     short 013013D0</span><br><span class="line">013013C7    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">013013CA    83C0 01         add     eax,0x1</span><br><span class="line">013013CD    8945 F8         mov     dword ptr ss:[ebp-0x8],eax</span><br><span class="line">013013D0    837D F8 0A      cmp     dword ptr ss:[ebp-0x8],0xA</span><br><span class="line">013013D4    7F 1D           jg      short 013013F3</span><br><span class="line">013013D6    8BF4            mov     esi,esp</span><br><span class="line">013013D8    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">013013DB    50              push    eax</span><br><span class="line">013013DC    68 3C573001     push    0130573C                                ; ASCII &quot;%d&quot;</span><br><span class="line">013013E1    FF15 BC823001   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class="line">013013E7    83C4 08         add     esp,0x8</span><br><span class="line">013013EA    3BF4            cmp     esi,esp</span><br><span class="line">013013EC    E8 54FDFFFF     call    01301145</span><br><span class="line">013013F1  ^ EB D4           jmp     short 013013C7</span><br><span class="line">013013F3    33C0            xor     eax,eax    								;eax清零，作为返回值</span><br><span class="line">013013F5    5F              pop     edi</span><br><span class="line">013013F6    5E              pop     esi</span><br><span class="line">013013F7    5B              pop     ebx</span><br><span class="line">013013F8    81C4 CC000000   add     esp,0xCC</span><br><span class="line">013013FE    3BEC            cmp     ebp,esp</span><br><span class="line">01301400    E8 40FDFFFF     call    01301145</span><br><span class="line">01301405    8BE5            mov     esp,ebp</span><br><span class="line">01301407    5D              pop     ebp                              </span><br><span class="line">01301408    C3              retn</span><br></pre></td></tr></table></figure>
<p>release，O/2 优化</p>
<p>最大化速度优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">00361000 &gt;/$  56            push    esi</span><br><span class="line">00361001  |.  68 84B33600   push    0036B384                              ; /format = &quot;shabi&quot;</span><br><span class="line">00361006  |.  E8 2F000000   call    printf                                ; \printf</span><br><span class="line">0036100B  |.  83C4 04       add     esp,0x4</span><br><span class="line">0036100E  |.  BE 01000000   mov     esi,0x1</span><br><span class="line">00361013  |&gt;  56            /push    esi                                  ; /&lt;%d&gt;</span><br><span class="line">00361014  |.  68 8CB33600   |push    0036B38C                             ; |format = &quot;%d&quot;</span><br><span class="line">00361019  |.  E8 1C000000   |call    printf                               ; \printf</span><br><span class="line">0036101E  |.  46            |inc     esi</span><br><span class="line">0036101F  |.  83C4 08       |add     esp,0x8</span><br><span class="line">00361022  |.  83FE 0A       |cmp     esi,0xA</span><br><span class="line">00361025  |.^ 7E EC         \jle     short 00361013</span><br><span class="line">00361027  |.  33C0          xor     eax,eax</span><br><span class="line">00361029  |.  5E            pop     esi</span><br><span class="line">0036102A  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>release，O/1 优化</p>
<p>大小最小化优化情况下，for</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">01161000 &gt;/$  56            push    esi</span><br><span class="line">01161001  |.  57            push    edi										 ; 保护edi</span><br><span class="line">01161002  |.  8B3D A0201601 mov     edi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]     ;  printf给edi，调用时直接call edi，用寄存器代替内存</span><br><span class="line">01161008  |.  68 F4201601   push    011620F4                                 ; /format = &quot;shabi&quot;，printf参数入栈</span><br><span class="line">0116100D  |.  FFD7          call    edi                                      ; call printf</span><br><span class="line">0116100F  |.  33F6          xor     esi,esi									 ; esi = 0</span><br><span class="line">01161011  |.  59            pop     ecx										 ; 堆栈平衡，可以理解为esp+4</span><br><span class="line">01161012  |.  46            inc     esi</span><br><span class="line"></span><br><span class="line">//循环代码段</span><br><span class="line">01161013  |&gt;  56            /push    esi									 ; i 入栈</span><br><span class="line">01161014  |.  68 FC201601   |push    011620FC                                ;  ASCII &quot;%d&quot;入栈</span><br><span class="line">01161019  |.  FFD7          |call    edi									 ; call printf 编译器判断第一次可以执行，直接优化</span><br><span class="line">0116101B  |.  46            |inc     esi</span><br><span class="line">0116101C &gt;|.  83FE 0A       |cmp     esi,0xA</span><br><span class="line">0116101F  |.  59            |pop     ecx</span><br><span class="line">01161020  |.  59            |pop     ecx 									 ; 两次pop堆栈平衡 esp+8</span><br><span class="line">01161021  |.^ 7E F0         \jle     short 01161013</span><br><span class="line"></span><br><span class="line">01161023  |.  5F            pop     edi</span><br><span class="line">01161024  |.  33C0          xor     eax,eax</span><br><span class="line">01161026 &gt;|.  5E            pop     esi</span><br><span class="line">01161027  \.  C3            retn</span><br><span class="line"></span><br><span class="line">//inc 一个字节，pop edi一个字节，</span><br><span class="line">//add 三个字节，</span><br></pre></td></tr></table></figure>
<p>release，关闭优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">00191000 &gt; $  55            push    ebp</span><br><span class="line">00191001   .  8BEC          mov     ebp,esp</span><br><span class="line">00191003   .  51            push    ecx</span><br><span class="line">//这个ecx在最后没有出栈，所以不是用来保护的，而是用来分配堆栈空间的</span><br><span class="line"></span><br><span class="line">00191004   .  C745 FC 01000&gt;mov     dword ptr ss:[ebp-0x4],0x1</span><br><span class="line">0019100B   .  EB 09         jmp     short 00191016</span><br><span class="line">0019100D   &gt;  8B45 FC       mov     eax,dword ptr ss:[ebp-0x4]</span><br><span class="line">00191010   .  83C0 01       add     eax,0x1</span><br><span class="line">00191013   .  8945 FC       mov     dword ptr ss:[ebp-0x4],eax</span><br><span class="line">00191016   &gt;  837D FC 0A    cmp     dword ptr ss:[ebp-0x4],0xA</span><br><span class="line">0019101A   .  7F 14         jg      short 00191030</span><br><span class="line">0019101C   .  8B4D FC       mov     ecx,dword ptr ss:[ebp-0x4]</span><br><span class="line">0019101F   .  51            push    ecx         					 ;  根据从右到左的入栈数据，i先入栈，%d后入</span><br><span class="line">00191020   .  68 F4201900   push    001920F4                         ;  ASCII &quot;%d&quot;</span><br><span class="line">00191025      FF            db      FF</span><br><span class="line">00191026 &gt; .  15 A0201900   adc     eax,&lt;&amp;MSVCR90.printf&gt;</span><br><span class="line">0019102B   .  83C4 08       add     esp,0x8  						 ;  printf有两个参数，因此堆栈平衡时需要+8</span><br><span class="line">0019102E   .^ EB DD         jmp     short 0019100D</span><br><span class="line">00191030   &gt;  33C0          xor     eax,eax							 ;  eax作为函数返回值，此处将eax清零</span><br><span class="line">00191032   .  8BE5          mov     esp,ebp</span><br><span class="line">00191034   .  5D            pop     ebp</span><br><span class="line">00191035 &gt; .  C3            retn</span><br></pre></td></tr></table></figure>
<p>release，完全优化 / Ox</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">010E1000 &gt;/$  56            push    esi</span><br><span class="line">010E1001  |.  68 84B30E01   push    010EB384                         ; /format = &quot;shabi&quot;</span><br><span class="line">010E1006  |.  E8 2F000000   call    printf                           ; \printf</span><br><span class="line">010E100B  |.  83C4 04       add     esp,0x4</span><br><span class="line">010E100E  |.  BE 01000000   mov     esi,0x1</span><br><span class="line">010E1013  |&gt;  56            /push    esi                             ; /&lt;%d&gt;</span><br><span class="line">010E1014  |.  68 8CB30E01   |push    010EB38C                        ; |format = &quot;%d&quot;</span><br><span class="line">010E1019  |.  E8 1C000000   |call    printf                          ; \printf</span><br><span class="line">010E101E  |.  46            |inc     esi</span><br><span class="line">010E101F  |.  83C4 08       |add     esp,0x8</span><br><span class="line">010E1022  |.  83FE 0A       |cmp     esi,0xA</span><br><span class="line">010E1025  |.^ 7E EC         \jle     short 010E1013</span><br><span class="line">010E1027  |.  33C0          xor     eax,eax</span><br><span class="line">010E1029  |.  5E            pop     esi</span><br><span class="line">010E102A  \.  C3            retn</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id=""><a class="markdownIt-Anchor" href="#">#</a> ++ –</h4>
<blockquote>
<p>inc a  //i++  ++i  速度比 add 快，占用空间小，指令执行影响 AS，OF，PF，SF，ZF 标志位，不影响 CF</p>
<p>dec a</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">010E100B  |.  83C4 04       add     esp,0x4</span><br><span class="line">01161012  |.  46            inc     esi</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	int i=0;</span><br><span class="line">	i++;</span><br><span class="line">	i--;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">003A1000 &gt;/$  55            push    ebp</span><br><span class="line">003A1001  |.  8BEC          mov     ebp,esp</span><br><span class="line">003A1003  |.  51            push    ecx</span><br><span class="line">003A1004  |.  68 F4203A00   push    003A20F4                         ; /format = &quot;shabi&quot;</span><br><span class="line">003A1009  |.  FF15 A0203A00 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \printf</span><br><span class="line">003A100F  |.  83C4 04       add     esp,0x4</span><br><span class="line">003A1012  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class="line">003A1019  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">003A101C  |.  83C0 01       add     eax,0x1</span><br><span class="line">003A101F  |.  8945 FC       mov     [local.1],eax</span><br><span class="line">003A1022  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">003A1025  |.  83E9 01       sub     ecx,0x1</span><br><span class="line">003A1028  |.  894D FC       mov     [local.1],ecx</span><br><span class="line">003A102B  |.  33C0          xor     eax,eax</span><br><span class="line">003A102D  |.  8BE5          mov     esp,ebp</span><br><span class="line">003A102F  |.  5D            pop     ebp</span><br><span class="line">003A1030  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>速度最大化的时候因为 i 没有实际用途，所以直接返回</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">01251000 &gt;/$  68 F4202501   push    012520F4                         ; /format = &quot;shabi&quot;</span><br><span class="line">01251005  |.  FF15 A0202501 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \printf</span><br><span class="line">0125100B  |.  83C4 04       add     esp,0x4</span><br><span class="line">0125100E  |.  33C0          xor     eax,eax</span><br><span class="line">01251010  \.  C3            retn</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">01201000 &gt;/$  56            push    esi</span><br><span class="line">01201001  |.  8B35 A0202001 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]   ;  msvcr90.printf</span><br><span class="line">01201007  |.  68 F4202001   push    012020F4                               ; /format = &quot;shabi&quot;</span><br><span class="line">0120100C  |.  FFD6          call    esi                                    ; \printf</span><br><span class="line">0120100E  |.  6A 01         push    0x1</span><br><span class="line">01201010  |.  68 FC202001   push    012020FC                               ;  ASCII &quot;%d&quot;</span><br><span class="line">01201015  |.  FFD6          call    esi</span><br><span class="line">01201017  |.  6A 00         push    0x0</span><br><span class="line">01201019  |.  68 FC202001   push    012020FC                               ;  ASCII &quot;%d&quot;</span><br><span class="line">0120101E  |.  FFD6          call    esi</span><br><span class="line">01201020  |.  83C4 14       add     esp,0x14							   ; 堆栈平衡，2+2+1=20/4</span><br><span class="line">01201023  |.  33C0          xor     eax,eax</span><br><span class="line">01201025  |.  5E            pop     esi</span><br><span class="line">01201026  \.  C3            retn</span><br><span class="line"></span><br><span class="line">//添加打印i后的代码</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">012B1000 &gt;/$  51            push    ecx</span><br><span class="line">012B1001  |.  56            push    esi</span><br><span class="line">012B1002  |.  8B35 A0202B01 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ;  msvcr90.printf</span><br><span class="line">012B1008  |.  57            push    edi</span><br><span class="line">012B1009  |.  68 F4202B01   push    012B20F4                                     ; /format = &quot;shabi&quot;</span><br><span class="line">012B100E  |.  FFD6          call    esi                                          ; \printf</span><br><span class="line">012B1010  |.  8B7C24 0C     mov     edi,dword ptr ss:[esp+0xC]                   ;  msvcr90.__winitenv</span><br><span class="line">012B1014  |.  47            inc     edi</span><br><span class="line">012B1015  |.  57            push    edi</span><br><span class="line">012B1016  |.  68 FC202B01   push    012B20FC                                     ;  ASCII &quot;%d&quot;</span><br><span class="line">012B101B  |.  FFD6          call    esi</span><br><span class="line">012B101D  |.  4F            dec     edi</span><br><span class="line">012B101E  |.  57            push    edi</span><br><span class="line">012B101F  |.  68 FC202B01   push    012B20FC                                     ;  ASCII &quot;%d&quot;</span><br><span class="line">012B1024  |.  FFD6          call    esi</span><br><span class="line">012B1026  |.  83C4 14       add     esp,0x14</span><br><span class="line">012B1029  |.  5F            pop     edi</span><br><span class="line">012B102A  |.  33C0          xor     eax,eax</span><br><span class="line">012B102C  |.  5E            pop     esi</span><br><span class="line">012B102D  |.  59            pop     ecx</span><br><span class="line">012B102E  \.  C3            retn</span><br><span class="line"></span><br><span class="line">//如果不赋初值的话</span><br></pre></td></tr></table></figure>
<p>前<ins>后</ins>（–）的区别</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	int i;</span><br><span class="line">	i++;</span><br><span class="line">	printf(&quot;%d&quot;,i);</span><br><span class="line">	i--;</span><br><span class="line">	printf(&quot;%d&quot;,i);</span><br><span class="line"></span><br><span class="line">	int j=0;</span><br><span class="line">	j=i++;</span><br><span class="line">	printf(&quot;i++%d&quot;,j);</span><br><span class="line">	j=++i;</span><br><span class="line">	printf(&quot;++i%d&quot;,j);</span><br><span class="line">	j=i--;</span><br><span class="line">	printf(&quot;i--%d&quot;,j);</span><br><span class="line">	j=--i;</span><br><span class="line">	printf(&quot;--i%d&quot;,j);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>禁止优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">01281000 &gt;/$  55            push    ebp</span><br><span class="line">01281001  |.  8BEC          mov     ebp,esp</span><br><span class="line">01281003  |.  83EC 08       sub     esp,0x8</span><br><span class="line">01281006  |.  68 F4202801   push    012820F4                                  ; /format = &quot;shabi&quot;</span><br><span class="line">0128100B  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">01281011  |.  83C4 04       add     esp,0x4</span><br><span class="line">01281014  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">01281017  |.  83C0 01       add     eax,0x1</span><br><span class="line">0128101A  |.  8945 FC       mov     [local.1],eax</span><br><span class="line">0128101D  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">01281020  |.  51            push    ecx                                       ; /&lt;%d&gt;</span><br><span class="line">01281021  |.  68 FC202801   push    012820FC                                  ; |format = &quot;%d&quot;</span><br><span class="line">01281026  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">0128102C  |.  83C4 08       add     esp,0x8</span><br><span class="line">0128102F  |.  8B55 FC       mov     edx,[local.1]</span><br><span class="line">01281032  |.  83EA 01       sub     edx,0x1</span><br><span class="line">01281035  |.  8955 FC       mov     [local.1],edx</span><br><span class="line">01281038  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">0128103B  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class="line">0128103C  |.  68 00212801   push    01282100                                  ; |format = &quot;%d&quot;</span><br><span class="line">01281041  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">01281047  |.  83C4 08       add     esp,0x8</span><br><span class="line">0128104A  |.  C745 F8 00000&gt;mov     [local.2],0x0</span><br><span class="line">01281051  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">01281054  |.  894D F8       mov     [local.2],ecx</span><br><span class="line">01281057  |.  8B55 FC       mov     edx,[local.1]</span><br><span class="line">0128105A  |.  83C2 01       add     edx,0x1</span><br><span class="line">0128105D  |.  8955 FC       mov     [local.1],edx</span><br><span class="line">01281060  |.  8B45 F8       mov     eax,[local.2]</span><br><span class="line">01281063  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class="line">01281064  |.  68 04212801   push    01282104                                  ; |format = &quot;i++%d&quot;</span><br><span class="line">01281069  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">0128106F  |.  83C4 08       add     esp,0x8</span><br><span class="line">01281072  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">01281075  |.  83C1 01       add     ecx,0x1</span><br><span class="line">01281078  |.  894D FC       mov     [local.1],ecx</span><br><span class="line">0128107B  |.  8B55 FC       mov     edx,[local.1]</span><br><span class="line">0128107E  |.  8955 F8       mov     [local.2],edx</span><br><span class="line">01281081  |.  8B45 F8       mov     eax,[local.2]</span><br><span class="line">01281084  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class="line">01281085  |.  68 0C212801   push    0128210C                                  ; |format = &quot;++i%d&quot;</span><br><span class="line">0128108A  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">01281090  |.  83C4 08       add     esp,0x8</span><br><span class="line">01281093  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">01281096  |.  894D F8       mov     [local.2],ecx</span><br><span class="line">01281099  |.  8B55 FC       mov     edx,[local.1]</span><br><span class="line">0128109C  |.  83EA 01       sub     edx,0x1</span><br><span class="line">0128109F  |.  8955 FC       mov     [local.1],edx</span><br><span class="line">012810A2  |.  8B45 F8       mov     eax,[local.2]</span><br><span class="line">012810A5  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class="line">012810A6  |.  68 14212801   push    01282114                                  ; |format = &quot;i--%d&quot;</span><br><span class="line">012810AB  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">012810B1  |.  83C4 08       add     esp,0x8</span><br><span class="line">012810B4  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">012810B7  |.  83E9 01       sub     ecx,0x1</span><br><span class="line">012810BA  |.  894D FC       mov     [local.1],ecx</span><br><span class="line">012810BD  |.  8B55 FC       mov     edx,[local.1]</span><br><span class="line">012810C0  |.  8955 F8       mov     [local.2],edx</span><br><span class="line">012810C3  |.  8B45 F8       mov     eax,[local.2]</span><br><span class="line">012810C6  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class="line">012810C7  |.  68 1C212801   push    0128211C                                  ; |format = &quot;--i%d&quot;</span><br><span class="line">012810CC  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \printf</span><br><span class="line">012810D2  |.  83C4 08       add     esp,0x8</span><br><span class="line">012810D5  |.  33C0          xor     eax,eax</span><br><span class="line">012810D7  |.  8BE5          mov     esp,ebp</span><br><span class="line">012810D9  |.  5D            pop     ebp</span><br><span class="line">012810DA  \.  C3            retn</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="do-while"><a class="markdownIt-Anchor" href="#do-while">#</a> do - while</h4>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int i = 0;</span><br><span class="line">	do</span><br><span class="line">	&#123;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">	while (i&lt;=10); </span><br><span class="line">	printf(&quot;%d&quot;,i);</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>/O2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00071000 &gt;/$  6A 0B         push    0xB                                      ; /&lt;%d&gt; = B (11.)</span><br><span class="line">00071002  |.  68 F4200700   push    000720F4                                 ; |format = &quot;%d&quot;</span><br><span class="line">00071007  |.  FF15 A0200700 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ; \printf</span><br><span class="line">0007100D  |.  83C4 08       add     esp,0x8</span><br><span class="line">00071010  |.  33C0          xor     eax,eax</span><br><span class="line">00071012  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>禁用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&gt; 00251000 &gt;/$  55            push    ebp</span><br><span class="line">&gt; 00251001  |.  8BEC          mov     ebp,esp</span><br><span class="line">&gt; 00251003  |.  51            push    ecx</span><br><span class="line">&gt; 00251004  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class="line">&gt; 0025100B  |&gt;  8B45 FC       /mov     eax,[local.1]</span><br><span class="line">&gt; 0025100E  |.  83C0 01       |add     eax,0x1</span><br><span class="line">&gt; 00251011  |.  8945 FC       |mov     [local.1],eax</span><br><span class="line">&gt; 00251014  |.  837D FC 0A    |cmp     [local.1],0xA</span><br><span class="line">&gt; 00251018  |.^ 7E F1         \jle     short 0025100B</span><br><span class="line">&gt; 0025101A  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">&gt; 0025101D  |.  51            push    ecx                                     ; /&lt;%d&gt;</span><br><span class="line">&gt; 0025101E  |.  68 F4202500   push    002520F4                                ; |format = &quot;%d&quot;</span><br><span class="line">&gt; 00251023  |.  FF15 A0202500 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]        ; \printf</span><br><span class="line">&gt; 00251029  |.  83C4 08       add     esp,0x8</span><br><span class="line">&gt; 0025102C  |.  33C0          xor     eax,eax</span><br><span class="line">&gt; 0025102E  |.  8BE5          mov     esp,ebp</span><br><span class="line">&gt; 00251030  |.  5D            pop     ebp</span><br><span class="line">&gt; 00251031  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="浮点指令"><a class="markdownIt-Anchor" href="#浮点指令">#</a> 浮点指令</h4>
<blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	float a=8.123f;</span><br><span class="line">	a++;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">012B1000 &gt;/$  55            push    ebp</span><br><span class="line">012B1001  |.  8BEC          mov     ebp,esp</span><br><span class="line">012B1003  |.  51            push    ecx</span><br><span class="line">012B1004  |.  68 F4202B01   push    012B20F4                            ; /format = &quot;shabi&quot;</span><br><span class="line">012B1009  |.  FF15 A0202B01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]    ; \printf</span><br><span class="line">012B100F  |.  83C4 04       add     esp,0x4</span><br><span class="line">012B1012  |.  D905 08212B01 fld     dword ptr ds:[_real]</span><br><span class="line">012B1018  |.  D95D FC       fstp    [local.1]</span><br><span class="line">012B101B  |.  D945 FC       fld     [local.1]</span><br><span class="line">012B101E  |.  DC05 00212B01 fadd    qword ptr ds:[_real]</span><br><span class="line">012B1024  |.  D95D FC       fstp    [local.1]</span><br><span class="line">012B1027  |.  33C0          xor     eax,eax</span><br><span class="line">012B1029  |.  8BE5          mov     esp,ebp</span><br><span class="line">012B102B  |.  5D            pop     ebp</span><br><span class="line">012B102C  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>浮点寄存器 - fpu - 浮点运算单元</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120195516311.png" alt="image-20221120195516311"></p>
<p>精度为 80 位，10 字节</p>
<p>MMX - 用于处理多媒体功能</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120195604566.png" alt="image-20221120195604566"></p>
<p>st0 至 st7 80 位的两用寄存器   MMX - FPU</p>
<p>3.FLD，FSTP，FADD</p>
<blockquote>
<ol>
<li></li>
</ol>
<p>fld     dword ptr ds:[_real]     //fld     dword ptr ds:[0x12B2108]</p>
<p>类似于 push 指令，将数字放入 st 中</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120200304416.png" alt="image-20221120200304416"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120200412594.png" alt="image-20221120200412594"></p>
<ol start="2">
<li></li>
</ol>
<p>fstp    [local.1]</p>
<p>类似于 pop 指令，将 st 中的值给 local.1</p>
<p>调用多次 fld 时，会使用多个 st 寄存器</p>
<ol start="3">
<li></li>
</ol>
<p>fadd    qword ptr ds:[_real]    //fadd    qword ptr ds:[0x12B2100]</p>
<p>类似于 add 指令，做加法  qword 64 位，8 各字</p>
<p>4.fsub</p>
<p>类似于 sub 指令</p>
<p>5.fmul</p>
<p>类似于乘法</p>
<p>6.fdiv</p>
<p>类似于除法</p>
<p>7.FILD 指令</p>
<p>整数入栈指令，将整数转为浮点数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	float a=8.123f;</span><br><span class="line">	int b = 2;</span><br><span class="line">	a= a + b;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">012F1000 &gt;/$  55            push    ebp</span><br><span class="line">012F1001  |.  8BEC          mov     ebp,esp</span><br><span class="line">012F1003  |.  83EC 08       sub     esp,0x8</span><br><span class="line">012F1006  |.  68 F4202F01   push    012F20F4                         ; /format = &quot;shabi&quot;</span><br><span class="line">012F100B  |.  FF15 A0202F01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \printf</span><br><span class="line">012F1011  |.  83C4 04       add     esp,0x4</span><br><span class="line">012F1014  |.  D905 FC202F01 fld     dword ptr ds:[_real]</span><br><span class="line">012F101A  |.  D95D FC       fstp    [local.1]</span><br><span class="line">012F101D  |.  C745 F8 02000&gt;mov     [local.2],0x2</span><br><span class="line">012F1024  |.  DB45 F8       fild    [local.2]</span><br><span class="line">012F1027  |.  D845 FC       fadd    [local.1]</span><br><span class="line">012F102A  |.  D95D FC       fstp    [local.1]</span><br><span class="line">012F102D &gt;|.  33C0          xor     eax,eax</span><br><span class="line">012F102F  |.  8BE5          mov     esp,ebp</span><br><span class="line">012F1031  |.  5D            pop     ebp</span><br><span class="line">012F1032  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120202918750.png" alt="image-20221120202918750"></p>
<p>8.cvttsd2si eax,dword ptr ss:[ebp-4]</p>
<p>浮点转整数指令，运用截断处理将 mmx/m32 中的一个单精度浮点值转换成 r32 中的一个有符号的双字整数</p>
</blockquote>
</blockquote>
<h4 id="位移指令"><a class="markdownIt-Anchor" href="#位移指令">#</a> 位移指令</h4>
<blockquote>
<p>1. 逻辑位移</p>
<p>shr 逻辑右移指令</p>
<p>相当于整除 2，用 0 来补位</p>
<p>shl 逻辑右移指令</p>
<p>相当于乘 2，用 0 来补位，有可能移除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	unsigned int i = 0x77883322;</span><br><span class="line">	i = i &gt;&gt; 8;</span><br><span class="line">	i = i &gt;&gt; 2;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">011D1000 &gt;/$  55            push    ebp</span><br><span class="line">011D1001  |.  8BEC          mov     ebp,esp</span><br><span class="line">011D1003  |.  51            push    ecx</span><br><span class="line">011D1004  |.  68 F4201D01   push    011D20F4                                ; /format = &quot;shabi&quot;</span><br><span class="line">011D1009  |.  FF15 A0201D01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]        ; \printf</span><br><span class="line">011D100F  |.  83C4 04       add     esp,0x4</span><br><span class="line">011D1012  |.  C745 FC 22330&gt;mov     [local.1],0x3322</span><br><span class="line">011D1019  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">011D101C  |.  C1E8 08       shr     eax,0x8									; 0x 00 77 88 33  ÷(2^8)</span><br><span class="line">011D101F  |.  8945 FC       mov     [local.1],eax</span><br><span class="line">011D1022  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class="line">011D1025  |.  C1E9 02       shr     ecx,0x2									; ÷ 4</span><br><span class="line">011D1028  |.  894D FC       mov     [local.1],ecx</span><br><span class="line">011D102B  |.  33C0          xor     eax,eax</span><br><span class="line">011D102D  |.  8BE5          mov     esp,ebp</span><br><span class="line">011D102F  |.  5D            pop     ebp</span><br><span class="line">011D1030  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>2. 算术位移</p>
<p>SAR 算术右移指令</p>
<p>​	SAR 右移时保留操作数符号，用符号位补</p>
<p>​	SHR 右移时用 0 部位</p>
<p>SAL 算术左移指令</p>
<p>​	SAL 与 SHL 功能一样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	int i = -100000000;</span><br><span class="line">	i = i &lt;&lt; 5;</span><br><span class="line">	printf(&quot;%d&quot;,i);  //1094967296</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3. 循环位移指令</p>
<p>ROL 循环左移</p>
<p>ROR 循环右移</p>
</blockquote>
<h4 id="逻辑运算符"><a class="markdownIt-Anchor" href="#逻辑运算符">#</a> 逻辑运算符</h4>
<blockquote>
<p>逻辑或 ||</p>
<p>截断原理，如果前面为真，那么不在判断后面的。因此在代码优化层面，把可能性大的放在前面提高效率</p>
<p>按位或 |</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">01321000 &gt;/$  55            push    ebp</span><br><span class="line">01321001  |.  8BEC          mov     ebp,esp</span><br><span class="line">01321003  |.  83EC 10       sub     esp,0x10</span><br><span class="line">01321006  |.  68 F4203201   push    013220F4                                    ; /format = &quot;shabi&quot;</span><br><span class="line">0132100B  |.  FF15 A0203201 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]            ; \printf</span><br><span class="line">01321011  |.  83C4 04       add     esp,0x4</span><br><span class="line">01321014  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class="line">0132101B  |.  C745 F8 03000&gt;mov     [local.2],0x3</span><br><span class="line">01321022  |.  837D FC 00    cmp     [local.1],0x0</span><br><span class="line">01321026  |.  75 0F         jnz     short 01321037</span><br><span class="line">01321028  |.  837D F8 00    cmp     [local.2],0x0</span><br><span class="line">0132102C  |.  75 09         jnz     short 01321037</span><br><span class="line">0132102E  |.  C745 F0 00000&gt;mov     [local.4],0x0</span><br><span class="line">01321035  |.  EB 07         jmp     short 0132103E</span><br><span class="line">01321037  |&gt;  C745 F0 01000&gt;mov     [local.4],0x1</span><br><span class="line">0132103E  |&gt;  8B45 F0       mov     eax,[local.4]</span><br><span class="line">01321041  |.  8945 F4       mov     [local.3],eax</span><br><span class="line">01321044  |.  33C0          xor     eax,eax</span><br><span class="line">01321046  |.  8BE5          mov     esp,ebp</span><br><span class="line">01321048  |.  5D            pop     ebp</span><br><span class="line">01321049  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>逻辑与  &amp;&amp;</p>
<p>按位与 &amp;</p>
<p>非运算 ！</p>
<p>按位取反 ～</p>
<p>sete al   // 取 ZF 位的值，保存到寄存器中</p>
<p>setne  al  //zf 取反保存到寄存器中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	int a =5,b=4,c,d;</span><br><span class="line"></span><br><span class="line">	c = !a;</span><br><span class="line">	d = ~b;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">00FC1000 &gt;/$  55            push    ebp</span><br><span class="line">00FC1001  |.  8BEC          mov     ebp,esp</span><br><span class="line">00FC1003  |.  83EC 10       sub     esp,0x10</span><br><span class="line">00FC1006  |.  68 F420FC00   push    00FC20F4                                 ; /format = &quot;shabi&quot;</span><br><span class="line">00FC100B  |.  FF15 A020FC00 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ; \printf</span><br><span class="line">00FC1011  |.  83C4 04       add     esp,0x4</span><br><span class="line">00FC1014  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class="line">00FC101B  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class="line">00FC1022  |.  33C0          xor     eax,eax</span><br><span class="line">00FC1024  |.  837D FC 00    cmp     [local.1],0x0</span><br><span class="line">00FC1028  |.  0F94C0        sete    al</span><br><span class="line">00FC102B  |.  8945 F0       mov     [local.4],eax</span><br><span class="line">00FC102E  |.  8B4D F8       mov     ecx,[local.2]</span><br><span class="line">00FC1031  |.  F7D1          not     ecx</span><br><span class="line">00FC1033  |.  894D F4       mov     [local.3],ecx</span><br><span class="line">00FC1036  |.  33C0          xor     eax,eax</span><br><span class="line">00FC1038  |.  8BE5          mov     esp,ebp</span><br><span class="line">00FC103A  |.  5D            pop     ebp</span><br><span class="line">00FC103B  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>异或运算</p>
<p>按位异或 ^</p>
<p>xor eax,eax   //eax 清零</p>
<p>可以看成没有进位的加法</p>
<p>交换 a,b</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = a + b</span><br><span class="line">b = a - b</span><br><span class="line">a = a - b</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">a = a ^ b</span><br><span class="line">b = a ^ b</span><br><span class="line">a = a ^ b</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="字符操作相关指令"><a class="markdownIt-Anchor" href="#字符操作相关指令">#</a> 字符操作相关指令</h4>
<blockquote>
<p>strcmp</p>
<p>需要将优化中的启动内部函数设为否，关闭优化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">00F81000 &gt;/$  55            push    ebp</span><br><span class="line">00F81001  |.  8BEC          mov     ebp,esp</span><br><span class="line">00F81003  |.  83EC 08       sub     esp,0x8</span><br><span class="line">00F81006  |.  68 F420F800   push    00F820F4                               ; /format = &quot;shabi&quot;</span><br><span class="line">00F8100B  |.  FF15 A420F800 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]       ; \printf</span><br><span class="line">00F81011  |.  83C4 04       add     esp,0x4</span><br><span class="line">00F81014  |.  C745 F8 FC20F&gt;mov     [local.2],00F820FC                     ;  ASCII &quot;123456&quot;</span><br><span class="line">00F8101B  |.  C745 FC 0421F&gt;mov     [local.1],00F82104                     ;  ASCII &quot;shabishabi&quot;</span><br><span class="line">00F81022  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">00F81025  |.  50            push    eax                                    ; /s2</span><br><span class="line">00F81026  |.  8B4D F8       mov     ecx,[local.2]                          ; |</span><br><span class="line">00F81029  |.  51            push    ecx                                    ; |s1</span><br><span class="line">00F8102A  |.  E8 19000000   call    strcmp                                 ; \strcmp</span><br><span class="line">00F8102F  |.  83C4 08       add     esp,0x8</span><br><span class="line">00F81032  |.  33C0          xor     eax,eax</span><br><span class="line">00F81034  |.  8BE5          mov     esp,ebp</span><br><span class="line">00F81036  |.  5D            pop     ebp</span><br><span class="line">00F81037  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p>strcmp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">74D6B8E0 &gt;  8B5424 04       mov     edx,dword ptr ss:[esp+0x4]</span><br><span class="line">74D6B8E4    8B4C24 08       mov     ecx,dword ptr ss:[esp+0x8]</span><br><span class="line">74D6B8E8    F7C2 03000000   test    edx,0x3</span><br><span class="line">74D6B8EE    75 3C           jnz     short 74D6B92C</span><br><span class="line">74D6B8F0    8B02            mov     eax,dword ptr ds:[edx]</span><br><span class="line">74D6B8F2    3A01            cmp     al,byte ptr ds:[ecx]</span><br><span class="line">74D6B8F4    75 2E           jnz     short 74D6B924</span><br><span class="line">74D6B8F6    0AC0            or      al,al</span><br><span class="line">74D6B8F8    74 26           je      short 74D6B920</span><br><span class="line">74D6B8FA    3A61 01         cmp     ah,byte ptr ds:[ecx+0x1]</span><br><span class="line">74D6B8FD    75 25           jnz     short 74D6B924</span><br><span class="line">74D6B8FF    0AE4            or      ah,ah</span><br><span class="line">74D6B901    74 1D           je      short 74D6B920</span><br><span class="line">74D6B903    C1E8 10         shr     eax,0x10</span><br><span class="line">74D6B906    3A41 02         cmp     al,byte ptr ds:[ecx+0x2]</span><br><span class="line">74D6B909    75 19           jnz     short 74D6B924</span><br><span class="line">74D6B90B    0AC0            or      al,al</span><br><span class="line">74D6B90D    74 11           je      short 74D6B920</span><br><span class="line">74D6B90F    3A61 03         cmp     ah,byte ptr ds:[ecx+0x3]</span><br><span class="line">74D6B912    75 10           jnz     short 74D6B924</span><br><span class="line">74D6B914    83C1 04         add     ecx,0x4</span><br><span class="line">74D6B917    83C2 04         add     edx,0x4</span><br><span class="line">74D6B91A    0AE4            or      ah,ah</span><br><span class="line">74D6B91C  ^ 75 D2           jnz     short 74D6B8F0</span><br><span class="line">74D6B91E    8BFF            mov     edi,edi</span><br><span class="line">74D6B920    33C0            xor     eax,eax</span><br><span class="line">74D6B922    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>每次取四个字节依次比较</p>
<p>SCASB</p>
<p>SCAS byte ptr es:[EDI]   用于查找 AL 的字符在 edi 中的位置</p>
<p>相当于</p>
<p>cmp byte ptr [edi],al</p>
<p>对标志位的影响相当于 sub 指令，还会修改 edi 的值</p>
<p>DF=0 ，inc edi</p>
<p>DF=1,  dec edi</p>
<p>REPNE</p>
<p>repne scasb</p>
<p>ecx !=0 ,zf=0，重复执行后面指令，每执行一次 ecx-1</p>
<p>REPNE 与 REPNZ 是同一条指令不同助记符</p>
<p>// 通过 repne 计算字符串长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;shabi&quot;);</span><br><span class="line">	char *s1 = &quot;123456&quot;;</span><br><span class="line">	__asm &#123;  //cal length</span><br><span class="line">			mov al,0</span><br><span class="line">			mov edi,s1</span><br><span class="line">			mov ecx,-1</span><br><span class="line">			repnz scasb</span><br><span class="line">			mov eax,-1</span><br><span class="line">			sub eax,ecx </span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	__asm &#123;   //find index</span><br><span class="line">			xor eax,rax</span><br><span class="line">			mov al,0x33</span><br><span class="line">			mov edi,s1</span><br><span class="line">			mov ecx,-1</span><br><span class="line">			repnz scasb</span><br><span class="line">			not ecx</span><br><span class="line">			dec ecx</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	std::string str1 = s1;</span><br><span class="line">	int haha = str1.find(&quot;3&quot;);</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">00901000 &gt;/$  55            push    ebp</span><br><span class="line">00901001  |.  8BEC          mov     ebp,esp</span><br><span class="line">00901003  |.  51            push    ecx</span><br><span class="line">00901004  |.  57            push    edi</span><br><span class="line">00901005  |.  68 F4209000   push    009020F4                               ; /format = &quot;shabi&quot;</span><br><span class="line">0090100A  |.  FF15 A0209000 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]       ; \printf</span><br><span class="line">00901010  |.  83C4 04       add     esp,0x4</span><br><span class="line">00901013  |.  C745 FC FC209&gt;mov     [local.1],009020FC                     ;  ASCII &quot;123456&quot;</span><br><span class="line">0090101A  |.  B0 00         mov     al,0x0</span><br><span class="line">0090101C  |.  8B7D FC       mov     edi,[local.1]</span><br><span class="line">0090101F  |.  B9 FFFFFFFF   mov     ecx,-0x1</span><br><span class="line">00901024  |.  F2:AE         repne   scas byte ptr es:[edi]</span><br><span class="line">00901026  |.  B8 FFFFFFFF   mov     eax,-0x1</span><br><span class="line">0090102B  |.  2BC1          sub     eax,ecx</span><br><span class="line">0090102D  |.  33C0          xor     eax,eax</span><br><span class="line">0090102F  |.  5F            pop     edi</span><br><span class="line">00901030  |.  8BE5          mov     esp,ebp</span><br><span class="line">00901032  |.  5D            pop     ebp</span><br><span class="line">00901033  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>SCASB  SCASW  SCASD</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221124212255214.png" alt="image-20221124212255214"></p>
<p>mov ax,L’7’</p>
<p>实例运用</p>
<p>1. 计算字符串长度</p>
<p>2. 定位特定字符串位置（索引)</p>
<p>3. 在内存中定位一串特征码</p>
<p>REPNZ/REPNE 与 SCASB 指令结合使用，表示当串未结束 (ECX!=0)，且当对应串元素不相同 (ZF=0) 时，继续重复执行串比较指令</p>
<p>REPE/REPZ 和 CMPSB，CMPSW，CMPSD</p>
<p>1.CMPS</p>
<p>cmps byte ptr [edi], byte ptr [esi]</p>
<p>对标志位的影响相当于 sub 指令，同时还会修改 edi 和 esi 的值</p>
<p>如果 df 为 0，则 edi，esi 按相对大小递增</p>
<p>df 为 1，递减</p>
<p>2.REPE、REPZ</p>
<p>repe/repz cmpsb 当 ecx!=0，zf=1，重复执行后面指令，每执行一次 ecx-1</p>
<p>用于比较字符串是否相等</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">__asm &#123;</span><br><span class="line">		xor al,al</span><br><span class="line">		mov edi,s1</span><br><span class="line">		mov ecx,-1</span><br><span class="line">		repnz scasb  //finish position</span><br><span class="line">		not ecx    //cal length </span><br><span class="line"></span><br><span class="line">		mov edi,s1</span><br><span class="line">		mov esi,s2</span><br><span class="line">		repz cmpsb  //compare equal</span><br><span class="line">		</span><br><span class="line">		xor al,al</span><br><span class="line">		sete al</span><br><span class="line">		cmp al,1</span><br><span class="line">		jnz result1</span><br><span class="line">		cmp ecx,0</span><br><span class="line">		jz result2</span><br><span class="line">		&#125;</span><br><span class="line">result1:</span><br><span class="line">	printf(&quot;S1!=S2&quot;);</span><br><span class="line">	goto end</span><br><span class="line">result2:</span><br><span class="line">	printf(&quot;s1==s2&quot;);</span><br><span class="line">end:</span><br><span class="line">	getchar();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>汇编编写比较函数</p>
<p>__declspec (naked)   纯汇编编译函数，不添加寄存器保护和堆栈平衡代码</p>
<p>窄字节版</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__declspec(naked) int strcmpa(char *s1, char *s2)</span><br><span class="line">&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">			push ebp  //esp-4-4</span><br><span class="line">			mov ebp,esp   //s1:ebp+4+4   s2:ebp+4+8</span><br><span class="line">			push ecx</span><br><span class="line">			push edi</span><br><span class="line">			push esi</span><br><span class="line">			push edx</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			xor al,al</span><br><span class="line">			mov edi,s1</span><br><span class="line">			CLD</span><br><span class="line">			mov ecx,-1</span><br><span class="line">			repnz scasb  //finish position</span><br><span class="line">			not ecx    //cal length </span><br><span class="line"></span><br><span class="line">			mov edi,s1</span><br><span class="line">			mov esi,s2</span><br><span class="line">			repz cmpsb  //compare equal</span><br><span class="line"></span><br><span class="line">			xor eax,eax</span><br><span class="line">			xor edx,edx</span><br><span class="line">			mov al,[edi-1]</span><br><span class="line">			mov dl,[esi-1]</span><br><span class="line">			sub eax,edx</span><br><span class="line">			pop edx</span><br><span class="line">			pop esi</span><br><span class="line">			pop edi</span><br><span class="line">			pop ecx </span><br><span class="line">			pop ebp</span><br><span class="line">			retn</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>宽字节版</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">__declspec(naked) int strcmpW(wchar_t *s1, wchar_t *s2)</span><br><span class="line">&#123;</span><br><span class="line">	__asm&#123;</span><br><span class="line">			push ebp  //esp-4-4</span><br><span class="line">			mov ebp,esp   //s1:ebp+4+4   s2:ebp+4+8</span><br><span class="line">			push ecx</span><br><span class="line">			push edi</span><br><span class="line">			push esi</span><br><span class="line">			push edx</span><br><span class="line">			</span><br><span class="line"></span><br><span class="line">			xor ax,ax</span><br><span class="line">			mov edi,s1</span><br><span class="line">			mov ecx,-1</span><br><span class="line">			CLD</span><br><span class="line">			repnz scasw  //finish position</span><br><span class="line">			not ecx      //cal length </span><br><span class="line"></span><br><span class="line">			mov edi,s1</span><br><span class="line">			mov esi,s2</span><br><span class="line">			repz cmpsw   //compare equal</span><br><span class="line"></span><br><span class="line">			xor eax,eax</span><br><span class="line">			xor edx,edx</span><br><span class="line">			mov al,[edi-2]</span><br><span class="line">			mov dl,[esi-2]</span><br><span class="line">			sub eax,edx</span><br><span class="line">			pop edx</span><br><span class="line">			pop esi</span><br><span class="line">			pop edi</span><br><span class="line">			pop ecx </span><br><span class="line">			pop ebp</span><br><span class="line">			retn</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ESP+4 是 call 的下一个命令的地址</p>
<p>ESP+8 是外部传进来的第一个变量</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126203249743.png" alt="image-20221126203249743"></p>
<p>STD/CLD</p>
<p>修改 DF</p>
<p>STD DF=1</p>
<p>CLD DF=0</p>
<p>串存储和加载指令</p>
<p>1. 串存储指令 STOSB STOSW  STOSD</p>
<p>stos btye ptr [edi]</p>
<p>相当于 mov byte ptr [edi],al</p>
<p>rep stosb     //rep stos byte ptr [edi]</p>
<p>用 al 的值填充 byte ptr [edi]，每次 ecx-1，edi+1</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;cstdio&gt;</span><br><span class="line"></span><br><span class="line">int main() </span><br><span class="line">&#123;</span><br><span class="line">	int a[0x22];</span><br><span class="line">	a[0] = 1;</span><br><span class="line">	a[0x12] = 222;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">013F13A0    55              push    ebp</span><br><span class="line">013F13A1    8BEC            mov     ebp,esp</span><br><span class="line">013F13A3    81EC 50010000   sub     esp,0x150</span><br><span class="line">013F13A9    53              push    ebx</span><br><span class="line">013F13AA    56              push    esi</span><br><span class="line">013F13AB    57              push    edi</span><br><span class="line">013F13AC    8DBD B0FEFFFF   lea     edi,dword ptr ss:[ebp-0x150]</span><br><span class="line">013F13B2    B9 54000000     mov     ecx,0x54</span><br><span class="line">013F13B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">013F13BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">013F13BE    C785 74FFFFFF 0&gt;mov     dword ptr ss:[ebp-0x8C],0x1</span><br><span class="line">013F13C8    C745 BC DE00000&gt;mov     dword ptr ss:[ebp-0x44],0xDE</span><br><span class="line">013F13CF    33C0            xor     eax,eax</span><br><span class="line">013F13D1    52              push    edx</span><br><span class="line">013F13D2    8BCD            mov     ecx,ebp</span><br><span class="line">013F13D4    50              push    eax</span><br><span class="line">013F13D5    8D15 EC133F01   lea     edx,dword ptr ds:[0x13F13EC]</span><br><span class="line">013F13DB    E8 A7FCFFFF     call    013F1087</span><br></pre></td></tr></table></figure>
<p>手动初始化数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">__asm &#123;</span><br><span class="line">	mov ecx,0x22</span><br><span class="line">	xor eax,eax</span><br><span class="line">	lea edi,a</span><br><span class="line">	rep stosd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>debug 找 main 函数</p>
<p>退出函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">013F199F    FF15 7C823F01   call    dword ptr ds:[&lt;&amp;MSVCR90D.exit&gt;]                      ; msvcr90d.exit</span><br></pre></td></tr></table></figure>
<p>退出函数的上一个函数即使 main 函数</p>
<p>release 中程序中断位置不在 main 上，在 jmp 上才时 main</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126213639997.png" alt="image-20221126213639997"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126213710284.png" alt="image-20221126213710284"></p>
<p>看 exit 找 main 或者看 main 的 argv ，argc 参数找 main 也可以</p>
<p>这边没删 pdb，删了一样</p>
<p>同时注意，main 有三个参数，argv 参数个数，argc 参数数组，envp 环境变量</p>
<p>envp 是二级指针，需要两次寻址，存放系统环境变量</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190321276.png" alt="image-20221127190321276"></p>
<p>argv 也是二级指针，存在文件路径</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190413354.png" alt="image-20221127190413354"></p>
<p>argc 存放 argv 中参数个数</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190503930.png" alt="image-20221127190503930"></p>
<p>串载入指令</p>
<blockquote>
<p>loadSB ,LOADSW,LOASSD</p>
<p>相当于 mov al,byte ptr [esi] 将内存中数据放到寄存器中</p>
<p>rep loadsb</p>
<p>rep loads word ptr [esi]</p>
<p>用 byte ptr [esi] 填充 al，每次 ecx-1，esi+1</p>
</blockquote>
<p>循环控制指令</p>
<blockquote>
<p>loop start</p>
<p>1.ecx-1</p>
<p>2.ecx！=0 转移到标号处循环执行</p>
<p>3. 直至 ecx=0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int i = 100;</span><br><span class="line">	char *s = &quot;%d&quot;;</span><br><span class="line">	__asm mov ecx,i</span><br><span class="line"></span><br><span class="line">	__asm &#123;</span><br><span class="line">start:</span><br><span class="line">		push ecx</span><br><span class="line"></span><br><span class="line">		push ecx</span><br><span class="line">		mov eax,s</span><br><span class="line">		push eax</span><br><span class="line">		call dword ptr [printf]</span><br><span class="line">		add esp,8</span><br><span class="line"></span><br><span class="line">		pop ecx</span><br><span class="line"></span><br><span class="line">		loop start</span><br><span class="line">	</span><br><span class="line">	&#125;</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>条件置位指令</p>
<blockquote>
<p>sete  setz</p>
<p>sete al  取 zf 标志位的值</p>
<p>setnz 、 setne</p>
<p>将 zf 的值取反保存</p>
<p>setg al</p>
<p>大于比较时 ZF =0&amp;&amp; sf=0 &amp;&amp; OF=1 时 al=1</p>
<p>setl al</p>
<p>小于比较</p>
<p>sf=1 || of=1 ，al=1</p>
<p>setge</p>
<p>操作数可以是一个字节存储单元，可以是一个字节宽度寄存器</p>
<p>&gt;= 时，操作数值 1，否则为 0，一般与 cmp 结合使用</p>
<p>SF=OF ，操作数置 1</p>
<p>setle</p>
<p>操作数可以是一个字节存储单元，可以是一个字节宽度寄存器</p>
<p>&lt;= 时，操作数值 1，否则为 0，一般与 cmp 结合使用</p>
<p>ZF = 1 || sf!= of 操作数置 1</p>
</blockquote>
<h2 id="实战"><a class="markdownIt-Anchor" href="#实战">#</a> 实战</h2>
<h3 id="1游戏call"><a class="markdownIt-Anchor" href="#1游戏call">#</a> 1. 游戏 call</h3>
<blockquote>
<p>调用 MessageBoxA 函数 call</p>
<p>1. 找到 messageboxA call 地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">76C4FD1E &gt;  8BFF            mov     edi,edi</span><br></pre></td></tr></table></figure>
<p>2. 找到 MessageBoxA call 参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int MessageBox(</span><br><span class="line">[in, optional] HWND    hWnd,</span><br><span class="line">[in, optional] LPCTSTR lpText,</span><br><span class="line">[in, optional] LPCTSTR lpCaption,</span><br><span class="line">[in]           UINT    uType</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">我们用四个push 0，因为都可以传0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br></pre></td></tr></table></figure>
<p>3. 注入代码测试调用 MessageBoxA call</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127205600961.png" alt="image-20221127205600961"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127205625663.png" alt="image-20221127205625663"></p>
<p>或者在第二个和第三个参数传入字符指针，，第一个参数改变窗口格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">push 0</span><br><span class="line">push 01005148</span><br><span class="line">push 01005148</span><br><span class="line">push 0</span><br><span class="line">call 76C4FD1E</span><br></pre></td></tr></table></figure>
<p>2. 窗口菜单类 call 分析</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127212738634.png" alt="image-20221127212738634"></p>
<p>follow poc，定位窗口处理函数位置</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127214017807.png" alt="image-20221127214017807"></p>
<p>窗口处理函数原型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">LRESULT CALLBACK WindowProc(</span><br><span class="line">HWND hwnd, </span><br><span class="line">UINT uMsg, </span><br><span class="line">WPARAM wParam, </span><br><span class="line">LPARAM lParam </span><br><span class="line">); </span><br></pre></td></tr></table></figure>
<p>菜单被点击的时候发送的是 WM_COMMAND 消息</p>
<p>当点击菜单的时候，WindowProc 会被系统调用，</p>
<p>uMsg = WM_COMMAND</p>
<p>wPARAM = 窗口菜单的 id</p>
<p>在 WindowProc 函数下条件断点</p>
<p>条件时：uMSG == WM_COMMAND</p>
<p>如  edx == WM_COMMAND 条件断点</p>
<p>点击菜单时条件断点被中断</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128192802977.png" alt="image-20221128192802977"></p>
<p>点击初级时 edx == VMCOMMAND == 0x111</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">01001BC9  /.  55            push    ebp</span><br><span class="line">01001BCA  |.  8BEC          mov     ebp,esp</span><br><span class="line">01001BCC  |.  83EC 40       sub     esp,0x40</span><br><span class="line">01001BCF  |.  8B55 0C       mov     edx,[arg.2]   ; uMsg</span><br><span class="line">01001BD2 &gt;|.  8B4D 14       mov     ecx,[arg.4]   ; edx == WM_COMMAND</span><br><span class="line">01001BD5  |.  53            push    ebx</span><br><span class="line">01001BD6  |.  56            push    esi</span><br><span class="line">01001BD7  |.  33DB          xor     ebx,ebx</span><br><span class="line">01001BD9  |.  57            push    edi</span><br></pre></td></tr></table></figure>
<p>分析出各项菜单被点击时四个参数的值</p>
<p>wParam（菜单 ID）参数：</p>
<p>​	初级菜单 ID：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EBP+8    &gt;|0011029C   HWND hwnd</span><br><span class="line">EBP+C    &gt;|00000111   uMsg</span><br><span class="line">EBP+10   &gt;|00000209   wParam</span><br><span class="line">EBP+14   &gt;|00000000   lParam</span><br></pre></td></tr></table></figure>
<p>​	中级菜单 ID：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EBP+8    &gt;|0011029C</span><br><span class="line">EBP+C    &gt;|00000111</span><br><span class="line">EBP+10   &gt;|0000020A</span><br><span class="line">EBP+14   &gt;|00000000</span><br></pre></td></tr></table></figure>
<p>​	高级菜单 ID：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">EBP+8    &gt;|0011029C</span><br><span class="line">EBP+C    &gt;|00000111</span><br><span class="line">EBP+10   &gt;|0000020B</span><br><span class="line">EBP+14   &gt;|00000000</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128194129162.png" alt="image-20221128194129162"></p>
<p>注入代码调试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">push 0</span><br><span class="line">push 0x20b</span><br><span class="line">push 0x111</span><br><span class="line">push 0x001A03DA</span><br><span class="line">call 0x01001BC9</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128204020367.png" alt="image-20221128204020367"></p>
</blockquote>
<h3 id="2分析游戏基地址"><a class="markdownIt-Anchor" href="#2分析游戏基地址">#</a> 2. 分析游戏基地址</h3>
<blockquote>
<p>基地址概念</p>
<p>全局变量，字符常量等的地址</p>
<p>1. 使用 CE 内存查找工具查找数据的地址</p>
<p>2. 在 od 中验证是否为基地址</p>
<p>​	通过下内存断点方式验证</p>
<p>通过 ce 找到基地址，new scan 后改变数值进行 next scan</p>
<p>1. 首次先让要查找的数据稳定在某个范围 (或者某个精确的值)</p>
<p>2. 改变要查找的数据，根据变化筛选出数据的地址</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128205517107.png" alt="image-20221128205517107"></p>
<p>在扫雷中，小旗子剩余数量的基地址为 01005194</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0100346E  |.  0105 94510001 add     dword ptr ds:[0x1005194],eax</span><br></pre></td></tr></table></figure>
<p>立即数寻址的一般都是基地址</p>
</blockquote>
<h3 id="3游戏菜单点击与读取基地址"><a class="markdownIt-Anchor" href="#3游戏菜单点击与读取基地址">#</a> 3. 游戏菜单点击与读取基地址</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">void CsaoleiDlg::OnBnClickedButton1()</span><br><span class="line">&#123;</span><br><span class="line">	HWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hwnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	::SendMessage(hwnd, WM_COMMAND, 0x20A, 0);  //发送WindowProc的参数</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton2()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	HWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hwnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	::SendMessage(hwnd, WM_COMMAND, 0x20B, 0);  //发送WindowProc的参数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton3()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	while (TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		OnBnClickedButton1();</span><br><span class="line">		Sleep(1000);</span><br><span class="line">		OnBnClickedButton2();</span><br><span class="line">		Sleep(1000);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">void CsaoleiDlg::OnBnClickedButton4()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">		/*</span><br><span class="line">	BOOL ReadProcessMemory(</span><br><span class="line">	  HANDLE hProcess,</span><br><span class="line">	  LPCVOID lpBaseAddress,</span><br><span class="line">	  LPVOID lpBuffer,</span><br><span class="line">	  DWORD nSize,</span><br><span class="line">	  LPDWORD lpNumberOfBytesRead</span><br><span class="line">	);</span><br><span class="line">	HANDLE OpenProcess( </span><br><span class="line">	  DWORD fdwAccess, </span><br><span class="line">	  BOOL fInherit, </span><br><span class="line">	  DWORD IDProcess</span><br><span class="line">	);</span><br><span class="line">	DWORD GetWindowThreadProcessId(</span><br><span class="line">	  HWND hWnd,</span><br><span class="line">	  LPDWORD lpdwProcessId</span><br><span class="line">	);</span><br><span class="line">	*/</span><br><span class="line">	DWORD pid;</span><br><span class="line">	HWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hWnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class="line">	if (NULL == hProcess)</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	//m_editbase1 是编辑框的绑定变量，类别为value，变量类型为int，变量名为m_editbase1</span><br><span class="line">	ReadProcessMemory(hProcess, (LPCVOID)0x1005194, &amp;m_editbase1, sizeof(m_editbase1), &amp;pid);</span><br><span class="line"></span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221130104547356.png" alt="image-20221130104547356"></p>
<h3 id="4扫雷游戏辅助编写"><a class="markdownIt-Anchor" href="#4扫雷游戏辅助编写">#</a> 4. 扫雷游戏辅助编写</h3>
<blockquote>
<p>1. 雷区数据分析</p>
<p>中级 char a [24][32]  //ReadProcessMemory</p>
<p>数据雷区基地址 0x01005361    ==  扫雷.exe+5361</p>
<p>找基地址：new scan 时使用未知数，之后每一次 next scan 根据 change 或者 unchange 进行 next scan</p>
<p>初级 9*9 ，内存中隔行存放，因为每一行占两行内存，10 代表结束</p>
<p>只有点击第一下之后才开始布雷，winxp 扫雷特性</p>
<p>0x8F 是雷，40 空白，40 对应 1，0x10 代表行 / 列结束标识</p>
<p>宽基地址 0x01005334</p>
<p>高基地址 0x01005338</p>
</blockquote>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221130111727184.png" alt="image-20221130111727184"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line">void CsaoleiDlg::OnBnClickedButton1()</span><br><span class="line">&#123;</span><br><span class="line">	HWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hwnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	::SendMessage(hwnd, WM_COMMAND, 0x20A, 0);  //发送WindowProc的参数</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton2()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	HWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hwnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	::SendMessage(hwnd, WM_COMMAND, 0x20B, 0);  //发送WindowProc的参数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton3()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	while (TRUE)</span><br><span class="line">	&#123;</span><br><span class="line">		OnBnClickedButton1();</span><br><span class="line">		Sleep(1000);</span><br><span class="line">		OnBnClickedButton2();</span><br><span class="line">		Sleep(1000);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton4()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">		/*</span><br><span class="line">	BOOL ReadProcessMemory(</span><br><span class="line">	  HANDLE hProcess,</span><br><span class="line">	  LPCVOID lpBaseAddress,</span><br><span class="line">	  LPVOID lpBuffer,</span><br><span class="line">	  DWORD nSize,</span><br><span class="line">	  LPDWORD lpNumberOfBytesRead</span><br><span class="line">	);</span><br><span class="line">	HANDLE OpenProcess( </span><br><span class="line">	  DWORD fdwAccess, </span><br><span class="line">	  BOOL fInherit, </span><br><span class="line">	  DWORD IDProcess</span><br><span class="line">	);</span><br><span class="line">	DWORD GetWindowThreadProcessId(</span><br><span class="line">	  HWND hWnd,</span><br><span class="line">	  LPDWORD lpdwProcessId</span><br><span class="line">	);</span><br><span class="line">	*/</span><br><span class="line">	DWORD pid;</span><br><span class="line">	HWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hWnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class="line">	if (NULL == hProcess)</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	ReadProcessMemory(hProcess, (LPCVOID)0x1005194, &amp;m_editbase1, sizeof(m_editbase1), &amp;pid);</span><br><span class="line"></span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CsaoleiDlg::OnBnClickedButton5()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	DWORD pid;</span><br><span class="line">	HWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class="line">	if (NULL == hWnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class="line">	if (NULL == hProcess)</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/*</span><br><span class="line">	&gt; 0x8F是雷，40空白，40对应1，0x10代表行/列结束标识</span><br><span class="line">	&gt;</span><br><span class="line">	&gt; 宽基地址 0x01005334</span><br><span class="line">	&gt;</span><br><span class="line">	&gt; 高基地址 0x01005338</span><br><span class="line">	*/</span><br><span class="line"></span><br><span class="line">	unsigned char gamedata[24][32] = &#123; 0 &#125;;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x01005361, &amp;gamedata, 32*24, &amp;pid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开12&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	int dwHigth = 0;</span><br><span class="line">	m_strshowdata.Empty();</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x01005338, &amp;dwHigth, sizeof(dwHigth), &amp;pid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未打开13&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CString strTemp = _T(&quot;&quot;);</span><br><span class="line">	//第一个格子位置</span><br><span class="line">	short gamex = 20;</span><br><span class="line">	short gamey = 60;</span><br><span class="line">	unsigned  short xypos[2] = &#123; 0 &#125;;</span><br><span class="line">	for (int i = 0; i &lt; dwHigth; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		for (int j = 0; j &lt; 32; j++)</span><br><span class="line">		&#123;</span><br><span class="line">			if (0x10 == gamedata[i][j])</span><br><span class="line">				break;</span><br><span class="line">			xypos[0] = gamex + j * 16;</span><br><span class="line">			xypos[1] = gamey + i * 16;</span><br><span class="line">			if (0x8F != gamedata[i][j])</span><br><span class="line">			&#123;</span><br><span class="line">				::PostMessage(hWnd, WM_LBUTTONDOWN,MK_LBUTTON,*(int *)xypos);</span><br><span class="line">				::PostMessage(hWnd, WM_LBUTTONUP,0,*(int *)xypos);</span><br><span class="line">			&#125;</span><br><span class="line">			strTemp.Format(_T(&quot;%02X &quot;), gamedata[i][j]);</span><br><span class="line">			m_strshowdata += strTemp;</span><br><span class="line">		&#125;</span><br><span class="line">		m_strshowdata += _T(&quot;\r\n&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="5植物大战僵尸"><a class="markdownIt-Anchor" href="#5植物大战僵尸">#</a> 5. 植物大战僵尸</h3>
<p>1. 找阳光地址和基地址</p>
<p>某一个程序每次运行都不改变的地址（基地址）里面存着阳光的地址</p>
<p>我们需要找到不会改变的地址，通过偏移拿到阳光的地址</p>
<p>1. 通过 ce 找到阳光地址，并且在 od 中定位</p>
<p>dd 0F2EE158</p>
<p>2. 下内存写入断点</p>
<p>要是 CE 找的地址在 OD 中没有这个地址的话请在 CE 地址右键谁改写了此地址然后对照着到 OD 找</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221201211117079.png" alt="image-20221201211117079"></p>
<p>第一个偏移地址</p>
<p>阳光地址 0EDD32F8</p>
<p>当前阳光地址 = eax + 0x5560     eax=0EDCDD98</p>
<p>00430A11  |.  0188 60550000 add     dword ptr [eax+5560], ecx</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221202195211747.png" alt="image-20221202195211747"></p>
<p>第二个偏移地址，找到谁改了 eax=0EDCDD98 的值</p>
<p>还是去下内存断点</p>
<p>00538090  |&gt; \8B01          |mov     eax, dword ptr [ecx]          ;  PlantsVs.00656CA8</p>
<p>ecx = 0EDCDD98</p>
<p>eax = [ecx+5560]</p>
<p>第三个偏移地址</p>
<p>0053807D  |.  8B49 08       |mov     ecx, dword ptr [ecx+8]</p>
<p>eax = [[ecx+8]+5560]     0EDCDD98</p>
<p>基地址 [[6A9EC0]+768]+5560</p>
<p>2. 分析金币基地址</p>
<p>通过 ce 工具收集游戏金币基地址</p>
<p>可能和金币 1:1，也可能是其他比例</p>
<p>金币显示的值不是数字 1:1 对应关系，我们只能通过范围搜素定位金币地址</p>
<p>金币的地址不是绿色的基地址所有，所以我们需要找到基地址 + 偏移地址表示他</p>
<p>第一个偏移地址 06BA60A0</p>
<p>0041A3BB - 8B 41 28  - mov eax,[ecx+28]         ECX=06BA6078</p>
<p>金币的地址 = ecx  + 28</p>
<p>第二个偏移地址</p>
<p>0040EB41 - 8B 88 2C080000  - mov ecx,[eax+0000082C]        EAX=02101E48</p>
<p>金币地址 = [eax+0000082c]+28</p>
<p>第三个偏移地址</p>
<p>00467B00 - 8B 0D C09E6A00  - mov ecx,[006A9EC0]</p>
<p>金币地址 =[[006A9EC0]+82c]+28</p>
<p>3. 分析植物安放冷却时间</p>
<p>第一步</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0048728C - 83 47 24 01           - add dword ptr [edi+24],01 &#123; 1 &#125;</span><br><span class="line">00487290 - 8B 47 24              - mov eax,[edi+24]</span><br><span class="line">00487293 - 3B 47 28              - cmp eax,[edi+28]</span><br><span class="line">00487296 - 7E 14                 - jle 004872AC</span><br><span class="line">00487298 - C7 47 24 00000000     - mov [edi+24],00000000 &#123; 0 &#125;</span><br><span class="line">0048729F - C6 47 49 00           - mov byte ptr [edi+49],00 &#123; 0 &#125;</span><br><span class="line">004872A3 - C6 47 48 01           - mov byte ptr [edi+48],01 &#123; 1 &#125;</span><br><span class="line">004872A7 - E8 E4FEFFFF           - call 00487190</span><br><span class="line">004872AC - 8B 47 3C              - mov eax,[edi+3C]</span><br><span class="line"></span><br><span class="line">0BE14EC0</span><br></pre></td></tr></table></figure>
<p>CD 计数器地址 = edi + 24</p>
<p>CD 计数器上线 = edi + 28</p>
<p>思路一：该计数器上限的值，缩短冷却时间</p>
<p>思路二：改写代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0048728C - 83 47 24 01           - add dword ptr [edi+24],01 &#123; 1 &#125;</span><br><span class="line">00487290 - 8B 47 24              - mov eax,[edi+24]</span><br><span class="line">00487293 - 3B 47 28              - cmp eax,[edi+28]</span><br><span class="line">00487296 - 90                    - nop </span><br><span class="line">00487297 - 90                    - nop </span><br><span class="line">00487298 - C7 47 24 00000000     - mov [edi+24],00000000 &#123; 0 &#125;</span><br><span class="line">0048729F - C6 47 49 00           - mov byte ptr [edi+49],00 &#123; 0 &#125;</span><br><span class="line">004872A3 - C6 47 48 01           - mov byte ptr [edi+48],01 &#123; 1 &#125;</span><br><span class="line">004872A7 - E8 E4FEFFFF           - call 00487190</span><br><span class="line">004872AC - 8B 47 3C              - mov eax,[edi+3C]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3. 分析大嘴花吞噬时间代码</p>
<p>1. 定位大嘴花吞噬时间计数器变量的地址</p>
<p>2. 通过 ce 或者 od 定位谁访问了这个地址，从而定位到判断大嘴花吞噬冷却时间的代码</p>
<p 0="">00461561 - 83 7F 54 00           - cmp dword ptr [edi+54],00</p>
<p>00461565 - 75 5F                     - jne 004615C6</p>
<p>4. 分析种植植物 call</p>
<p>思路：找出安放植物的 call</p>
<p>1. 通过鼠标右键选中植物的地址</p>
<p>2. 分析 call 代码参数及堆栈</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00410A91 - 8B 40 28              - mov eax,[eax+28]</span><br><span class="line">00410A94 - 52                    - push edx</span><br><span class="line">00410A95 - 50                    - push eax</span><br><span class="line">00410A96 - 8B 44 24 20           - mov eax,[esp+20]</span><br><span class="line">00410A9A - 57                    - push edi</span><br><span class="line">00410A9B - 55                    - push ebp</span><br><span class="line">00410A9C - E8 7FC6FFFF           - call 0040D120</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">push -1</span><br><span class="line">push 3</span><br><span class="line">mov eax,1</span><br><span class="line">push 2</span><br><span class="line">push 0EC01BD0</span><br><span class="line">call 0040D120</span><br></pre></td></tr></table></figure>
<p>3. 注入代码，将自己写的植物安放的汇编代码注入到游戏进程空间中，验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">push -1     ;固定的值</span><br><span class="line">push 2      ;植物类型id,樱桃是2 </span><br><span class="line">mov eax,4   ;x</span><br><span class="line">push 4      ;y</span><br><span class="line">push 147E5FF8    ;[[6A9EC0]+768]</span><br><span class="line">push 0040D120</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>坐标范围为 [4][8] = 5 * 9 = 45</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push -1     ;固定的值</span><br><span class="line">push 2      ;植物类型id,樱桃是2,坚果3</span><br><span class="line">mov eax,0   ;y 0-4</span><br><span class="line">push 4      ;x 0-8</span><br><span class="line">mov ebx,[6A9EC0]</span><br><span class="line">mov ebx,[ebx+768]</span><br><span class="line">push ebx</span><br><span class="line">push 0040D120</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">push -1</span><br><span class="line">push 2</span><br><span class="line">mov eax,0</span><br><span class="line">push 2</span><br><span class="line">mov ebx,[6A9EC0]</span><br><span class="line">mov ebx,[ebx+768]</span><br><span class="line">push ebx</span><br><span class="line">call 0040D120</span><br></pre></td></tr></table></figure>
<p>5. 远程注入代码</p>
<p>1. 打开目标进程 OpenProcess，获取目标进程句柄</p>
<p>2. 在目标进程分配内存空间 VirtualAllocEx</p>
<p>3. 往分配的内存空间中写入代码</p>
<p>4. 远程调用 CreateRemoteThread  执行目标进程指定地址的代码</p>
<p>5. 等待远程线程执行完成  WaitForSingleObject</p>
<p>6. 释放目标进程空间   VirtualFreeEx</p>
<p>7. 关闭目标进程句柄</p>
<p>植物血量</p>
<p>后台运行  有一个标识 1,0</p>
<p>关键代码位置 0054E1C2，  0F 95 C0  -&gt; B1 01 90</p>
<p>毁灭菇</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210004852205.png" alt="image-20221210004852205"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210004902774.png" alt="image-20221210004902774"></p>
<p>排错思路：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210211445273.png" alt="image-20221210211445273"></p>
<p>到 od 中找到对应位置，查看我们插入的额汇编是否正确</p>
<p>冰冻</p>
<p>土豆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br></pre></td><td class="code"><pre><span class="line">// plantDlg.cpp : 实现文件</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;plant.h&quot;</span><br><span class="line">#include &quot;plantDlg.h&quot;</span><br><span class="line"></span><br><span class="line">#ifdef _DEBUG</span><br><span class="line">#define new DEBUG_NEW</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 用于应用程序“关于”菜单项的 CAboutDlg 对话框</span><br><span class="line"></span><br><span class="line">class CAboutDlg : public CDialog</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	CAboutDlg();</span><br><span class="line"></span><br><span class="line">// 对话框数据</span><br><span class="line">	enum &#123; IDD = IDD_ABOUTBOX &#125;;</span><br><span class="line"></span><br><span class="line">	protected:</span><br><span class="line">	virtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class="line"></span><br><span class="line">// 实现</span><br><span class="line">protected:</span><br><span class="line">	DECLARE_MESSAGE_MAP()</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">CAboutDlg::CAboutDlg() : CDialog(CAboutDlg::IDD)</span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CAboutDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CAboutDlg, CDialog)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CplantDlg 对话框</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CplantDlg::CplantDlg(CWnd* pParent /*=NULL*/)</span><br><span class="line">	: CDialog(CplantDlg::IDD, pParent)</span><br><span class="line">	, m_edit_sun(9999)</span><br><span class="line">	, m_edit_gold(9999)</span><br><span class="line">	, m_nocd(FALSE)</span><br><span class="line">	, m_bigmouth_nocd(FALSE)</span><br><span class="line">	, m_x(0)</span><br><span class="line">	, m_y(0)</span><br><span class="line">	, m_noblood(FALSE)</span><br><span class="line">	, no_run(FALSE)</span><br><span class="line">	, no_pit(FALSE)</span><br><span class="line">	, m_nomubei(FALSE)</span><br><span class="line">	, m_tudou(FALSE)</span><br><span class="line">	, m_frozen(FALSE)</span><br><span class="line">&#123;</span><br><span class="line">	m_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::DoDataExchange(pDX);</span><br><span class="line">	DDX_Text(pDX, IDC_EDIT1, m_edit_sun);</span><br><span class="line">	DDX_Text(pDX, IDC_EDIT2, m_edit_gold);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK1, m_nocd);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK2, m_bigmouth_nocd);</span><br><span class="line">	DDX_Text(pDX, IDC_EDIT3, m_x);</span><br><span class="line">	DDX_Text(pDX, IDC_EDIT4, m_y);</span><br><span class="line">	DDX_Control(pDX, IDC_COMBO1, m_cbPlantsChoose);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK3, m_noblood);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK4, no_run);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK5, no_pit);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK6, m_nomubei);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK7, m_tudou);</span><br><span class="line">	DDX_Check(pDX, IDC_CHECK8, m_frozen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BEGIN_MESSAGE_MAP(CplantDlg, CDialog)</span><br><span class="line">	ON_WM_SYSCOMMAND()</span><br><span class="line">	ON_WM_PAINT()</span><br><span class="line">	ON_WM_QUERYDRAGICON()</span><br><span class="line">	//&#125;&#125;AFX_MSG_MAP</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON1, &amp;CplantDlg::OnBnClickedButton1)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON2, &amp;CplantDlg::OnBnClickedButton2)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON3, &amp;CplantDlg::OnBnClickedButton3)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON4, &amp;CplantDlg::OnBnClickedButton4)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK1, &amp;CplantDlg::OnBnClickedCheck1)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK2, &amp;CplantDlg::OnBnClickedCheck2)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON5, &amp;CplantDlg::OnBnClickedButton5)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON6, &amp;CplantDlg::OnBnClickedButton6)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK3, &amp;CplantDlg::OnBnClickedCheck3)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK4, &amp;CplantDlg::OnBnClickedCheck4)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK5, &amp;CplantDlg::OnBnClickedCheck5)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK6, &amp;CplantDlg::OnBnClickedCheck6)</span><br><span class="line">	ON_BN_CLICKED(IDC_BUTTON7, &amp;CplantDlg::OnBnClickedButton7)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK7, &amp;CplantDlg::OnBnClickedCheck7)</span><br><span class="line">	ON_BN_CLICKED(IDC_CHECK8, &amp;CplantDlg::OnBnClickedCheck8)</span><br><span class="line">END_MESSAGE_MAP()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// CplantDlg 消息处理程序</span><br><span class="line"></span><br><span class="line">BOOL CplantDlg::OnInitDialog()</span><br><span class="line">&#123;</span><br><span class="line">	CDialog::OnInitDialog();</span><br><span class="line"></span><br><span class="line">	// 将“关于...”菜单项添加到系统菜单中。</span><br><span class="line"></span><br><span class="line">	// IDM_ABOUTBOX 必须在系统命令范围内。</span><br><span class="line">	ASSERT((IDM_ABOUTBOX &amp; 0xFFF0) == IDM_ABOUTBOX);</span><br><span class="line">	ASSERT(IDM_ABOUTBOX &lt; 0xF000);</span><br><span class="line"></span><br><span class="line">	enableDebugPriv();</span><br><span class="line"></span><br><span class="line">	CMenu* pSysMenu = GetSystemMenu(FALSE);</span><br><span class="line">	if (pSysMenu != NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		CString strAboutMenu;</span><br><span class="line">		strAboutMenu.LoadString(IDS_ABOUTBOX);</span><br><span class="line">		if (!strAboutMenu.IsEmpty())</span><br><span class="line">		&#123;</span><br><span class="line">			pSysMenu-&gt;AppendMenu(MF_SEPARATOR);</span><br><span class="line">			pSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// 设置此对话框的图标。当应用程序主窗口不是对话框时，框架将自动</span><br><span class="line">	//  执行此操作</span><br><span class="line">	SetIcon(m_hIcon, TRUE);			// 设置大图标</span><br><span class="line">	SetIcon(m_hIcon, FALSE);		// 设置小图标</span><br><span class="line"></span><br><span class="line">	// TODO: 在此添加额外的初始化代码</span><br><span class="line">	addPlantsToCombox();</span><br><span class="line"></span><br><span class="line">	return TRUE;  // 除非将焦点设置到控件，否则返回 TRUE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnSysCommand(UINT nID, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">	if ((nID &amp; 0xFFF0) == IDM_ABOUTBOX)</span><br><span class="line">	&#123;</span><br><span class="line">		CAboutDlg dlgAbout;</span><br><span class="line">		dlgAbout.DoModal();</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		CDialog::OnSysCommand(nID, lParam);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如果向对话框添加最小化按钮，则需要下面的代码</span><br><span class="line">//  来绘制该图标。对于使用文档/视图模型的 MFC 应用程序，</span><br><span class="line">//  这将由框架自动完成。</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnPaint()</span><br><span class="line">&#123;</span><br><span class="line">	if (IsIconic())</span><br><span class="line">	&#123;</span><br><span class="line">		CPaintDC dc(this); // 用于绘制的设备上下文</span><br><span class="line"></span><br><span class="line">		SendMessage(WM_ICONERASEBKGND, reinterpret_cast&lt;WPARAM&gt;(dc.GetSafeHdc()), 0);</span><br><span class="line"></span><br><span class="line">		// 使图标在工作区矩形中居中</span><br><span class="line">		int cxIcon = GetSystemMetrics(SM_CXICON);</span><br><span class="line">		int cyIcon = GetSystemMetrics(SM_CYICON);</span><br><span class="line">		CRect rect;</span><br><span class="line">		GetClientRect(&amp;rect);</span><br><span class="line">		int x = (rect.Width() - cxIcon + 1) / 2;</span><br><span class="line">		int y = (rect.Height() - cyIcon + 1) / 2;</span><br><span class="line"></span><br><span class="line">		// 绘制图标</span><br><span class="line">		dc.DrawIcon(x, y, m_hIcon);</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		CDialog::OnPaint();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//当用户拖动最小化窗口时系统调用此函数取得光标</span><br><span class="line">//显示。</span><br><span class="line">HCURSOR CplantDlg::OnQueryDragIcon()</span><br><span class="line">&#123;</span><br><span class="line">	return static_cast&lt;HCURSOR&gt;(m_hIcon);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD CplantDlg::FindGameProcessidByWndTitle(CString strTitle)</span><br><span class="line">&#123;</span><br><span class="line">	DWORD pid = 0;</span><br><span class="line">	HWND hWnd = ::FindWindow(NULL, strTitle.GetBuffer());   //找到窗口</span><br><span class="line">	if (NULL == hWnd)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;未找到指定游戏&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	GetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class="line">	return pid;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton1()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	// 计算基地址  [[6A9EC0]+768]+5560</span><br><span class="line">	DWORD dwTemp = 0;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dwTemp += 0x768;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD dwsun = 99999;</span><br><span class="line">	dwTemp += 0x5560;</span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwsun, sizeof(DWORD), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton2()</span><br><span class="line">&#123;</span><br><span class="line">// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	// 计算基地址  [[006A9EC0]+82c]+28</span><br><span class="line">	DWORD dwTemp = 0;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dwTemp += 0x82c;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD dwGold = 99999;</span><br><span class="line">	dwTemp += 0x28;</span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwGold, sizeof(DWORD), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton3()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	// 计算基地址  [[6A9EC0]+768]+5560</span><br><span class="line">	DWORD dwTemp = 0;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dwTemp += 0x768;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD dwsun = m_edit_sun;</span><br><span class="line">	dwTemp += 0x5560;</span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwsun, sizeof(DWORD), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton4()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	// 计算基地址  [[006A9EC0]+82c]+28</span><br><span class="line">	DWORD dwTemp = 0;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	dwTemp += 0x82c;</span><br><span class="line">	if (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	DWORD dwGold = m_edit_gold;;</span><br><span class="line">	dwTemp += 0x28;</span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwGold, sizeof(DWORD), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck1()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">		// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	// 00487296 - 7E 14                 - jle 004872AC  植物cd判断跳转代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[2] = &#123; 0 &#125;;</span><br><span class="line">	if (m_nocd)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x7E;</span><br><span class="line">		buf[1] = 0x14;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x00487296), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck2()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	//00461565 - 75 5F   - jne 004615C6</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[2] = &#123; 0 &#125;;</span><br><span class="line">	if (m_bigmouth_nocd)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x75;</span><br><span class="line">		buf[1] = 0x5f;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x00461565), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># if 0 </span><br><span class="line">// 裸函数，不需要编译器添加任何代码</span><br><span class="line">__declspec(naked) void putPlant()</span><br><span class="line">&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		pushad</span><br><span class="line">		push -1</span><br><span class="line">		push 2</span><br><span class="line">		mov eax, 4</span><br><span class="line">		push 4</span><br><span class="line">		mov ebx, ds:[0x6A9EC0]</span><br><span class="line">		mov ebx, ds:[ebx + 0x768]</span><br><span class="line">		push ebx</span><br><span class="line">		mov edx, 0x40D120</span><br><span class="line">		call edx</span><br><span class="line">		popad</span><br><span class="line">		ret</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton5()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	// 打开目标进程</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	// 在目标进程分配内存空间</span><br><span class="line">	PVOID ThreadFunAdd = VirtualAllocEx(hProcess, NULL, 4096, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line"></span><br><span class="line">	// 往分配的内存空间中写入代码</span><br><span class="line">	DWORD byWrite = 0;</span><br><span class="line">	bool bret = WriteProcessMemory(hProcess, ThreadFunAdd, putPlant, 4096, &amp;byWrite);</span><br><span class="line"></span><br><span class="line">	// 执行目标进程指定地址的代码</span><br><span class="line">	CreateRemoteThread(hProcess, NULL, NULL, (LPTHREAD_START_ROUTINE)ThreadFunAdd, NULL, NULL, NULL);</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bool CplantDlg::enableDebugPriv()</span><br><span class="line">&#123;</span><br><span class="line">	HANDLE hToken;</span><br><span class="line">	LUID sedebugnameValue;</span><br><span class="line">	TOKEN_PRIVILEGES tkp;</span><br><span class="line"></span><br><span class="line">	if (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken))</span><br><span class="line">	&#123;</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	if (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;sedebugnameValue))</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hToken);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	tkp.PrivilegeCount = 1;</span><br><span class="line">	tkp.Privileges[0].Luid = sedebugnameValue;</span><br><span class="line">	tkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class="line"></span><br><span class="line">	if (!AdjustTokenPrivileges(hToken, FALSE, &amp;tkp, sizeof(tkp), NULL, NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		CloseHandle(hToken);</span><br><span class="line">		return false;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CplantDlg::addPlantsToCombox()</span><br><span class="line">&#123;	</span><br><span class="line">	int i = 0;</span><br><span class="line">	i = m_cbPlantsChoose.AddString(_T(&quot;樱桃炸弹&quot;));</span><br><span class="line">	m_cbPlantsChoose.SetItemData(i, 2);</span><br><span class="line">	i = m_cbPlantsChoose.AddString(_T(&quot;毁灭菇&quot;));</span><br><span class="line">	m_cbPlantsChoose.SetItemData(i, 15);</span><br><span class="line">	i = m_cbPlantsChoose.AddString(_T(&quot;寒冰菇&quot;));</span><br><span class="line">	m_cbPlantsChoose.SetItemData(i, 14);</span><br><span class="line">	i = m_cbPlantsChoose.AddString(_T(&quot;魅惑菇&quot;));</span><br><span class="line">	m_cbPlantsChoose.SetItemData(i, 12);</span><br><span class="line">	i = m_cbPlantsChoose.AddString(_T(&quot;坚果墙&quot;));</span><br><span class="line">	m_cbPlantsChoose.SetItemData(i, 3);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">typedef struct PutPlantsPareame</span><br><span class="line">&#123;</span><br><span class="line">	UINT u_x;</span><br><span class="line">	UINT u_y;</span><br><span class="line">	UINT u_plantID;</span><br><span class="line">&#125;PutPlantsParame,*PPutPlantsPareame;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DWORD __stdcall CplantDlg::PutPlants(LPVOID lpThreadParame)</span><br><span class="line">&#123;</span><br><span class="line">	PPutPlantsPareame pParame = (PPutPlantsPareame)lpThreadParame;</span><br><span class="line">	UINT u_x = pParame-&gt;u_x;</span><br><span class="line">	UINT u_y = pParame-&gt;u_x;</span><br><span class="line">	UINT u_plantid = pParame-&gt;u_plantID;</span><br><span class="line"></span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		pushad</span><br><span class="line">		push -1</span><br><span class="line">		push u_plantid</span><br><span class="line">		mov eax, u_x</span><br><span class="line">		push u_y</span><br><span class="line">		mov ebx, dword ptr ds:[0x6A9EC0]</span><br><span class="line">		mov ebx, dword ptr ds:[ebx + 0x768]</span><br><span class="line">		push ebx</span><br><span class="line">		mov edx, 0x0040D120</span><br><span class="line">		call edx</span><br><span class="line">		popad</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int CplantDlg::GetPlantsIDByName(CString name)</span><br><span class="line">&#123;</span><br><span class="line">	int i = m_cbPlantsChoose.FindString(-1, name);</span><br><span class="line">	return m_cbPlantsChoose.GetItemData(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton5()</span><br><span class="line">&#123;</span><br><span class="line">	UpdateData(TRUE);   //从页面读取变量</span><br><span class="line">	CString strPlantName = _T(&quot;&quot;);</span><br><span class="line">	DWORD dwPlantID = 0;</span><br><span class="line">	DWORD dwPid = 0;</span><br><span class="line"></span><br><span class="line">	m_cbPlantsChoose.GetWindowText(strPlantName);</span><br><span class="line">	dwPlantID = GetPlantsIDByName(strPlantName);</span><br><span class="line"></span><br><span class="line">	//打开进程</span><br><span class="line">	dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line"></span><br><span class="line">	//远程调用参数</span><br><span class="line">	PutPlantsPareame parame;</span><br><span class="line">	parame.u_plantID = dwPlantID;</span><br><span class="line">	parame.u_x = m_x;</span><br><span class="line">	parame.u_y = m_y;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	if (!InjectRemoteFunc(dwPid, PutPlants, &amp;parame, sizeof(parame)))</span><br><span class="line">		MessageBox(_T(&quot;远程调用失败&quot;), NULL, 0);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOL CplantDlg::InjectRemoteFunc(DWORD dwPid, LPVOID mFunc, LPVOID pRemoteParam, DWORD dwParameSize, DWORD dwWaitTime)</span><br><span class="line">&#123;</span><br><span class="line">	HANDLE hProcess = NULL;</span><br><span class="line">	LPVOID ThreadAdd = NULL;</span><br><span class="line">	DWORD lpNumberofBytes = 0;</span><br><span class="line">	BOOL bret = FALSE, bSucc = TRUE;</span><br><span class="line">	LPVOID ParamAdd = NULL;</span><br><span class="line">	HANDLE hThread = NULL;</span><br><span class="line">	DWORD dwWait = 0;</span><br><span class="line"></span><br><span class="line">	do</span><br><span class="line">	&#123;</span><br><span class="line">		//打开被注入的进程</span><br><span class="line">		hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">		if (NULL == hProcess) break;</span><br><span class="line"></span><br><span class="line">		//装载函数的空间</span><br><span class="line">		ThreadAdd = VirtualAllocEx(hProcess, NULL, 4096, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class="line">		if (NULL == ThreadAdd) break;</span><br><span class="line"></span><br><span class="line">		//写入函数</span><br><span class="line">		bret = WriteProcessMemory(hProcess, ThreadAdd, mFunc, 4096, &amp;lpNumberofBytes);</span><br><span class="line">		if (FALSE == bret) break;</span><br><span class="line"></span><br><span class="line">		if (0 != dwParameSize)</span><br><span class="line">		&#123;</span><br><span class="line">			//装在函数所需要的参数空间</span><br><span class="line">			ParamAdd = VirtualAllocEx(hProcess, NULL, dwParameSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class="line">			if (NULL == ParamAdd) break;</span><br><span class="line">			</span><br><span class="line">			//写入参数地址</span><br><span class="line">			bret = WriteProcessMemory(hProcess, ParamAdd, pRemoteParam, dwParameSize, &amp;lpNumberofBytes);</span><br><span class="line">			if (FALSE == bret) break;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		// 创建远程线程</span><br><span class="line">		hThread = CreateRemoteThread(hProcess, NULL, NULL, (LPTHREAD_START_ROUTINE)ThreadAdd, ParamAdd, NULL, &amp;lpNumberofBytes);</span><br><span class="line">		if (NULL == hThread) break;</span><br><span class="line"></span><br><span class="line">		bSucc = TRUE;</span><br><span class="line"></span><br><span class="line">	&#125; while (FALSE);</span><br><span class="line"></span><br><span class="line">	//等待线程结束</span><br><span class="line">	if (bSucc)</span><br><span class="line">	&#123;</span><br><span class="line">		dwWait = WaitForSingleObject(hThread, dwWaitTime);</span><br><span class="line">		if (WAIT_TIMEOUT == dwWait) goto end;   //如果超时放弃释放资源，防止目标进程在使用</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	//释放目标线程中分配的资源</span><br><span class="line">	if (bSucc &amp;&amp; ThreadAdd &amp;&amp; hProcess)</span><br><span class="line">		VirtualFreeEx(hProcess, ThreadAdd, 0, MEM_RELEASE);</span><br><span class="line"></span><br><span class="line">	if (bSucc &amp;&amp; (0 != dwParameSize) &amp;&amp; pRemoteParam &amp;&amp; hProcess)</span><br><span class="line">	&#123;</span><br><span class="line">		VirtualFreeEx(hProcess, pRemoteParam, 0, MEM_RELEASE);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">end:</span><br><span class="line">	if (NULL != hThread) CloseHandle(hThread);</span><br><span class="line">	if (NULL != hProcess) CloseHandle(hProcess);</span><br><span class="line"></span><br><span class="line">	return bSucc;</span><br><span class="line"></span><br><span class="line">	//如果使用stdcall,，然后WriteProcessMemory使用单独计算的地址，我的程序会崩溃，只知道是写入多了很多编译器加的代码，但这些代码为什么会出错暂时没找到原因</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton6()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck3()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[4] = &#123; 0 &#125;;</span><br><span class="line">	if (m_noblood)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x83;</span><br><span class="line">		buf[1] = 0x46;</span><br><span class="line">		buf[2] = 0x40;</span><br><span class="line">		buf[3] = 0x01;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x83;</span><br><span class="line">		buf[1] = 0x46;</span><br><span class="line">		buf[2] = 0x40;</span><br><span class="line">		buf[3] = 0xFC;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052FCF0), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck4()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[3] = &#123; 0 &#125;;</span><br><span class="line">	if (m_noblood)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">		buf[2] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x0F;</span><br><span class="line">		buf[1] = 0x95;</span><br><span class="line">		buf[2] = 0xC0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052FCF0), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck5()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[2] = &#123; 0 &#125;;</span><br><span class="line">	if (no_pit)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x75;</span><br><span class="line">		buf[1] = 0x05;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0041D79E), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck6()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[2] = &#123; 0 &#125;;</span><br><span class="line">	if (m_nomubei)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x75;</span><br><span class="line">		buf[1] = 0x5F;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0045FD07), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD __stdcall CplantDlg::PutAllPlants(LPVOID lpThreadParame)</span><br><span class="line">&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		pushad</span><br><span class="line">		push -1</span><br><span class="line">		push 2</span><br><span class="line">		mov eax, 1</span><br><span class="line">		push 1</span><br><span class="line">		mov ebx, dword ptr ds:[0x6A9EC0]</span><br><span class="line">		mov ebx, dword ptr ds:[ebx + 0x768]</span><br><span class="line">		push ebx</span><br><span class="line">		mov edx, 0x0040D120</span><br><span class="line">		call edx</span><br><span class="line">		popad</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedButton7()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);   //从页面读取变量</span><br><span class="line">	CString strPlantName = _T(&quot;&quot;);</span><br><span class="line">	DWORD dwPlantID = 0;</span><br><span class="line">	DWORD dwPid = 0;</span><br><span class="line"></span><br><span class="line">	m_cbPlantsChoose.GetWindowText(strPlantName);</span><br><span class="line">	dwPlantID = GetPlantsIDByName(strPlantName);</span><br><span class="line"></span><br><span class="line">	//打开进程</span><br><span class="line">	dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line"></span><br><span class="line">	//远程调用参数</span><br><span class="line">	PutPlantsPareame parame;</span><br><span class="line">	parame.u_plantID = dwPlantID;</span><br><span class="line">	parame.u_x = m_x;</span><br><span class="line">	parame.u_y = m_y;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	if (!InjectRemoteFunc(dwPid, PutAllPlants, &amp;parame, sizeof(parame)))</span><br><span class="line">		MessageBox(_T(&quot;远程调用失败&quot;), NULL, 0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck7()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[6] = &#123; 0 &#125;;</span><br><span class="line">	if (m_tudou)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x90;</span><br><span class="line">		buf[1] = 0x90;</span><br><span class="line">		buf[2] = 0x90;</span><br><span class="line">		buf[3] = 0x90;</span><br><span class="line">		buf[4] = 0x90;</span><br><span class="line">		buf[5] = 0x90;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x0F;</span><br><span class="line">		buf[1] = 0x85;</span><br><span class="line">		buf[2] = 0xFA;</span><br><span class="line">		buf[3] = 0x01;</span><br><span class="line">		buf[4] = 0x00;</span><br><span class="line">		buf[5] = 0x00;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0045FE53), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void CplantDlg::OnBnClickedCheck8()</span><br><span class="line">&#123;</span><br><span class="line">	// TODO: 在此添加控件通知处理程序代码</span><br><span class="line">	UpdateData(TRUE);</span><br><span class="line">	DWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class="line">	HANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class="line">	if (!hProcess)    //处理未找到时操作</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	UCHAR buf[3] = &#123; 0 &#125;;</span><br><span class="line">	if (m_frozen)</span><br><span class="line">	&#123;</span><br><span class="line">		//nop nop</span><br><span class="line">		//禁用cd</span><br><span class="line">		buf[0] = 0x83;</span><br><span class="line">		buf[1] = 0xC0;</span><br><span class="line">		buf[2] = 0x01;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		//7e 14 </span><br><span class="line">		//启用cd时间</span><br><span class="line">		buf[0] = 0x83;</span><br><span class="line">		buf[1] = 0xC0;</span><br><span class="line">		buf[2] = 0xFD;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	if (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052B41F), buf, sizeof(buf), NULL))</span><br><span class="line">	&#123;</span><br><span class="line">		::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class="line">		CloseHandle(hProcess);</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	CloseHandle(hProcess);</span><br><span class="line">	UpdateData(FALSE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="6网游辅助实战训练"><a class="markdownIt-Anchor" href="#6网游辅助实战训练">#</a> 6. 网游辅助实战训练</h3>
<p>LoadLibrary    // 加载模块</p>
<p>FreeLibrary    // 卸载模块</p>
<p>CreateRemoteThread    // 创建远程线程</p>
<p>GetModuleHandle      // 通过模块名称获取模块句柄</p>
<h4 id="角色人物分析"><a class="markdownIt-Anchor" href="#角色人物分析">#</a> 角色人物分析</h4>
<p>角色名</p>
<p>血量</p>
<p>魔法</p>
<p>等级</p>
<p>职业</p>
<p>找人物的属性信息，其实是找 this 指针，通过偏移来找人物属性</p>
<p>1. 人物真气</p>
<p>1.CE 搜索真气值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">00B2CC25 - 89 86 8C070000        - mov [esi+0000078C],eax</span><br><span class="line">eax = 00000212</span><br><span class="line">esi = 15E71F60   5B14C038</span><br><span class="line">当前血量 = [esi + 78C]</span><br><span class="line"></span><br><span class="line">00B2CB07 - 8B F1                 - mov esi,ecx</span><br><span class="line">ECX = 514FA270</span><br><span class="line">当前血量 = [ECX + 78C]</span><br><span class="line"></span><br><span class="line">00B37131 - 56                    - push esi</span><br><span class="line">00B37132 - E8 C959FFFF           - call 00B2CB00</span><br><span class="line">00B37137 - B0 01                 - mov al,01 &#123; 1 &#125;</span><br><span class="line">ecx = 514FA270</span><br><span class="line"></span><br><span class="line">00BEF846 - 8B 10                 - mov edx,[eax]</span><br><span class="line">00BEF848 - FF 52 68              - call dword ptr [edx+68]</span><br><span class="line">00BEF84B - B0 01                 - mov al,01 &#123; 1 &#125;</span><br><span class="line">ecx = 514FA270</span><br><span class="line"></span><br><span class="line">00BEF844 - 8B C8                 - mov ecx,eax</span><br><span class="line">eax = 514FA270</span><br><span class="line">当前血量 = [EAX + 78C]</span><br><span class="line"></span><br><span class="line">00BED9C0 - 8B 41 08              - mov eax,[ecx+08]</span><br><span class="line">eax = 265489C0 ecx = 063A9708</span><br><span class="line">00BED9C3 - 8B 40 30              - mov eax,[eax+30]</span><br><span class="line">00BED9C6 - C3                    - ret </span><br><span class="line">eax = 514FA270</span><br><span class="line">当前血量 = [[[ecx+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00BEFDBB  | E8 00DCFFFF          | call elementclient.BED9C0                 |</span><br><span class="line"></span><br><span class="line">00BEFDB9  | 8BCB                 | mov ecx,ebx                               |</span><br><span class="line">当前血量 = [[[ebx+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00BEFBCB  | 8BD9                 | mov ebx,ecx                               |</span><br><span class="line">当前血量 = [[[ecx+08]+30] + 78C]</span><br><span class="line">BCB F51</span><br><span class="line"></span><br><span class="line">009BBED5  | FFD0                 | call eax                                  |</span><br><span class="line"></span><br><span class="line">009BBECB  | 8B0F                 | mov ecx,dword ptr ds:[edi]                |</span><br><span class="line">当前血量 = [[[[edi]+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">009BBEC1  | 83C7 1C              | add edi,1C                                |</span><br><span class="line">当前血量 = [[[[edi+1c]+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">009BBEB9  | 8B78 1C              | mov edi,dword ptr ds:[eax+1C]             |</span><br><span class="line">当前血量 = [[[[[eax+1C]+1c]+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">009BBEAE  | 8B40 1C              | mov eax,dword ptr ds:[eax+1C]             | eax:&quot;ff&amp;?&quot;</span><br><span class="line">当前血量 = [[[[[[eax+1C]+1C]+1c]+08]+30] + 78C]</span><br><span class="line"></span><br><span class="line">009BBEA4  | A1 A8DD4F01          | mov eax,dword ptr ds:[14FDDA8]            |</span><br><span class="line">当前血量 = [[[[[[[14FDDA8]+1C]+1C]+1C]+08]+30] + 78C]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">00B2E1C5 - 89 86 8C070000        - mov [esi+0000078C],eax</span><br><span class="line">esi = 4098A518</span><br><span class="line">当前血量 = [esi + 78C]</span><br><span class="line"></span><br><span class="line">00B2E0A7  | 8BF1                    | mov esi,ecx                          |</span><br><span class="line">当前血量 = [ecx + 78C]</span><br><span class="line"></span><br><span class="line">00B38612  | E8 895AFFFF             | call elementclient.B2E0A0            |</span><br><span class="line">ecx = 4098A518</span><br><span class="line"></span><br><span class="line">00BF0808  | FF52 68                 | call dword ptr ds:[edx+68]           | </span><br><span class="line"></span><br><span class="line">00BF0804  | 8BC8                    | mov ecx,eax                          |</span><br><span class="line">eax = 4098A518</span><br><span class="line">当前血量 = [eax + 78C]</span><br><span class="line"></span><br><span class="line">00BEE980  | 8B41 08                 | mov eax,dword ptr ds:[ecx+8]         |</span><br><span class="line">00BEE983  | 8B40 30                 | mov eax,dword ptr ds:[eax+30]        |</span><br><span class="line">00BEE986  | C3                      | ret                                  |</span><br><span class="line">当前血量 = [[[ecx+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00BE3ED9  | FF50 34                 | call dword ptr ds:[eax+34]           |</span><br><span class="line"></span><br><span class="line">00BE3ECB  | 8B4C88 1C               | mov ecx,dword ptr ds:[eax+ecx*4+1C]  |</span><br><span class="line">当前血量 = [[[[eax+ecx*4+1C]+8]+30] + 78C]</span><br><span class="line">eax = 08D8EF00</span><br><span class="line">ecx = 00000001</span><br><span class="line"></span><br><span class="line">00BE3EC1  | 8B46 04                 | mov eax,dword ptr ds:[esi+4]         |</span><br><span class="line">00BE3EC4  | 8B40 1C                 | mov eax,dword ptr ds:[eax+1C]        |</span><br><span class="line">当前血量 = [[[[[[esi+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00BE3E98  | 8BF1                    | mov esi,ecx                          |</span><br><span class="line">当前血量 = [[[[[[ecx+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A4A55E  | E8 0D991900             | call elementclient.BE3E70            |</span><br><span class="line"></span><br><span class="line">00A4A553  | 8B8F 98000000           | mov ecx,dword ptr ds:[edi+98]        |</span><br><span class="line">当前血量 = [[[[[[[edi+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A4A4E4  | 8BF9                    | mov edi,ecx                          |</span><br><span class="line">当前血量 = [[[[[[[ecx+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A4A1BF  | E8 1C030000             | call elementclient.A4A4E0            |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00A4A1B9  | 8BCE                    | mov ecx,esi                          |</span><br><span class="line">当前血量 = [[[[[[[esi+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A4A0B8  | 8BF1                    | mov esi,ecx                          |</span><br><span class="line">当前血量 = [[[[[[[ecx+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A3F231  | E8 7AAE0000             | call elementclient.A4A0B0            |</span><br><span class="line"></span><br><span class="line">00A3F22E  | 8B4F 1C                 | mov ecx,dword ptr ds:[edi+1C]        |</span><br><span class="line">当前血量 = [[[[[[[[edi+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A3EF57  | 8BF9                    | mov edi,ecx                          | </span><br><span class="line">当前血量 = [[[[[[[[ecx+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A3F840  | E8 0BF7FFFF             | call elementclient.A3EF50            |</span><br><span class="line"></span><br><span class="line">00A3F83E  | 8BCF                    | mov ecx,edi                          |</span><br><span class="line">当前血量 = [[[[[[[[edi+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00A3F7A5  | 8BF9                    | mov edi,ecx                          |</span><br><span class="line">当前血量 = [[[[[[[[ecx+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line">00D35072  | E8 29A7D0FF             | call elementclient.A3F7A0            |</span><br><span class="line"></span><br><span class="line">00D3506D  | B9 F8845001             | mov ecx,elementclient.15084F8        |</span><br><span class="line">当前血量 = [[[[[[[[0x15084F8+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"> [[[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ + 78C 为血量</span><br><span class="line"></span><br><span class="line">$ + 7E4 为血量上限</span><br><span class="line"></span><br><span class="line">$ + 790 为真气</span><br><span class="line"></span><br><span class="line">$ + 7E8 为真气上限</span><br><span class="line"></span><br><span class="line">$ + 784 为等级</span><br><span class="line"></span><br><span class="line">$ + 794 为经验</span><br><span class="line"></span><br><span class="line">$ + 798 为元神</span><br><span class="line"></span><br><span class="line">??? $ + 79C 为元气上限</span><br><span class="line"></span><br><span class="line">$ + B00 / $ + B04 为角色姓名</span><br><span class="line"></span><br><span class="line">$ + 930 为银币</span><br></pre></td></tr></table></figure>
<p><img data-src="../../../AppData/Roaming/Typora/typora-user-images/image-20221222191354658.png" alt="image-20221222191354658"></p>
<p>如图可知，this 指针的基地址为 5F7FB0D8</p>
<p>$ + 78C 为血量</p>
<p>$ + 7E4 为血量上限</p>
<p>$ + 790 为真气</p>
<p>$ + 7E8 为真气上限</p>
<p>$ + 784 为等级</p>
<p>$ + 794 为经验</p>
<p>$ + 798 为元神</p>
<p>$ + 79C 为元气上限</p>
<p>34416B58</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">773       77+400=477   +3C  x</span><br><span class="line">177       17           +40  z</span><br><span class="line">-349      -34+550=516  +44  y</span><br></pre></td></tr></table></figure>
<p>搜索角色名称</p>
<p>方法 1</p>
<p>1.ce 搜索角色名称，注意，宽字节和窄字节都要考虑</p>
<p>2. 使用定位基地址的方式，一个一个关键点网上找</p>
<p>方法 2（在已知任务角色信息基地址的前提下）</p>
<p>在 ce 里面搜索</p>
<p>逐个分析这些地址，找出与任务角色基地址信息相近的地址，然后计算偏移</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221227170809963.png" alt="image-20221227170809963"></p>
<p>34417B58-34416B58=B00</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221227170851601.png" alt="image-20221227170851601"></p>
<p>释放技能 call 查找</p>
<p>思路一：技能应该有技能 ID，索引，技能文字信息和描述</p>
<p>可以从技能文字信息为入口，用 CE 搜索字符信息，可以根据内存读写断点。定位技能的关键 call</p>
<p>思路二：分析游戏按键和鼠标点击处理机制，找到技能 call</p>
<p>思路三：针对网游，一般网络游戏会将攻击和伤害的计算放在服务器端处理</p>
<p>失望技能需要与服务端进行网络通信，通过游戏数据网络数据收发机制，跟踪 send，recv 函数，用条件过滤，保证 send 的是释放技能的数据，看函数堆栈反推上层函数，找到技能 call</p>
<p>bp send, 对网络发送数据的函数下断点</p>
<p>排除其他数据包发送的干扰，定位到使用技能时触发的数据包的发送</p>
<p>ctrl + F9 定位到游戏程序模块 (OD 上 module 为游戏进程名) 然后逐层分析函数，看谁更适合作为技能 call</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">UserSkill ()</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">	xxx()</span><br><span class="line">	&#123;</span><br><span class="line">		send() </span><br><span class="line">		//send处下断点，根据堆栈回溯可以定位技能call</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00CC3F37  | 57                      | push edi                              |</span><br><span class="line">00CC3F38  | 56                      | push esi                              | esi:L&quot;)q&quot;</span><br><span class="line">00CC3F39  | 8B49 20                 | mov ecx,dword ptr ds:[ecx+20]         |</span><br><span class="line">00CC3F3C  | E8 0F780B00             | call elementclient.D7B750             |</span><br></pre></td></tr></table></figure>
<p>发送消息或者触发事件 SendNotyxxx</p>
<p>消息事件处理线程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">while(1)</span><br><span class="line">&#123;</span><br><span class="line">	switch</span><br><span class="line">		case xxx;</span><br><span class="line">		break;</span><br><span class="line">		case yyy;</span><br><span class="line">		break;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">764B58A0  | 8BFF                   | mov edi,edi                           |</span><br><span class="line"></span><br><span class="line">00D7AD35  | 6A 00                  | push 0                                |</span><br><span class="line">00D7AD37  | 6A 01                  | push 1                                |</span><br><span class="line">00D7AD39  | 68 31AC2F01            | push elementclient.12FAC31            |</span><br><span class="line">00D7AD3E  | FF35 7CAD5001          | push dword ptr ds:[150AD7C]           |</span><br><span class="line">00D7AD44  | FF15 486A1E01          | call dword ptr ds:[&lt;&amp;send&gt;]           |</span><br><span class="line"></span><br><span class="line">00D7AC71  |.  FF75 10       push [arg.3]</span><br><span class="line">00D7AC74  |.  FF75 0C       push [arg.2]</span><br><span class="line">00D7AC77  |.  E8 24000000   call ElementC.00D7ACA0</span><br><span class="line"></span><br><span class="line">00D7B9CC  |&gt; \FF75 0C       push [arg.2]</span><br><span class="line">00D7B9CF  |.  8B8E AC000000 mov ecx,dword ptr ds:[esi+0xAC]</span><br><span class="line">00D7B9D5  |.  57            push edi</span><br><span class="line">00D7B9D6  |.  FFB6 B0000000 push dword ptr ds:[esi+0xB0]</span><br><span class="line">00D7B9DC  |.  E8 0FF2FFFF   call ElementC.00D7ABF0</span><br><span class="line"></span><br><span class="line">00D7B7D1  |.  66:8906       mov word ptr ds:[esi],ax</span><br><span class="line">00D7B7D4  |&gt;  6A 00         push 0x0</span><br><span class="line">00D7B7D6  |.  8D45 DC       lea eax,[local.9]</span><br><span class="line">00D7B7D9  |.  8BCF          mov ecx,edi</span><br><span class="line">00D7B7DB  |.  50            push eax</span><br><span class="line">00D7B7DC  |.  E8 9F000000   call ElementC.00D7B880</span><br><span class="line">//以上三个除了技能也能中断</span><br><span class="line"></span><br><span class="line">00CC3F31  |&gt; \8B0D 38EE4F01 mov ecx,dword ptr ds:[0x14FEE38]         ;  ElementC.015084F8     </span><br><span class="line">00CC3F37  |.  57            push edi                                    0C</span><br><span class="line">00CC3F38  |.  56            push esi                                    04229034  </span><br><span class="line">00CC3F39  |.  8B49 20       mov ecx,dword ptr ds:[ecx+0x20]  			24BC4028</span><br><span class="line">00CC3F3C  |.  E8 0F780B00   call ElementC.00D7B750</span><br><span class="line">//没有技能ID</span><br><span class="line"></span><br><span class="line">009AC4F5  |.  FF75 14       push [arg.4]								0019EE7C</span><br><span class="line">009AC4F8  |.  C701 00000000 mov dword ptr ds:[ecx],0x0					[24A1B180]</span><br><span class="line">009AC4FE  |.  FF75 10       push [arg.3]								01</span><br><span class="line">009AC501  |.  FF75 0C       push [arg.2]								215AAB00</span><br><span class="line">009AC504  |.  FF75 08       push [arg.1]								7D</span><br><span class="line">009AC507  |.  E8 D4793100   call ElementC.00CC3EE0</span><br><span class="line">//技能不可用</span><br><span class="line"></span><br><span class="line">00B42E62   .  50            push eax			0019EE7C</span><br><span class="line">00B42E63   .  8B87 00280000 mov eax,dword ptr ds:[edi+0x2800]    4E492C40</span><br><span class="line">00B42E69   .  6A 01         push 0x1</span><br><span class="line">00B42E6B   .  FF75 C8       push dword ptr ss:[ebp-0x38]      215AAB00</span><br><span class="line">00B42E6E   .  FF70 08       push dword ptr ds:[eax+0x8]     7D        44EE61B8 + 08</span><br><span class="line">00B42E71   .  A1 38EE4F01   mov eax,dword ptr ds:[0x14FEE38]   015084F8</span><br><span class="line">00B42E76   .  8B48 20       mov ecx,dword ptr ds:[eax+0x20]   24B53028</span><br><span class="line">00B42E79   .  81C1 EC000000 add ecx,0xEC</span><br><span class="line">00B42E7F   .  E8 3C96E6FF   call ElementC.009AC4C0</span><br><span class="line">//技能不可用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00B69E06  |.  6A 00         push 0x0			0</span><br><span class="line">00B69E08  |.  50            push eax          0</span><br><span class="line">00B69E09  |.  FF76 08       push dword ptr ds:[esi+0x8]    80001A0B  80001C4D</span><br><span class="line">00B69E0C  |.  E8 5F87FDFF   call ElementC.00B42570</span><br><span class="line">//无技能ID</span><br><span class="line">//以下执行频率很高，消息或者类似事件派发的一个地方</span><br><span class="line"></span><br><span class="line">00B697CF  |&gt; \8B40 0C       mov eax,dword ptr ds:[eax+0xC]</span><br><span class="line">00B697D2  |.  FFD0          call eax</span><br><span class="line"></span><br><span class="line">00B6A4CF   .  8BCE          mov ecx,esi</span><br><span class="line">00B6A4D1   .  E8 9AF2FFFF   call ElementC.00B69770</span><br><span class="line"></span><br><span class="line">00B5F6E4  |.  8B03          |mov eax,dword ptr ds:[ebx]</span><br><span class="line">00B5F6E6  |.  8BCB          |mov ecx,ebx</span><br><span class="line">00B5F6E8  |.  FF75 08       |push [arg.1]</span><br><span class="line">00B5F6EB  |.  FF50 04       |call dword ptr ds:[eax+0x4]</span><br><span class="line"></span><br><span class="line">00B55D68  |.  53            push ebx</span><br><span class="line">00B55D69  |.  E8 12990000   call ElementC.00B5F680</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">00CE9231 - FF 71 08  - push [ecx+08]</span><br><span class="line">00CE92C7 - FF 70 08  - push [eax+08]</span><br><span class="line">00CE92DE - FF 70 08  - push [eax+08]</span><br><span class="line">00B3E488 - FF 73 08  - push [ebx+08]</span><br><span class="line">00B3E62E - FF 73 08  - push [ebx+08]</span><br><span class="line">00B41F83 - FF 70 08  - push [eax+08]</span><br><span class="line">00B425F8 - FF 70 08  - push [eax+08]</span><br><span class="line">00B42E6E - FF 70 08  - push [eax+08]</span><br><span class="line">00B356C7 - FF 70 08  - push [eax+08]</span><br><span class="line">00B356DB - 8B 78 08  - mov edi,[eax+08]</span><br><span class="line">00B5E550 - FF 70 08  - push [eax+08]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">00CE922A  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]        | 015084F8</span><br><span class="line">00CE922F  | 56                     | push esi                              | 06CBDD48</span><br><span class="line">00CE9230  | 57                     | push edi                              | 52B640C8</span><br><span class="line">00CE9231  | FF71 08                | push dword ptr ds:[ecx+8]             | 0000007D</span><br><span class="line">00CE9234  | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]         | 1D27F9C0</span><br><span class="line">00CE9237  | 8B70 30                | mov esi,dword ptr ds:[eax+30]         | 36FAC5B8</span><br><span class="line">00CE923A  | FF15 E8601E01          | call dword ptr ds:[&lt;&amp;?IsGoblinSkill@E | 034CFD30</span><br><span class="line">00CE9240  | 83C4 04                | add esp,4                             |</span><br><span class="line">//游戏崩溃</span><br><span class="line"></span><br><span class="line">00CE92C1  | 6A FF                  | push FFFFFFFF                         | FFFFFFFF</span><br><span class="line">00CE92C3  | 6A 00                  | push 0                                | 0</span><br><span class="line">00CE92C5  | 6A 00                  | push 0                                | 0</span><br><span class="line">00CE92C7  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class="line">00CE92CA  | 8B42 0C                | mov eax,dword ptr ds:[edx+C]          | 00969460</span><br><span class="line">00CE92CD  | FFD0                   | call eax                              | </span><br><span class="line">//游戏崩溃</span><br><span class="line"></span><br><span class="line">00CE92D3  | 8B43 08                | mov eax,dword ptr ds:[ebx+8]          | 4DB4BCF0</span><br><span class="line">00CE92D6  | 8BCE                   | mov ecx,esi                           | 7082C9E8</span><br><span class="line">00CE92D8  | 6A FF                  | push FFFFFFFF                         |</span><br><span class="line">00CE92DA  | 6A 00                  | push 0                                |</span><br><span class="line">00CE92DC  | 6A 00                  | push 0                                |</span><br><span class="line">00CE92DE  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class="line">00CE92E1  | E8 4A4BE5FF            | call elementclient.B3DE30             |</span><br><span class="line">//技能call</span><br><span class="line"></span><br><span class="line">00B3E487  | 57                     | push edi                              | 687763E8</span><br><span class="line">00B3E488  | FF73 08                | push dword ptr ds:[ebx+8]             | 7D</span><br><span class="line">00B3E48B  | E8 A0A9E7FF            | call elementclient.9B8E30             |</span><br><span class="line">//游戏崩溃</span><br><span class="line"></span><br><span class="line">00B3E62D  | 50                     | push eax                              | 0</span><br><span class="line">00B3E62E  | FF73 08                | push dword ptr ds:[ebx+8]             | 7D</span><br><span class="line">00B3E631  | FF75 10                | push dword ptr ss:[ebp+10]            | 80001A0B</span><br><span class="line">00B3E634  | 68 886D2701            | push elementclient.1276D88            | 1276D88</span><br><span class="line">00B3E639  | 6A 01                  | push 1                                |</span><br><span class="line">00B3E63B  | E8 C0F83100            | call elementclient.E5DF00             |</span><br><span class="line">00B3E640  | 8B8F F4270000          | mov ecx,dword ptr ds:[edi+27F4]       | 6F3CAE58  edi= 5F4F6320 + 0x27F4</span><br><span class="line">00B3E646  | 83C4 14                | add esp,14                            |</span><br><span class="line">//无反应</span><br><span class="line"></span><br><span class="line">00B41F83  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class="line">00B41F86  | E8 75750000            | call elementclient.B49500             |</span><br><span class="line">//无反应</span><br><span class="line"></span><br><span class="line">00B425F8  | FF70 08                | push dword ptr ds:[eax+8]             | 7D </span><br><span class="line">00B425FB  | E8 5034E5FF            | call elementclient.995A50             </span><br><span class="line">//游戏崩溃</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00B42E62  | 50                     | push eax                              | 0019EE7C</span><br><span class="line">00B42E63  | 8B87 00280000          | mov eax,dword ptr ds:[edi+2800]       | 5395BDF0</span><br><span class="line">00B42E69  | 6A 01                  | push 1                                | 1</span><br><span class="line">00B42E6B  | FF75 C8                | push dword ptr ss:[ebp-38]            | 241D4300</span><br><span class="line">00B42E6E  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class="line">00B42E71  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]        | 015084F8</span><br><span class="line">00B42E76  | 8B48 20                | mov ecx,dword ptr ds:[eax+20]         | 29EBB028</span><br><span class="line">00B42E79  | 81C1 EC000000          | add ecx,EC                            |</span><br><span class="line">00B42E7F  | E8 3C96E6FF            | call elementclient.9AC4C0             |</span><br><span class="line">//技能不可用</span><br><span class="line"></span><br><span class="line">00B356C5  | 6A 00                  | push 0                                |</span><br><span class="line">00B356C7  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class="line">00B356CA  | E8 F14C1100            | call elementclient.C4A3C0             |</span><br><span class="line">//无反应</span><br><span class="line"></span><br><span class="line">00B5E54D  | FF71 04                | push dword ptr ds:[ecx+4]                      |</span><br><span class="line">00B5E550  | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class="line">00B5E553  | E8 D8A8E5FF            | call elementclient.9B8E30                      |</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">00CE922A  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 | 015084F8</span><br><span class="line">00CE922F  | 56                     | push esi                                       | 06D077F8</span><br><span class="line">00CE9230  | 57                     | push edi                                       | 658C4488</span><br><span class="line">00CE9231  | FF71 08                | push dword ptr ds:[ecx+8]                      | 0000007D</span><br><span class="line">00CE9234  | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]                  | 1D2429C0</span><br><span class="line">00CE9237  | 8B70 30                | mov esi,dword ptr ds:[eax+30]                  | 7082C9E8</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">00CE92D3  | 8B43 08                | mov eax,dword ptr ds:[ebx+8]          | 4DB4BCF0</span><br><span class="line">00CE92D6  | 8BCE                   | mov ecx,esi                           | 7082C9E8，ecx的值，人物信息基地址  5F4F6320</span><br><span class="line">00CE92D8  | 6A FF                  | push FFFFFFFF                         |</span><br><span class="line">00CE92DA  | 6A 00                  | push 0                                |</span><br><span class="line">00CE92DC  | 6A 00                  | push 0                                |</span><br><span class="line">00CE92DE  | FF70 08                | push dword ptr ds:[eax+8]             | 7D，技能ID</span><br><span class="line">00CE92E1  | E8 4A4BE5FF            | call elementclient.B3DE30             |</span><br><span class="line"></span><br><span class="line">[[[14FEE38]+1C]+30] = 7082C9E8   即为this指针</span><br><span class="line">[[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30] = 7082C9E8</span><br><span class="line">[[[[[[[[0x15084F8+1C]+98]+4]+1C]+1*4+1C]+8]+30] = 7082C9E8</span><br></pre></td></tr></table></figure>
<p>人物选择目标（玩家，怪物，npc 分析）</p>
<p>选中</p>
<p>当前 this 指针 [[[14FEE38]+1C]+30] = 5F4F6320</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115006092.png" alt="image-20230101115006092"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115309026.png" alt="image-20230101115309026"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115332221.png" alt="image-20230101115332221"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">80001A0B 是戒灵的ID</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115607140.png" alt="image-20230101115607140"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">对于不同的囚徒怨魂有不同的ID</span><br><span class="line">80001C4A - 80001C4F</span><br><span class="line">推测某个地域上囚徒怨魂有ID范围，每个ID唯一</span><br><span class="line">戒灵唯一，因此ID也只有一个</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">009AC900 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class="line">00B31E36 - 89 86 04090000  - mov [esi+00000904],eax</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>思路：</p>
<p>1. 在人物对象偏移地址中找找看是否有与选中的目标相关的信息 (譬如：ID 或者目标对象的地址)，然后通过内存断点分析访问这些信息的代码，来确定选中目标的 call</p>
<p>2. 网游可以通过 send 函数断点来分析选中目标的操作 (和释放技能 call 分析类似)</p>
<p>思路一：</p>
<p>1. 上面已经找到一个与任务选中目标的相关信息 (人物选择中的目标 ID)</p>
<p>2. 对这个内存下写入访问 / 写入的断点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">009AC900  |.  89B0 04090000 mov dword ptr ds:[eax+0x904],esi</span><br><span class="line"></span><br><span class="line">00B54582  |&gt; \A1 38EE4F01   mov eax,dword ptr ds:[0x14FEE38]      015084F8</span><br><span class="line">00B54587  |.  56            push esi                              80001C56</span><br><span class="line">00B54588  |.  8B48 20       mov ecx,dword ptr ds:[eax+0x20]       11B3C028</span><br><span class="line">00B5458B  |.  81C1 EC000000 add ecx,0xEC</span><br><span class="line">00B54591  |.  E8 3A83E5FF   call ElementC.009AC8D0</span><br><span class="line"></span><br><span class="line">mov eax,dword ptr ds:[0x14FEE38]</span><br><span class="line">push 80001A0B</span><br><span class="line">mov ecx,dword ptr ds:[eax+0x20]</span><br><span class="line">add ecx,0x0EC</span><br><span class="line">call 009AC8D0</span><br></pre></td></tr></table></figure>
<h4 id="更新-202315"><a class="markdownIt-Anchor" href="#更新-202315">#</a> 更新 2023.1.5</h4>
<p>释放技能 call</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">00CE9EE3              | 8B43 08                | mov eax,dword ptr ds:[ebx+8]                   |</span><br><span class="line">00CE9EE6              | 8BCE                   | mov ecx,esi                                    |</span><br><span class="line">00CE9EE8              | 6A FF                  | push FFFFFFFF                                  |</span><br><span class="line">00CE9EEA              | 6A 00                  | push 0                                         |</span><br><span class="line">00CE9EEC              | 6A 00                  | push 0                                         |</span><br><span class="line">00CE9EEE              | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class="line">00CE9EF1              | E8 7A4BE5FF            | call elementclient.B3EA70                      |</span><br><span class="line"></span><br><span class="line">00CE9E3A              | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 |</span><br><span class="line">00CE9E3F              | 56                     | push esi                                       |</span><br><span class="line">00CE9E40              | 57                     | push edi                                       |</span><br><span class="line">00CE9E41              | FF71 08                | push dword ptr ds:[ecx+8]                      |</span><br><span class="line">00CE9E44              | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]                  |</span><br><span class="line">00CE9E47              | 8B70 30                | mov esi,dword ptr ds:[eax+30]                  |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ecx = esi = [eax+30] = [[[14FEE38]+1C]+30]</span><br><span class="line"></span><br><span class="line">mov ecx,14FEE38</span><br><span class="line">mov ecx,[ecx]</span><br><span class="line">mov ecx,[ecx+1C]</span><br><span class="line">mov ecx,[ecx+30]</span><br><span class="line">push -1</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 7D</span><br><span class="line">call 0x0B3EA70</span><br><span class="line"></span><br><span class="line">ecx 就是this指针 [[[14FEE38]+1C]+30] = 65573810 = [[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30]</span><br></pre></td></tr></table></figure>
<p>定位怪物 ID</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">00B6AC16  |.  6A 00         push 0x0</span><br><span class="line">00B6AC18  |.  50            push eax</span><br><span class="line">00B6AC19  |.  FF76 08       push dword ptr ds:[esi+0x8]  80001A0B</span><br><span class="line">00B6AC1C  |.  E8 8F85FDFF   call ElementC.00B431B0</span><br><span class="line"></span><br><span class="line">在CE中通过选中怪物切换得到30E32FC4,并且和this指针相邻</span><br><span class="line">65574114 - 65573810 = 904</span><br><span class="line">即人物this指针的+904的位置是所选定怪物</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105200144107.png" alt="image-20230105200144107"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">009AD0A0 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class="line">00B32816 - 89 86 04090000  - mov [esi+00000904],eax</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">009AD0A0              | 89B0 04090000          | mov dword ptr ds:[eax+904],esi                 |</span><br><span class="line">009AD0A6              | 8D45 F8                | lea eax,dword ptr ss:[ebp-8]                   |</span><br><span class="line">009AD0A9              | 50                     | push eax                                       |</span><br><span class="line">009AD0AA              | 8D45 08                | lea eax,dword ptr ss:[ebp+8]                   |</span><br><span class="line">009AD0AD              | 50                     | push eax                                       |</span><br><span class="line">009AD0AE              | E8 0D070000            | call elementclient.9AD7C0                      |</span><br><span class="line"></span><br><span class="line">00B551C2              | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 | 015084F8</span><br><span class="line">00B551C7              | 56                     | push esi                                       | 80001A0B</span><br><span class="line">00B551C8              | 8B48 20                | mov ecx,dword ptr ds:[eax+20]                  | 1D01F028</span><br><span class="line">00B551CB              | 81C1 EC000000          | add ecx,EC                                     |</span><br><span class="line">00B551D1              | E8 9A7EE5FF            | call elementclient.9AD070                      |</span><br><span class="line"></span><br><span class="line">mov eax,dword ptr ds:[14FEE38]      </span><br><span class="line">push 80001A0B</span><br><span class="line">mov ecx,dword ptr ds:[eax+20]</span><br><span class="line">add ecx,0x0EC           </span><br><span class="line">call 9AD070</span><br></pre></td></tr></table></figure>
<p>人物技能分析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">00CE9EEE              | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class="line"></span><br><span class="line">回城术 A7</span><br><span class="line">458AB5E0</span><br><span class="line"></span><br><span class="line">清心咒 71</span><br><span class="line">493BCA60</span><br><span class="line"></span><br><span class="line">羽剑 7D</span><br><span class="line">458AB880</span><br><span class="line"></span><br><span class="line">龙卷风 7F</span><br><span class="line">4589E0D0</span><br><span class="line"></span><br><span class="line">静心咒 72</span><br><span class="line">458AB6F8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3D82F288 493BCA60 `Ê;I   </span><br><span class="line">3D82F28C 458AB6F8 ø¶.E   </span><br><span class="line">3D82F290 458AB880 .¸.E   </span><br><span class="line">3D82F294 4589E0D0 Ðà.E   </span><br><span class="line">3D82F298 458AB5E0 àµ.E   </span><br><span class="line"></span><br><span class="line">493BCA60 01297268 hr). </span><br><span class="line">493BCA64 2E164EA8 ¨N.. </span><br><span class="line">493BCA68 00000071 q... </span><br><span class="line">493BCA6C 00000005 .... </span><br><span class="line"></span><br><span class="line">2E164EA8 1046C5DC ÜÅF. </span><br><span class="line">2E164EAC 10830198 .... </span><br><span class="line">2E164EB0 00000000 .... </span><br><span class="line">2E164EB4 00000000 .... </span><br><span class="line"></span><br><span class="line">10830198 10542A90 .*T. elementskill.&amp;?GetRequiredGenius@ElementSkill@GNET@@UAEPAHH@Z</span><br><span class="line">1083019C 00000071 q... </span><br><span class="line">108301A0 00000007 .... </span><br><span class="line">108301A4 10542AE8 è*T. L&quot;清心咒&quot;</span><br><span class="line">108301A8 10542AF0 ð*T. &quot;清心咒&quot;</span><br><span class="line">108301AC 10542AF8 ø*T. &quot;清心咒.dds&quot;</span><br><span class="line"></span><br><span class="line">10542AE8 5FC36E05 .nÃ_ </span><br><span class="line">10542AEC 00005492 .T.. </span><br><span class="line">10542AF0 C4D0E5C7 ÇåÐÄ </span><br><span class="line">10542AF4 0000E4D6 Öä.. </span><br><span class="line">10542AF8 C4D0E5C7 ÇåÐÄ </span><br><span class="line"></span><br><span class="line">[[[[3D82F288]+4]+4]+0x0C]</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105204555127.png" alt="image-20230105204555127"></p>
<p>5E5D69F8 - 5E5D41D8 = 2820</p>
<p>人物 this 指针 + 2820 就是技能数组的首地址，通过技能数组的首地址可以找到技能的全部信息</p>
<h4 id="更新结束"><a class="markdownIt-Anchor" href="#更新结束">#</a> 更新结束</h4>
<h4 id="更新2023111"><a class="markdownIt-Anchor" href="#更新2023111">#</a> 更新 2023.1.11</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line">1.人物this指针</span><br><span class="line">00B2ECD5 - 89 86 8C070000  - mov [esi+0000078C],eax</span><br><span class="line">当前血量 = [esi + 78C]    esi = 5EB45680</span><br><span class="line"></span><br><span class="line">00B2EBB7             | 8BF1                  | mov esi,ecx                           |</span><br><span class="line">当前血量 = [ecx + 78C]    ecx = 5EB45680</span><br><span class="line"></span><br><span class="line">00B391E2             | E8 C959FFFF           | call elementclient.B2EBB0             |</span><br><span class="line"></span><br><span class="line">00BF23C8             | FF52 68               | call dword ptr ds:[edx+68]            |</span><br><span class="line"></span><br><span class="line">00BF23C4             | 8BC8                  | mov ecx,eax                           |</span><br><span class="line">当前血量 = [eax + 78C]    eax = 5EB45680</span><br><span class="line"></span><br><span class="line">00BF0540             | 8B41 08               | mov eax,dword ptr ds:[ecx+8]          |</span><br><span class="line">00BF0543             | 8B40 30               | mov eax,dword ptr ds:[eax+30]         |</span><br><span class="line">当前血量 = [[[ecx+8]+30] + 78C]     ecx = 0648E5A0</span><br><span class="line"></span><br><span class="line">00BE5869             | FF50 34               | call dword ptr ds:[eax+34]            |</span><br><span class="line"></span><br><span class="line">00A4B8AE             | E8 4D9F1900           | call elementclient.BE5800             |</span><br><span class="line"></span><br><span class="line">00A4B89A             | 8B4F 30               | mov ecx,dword ptr ds:[edi+30]         |</span><br><span class="line">当前血量 = [[[0150B6FC]+30] + 78C]</span><br><span class="line"></span><br><span class="line">$ + 78C 为血量</span><br><span class="line"></span><br><span class="line">$ + 7E4 为血量上限</span><br><span class="line"></span><br><span class="line">$ + 790 为真气</span><br><span class="line"></span><br><span class="line">$ + 7E8 为真气上限</span><br><span class="line"></span><br><span class="line">$ + 784 为等级</span><br><span class="line"></span><br><span class="line">$ + 794 为经验</span><br><span class="line"></span><br><span class="line">$ + 798 为元神</span><br><span class="line"></span><br><span class="line">$ + 79C 为元气上限</span><br><span class="line"></span><br><span class="line">$ + 7A0 为真元</span><br><span class="line"></span><br><span class="line">$ + B00 / $ + B04 为角色姓名</span><br><span class="line"></span><br><span class="line">$ + 864 为最大真元</span><br><span class="line"></span><br><span class="line">$ + 930 为银币</span><br><span class="line"></span><br><span class="line">$ +7A0/864+8FC  为  99/100</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">2.人物技能call</span><br><span class="line">009ADDF5             | FF75 14               | push dword ptr ss:[ebp+14]            | 0019EE7C</span><br><span class="line">009ADDF8             | C701 00000000         | mov dword ptr ds:[ecx],0              | [1DC7CDB8]</span><br><span class="line">009ADDFE             | FF75 10               | push dword ptr ss:[ebp+10]            | 1 </span><br><span class="line">009ADE01             | FF75 0C               | push dword ptr ss:[ebp+C]             | 01518200</span><br><span class="line">009ADE04             | FF75 08               | push dword ptr ss:[ebp+8]             | 0000007D</span><br><span class="line">009ADE07             | E8 84803100           | call elementclient.CC5E90             |</span><br><span class="line"></span><br><span class="line">00B43CB2             | 50                    | push eax                              | 0019EE7C</span><br><span class="line">00B43CB3             | 8B87 00280000         | mov eax,dword ptr ds:[edi+2800]       | 43336E60</span><br><span class="line">00B43CB9             | 6A 01                 | push 1                                | 1</span><br><span class="line">00B43CBB             | FF75 C8               | push dword ptr ss:[ebp-38]            | 181E4F00</span><br><span class="line">00B43CBE             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class="line">00B43CC1             | A1 20205001           | mov eax,dword ptr ds:[1502020]        | 0150B6E0</span><br><span class="line">00B43CC6             | 8B48 20               | mov ecx,dword ptr ds:[eax+20]         | 1DEB6028</span><br><span class="line">00B43CC9             | 81C1 EC000000         | add ecx,EC                            | </span><br><span class="line">00B43CCF             | E8 ECA0E6FF           | call elementclient.9ADDC0             |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00CEB35C - 8B 43 08  - mov eax,[ebx+08]</span><br><span class="line">00CEB35C             | 8B43 08               | mov eax,dword ptr ds:[ebx+8]          | 43336E60</span><br><span class="line">00CEB35F             | 8B11                  | mov edx,dword ptr ds:[ecx]            | 012787BC</span><br><span class="line">00CEB361             | 6A FF                 | push FFFFFFFF                         |</span><br><span class="line">00CEB363             | 6A 00                 | push 0                                |</span><br><span class="line">00CEB365             | 6A 00                 | push 0                                |</span><br><span class="line">00CEB367             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class="line">00CEB36A             | 8B42 0C               | mov eax,dword ptr ds:[edx+C]          | 0096B5A0</span><br><span class="line">00CEB36D             | FFD0                  | call eax                              |</span><br><span class="line"></span><br><span class="line">00CEB373 - 8B 43 08  - mov eax,[ebx+08]</span><br><span class="line">00CEB373             | 8B43 08               | mov eax,dword ptr ds:[ebx+8]          | 43336E60</span><br><span class="line">00CEB376             | 8BCE                  | mov ecx,esi                           | 5EB45680</span><br><span class="line">00CEB378             | 6A FF                 | push FFFFFFFF                         |</span><br><span class="line">00CEB37A             | 6A 00                 | push 0                                |</span><br><span class="line">00CEB37C             | 6A 00                 | push 0                                |</span><br><span class="line">00CEB37E             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class="line">00CEB381             | E8 FA38E5FF           | call elementclient.B3EC80             |</span><br><span class="line"></span><br><span class="line">00CEB2D7             | 8B70 30               | mov esi,dword ptr ds:[eax+30]         |</span><br><span class="line">esi = [eax + 30]</span><br><span class="line">00CEB2D4             | 8B40 1C               | mov eax,dword ptr ds:[eax+1C]         |</span><br><span class="line">esi = [[eax+1C] + 30]</span><br><span class="line">00CEB2CA             | A1 20205001           | mov eax,dword ptr ds:[1502020]        |</span><br><span class="line">esi = [[[1502020] + 1C] + 30]</span><br><span class="line"></span><br><span class="line">mov ecx,1502020</span><br><span class="line">mov ecx,[ecx]</span><br><span class="line">mov ecx,[ecx+1C]</span><br><span class="line">mov ecx,[ecx+30]</span><br><span class="line">push  -1</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">push 7D</span><br><span class="line">call 0x0B3EC80</span><br><span class="line"></span><br><span class="line">3.人物选中call</span><br><span class="line">009AE200 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class="line">00B55402             | A1 20205001           | mov eax,dword ptr ds:[1502020]        |</span><br><span class="line">00B55407             | 56                    | push esi                              | 80001A0B</span><br><span class="line">00B55408             | 8B48 20               | mov ecx,dword ptr ds:[eax+20]         |</span><br><span class="line">00B5540B             | 81C1 EC000000         | add ecx,EC                            |</span><br><span class="line">00B55411             | E8 BA8DE5FF           | call elementclient.9AE1D0             |</span><br><span class="line"></span><br><span class="line">mov eax,dword ptr ds:[1502020]</span><br><span class="line">push 80001C4A</span><br><span class="line">mov ecx,dword ptr ds:[eax+20] </span><br><span class="line">add ecx,0x0EC        </span><br><span class="line">call 9AE1D0     </span><br><span class="line"></span><br><span class="line">//通过寻找上一层的代码确定call</span><br><span class="line"></span><br><span class="line">4.人物技能分析</span><br><span class="line">00CEB37E             | FF70 08               | push dword ptr ds:[eax+8]             |</span><br><span class="line">eax = 4483FFB0</span><br><span class="line"></span><br><span class="line">41930A50  47B991C0 À.¹G </span><br><span class="line">41930A54  4483FE28 (þ.D </span><br><span class="line">41930A58  4483FFB0 °ÿ.D </span><br><span class="line">41930A5C  44832800 .(.D </span><br><span class="line">41930A60  4483FD10 .ý.D </span><br><span class="line"></span><br><span class="line">47B991C0 01299498 ..). </span><br><span class="line">47B991C4 30F749F0 ðI÷0 </span><br><span class="line">47B991C8 00000071 q... </span><br><span class="line">47B991CC 00000005 .... </span><br><span class="line">47B991D0 00000000 .... </span><br><span class="line"></span><br><span class="line">30F749F0 1046E60C .æF. </span><br><span class="line">30F749F4 10833F48 H?.. </span><br><span class="line">30F749F8 00000000 .... </span><br><span class="line">30F749FC 00000000 .... </span><br><span class="line"></span><br><span class="line">10833F48 105450F8 øPT. elementskill.&amp;?GetRequiredGenius@ElementSkill@GNET@@UAEPAHH@Z</span><br><span class="line">10833F4C 00000071 q... </span><br><span class="line">10833F50 00000007 .... </span><br><span class="line">10833F54 10545150 PQT. L&quot;清心咒&quot;</span><br><span class="line">10833F58 10545158 XQT. &quot;清心咒&quot;</span><br><span class="line">10833F5C 10545160 `QT. &quot;清心咒.dds&quot;</span><br><span class="line"></span><br><span class="line">10545150 清心咒</span><br><span class="line"></span><br><span class="line">2CAC0CF8 - [[[0150B6FC]+30] = 2CAC0CF8 - 2CABE4D8 = 2820</span><br><span class="line">[[[0150B6FC]+30]+2820]   //即可得到技能列表首地址</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5.周围怪物列表</span><br><span class="line">00BE8626 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class="line"></span><br><span class="line">00BE8615   &gt; \8B72 0C       mov esi,dword ptr ds:[edx+0xC]           ;  Case 21 of switch 00BE84E0</span><br><span class="line">00BE8618   .  FF36          push dword ptr ds:[esi]       </span><br><span class="line">00BE861A   .  E8 F10D0000   call ElementC.00BE9410</span><br><span class="line">00BE861F   .  85C0          test eax,eax</span><br><span class="line">00BE8621   .  74 60         je XElementC.00BE8683</span><br><span class="line">00BE8623   .  8B4E 04       mov ecx,dword ptr ds:[esi+0x4]</span><br><span class="line">00BE8626   .  8988 2C010000 mov dword ptr ds:[eax+0x12C],ecx</span><br><span class="line">00BE862C   .  8B4E 08       mov ecx,dword ptr ds:[esi+0x8]</span><br><span class="line">00BE862F   .  8988 84010000 mov dword ptr ds:[eax+0x184],ecx</span><br><span class="line">00BE8635   .  8B4E 0C       mov ecx,dword ptr ds:[esi+0xC]</span><br><span class="line">00BE8638   .  5F            pop edi</span><br><span class="line">00BE8639   .  5E            pop esi</span><br><span class="line">00BE863A   .  8988 0C020000 mov dword ptr ds:[eax+0x20C],ecx</span><br><span class="line"></span><br><span class="line">00BF4E10   $  55            push ebp</span><br><span class="line">00BF4E11   .  8BEC          mov ebp,esp</span><br><span class="line">00BF4E13   .  8B45 0C       mov eax,dword ptr ss:[ebp+0xC]</span><br><span class="line">00BF4E16   .  33D2          xor edx,edx</span><br><span class="line">00BF4E18   .  56            push esi</span><br><span class="line">00BF4E19   .  8B30          mov esi,dword ptr ds:[eax]     80001C4A</span><br><span class="line">00BF4E1B   .  8BC6          mov eax,esi</span><br><span class="line">00BF4E1D   .  F771 14       div dword ptr ds:[ecx+0x14]    ecx = 0A345DEC</span><br><span class="line">00BF4E20   .  8B41 08       mov eax,dword ptr ds:[ecx+0x8]    51A10448</span><br><span class="line">00BF4E23   .  8B0490        mov eax,dword ptr ds:[eax+edx*4]  41AEC578 edx=000002CB</span><br><span class="line">00BF4E26   .  85C0          test eax,eax</span><br><span class="line"></span><br><span class="line">00BE9421  |.  8D4E 14       lea ecx,dword ptr ds:[esi+0x14]</span><br><span class="line">ecx = [esi+0x14] = [ecx + 0x14] = [[eax+2*4+0x1C] + 0x14] = [[[[esi+0x4]+0x1C]+2*4+0x1C] + 0x14] = [[[[ecx+0x4]+0x1C]+2*4+0x1C] + 0x14] = [[[[[0150B6FC]+0x98]+0x4]+0x1C]+2*4+0x1C] + 0x14</span><br><span class="line"></span><br><span class="line">eax = [eax+edx*4] = 41AEC578</span><br><span class="line"></span><br><span class="line">41AEC578  00000000</span><br><span class="line">41AEC57C  2D9E78D0</span><br><span class="line">41AEC580  80001C4A</span><br><span class="line"></span><br><span class="line">2D9E78D0  01282E8C  ElementC.01282E8C</span><br><span class="line">2D9E78D4  00000012</span><br><span class="line">2D9E78D8  01518328  ElementC.01518328</span><br><span class="line">2D9E78DC  3F7F4E6D</span><br><span class="line">2D9E78E0  80000000</span><br><span class="line">2D9E78E4  3D96A916</span><br><span class="line">2D9E78E8  00000000</span><br><span class="line">2D9E78EC  00000000</span><br><span class="line">2D9E78F0  3F800000</span><br><span class="line">2D9E78F4  00000000</span><br><span class="line">2D9E78F8  00000000</span><br><span class="line">2D9E78FC  BD96A917</span><br><span class="line">2D9E7900  00000000</span><br><span class="line">2D9E7904  3F7F4E6F</span><br><span class="line">2D9E7908  00000000</span><br><span class="line">2D9E790C  44339366</span><br><span class="line">2D9E7910  42855E22</span><br><span class="line">2D9E7914  C2B205F5</span><br><span class="line">2D9E7918  3F800000</span><br><span class="line">2D9E791C  3F7F4E6D</span><br><span class="line">2D9E7920  80000000</span><br><span class="line">2D9E7924  3D96A916</span><br><span class="line">2D9E7928  00000000</span><br><span class="line">2D9E792C  00000000</span><br><span class="line">2D9E7930  3F800000</span><br><span class="line">2D9E7934  00000000</span><br><span class="line">2D9E7938  00000000</span><br><span class="line">2D9E793C  BD96A917</span><br><span class="line">2D9E7940  00000000</span><br><span class="line">2D9E7944  3F7F4E6F</span><br><span class="line">2D9E7948  00000000</span><br><span class="line">2D9E794C  44339366</span><br><span class="line">2D9E7950  42855E22</span><br><span class="line">2D9E7954  C2B205F5</span><br><span class="line">2D9E7958  3F800000</span><br><span class="line">2D9E795C  00000000</span><br><span class="line">2D9E7960  00000000</span><br><span class="line">2D9E7964  012BC8F8  ElementC.012BC8F8</span><br><span class="line">2D9E7968  01248974  ElementC.01248974</span><br><span class="line">2D9E797C  0000000A</span><br><span class="line">2D9E7980  00000000</span><br><span class="line">2D9E7984  00000006</span><br><span class="line">2D9E7988  420136DA</span><br><span class="line">2D9E798C  75490100  windows_.75490100</span><br><span class="line">2D9E7990  00000000</span><br><span class="line">2D9E7994  BD471982</span><br><span class="line">2D9E7998  80000000</span><br><span class="line">2D9E799C  3F7FB288</span><br><span class="line">2D9E79A0  00000000</span><br><span class="line">2D9E79A4  BD16C33D</span><br><span class="line">2D9E79A8  80000000</span><br><span class="line">2D9E79AC  3F7FD398</span><br><span class="line">2D9E79B0  00000096</span><br><span class="line">2D9E79B4  0000009C</span><br><span class="line">2D9E79B8  0000000F</span><br><span class="line">2D9E79BC  77000100  gdi32ful.77000100</span><br><span class="line">2D9E79C0  BDC16CBC</span><br><span class="line">2D9E79C4  3F77956C</span><br><span class="line">2D9E79C8  3E71C8DE</span><br><span class="line">2D9E79CC  BDC16CBC</span><br><span class="line">2D9E79D0  3F77956C</span><br><span class="line">2D9E79D4  3E71C8E3  ASCII &quot;s</span><br><span class="line">2D9E79D8  676F4800  igc32.676F4800</span><br><span class="line">2D9E79DC  01518340  ElementC.01518340</span><br><span class="line">2D9E79E0  41BCBCE0</span><br><span class="line">2D9E79E4  0A345DD8</span><br><span class="line">2D9E79E8  80001C4A</span><br><span class="line">2D9E79EC  0000AE41</span><br><span class="line">2D9E79F0  0000AE41</span><br><span class="line">2D9E79F4  00000010</span><br><span class="line">2D9E79F8  00000000</span><br><span class="line">2D9E79FC  000003BE</span><br><span class="line">2D9E7A54  000003BE</span><br><span class="line">2D9E7ADC  FFFFFFFF</span><br><span class="line">2D9E7AE0  3F800000</span><br><span class="line">2D9E7AE4  78443800</span><br><span class="line">2D9E7AE8  0000000C</span><br><span class="line">2D9E7B40  00001388</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$+3C     4430814B K.0D    ;x</span><br><span class="line">$+40     427230F2 ò0rB    ;z</span><br><span class="line">$+44     C2D852B3 ³RØÂ    ;y</span><br><span class="line">$+124    00000010 ....     ;怪物等级</span><br><span class="line">$+128    00000000 .... </span><br><span class="line">$+12C    000003BE ¾...     ;当前血量</span><br><span class="line">$+184    000003BE ¾...     ;最大血量</span><br><span class="line">$+270    00001388 ....         </span><br><span class="line">$+284    3E312F14 ./1&gt;      L&quot;囚徒怨魂&quot;</span><br></pre></td></tr></table></figure>
<h4 id="更新结束-2"><a class="markdownIt-Anchor" href="#更新结束-2">#</a> 更新结束</h4>
<p>5. 人物技能信息分析</p>
<p>1. 每个技能所包含的数据</p>
<p>技能名称 ID</p>
<p>技能冷却时间</p>
<p>可以猜想：有一个技能类，每个技能都是这个类的对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">class Skill</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	m_skillNamel</span><br><span class="line"></span><br><span class="line">	m_skillID</span><br><span class="line"></span><br><span class="line">	m_skillInterval;</span><br><span class="line"></span><br><span class="line">	m_skillLevel;</span><br><span class="line"></span><br><span class="line">	m_skillInfo;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class skillInfo</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">push [eax+0x08]    </span><br><span class="line">eax = 4C270380    4AAE4A38</span><br><span class="line"></span><br><span class="line">46A30A60 01297268 hr). </span><br><span class="line">46A30A64 49C40C18 ..ÄI </span><br><span class="line">46A30A68 00000071 q... </span><br><span class="line">46A30A6C 00000005 .... </span><br><span class="line">46A30A70 00000000 .... </span><br><span class="line">46A30A74 00000000 .... </span><br><span class="line">46A30A78 000003E8 è... </span><br><span class="line">46A30A7C A2B70000 ..·¢ </span><br><span class="line">46A30A80 00000000 .... </span><br><span class="line">46A30A84 00000000 .... </span><br><span class="line">46A30A88 005F7800 .x_. </span><br><span class="line">46A30A8C 00000000 .... </span><br><span class="line">46A30A90 00020100 .... </span><br><span class="line">46A30A94 00000000 .... </span><br><span class="line">46A30A98 00000001 .... </span><br><span class="line">46A30A9C 0000001E .... </span><br><span class="line">46A30AA0 0000001F .... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4272ED50</span><br><span class="line">4C270380  01297268  ElementC.01297268</span><br><span class="line">4C270384  553935B0</span><br><span class="line">4C270388  0000007D       技能ID</span><br><span class="line">4C27038C  00000005       技能等级   C</span><br><span class="line">4C270390  00000000</span><br><span class="line">4C270394  00000000       冷却倒计时</span><br><span class="line">4C270398  000003E8       冷却时间 1000ms</span><br><span class="line">4C27039C  A2B70000</span><br><span class="line">4C2703A0  00000000</span><br><span class="line">4C2703A4  00000000</span><br><span class="line">4C2703A8  005F7800       入口地址</span><br><span class="line">4C2703AC  00000000</span><br><span class="line">4C2703B0  00020100</span><br><span class="line">4C2703B4  00000000</span><br><span class="line"></span><br><span class="line">4C27D890</span><br><span class="line">4C27D890  01297268  ElementC.01297268</span><br><span class="line">4C27D894  55393CB8</span><br><span class="line">4C27D898  0000007F</span><br><span class="line">4C27D89C  00000004</span><br><span class="line">4C27D8A0  00000000</span><br><span class="line">4C27D8A4  00000000   </span><br><span class="line">4C27D8A8  00000BB8</span><br><span class="line">4C27D8AC  D25FF800</span><br><span class="line">4C27D8B0  00000000</span><br><span class="line">4C27D8B4  00000000</span><br><span class="line">4C27D8B8  00000000</span><br><span class="line">4C27D8BC  00000000</span><br><span class="line">4C27D8C0  00020100</span><br><span class="line">4C27D8C4  00000000</span><br><span class="line">4C27D8C8  00000001</span><br><span class="line">4C27D8CC  00000019</span><br><span class="line">4C27D8D0  0000001F</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>推测 00CE92DE</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">46A30A60 01297268 hr). </span><br><span class="line">46A30A64 49C40C18 ..ÄI </span><br><span class="line">46A30A68 00000071 q... </span><br><span class="line">46A30A6C 00000005 .... </span><br><span class="line">46A30A70 00000000 .... </span><br><span class="line">46A30A74 00000000 .... </span><br><span class="line">46A30A78 000003E8 è... </span><br><span class="line">46A30A7C A2B70000 ..·¢ </span><br><span class="line">46A30A80 00000000 .... </span><br><span class="line">46A30A84 00000000 .... </span><br><span class="line">46A30A88 005F7800 .x_. </span><br><span class="line">46A30A8C 00000000 .... </span><br><span class="line">46A30A90 00020100 .... </span><br><span class="line">46A30A94 00000000 .... </span><br><span class="line">46A30A98 00000001 .... </span><br><span class="line">46A30A9C 0000001E .... </span><br><span class="line">46A30AA0 0000001F .... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">495A6148  01297268  ElementC.01297268</span><br><span class="line">495A614C  605D0978</span><br><span class="line">495A6150  0000007D</span><br><span class="line">495A6154  00000005</span><br><span class="line">495A6158  00000000</span><br><span class="line">495A615C  00000000</span><br><span class="line">495A6160  000003E8</span><br><span class="line">495A6164  00726F00  ElementC.00726F00</span><br><span class="line">495A6168  00000000</span><br><span class="line">495A616C  00000000</span><br><span class="line">495A6170  00000000</span><br><span class="line">495A6174  00000000</span><br><span class="line">495A6178  00020100</span><br><span class="line">495A617C  00000000</span><br><span class="line">495A6180  00030000</span><br><span class="line">495A6184  00090006</span><br><span class="line">495A6188  000F000C</span><br><span class="line">495A618C  00190013</span><br><span class="line">495A6190  0021001E</span><br><span class="line">495A6194  00270024</span><br><span class="line">495A6198  002C0029</span><br><span class="line">495A619C  0032002F</span><br><span class="line">495A61A0  003B0036</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4272EED8 01297268 hr). </span><br><span class="line">4272EEDC 49C403A8 ¨.ÄI </span><br><span class="line">4272EEE0 0000007F .... </span><br><span class="line">4272EEE4 00000004 .... </span><br><span class="line">4272EEE8 00000000 .... </span><br><span class="line">4272EEEC 00000000 .... </span><br><span class="line">4272EEF0 00000BB8 ¸... </span><br><span class="line">4272EEF4 00726F00 .or. </span><br><span class="line">4272EEF8 00000000 .... </span><br><span class="line">4272EEFC 00000000 .... </span><br><span class="line">4272EF00 00000000 .... </span><br><span class="line">4272EF04 00000000 .... </span><br><span class="line">4272EF08 00020100 .... </span><br><span class="line">4272EF0C 00000000 .... </span><br><span class="line">4272EF10 01297268 hr). </span><br><span class="line">4272EF14 4F3C3E50 P&gt;&lt;O </span><br><span class="line">4272EF18 00000C9E .... </span><br><span class="line">4272EF1C 00000001 .... </span><br><span class="line">4272EF20 00000000 .... </span><br><span class="line">4272EF24 00000000 .... </span><br><span class="line">4272EF28 000003E8 è... </span><br><span class="line">4272EF2C 00000000 .... </span><br><span class="line">4272EF30 00000000 .... </span><br><span class="line">4272EF34 00000000 .... </span><br><span class="line">4272EF38 00000000 .... </span><br><span class="line">4272EF3C 00000000 .... </span><br><span class="line">4272EF40 00020100 .... </span><br><span class="line">4272EF44 00000000 .... </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">495A6148  01297268  ElementC.01297268</span><br><span class="line">495A614C  605D0978  技能信息</span><br><span class="line">495A6150  0000007D</span><br><span class="line">495A6154  00000005</span><br><span class="line">495A6158  00000000</span><br><span class="line">495A615C  00000000</span><br><span class="line">495A6160  000003E8</span><br><span class="line">495A6164  00726F00  ElementC.00726F00</span><br><span class="line"></span><br><span class="line">605D0978  0203A5AC  ElementS.0203A5AC</span><br><span class="line">605D097C  023F72B0  ElementS.023F72B0 技能详细信息</span><br><span class="line">605D0980  00000000</span><br><span class="line">605D0984  00000000</span><br><span class="line">605D0988  00000000</span><br><span class="line">605D098C  00000000</span><br><span class="line">605D0990  00000000</span><br><span class="line">605D0994  00000000</span><br><span class="line">605D0998  00000000</span><br><span class="line">605D099C  00000000</span><br><span class="line">605D09A0  00000000</span><br><span class="line">605D09A4  00000000</span><br><span class="line">605D09A8  00000000</span><br><span class="line">605D09AC  0000007D</span><br><span class="line">605D09B0  00000005</span><br><span class="line"></span><br><span class="line">023F72B0  02110B04  ElementS.02110B04</span><br><span class="line">023F72B4  0000007D</span><br><span class="line">023F72B8  00000007</span><br><span class="line">023F72BC  020DBFE4  ElementS.020DBFE4  技能名称</span><br><span class="line">023F72C0  020DBFEC  ElementS.020DBFEC</span><br><span class="line">023F72C4  020DBFF4  ElementS.020DBFF4</span><br><span class="line">023F72C8  0000000A</span><br><span class="line">023F72CC  00020001</span><br><span class="line">023F72D0  00000000</span><br><span class="line"></span><br><span class="line">020DBFE4  7BAD7FBD</span><br><span class="line">020DBFE8  00000000</span><br><span class="line">020DBFEC  FDBCF0D3</span><br><span class="line">020DBFF0  00000000</span><br><span class="line">020DBFF4  FDBCF0D3</span><br><span class="line"></span><br><span class="line">020DBFE4  羽箭..</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>猜测：技能列表使用一个数组存储的</p>
<p>通过 OD 中下断点 <code>push dword ptr ds:[eax+0x8]</code>  在 OD 中 eax 的值</p>
<p>491B2710 A7</p>
<p>4B637FE8 71</p>
<p>491B2828 72</p>
<p>491B29B0 7D</p>
<p>491A5200 7F</p>
<h4 id="角色人物技能列表"><a class="markdownIt-Anchor" href="#角色人物技能列表">#</a> 角色人物技能列表</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103134451637.png" alt="image-20230103134451637"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103134511620.png" alt="image-20230103134511620"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">432CF230  4B637FE8</span><br><span class="line">432CF234  491B2828</span><br><span class="line">432CF238  491B29B0</span><br><span class="line">432CF23C  491A5200</span><br><span class="line">432CF240  491B2710</span><br><span class="line">432CF244  CDD0A3C4</span><br><span class="line">[432CF230]</span><br><span class="line"></span><br><span class="line">4B637FE8  01297268  ElementC.01297268</span><br><span class="line">4B637FEC  4C573D48</span><br><span class="line">4B637FF0  00000071</span><br><span class="line">4B637FF4  00000005</span><br><span class="line">4B637FF8  00000000</span><br><span class="line">4B637FFC  00000000</span><br><span class="line">4B638000  000003E8</span><br><span class="line">[[432CF230]+4]</span><br><span class="line"></span><br><span class="line">4C573D48  0208A5AC  ElementS.0208A5AC</span><br><span class="line">4C573D4C  0244D660  ElementS.0244D660</span><br><span class="line">4C573D50  00000000</span><br><span class="line">4C573D54  00000000</span><br><span class="line">4C573D58  00000000</span><br><span class="line">4C573D5C  00000000</span><br><span class="line">[[[432CF230]+4]+4]</span><br><span class="line"></span><br><span class="line">0244D660  02160550  ElementS.02160550</span><br><span class="line">0244D664  00000071</span><br><span class="line">0244D668  00000007</span><br><span class="line">0244D66C  021605A8  ElementS.021605A8</span><br><span class="line">0244D670  021605B0  ElementS.021605B0</span><br><span class="line">0244D674  021605B8  ElementS.021605B8</span><br><span class="line">0244D678  0000000A</span><br><span class="line">0244D67C  00000002</span><br><span class="line">[[[[432CF230]+4]+4]+0x0C]</span><br><span class="line"></span><br><span class="line">021605A8  5FC36E05</span><br><span class="line">021605AC  00005492</span><br><span class="line">021605B0  C4D0E5C7</span><br><span class="line">021605B4  0000E4D6</span><br><span class="line">021605B8  C4D0E5C7</span><br><span class="line">021605BC  642EE4D6</span><br><span class="line"></span><br><span class="line">021605A8  清心咒.쓐</span><br><span class="line">[[[[432CF230]+4]+4]+0x0C] = 清心咒</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103135837650.png" alt="image-20230103135837650"></p>
<p>2EEDD430 - [[[14FEE38]+1C]+30] = 2EEDD430 - 2EEDAC10 = 2820</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">2EEDD430  432CF230   人物技能列表</span><br><span class="line">2EEDD434  00000005   人物技能列表长度</span><br><span class="line">2EEDD438  00000010</span><br><span class="line">2EEDD43C  00000010</span><br><span class="line">2EEDD440  01276380  ElementC.01276380</span><br><span class="line">2EEDD444  011ED3B8  ElementC.011ED3B8</span><br><span class="line">2EEDD448  00000000</span><br><span class="line">2EEDD44C  00000000</span><br><span class="line">2EEDD450  00000000</span><br><span class="line">2EEDD454  00000010</span><br><span class="line"></span><br><span class="line">dd [[[14FEE38]+1C]+30] + 2820 = 2EEDD430</span><br></pre></td></tr></table></figure>
<h4 id="人物周围怪物"><a class="markdownIt-Anchor" href="#人物周围怪物">#</a> 人物周围怪物</h4>
<p>猜想：怪物</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Monster</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    m_dwMonsterID;</span><br><span class="line">    MonsterInfo monIfo;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MonsterInfo</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	m_strMonsterName;</span><br><span class="line">    m_dwMonsterID;</span><br><span class="line">    m_Mode;</span><br><span class="line">    m_MonsterGrade;</span><br><span class="line">    m_MonsterShengMing;</span><br><span class="line">    m_MonsterMaxShengMing;</span><br><span class="line">    m_Monster_X_POS;</span><br><span class="line">    m_Monster_Y_POS;</span><br><span class="line">    m_Monster_Z_POS;</span><br><span class="line">    m_MonsterType;    <span class="comment">//npc,monster</span></span><br><span class="line">    </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105211901057.png" alt="image-20230105211901057"></p>
<p>00BE9BA4 - 8B 86 18010000  - mov eax,[esi+00000118]  ESI=5F21EBA8</p>
<p>思路一：</p>
<p>在游戏中用 CE 搜索怪物的相关信息 (怪物的 ID，生命，名字等信息) 定位到怪物对象的地址，然后通过 OD 下访问断点，找到相关代码，分析代码逻辑，最终找到怪物列表</p>
<p>思路二：</p>
<p>网游通过 send 函数断点分析相关操作</p>
<p>1. 怪物的信息偏移地址分析</p>
<p>2. 人物周围的怪物列表</p>
<p>80001C4A</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">00BE7E26 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class="line"></span><br><span class="line">eax = 3EB9CE70</span><br><span class="line"></span><br><span class="line">$+124    00000010 .... </span><br><span class="line">$+128    00000000 .... </span><br><span class="line">$+12C    000003BE ¾... </span><br><span class="line">$+180    00000000 .... </span><br><span class="line">$+184    000003BE ¾... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00C1BD4B - 8B B8 18010000  - mov edi,[eax+00000118]</span><br><span class="line">00C1BD48              | 8B46 04                | mov eax,dword ptr ds:[esi+4]                   | 3EB978D0</span><br><span class="line">00C1BD4B              | 8BB8 18010000          | mov edi,dword ptr ds:[eax+118]                 | 80001C46</span><br><span class="line">00C1BD51              | 8BB0 B4000000          | mov esi,dword ptr ds:[eax+B4]                  | 00000006</span><br><span class="line">00C1BD57              | E8 F40D0100            | call elementclient.C2CB50                      |</span><br><span class="line"></span><br><span class="line">00BE9BA4 - 8B 86 18010000  - mov eax,[esi+00000118]</span><br><span class="line"></span><br><span class="line">00C17B6A - 8B BF 18010000  - mov edi,[edi+00000118]   3EB9CE70</span><br><span class="line">00C17B64              | 8BB7 B4000000          | mov esi,dword ptr ds:[edi+B4]                  | 00000006</span><br><span class="line">00C17B6A              | 8BBF 18010000          | mov edi,dword ptr ds:[edi+118]                 | 80001C4A</span><br><span class="line">00C17B70              | E8 DB4F0100            | call elementclient.C2CB50                      |</span><br><span class="line"></span><br><span class="line">00BE8603 - 8B 86 18010000  - mov eax,[esi+00000118]</span><br><span class="line">00BE8601              | 8B36                   | mov esi,dword ptr ds:[esi]                     |</span><br><span class="line">00BE8603              | 8B86 18010000          | mov eax,dword ptr ds:[esi+118]                 |</span><br><span class="line"></span><br><span class="line">00BE7E26 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class="line">00BE7E23              | 8B4E 04                | mov ecx,dword ptr ds:[esi+4]                   | 00000291</span><br><span class="line">00BE7E26              | 8988 2C010000          | mov dword ptr ds:[eax+12C],ecx                 | </span><br><span class="line">00BE7E2C              | 8B4E 08                | mov ecx,dword ptr ds:[esi+8]                   | 000003BE</span><br><span class="line">00BE7E2F              | 8988 84010000          | mov dword ptr ds:[eax+184],ecx                 | </span><br><span class="line">00BE7E35              | 8B4E 0C                | mov ecx,dword ptr ds:[esi+C]                   |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00F30DED              | 8B89 EC000000          | mov ecx,dword ptr ds:[ecx+EC]                  | </span><br><span class="line">00F30DF3              | 8B45 08                | mov eax,dword ptr ss:[ebp+8]                   |</span><br><span class="line">00F30DF6              | 8B0481                 | mov eax,dword ptr ds:[ecx+eax*4]               |</span><br><span class="line">00F30DF9              | 85C0                   | test eax,eax                                   |</span><br><span class="line">00C50D74              | E8 67002E00            | call elementclient.F30DE0                      |</span><br><span class="line"></span><br><span class="line">00B69BBB - FF B3 18010000  - push [ebx+00000118]</span><br><span class="line"></span><br><span class="line">00B69BBB              | FFB3 18010000          | push dword ptr ds:[ebx+118]                    |</span><br><span class="line">00B69BC1              | F3:0F114424 18         | movss dword ptr ss:[esp+18],xmm0               |</span><br><span class="line">00B69BC7              | E8 64BAECFF            | call elementclient.A35630                      |</span><br><span class="line"></span><br><span class="line">00C15CAB - FF B7 18010000  - push [edi+00000118]</span><br><span class="line"></span><br><span class="line">00C15CE5 - FF B7 18010000  - push [edi+00000118]</span><br><span class="line">00C15CD5              | 8B75 18                | mov esi,dword ptr ss:[ebp+18]                  |</span><br><span class="line">00C15CD8              | 8B4D F0                | mov ecx,dword ptr ss:[ebp-10]                  |</span><br><span class="line">00C15CDB              | 53                     | push ebx                                       |</span><br><span class="line">00C15CDC              | FF75 14                | push dword ptr ss:[ebp+14]                     |</span><br><span class="line">00C15CDF              | 56                     | push esi                                       |</span><br><span class="line">00C15CE0              | 6A 00                  | push 0                                         |</span><br><span class="line">00C15CE2              | FF75 08                | push dword ptr ss:[ebp+8]                      |</span><br><span class="line">00C15CE5              | FFB7 18010000          | push dword ptr ds:[edi+118]                    |</span><br><span class="line">00C15CEB              | E8 9067FCFF            | call elementclient.BDC480                      |</span><br><span class="line"></span><br><span class="line">00C1DE59 - 8B B8 18010000  - mov edi,[eax+00000118]</span><br><span class="line"></span><br><span class="line">00BE7E15   &gt; \8B72 0C       mov esi,dword ptr ds:[edx+0xC]           ;  6FC422FA</span><br><span class="line">00BE7E18   .  FF36          push dword ptr ds:[esi]    80001C4A</span><br><span class="line">00BE7E1A   .  E8 010E0000   call ElementC.00BE8C20    </span><br><span class="line">00BE7E1F   .  85C0          test eax,eax   2A532888</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br></pre></td><td class="code"><pre><span class="line">00A4AA6F              | E8 1C030000            | call elementclient.A4AD90             |</span><br><span class="line"></span><br><span class="line">00A4AD94              | 8BF9                   | mov edi,ecx                           |</span><br><span class="line"></span><br><span class="line">00A4AE03              | 8B8F 98000000          | mov ecx,dword ptr ds:[edi+98]         |</span><br><span class="line"></span><br><span class="line">00A4AE0E              | E8 4DA21900            | call elementclient.BE5060             |</span><br><span class="line"></span><br><span class="line">00BE5088              | 8BF1                   | mov esi,ecx                           |</span><br><span class="line"></span><br><span class="line">00BE50B1              | 8B46 04                | mov eax,dword ptr ds:[esi+4]          |</span><br><span class="line">00BE50B4              | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]         |</span><br><span class="line"></span><br><span class="line">00BE50BB              | 8B4C88 1C              | mov ecx,dword ptr ds:[eax+ecx*4+1C]   | eax = 095D9D28 ecx = 2</span><br><span class="line">00BE50BF              | 85C9                   | test ecx,ecx                          |</span><br><span class="line">00BE50C1              | 74 29                  | je elementclient.BE50EC               |</span><br><span class="line">00BE50C3              | 8B01                   | mov eax,dword ptr ds:[ecx]            |</span><br><span class="line">00BE50C5              | 8D55 D4                | lea edx,dword ptr ss:[ebp-2C]         |</span><br><span class="line">00BE50C8              | 52                     | push edx                              |</span><br><span class="line">00BE50C9              | FF50 34                | call dword ptr ds:[eax+34]            |</span><br><span class="line"></span><br><span class="line">00BE8150              | E8 7BFBFFFF            | call elementclient.BE7CD0             |</span><br><span class="line"></span><br><span class="line">00BE7E15   &gt; \8B72 0C       mov esi,dword ptr ds:[edx+0xC]          1C677902</span><br><span class="line">00BE7E18   .  FF36          push dword ptr ds:[esi]                 80001C4A</span><br><span class="line">00BE7E1A   .  E8 010E0000   call ElementC.00BE8C20</span><br><span class="line">00BE7E1F   .  85C0          test eax,eax                            37327F00</span><br><span class="line">00BE7E21   .  74 60         je XElementC.00BE7E83</span><br><span class="line">00BE7E23   .  8B4E 04       mov ecx,dword ptr ds:[esi+0x4]</span><br><span class="line">00BE7E26   .  8988 2C010000 mov dword ptr ds:[eax+0x12C],ecx</span><br><span class="line">00BE7E2C   .  8B4E 08       mov ecx,dword ptr ds:[esi+0x8]</span><br><span class="line">00BE7E2F   .  8988 84010000 mov dword ptr ds:[eax+0x184],ecx</span><br><span class="line">00BE7E35   .  8B4E 0C       mov ecx,dword ptr ds:[esi+0xC]</span><br><span class="line"></span><br><span class="line">call 00BE8C20通过怪物ID得到怪物对象</span><br><span class="line">00BE8C20  /$  55            push ebp</span><br><span class="line">00BE8C21  |.  8BEC          mov ebp,esp</span><br><span class="line">00BE8C23  |.  83EC 08       sub esp,0x8</span><br><span class="line">00BE8C26  |.  56            push esi</span><br><span class="line">00BE8C27  |.  8BF1          mov esi,ecx</span><br><span class="line">00BE8C29  |.  8D45 08       lea eax,[arg.1]</span><br><span class="line">00BE8C2C  |.  50            push eax</span><br><span class="line">00BE8C2D  |.  8D45 F8       lea eax,[local.2]</span><br><span class="line">00BE8C30  |.  50            push eax</span><br><span class="line">00BE8C31  |.  8D4E 14       lea ecx,dword ptr ds:[esi+0x14]    esi = 0A3F6DD8</span><br><span class="line">00BE8C34  |.  E8 57130000   call ElementC.00BE9F90</span><br><span class="line"></span><br><span class="line">00BE9F90   $  55            push ebp</span><br><span class="line">00BE9F91   .  8BEC          mov ebp,esp</span><br><span class="line">00BE9F93   .  8B45 0C       mov eax,dword ptr ss:[ebp+0xC]    0019EECC</span><br><span class="line">00BE9F96   .  33D2          xor edx,edx</span><br><span class="line">00BE9F98   .  56            push esi   0A3F6DD8 </span><br><span class="line">00BE9F99   .  8B30          mov esi,dword ptr ds:[eax]   80001C4A</span><br><span class="line">00BE9F9B   .  8BC6          mov eax,esi</span><br><span class="line">00BE9F9D   .  F771 14       div dword ptr ds:[ecx+0x14]      eax/301   edx = 000002CB   ecx = 0A3F6DEC</span><br><span class="line">00BE9FA0   .  8B41 08       mov eax,dword ptr ds:[ecx+0x8]  58A9B678 怪物列表地址</span><br><span class="line">00BE9FA3   .  8B0490        mov eax,dword ptr ds:[eax+edx*4]  4F46B068 </span><br><span class="line">00BE9FA6   .  85C0          test eax,eax</span><br><span class="line">00BE9FA8   .  74 11         je XElementC.00BE9FBB</span><br><span class="line">00BE9FB0   &gt;  3970 08       cmp dword ptr ds:[eax+0x8],esi</span><br><span class="line">00BE9FB3   .  74 18         je XElementC.00BE9FCD</span><br><span class="line">00BE9FB5   .  8B00          mov eax,dword ptr ds:[eax]</span><br><span class="line">00BE9FB7   .  85C0          test eax,eax</span><br><span class="line">00BE9FB9   .^ 75 F5         jnz XElementC.00BE9FB0</span><br><span class="line">00BE9FBB   &gt;  8B45 08       mov eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">00BE9FBE   .  5E            pop esi</span><br><span class="line">00BE9FBF   .  C700 00000000 mov dword ptr ds:[eax],0x0</span><br><span class="line">00BE9FC5   .  C640 04 00    mov byte ptr ds:[eax+0x4],0x0</span><br><span class="line">00BE9FC9   .  5D            pop ebp</span><br><span class="line">00BE9FCA   .  C2 0800       retn 0x8 </span><br><span class="line">00BE9FCD              | 8B4D 08                | mov ecx,dword ptr ss:[ebp+8]                      0019EEBC</span><br><span class="line">00BE9FD0              | 83C0 04                | add eax,4                                      |  4F46B06C</span><br><span class="line">00BE9FD3              | 5E                     | pop esi                                        | 0A3F6DD8</span><br><span class="line">00BE9FD4              | 8901                   | mov dword ptr ds:[ecx],eax                     | </span><br><span class="line">00BE9FD6              | 8BC1                   | mov eax,ecx                                    | 0019EEBC</span><br><span class="line">00BE9FD8              | C641 04 01             | mov byte ptr ds:[ecx+4],1                      |</span><br><span class="line">00BE9FDC              | 5D                     | pop ebp                                        |</span><br><span class="line">00BE9FDD              | C2 0800                | ret 8                                          |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">怪物对象通过this指针偏移得到ID，当前血量和最大血量 </span><br><span class="line">+ 12C</span><br><span class="line">+ 184</span><br><span class="line">+ 118</span><br><span class="line"></span><br><span class="line">0A3F6DEC     00000000  .... </span><br><span class="line">0A3F6DF0     0000001E  .... </span><br><span class="line">0A3F6DF4     58A9B678  x¶©X </span><br><span class="line">0A3F6DF8     58A9C27C  |Â©X </span><br><span class="line">0A3F6DFC     00000301  .... </span><br><span class="line">0A3F6E00     00000301  .... </span><br><span class="line">0A3F6E04     00000000  .... </span><br><span class="line">0A3F6E08     00000000  .... </span><br><span class="line">0A3F6E0C     0464E750  Pçd. </span><br><span class="line">0A3F6E10     0464E824  $èd. </span><br><span class="line">ecx + 8 = 58A9B678</span><br><span class="line">58A9C27C - 58A9B678 = C04 </span><br><span class="line"></span><br><span class="line">ecx = esi + 14 = ecx + 14 = [eax+2*4+1C]+14 = [[[esi+4]+1C]+2*4+1C]+14 = [[[ecx+4]+1C]+2*4+1C]+14</span><br><span class="line">= [[[[edi+98]+4]+1C]+2*4+1C]+14 = [[[[[1508514]+98]+4]+1C]+2*4+1C]+14</span><br><span class="line"></span><br><span class="line">$ ==&gt;    4F46B068     00000000 .... </span><br><span class="line">$+4      4F46B06C     37327F00 ..27    ;怪物详细信息</span><br><span class="line">$+8      4F46B070     80001C4A J...    ;怪物ID</span><br><span class="line">$+C      4F46B074     00000000 .... </span><br><span class="line">$+10     4F46B078     00000100 .... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ==&gt;    37327F00  01280C5C \.(. </span><br><span class="line">$+4      37327F04  00000012 .... </span><br><span class="line">$+8      37327F08  01515140 @QQ. </span><br><span class="line">$+C      37327F0C  BF514D40 @MQ¿ </span><br><span class="line">$+10     37327F10  00000000 .... </span><br><span class="line">$+14     37327F14  3F136828 (h.? </span><br><span class="line">$+18     37327F18  00000000 .... </span><br><span class="line">$+1C     37327F1C  00000000 .... </span><br><span class="line">$+20     37327F20  3F800000 ...? </span><br><span class="line">$+24     37327F24  00000000 .... </span><br><span class="line">$+28     37327F28  00000000 .... </span><br><span class="line">$+2C     37327F2C  BF136828 (h.¿ </span><br><span class="line">$+30     37327F30  00000000 .... </span><br><span class="line">$+34     37327F34  BF514D40 @MQ¿ </span><br><span class="line">$+38     37327F38  00000000 .... </span><br><span class="line">$+3C     37327F3C  4430814B K.0D    ;x</span><br><span class="line">$+40     37327F40  427230F2 ò0rB    ;z</span><br><span class="line">$+44     37327F44  C2D852B3 ³RØÂ    ;y</span><br><span class="line">$+48     37327F48  3F800000 ...? </span><br><span class="line">$+4C     37327F4C  BF514D40 @MQ¿ </span><br><span class="line">$+50     37327F50  00000000 .... </span><br><span class="line">$+54     37327F54  3F136828 (h.? </span><br><span class="line">$+58     37327F58  00000000 .... </span><br><span class="line">$+5C     37327F5C  00000000 .... </span><br><span class="line">$+60     37327F60  3F800000 ...? </span><br><span class="line">$+64     37327F64  00000000 .... </span><br><span class="line">$+68     37327F68  00000000 .... </span><br><span class="line">$+6C     37327F6C  BF136828 (h.¿ </span><br><span class="line">$+70     37327F70  00000000 .... </span><br><span class="line">$+74     37327F74  BF514D40 @MQ¿ </span><br><span class="line">$+78     37327F78  00000000 .... </span><br><span class="line">$+7C     37327F7C  4430814B K.0D  ;x</span><br><span class="line">$+80     37327F80  427230F2 ò0rB </span><br><span class="line">$+84     37327F84  C2D852B3 ³RØÂ </span><br><span class="line">$+88     37327F88  3F800000 ...? </span><br><span class="line">$+8C     37327F8C  00000000 .... </span><br><span class="line">$+90     37327F90  00000000 .... </span><br><span class="line">$+94     37327F94  012BA6C8 È¦+. </span><br><span class="line">$+98     37327F98  01246824 $h$. </span><br><span class="line">$+AC     37327FAC  0000000A .... </span><br><span class="line">$+B0     37327FB0  00000000 .... </span><br><span class="line">$+B4     37327FB4  00000006 ....   怪物类型 6 怪物 7 NPC 9 宠物 A GM</span><br><span class="line">$+B8     37327FB8  4208CC54 TÌ.B </span><br><span class="line">$+BC     37327FBC  FFFF0100 ..ÿÿ </span><br><span class="line">$+C0     37327FC0  00000000 .... </span><br><span class="line">$+C4     37327FC4  3F735658 XVs? </span><br><span class="line">$+C8     37327FC8  00000000 .... </span><br><span class="line">$+CC     37327FCC  BE9F08C1 Á..¾ </span><br><span class="line">$+D0     37327FD0  00000000 .... </span><br><span class="line">$+D4     37327FD4  3F740BDE Þ.t? </span><br><span class="line">$+D8     37327FD8  00000000 .... </span><br><span class="line">$+DC     37327FDC  BE9AA083 . .¾ </span><br><span class="line">$+E0     37327FE0  00000096 .... </span><br><span class="line">$+E4     37327FE4  00000096 .... </span><br><span class="line">$+E8     37327FE8  000001B6 ¶... </span><br><span class="line">$+EC     37327FEC  FF000101 ...ÿ </span><br><span class="line">$+F0     37327FF0  A0A1F1A4 ¤ñ¡  </span><br><span class="line">$+F4     37327FF4  3F800000 ...? </span><br><span class="line">$+F8     37327FF8  A1D9690E .iÙ¡ </span><br><span class="line">$+FC     37327FFC  80000000 .... </span><br><span class="line">$+100    37328000  3F800000 ...? </span><br><span class="line">$+104    37328004  00000000 .... </span><br><span class="line">$+108    37328008  FFFFFF00 .ÿÿÿ </span><br><span class="line">$+10C    3732800C  01515158 XQQ. </span><br><span class="line">$+110    37328010  4DC50270 p.ÅM &amp;&quot;`剂&quot;</span><br><span class="line">$+114    37328014  0A3F6DD8 Øm?. </span><br><span class="line">$+118    37328018  80001C4A J... </span><br><span class="line">$+11C    3732801C  0000AE41 A®.. </span><br><span class="line">$+120    37328020  0000AE41 A®.. </span><br><span class="line">$+124    37328024  00000010 ....     ;怪物等级</span><br><span class="line">$+128    37328028  00000000 .... </span><br><span class="line">$+12C    3732802C  000003BE ¾...     ;当前血量</span><br><span class="line">$+184    37328084  000003BE ¾...     ;最大血量</span><br><span class="line">$+250    37328028  00000000 ....     ;1.移动加速  3.防御强化  4.法术抵抗  5.攻击强化  6.法术强化  7.舍命突击   8.生命强化  9.虚弱</span><br><span class="line">$+270    373281 00001388 ....         </span><br><span class="line">$+284    373281 3E312F14 ./1&gt;      L&quot;囚徒怨魂&quot;</span><br><span class="line">$+288    373281 00000000 ....      </span><br><span class="line"></span><br><span class="line">$+2E8    373281 00000000 ....       怪物攻击目标ID</span><br><span class="line">$+2EC    373281 00000000 ....       怪物攻击目标ID</span><br><span class="line">$+320 26674050   ;怪物状态列表基地址</span><br><span class="line">$+324 0000       ;怪物状态个数</span><br></pre></td></tr></table></figure>
<h4 id="挂机功能"><a class="markdownIt-Anchor" href="#挂机功能">#</a> 挂机功能</h4>
<p>1. 挂机需要创建一个线程</p>
<p>2. 线程中循环执行</p>
<p>while()</p>
<p>{</p>
<p>​	选中怪物</p>
<p>​	靠近怪物 (向怪物移动至最远攻击距离内)</p>
<p>​	释放技能</p>
<p>​	判断怪物生命值</p>
<p>​	判断自己生命值</p>
<p>​	…</p>
<p>}</p>
<h4 id="找人物移动call"><a class="markdownIt-Anchor" href="#找人物移动call">#</a> 找人物移动 call</h4>
<p>思路一：人物移动与目标地点的坐标和人物当前地点坐标数据有联系，所以我们可以从这两个数据入手开始查找</p>
<p>思路二：网友一般将人物移动时的数据的逻辑处理放在服务端，游戏客户端与服务端通过网络通讯</p>
<p>所以通过 send 发包函数来定位人物移动的 call 的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">00B503F7 - F3 0F5C 4F 3C  - subss xmm1,[edi+3C]</span><br><span class="line"></span><br><span class="line">00B50421             | 8B8F F4270000         | mov ecx,dword ptr ds:[edi+27F4]                   |</span><br><span class="line">00B50427             | 6A 01                 | push 1                                            |</span><br><span class="line">00B50429             | E8 42F50000           | call elementclient.B5F970                         |</span><br><span class="line"></span><br><span class="line">00B5042E             | 8BF0                  | mov esi,eax                                       |</span><br><span class="line">00B50430             | 8D45 D4               | lea eax,dword ptr ss:[ebp-2C]                     |</span><br><span class="line">00B50433             | 50                    | push eax                                          |</span><br><span class="line">00B50434             | 6A 00                 | push 0                                            |</span><br><span class="line">00B50436             | 8BCE                  | mov ecx,esi                                       |</span><br><span class="line">00B50438             | E8 735C0100           | call elementclient.B660B0                         |</span><br><span class="line"></span><br><span class="line">00B5043D             | 8D85 70FFFFFF         | lea eax,dword ptr ss:[ebp-90]                     |</span><br><span class="line">00B50443             | 8BCE                  | mov ecx,esi                                       |</span><br><span class="line">00B50445             | 50                    | push eax                                          |</span><br><span class="line">00B50446             | 8D85 64FFFFFF         | lea eax,dword ptr ss:[ebp-9C]                     |</span><br><span class="line">00B5044C             | 50                    | push eax                                          |</span><br><span class="line">00B5044D             | E8 2E5A0100           | call elementclient.B65E80                         |</span><br><span class="line"></span><br><span class="line">00B5051A             | 8B8F F4270000         | mov ecx,dword ptr ds:[edi+27F4]                   |</span><br><span class="line">00B50520             | 6A 00                 | push 0                                            |</span><br><span class="line">00B50522             | 56                    | push esi                                          |</span><br><span class="line">00B50523             | 6A 01                 | push 1                                            |</span><br><span class="line">00B50525             | E8 36020100           | call elementclient.B60760                         |</span><br><span class="line"></span><br><span class="line">$-2C     0019EEA0  44DB58AF    </span><br><span class="line">$-28     0019EEA4  43565AF2    </span><br><span class="line">$-24     0019EEA8  45889118    </span><br><span class="line"></span><br><span class="line">$-90     0019EE3C  3D5ECC82    </span><br><span class="line">$-8C     0019EE40  3F22F622    </span><br><span class="line">$-88     0019EE44  BF44F0D6    </span><br><span class="line"></span><br><span class="line">$-9C     0019EE30  44DB97A2    </span><br><span class="line">$-98     0019EE34  435B1654    </span><br><span class="line">$-94     0019EE38  4588AF10    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sub esp,0x18</span><br><span class="line">mov ecx,0150B6FC</span><br><span class="line">mov ecx,[ecx]</span><br><span class="line">mov ecx,[ecx+30]</span><br><span class="line">mov ecx,[ecx+27F4]</span><br><span class="line">push 1</span><br><span class="line">call 0x0B5F970</span><br><span class="line"></span><br><span class="line">mov esi,eax</span><br><span class="line">mov ebx,44DB58AF</span><br><span class="line">mov [esp+0x0],ebx</span><br><span class="line">mov ebx,43565AF2</span><br><span class="line">mov [esp+0x4],ebx</span><br><span class="line">mov ebx,45889118</span><br><span class="line">mov [esp+0x8],ebx</span><br><span class="line">lea eax,[esp]</span><br><span class="line">push eax</span><br><span class="line">push 0</span><br><span class="line">mov ecx,esi</span><br><span class="line">call 0x0B660B0   </span><br><span class="line"></span><br><span class="line">mov edx,3D5ECC82</span><br><span class="line">mov [esp+0xC],edx</span><br><span class="line">mov edx,3F22F622</span><br><span class="line">mov [esp+0x10],edx</span><br><span class="line">mov edx,0x0BF44F0D6</span><br><span class="line">mov [esp+0x14],edx</span><br><span class="line">mov ecx,esi</span><br><span class="line">lea eax,[esp+0xC]</span><br><span class="line">push eax</span><br><span class="line">lea eax,[esp]</span><br><span class="line">push eax</span><br><span class="line">call 0x0B65E80 </span><br><span class="line"></span><br><span class="line">mov ecx,0150B6FC</span><br><span class="line">mov ecx,[ecx]</span><br><span class="line">mov ecx,[ecx+30]</span><br><span class="line">mov ecx,[ecx+27F4]</span><br><span class="line">push 0</span><br><span class="line">push esi</span><br><span class="line">push 1</span><br><span class="line">call 0x0B60760   </span><br><span class="line"></span><br><span class="line">add esp,0x18</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00B661C4 - F3 0F5C 50 3C  - subss xmm2,[eax+3C]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="找人物背包物品列表"><a class="markdownIt-Anchor" href="#找人物背包物品列表">#</a> 找人物背包物品列表</h4>
<p>思路一：以背包中某一种物品来分析，最好是能叠加的，数量可以改变</p>
<p>物品列表 -&gt; 多种物品 (名字，数量)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">00BA02D6 - 01 41 14  - add [ecx+14],eax</span><br><span class="line"></span><br><span class="line">00BA02D0             | 55                    | push ebp                              |</span><br><span class="line">00BA02D1             | 8BEC                  | mov ebp,esp                           |</span><br><span class="line">00BA02D3             | 8B45 08               | mov eax,dword ptr ss:[ebp+8]          | FFFFFFFF</span><br><span class="line">00BA02D6             | 0141 14               | add dword ptr ds:[ecx+14],eax         | ecx = 72221188</span><br><span class="line">00BA02D9             | 8379 14 00            | cmp dword ptr ds:[ecx+14],0           | ecx+14:L&quot;ш&quot;</span><br><span class="line">00BA02DD             | 7D 07                 | jge elementclient.BA02E6              |</span><br><span class="line">00BA02DF             | C741 14 00000000      | mov dword ptr ds:[ecx+14],0           | ecx+14:L&quot;ш&quot;</span><br><span class="line">00BA02E6             | 8B41 18               | mov eax,dword ptr ds:[ecx+18]         | 0000270F</span><br><span class="line">00BA02E9             | 3941 14               | cmp dword ptr ds:[ecx+14],eax         | ecx+14:L&quot;ш&quot;</span><br><span class="line">00BA02EC             | 7E 03                 | jle elementclient.BA02F1              |</span><br><span class="line">00BA02EE             | 8941 14               | mov dword ptr ds:[ecx+14],eax         | ecx+14:L&quot;ш&quot;</span><br><span class="line">00BA02F1             | 8B41 14               | mov eax,dword ptr ds:[ecx+14]         | 445</span><br><span class="line">00BA02F4             | 5D                    | pop ebp                               |</span><br><span class="line">00BA02F5             | C2 0400               | ret 4                                 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ ==&gt;    722211 0127B5E4 äµ&#x27;. </span><br><span class="line">$+4      722211 00000000 .... </span><br><span class="line">$+8      722211 00000009 ....   ;物品类型 回血蓝0x09   0x08生产材料 0x1F仙药  0x0F武器 0x3装备 0x2弹药</span><br><span class="line">$+C      722211 00000710 ....   ;ID    708(生命)  710(真气)</span><br><span class="line">$+10     722211 00000000 .... </span><br><span class="line">$+14     722211 00000447 G...   ;物品数量</span><br><span class="line">$+18     722211 0000270F .&#x27;..   ;物品栏最大数量</span><br><span class="line">$+1C     722211 00000000 .... </span><br><span class="line">$+20     722211 00000384 .... </span><br><span class="line"></span><br><span class="line">$ ==&gt;    722225B8   4B684590 .EhK </span><br><span class="line">$+4      722225BC   4B684518 .EhK </span><br><span class="line">$+8      722225C0   72220770 p.&quot;r </span><br><span class="line">$+C      722225C4   5D938E30 0..] </span><br><span class="line">$+10     722225C8   4B6844A0  DhK </span><br><span class="line">$+14     722225CC   4B684428 (DhK </span><br><span class="line">$+18     722225D0   4B6843B0 °ChK </span><br><span class="line">$+1C     722225D4   722207F8 ø.&quot;r </span><br><span class="line">$+20     722225D8   4B684338 8ChK </span><br><span class="line">$+24     722225DC   513FCC68 hÌ?Q </span><br><span class="line">$+28     722225E0   70B166F8 øf±p </span><br><span class="line">$+2C     722225E4   5FE23F60 `?â_ </span><br><span class="line">$+30     722225E8   72221D38 8.&quot;r </span><br><span class="line">$+34     722225EC   72221CB0 °.&quot;r </span><br><span class="line">$+38     722225F0   72221188 ..&quot;r </span><br><span class="line">$+3C     722225F4   4B683D20  =hK </span><br><span class="line">$+40     722225F8   4B683CA8 ¨&lt;hK </span><br><span class="line">$+44     722225FC   4B683C30 0&lt;hK </span><br><span class="line">$+48     72222600   099B88E0 à... &amp;&quot; 品&quot;</span><br><span class="line">$+4C     72222604   099B8A28 (... &amp;&quot; 品&quot;</span><br><span class="line">$+50     72222608   099B8B70 p... &amp;&quot; 品&quot;</span><br><span class="line">$+54     7222260C   099B96F8 ø... &amp;&quot;P痈&quot;</span><br><span class="line">$+58     72222610   099B8CB8 ¸... &amp;&quot; 品&quot;</span><br><span class="line">$+5C     72222614   4B683BB8 ¸;hK </span><br><span class="line">$+60     72222618   099B8E00 .... </span><br><span class="line">$+64     7222261C   099B8F48 H... &amp;&quot; 品&quot;</span><br><span class="line">$+68     72222620   099B9090 .... &amp;&quot; 品&quot;</span><br><span class="line">$+6C     72222624   099B91D8 Ø... &amp;&quot; 品&quot;</span><br><span class="line">$+70     72222628   099B9320  ... &amp;&quot; 品&quot;</span><br><span class="line">$+74     7222262C   099B9468 h... &amp;&quot;P痈&quot;</span><br><span class="line">$+78     72222630   099B95B0 °... &amp;&quot;P痈&quot;</span><br><span class="line">$+7C     72222634   00000000 .... </span><br><span class="line"></span><br><span class="line">00B77B73 - 8B 47 0C  - mov eax,[edi+0C]</span><br><span class="line">00B77B73             | 8B47 0C               | mov eax,dword ptr ds:[edi+C]          | 722225B8</span><br><span class="line">00B77B76             | 53                    | push ebx                              | 72221188</span><br><span class="line">00B77B77             | 8B1CB0                | mov ebx,dword ptr ds:[eax+esi*4]      |</span><br><span class="line">00B77B7A             | 85DB                  | test ebx,ebx                          |</span><br><span class="line">00B77B7C             | 74 1D                 | je elementclient.B77B9B               |</span><br><span class="line">00B77B7E             | 8B45 0C               | mov eax,dword ptr ss:[ebp+C]          | 1</span><br><span class="line">00B77B81             | 8BCB                  | mov ecx,ebx                           | 72221188</span><br><span class="line">00B77B83             | F7D8                  | neg eax                               |</span><br><span class="line">00B77B85             | 50                    | push eax                              | -1</span><br><span class="line">00B77B86             | E8 45870200           | call elementclient.BA02D0             | eax = 0x441 edi = 30AD5BF8</span><br><span class="line">[edi+c]</span><br><span class="line"></span><br><span class="line">00B34C88             | 51                    | push ecx                              |</span><br><span class="line">00B34C89             | 8BC8                  | mov ecx,eax                           | eax = 30AD5BF8  30AD5BF8</span><br><span class="line"></span><br><span class="line">00B34CC2             | 8B4D 08               | mov ecx,dword ptr ss:[ebp+8]          |</span><br><span class="line">00B34CCA             | 50                    | push eax                              | </span><br><span class="line">00B34CCB             | E8 902E0400           | call elementclient.B77B60             |</span><br><span class="line"></span><br><span class="line">00B49A78             | FF2485 009BB400       | jmp dword ptr ds:[eax*4+B49B00]       |</span><br><span class="line">00B49A7F             | 8B81 40180000         | mov eax,dword ptr ds:[ecx+1840]       | ecx = 3E1DA010</span><br><span class="line">00B49A85             | 5D                    | pop ebp                               |</span><br><span class="line">00B49A86             | C2 0400               | ret 4                                 |</span><br><span class="line"></span><br><span class="line">[[[[[[0150B6FC]+30] + 1840]+C]+x*4] +0x14]    x [0-31]       //物品数量</span><br><span class="line">[[[[0150B6FC]+30] + 1840]+10]</span><br><span class="line">$ ==&gt;    30AD5BF8   0127AB74 t«&#x27;. </span><br><span class="line">$+4      30AD5BFC   0127AB6C l«&#x27;. </span><br><span class="line">$+8      30AD5C00   011EF3B8 ¸ó..   </span><br><span class="line">$+C      30AD5C04   722225B8 ¸%&quot;r  ;背包物品列表</span><br><span class="line">$+10     30AD5C08   00000020  ...  ;背包大小</span><br><span class="line">$+14     30AD5C0C   00000020  ... </span><br><span class="line">$+18     30AD5C10   0000000A .... </span><br><span class="line">$+1C     30AD5C14   00000000 .... </span><br><span class="line">$+20     30AD5C18   00010100 .... </span><br><span class="line">$+40     4B6845D0  3F800000 ...? </span><br><span class="line">$+44     4B6845D4  00000000 .... </span><br><span class="line">$+48     4B6845D8  00000000 .... </span><br><span class="line">$+4C     4B6845DC  537177BC ¼wqS L&quot;^aa32ff星云散聚石 (12)\\r^ffffff价格^ffffff 1 银币^ffffff (12) \\r^00ffff\\r死亡保护\\r不可丢在地上\\r不可交易\\r不可放入账号仓库\\r^FF0000占星^ffcb4a必备之物，占星时星盘属性数目、\\r属性内容、属性位置同时随机变化。\\r\\r^96f5ff占星时提供星运经验：1&quot;</span><br><span class="line">$+50     4B6845E0  00000000 .... </span><br><span class="line">$+54     4B6845E4  00000000 .... </span><br><span class="line">$+58     4B6845E8  00000000 .... </span><br><span class="line">$+5C     4B6845EC  00000000 .... </span><br><span class="line">$+60     4B6845F0  00000000 .... </span><br><span class="line">$+64     4B6845F4  00000000 .... </span><br><span class="line">$+68     4B6845F8  28B10B10 ..±(  ;物品属性地址</span><br><span class="line">$+6C     4B6845FC  00000000 .... </span><br><span class="line"></span><br><span class="line">537177BC ^aa32ff星云散聚石 (12)\r^ffffff价格^fff</span><br><span class="line"></span><br><span class="line">$ ==&gt;    28B10B10 0000B985 .¹.. </span><br><span class="line">$+4      28B10B14 4E91661F .f.N </span><br><span class="line">$+8      28B10B18 805A6563 ceZ. </span><br><span class="line">$+C      28B10B1C 000077F3 ów.. </span><br><span class="line">$+10     28B10B20 00000000 .... </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">物品类型 = 0x09的偏移 [[[[[[0150B6FC]+30] + 1840]+C]+1*4] +0x68]+4</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125203049839.png" alt="image-20230125203049839"></p>
<p>特征码</p>
<p>使用 *？匹配通配符</p>
<p>根据特征码找游戏更新之后的新 call</p>
<h4 id="找使用背包物品call"><a class="markdownIt-Anchor" href="#找使用背包物品call">#</a> 找使用背包物品 call</h4>
<p>自动吃红药</p>
<p>自动吃蓝药</p>
<p>免疫药</p>
<p>无敌药</p>
<p>思路 1：</p>
<p>以某种物品的相关信息为线索 (名称，数量，ID 等)，用 CE 监视当使用物品时哪些代码对这些信息有访问，大致定位出使用物品 call 的范围</p>
<p>思路 2：</p>
<p>对于网游，物品相关的逻辑处理一般是放在服务端处理，所以使用物品的时候必定与服务端有网络数据通讯，所以断点通过 send 函数也可以定位物品使用代码的位置</p>
<p>bp sned 对 socket 库中的发包函数下断电</p>
<p>send-&gt; 系统的发送数据的函数</p>
<p>游戏本身 -&gt; 也有自己的发包函数 sendmsg，这函数里面调用了 send</p>
<p>SendData(char* data, int length)</p>
<p>{</p>
<p>​	…;</p>
<p>​	send();</p>
<p>}</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">00B5A8AA - FF 77 0C  - push [edi+0C]</span><br><span class="line"></span><br><span class="line">00B5BC9F - FF 77 0C  - push [edi+0C]</span><br><span class="line">00B5BC97             | 8B5D 0C               | mov ebx,dword ptr ss:[ebp+C]          | 0</span><br><span class="line">00B5BC9A             | 8B4D E0               | mov ecx,dword ptr ss:[ebp-20]         | 1C58A028 1C58A028</span><br><span class="line">00B5BC9D             | 6A 01                 | push 1                                | 1</span><br><span class="line">00B5BC9F             | FF77 0C               | push dword ptr ds:[edi+C]             | 710</span><br><span class="line">00B5BCA2             | 81C1 EC000000         | add ecx,EC                            |</span><br><span class="line">00B5BCA8             | 53                    | push ebx                              |</span><br><span class="line">00B5BCA9             | 6A 00                 | push 0                                | 0</span><br><span class="line">00B5BCAB             | E8 9025E5FF           | call elementclient.9AE240             | 0</span><br><span class="line"></span><br><span class="line">push 1</span><br><span class="line">push 710</span><br><span class="line">mov ecx,1C58A028</span><br><span class="line">add ecx,0x0EC</span><br><span class="line">push 0</span><br><span class="line">push 0</span><br><span class="line">call 9AE240</span><br><span class="line"></span><br><span class="line">00B34C9D - 39 43 0C  - cmp [ebx+0C],eax</span><br><span class="line"></span><br><span class="line">00D7CC65             | 6A 00                 | push 0                                |</span><br><span class="line">00D7CC67             | 6A 01                 | push 1                                |</span><br><span class="line">00D7CC69             | 68 61CE2F01           | push elementclient.12FCE61            |</span><br><span class="line">00D7CC6E             | FF35 64DF5001         | push dword ptr ds:[150DF64]           |</span><br><span class="line">00D7CC74             | FF15 488A1E01         | call dword ptr ds:[&lt;&amp;send&gt;]           |</span><br><span class="line"></span><br><span class="line">00D7CBA1             | FF75 10               | push dword ptr ss:[ebp+10]            |</span><br><span class="line">00D7CBA4             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class="line">00D7CBA7             | E8 24000000           | call elementclient.D7CBD0             |</span><br><span class="line"></span><br><span class="line">00D7D8FC             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class="line">00D7D8FF             | 8B8E AC000000         | mov ecx,dword ptr ds:[esi+AC]         |</span><br><span class="line">00D7D905             | 57                    | push edi                              |</span><br><span class="line">00D7D906             | FFB6 B0000000         | push dword ptr ds:[esi+B0]            |</span><br><span class="line">00D7D90C             | E8 0FF2FFFF           | call elementclient.D7CB20             |</span><br><span class="line"></span><br><span class="line">00D7D701             | 66:8906               | mov word ptr ds:[esi],ax              | esi:L&quot;萨ā&quot;</span><br><span class="line">00D7D704             | 6A 00                 | push 0                                |</span><br><span class="line">00D7D706             | 8D45 DC               | lea eax,dword ptr ss:[ebp-24]         |</span><br><span class="line">00D7D709             | 8BCF                  | mov ecx,edi                           | 1C58A028</span><br><span class="line">00D7D70B             | 50                    | push eax                              |</span><br><span class="line">00D7D70C             | E8 9F000000           | call elementclient.D7D7B0             |</span><br><span class="line"></span><br><span class="line">//send packet</span><br><span class="line">00CD2984             | 8A4D 08               | mov cl,byte ptr ss:[ebp+8]            |</span><br><span class="line">00CD2987             | B8 28000000           | mov eax,28                            | 28:&#x27;(&#x27;</span><br><span class="line">00CD298C             | 66:8906               | mov word ptr ds:[esi],ax              |</span><br><span class="line">00CD298F             | 0FB645 0C             | movzx eax,byte ptr ss:[ebp+C]         |</span><br><span class="line">00CD2993             | 66:8946 04            | mov word ptr ds:[esi+4],ax            |</span><br><span class="line">00CD2997             | 8B45 10               | mov eax,dword ptr ss:[ebp+10]         |</span><br><span class="line">00CD299A             | 8946 06               | mov dword ptr ds:[esi+6],eax          |</span><br><span class="line">00CD299D             | 8A45 14               | mov al,byte ptr ss:[ebp+14]           |</span><br><span class="line">00CD29A0             | 884E 02               | mov byte ptr ds:[esi+2],cl            |</span><br><span class="line">00CD29A3             | 8846 03               | mov byte ptr ds:[esi+3],al            |</span><br><span class="line">00CD29A6             | 8B0D 20205001         | mov ecx,dword ptr ds:[1502020]        |</span><br><span class="line">00CD29AC             | 6A 0A                 | push A                                | 包长度</span><br><span class="line">00CD29AE             | 56                    | push esi                              | 数据</span><br><span class="line">00CD29AF             | 8B49 20               | mov ecx,dword ptr ds:[ecx+20]         |</span><br><span class="line">00CD29B2             | E8 C9AC0A00           | call elementclient.D7D680             |</span><br><span class="line"></span><br><span class="line">00A4B758             | 50                    | push eax                              |</span><br><span class="line">00A4B759             | A3 CC235001           | mov dword ptr ds:[15023CC],eax        |</span><br><span class="line">00A4B75E             | E8 AD432800           | call elementclient.CCFB10             |</span><br><span class="line"></span><br><span class="line">00A408FE             | C787 D4040000 FA00000 | mov dword ptr ds:[edi+4D4],FA         | edi+4D4:L&quot; &quot;</span><br><span class="line">00A40908             | FFB7 D4040000         | push dword ptr ds:[edi+4D4]           | edi+4D4:L&quot; &quot;</span><br><span class="line">00A4090E             | 8B4F 1C               | mov ecx,dword ptr ds:[edi+1C]         |</span><br><span class="line">00A40911             | E8 EAAA0000           | call elementclient.A4B400             |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">009AE282             | FF75 14               | push dword ptr ss:[ebp+14]            |</span><br><span class="line">009AE285             | 8911                  | mov dword ptr ds:[ecx],edx            |</span><br><span class="line">009AE287             | FF75 10               | push dword ptr ss:[ebp+10]            |</span><br><span class="line">009AE28A             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class="line">009AE28D             | FF75 08               | push dword ptr ss:[ebp+8]             |</span><br><span class="line">009AE290             | E8 DB463200           | call elementclient.CD2970             |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">04B6E034 28 00 00 01 00 00 10 07 00 00 DE FF 3F 01 28 E0 (.........Þÿ?.(à </span><br><span class="line">0028 0100 0000 0710  0000</span><br></pre></td></tr></table></figure>
<h2 id="从逆向的角度看c"><a class="markdownIt-Anchor" href="#从逆向的角度看c">#</a> 从逆向的角度看 C++</h2>
<h3 id="虚函数"><a class="markdownIt-Anchor" href="#虚函数">#</a> 虚函数</h3>
<ul>
<li><strong>虚函数地址表（虚表）</strong></li>
</ul>
<ol>
<li>
<ol>
<li>定义：当类中定义有虚函数时，编译器会把该类中所有虚函数的首地址保存在一张地址表中，即虚函数地址表。</li>
<li>虚表信息在编译后被链接到执行文件中，因此所获得的虚表地址是一个固定的地址。</li>
<li>虚表中虚函数的地址排列顺序依据虚函数在类中的声明顺序而定。</li>
</ol>
</li>
</ol>
<ul>
<li>
<p><strong>虚表指针</strong></p>
</li>
<li>
<ul>
<li>同时编译器还会在类的每个对象添加一个隐藏数据成员，称为虚表指针，保存着虚表的首地址，用于记录和查找虚函数。</li>
<li>虚表指针的初始化是通过编译器在构造函数中插入代码实现的。由于必须初始化虚表指针，编译器会提供默认的构造函数。</li>
</ul>
</li>
<li>
<p><strong>虚函数调用过程</strong></p>
</li>
<li>
<ul>
<li>虚表间接寻址访问：<br>
使用对象的指针或引用调用虚函数。根据对象的首地址，取出相应的虚表指针，在虚表查找对应的虚函数的首地址，并调用执行。</li>
<li>直接调用访问：<br>
使用对象调用虚函数，和调用普通成员函数一样。</li>
<li>虚函数的识别：</li>
<li>类中隐式定义一个数据成员</li>
<li>数据成员在首地址处，占 4 字节</li>
<li>构造函数初始化该数据成员为某个数组的首地址</li>
<li>地址属于数据区，相对固定的地址</li>
<li>数组的成员是函数指针</li>
<li>函数被调用方式是 thiscall</li>
<li>构造函数与析构函数都会将虚表指针设置为当前对象所属类中的虚表地址。</li>
<li>构造函数中是完成虚表指针的初始化，此时虚表指针并没有指向虚表函数。</li>
<li>执行析构函数时，其对象的虚表指针已经指向某个虚表首地址。虚函数是在还原虚表指针，让其指向自身的虚表首地址，防止在析构函数中调用虚函数时取到非自身虚表</li>
</ul>
</li>
</ul>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1654326102652-35f05218-3401-41f7-a10f-3e70d9aed416.png" alt="img"></p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1654326120551-f6cd8e66-fc26-40bd-8d23-a8f6b93c7805.png" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">class base_class</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">    int m_base;</span><br><span class="line">public:</span><br><span class="line">    virtual void v_func1()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func1()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    virtual void v_func2()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func2()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    virtual void v_func3()</span><br><span class="line">    &#123;</span><br><span class="line">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func3()&quot; &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	base_class Myclass;</span><br><span class="line">	Myclass.v_func1();</span><br><span class="line">	Myclass.v_func2();</span><br><span class="line">	Myclass.v_func3();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对应的汇编为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">000A1520 &gt;  55              push    ebp</span><br><span class="line">000A1521    8BEC            mov     ebp,esp</span><br><span class="line">000A1523    81EC D0000000   sub     esp,0xD0</span><br><span class="line">000A1529    53              push    ebx</span><br><span class="line">000A152A    56              push    esi</span><br><span class="line">000A152B    57              push    edi</span><br><span class="line">000A152C    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class="line">000A1532    B9 34000000     mov     ecx,0x34</span><br><span class="line">000A1537    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">000A153C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">000A153E    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class="line">000A1541    E8 A4FCFFFF     call    000A11EA</span><br><span class="line"></span><br><span class="line">000A1546    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class="line">000A1549    E8 D0FAFFFF     call    000A101E</span><br><span class="line"></span><br><span class="line">000A154E    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class="line">000A1551    E8 62FCFFFF     call    000A11B8</span><br><span class="line"></span><br><span class="line">000A1556    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class="line">000A1559    E8 3CFCFFFF     call    000A119A</span><br><span class="line"></span><br><span class="line">000A155E    33C0            xor     eax,eax</span><br><span class="line">000A1560    52              push    edx</span><br><span class="line">000A1561    8BCD            mov     ecx,ebp</span><br><span class="line">000A1563    50              push    eax</span><br><span class="line">000A1564    8D15 88150A00   lea     edx,dword ptr ds:[0xA1588]</span><br><span class="line">000A156A    E8 4FFBFFFF     call    000A10BE</span><br><span class="line">000A156F    58              pop     eax</span><br><span class="line">000A1570    5A              pop     edx</span><br><span class="line">000A1571    5F              pop     edi</span><br><span class="line">000A1572    5E              pop     esi</span><br><span class="line">000A1573    5B              pop     ebx</span><br><span class="line">000A1574    81C4 D0000000   add     esp,0xD0</span><br><span class="line">000A157A    3BEC            cmp     ebp,esp</span><br><span class="line">000A157C    E8 50FCFFFF     call    000A11D1</span><br><span class="line">000A1581    8BE5            mov     esp,ebp</span><br><span class="line">000A1583    5D              pop     ebp</span><br><span class="line">000A1584    C3              retn</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">//000A11EA处的代码为</span><br><span class="line">013E11EA   /E9 61050000     jmp     base_class::base_class</span><br><span class="line"></span><br><span class="line">013E1750 &gt;  55              push    ebp</span><br><span class="line">013E1751    8BEC            mov     ebp,esp</span><br><span class="line">013E1753    81EC CC000000   sub     esp,0xCC</span><br><span class="line">013E1759    53              push    ebx</span><br><span class="line">013E175A    56              push    esi</span><br><span class="line">013E175B    57              push    edi</span><br><span class="line">013E175C    51              push    ecx</span><br><span class="line">013E175D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">013E1763    B9 33000000     mov     ecx,0x33</span><br><span class="line">013E1768    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">013E176D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">013E176F    59              pop     ecx</span><br><span class="line">013E1770    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">013E1773    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">013E1776    C700 7C783E01   mov     dword ptr ds:[eax],offset base_class::`vftable&#x27;</span><br><span class="line">//此处为虚表的虚表指针eax中的值就是vftable的指针</span><br><span class="line">013E177C    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">013E177F    5F              pop     edi</span><br><span class="line">013E1780    5E              pop     esi</span><br><span class="line">013E1781    5B              pop     ebx</span><br><span class="line">013E1782    8BE5            mov     esp,ebp</span><br><span class="line">013E1784    5D              pop     ebp</span><br><span class="line">013E1785    C3              retn</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">//000A101E处的代码为</span><br><span class="line">013E101E   /E9 AD050000     jmp     base_class::v_func1</span><br><span class="line"></span><br><span class="line">013E15D0 &gt;  55              push    ebp</span><br><span class="line">013E15D1    8BEC            mov     ebp,esp</span><br><span class="line">013E15D3    81EC CC000000   sub     esp,0xCC</span><br><span class="line">013E15D9    53              push    ebx</span><br><span class="line">013E15DA    56              push    esi</span><br><span class="line">013E15DB    57              push    edi</span><br><span class="line">013E15DC    51              push    ecx</span><br><span class="line">013E15DD    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">013E15E3    B9 33000000     mov     ecx,0x33</span><br><span class="line">013E15E8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">013E15ED    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">013E15EF    59              pop     ecx</span><br><span class="line">013E15F0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">013E15F3    8BF4            mov     esi,esp</span><br><span class="line">013E15F5    A1 10B33E01     mov     eax,dword ptr ds:[&lt;&amp;MSVCP90D.std::endl&gt;]</span><br><span class="line">013E15FA    50              push    eax</span><br><span class="line">013E15FB    68 00783E01     push    013E7800                                                                                     ; ASCII 54,&quot;his is base_class&#x27;s v_func1()&quot;</span><br><span class="line">013E1600    8B0D 0CB33E01   mov     ecx,dword ptr ds:[&lt;&amp;MSVCP90D.std::cout&gt;]                                                     ; msvcp90d.std::cout</span><br><span class="line">013E1606    51              push    ecx</span><br><span class="line">013E1607    E8 6BFBFFFF     call    013E1177</span><br><span class="line">013E160C    83C4 08         add     esp,0x8</span><br><span class="line">013E160F    8BC8            mov     ecx,eax</span><br><span class="line">013E1611    FF15 08B33E01   call    dword ptr ds:[&lt;&amp;MSVCP90D.std::basic_ostream&lt;char,std::char_traits&lt;char&gt; &gt;::operator&lt;&lt;&gt;]      ; msvcp90d.std::basic_ostream&lt;wchar_t,std::char_traits&lt;wchar_t&gt; &gt;::operator&lt;&lt;</span><br><span class="line">013E1617    3BF4            cmp     esi,esp</span><br><span class="line">013E1619    E8 B3FBFFFF     call    013E11D1</span><br><span class="line">013E161E    5F              pop     edi</span><br><span class="line">013E161F    5E              pop     esi</span><br><span class="line">013E1620    5B              pop     ebx</span><br><span class="line">013E1621    81C4 CC000000   add     esp,0xCC</span><br><span class="line">013E1627    3BEC            cmp     ebp,esp</span><br><span class="line">013E1629    E8 A3FBFFFF     call    013E11D1</span><br><span class="line">013E162E    8BE5            mov     esp,ebp</span><br><span class="line">013E1630    5D              pop     ebp</span><br><span class="line">013E1631    C3              retn</span><br><span class="line"></span><br><span class="line">000A11B8</span><br><span class="line">000A119A</span><br><span class="line">分别是func2和func3的代码</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109211943483.png" alt="image-20221109211943483"></p>
<h3 id="debug版本和release版本"><a class="markdownIt-Anchor" href="#debug版本和release版本">#</a> debug 版本和 release 版本</h3>
<p>debug 版本：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109212625495.png" alt="image-20221109212625495"></p>
<p>release 版本</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109212653171.png" alt="image-20221109212653171"></p>
<p>debug main</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1654330003859-a991baf8-cefe-46fb-83c2-602148a95ba5.png" alt="img"></p>
<p>release main</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213010383.png" alt="image-20221109213010383"></p>
<p>对于刚刚的虚函数</p>
<p>debug</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213138880.png" alt="image-20221109213138880"></p>
<p>release</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213209477.png" alt="image-20221109213209477"></p>
<h3 id="c中类与继承在汇编中的关系"><a class="markdownIt-Anchor" href="#c中类与继承在汇编中的关系">#</a> C++ 中类与继承在汇编中的关系</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">class employee</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	employee() &#123; printf(&quot;employee()!\n&quot;);&#125;</span><br><span class="line">	~employee() &#123; printf(&quot;~employee()!\n&quot;);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">class manager : public employee</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	manager() &#123; printf(&quot;manager()!\n&quot;);&#125;</span><br><span class="line">	~manager() &#123;  printf(&quot;~maneger()!\n&quot;);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	manager my;</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">010D13D0 &gt;  55              push    ebp</span><br><span class="line">010D13D1    8BEC            mov     ebp,esp</span><br><span class="line">010D13D3    81EC D8000000   sub     esp,0xD8</span><br><span class="line">010D13D9    53              push    ebx</span><br><span class="line">010D13DA    56              push    esi</span><br><span class="line">010D13DB    57              push    edi</span><br><span class="line">010D13DC    8DBD 28FFFFFF   lea     edi,dword ptr ss:[ebp-0xD8]</span><br><span class="line">010D13E2    B9 36000000     mov     ecx,0x36</span><br><span class="line">010D13E7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">010D13EC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">//堆栈操作</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">010D13EE    8D4D FB         lea     ecx,dword ptr ss:[ebp-0x5]</span><br><span class="line">010D13F1    E8 22FDFFFF     call    010D1118</span><br><span class="line">//010D1118   /E9 63030000     jmp     manager::manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">010D13F6    8BF4            mov     esi,esp</span><br><span class="line">010D13F8    FF15 C4820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.getchar&gt;]        ; msvcr90d.getchar</span><br><span class="line">010D13FE    3BF4            cmp     esi,esp</span><br><span class="line">010D1400    E8 54FDFFFF     call    010D1159</span><br><span class="line">010D1405    C785 2CFFFFFF 0&gt;mov     dword ptr ss:[ebp-0xD4],0x0</span><br><span class="line">010D140F    8D4D FB         lea     ecx,dword ptr ss:[ebp-0x5]</span><br><span class="line">010D1412    E8 11FCFFFF     call    010D1028</span><br><span class="line">//010D1028   /E9 33050000     jmp     manager::~manager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">010D1417    8B85 2CFFFFFF   mov     eax,dword ptr ss:[ebp-0xD4]</span><br><span class="line">010D141D    52              push    edx</span><br><span class="line">010D141E    8BCD            mov     ecx,ebp</span><br><span class="line">010D1420    50              push    eax</span><br><span class="line">010D1421    8D15 44140D01   lea     edx,dword ptr ds:[0x10D1444]</span><br><span class="line">010D1427    E8 6AFCFFFF     call    010D1096</span><br><span class="line">010D142C    58              pop     eax</span><br><span class="line">010D142D    5A              pop     edx</span><br><span class="line">010D142E    5F              pop     edi</span><br><span class="line">010D142F    5E              pop     esi</span><br><span class="line">010D1430    5B              pop     ebx</span><br><span class="line">010D1431    81C4 D8000000   add     esp,0xD8</span><br><span class="line">010D1437    3BEC            cmp     ebp,esp</span><br><span class="line">010D1439    E8 1BFDFFFF     call    010D1159</span><br><span class="line">010D143E    8BE5            mov     esp,ebp</span><br><span class="line">010D1440    5D              pop     ebp</span><br><span class="line">010D1441    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">010D1118</span><br><span class="line">010D1118   /E9 63030000     jmp     manager::manager</span><br><span class="line"></span><br><span class="line">010D1480 &gt;  55              push    ebp</span><br><span class="line">010D1481    8BEC            mov     ebp,esp</span><br><span class="line">010D1483    81EC CC000000   sub     esp,0xCC</span><br><span class="line">010D1489    53              push    ebx</span><br><span class="line">010D148A    56              push    esi</span><br><span class="line">010D148B    57              push    edi</span><br><span class="line">010D148C    51              push    ecx</span><br><span class="line">010D148D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">010D1493    B9 33000000     mov     ecx,0x33</span><br><span class="line">010D1498    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">010D149D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">010D149F    59              pop     ecx</span><br><span class="line">010D14A0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">010D14A3    8B4D F8         mov     ecx,dword ptr ss:[ebp-0x8]</span><br><span class="line">010D14A6    E8 FAFBFFFF     call    010D10A5</span><br><span class="line">//010D10A5   /E9 46040000     jmp     employee::employee</span><br><span class="line"></span><br><span class="line">-</span><br><span class="line">010D14AB    8BF4            mov     esi,esp</span><br><span class="line">010D14AD    68 3C570D01     push    010D573C                              ; ASCII &quot;manager()!\n&quot;</span><br><span class="line">010D14B2    FF15 BC820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class="line">010D14B8    83C4 04         add     esp,0x4</span><br><span class="line">010D14BB    3BF4            cmp     esi,esp</span><br><span class="line">010D14BD    E8 97FCFFFF     call    010D1159</span><br><span class="line">010D14C2    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">010D14C5    5F              pop     edi</span><br><span class="line">010D14C6    5E              pop     esi</span><br><span class="line">010D14C7    5B              pop     ebx</span><br><span class="line">010D14C8    81C4 CC000000   add     esp,0xCC</span><br><span class="line">010D14CE    3BEC            cmp     ebp,esp</span><br><span class="line">010D14D0    E8 84FCFFFF     call    010D1159</span><br><span class="line">010D14D5    8BE5            mov     esp,ebp</span><br><span class="line">010D14D7    5D              pop     ebp</span><br><span class="line">010D14D8    C3              retn</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">010D1412    E8 11FCFFFF     call    010D1028</span><br><span class="line">010D1028   /E9 33050000     jmp     manager::~manager</span><br><span class="line"></span><br><span class="line">010D1560 &gt;  55              push    ebp</span><br><span class="line">010D1561    8BEC            mov     ebp,esp</span><br><span class="line">010D1563    81EC CC000000   sub     esp,0xCC</span><br><span class="line">010D1569    53              push    ebx</span><br><span class="line">010D156A    56              push    esi</span><br><span class="line">010D156B    57              push    edi</span><br><span class="line">010D156C    51              push    ecx</span><br><span class="line">010D156D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">010D1573    B9 33000000     mov     ecx,0x33</span><br><span class="line">010D1578    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">010D157D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">010D157F    59              pop     ecx</span><br><span class="line">010D1580    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">010D1583    8BF4            mov     esi,esp</span><br><span class="line">010D1585    68 5C570D01     push    010D575C                                  ; ASCII &quot;~maneger()!\n&quot;</span><br><span class="line">010D158A    FF15 BC820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]         ; msvcr90d.printf</span><br><span class="line">010D1590    83C4 04         add     esp,0x4</span><br><span class="line">010D1593    3BF4            cmp     esi,esp</span><br><span class="line">010D1595    E8 BFFBFFFF     call    010D1159</span><br><span class="line">010D159A    8B4D F8         mov     ecx,dword ptr ss:[ebp-0x8]</span><br><span class="line">010D159D    E8 8BFAFFFF     call    010D102D</span><br><span class="line">//010D102D   /E9 9E050000     jmp     employee::~employee</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">010D15A2    5F              pop     edi</span><br><span class="line">010D15A3    5E              pop     esi</span><br><span class="line">010D15A4    5B              pop     ebx</span><br><span class="line">010D15A5    81C4 CC000000   add     esp,0xCC</span><br><span class="line">010D15AB    3BEC            cmp     ebp,esp</span><br><span class="line">010D15AD    E8 A7FBFFFF     call    010D1159</span><br><span class="line">010D15B2    8BE5            mov     esp,ebp</span><br><span class="line">010D15B4    5D              pop     ebp</span><br><span class="line">010D15B5    C3              retn</span><br></pre></td></tr></table></figure>
<p>private</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">class employee</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">	employee() &#123; printf(&quot;employee()!\n&quot;);&#125;</span><br><span class="line">	~employee() &#123; printf(&quot;~employee()!\n&quot;);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">class manager : public employee</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">	manager() &#123; printf(&quot;manager()!\n&quot;);&#125;</span><br><span class="line">	~manager() &#123;  printf(&quot;~maneger()!\n&quot;);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	manager my;</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="从反汇编角度看this指针"><a class="markdownIt-Anchor" href="#从反汇编角度看this指针">#</a> 从反汇编角度看 this 指针</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line"> </span><br><span class="line">struct MyStruct</span><br><span class="line">&#123;</span><br><span class="line">    int x ;</span><br><span class="line">    int y ;</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">//函数在结构体外部</span><br><span class="line">void Max(MyStruct* str)</span><br><span class="line">&#123;</span><br><span class="line">    if (str-&gt;x &gt; str-&gt;y)</span><br><span class="line">        printf(&quot;%d&quot;,str-&gt;x);</span><br><span class="line">    else</span><br><span class="line">        printf(&quot;%d&quot;,str-&gt;y);</span><br><span class="line">&#125;</span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">    MyStruct haha ;</span><br><span class="line">    haha.x = 1 ;</span><br><span class="line">    haha.y = 2 ;</span><br><span class="line">    Max(&amp;haha);</span><br><span class="line">    printf(&quot;%d\n&quot;,sizeof(haha));</span><br><span class="line">    return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">012A1450 &gt;  55              push    ebp</span><br><span class="line">012A1451    8BEC            mov     ebp,esp</span><br><span class="line">012A1453    81EC D0000000   sub     esp,0xD0</span><br><span class="line">012A1459    53              push    ebx</span><br><span class="line">012A145A    56              push    esi</span><br><span class="line">012A145B    57              push    edi</span><br><span class="line">012A145C    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class="line">012A1462    B9 34000000     mov     ecx,0x34</span><br><span class="line">012A1467    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">012A146C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">012A146E    C745 F4 0100000&gt;mov     dword ptr ss:[ebp-0xC],0x1</span><br><span class="line">012A1475    C745 F8 0200000&gt;mov     dword ptr ss:[ebp-0x8],0x2</span><br><span class="line">012A147C    8D45 F4         lea     eax,dword ptr ss:[ebp-0xC]</span><br><span class="line">012A147F    50              push    eax</span><br><span class="line">012A1480    E8 CAFCFFFF     call    012A114F</span><br><span class="line">//012A114F   /E9 5C020000     jmp     Max</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">012A1485    83C4 04         add     esp,0x4</span><br><span class="line">012A1488    8BF4            mov     esi,esp</span><br><span class="line">012A148A    6A 08           push    0x8</span><br><span class="line">012A148C    68 40572A01     push    012A5740                         ; ASCII &quot;%d\n&quot;</span><br><span class="line">012A1491    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;&gt;; msvcr90d.printf</span><br><span class="line">012A1497    83C4 08         add     esp,0x8</span><br><span class="line">012A149A    3BF4            cmp     esi,esp</span><br><span class="line">012A149C    E8 A4FCFFFF     call    012A1145</span><br><span class="line">012A14A1    33C0            xor     eax,eax</span><br><span class="line">012A14A3    52              push    edx</span><br><span class="line">012A14A4    8BCD            mov     ecx,ebp</span><br><span class="line">012A14A6    50              push    eax</span><br><span class="line">012A14A7    8D15 C8142A01   lea     edx,dword ptr ds:[0x12A14C8]</span><br><span class="line">012A14AD    E8 DAFBFFFF     call    012A108C</span><br><span class="line">012A14B2    58              pop     eax</span><br><span class="line">012A14B3    5A              pop     edx</span><br><span class="line">012A14B4    5F              pop     edi</span><br><span class="line">012A14B5    5E              pop     esi</span><br><span class="line">012A14B6    5B              pop     ebx</span><br><span class="line">012A14B7    81C4 D0000000   add     esp,0xD0</span><br><span class="line">012A14BD    3BEC            cmp     ebp,esp</span><br><span class="line">012A14BF    E8 81FCFFFF     call    012A1145</span><br><span class="line">012A14C4    8BE5            mov     esp,ebp</span><br><span class="line">012A14C6    5D              pop     ebp</span><br><span class="line">012A14C7    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>当 haha.x-&gt; 1 和 haha.x -&gt; 2</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221110101344910.png" alt="image-20221110101344910"></p>
<p>Max:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">012A13B0 &gt;  55              push    ebp</span><br><span class="line">012A13B1    8BEC            mov     ebp,esp</span><br><span class="line">012A13B3    81EC C0000000   sub     esp,0xC0</span><br><span class="line">012A13B9    53              push    ebx</span><br><span class="line">012A13BA    56              push    esi</span><br><span class="line">012A13BB    57              push    edi</span><br><span class="line">012A13BC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class="line">012A13C2    B9 30000000     mov     ecx,0x30</span><br><span class="line">012A13C7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">012A13CC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">012A13CE    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">012A13D1    8B4D 08         mov     ecx,dword ptr ss:[ebp+0x8]</span><br><span class="line">012A13D4    8B10            mov     edx,dword ptr ds:[eax]</span><br><span class="line">012A13D6    3B51 04         cmp     edx,dword ptr ds:[ecx+0x4]</span><br><span class="line">012A13D9    7E 1F           jle     short 012A13FA</span><br><span class="line">012A13DB    8BF4            mov     esi,esp</span><br><span class="line">012A13DD    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">012A13E0    8B08            mov     ecx,dword ptr ds:[eax]</span><br><span class="line">012A13E2    51              push    ecx</span><br><span class="line">012A13E3    68 3C572A01     push    012A573C                               ; ASCII &quot;%d&quot;</span><br><span class="line">012A13E8    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]      ; msvcr90d.printf</span><br><span class="line">012A13EE    83C4 08         add     esp,0x8</span><br><span class="line">012A13F1    3BF4            cmp     esi,esp</span><br><span class="line">012A13F3    E8 4DFDFFFF     call    012A1145</span><br><span class="line">012A13F8    EB 1E           jmp     short 012A1418</span><br><span class="line">012A13FA    8BF4            mov     esi,esp</span><br><span class="line">012A13FC    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class="line">012A13FF    8B48 04         mov     ecx,dword ptr ds:[eax+0x4]</span><br><span class="line">012A1402    51              push    ecx</span><br><span class="line">012A1403    68 3C572A01     push    012A573C                               ; ASCII &quot;%d&quot;</span><br><span class="line">012A1408    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]      ; msvcr90d.printf</span><br><span class="line">012A140E    83C4 08         add     esp,0x8</span><br><span class="line">012A1411    3BF4            cmp     esi,esp</span><br><span class="line">012A1413    E8 2DFDFFFF     call    012A1145</span><br><span class="line">012A1418    5F              pop     edi</span><br><span class="line">012A1419    5E              pop     esi</span><br><span class="line">012A141A    5B              pop     ebx</span><br><span class="line">012A141B    81C4 C0000000   add     esp,0xC0</span><br><span class="line">012A1421    3BEC            cmp     ebp,esp</span><br><span class="line">012A1423    E8 1DFDFFFF     call    012A1145</span><br><span class="line">012A1428    8BE5            mov     esp,ebp</span><br><span class="line">012A142A    5D              pop     ebp</span><br><span class="line">012A142B    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>this 看 ecx</p>
<p>ecx 在内存中为：<br>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221110101730211.png" alt="image-20221110101730211"></p>
<h3 id="反汇编中构造函数和析构函数的识别"><a class="markdownIt-Anchor" href="#反汇编中构造函数和析构函数的识别">#</a> 反汇编中构造函数和析构函数的识别</h3>
<p>代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;windows.h&gt;</span><br><span class="line"></span><br><span class="line">class MyTest</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">    MyTest();</span><br><span class="line">    ~MyTest();</span><br><span class="line">    void SetTest(DWORD dwTest);</span><br><span class="line">    DWORD GetTest();</span><br><span class="line">public:</span><br><span class="line">    DWORD m_dwTest;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"> MyTest::MyTest()</span><br><span class="line"> &#123;</span><br><span class="line">     printf(&quot;1111\n&quot;);</span><br><span class="line">     </span><br><span class="line"> &#125;</span><br><span class="line"> MyTest::~MyTest()</span><br><span class="line"> &#123;</span><br><span class="line">    printf(&quot;2222\n&quot;);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void MyTest::SetTest(DWORD dwTest)</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;m_dwTest = dwTest;   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD MyTest::GetTest()</span><br><span class="line">&#123;</span><br><span class="line">    return this-&gt;m_dwTest;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int _tmain(int argc, _TCHAR* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	MyTest Test;</span><br><span class="line">	Test.SetTest(1);</span><br><span class="line">	int Number = Test.GetTest();</span><br><span class="line">	getchar();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的汇编代码为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">00D11550 &gt;  55              push    ebp</span><br><span class="line">00D11551    8BEC            mov     ebp,esp</span><br><span class="line">00D11553    6A FF           push    -0x1</span><br><span class="line">00D11555    68 E846D100     push    00D146E8</span><br><span class="line">00D1155A    64:A1 00000000  mov     eax,dword ptr fs:[0]</span><br><span class="line">00D11560    50              push    eax</span><br><span class="line">00D11561    81EC E4000000   sub     esp,0xE4</span><br><span class="line">00D11567    53              push    ebx</span><br><span class="line">00D11568    56              push    esi</span><br><span class="line">00D11569    57              push    edi</span><br><span class="line">00D1156A    8DBD 10FFFFFF   lea     edi,dword ptr ss:[ebp-0xF0]</span><br><span class="line">00D11570    B9 39000000     mov     ecx,0x39</span><br><span class="line">00D11575    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00D1157A    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00D1157C    A1 0080D100     mov     eax,dword ptr ds:[__security_coo&gt;</span><br><span class="line">00D11581    33C5            xor     eax,ebp</span><br><span class="line">00D11583    50              push    eax</span><br><span class="line">00D11584    8D45 F4         lea     eax,dword ptr ss:[ebp-0xC]</span><br><span class="line">00D11587    64:A3 00000000  mov     dword ptr fs:[0],eax</span><br><span class="line">00D1158D    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class="line">00D11590    E8 D3FBFFFF     call    00D11168</span><br><span class="line">//00D11168   /E9 73020000     jmp     MyTest::MyTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00D11595    C745 FC 0000000&gt;mov     dword ptr ss:[ebp-0x4],0x0</span><br><span class="line">00D1159C    6A 01           push    0x1</span><br><span class="line">00D1159E    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class="line">00D115A1    E8 CCFBFFFF     call    00D11172</span><br><span class="line">00D11172   /E9 49030000     jmp     MyTest::SetTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00D115A6    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class="line">00D115A9    E8 3CFCFFFF     call    00D111EA</span><br><span class="line">00D111EA   /E9 21030000     jmp     MyTest::GetTest</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00D115AE    8945 E0         mov     dword ptr ss:[ebp-0x20],eax</span><br><span class="line">00D115B1    8BF4            mov     esi,esp</span><br><span class="line">00D115B3    FF15 C492D100   call    dword ptr ds:[&lt;&amp;MSVCR90D.getchar&gt;; msvcr90d.getchar</span><br><span class="line">00D115B9    3BF4            cmp     esi,esp</span><br><span class="line">00D115BB    E8 8AFBFFFF     call    00D1114A</span><br><span class="line">00D115C0    C785 14FFFFFF 0&gt;mov     dword ptr ss:[ebp-0xEC],0x0</span><br><span class="line">00D115CA    C745 FC FFFFFFF&gt;mov     dword ptr ss:[ebp-0x4],-0x1</span><br><span class="line">00D115D1    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class="line">00D115D4    E8 4FFAFFFF     call    00D11028</span><br><span class="line">00D115D9    8B85 14FFFFFF   mov     eax,dword ptr ss:[ebp-0xEC]</span><br><span class="line">00D115DF    52              push    edx</span><br><span class="line">00D115E0    8BCD            mov     ecx,ebp</span><br><span class="line">00D115E2    50              push    eax</span><br><span class="line">00D115E3    8D15 1016D100   lea     edx,dword ptr ds:[0xD11610]</span><br><span class="line">00D115E9    E8 A3FAFFFF     call    00D11091</span><br><span class="line">00D115EE    58              pop     eax</span><br><span class="line">00D115EF    5A              pop     edx</span><br><span class="line">00D115F0    8B4D F4         mov     ecx,dword ptr ss:[ebp-0xC]</span><br><span class="line">00D115F3    64:890D 0000000&gt;mov     dword ptr fs:[0],ecx</span><br><span class="line">00D115FA    59              pop     ecx</span><br><span class="line">00D115FB    5F              pop     edi</span><br><span class="line">00D115FC    5E              pop     esi</span><br><span class="line">00D115FD    5B              pop     ebx</span><br><span class="line">00D115FE    81C4 F0000000   add     esp,0xF0</span><br><span class="line">00D11604    3BEC            cmp     ebp,esp</span><br><span class="line">00D11606    E8 3FFBFFFF     call    00D1114A</span><br><span class="line">00D1160B    8BE5            mov     esp,ebp</span><br><span class="line">00D1160D    5D              pop     ebp</span><br><span class="line">00D1160E    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">00D11590    E8 D3FBFFFF     call    00D11168</span><br><span class="line">//00D11168   /E9 73020000     jmp     MyTest::MyTest</span><br><span class="line"></span><br><span class="line">00D113E0 &gt;  55              push    ebp</span><br><span class="line">00D113E1    8BEC            mov     ebp,esp</span><br><span class="line">00D113E3    81EC CC000000   sub     esp,0xCC</span><br><span class="line">00D113E9    53              push    ebx</span><br><span class="line">00D113EA    56              push    esi</span><br><span class="line">00D113EB    57              push    edi</span><br><span class="line">00D113EC    51              push    ecx</span><br><span class="line">00D113ED    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">00D113F3    B9 33000000     mov     ecx,0x33</span><br><span class="line">00D113F8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00D113FD    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00D113FF    59              pop     ecx</span><br><span class="line">00D11400    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">00D11403    8BF4            mov     esi,esp</span><br><span class="line">00D11405    68 3C67D100     push    00D1673C                                 ; ASCII &quot;1111\n&quot;</span><br><span class="line">00D1140A    FF15 CC92D100   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]        ; msvcr90d.printf</span><br><span class="line">00D11410    83C4 04         add     esp,0x4</span><br><span class="line">00D11413    3BF4            cmp     esi,esp</span><br><span class="line">00D11415    E8 30FDFFFF     call    00D1114A</span><br><span class="line">00D1141A    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">00D1141D    5F              pop     edi</span><br><span class="line">00D1141E    5E              pop     esi</span><br><span class="line">00D1141F    5B              pop     ebx</span><br><span class="line">00D11420    81C4 CC000000   add     esp,0xCC</span><br><span class="line">00D11426    3BEC            cmp     ebp,esp</span><br><span class="line">00D11428    E8 1DFDFFFF     call    00D1114A</span><br><span class="line">00D1142D    8BE5            mov     esp,ebp</span><br><span class="line">00D1142F    5D              pop     ebp</span><br><span class="line">00D11430    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">00D115A1    E8 CCFBFFFF     call    00D11172</span><br><span class="line">00D11172   /E9 49030000     jmp     MyTest::SetTest</span><br><span class="line"></span><br><span class="line">00D114C0 &gt;  55              push    ebp</span><br><span class="line">00D114C1    8BEC            mov     ebp,esp</span><br><span class="line">00D114C3    81EC CC000000   sub     esp,0xCC</span><br><span class="line">00D114C9    53              push    ebx</span><br><span class="line">00D114CA    56              push    esi</span><br><span class="line">00D114CB    57              push    edi</span><br><span class="line">00D114CC    51              push    ecx</span><br><span class="line">00D114CD    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">00D114D3    B9 33000000     mov     ecx,0x33</span><br><span class="line">00D114D8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00D114DD    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00D114DF    59              pop     ecx</span><br><span class="line"></span><br><span class="line">//以下四句为	Test.SetTest(1);的关键代码</span><br><span class="line">00D114E0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx    ;ecx此时为this, i = this </span><br><span class="line">00D114E3    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]	  ;ebp-8是this, eax=this</span><br><span class="line">00D114E6    8B4D 08         mov     ecx,dword ptr ss:[ebp+0x8]    ;ecx = 1 ,ebp+8是从外面传来的1</span><br><span class="line">00D114E9    8908            mov     dword ptr ds:[eax],ecx        ;this-&gt;m = 1</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">00D114EB    5F              pop     edi</span><br><span class="line">00D114EC    5E              pop     esi</span><br><span class="line">00D114ED    5B              pop     ebx</span><br><span class="line">00D114EE    8BE5            mov     esp,ebp</span><br><span class="line">00D114F0    5D              pop     ebp</span><br><span class="line">00D114F1    C2 0400         retn    0x4</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">00D115A9    E8 3CFCFFFF     call    00D111EA</span><br><span class="line">00D111EA   /E9 21030000     jmp     MyTest::GetTest</span><br><span class="line"></span><br><span class="line">00D11510 &gt;  55              push    ebp</span><br><span class="line">00D11511    8BEC            mov     ebp,esp</span><br><span class="line">00D11513    81EC CC000000   sub     esp,0xCC</span><br><span class="line">00D11519    53              push    ebx</span><br><span class="line">00D1151A    56              push    esi</span><br><span class="line">00D1151B    57              push    edi</span><br><span class="line">00D1151C    51              push    ecx</span><br><span class="line">00D1151D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class="line">00D11523    B9 33000000     mov     ecx,0x33</span><br><span class="line">00D11528    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class="line">00D1152D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class="line">00D1152F    59              pop     ecx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//以下三句为int Number = Test.GetTest();的关键代码</span><br><span class="line">00D11530    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class="line">00D11533    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class="line">00D11536    8B00            mov     eax,dword ptr ds:[eax]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00D11538    5F              pop     edi</span><br><span class="line">00D11539    5E              pop     esi</span><br><span class="line">00D1153A    5B              pop     ebx</span><br><span class="line">00D1153B    8BE5            mov     esp,ebp</span><br><span class="line">00D1153D    5D              pop     ebp</span><br><span class="line">00D1153E    C3              retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="动态调试基础"><a class="markdownIt-Anchor" href="#动态调试基础">#</a> 动态调试基础</h2>
<h3 id="断点"><a class="markdownIt-Anchor" href="#断点">#</a> 断点</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">DR0~DR3这四个寄存器是断点地址存储器,用于保存断点的地址</span><br><span class="line">DR6是调试状态寄存器用于指明DR0~DR3寄存器中哪一个产生了调试异常</span><br><span class="line">DR6寄存器使用比特位B0~B3来指明DR0~DR3中哪个产生了调试异常</span><br><span class="line">DR7是断点属性控制器</span><br><span class="line">DR7寄存器分别保存着DR0~DR3的断点地址对应的断点的属性,属性有如下几种:</span><br><span class="line">L0~L3:这个比特位等于1,则断点为本地断点.</span><br><span class="line">G0~G3:这个比特位等于1,则断点为全局断点.</span><br><span class="line">R/W0-R/W3:</span><br><span class="line">00：执行断点</span><br><span class="line">01：数据写入断点</span><br><span class="line">10：I/0读写断点</span><br><span class="line">11：读写断点()读取指令不算)</span><br></pre></td></tr></table></figure>
<p>DR0-DR3 硬件断点</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655191812086-b457e0fc-6a04-403f-a7f4-848fd2617c6e.png" alt="img"></p>
<p>删除硬件断点 调试 -&gt; 硬件断点</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655191872090-b8599c55-b435-459d-9cbc-ec378d651497.png" alt="img"></p>
<p>设置硬件断点  右键 -&gt; 断点 -&gt; 硬件执行</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112211213663.png" alt="image-20221112211213663"></p>
<p>取消硬件断点：  hd 基址</p>
<p>对当前地址做中断，即添加硬件断点： hr 基址</p>
<p>常用断点：软件断点，内存写入，内存访问，硬件执行</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655192756712-0636b463-746a-4c86-8b38-44b2bb9597c5.png" alt="img"></p>
<p>ALT+M 内存镜像</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655192833816-1b08c4ac-e51c-419e-906d-f288dd1d9a22.png" alt="img"></p>
<h3 id="常用调试器"><a class="markdownIt-Anchor" href="#常用调试器">#</a> 常用调试器</h3>
<h4 id="ollyice"><a class="markdownIt-Anchor" href="#ollyice">#</a> OllyICE</h4>
<p>查看在内存在对应的字节码，即指令在内存中的机器码</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655194426316-532565d9-fa78-44e2-b792-c1d4f47c3c65.png" alt="img"></p>
<p>一般来说程序映射到内存中基址从 0040 开始，即 PE 文件头</p>
<p>映射到代码段需要 + 1000，前 1000 是 PE 头信息</p>
<p><img data-src="https://cdn.nlark.com/yuque/0/2022/png/2759285/1655194544858-688f3db0-11f9-4a14-b509-46464ef0c7e3.png" alt="img"></p>
<p>8087 中浮点运行，反调试会用到</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214201466.png" alt="image-20221112214201466"></p>
<p>用于轴坐标，准心，多用于游戏分析</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214252305.png" alt="image-20221112214252305"></p>
<h4 id="xdbg"><a class="markdownIt-Anchor" href="#xdbg">#</a> xdbg</h4>
<p>1. 线程</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214836603.png" alt="image-20221112214836603"></p>
<p>stdcall 一般在函数内部做 ret 做堆栈平衡</p>
<p>windbg</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">0:004&gt; g</span><br><span class="line">(a5c.9dc): Break instruction exception - code 80000003 (first chance)</span><br><span class="line">eax=7efda000 ebx=00000000 ecx=00000000 edx=77a4f7ea esi=00000000 edi=00000000</span><br><span class="line">eip=779c000c esp=02adff5c ebp=02adff88 iopl=0         nv up ei pl zr na pe nc</span><br><span class="line">cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000246</span><br><span class="line">ntdll!DbgBreakPoint:</span><br><span class="line">779c000c cc              int     3</span><br><span class="line">0:004&gt; bp kernel32!OpenProcess</span><br><span class="line">0:004&gt; u kernel32!OpenProcess</span><br><span class="line">kernel32!OpenProcess:</span><br><span class="line">76831986 8bff            mov     edi,edi</span><br><span class="line">76831988 55              push    ebp</span><br><span class="line">76831989 8bec            mov     ebp,esp</span><br><span class="line">7683198b 5d              pop     ebp</span><br><span class="line">7683198c eb05            jmp     kernel32!OpenProcess+0xd (76831993)</span><br><span class="line">7683198e 90              nop</span><br><span class="line">7683198f 90              nop</span><br><span class="line">76831990 90              nop</span><br><span class="line">0:004&gt; u 76831993</span><br><span class="line">kernel32!OpenProcess+0xd:</span><br><span class="line">76831993 ff2554098376    jmp     dword ptr [kernel32+0x10954 (76830954)]</span><br><span class="line">76831999 90              nop</span><br><span class="line">7683199a 90              nop</span><br><span class="line">7683199b 90              nop</span><br><span class="line">7683199c 90              nop</span><br><span class="line">7683199d 90              nop</span><br><span class="line">kernel32!WaitForMultipleObjectsEx:</span><br><span class="line">7683199e 8bff            mov     edi,edi</span><br><span class="line">768319a0 55              push    ebp</span><br></pre></td></tr></table></figure>
<p>VT</p>
<p>需要开启</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221113204110511.png" alt="image-20221113204110511"></p>
<h2 id="动态调试基础二"><a class="markdownIt-Anchor" href="#动态调试基础二">#</a> 动态调试基础二</h2>
<p>ALT+F9  返回调用本函数的函数的代码</p>
<p>rpb radmin.rpb 存在 127.0.0.1 的配置信息</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116181239485.png" alt="image-20221116181239485" style="zoom:67%;" />
<h3 id="硬件断点"><a class="markdownIt-Anchor" href="#硬件断点">#</a> 硬件断点</h3>
<ol>
<li>Intel 80306 以上的 CPU 给我们提供了调试寄存器用于软件调试，硬件断点是通过设置调试寄存器实现的。</li>
</ol>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116183140142.png" alt="image-20221116183140142"></p>
<p>调试时线程挂起</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116183413279.png" alt="image-20221116183413279"></p>
<p>右键 resume all 激活</p>
<p>实现硬件断点，首先要获取当前线程环境</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取线程环境</span></span><br><span class="line">CONTEXT g_Context = &#123; <span class="number">0</span> &#125;;</span><br><span class="line">g_Context.ContextFlags = CONTEXT_CONTROL;</span><br><span class="line"><span class="built_in">GetThreadContext</span>(hThread, &amp;g_Context);</span><br></pre></td></tr></table></figure>
<p>在 CONTEXT 结构体中，存放了诸多当前线程环境的信息</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116184014697.png" alt="image-20221116184014697" style="zoom:67%;" />
<h2 id="ida动态分析基础"><a class="markdownIt-Anchor" href="#ida动态分析基础">#</a> IDA 动态分析基础</h2>
<p>导入表：编译时倒入，通过静态链接到输入表</p>
<p>1.debug -&gt; local 32 debug</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221117210719141.png" alt="image-20221117210719141"></p>
<p>IDA 远程调试</p>
<p>将 dbgsrv 放到要调试的文件夹中</p>
<h2 id="pe文件结构"><a class="markdownIt-Anchor" href="#pe文件结构">#</a> PE 文件结构</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119190434856.png" alt="image-20221119190434856"></p>
<h2 id="windows系统安全基础"><a class="markdownIt-Anchor" href="#windows系统安全基础">#</a> Windows 系统安全基础</h2>
<p>进程句柄表</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/563d88364cb24f768722413a352523a4.png" alt="img"></p>
<p>当你输入用户名和口令时，Winlogon 将其发送给一个叫做 LSASS 的子进程。如果你执行对服务器或工作站的本地登录，LSASS 进程将在安全数据库（亦即 SAM）中查对有关用户名和口令。Winlogon 有两个子进程，即服务控制器和 LSASS。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120184811911.png" alt="image-20221120184811911"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120184825383.png" alt="image-20221120184825383"></p>
<p>Explorer 进程 在 Windows 系列的操作系统中，运行时都会启动一个名为 Explorer.exe 的进程。这个进程主要负责显示系统桌面上的图标以及任务栏。</p>

      <div class="tags">
          <a href="/tags/%E9%80%86%E5%90%91/" rel="tag"><i class="ic i-tag"></i> 逆向</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2023-01-27 11:48:01" itemprop="dateModified" datetime="2023-01-27T11:48:01+08:00">2023-01-27</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="John Doe WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="John Doe Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="John Doe PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2022/11/11/reverse/" title="逆向">http://example.com/2022/11/11/reverse/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2022/11/01/%E6%B1%87%E7%BC%96/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;18a32c514eae0d32a8b4b2a75853a08b.jpg" title="汇编">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> 逆向</span>
  <h3>汇编</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2022/11/17/JWT%20%E5%9F%BA%E7%A1%80/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;2b0a8c81d91579602eee343aff82c4c9.jpg" title="JWT">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> web安全</span>
  <h3>JWT</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#c%E4%B8%8E%E6%B1%87%E7%BC%96%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.</span> <span class="toc-text"> C 与汇编的关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%E6%8A%80%E6%9C%AF%E6%A0%88"><span class="toc-number">1.1.</span> <span class="toc-text"> 应用层技术栈：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E9%80%86%E5%90%91%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text"> 学习逆向环境配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.3.</span> <span class="toc-text"> 进制转换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E4%B8%8E%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-number">1.4.</span> <span class="toc-text"> 数据类型与逻辑运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E9%87%8D%E8%A6%81"><span class="toc-number">1.5.</span> <span class="toc-text"> 常见的数据类型（重要）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E8%BF%90%E7%AE%97%E7%AC%A6%E7%B1%BB%E5%9E%8B%E9%87%8D%E8%A6%81"><span class="toc-number">1.6.</span> <span class="toc-text"> 常见的运算符类型（重要）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#32%E4%BD%8D%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.7.</span> <span class="toc-text"> 32 位寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu%E8%AE%A1%E7%AE%9723"><span class="toc-number">1.8.</span> <span class="toc-text"> CPU 计算 2+3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cpu%E8%AE%A1%E7%AE%972-3"><span class="toc-number">1.9.</span> <span class="toc-text"> CPU 计算 2-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-number">1.10.</span> <span class="toc-text"> 堆栈的原理：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E4%B8%AAhelloworld%E7%9A%84main%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.1.</span> <span class="toc-text"> 一个 helloworld 的 main 函数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8F%90%E5%8D%87%E5%A0%86%E6%A0%88"><span class="toc-number">1.10.2.</span> <span class="toc-text"> 提升堆栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%9D%E6%8A%A4%E7%8E%B0%E5%9C%BA"><span class="toc-number">1.10.3.</span> <span class="toc-text"> 保护现场</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E6%8F%90%E5%8D%87%E7%9A%84%E5%A0%86%E6%A0%88"><span class="toc-number">1.10.4.</span> <span class="toc-text"> 初始化提升的堆栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AE%9E%E9%99%85%E7%9A%84%E5%86%85%E5%AE%B9"><span class="toc-number">1.10.5.</span> <span class="toc-text"> 执行实际的内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%81%A2%E5%A4%8D%E7%8E%B0%E5%9C%BA"><span class="toc-number">1.10.6.</span> <span class="toc-text"> 恢复现场</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E"><span class="toc-number">1.10.7.</span> <span class="toc-text"> 返回</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call%E8%BF%94%E5%9B%9E%E5%90%8E"><span class="toc-number">1.10.8.</span> <span class="toc-text"> CALL 返回后</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E5%B9%B3%E8%A1%A1"><span class="toc-number">1.10.9.</span> <span class="toc-text"> 堆栈平衡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%86%E6%8E%A8c%E8%AF%AD%E8%A8%80%E4%BB%A3%E7%A0%81"><span class="toc-number">1.10.10.</span> <span class="toc-text"> 逆推 C 语言代码</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E7%BB%93%E6%9E%84%E5%9B%BE%E9%87%8D%E7%82%B9"><span class="toc-number">1.10.11.</span> <span class="toc-text"> 堆栈结构图（重点）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%8F%B3%E9%94%AE%E5%90%AF%E5%8A%A8od"><span class="toc-number">1.11.</span> <span class="toc-text"> 如何右键启动 od</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%87%E5%BF%97%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.12.</span> <span class="toc-text"> 标志寄存器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E4%BD%8D%E6%A0%87%E5%BF%97cfcarry-flag"><span class="toc-number">1.12.1.</span> <span class="toc-text"> 进位标志 CF (Carry Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%87%E5%81%B6%E6%A0%87%E5%BF%97pfparity-flag"><span class="toc-number">1.12.2.</span> <span class="toc-text"> 奇偶标志 PF (Parity Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BE%85%E5%8A%A9%E8%BF%9B%E4%BD%8D%E6%A0%87%E5%BF%97afauxiliary-carry-flag"><span class="toc-number">1.12.3.</span> <span class="toc-text"> 辅助进位标志 AF (Auxiliary Carry Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%B6%E6%A0%87%E5%BF%97zfzero-flag"><span class="toc-number">1.12.4.</span> <span class="toc-text"> 零标志 ZF (Zero Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%A6%E5%8F%B7%E6%A0%87%E5%BF%97sfsign-flag"><span class="toc-number">1.12.5.</span> <span class="toc-text"> 符号标志 SF (Sign Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%A2%E5%87%BA%E6%A0%87%E5%BF%97ofoverflow-flag"><span class="toc-number">1.12.6.</span> <span class="toc-text"> 溢出标志 OF (Overflow Flag)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%90%91%E6%A0%87%E5%BF%97dfdirection-flag"><span class="toc-number">1.12.7.</span> <span class="toc-text"> 方向标志 DF (Direction Flag)</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4"><span class="toc-number">1.13.</span> <span class="toc-text"> 相关汇编指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%B3%E8%BD%AC%E5%92%8C%E6%AF%94%E8%BE%83%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.</span> <span class="toc-text"> 跳转和比较指令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jcc%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.1.</span> <span class="toc-text"> JCC 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#jmp%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.2.</span> <span class="toc-text"> JMP 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.3.</span> <span class="toc-text"> CALL 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ret%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.4.</span> <span class="toc-text"> RET 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#cmp%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.5.</span> <span class="toc-text"> CMP 指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#test%E6%8C%87%E4%BB%A4"><span class="toc-number">1.14.6.</span> <span class="toc-text"> TEST 指令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if%E6%8C%87%E4%BB%A4%E7%BC%96%E8%AF%91%E7%BB%93%E6%9E%9C"><span class="toc-number">1.15.</span> <span class="toc-text"> if 指令编译结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90c%E8%AF%AD%E8%A8%80"><span class="toc-number">1.16.</span> <span class="toc-text"> 反汇编分析 C 语言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96"><span class="toc-number">1.17.</span> <span class="toc-text"> 内联汇编</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BEc%E7%A8%8B%E5%BA%8F%E5%85%A5%E5%8F%A3"><span class="toc-number">1.18.</span> <span class="toc-text"> 寻找 C 程序入口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%96%B9%E5%BC%8F"><span class="toc-number">1.19.</span> <span class="toc-text"> 调试方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#od%E5%B8%B8%E7%94%A8%E6%93%8D%E4%BD%9C"><span class="toc-number">1.20.</span> <span class="toc-text"> OD 常用操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="toc-number">1.21.</span> <span class="toc-text"> 函数调用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#release"><span class="toc-number">1.21.1.</span> <span class="toc-text"> release</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6%E4%B8%8E%E5%86%85%E5%AD%98%E5%8D%95%E5%85%83%E9%95%BF%E5%BA%A6%E4%BF%AE%E9%A5%B0"><span class="toc-number">1.22.</span> <span class="toc-text"> 进制与内存单元长度修饰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">1.23.</span> <span class="toc-text"> 补充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#if-else"><span class="toc-number">1.23.1.</span> <span class="toc-text"> if-else</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#switch-case"><span class="toc-number">1.23.2.</span> <span class="toc-text"> switch case</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#for"><span class="toc-number">1.23.3.</span> <span class="toc-text"> for</span></a></li><li class="toc-item toc-level-4"><a class="toc-link"><span class="toc-number">1.23.4.</span> <span class="toc-text"> ++ –</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#do-while"><span class="toc-number">1.23.5.</span> <span class="toc-text"> do - while</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B5%AE%E7%82%B9%E6%8C%87%E4%BB%A4"><span class="toc-number">1.23.6.</span> <span class="toc-text"> 浮点指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%8D%E7%A7%BB%E6%8C%87%E4%BB%A4"><span class="toc-number">1.23.7.</span> <span class="toc-text"> 位移指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">1.23.8.</span> <span class="toc-text"> 逻辑运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E6%93%8D%E4%BD%9C%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">1.23.9.</span> <span class="toc-text"> 字符操作相关指令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">2.</span> <span class="toc-text"> 实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E6%B8%B8%E6%88%8Fcall"><span class="toc-number">2.1.</span> <span class="toc-text"> 1. 游戏 call</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E5%88%86%E6%9E%90%E6%B8%B8%E6%88%8F%E5%9F%BA%E5%9C%B0%E5%9D%80"><span class="toc-number">2.2.</span> <span class="toc-text"> 2. 分析游戏基地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E6%B8%B8%E6%88%8F%E8%8F%9C%E5%8D%95%E7%82%B9%E5%87%BB%E4%B8%8E%E8%AF%BB%E5%8F%96%E5%9F%BA%E5%9C%B0%E5%9D%80"><span class="toc-number">2.3.</span> <span class="toc-text"> 3. 游戏菜单点击与读取基地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E6%89%AB%E9%9B%B7%E6%B8%B8%E6%88%8F%E8%BE%85%E5%8A%A9%E7%BC%96%E5%86%99"><span class="toc-number">2.4.</span> <span class="toc-text"> 4. 扫雷游戏辅助编写</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E6%A4%8D%E7%89%A9%E5%A4%A7%E6%88%98%E5%83%B5%E5%B0%B8"><span class="toc-number">2.5.</span> <span class="toc-text"> 5. 植物大战僵尸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E7%BD%91%E6%B8%B8%E8%BE%85%E5%8A%A9%E5%AE%9E%E6%88%98%E8%AE%AD%E7%BB%83"><span class="toc-number">2.6.</span> <span class="toc-text"> 6. 网游辅助实战训练</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E4%BA%BA%E7%89%A9%E5%88%86%E6%9E%90"><span class="toc-number">2.6.1.</span> <span class="toc-text"> 角色人物分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0-202315"><span class="toc-number">2.6.2.</span> <span class="toc-text"> 更新 2023.1.5</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%BB%93%E6%9D%9F"><span class="toc-number">2.6.3.</span> <span class="toc-text"> 更新结束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B02023111"><span class="toc-number">2.6.4.</span> <span class="toc-text"> 更新 2023.1.11</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E7%BB%93%E6%9D%9F-2"><span class="toc-number">2.6.5.</span> <span class="toc-text"> 更新结束</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%92%E8%89%B2%E4%BA%BA%E7%89%A9%E6%8A%80%E8%83%BD%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.6.</span> <span class="toc-text"> 角色人物技能列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%BA%E7%89%A9%E5%91%A8%E5%9B%B4%E6%80%AA%E7%89%A9"><span class="toc-number">2.6.7.</span> <span class="toc-text"> 人物周围怪物</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8C%82%E6%9C%BA%E5%8A%9F%E8%83%BD"><span class="toc-number">2.6.8.</span> <span class="toc-text"> 挂机功能</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E4%BA%BA%E7%89%A9%E7%A7%BB%E5%8A%A8call"><span class="toc-number">2.6.9.</span> <span class="toc-text"> 找人物移动 call</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E4%BA%BA%E7%89%A9%E8%83%8C%E5%8C%85%E7%89%A9%E5%93%81%E5%88%97%E8%A1%A8"><span class="toc-number">2.6.10.</span> <span class="toc-text"> 找人物背包物品列表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%BE%E4%BD%BF%E7%94%A8%E8%83%8C%E5%8C%85%E7%89%A9%E5%93%81call"><span class="toc-number">2.6.11.</span> <span class="toc-text"> 找使用背包物品 call</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E9%80%86%E5%90%91%E7%9A%84%E8%A7%92%E5%BA%A6%E7%9C%8Bc"><span class="toc-number">3.</span> <span class="toc-text"> 从逆向的角度看 C++</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text"> 虚函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#debug%E7%89%88%E6%9C%AC%E5%92%8Crelease%E7%89%88%E6%9C%AC"><span class="toc-number">3.2.</span> <span class="toc-text"> debug 版本和 release 版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#c%E4%B8%AD%E7%B1%BB%E4%B8%8E%E7%BB%A7%E6%89%BF%E5%9C%A8%E6%B1%87%E7%BC%96%E4%B8%AD%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">3.3.</span> <span class="toc-text"> C++ 中类与继承在汇编中的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%8F%8D%E6%B1%87%E7%BC%96%E8%A7%92%E5%BA%A6%E7%9C%8Bthis%E6%8C%87%E9%92%88"><span class="toc-number">3.4.</span> <span class="toc-text"> 从反汇编角度看 this 指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E6%B1%87%E7%BC%96%E4%B8%AD%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E5%92%8C%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0%E7%9A%84%E8%AF%86%E5%88%AB"><span class="toc-number">3.5.</span> <span class="toc-text"> 反汇编中构造函数和析构函数的识别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E5%9F%BA%E7%A1%80"><span class="toc-number">4.</span> <span class="toc-text"> 动态调试基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%AD%E7%82%B9"><span class="toc-number">4.1.</span> <span class="toc-text"> 断点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E8%B0%83%E8%AF%95%E5%99%A8"><span class="toc-number">4.2.</span> <span class="toc-text"> 常用调试器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ollyice"><span class="toc-number">4.2.1.</span> <span class="toc-text"> OllyICE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#xdbg"><span class="toc-number">4.2.2.</span> <span class="toc-text"> xdbg</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E8%B0%83%E8%AF%95%E5%9F%BA%E7%A1%80%E4%BA%8C"><span class="toc-number">5.</span> <span class="toc-text"> 动态调试基础二</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AC%E4%BB%B6%E6%96%AD%E7%82%B9"><span class="toc-number">5.1.</span> <span class="toc-text"> 硬件断点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ida%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E5%9F%BA%E7%A1%80"><span class="toc-number">6.</span> <span class="toc-text"> IDA 动态分析基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pe%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="toc-number">7.</span> <span class="toc-text"> PE 文件结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#windows%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80"><span class="toc-number">8.</span> <span class="toc-text"> Windows 系统安全基础</span></a></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2022/11/01/%E6%B1%87%E7%BC%96/" rel="bookmark" title="汇编">汇编</a></li><li class="active"><a href="/2022/11/11/reverse/" rel="bookmark" title="逆向">逆向</a></li><li><a href="/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/" rel="bookmark" title="水滴rev">水滴rev</a></li><li><a href="/2023/08/15/%E7%A0%B4%E8%A7%A3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B9%8B%E8%AE%A4%E8%AF%86%E5%A3%B3%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%89%B9%E5%BE%81/" rel="bookmark" title="破解基础知识之认识壳与程序的特征">破解基础知识之认识壳与程序的特征</a></li><li><a href="/2023/08/22/%E5%8E%BB%E5%BC%B9%E7%AA%97%E7%BB%BF%E5%8C%96/" rel="bookmark" title="破解相关">破解相关</a></li><li><a href="/2023/10/01/1234567/" rel="bookmark" title="windows逆向进阶">windows逆向进阶</a></li><li><a href="/2023/10/03/hg%20ker/" rel="bookmark" title="hg内核">hg内核</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">46</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">6</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">6</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2022/11/01/%E6%B1%87%E7%BC%96/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2022/11/17/JWT%20%E5%9F%BA%E7%A1%80/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%86%85%E7%BD%91/" title="In 内网">内网</a>
</div>

    <span><a href="/2022/05/27/emergency%20response/" title="应急响应">应急响应</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/11/17/JWT%20%E5%9F%BA%E7%A1%80/" title="JWT">JWT</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/06/27/SSRF/" title="SSRF">SSRF</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/12/31/webshell/" title="webshell">webshell</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/04/16/Upload/" title="File upload">File upload</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2022/11/27/CDN/" title="CDN&amp;DNS">CDN&DNS</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2024/02/01/%E7%9B%91%E6%8E%A7/" title="监控">监控</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%80%86%E5%90%91/" title="In 逆向">逆向</a>
</div>

    <span><a href="/2023/08/15/%E7%A0%B4%E8%A7%A3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B9%8B%E8%AE%A4%E8%AF%86%E5%A3%B3%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%89%B9%E5%BE%81/" title="破解基础知识之认识壳与程序的特征">破解基础知识之认识壳与程序的特征</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2023/05/30/jenkins/" title="Jenkins">Jenkins</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E7%BD%91%E7%BB%9C/" title="In 网络">网络</a>
</div>

    <span><a href="/2023/09/01/border%20leaf/" title="从三层架构到spine leaf">从三层架构到spine leaf</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2022/11/11/reverse/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>

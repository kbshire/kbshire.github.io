<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>http://example.com</id>
    <title>Hexo • Posts by &#34;网络&#34; category</title>
    <link href="http://example.com" />
    <updated>2023-01-20T05:38:45.000Z</updated>
    <category term="运维" />
    <category term="逆向" />
    <category term="SQL injection" />
    <category term="File upload" />
    <category term="网络" />
    <category term="汇编" />
    <entry>
        <id>http://example.com/2023/01/20/VXLAN/</id>
        <title>VXLAN</title>
        <link rel="alternate" href="http://example.com/2023/01/20/VXLAN/"/>
        <content type="html">&lt;h1 id=&#34;vxlan&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vxlan&#34;&gt;#&lt;/a&gt; VXLAN&lt;/h1&gt;
&lt;h2 id=&#34;enspvirtualbox设置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#enspvirtualbox设置&#34;&gt;#&lt;/a&gt; ensp&amp;amp;virtualbox 设置&lt;/h2&gt;
&lt;p&gt;1. 导入 CE 镜像&lt;/p&gt;
&lt;p&gt;拖一台 CE12800，启动设备，系统会让自动选择镜像，选择 CE 镜像，正确的镜像为 1.3G 的&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101221931649.png&#34; alt=&#34;image-20230101221931649&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101222035060.png&#34; alt=&#34;image-20230101222035060&#34;&gt;&lt;/p&gt;
&lt;p&gt;导入后 virtualbox 中会显示&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101221847981.png&#34; alt=&#34;image-20230101221847981&#34;&gt;&lt;/p&gt;
&lt;p&gt;更改 CE 设置，设置内存，每台 CE12800 大概需要 1G 内存&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101222420086.png&#34; alt=&#34;image-20230101222420086&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101222459733.png&#34; alt=&#34;image-20230101222459733&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101222528294.png&#34; alt=&#34;image-20230101222528294&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;vxlan-2&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vxlan-2&#34;&gt;#&lt;/a&gt; VXLAN&lt;/h2&gt;
&lt;p&gt;VXLAN 是由 IETF 定义的 NVO3 (Network Virtualization over Layer 3) 标准技术之一，采用 L2 over L4 ( MAC-in-UDP) 的报文封装模式，将二层报文用三层协议进行封装，可实现二层网络在三层范围内进行扩展，同时满足数据中心大二层虚拟迁移和多租户的需求。&lt;/p&gt;
&lt;p&gt;Vxlan 是一种无控制平面，利用底层 IP 网络实现二层通信的隧道技术。&lt;/p&gt;
&lt;p&gt;GRE 也是无控制平面，不需要使用协议维护隧道状态。比如 LDP 是 LSP 的控制平面。&lt;/p&gt;
&lt;p&gt;底层的 IP 网络称为 Underlay 网络，Vxlan 则称为 Overlayer 网络。&lt;/p&gt;
&lt;h2 id=&#34;名词解释&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#名词解释&#34;&gt;#&lt;/a&gt; 名词解释&lt;/h2&gt;
&lt;h3 id=&#34;nvo3-nve&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#nvo3-nve&#34;&gt;#&lt;/a&gt; NVO3 &amp;amp; NVE&lt;/h3&gt;
&lt;p&gt;NVO3 (Network Virtualization Over Layer 3), 基于三层 IP overlay 网络构建虚拟网络技术统称为 NVO3。运行 NVO3 的设备叫做 NVE (NetworkVirtualization Edge) ，它位于 overlay 网络的边界，实现二、三层的虚拟化功能。&lt;strong&gt;NVE 是执行 VXLAN 封装和接封装的设备&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101223857131.png&#34; alt=&#34;image-20230101223857131&#34;&gt;&lt;/p&gt;
&lt;h3 id=&#34;vtep&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vtep&#34;&gt;#&lt;/a&gt; VTEP&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;VXLAN 网络中的 NVE 以 VTEP 进行标识&lt;/strong&gt;，VTEP (VXLAN Tunnel Endpoint，VXLAN 隧道端点)&lt;br&gt;
 每一个 NVE 至少有一个 VTEP，VTEP 使用 NVE 的 IP 地址表示&lt;br&gt;
两个 VTEP 可以确定一条 VXLAN 隧道，VTEP 间的这条 VXLAN 隧道将被两个 NVE 间的所有 VNI 所公用&lt;/p&gt;
&lt;p&gt;VTEP 即标识设备，也标识 VXLAN 隧道，两个 VTEP 地址之间唯一的确定一条 VXLAN 隧道。所以 VTEP 的地址要求全网可达&lt;/p&gt;
&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101223916250.png&#34; alt=&#34;image-20230101223916250&#34; style=&#34;zoom: 80%;&#34; /&gt; 
&lt;h3 id=&#34;vni&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#vni&#34;&gt;#&lt;/a&gt; VNI&lt;/h3&gt;
&lt;p&gt;VNI - VXLAN 网络标识符&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;VNI 是一种类似于 VLANID 的用户标示，一个 VNl 代表了一个租户&lt;/strong&gt;，属于不同 VNI 的虚拟机之间不能直接进行二层通信。VXLAN 报文封装时，给 VNI 分配了足够的空间使其可以支持海量租户的隔离。&lt;/p&gt;
&lt;p&gt;应用场景&lt;/p&gt;
&lt;p&gt;虚拟机在同一网段需要互访的情景，在没有 VXLAN 是，只能在同一个物理机上。使用 VXLAN，可以去除网络限制，使资源分配&lt;/p&gt;
&lt;p&gt;2 层 VPN：封装的对象是帧，VXLAN，TRILL，L2TP，PPTP，VPLS&lt;/p&gt;
&lt;p&gt;3 层 VPN：封装的对象是包，IPSEC，GRE，DSVPN，MPLS VPN&lt;/p&gt;
&lt;p&gt;ipsec vpn 隧道模式，3 层 vpn&lt;/p&gt;
&lt;p&gt;ipsec vpn 传输模式，只封装 IP 之上的内容&lt;/p&gt;
&lt;p&gt;应用层 VPN：SSL VPN&lt;/p&gt;
&lt;p&gt;MPLS VPN：三层&lt;/p&gt;
&lt;p&gt;VPLS：二层&lt;/p&gt;
&lt;h2 id=&#34;实验1同子网互访&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验1同子网互访&#34;&gt;#&lt;/a&gt; 实验 1: 同子网互访&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;LSW1 &amp;amp; LSW2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;trunk - access &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE1 &amp;amp; CE2 &amp;amp; CE3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1.underlay&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;配置物理接口&amp;amp;环回口地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;配置路由协议&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.VXLAN业务接入配置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;配置BD域:BD域用于在NVE上本地区分不同的大二层网络，本地有效,没有全局意义，每一个BD域只能关联一个vni，在一台NVE上不同BD域需要关联不同VNI&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;VXLAN vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;将vlanid和BD域关联，BD域又和vni关联&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/0.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;创建VXLAN隧道&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nve 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vin 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110110558492.png&#34; alt=&#34;image-20230110110558492&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;LSW1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20 30 40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type access&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port default vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type trunk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port trunk allow-pass vlan 2 to 4094&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type access&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port default vlan 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 2.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0.30 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.2 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 2.2.2.2 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 3.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.3 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.20 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.40 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 3.3.3.3 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110111117399.png&#34; alt=&#34;image-20230110111117399&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110111302369.png&#34; alt=&#34;image-20230110111302369&#34;&gt;&lt;/p&gt;
&lt;p&gt;数据帧在 CE2 通过子接口，MAC，BD 上形成 MAC 地址表&lt;/p&gt;
&lt;p&gt;MAC-IN-UDP  通过封装 UDP 实现按照流的负载分担，Dport 4789&lt;/p&gt;
&lt;p&gt;在 VXLAN 中，不关心主机所在 VXLAN，只要在同一网段即可实现&lt;/p&gt;
&lt;p&gt;既可以实现网络虚拟化，将网络虚拟为两个不同的虚拟网络，租户之间网络隔离&lt;/p&gt;
&lt;p&gt;此时逻辑拓扑变为虚拟交换机连接同一租户的不同设备&lt;/p&gt;
&lt;p&gt;在公有云场景，为了适应虚拟机迁移的场景，使用 SDN 动态下发配置&lt;/p&gt;
&lt;p&gt;VXLAN 头端复制&lt;/p&gt;
&lt;p&gt;将 VXLAN 报文复制多份发给每一个当前 vni 中的 peer list&lt;/p&gt;
&lt;p&gt;vxlan 网络对 BUM 报文的转发行为默认是头端复制   broadcast-unknown-Multicast&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230111205055822.png&#34; alt=&#34;image-20230111205055822&#34;&gt;&lt;/p&gt;
&lt;p&gt;VXLAN I flag: 必须置为 1，标识 VNI 字段有效。&lt;/p&gt;
&lt;p&gt;UDP Dest Port: VXLAN 保留 UDP 目的端口号，默认为 4789&lt;/p&gt;
&lt;p&gt;UDP Source Port: 根据数据流 HASH 动态生成。&lt;/p&gt;
&lt;p&gt;不同流封装类型的接口对报文的处理方式&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230111211200322.png&#34; alt=&#34;image-20230111211200322&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230111213612876.png&#34; alt=&#34;image-20230111213612876&#34;&gt;&lt;/p&gt;
&lt;p&gt;一个物理接口下如果存在 default 接口，那么不能存在其他类型的接口&lt;/p&gt;
&lt;h2 id=&#34;实验二跨子网互通集中式网关&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#实验二跨子网互通集中式网关&#34;&gt;#&lt;/a&gt; 实验二：跨子网互通（集中式网关）&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CE1作为网关&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.1.254 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.2.254 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2 - CE1 建立VXLAN &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nve 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 10 head peer 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 20 head peer 1.1.1.1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE3 - CE1 建立VXLAN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nve 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 10 head peer 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 20 head peer 1.1.1.1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nv1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 10 head peer 2.2.2.2 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 20 head peer 2.2.2.2 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;主机网关设置vdbif接口地址&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;对于多租户在网关上使用ip vpn-instance 实现&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;route-dist 1:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip binding vpn-instance 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 20 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip binding vpn-instance 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;对于每一个租户分配一个VPN-instance &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;对于普通的vlan网络，设置接口类型，vlanif接口，即可实现vlan与VXLAN互通&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;对于需要访问外网的场景&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;将VPN-instance中的路由泄露到public中，在VPN-instance中添加了一条静态路由&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static vpn-instance A 0.0.0.0 0 10.1.11.10 public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;注意回包路由&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1.将租户路由引回私网中&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.1 24 10.1.11.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.将public泄露到vpn中,public中会有一下一跳为VPN-instance的路由，迭代到出接口vbdif &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 24 vpn-instance A 192.168.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;要求&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1.对于同一租户，同子网和跨子网互通&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.vlan和VXLAN互通&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3.VXLAN中租户和公网互通&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4.CE1旁挂防火墙，实现路由隔离，nat在fw上，租户互通通过fw&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;网络虚拟化，对于租户来说，只消耗 vni 和直连路由&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230112221742698.png&#34; alt=&#34;image-20230112221742698&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230112224309888.png&#34; alt=&#34;image-20230112224309888&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CE1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 1:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 1.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.1.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.2.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.3.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.11.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port default vlan 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 1.1.1.1 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 255.255.255.0 vpn-instance A 192.168.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.2.0 255.255.255.0 vpn-instance A 192.168.2.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static vpn-instance A 0.0.0.0 0.0.0.0 10.1.11.2 public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 2.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.2 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.20 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 2.2.2.2 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;AR1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;acl number 2000  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule 5 permit source 192.168.1.0 0.0.0.255 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule 10 permit source 192.168.2.0 0.0.0.255 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.11.2 255.255.255.0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.21.1 255.255.255.0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; nat outbound 2000&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 10.1.21.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 255.255.255.0 10.1.11.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.2.0 255.255.255.0 10.1.11.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;两个 VTEP 可以确定一条 VXLAN 隧道，VTEP 间的这条 VXLAN 隧道将被两个 NVE 间的所有 VNI 所共用。&lt;/p&gt;
&lt;p&gt;VXLAN 二层网关：允许租户接入 VxLAN 网络，实现相同 VxLAN 内部流量互访。&lt;/p&gt;
&lt;p&gt;VxLAN L3 Gateway: 实现不同 VxLAN 直接互访，或者 VxLAN 与非 VxLAN 网络互访。&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230114212602424.png&#34; alt=&#34;image-20230114212602424&#34;&gt;&lt;/p&gt;
&lt;p&gt;L2-Subif: 用于用户接入，子接口上可以配置一层 tag 接入或者不配置 tag 接入；&lt;/p&gt;
&lt;p&gt;BD (Bridge-Domain): 标识一个二层广播域，BD 和 VNI 1:1 映射。所有广播域功能基于 BD 支持，如 MAC 学习、二层查表、广播复制等；&lt;/p&gt;
&lt;p&gt;NVE (Network Virtualization Edge): 主要用于本地 VTEP 地址管理，VXLAN 隧道管理，头端复制列表管理；&lt;/p&gt;
&lt;p&gt;VXLAN 隧道: VXLAN 隧道用于 VXLAN 报文的转发，用本地 VTEP 地址 + 远端 VTEP 地址标识﹔&lt;/p&gt;
&lt;p&gt;BDIF:BD 域的三层路由接口，用于二层流量进入三层进行路由转发；&lt;/p&gt;
&lt;p&gt;bridge-domain 20&lt;/p&gt;
&lt;p&gt;L2 binding vlan 10  // 全局关联 vlan 端口到 BD 域中&lt;/p&gt;
&lt;p&gt;VLAN 绑定 BD 后，该 BD 不支持创建对应的 VBDIF 接口。同时不支持创建该 VLAN 对应的 VLANIF 接口。&lt;/p&gt;
&lt;p&gt;VLAN 绑定 BD 功能和 ARP 广播报文抑制功能互斥，配置 VLAN 为 VXLAN 业务接入点后，不建议再使能 ARP 广播报文抑制功能&lt;/p&gt;
&lt;p&gt;ARP 广播抑制：抑制后续的 ARP 广播报文，由于首包之后 CE 上已经有了 arp 请求的主机的位置，只需要单播请求即可。arp 广播请求变 arp 单播请求&lt;/p&gt;
&lt;p&gt;第一次虚拟化：利用隧道技术将边缘设备互连透传二层报文；整网抽象理解成一台端口数目扩展的超大 LAN switch。&lt;/p&gt;
&lt;p&gt;第二次虚拟化利用 VNI 将这台超大的交换机虚拟出多个二层的广播域，和 VLAN 本质是一样的，VNI 类比 VLANID. 并通过定义 VXLAN header 中的 VNI 字段，将子网范围由 4K 扩展至 16M。&lt;/p&gt;
&lt;p&gt;vxlan 主要优点&lt;/p&gt;
&lt;p&gt;基于 IP 的 overlay, 仅需要边界设备间 IP 可达。&lt;/p&gt;
&lt;p&gt;隧道间水平分割、IP overlay TTL 避免环路。 网络层收到的 VXLAN 报文只能发给用户侧&lt;/p&gt;
&lt;p&gt;数据流量基于 IP 路由 SPF 及 ECMP 快速转发。&lt;/p&gt;
&lt;p&gt;网络变化实时侦听全网拓扑毫秒收敛&lt;/p&gt;
&lt;p&gt;Overlay+VNI 构建虚拟网络，支持多达 16M 的虚拟网络。&lt;/p&gt;
&lt;p&gt;物理设备、vSwitch 均能够部署。CE1800V 软件交换机也能做 VXLAN&lt;/p&gt;
&lt;p&gt;VXLAN 同子网互访模型&lt;/p&gt;
&lt;p&gt;1. 同一 OVS 之间&lt;/p&gt;
&lt;p&gt;2. 不同 OVS 之间&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122191207957.png&#34; alt=&#34;image-20230122191207957&#34;&gt;&lt;/p&gt;
&lt;p&gt;3. 不同 tor 之间&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122191226332.png&#34; alt=&#34;image-20230122191226332&#34;&gt;&lt;/p&gt;
&lt;p&gt;VXLAN 不同子网护网&lt;/p&gt;
&lt;p&gt;集中式网关&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122191735252.png&#34; alt=&#34;image-20230122191735252&#34;&gt;&lt;/p&gt;
&lt;p&gt;1. 流量迂回&lt;/p&gt;
&lt;p&gt;2. 网关 arp 表项过多可能成为网络瓶颈&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122192007255.png&#34; alt=&#34;image-20230122192007255&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122192117780.png&#34; alt=&#34;image-20230122192117780&#34;&gt;&lt;/p&gt;
&lt;p&gt;VXLAN 基于 spine-leaf 组网架构&lt;/p&gt;
&lt;p&gt;胖树&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122192248454.png&#34; alt=&#34;image-20230122192248454&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122193919103.png&#34; alt=&#34;image-20230122193919103&#34;&gt;&lt;/p&gt;
&lt;p&gt;spine 和网关分离部署，解决集中式网关容量问题&lt;/p&gt;
&lt;p&gt;spine 和网关融合部署&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122194413496.png&#34; alt=&#34;image-20230122194413496&#34;&gt;&lt;/p&gt;
&lt;p&gt;集中式网关场景下网关双活&lt;/p&gt;
&lt;p&gt;华为最多支持四台做多活，但只提高转发效率，不提高表项&lt;/p&gt;
&lt;p&gt;表项通过 DFS 同步&lt;/p&gt;
&lt;p&gt;需要通过双活组做网关扩容&lt;/p&gt;
&lt;p&gt;多活网关需要 VTEP 一样&lt;/p&gt;
&lt;p&gt;CE 模拟器基于包做负载分担&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122195628679.png&#34; alt=&#34;image-20230122195628679&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122195938635.png&#34; alt=&#34;image-20230122195938635&#34;&gt;&lt;/p&gt;
&lt;p&gt;集中式网关特点&lt;/p&gt;
&lt;p&gt;1. 流量存在迂回现象&lt;/p&gt;
&lt;p&gt;2. 网关需要维护主机的 mac 地址信息和 arp 信息，对设备表项容量要求高，容易遇到瓶颈&lt;/p&gt;
&lt;p&gt;3. 网关容易存在单点故障&lt;/p&gt;
&lt;p&gt;4. 跨子网的流量都由网关来完成，流量有明显控制点，网关维护用户路由信息，MAC 地址，ARP 表项，VXLAN 隧道路由&lt;/p&gt;
&lt;p&gt;leaf 只需要维护 MAC 地址信息和 VXLAN 隧道的路由信息，无需维护用户的路由信息&lt;/p&gt;
&lt;p&gt;第一个和第二三个问题可以采用分布式网关解决&lt;/p&gt;
&lt;p&gt;第三个问题可以使用双活网关解决&lt;/p&gt;
&lt;p&gt;如果非要用集中式网关&lt;/p&gt;
&lt;p&gt;1. 第一个问题无法解决&lt;/p&gt;
&lt;p&gt;2. 第二个问题采用多组网关解决容量问题&lt;/p&gt;
&lt;p&gt;3. 第三个问题采用多活网关&lt;/p&gt;
&lt;p&gt;集中式网关有网关和 spine 融合组网  适用业务稳定，规模稳定的私有云&lt;/p&gt;
&lt;p&gt;网关和 spine 分离组网    适用于业务变更频繁业务规模可以弹性伸缩的时候，中大型公有云和私有云&lt;/p&gt;
&lt;h2 id=&#34;集中式双活网关过墙&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#集中式双活网关过墙&#34;&gt;#&lt;/a&gt; 集中式双活网关过墙&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123214500930.png&#34; alt=&#34;image-20230123214500930&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;网关上创建互联vlan&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一个vlan绑定到用户的VPN-instance中，用于和用户的vfw实现三层互连&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一个vlan绑定到public中，和root防火墙实现三层互联，此链路所有租户共享&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fw上创建互联vlan&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一个vlan关联到租户的虚墙，实现和租户在gw上的VPN-instance对接&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一个vlan关联root防火墙和gw的public对接&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;gw&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;des vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;des public &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p l t &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p t a v a &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vlanif 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.10.1 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip bing vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vlan 20 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.20.1 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route vpn A 0.0.0.0 0 192.168.10.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou 0.0.0.0 0 192.168.30.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou 202.1.1.0 24 192.168.20.20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fw&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan 10 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p l t&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p t a v a &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys name A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;assign vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vlanif 10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.10.10 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;service pin p&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;switch vsys A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add interface vlanif 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//华为NGFW默认出厂存在一个virtual-if0，它属于root的一个逻辑接口，用于和虚拟fw的virtual-if接口实现通信&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;在创建vfw时，也会为vfw自动创建一个virtual-if接口，接口号设备自行分配&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Firewall zone untrust &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add inter vitural-if 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add inter vit 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vlan 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.20.20  24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;service pin p&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zon un &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add int vlan 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;switch vsys A &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 24 192.168.10.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security-po &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ru name test &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;trust-&amp;gt;untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sourece 192.168.1.0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ac pe&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route 0.0.0.0 0 public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security-policy &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;def ac per&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route 0.0.0.0 0 192.168.20.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat add A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;section 202.1.1.1 202.1.1.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys name A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;assign global 202.1.1.1 202.1.1.10 free&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;switch vsys A &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat add A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sec 202.1.1.1 202.1.1.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat-policy &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ru name A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source-zon  t&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;de un&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source 192.168.1.0 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ac so add A &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou 202.1.1.0 28 vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;R1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou 202.1.1.0 24 192.168.30.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123211745121.png&#34; alt=&#34;image-20230123211745121&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//1.网关双活&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE1]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.1.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mac-address 5489-9825-6da0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 1.1.1.1 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 1.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE3]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.3 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.23.3 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation untag&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 3.3.3.3 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 3.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;147&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//网关双活过墙&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE1]di cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; description VPN-instance  A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.1.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mac-address 5489-9825-6da0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.10.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; description public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.20.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type trunk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port trunk allow-pass vlan 2 to 4094&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.30.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 1.1.1.1 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 1.1.1.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 1.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 192.168.30.30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 202.1.1.0 255.255.255.0 192.168.20.20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static vpn-instance A 0.0.0.0 0.0.0.0 192.168.10.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[USG6000V1]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20 30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys name A 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; assign vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; assign global-ip 201.1.1.1 202.1.1.10 free&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.10.10 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.20.20 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type trunk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port trunk allow-pass vlan 2 to 4094&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface GigabitEthernet0/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Virtual-if0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Vlanif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 192.168.20.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 202.1.1.0 255.255.255.240 vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; default action permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule name test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;switch vsys A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.10.10 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Vlanif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Virtual-if1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat address-group A 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mode pat&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; section 0 202.1.1.1 202.1.1.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule name test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  destination-zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.1.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  action permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule name A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  destination-zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.1.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  action source-nat address-group A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 255.255.255.0 192.168.10.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[R1]dis cu&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[V200R003C00]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.30.30 255.255.255.0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 8.8.8.8 255.255.255.255 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 202.1.1.0 255.255.255.0 192.168.30.1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&#34;evpn&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#evpn&#34;&gt;#&lt;/a&gt; EVPN&lt;/h2&gt;
&lt;p&gt;EVPN 作为数据中心 VXLAN 技术的控制平面，转发平面还是采用 VXLAN 对数据进行封装&lt;/p&gt;
&lt;p&gt;EVPN 支持集中式网关组网，也支持分布式网关组网&lt;/p&gt;
&lt;p&gt;EVPN 在数据中心实现同子网互访和跨子网互访&lt;/p&gt;
&lt;p&gt;为了在数据中心支持 VXLAN。EVPN 在 BGP 协议的基础上新增了一种 NLRI，称为 EVPN NLRI&lt;/p&gt;
&lt;p&gt;EVPN NLRI 定义了三种路由信息&lt;/p&gt;
&lt;p&gt;1.type 2 路由称为 MAC/IP 路由，根据不同的作用，也称为 ARP 路由 / IRB 路由（IRB  集成的路由与桥接），用于&lt;/p&gt;
&lt;p&gt;@数据中心支持 ARP 广播抑制&lt;/p&gt;
&lt;p&gt;@动态虚拟机迁移&lt;/p&gt;
&lt;p&gt;@虚拟机主机路由的发布，实现跨子网互访&lt;/p&gt;
&lt;p&gt;2.type 3 路由，称为集成组播路由，用于在 VTEP 之间动态建立 VXLAN 隧道，并动态实现头端复制列表的生成，用于支持 BUM 报文的转发&lt;/p&gt;
&lt;p&gt;3.type 5 路由，称为前缀路由，常用于将数据中心外部路由引入到各租户的 VPN-instance 中，实现数据中心内部访问外部&lt;/p&gt;
&lt;p&gt;另外标准的 EVPN 协议还定义了 type 1 的路由&lt;/p&gt;
&lt;p&gt;type 1 路由 Ethernet AD Route    (auto discovery)&lt;/p&gt;
&lt;p&gt;双归场景下用于防环快速收敛，别名&lt;/p&gt;
&lt;p&gt;type 4 路由，Ethernet Segment Route&lt;/p&gt;
&lt;p&gt;双归场景下用于实现 DF 的选举和执行负载分担的维护&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//CE1-CE4之间建立EVPN邻居&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 as 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 con l 0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 4.4.4.4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;l2vpn-fa evpn &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 re&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 4.4.4.4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//peer 2.2.2.2 ad arp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//peer 3.3.3.3 ad arp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//peer 4.4.4.4 ad arp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;undo p v&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 as 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 con l 0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;l2vpn-fa evpn &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 en&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//peer 1.1.1.1 ad arp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;dis bgp evpn peer &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2-CE3-CE4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;BD 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vx  10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;router- 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn-t 100:1 b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/1.10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bd 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;enca 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//EVPN实例中本地的每个BD域都可以看成是一个独立的EVPN实例，一个二层的广播域&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 10 head peer pro bgp    //type3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;dis bgp evpn rout in 0:32:2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.1.254 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;没有反射器的场景需要在所有节点建立全互联EVPN&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE2-CE3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn- A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;router 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn 100:1 both evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vxlan vni 100   //三层VNI&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip bin vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;arp dist enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;arp collect host enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip addr&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;Type3 路由 ——Inclusive Multicast 路由&lt;/strong&gt;&lt;br&gt;
&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125212349933.png&#34; alt=&#34;image-20230125212349933&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125212635735.png&#34; alt=&#34;image-20230125212635735&#34;&gt;&lt;/p&gt;
&lt;p&gt;还会携带 ERT，不在 EVPN 中，在 BGP 中，用于设置感兴趣路由&lt;/p&gt;
&lt;p&gt;1. 对方收到 type3 路由后，比较 RT 是否匹配，如果匹配则接收该 type3 的路由&lt;/p&gt;
&lt;p&gt;2. 提取 type3 中 org router ip (VTEP 地址) ，如果该地址路由可达，则创建 VXLAN 隧道&lt;/p&gt;
&lt;p&gt;3. 提取 PMSI 属性中二层 VNI 值，看是否和本端 EVPN 实例中的相同，如果相同则将 PSMI 中携带的 VTEP 地址添加到 VXLAN 隧道的头端复制列表中&lt;/p&gt;
&lt;p&gt;如果希望在 EVPN 邻居之间传递 type2 的路由 (ARP 路由 / IRB 路由)&lt;/p&gt;
&lt;p&gt;peer 1.1.1.1 advertise arp   传递 ARP 路由 / MAC 路由&lt;/p&gt;
&lt;p&gt;peer 1.1.1.1 advertise irb    传递 IRB 类型的路由&lt;/p&gt;
&lt;p&gt;默认只传 type3&lt;/p&gt;
&lt;p&gt;MAC route 实现 VM 之间二层互访，需要在 EVPN 邻居之间传递 MAC  route&lt;/p&gt;
&lt;p&gt;MAC route 特征&lt;/p&gt;
&lt;p&gt;携带 RD+MAC + 二层 VNI&lt;/p&gt;
&lt;p&gt;为了支持 ARP 广播抑制和虚拟机热迁移，需要在 EVPN 邻居之间传递 ARP 类型的路由&lt;/p&gt;
&lt;p&gt;传递 IRB peer 1.1.1.1 ad irb&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Type2 路由 ——MAC/IP 路由&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126212428010.png&#34; alt=&#34;image-20230126212428010&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126212535678.png&#34; alt=&#34;image-20230126212535678&#34;&gt;&lt;/p&gt;
&lt;p&gt;arp 路由的特征：携带 RD+MAC+IP + 二层 VNI&lt;/p&gt;
&lt;p&gt;irb 类型的特征：携带 RD+MAC+IP + 二层 VNI + 三层 VNI，irb 类型的路由也具备 arp 类型路由的功能&lt;/p&gt;
&lt;p&gt;什么时候发送 ARP 类型的路由，集中式网关部署时发送 ARP 类型的路由即可&lt;/p&gt;
&lt;p&gt;什么时候发送 IRB 类型的路由，分布式网关一定要发送 IRB 类型的路由&lt;/p&gt;
&lt;p&gt;当邻居之间发布 arp 路由命令后，设备会将用户侧学到主机的 IP+MAC 信息通过 arp 类型的路由发送给 evpn 邻居&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;type 2路由在VXLAN控制平面中的作用包括：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;主机MAC地址通告&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;要实现同子网主机的二层互访，两端VTEP需要相互学习主机MAC。作为BGP EVPN对等体的VTEP之间通过交换MAC/IP路由，可以相互通告已经获取到的主机MAC。其中，MAC Address Length和MAC Address字段为主机MAC地址。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;主机ARP通告&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MAC/IP路由可以同时携带主机MAC地址+主机IP地址，因此该路由可以用来在VTEP之间传递主机ARP表项，实现主机ARP通告。其中，MAC Address和MAC Address Length字段为主机MAC地址，IP Address和IP Address Length字段为主机IP地址。此时的MAC/IP路由也称为ARP类型路由。主机ARP通告主要用于以下两种场景：&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1.ARP广播抑制。当三层网关学习到其子网下的主机ARP时，生成主机信息（包含主机IP地址、主机MAC地址、二层VNI、网关VTEP IP地址），然后通过传递ARP类型路由将主机信息同步到二层网关上。这样当二层网关再收到ARP请求时，先查找是否存在目的IP地址对应的主机信息，如果存在，则直接将ARP请求报文中的广播MAC地址替换为目的单播MAC地址，实现广播变单播，达到ARP广播抑制的目的。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.分布式网关场景下的虚拟机迁移。当一台虚拟机从当前网关迁移到另一个网关下之后，新网关学习到该虚拟机的ARP（一般通过虚拟机发送免费ARP实现），并生成主机信息（包含主机IP地址、主机MAC地址、二层VNI、网关VTEP IP地址），然后通过传递ARP类型路由将主机信息发送给虚拟机的原网关。原网关收到后，感知到虚拟机的位置发生变化，触发ARP探测，当探测不到原位置的虚拟机时，撤销原位置虚拟机的ARP和主机路由。&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230128140404626.png&#34; alt=&#34;image-20230128140404626&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[CE1]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 1.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.14.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 1.1.1.1 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 2.2.2.2 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 2.2.2.2 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 3.3.3.3 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 3.3.3.3 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 4.4.4.4 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 4.4.4.4 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family unicast&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 4.4.4.4 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; l2vpn-family evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  undo policy vpn-target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 advertise irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 reflect-client&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 advertise irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 reflect-client&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 4.4.4.4 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 4.4.4.4 advertise irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 4.4.4.4 reflect-client&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE2]dis  cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:1 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:1 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 2.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/0.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.2 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 2.2.2.2 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list protocol bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 1.1.1.1 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 1.1.1.1 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family unicast&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 1.1.1.1 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; l2vpn-family evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  policy vpn-target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 1.1.1.1 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 1.1.1.1 advertise irb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置分布式网关并且通告 irb 类型路由后‘&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230128150821743.png&#34; alt=&#34;image-20230128150821743&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;分布式网关&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#分布式网关&#34;&gt;#&lt;/a&gt; 分布式网关&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CE2-CE3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn en	&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3 as 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3 con l 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;l2vpn evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 3.3.3.3 ad irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bd 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vxxlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;route&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn-target 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bbd 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn 100:2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;route 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn- 100:1 both &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn- 100:1 evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn 100:2 evpn imp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vxlan vni 99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vbdif 10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip bind vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;arp dis en&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;arp coll host en&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nv 1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vni 10 h p p bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;二层 VNI 用于同子网互访&lt;/p&gt;
&lt;p&gt;三层 VNI 用于实现跨子网互访&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;ARP 类型路由携带的有效信息有：主机 MAC 地址 + 主机 IP 地址 + 二层 VNI；IRB 类型路由携带的有效信息有：主机 MAC 地址 + 主机 IP 地址 + 二层 VNI + 三层 VNI。因此，IRB 类型路由包含着 ARP 类型路由，不仅可以用于主机 IP 路由通告，也能用于主机 ARP 通告。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;主机 IP 路由通告&lt;/p&gt;
&lt;p&gt;在分布式网关场景中，要实现跨子网主机的三层互访，两端 VTEP（作为三层网关）需要互相学习主机 IP 路由。作为 BGP EVPN 对等体的 VTEP 之间通过交换 MAC/IP 路由，可以相互通告已经获取到的主机 IP 路由。其中，IP Address Length 和 IP Address 字段为主机 IP 路由的目的地址，同时 MPLS Label2 字段必须携带三层 VNI。此时的 MAC/IP 路由也称为 IRB（Integrated Routing and Bridge）类型路由。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovLzEuQkQ=&#34;&gt;1.BD&lt;/span&gt; rt 匹配，如果匹配实现广播抑制虚拟机热迁移&lt;/p&gt;
&lt;p&gt;2. 当 Eert 和本端 VPN-instance 中 Eirt 匹配时，会将其中携带的 IP 地址加入到 VPN-instance 路由表中，生成一条主机路由&lt;/p&gt;
&lt;p&gt;export-rt evpn Eert&lt;/p&gt;
&lt;p&gt;import-rt evpn Eirt&lt;/p&gt;
&lt;p&gt;Leaf2 收到 Leaf1 发来的 BGP EVPN 路由后，同时进行如下处理：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;检查该路由携带的 ERT，如果与本端 EVPN 实例的 IRT 相同，则接收该路由。EVPN 实例获取到 IRB 类型路由后，还能提取到其中包含的 ARP 类型路由，用于主机 ARP 通告。&lt;/li&gt;
&lt;li&gt;检查该路由携带的 ERT，如果与本端 L3VPN 实例的 eIRT 相同，则接收该路由。然后，L3VPN 实例获取到该路由携带的 IRB 类型路由，从中提取 Host1 的主机 IP 地址、三层 VNI，在其路由表中保存 Host1 的主机 IP 路由，并根据路由的下一跳迭代出接口，最终迭代结果是指向 Leaf1 的 VXLAN 隧道，如&lt;span class=&#34;exturl&#34; data-url=&#34;bWs6TVNJVFN0b3JlOkQ6JTVDQV8lRTUlQUQlQTYlRTQlQjklQTAlNUMlRTQlQkElQTclRTUlOTMlODElRTYlOTYlODclRTYlQTElQTMlNUNDRTEyODAwLmNobTo6L2RjL2RjX3ZycF9mZWF0dXJlX3Z4bGFuXzEwMzkuaHRtbCNaSC1DTl9DT05DRVBUXzAxNDExMTg4NTBfX2ZpZ19kY192cnBfZmVhdHVyZV92eGxhbl8xMDM5MDc=&#34;&gt;图 6&lt;/span&gt; 所示。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;分布式网关只需要维护 rt 匹配的路由&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230130224834603.png&#34; alt=&#34;image-20230130224834603&#34;&gt;&lt;/p&gt;
&lt;p&gt;dis ip rou vpn A&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230131144845172.png&#34; alt=&#34;image-20230131144845172&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;181&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;182&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;183&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;184&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;185&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;186&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;187&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;188&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;189&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;190&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;191&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;192&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;[CE3]di cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:5 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:5 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 import-extcommunity evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:11 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:11 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:3 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:3 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 3.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.1.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp distribute-gateway enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp collect host enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.2.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp distribute-gateway enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp collect host enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.20 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.3 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 3.3.3.3 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 3.3.3.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list protocol bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list protocol bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 2.2.2.2 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 2.2.2.2 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family unicast&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; l2vpn-family evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  policy vpn-target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 2.2.2.2 advertise irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE1]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 1.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.13.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 1.1.1.1 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[CE2]dis cu &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 10 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn-overlay enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:3 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:3 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 import-extcommunity evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vxlan vni 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  route-distinguisher 100:2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 export-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:100 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  vpn-target 100:22 import-extcommunity&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rip 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; version 2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 10.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; network 2.0.0.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.1.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp distribute-gateway enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp collect host enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vbdif20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.2.254 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp distribute-gateway enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; arp collect host enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.10 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/1.20 mode l2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; encapsulation dot1q vid 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; bridge-domain 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GE1/0/5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 10.1.12.2 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 2.2.2.2 255.255.255.255&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Nve1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; source 2.2.2.2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 10 head-end peer-list protocol bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; vni 20 head-end peer-list protocol bgp&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 3.3.3.3 as-number 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; peer 3.3.3.3 connect-interface LoopBack0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ipv4-family unicast&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; #&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; l2vpn-family evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  policy vpn-target&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  peer 3.3.3.3 advertise irb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230131144906251.png&#34; alt=&#34;image-20230131144906251&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230131145050065.png&#34; alt=&#34;image-20230131145050065&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;分布式网关访问外网&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#分布式网关访问外网&#34;&gt;#&lt;/a&gt; 分布式网关访问外网&lt;/h2&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CE2-CE3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 as 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 con l 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;l2vpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 en&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 1.1.1.1 ad irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;CE1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 as 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 con l 0 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;l2vpn &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 en&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;peer 2.2.2.2 ad irb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//1.建立EVPN邻居&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip vpn A &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;route 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vxlan vni 99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn- 100:100 b evpn &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vpn 100:100 e e&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/3 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p l t &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;p t a v a &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int vlan 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip bin vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.10.1 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou vpn A  0.0.0.0 0 192.168.10.10 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou vpn A  8.8.8.0 24 192.168.10.10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;bgp 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ipv4 vpn A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;import  static&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ad l2vpn evpn   //vpnv4转换为EVPN type 5路由&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;b 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vxlan vni 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;evpn&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rd 100:1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rt 100:1 b&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;b20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int nv 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;FW &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;int g1/0/0.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vlan-type dot 10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip add 192.168.10.10 24 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;fir zon trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;add g1/0/0.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ser p p&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip rou 0.0.0.0 0 192.168.10.1 &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;strong&gt;Type5 路由 ——IP 前缀路由&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230131220410404.png&#34; alt=&#34;image-20230131220410404&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230131220430645.png&#34; alt=&#34;image-20230131220430645&#34;&gt;&lt;/p&gt;
&lt;p&gt;发送时&lt;/p&gt;
&lt;p&gt;tpye 2，3 路由携带 evpn 实例下自身的 ERT&lt;/p&gt;
&lt;p&gt;type 5 路由携带 vpn 实例下 eert&lt;/p&gt;
&lt;p&gt;接收时&lt;/p&gt;
&lt;p&gt;匹配 vpn 实例下 eirt&lt;/p&gt;
&lt;p&gt;1.14&lt;/p&gt;
&lt;p&gt;EVN&lt;/p&gt;
&lt;p&gt;用于 vlan 的场景下实现跨数据中心互访，完成不同数据中心相同 vlan 互访，只用于二层互访&lt;/p&gt;
&lt;p&gt;@集成多播路由 (Inclusive Multicast Route) : 当 PE 之间的 BGP 邻居关系建立成功后，PE 之间会传递集成多播路由。用于生成 BUM 转发表，同时自动建立传送数&lt;br&gt;
据报文的 VXLAN 隧道。&lt;/p&gt;
&lt;p&gt;MAC 地址通告路由 (MAC Advertisement Route) : BGP 邻居关系建立后，当 PE 上的 MAC 表信息发生变化时，PE 即向对等体 PE 发送 MAC 地址通告路由，用于更新对端 PE 上的 MAC 表，指导单播报文的转发。&lt;/p&gt;
&lt;p&gt;@以太自动发现路由（Ethernet Auto-Discovery Routa) : PE 之间的 BGP 邻居关系建立成功后，.PE 之间会传递以太自动发现路由。以太目动发现路由可以向其他 PE 通告本端 PE 对接入站点的 MAC 地址的可达性，主要用于 CE 多归属的场景中的水平分割和快速收敛。&lt;/p&gt;
&lt;p&gt;以太网段路由 (Ethernet Segment Route) : 当 PE 之间的 BGP 邻居关系建立成功后，PE 之间会传递以太网段路由，用来实现连接到相同 CE 的 PE 设备之间互相自动发现。以太网段路由主要用于 CE 多归属场景中的 DF 的选举。在单归属场景中，主要涉及前两种路由的交互。接下来我们就看一下，这两种路由信息是如何促成控制面表项和隧道生成的。&lt;/p&gt;
&lt;p&gt;type 1&lt;/p&gt;
&lt;p&gt;双规场景下实现别名，快速收敛，水平分割&lt;/p&gt;
&lt;p&gt;esi 用于实现 PE 是否连在一台 CE 上，本端 PE 知道，对端 PE 也知道&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201215825630.png&#34; alt=&#34;image-20230201215825630&#34;&gt;&lt;/p&gt;
&lt;p&gt;通过阻塞链路或者负载分担防环&lt;/p&gt;
&lt;p&gt;阻塞链路：single active&lt;/p&gt;
&lt;p&gt;负载分担：all- active&lt;/p&gt;
&lt;p&gt;多活时与 CE 相连的 PE 必须都是多活&lt;/p&gt;
&lt;p&gt;有一个单活就必须使用第一种&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201220430613.png&#34; alt=&#34;image-20230201220430613&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201221300402.png&#34; alt=&#34;image-20230201221300402&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201222213560.png&#34; alt=&#34;image-20230201222213560&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203212914411.png&#34; alt=&#34;image-20230203212914411&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203213933709.png&#34; alt=&#34;image-20230203213933709&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203214050214.png&#34; alt=&#34;image-20230203214050214&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203214445292.png&#34; alt=&#34;image-20230203214445292&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203214823555.png&#34; alt=&#34;image-20230203214823555&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203215114418.png&#34; alt=&#34;image-20230203215114418&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203215133032.png&#34; alt=&#34;image-20230203215133032&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&#34;https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203220526567.png&#34; alt=&#34;image-20230203220526567&#34;&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;138&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;vlan batch 30 100 200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys enable&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;vsys name A 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; assign vlan 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; assign global-ip 203.1.1.1 203.1.1.10 free&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.100.100 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.200.200 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet0/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance default&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.0.1 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; alias GE0/METH&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; portswitch&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port link-type trunk&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; port trunk allow-pass vlan 2 to 4094&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface GigabitEthernet1/0/6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; undo shutdown&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Virtual-if0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Virtual-if1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface NULL0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface GigabitEthernet0/0/0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Virtual-if0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Vlanif200&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone dmz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 192.168.200.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 203.1.1.0 255.255.255.240 vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user-interface con 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; authentication-mode aaa&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; idle-timeout 0 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user-interface vty 0 4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; authentication-mode aaa&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; protocol inbound ssh&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;user-interface vty 16 20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;switch vsys A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;sys &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;interface Vlanif100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip binding vpn-instance A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; ip address 192.168.100.100 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; service-manage ping permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone local&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 85&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Vlanif100&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; add interface Virtual-if1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;firewall zone dmz&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; set priority 50&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;location&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat address-group A 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mode pat&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; section 0 203.1.1.1 203.1.1.3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;multi-linkif&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; mode proportion-of-weight&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule name test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  destination-zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.1.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.2.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  action permit&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;auth-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;traffic-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;policy-based-route&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;nat-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; rule name A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-zone trust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  destination-zone untrust&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.1.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  source-address 192.168.2.0 mask 255.255.255.0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  action source-nat address-group A&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;quota-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;pcp-policy&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 0.0.0.0 0.0.0.0 public&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.1.0 255.255.255.0 192.168.100.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;ip route-static 192.168.2.0 255.255.255.0 192.168.100.1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;return&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
        <category term="网络" />
        <updated>2023-01-20T05:38:45.000Z</updated>
    </entry>
</feed>

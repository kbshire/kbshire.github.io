



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="运维" />


<link rel="canonical" href="http://example.com/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/">



  <title>
虚拟化 - 运维 |
Yume Shoka = Hexo</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">虚拟化
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2024-01-25 13:38:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2024-01-25T13:38:45+08:00">2024-01-25</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/15ab06b7fe711067fca78ee15eb32391.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/7b6444f4b5464a4670e99b60aca4dbbf.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/d98b6decf4bed33201f3217c864cf5a3.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/ab91a781f947dbcb9f7b3c02626f9f98.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/b4993dcc18b931060093920da621db79.jpg"></li>
          <li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/ebaf5d5dbf78e8c31831feb203aa81fb.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%BF%90%E7%BB%B4/" itemprop="item" rel="index" title="In 运维"><span itemprop="name">运维</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="虚拟化"><a class="markdownIt-Anchor" href="#虚拟化">#</a> 虚拟化</h1>
<h2 id="kvm"><a class="markdownIt-Anchor" href="#kvm">#</a> kvm</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 配置yum</span><br><span class="line">mount -t iso9660 -o ro,loop xxx    /www</span><br><span class="line">mount 只能mount块设备。mount文件的时候，会先做成块设备，再mount</span><br><span class="line"></span><br><span class="line">// 把文件做成块设备</span><br><span class="line">losetup /dev/loop1 xxx.iso</span><br><span class="line">losetup -a</span><br><span class="line">// mount -t iso9660 -o ro /dev/loop1  /www    -&gt;   mount -t iso9660 -o ro,loop xxx    /www</span><br><span class="line"></span><br><span class="line">简写</span><br><span class="line">mount xxx.iso /ppp</span><br><span class="line"></span><br><span class="line">mount -l</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 自定义yum</span><br><span class="line">createrepo xxx    // 生成repodata</span><br><span class="line"></span><br><span class="line">baseurl配置和 repodata 同一目录</span><br><span class="line">gpgcheck 需要配合私钥使用。 RPM-GPG-KEY</span><br></pre></td></tr></table></figure>
<h3 id="虚拟化-2"><a class="markdownIt-Anchor" href="#虚拟化-2">#</a> 虚拟化</h3>
<p>kvm / vcenter  /  xen  /  hyper-v</p>
<h3 id="kvm-qemu-libvirtd"><a class="markdownIt-Anchor" href="#kvm-qemu-libvirtd">#</a> KVM /QEMU /LIBVIRTD</h3>
<p>KVM 是 linux 内核的模块，他需要 CPU 的支持，采用硬件辅助虚拟化技术 Intel-VT，AMD-V，内存的相关如 Intel 的 EPT 和 AMD 的 RVI 技术</p>
<p>QEMU 是一个虚拟化的仿真工具，通过 ioctl 与内核 kvm 交互完成对硬件的虚拟化支持</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240123230817999.png" alt="image-20240123230817999" style="zoom:50%;" /> 
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240123230901146.png" alt="image-20240123230901146" style="zoom: 25%;" /> 
<p>Libvirt 是一个对虚拟化管理的接口和工具，提供用户端程序 virsh ,virt-install, virt-manager, virt-view 与用户交互</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost usr]# ps -efww | grep qemu </span><br><span class="line">qemu       4075      1 99 06:41 ?        00:13:46 /usr/libexec/qemu-kvm -name generic -S -machine pc-i440fx-rhel7.0.0,accel=tcg,usb=off,dump-guest-core=off -m 1024 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid 7693d5c3-1153-43aa-a38e-4093f30292a0 -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-3-generic/monitor.sock,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc,driftfix=slew -global kvm-pit.lost_tick_policy=delay -no-hpet -no-reboot -global PIIX4_PM.disable_s3=1 -global PIIX4_PM.disable_s4=1 -boot strict=on -device ich9-usb-ehci1,id=usb,bus=pci.0,addr=0x5.0x7 -device ich9-usb-uhci1,masterbus=usb.0,firstport=0,bus=pci.0,multifunction=on,addr=0x5 -device ich9-usb-uhci2,masterbus=usb.0,firstport=2,bus=pci.0,addr=0x5.0x1 -device ich9-usb-uhci3,masterbus=usb.0,firstport=4,bus=pci.0,addr=0x5.0x2 -device virtio-serial-pci,id=virtio-serial0,bus=pci.0,addr=0x6 -drive file=/var/lib/libvirt/images/generic.qcow2,format=qcow2,if=none,id=drive-ide0-0-0 -device ide-hd,bus=ide.0,unit=0,drive=drive-ide0-0-0,id=ide0-0-0,bootindex=2 -drive file=/root/CentOS-7-x86_64-Minimal-2009.iso,format=raw,if=none,id=drive-ide0-0-1,readonly=on -device ide-cd,bus=ide.0,unit=1,drive=drive-ide0-0-1,id=ide0-0-1,bootindex=1 -netdev tap,fd=26,id=hostnet0 -device rtl8139,netdev=hostnet0,id=net0,mac=52:54:00:3d:35:10,bus=pci.0,addr=0x3 -chardev pty,id=charserial0 -device isa-serial,chardev=charserial0,id=serial0 -chardev spicevmc,id=charchannel0,name=vdagent -device virtserialport,bus=virtio-serial0.0,nr=1,chardev=charchannel0,id=channel0,name=com.redhat.spice.0 -spice port=5900,addr=127.0.0.1,disable-ticketing,image-compression=off,seamless-migration=on -vga qxl -global qxl-vga.ram_size=67108864 -global qxl-vga.vram_size=67108864 -global qxl-vga.vgamem_mb=16 -global qxl-vga.max_outputs=1 -device intel-hda,id=sound0,bus=pci.0,addr=0x4 -device hda-duplex,id=sound0-codec0,bus=sound0.0,cad=0 -chardev spicevmc,id=charredir0,name=usbredir -device usb-redir,chardev=charredir0,id=redir0,bus=usb.0,port=1 -chardev spicevmc,id=charredir1,name=usbredir -device usb-redir,chardev=charredir1,id=redir1,bus=usb.0,port=2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x7 -msg timestamp=on</span><br><span class="line">root       4863   2914  0 06:53 pts/0    00:00:00 grep --color=auto qemu</span><br><span class="line"></span><br><span class="line">// 必选组件</span><br><span class="line">yum install qemu-kvm libvirt-daemon libvirt-client libvirt-daemon-driver-qemu -y</span><br><span class="line">systemctl enable --now libvirtd</span><br><span class="line"></span><br><span class="line">// 可选组件</span><br><span class="line">virt-install 系统安装工具</span><br><span class="line">virt-manager 图形管理工具</span><br><span class="line">virt-v2v  虚拟机迁移工具</span><br><span class="line">virt-p2v  物理机迁移工具</span><br></pre></td></tr></table></figure>
<p>虚拟机的组成<br>
内核虚拟化模块 (KVM)</p>
<p>系统设备仿真 (QEMU)</p>
<p>虚拟机管理程序 (LIBVIRT)</p>
<p>一个 XML 文件 (虚拟机配置声明文件)</p>
<p>位置 /etc/libvirt/qemu/</p>
<p>一个磁盘镜像文件 (虚拟机的硬盘)</p>
<p>位置 /var/lib/libvirt/images/</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost usr]# cd /etc/libvirt/qemu/</span><br><span class="line">[root@localhost qemu]# ls </span><br><span class="line">generic.xml  networks</span><br><span class="line"></span><br><span class="line">[root@localhost qemu]# cat generic.xml </span><br><span class="line">&lt;!--</span><br><span class="line">WARNING: THIS IS AN AUTO-GENERATED FILE. CHANGES TO IT ARE LIKELY TO BE</span><br><span class="line">OVERWRITTEN AND LOST. Changes to this xml configuration should be made using:</span><br><span class="line">  virsh edit generic</span><br><span class="line">or other application using the libvirt API.</span><br><span class="line">--&gt;</span><br><span class="line"></span><br><span class="line">&lt;domain type=&#x27;qemu&#x27;&gt;</span><br><span class="line">  &lt;name&gt;generic&lt;/name&gt;</span><br><span class="line">  &lt;uuid&gt;7693d5c3-1153-43aa-a38e-4093f30292a0&lt;/uuid&gt;</span><br><span class="line">  &lt;memory unit=&#x27;KiB&#x27;&gt;1048576&lt;/memory&gt;</span><br><span class="line">  &lt;currentMemory unit=&#x27;KiB&#x27;&gt;1048576&lt;/currentMemory&gt;</span><br><span class="line">  &lt;vcpu placement=&#x27;static&#x27;&gt;1&lt;/vcpu&gt;</span><br><span class="line">  &lt;os&gt;</span><br><span class="line">    &lt;type arch=&#x27;x86_64&#x27; machine=&#x27;pc-i440fx-rhel7.0.0&#x27;&gt;hvm&lt;/type&gt;</span><br><span class="line">    &lt;boot dev=&#x27;hd&#x27;/&gt;</span><br><span class="line">  &lt;/os&gt;</span><br><span class="line">  &lt;features&gt;</span><br><span class="line">    &lt;acpi/&gt;</span><br><span class="line">    &lt;apic/&gt;</span><br><span class="line">  &lt;/features&gt;</span><br><span class="line">  &lt;clock offset=&#x27;utc&#x27;&gt;</span><br><span class="line">    &lt;timer name=&#x27;rtc&#x27; tickpolicy=&#x27;catchup&#x27;/&gt;</span><br><span class="line">    &lt;timer name=&#x27;pit&#x27; tickpolicy=&#x27;delay&#x27;/&gt;</span><br><span class="line">    &lt;timer name=&#x27;hpet&#x27; present=&#x27;no&#x27;/&gt;</span><br><span class="line">  &lt;/clock&gt;</span><br><span class="line">  &lt;on_poweroff&gt;destroy&lt;/on_poweroff&gt;</span><br><span class="line">  &lt;on_reboot&gt;restart&lt;/on_reboot&gt;</span><br><span class="line">  &lt;on_crash&gt;destroy&lt;/on_crash&gt;</span><br><span class="line">  &lt;pm&gt;</span><br><span class="line">    &lt;suspend-to-mem enabled=&#x27;no&#x27;/&gt;</span><br><span class="line">    &lt;suspend-to-disk enabled=&#x27;no&#x27;/&gt;</span><br><span class="line">  &lt;/pm&gt;</span><br><span class="line">  &lt;devices&gt;</span><br><span class="line">    &lt;emulator&gt;/usr/libexec/qemu-kvm&lt;/emulator&gt;</span><br><span class="line">    &lt;disk type=&#x27;file&#x27; device=&#x27;disk&#x27;&gt;</span><br><span class="line">      &lt;driver name=&#x27;qemu&#x27; type=&#x27;qcow2&#x27;/&gt;</span><br><span class="line">      &lt;source file=&#x27;/var/lib/libvirt/images/generic.qcow2&#x27;/&gt;</span><br><span class="line">      &lt;target dev=&#x27;hda&#x27; bus=&#x27;ide&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;drive&#x27; controller=&#x27;0&#x27; bus=&#x27;0&#x27; target=&#x27;0&#x27; unit=&#x27;0&#x27;/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;disk type=&#x27;file&#x27; device=&#x27;cdrom&#x27;&gt;</span><br><span class="line">      &lt;driver name=&#x27;qemu&#x27; type=&#x27;raw&#x27;/&gt;</span><br><span class="line">      &lt;target dev=&#x27;hdb&#x27; bus=&#x27;ide&#x27;/&gt;</span><br><span class="line">      &lt;readonly/&gt;</span><br><span class="line">      &lt;address type=&#x27;drive&#x27; controller=&#x27;0&#x27; bus=&#x27;0&#x27; target=&#x27;0&#x27; unit=&#x27;1&#x27;/&gt;</span><br><span class="line">    &lt;/disk&gt;</span><br><span class="line">    &lt;controller type=&#x27;usb&#x27; index=&#x27;0&#x27; model=&#x27;ich9-ehci1&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x05&#x27; function=&#x27;0x7&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type=&#x27;usb&#x27; index=&#x27;0&#x27; model=&#x27;ich9-uhci1&#x27;&gt;</span><br><span class="line">      &lt;master startport=&#x27;0&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x05&#x27; function=&#x27;0x0&#x27; multifunction=&#x27;on&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type=&#x27;usb&#x27; index=&#x27;0&#x27; model=&#x27;ich9-uhci2&#x27;&gt;</span><br><span class="line">      &lt;master startport=&#x27;2&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x05&#x27; function=&#x27;0x1&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type=&#x27;usb&#x27; index=&#x27;0&#x27; model=&#x27;ich9-uhci3&#x27;&gt;</span><br><span class="line">      &lt;master startport=&#x27;4&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x05&#x27; function=&#x27;0x2&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type=&#x27;pci&#x27; index=&#x27;0&#x27; model=&#x27;pci-root&#x27;/&gt;</span><br><span class="line">    &lt;controller type=&#x27;ide&#x27; index=&#x27;0&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x01&#x27; function=&#x27;0x1&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;controller type=&#x27;virtio-serial&#x27; index=&#x27;0&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x06&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">    &lt;/controller&gt;</span><br><span class="line">    &lt;interface type=&#x27;network&#x27;&gt;</span><br><span class="line">      &lt;mac address=&#x27;52:54:00:3d:35:10&#x27;/&gt;</span><br><span class="line">      &lt;source network=&#x27;default&#x27;/&gt;</span><br><span class="line">      &lt;model type=&#x27;rtl8139&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x03&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">    &lt;/interface&gt;</span><br><span class="line">    &lt;serial type=&#x27;pty&#x27;&gt;</span><br><span class="line">      &lt;target type=&#x27;isa-serial&#x27; port=&#x27;0&#x27;&gt;</span><br><span class="line">        &lt;model name=&#x27;isa-serial&#x27;/&gt;</span><br><span class="line">      &lt;/target&gt;</span><br><span class="line">    &lt;/serial&gt;</span><br><span class="line">    &lt;console type=&#x27;pty&#x27;&gt;</span><br><span class="line">      &lt;target type=&#x27;serial&#x27; port=&#x27;0&#x27;/&gt;</span><br><span class="line">    &lt;/console&gt;</span><br><span class="line">    &lt;channel type=&#x27;spicevmc&#x27;&gt;</span><br><span class="line">      &lt;target type=&#x27;virtio&#x27; name=&#x27;com.redhat.spice.0&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;virtio-serial&#x27; controller=&#x27;0&#x27; bus=&#x27;0&#x27; port=&#x27;1&#x27;/&gt;</span><br><span class="line">    &lt;/channel&gt;</span><br><span class="line">    &lt;input type=&#x27;mouse&#x27; bus=&#x27;ps2&#x27;/&gt;</span><br><span class="line">    &lt;input type=&#x27;keyboard&#x27; bus=&#x27;ps2&#x27;/&gt;</span><br><span class="line">    &lt;graphics type=&#x27;spice&#x27; autoport=&#x27;yes&#x27;&gt;</span><br><span class="line">      &lt;listen type=&#x27;address&#x27;/&gt;</span><br><span class="line">      &lt;image compression=&#x27;off&#x27;/&gt;</span><br><span class="line">    &lt;/graphics&gt;</span><br><span class="line">    &lt;sound model=&#x27;ich6&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x04&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">    &lt;/sound&gt;</span><br><span class="line">    &lt;video&gt;</span><br><span class="line">      &lt;model type=&#x27;qxl&#x27; ram=&#x27;65536&#x27; vram=&#x27;65536&#x27; vgamem=&#x27;16384&#x27; heads=&#x27;1&#x27; primary=&#x27;yes&#x27;/&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x02&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">    &lt;/video&gt;</span><br><span class="line">    &lt;redirdev bus=&#x27;usb&#x27; type=&#x27;spicevmc&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;usb&#x27; bus=&#x27;0&#x27; port=&#x27;1&#x27;/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;redirdev bus=&#x27;usb&#x27; type=&#x27;spicevmc&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;usb&#x27; bus=&#x27;0&#x27; port=&#x27;2&#x27;/&gt;</span><br><span class="line">    &lt;/redirdev&gt;</span><br><span class="line">    &lt;memballoon model=&#x27;virtio&#x27;&gt;</span><br><span class="line">      &lt;address type=&#x27;pci&#x27; domain=&#x27;0x0000&#x27; bus=&#x27;0x00&#x27; slot=&#x27;0x07&#x27; function=&#x27;0x0&#x27;/&gt;</span><br><span class="line">    &lt;/memballoon&gt;</span><br><span class="line">  &lt;/devices&gt;</span><br><span class="line">&lt;/domain&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost images]# ls </span><br><span class="line">generic.qcow2</span><br></pre></td></tr></table></figure>
<h3 id="virsh-命令"><a class="markdownIt-Anchor" href="#virsh-命令">#</a> virsh 命令</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">// 两种方式</span><br><span class="line">[root@localhost images]# virsh </span><br><span class="line">Welcome to virsh, the virtualization interactive terminal.</span><br><span class="line"></span><br><span class="line">Type:  &#x27;help&#x27; for help with commands</span><br><span class="line">       &#x27;quit&#x27; to quit</span><br><span class="line"></span><br><span class="line">virsh # list </span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 3     generic                        running</span><br><span class="line"></span><br><span class="line">virsh # exit </span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh list   				// 列出启动的虚拟机</span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 3     generic                        running</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh list  --all 				// 列出所有虚拟机</span><br><span class="line"> Id    Name                           State</span><br><span class="line">----------------------------------------------------</span><br><span class="line"> 3     generic                        running</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh start/reboot/shutdown xxx 			// 启动虚拟机</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh destroy xxx 			// 强制关闭虚拟机</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh define/undefine  xxx 			// 根据xml创建删除虚拟机</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh console  xxx 			// 链接虚拟机console</span><br><span class="line">ctrl + ]  退出console</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh edit  xxx 				// 调整虚拟机参数</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh autostart  xxx 			// 开机自启</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh domiflist  xxx			// 设置虚拟机网卡 		</span><br><span class="line"></span><br><span class="line">[root@localhost images]# virsh domblklist  xxx			// 设置虚拟机硬盘 		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 虚拟交换机命令</span><br><span class="line">[root@localhost images]# virsh net-list --all</span><br><span class="line"> Name                 State      Autostart     Persistent</span><br><span class="line">----------------------------------------------------------</span><br><span class="line"> default              active     yes           yes</span><br><span class="line"></span><br><span class="line">[root@localhost ~]# virsh net-start </span><br><span class="line">[root@localhost ~]# virsh net-destroy</span><br><span class="line">[root@localhost ~]# virsh net-define</span><br><span class="line">[root@localhost ~]# virsh net-undefine</span><br><span class="line">[root@localhost ~]# virsh net-edit</span><br><span class="line">[root@localhost ~]# virsh net-autostart</span><br></pre></td></tr></table></figure>
<h3 id="虚拟机磁盘管理"><a class="markdownIt-Anchor" href="#虚拟机磁盘管理">#</a> 虚拟机磁盘管理</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240124212020114.png" alt="image-20240124212020114" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">qemu-img 是虚拟机的磁盘管理命令，支持非常多的磁盘格式，例如raw、qcow2、vdi、vmdk等等</span><br><span class="line"></span><br><span class="line">qemu-img create -f qcow2 aa.img 50G</span><br><span class="line">qemu-img create -b haha.img -f qcow2 111.img    // -b使用后端模板文件</span><br><span class="line"></span><br><span class="line">qemu-img info aa.img</span><br><span class="line"></span><br><span class="line">qemu-img convert   // 转换磁盘格式</span><br><span class="line"></span><br><span class="line">qemu-img info</span><br><span class="line"></span><br><span class="line">qemu-img resize</span><br></pre></td></tr></table></figure>
<p>qcow2 占用空间小，创建系统时不会把所有空间全部占用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cd /var/lib/libvirt/images/</span><br><span class="line">[root@localhost images]# qemu-img create -f qcow2 node_base  20G</span><br><span class="line">Formatting &#x27;node_base&#x27;, fmt=qcow2 size=21474836480 encryption=off cluster_size=65536 lazy_refcounts=off </span><br><span class="line">[root@localhost images]# qemu-img create -b node_base -f qcow2 node_node.img 20G</span><br><span class="line">Formatting &#x27;node_node.img&#x27;, fmt=qcow2 size=21474836480 backing_file=&#x27;node_base&#x27; encryption=off cluster_size=65536 lazy_refcounts=off </span><br><span class="line"></span><br><span class="line">[root@localhost images]# qemu-img  info node_base </span><br><span class="line">image: node_base</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 20G (21474836480 bytes)</span><br><span class="line">disk size: 196K</span><br><span class="line">cluster_size: 65536</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: false</span><br><span class="line">    </span><br><span class="line">[root@localhost images]# qemu-img  info node_node.img </span><br><span class="line">image: node_node.img</span><br><span class="line">file format: qcow2</span><br><span class="line">virtual size: 20G (21474836480 bytes)</span><br><span class="line">disk size: 196K</span><br><span class="line">cluster_size: 65536</span><br><span class="line">backing file: node_base</span><br><span class="line">Format specific information:</span><br><span class="line">    compat: 1.1</span><br><span class="line">    lazy refcounts: false</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>cow</p>
<p>Copy On Write，写时复制</p>
<p>直接映射原始盘的数据内容</p>
<p>当数据有修改要求时，在修改之前自动将旧数据拷贝存入前端盘后，对前端盘进行修改</p>
<p>原始盘始终是只读的</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240124215416657.png" alt="image-20240124215416657"></p>
<h3 id="克隆虚拟机"><a class="markdownIt-Anchor" href="#克隆虚拟机">#</a> 克隆虚拟机</h3>
<p>复制已经存在的 xml 为 zzz.xml</p>
<p>修改 name，和 xml 名字一样</p>
<p>修改 disk file</p>
<p>执行：</p>
<p>virsh define zzz.xml</p>
<p>virsh start zzz</p>
<p>virsh list</p>
<p>virsh console zzz</p>
<h3 id="扩容磁盘"><a class="markdownIt-Anchor" href="#扩容磁盘">#</a> 扩容磁盘</h3>
<p>磁盘 -&gt;  分区  -&gt;  文件系统</p>
<p>不能缩，只能扩</p>
<p>1. 硬件扩容</p>
<p>virsh blockresize --path /var/lib/libvirt/images/node1.img --size 50G  node1</p>
<p>下面的命令在虚拟机上执行</p>
<p>2. 磁盘空间扩容</p>
<p>growpart /dev/vda 1</p>
<p>3. 扩容文件系统</p>
<p>xfs_growfs /dev/vda1</p>
<h2 id="openstack"><a class="markdownIt-Anchor" href="#openstack">#</a> OpenStack</h2>
<h3 id="openstack-组件"><a class="markdownIt-Anchor" href="#openstack-组件">#</a> openstack 组件</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240126212642843.png" alt="image-20240126212642843"></p>
<p>Keystone</p>
<p>为其他服务提供认证和授权的集中身份管理服务</p>
<p>也提供了集中的目录服务</p>
<p>支持多种身份认证模式，如密码认证、令牌认证、以及 AWS 登陆</p>
<p>为用户和其他服务提供了 SSO 认证服务</p>
<p>Neutron</p>
<p>一种软件定义网络服务</p>
<p>用于创建网络、子网、路由器、管理浮动 IP 地址</p>
<p>可以实现虚拟交换机、虚拟路由器</p>
<p>可用于在项目中创建 VPN</p>
<h3 id="部署"><a class="markdownIt-Anchor" href="#部署">#</a> 部署</h3>
<p>三台 8C 16G 主机，一个 hostname openstack，另外两个 nova1 和  nova2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// 以下操作在每台节点上执行</span><br><span class="line">vim /etc/resolve.conf</span><br><span class="line">8.8.8.8</span><br><span class="line"></span><br><span class="line">vim /etc/hosts</span><br><span class="line">192.168.13.201 openstack</span><br><span class="line">192.168.13.202 nova1</span><br><span class="line">192.168.13.202 nova2</span><br><span class="line"></span><br><span class="line">yum install chrony -y</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line">server ntp2.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp1.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp1.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp10.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp11.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp12.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp2.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp2.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp3.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp3.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp4.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp4.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp5.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp5.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp6.aliyun.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp6.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp7.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp8.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line">server ntp9.cloud.aliyuncs.com minpoll 4 maxpoll 10 iburst</span><br><span class="line"></span><br><span class="line">systemctl restart chronyd</span><br><span class="line">chronyc sources -v</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install qemu-kvm libvirt-daemon libvirt-daemon-driver-qemu libvirt-client python-setuptools -y</span><br><span class="line">yum remove NetworkManager* -y</span><br><span class="line">yum remove firewalld* -y </span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line">BOOTPROTO=static</span><br><span class="line">systemctl restart network</span><br><span class="line"></span><br></pre></td></tr></table></figure>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">// openstack节点</span><br><span class="line">bash &lt;(curl -sSL https://gitee.com/SuperManito/LinuxMirrors/raw/main/ChangeMirrors.sh)</span><br><span class="line">    选择中科大镜像源。</span><br><span class="line">    注意不要安装EPEL扩展源因为会导致稍后安装packstack失败，建议只更换基础源不要更换OpenStack相关的源避免后续在获取某些软件包时超时失败。</span><br><span class="line">    使用HTTP协议</span><br><span class="line">    更新软件包</span><br><span class="line">    清空已下载软件包缓存</span><br><span class="line"></span><br><span class="line">yum install centos-release-openstack-train</span><br><span class="line">yum install openstack-packstack</span><br><span class="line"></span><br><span class="line">packstack --gen-answer-file=answer.ini</span><br><span class="line">packstack --answer-file=answer.ini</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CONFIG_CONTROLLER_HOST=192.168.13.201</span><br><span class="line">CONFIG_COMPUTE_HOSTS=192.168.13.202</span><br><span class="line"></span><br><span class="line"># List of servers on which to install the network service such as</span><br><span class="line"># Compute networking (nova network) or OpenStack Networking (neutron).</span><br><span class="line">CONFIG_NETWORK_HOSTS=192.168.13.201,192.168.13.202</span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240127214826167.png" alt="image-20240127214826167" style="zoom:50%;" /> 
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240127222426338.png" alt="image-20240127222426338"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ovs-vsctl show</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]# . keystonerc_admin </span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack user list</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| b88c0404f054445ab8c099673ecdb0f9 | admin     |</span><br><span class="line">| 592cf7de5ffe4ec69bec764c6e6a3506 | glance    |</span><br><span class="line">| a62eaa55c4c44dbf9c559b471bde2394 | cinder    |</span><br><span class="line">| 7edbdc229b8f4286bde2aa477521b2ad | nova      |</span><br><span class="line">| 51b14b54bc124655b6bb29fb2b0b8458 | placement |</span><br><span class="line">| 4facc9243f4c471a91bc9a9d5b5c45d0 | neutron   |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">// 不退出终端</span><br><span class="line">[root@openstack ~]# bash</span><br><span class="line">[root@openstack ~]# . keystonerc_admin </span><br><span class="line">[root@openstack ~(keystone_admin)]# </span><br><span class="line">[root@openstack ~(keystone_admin)]# exit</span><br><span class="line">exit</span><br><span class="line"></span><br><span class="line">// 查看帮助</span><br><span class="line">[root@openstack ~]# openstack help user </span><br><span class="line">Command &quot;user&quot; matches:</span><br><span class="line">  user create</span><br><span class="line">  user delete</span><br><span class="line">  user list</span><br><span class="line">  user password set</span><br><span class="line">  user set</span><br><span class="line">  user show</span><br></pre></td></tr></table></figure>
<h3 id="项目管理"><a class="markdownIt-Anchor" href="#项目管理">#</a> 项目管理</h3>
<p>项目：一组隔离的资源和对象。由一组关联的用户进行管理</p>
<p>在旧版本里，也用租户 (tenant) 来表示</p>
<p>根据配置的需求，项目对应一个组织、一个公司或是一个使用客户等</p>
<p>项目中可以有多个用户，项目中的用户可以在该项目创建、管理虚拟资</p>
<p>源具有 admin 角色的用户可以创建项目</p>
<p>项目相关信息保存到 MariaDB 中</p>
<p>缺省情况下，packstack 安装的 openstack 中有两个独立的项目</p>
<ul>
<li>admin: 为 admin 账户创建的项目</li>
<li>services: 与安装的各个服务相关联</li>
</ul>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128195410374.png" alt="image-20240128195410374"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">// 创建项目</span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack project create myproject</span><br><span class="line"></span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack project list</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| 54aa5d992e084017a2aef3282fdb1119 | admin     |</span><br><span class="line">| 735ea2227d2e4c509af906f8e519c95d | myproject |</span><br><span class="line">| c0e8ee283cca473d87676ff1a0f099ef | services  |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack project show myproject </span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description |                                  |</span><br><span class="line">| domain_id   | default                          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | 735ea2227d2e4c509af906f8e519c95d |</span><br><span class="line">| is_domain   | False                            |</span><br><span class="line">| name        | myproject                        |</span><br><span class="line">| options     | &#123;&#125;                               |</span><br><span class="line">| parent_id   | default                          |</span><br><span class="line">| tags        | []                               |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line"></span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack project set --disable 激活/禁用项目</span><br><span class="line"></span><br><span class="line">// 查看项目配额</span><br><span class="line">[root@openstack ~(keystone_admin)]# nova quota-show --tenant myproject </span><br><span class="line"></span><br><span class="line">// 更新vcpu数目</span><br><span class="line">[root@openstack ~(keystone_admin)]# nova quota-update --cores 30</span><br><span class="line"></span><br><span class="line">// 删除</span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack project delete myproject</span><br></pre></td></tr></table></figure>
<p>创建项目</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128200815326.png" alt="image-20240128200815326"></p>
<p>创建用户</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128200738517.png" alt="image-20240128200738517"></p>
<p>修改密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~(keystone_admin)]# openstack user set --password 123456 kbshire		// 修改密码</span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack role remove --project myproject --user kbshire _member_    // 删除用户</span><br><span class="line">[root@openstack ~(keystone_admin)]# openstack  user delete  kbshire </span><br></pre></td></tr></table></figure>
<p>资源配额</p>
<p>安全组规则：指定每个项目可用的规则数</p>
<p>核心：指定每个项可用的 VCPU 核心数</p>
<p>固定 IP 地址：指定每个项目可用的固定 IP 数</p>
<p>浮动 IP 地址：指定每个项目可用的浮动 IP 数</p>
<p>注入文件大小：指定每个项目内容大小</p>
<p>注入文件路径：指定每个项目注入的文件路径长度</p>
<p>注入文件：指定每个项目允许注入的文件数目</p>
<p>实例：指定每个项目可创建的虚拟机实例数目</p>
<p>密钥对：指定每个项可创建的密钥数</p>
<p>元数据：指定每个项目可用的元数据数目</p>
<p>内存：指定每个项目可用的最大内存</p>
<p>安全组：指定每个项目可创建的安全组数目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">列出项目的缺省配额</span><br><span class="line">[root@openstack~(keystone_admin)]# nova quota-defaults</span><br><span class="line">列出myproject的配额</span><br><span class="line">[root@openstack~(keystone admin)]# nova quota-show --tenant myproject</span><br><span class="line">修改浮动IP地址配额</span><br><span class="line">[root@openstack~(keystone admin)]# nova quota-update --floating-ips 20 myproject</span><br></pre></td></tr></table></figure>
<p>云主机类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">云主机类型就是资源的模板</span><br><span class="line">它定义了一台云主机可以使用的资源，如内存大小磁盘容量和CPU核心数等</span><br><span class="line">Openstack提供了几个默认的云主机类型</span><br><span class="line">管理员还可以自定义云主机类型</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128202210696.png" alt="image-20240128202210696"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">列出所有的云主机类型</span><br><span class="line">[root@openstack~(keystone admin)]# openstack flavor list</span><br><span class="line">创建一个云主机类型</span><br><span class="line">[root@openstack~(keystone admin)]# openstack flavor create --public demo.tiny--id auto --ram 512 --disk 10 --vcpus 1</span><br><span class="line">删除云主机类型</span><br><span class="line">[root@openstack~(keystone admin)]# openstack flavor delete demo.tiny</span><br></pre></td></tr></table></figure>
<p>在红帽 Openstack 平台中，镜像指的是虚拟磁盘文件</p>
<p>磁盘文件中应该已经安装了可启动的操作系统</p>
<p>镜像管理功能由 Glance 服务提供</p>
<p>它形成了创建虚拟机实例最底层的块结构</p>
<p>镜像可以由用户上传，也可以通过红帽官方站点下载</p>
<p>镜像容器格式</p>
<p>raw: 非结构化磁盘镜像格式</p>
<p>vhd:VMware、Xen、Microsoft、VirtualBox 等均支持的通用磁盘格式</p>
<p>vmdk: 是 Vmware 的虚拟磁盘格式</p>
<p>vdi:VirtualBox 虚拟机和 QEMU 支持磁盘格式</p>
<p>iso: 光盘数据内容的归档格式</p>
<p>qcow2:QEMU 支持的磁盘格式。空间自动扩展并支持写时复制 copy-on-write</p>
<p>bare: 镜像中没有容器或元数据封装</p>
<p>ovf: 一种开源的文件规范，描述了一个开源、安全、有效、可拓展的便携式虚拟打包以及软件分布格式</p>
<p>ova:OVA 归档文件</p>
<p>aki: 亚马逊内核镜像</p>
<p>ami: 亚马逊主机镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">上传镜像</span><br><span class="line">[root@openstack~(keystone admin)]# openstack image create --disk-format qcow2 -min-disk 10 --min-ram 512 --file /root/small.img small_rhel6</span><br><span class="line">列出镜像</span><br><span class="line">[root@openstack~(keystone admin)]# openstack image list</span><br><span class="line">查看镜像详情</span><br><span class="line">[root@openstack~(keystone admin)]# openstack image show small_rhel6</span><br></pre></td></tr></table></figure>
<h3 id="网络"><a class="markdownIt-Anchor" href="#网络">#</a> 网络</h3>
<p>实例被分配到子网中，以实现网络连通性</p>
<p>每个项目可以有一到多个子网</p>
<p>在红帽的 Openstack 平台中，OpenStack 网络服务是缺省的网络选项，Nova 网络服务作为备用</p>
<p>管理员能够配置丰富的网络，将其他 Openstack 服务连接到这些网络的接口上</p>
<p>每个项目都能拥有多个私有网络，各个项目的私有网络互相不受干扰</p>
<p>项目网络：由 Neutron 提供的项目内部网络，网络间可用 VLAN 隔离</p>
<p>外部网络：可以让虚拟机接入外部网络，但需要配置浮动 IP 地址</p>
<p>提供商网络：将实例连接到现有网络，实现虚拟机实例与外部系统共享同一二层网络</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128210136299.png" alt="image-20240128210136299"></p>
<p>创建内部网络子网</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212140879.png" alt="image-20240128212140879"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212159932.png" alt="image-20240128212159932"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212339442.png" alt="image-20240128212339442"></p>
<p>创建外部网络子网</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212509791.png" alt="image-20240128212509791"></p>
<p>新建路由打通内外网</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212721055.png" alt="image-20240128212721055"></p>
<p>添加接口</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212830047.png" alt="image-20240128212830047"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212803249.png" alt="image-20240128212803249"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240128212851644.png" alt="image-20240128212851644"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@openstack ~]#  systemctl status openstack-nova-compute.service </span><br></pre></td></tr></table></figure>
<p>创建浮动 IP 关联主机</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240129212317869.png" alt="image-20240129212317869"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240129212303012.png" alt="image-20240129212303012"></p>
<p>扩容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">扩容 openstack 计算节点参考 nova01 配置过程</span><br><span class="line"></span><br><span class="line">配置静态 ip:192.168.1.12，及主机名</span><br><span class="line">保证与 openstack,和 nova01 能相互 ping 通</span><br><span class="line">配置/etc/resolv.conf ，删除 search 开头行</span><br><span class="line">配置时间同步 /etc/chrony.conf</span><br><span class="line">配置 yum 源，软仓库</span><br><span class="line">安装依赖软件包 qemu-kvm libvirt-client libvirt-daemon libvirt-daemon-driver-qemu pythonsetuptools</span><br><span class="line"></span><br><span class="line">  96 # List the servers on which to install the Compute service.</span><br><span class="line">  97 CONFIG_COMPUTE_HOSTS=192.168.13.202</span><br><span class="line">  98 </span><br><span class="line">  99 # List of servers on which to install the network service such as</span><br><span class="line"> 100 # Compute networking (nova network) or OpenStack Networking (neutron).</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240129221506929.png" alt="image-20240129221506929" style="zoom:50%;" /> 
<p>迁移云主机</p>
<p>有多个 nova 计算节点的时候，我们可以选择性的把某一个云主机从某台机器上迁移到另外一台机器上</p>
<p>迁移条件</p>
<p>nova 计算节点与 openstack 管理节点都能相互 ping 通，主机名称也要能 ping 通</p>
<p>所有计算节点安装 qemu-img-rhev,qemu-kvm-rhev</p>
<p>如未安装，在安装以后需要重启 libvirtd 服务</p>
<h2 id="openstack-2"><a class="markdownIt-Anchor" href="#openstack-2">#</a> openstack</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">Openstack通过一组相互关联的服务提供基础设施即服务(laas)解决方案，每个服务都提供了一个应用程序编程接口(API)来促进这种集成</span><br><span class="line">Openstack项目是一个适用于所有类型云的开源云计算平台，项目目标是提供实施简单、可大规模扩展、丰富、标准统一的云计算平台</span><br><span class="line"></span><br><span class="line">Openstack实际上由一系列叫作脚本的命令组成。这些脚本会被捆绑到名为项目的软件包中，这些软件包则用于传递创建云环境的任务为了创建这些环境，0penstack还会使用2种其他类型的软件:</span><br><span class="line">虚拟化软件，用于创建从硬件中抽象出来的虚拟资源层</span><br><span class="line">基础操作系统(0S)，用于执行0penstack脚本发出的命令</span><br><span class="line">Openstack本身不会虚拟化资源但会使用虚拟化资源来构建云</span><br><span class="line">openstack、虚拟化和基础操作系统，这3种技术协同工作服务用户</span><br><span class="line"></span><br><span class="line">0penstack每年两个大版本，一般在4月和10月中旬发布，版本命名从字母A-Z</span><br><span class="line"></span><br><span class="line">[root@openstack ~]# rpm -qa | grep cinder </span><br><span class="line">openstack-cinder-15.6.0-1.el7.noarch</span><br><span class="line">puppet-cinder-15.5.0-1.el7.noarch</span><br><span class="line">python2-cinder-15.6.0-1.el7.noarch</span><br><span class="line">python2-cinderclient-5.0.2-1.el7.noarch</span><br><span class="line">[root@openstack ~]# rpm -qa | grep nova</span><br><span class="line">openstack-nova-scheduler-20.6.0-1.el7.noarch</span><br><span class="line">openstack-nova-compute-20.6.0-1.el7.noarch</span><br><span class="line">openstack-nova-novncproxy-20.6.0-1.el7.noarch</span><br><span class="line">openstack-nova-api-20.6.0-1.el7.noarch</span><br><span class="line">python2-novaclient-15.1.1-1.el7.noarch</span><br><span class="line">openstack-nova-common-20.6.0-1.el7.noarch</span><br><span class="line">openstack-nova-migration-20.6.0-1.el7.noarch</span><br><span class="line">python2-nova-20.6.0-1.el7.noarch</span><br><span class="line">openstack-nova-conductor-20.6.0-1.el7.noarch</span><br><span class="line">puppet-nova-15.8.1-1.el7.noarch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nova-api-20.6.0-1根据这个版本可以找到对应的版本，即t版</span><br><span class="line">https://releases.openstack.org/train/index.html</span><br><span class="line"></span><br><span class="line">Openstack不是虚拟化，0penstack只是系统的控制面，不包括系统的数据面组件，如Hypervisor、存储和网络设备等</span><br><span class="line">虚拟化是Openstack底层的技术实现手段之一，但并非核心关注点Openstack与虚拟化的关键区别:</span><br><span class="line"></span><br><span class="line">0penstack只是构建云计算的关键组件</span><br><span class="line">内核、骨干、框架、总线</span><br><span class="line"></span><br><span class="line">openstack只是一个内核，不能直接用于商业化，需要进行二次开发</span><br></pre></td></tr></table></figure>
<h3 id="组件"><a class="markdownIt-Anchor" href="#组件">#</a> 组件</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">horizon 提供图形页面dashboard</span><br><span class="line">nova 提供计算资源 controller + compute  controller目前独立存在</span><br><span class="line">Controller 提供各种api入口，如glance-api,nova-api  通过controller操作各种资源，需要安装mysql ntp MQ AD 通过zookeeper做集群，必须单数</span><br><span class="line">compute 装了kvm的主机，也可以是xen lxc esxi</span><br><span class="line">华为云需要3controller + 2 network + N compute</span><br><span class="line"></span><br><span class="line">glance 提供镜像服务</span><br><span class="line">swift 提供对象存储</span><br><span class="line">cender 提供块存储</span><br><span class="line">neutron 网络组件，可以提供二层网络功能，3层路由功能，dhcp等功能</span><br><span class="line">heat 编排服务</span><br><span class="line">ceilometer：计量服务，监控各个主机的资源使用情况，计费</span><br><span class="line">keystone 身份验证</span><br></pre></td></tr></table></figure>
<p>gpenstack, 各个组件去对接虚拟化平台，对接存储等，都需要开发驱动程序</p>
<p>当执行 openstack 标准指令，通过驱动将 penstack 指令转化为存储指令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">部署方式</span><br><span class="line">packstack</span><br><span class="line">devstack</span><br><span class="line">ansible</span><br><span class="line">开源方式部署</span><br><span class="line">Triple O openstack on openstack  通过heat自动化编排工具，填写参数完成</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">最佳部署:3台(一台 Controller+2台Compute 节点)CentOs8Stream，最少两台(一台Controller + 一台 Compute 节点)，Controller 节点内存最好 8G，最少 4G，Compute 节点4G 内存或者 8G硬盘 100G</span><br><span class="line">CPU 至少2core，最佳 4cores 。并且开启 VT-X每台主机两块网卡，其中第一块网卡需要能访问Internet，用来做管理网络和安装软件包</span><br><span class="line"></span><br><span class="line">controller 节点: NOVA-API, glance-api ,cinder-api等组件部署在该节点上，所有访问服务入口</span><br><span class="line">ntp</span><br><span class="line">database</span><br><span class="line">message queue</span><br><span class="line">keystone</span><br><span class="line"></span><br><span class="line">Zookeeper 必须单数，防止脑裂controller 节点至少三个节点768G 内存 HCS</span><br><span class="line"></span><br><span class="line">networking </span><br><span class="line">TYPE1:网络功能是由 neutron 提供，VLAN ROUTER DHCP 等，网络节点  （自服务网络 self-service）</span><br><span class="line">TYPE2: 硬件 SDN 控制器 </span><br><span class="line">TYPE3: Provider networks 网络功能是由底层硬件来实现的，比如 VLAN Router （provider network ）</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240317225954032.png" alt="image-20240317225954032"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br></pre></td><td class="code"><pre><span class="line"># 虚拟机规划</span><br><span class="line">192.168.13.20 controller </span><br><span class="line">192.168.13.21 compute01</span><br><span class="line">192.168.13.22 compute02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 配置ip</span><br><span class="line">[root@controller ~]#nmcli connection modify ens160 ipv4.addresses 192.168.13.20/24 ipv4.dns 8.8.8.8 ipv4.gateway 192.168.13.2 ipv4.method manual autoconnect yes </span><br><span class="line">[root@controller ~]#nmcli connection up ens160 </span><br><span class="line">[root@compute01 ~]#nmcli connection modify ens160 ipv4.addresses 192.168.13.21/24 ipv4.dns 8.8.8.8 ipv4.gateway 192.168.13.2 ipv4.method manual autoconnect yes </span><br><span class="line">[root@compute01 ~]#nmcli connection up ens160 </span><br><span class="line">[root@compute02 ~]#nmcli connection modify ens160 ipv4.addresses 192.168.13.22/24 ipv4.dns 8.8.8.8 ipv4.gateway 192.168.13.2 ipv4.method manual autoconnect yes </span><br><span class="line">[root@compute02 ~]#nmcli connection up ens160 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在所有机器上编辑/etc/hosts,增加如下配置，不要删除127.0.0.1</span><br><span class="line">192.168.13.20 controller </span><br><span class="line">192.168.13.21 compute01</span><br><span class="line">192.168.13.22 compute02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 设置计算机名</span><br><span class="line">[root@controller ~]# hostnamectl set-hostname controller </span><br><span class="line">[root@compute01 ~]# hostnamectl set-hostname compute01</span><br><span class="line">[root@compute02 ~]# hostnamectl set-hostname compute02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在所有节点上关闭selinux &amp;&amp; firewalld</span><br><span class="line">systemctl disable firewalld --now </span><br><span class="line">sed -ri &#x27;s#(SELINUX=)enforcing#1disabled#&#x27; /etc/selinux/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># keygen </span><br><span class="line">[root@controller ~]# ssh-keygen -t rsa </span><br><span class="line">[root@controller ~]# ssh-copy-id controller</span><br><span class="line">[root@controller ~]# ssh-copy-id compute01</span><br><span class="line">[root@controller ~]# ssh-copy-id compute02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># ntp</span><br><span class="line">dnf install chrony -y </span><br><span class="line">systemctl enable chronyd --now </span><br><span class="line"></span><br><span class="line">[root@controller ~]# vim /etc/chrony.conf</span><br><span class="line"># pool 2.centos.pool.ntp.org iburst</span><br><span class="line">allow 0.0.0.0/0</span><br><span class="line">local stratum 10</span><br><span class="line"></span><br><span class="line">systemctl restart chronyd</span><br><span class="line"></span><br><span class="line">[root@compute01 ~]# vim /etc/chrony.conf</span><br><span class="line">pool controller iburst</span><br><span class="line"></span><br><span class="line">[root@compute01 ~]# systemctl restart chronyd</span><br><span class="line"></span><br><span class="line">[root@compute02 ~]# vim /etc/chrony.conf</span><br><span class="line">pool controller iburst</span><br><span class="line"></span><br><span class="line">[root@compute01 ~]# systemctl restart chronyd</span><br><span class="line"></span><br><span class="line">chronyc -a makestep</span><br><span class="line">chronyc sources</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 开启安装源，在所有节点上执行，centos8可以直接yum install</span><br><span class="line">yum install centos-release-openstack-ussuri.noarch -y</span><br><span class="line">yum config-manager --set-enabled powertools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 在所有节点上执行</span><br><span class="line">yum upgrade</span><br><span class="line">reboot</span><br><span class="line">yum install python3-openstackclient</span><br><span class="line">yum install openstack-selinux -y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 控制节点安装数据库</span><br><span class="line">yum install mariadb mariadb-server python2-PyMySQL -y</span><br><span class="line">[root@controller my.cnf.d]# vim openstack.cnf</span><br><span class="line">[mysqld]</span><br><span class="line">bind-address = controller</span><br><span class="line">default-storage-engine = innodb</span><br><span class="line">innodb_file_per_table = on</span><br><span class="line">max_connections = 4096</span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line">character-set-server = utf8</span><br><span class="line"></span><br><span class="line">systemctl enable mariadb --now </span><br><span class="line"></span><br><span class="line">mysql_secure_installation</span><br><span class="line"> 全部为Y。密码此处为redhat</span><br><span class="line"> </span><br><span class="line">systemctl restart mariadb.service </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 控制节点安装消息队列</span><br><span class="line">yum install rabbitmq-server -y</span><br><span class="line">systemctl enable rabbitmq-server.service --now</span><br><span class="line">rabbitmqctl add_user openstack redhat</span><br><span class="line">rabbitmqctl set_permissions openstack &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class="line">tcp6       0      0 :::5672                 :::*                    LISTEN      5373/beam.smp  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 控制节点安装memcache，keystone缓存token</span><br><span class="line">The Identity service authentication mechanism for services uses Memcached to cache tokens.</span><br><span class="line">yum install memcached python3-memcached -y</span><br><span class="line">vim  /etc/sysconfig/memcached </span><br><span class="line">PORT=&quot;11211&quot;</span><br><span class="line">USER=&quot;memcached&quot;</span><br><span class="line">MAXCONN=&quot;1024&quot;</span><br><span class="line">CACHESIZE=&quot;64&quot;</span><br><span class="line">OPTIONS=&quot;-l 127.0.0.1,::1,controller&quot;</span><br><span class="line"></span><br><span class="line">systemctl enable memcached.service --now </span><br><span class="line">tcp        0      0 192.168.13.20:11211     0.0.0.0:*               LISTEN      7961/memcached     </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 控制节点安装etcd</span><br><span class="line">yum install etcd -y</span><br><span class="line">vim /etc/etcd/etcd.conf</span><br><span class="line">#[Member]</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;http://192.168.13.20:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;http://192.168.13.20:2379&quot;</span><br><span class="line">ETCD_NAME=&quot;controller&quot;</span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;http://192.168.13.20:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;http://192.168.13.20:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;controller=http://192.168.13.20:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster-01&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line"></span><br><span class="line">systemctl enable etcd --now </span><br><span class="line"></span><br><span class="line">tcp        0      0 192.168.13.20:2379      0.0.0.0:*               LISTEN      9441/etcd              </span><br><span class="line">tcp        0      0 192.168.13.20:2380      0.0.0.0:*               LISTEN      9441/etcd  </span><br><span class="line"></span><br><span class="line">https://docs.openstack.org/install-guide/environment-packages-rdo.html</span><br><span class="line">#######环境搭建完毕###### </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装keystone https://docs.openstack.org/keystone/ussuri/install/keystone-install-rdo.html</span><br><span class="line">mysql -uroot -predhat</span><br><span class="line">CREATE DATABASE keystone;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON keystone.* TO &#x27;keystone&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line"></span><br><span class="line">yum install openstack-keystone httpd python3-mod_wsgi -y</span><br><span class="line"></span><br><span class="line">vim /etc/keystone/keystone.conf</span><br><span class="line">[database]</span><br><span class="line">...</span><br><span class="line">connection = mysql+pymysql://keystone:redhat@controller/keystone</span><br><span class="line">...</span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c &quot;keystone-manage db_sync&quot; keystone</span><br><span class="line">keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line">keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line"></span><br><span class="line">keystone-manage bootstrap --bootstrap-password redhat \</span><br><span class="line">  --bootstrap-admin-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-internal-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-public-url http://controller:5000/v3/ \</span><br><span class="line">  --bootstrap-region-id RegionOne</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">ServerName controller</span><br><span class="line"></span><br><span class="line">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br><span class="line"></span><br><span class="line">systemctl enable httpd.service --now </span><br><span class="line"></span><br><span class="line">vim admin-openrc</span><br><span class="line">export OS_USERNAME=admin</span><br><span class="line">export OS_PASSWORD=redhat</span><br><span class="line">export OS_PROJECT_NAME=admin</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line"></span><br><span class="line">. admin-openrc</span><br><span class="line"></span><br><span class="line">openstack domain create --description &quot;An Example Domain&quot; example</span><br><span class="line"></span><br><span class="line">openstack project create --domain default \</span><br><span class="line">  --description &quot;Service Project&quot; service</span><br><span class="line">openstack project create --domain default \</span><br><span class="line">  --description &quot;Demo Project&quot; myproject</span><br><span class="line"> </span><br><span class="line"> openstack user create --domain default \</span><br><span class="line">  --password-prompt myuser</span><br><span class="line">  </span><br><span class="line">openstack role create myrole</span><br><span class="line">openstack role add --project myproject --user myuser myrole</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 安装glance   https://docs.openstack.org/glance/ussuri/install/install-rdo.html#prerequisites</span><br><span class="line">mysql -u root -predhat</span><br><span class="line">CREATE DATABASE glance;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON glance.* TO &#x27;glance&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">  </span><br><span class="line">. admin-openrc</span><br><span class="line">openstack user create --domain default --password-prompt glance		# 在openstack中创建用户glance</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">openstack role add --project service --user glance admin</span><br><span class="line"></span><br><span class="line">openstack service create --name glance \</span><br><span class="line">  --description &quot;OpenStack Image&quot; image</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http://controller:9292</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http://controller:9292</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http://controller:9292</span><br><span class="line">  </span><br><span class="line"> vim /etc/glance/glance-api.conf</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://glance:redhat@controller/glance</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri  = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = glance</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor = keystone</span><br><span class="line"></span><br><span class="line">[glance_store]</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 验证glance</span><br><span class="line">. admin-openrc</span><br><span class="line">wget http://download.cirros-cloud.net/0.4.0/cirros-0.4.0-x86_64-disk.img</span><br><span class="line"></span><br><span class="line">glance image-create --name &quot;cirros&quot; \</span><br><span class="line">  --file cirros-0.4.0-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --visibility=public</span><br><span class="line">  </span><br><span class="line">glance image-list</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| ID                                   | Name   |</span><br><span class="line">+--------------------------------------+--------+</span><br><span class="line">| e4c7903b-fc16-4d62-b60c-0e5ca211054e | cirros |</span><br><span class="line">+--------------------------------------+--------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"># 安装placement，在s版之前，placement集成在novaapi中，之后单独分离出来。</span><br><span class="line"># 当用户申请创建云主机时，会向nova api发送请求，NovaAPI会统计所有的compute节点资源剩余情况，决定哪个compute节点执行</span><br><span class="line"># https://docs.openstack.org/placement/ussuri/install/install-rdo.html</span><br><span class="line">mysql -u root -p </span><br><span class="line"> CREATE DATABASE placement;</span><br><span class="line"> GRANT ALL PRIVILEGES ON placement.* TO &#x27;placement&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line"> GRANT ALL PRIVILEGES ON placement.* TO &#x27;placement&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">. admin-openrc</span><br><span class="line">openstack user create --domain default --password-prompt placement</span><br><span class="line">openstack role add --project service --user placement admin</span><br><span class="line">openstack service create --name placement --description &quot;Placement API&quot; placement</span><br><span class="line">openstack endpoint create --region RegionOne placement public http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement internal http://controller:8778</span><br><span class="line">openstack endpoint create --region RegionOne placement admin http://controller:8778</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yum install openstack-placement-api</span><br><span class="line">vim /etc/placement/placement.conf</span><br><span class="line">[placement_database]</span><br><span class="line">connection = mysql+pymysql://placement:redhat@controller/placement</span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = placement</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c &quot;placement-manage db sync&quot; placement</span><br><span class="line"></span><br><span class="line">vim /etc/httpd/conf.d/00-placement-api.conf</span><br><span class="line">&lt;VirtualHost *:8778&gt;</span><br><span class="line">...</span><br><span class="line">  &lt;Directory /usr/bin&gt;</span><br><span class="line">    &lt;IfVersion &gt;= 2.4&gt;</span><br><span class="line">        Require all granted</span><br><span class="line">    &lt;/IfVersion&gt;</span><br><span class="line">    &lt;IfVersion &lt; 2.4&gt;</span><br><span class="line">        Order allow,deny</span><br><span class="line">        Allow from all</span><br><span class="line">    &lt;/IfVersion&gt;</span><br><span class="line">  &lt;/Directory&gt;</span><br><span class="line">&lt;/VirtualHost&gt;</span><br><span class="line"></span><br><span class="line">systemctl restart httpd</span><br><span class="line"></span><br><span class="line"># 检查</span><br><span class="line">placement-status upgrade check</span><br><span class="line">pip install osc-placement</span><br><span class="line">openstack --os-placement-api-version 1.2 resource class list --sort-column name</span><br><span class="line">openstack --os-placement-api-version 1.6 trait list --sort-column name</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br></pre></td><td class="code"><pre><span class="line"># nova</span><br><span class="line"># https://docs.openstack.org/nova/ussuri/install/</span><br><span class="line"># controller node</span><br><span class="line">mysql -u root -p</span><br><span class="line"></span><br><span class="line">CREATE DATABASE nova_api;</span><br><span class="line">CREATE DATABASE nova;</span><br><span class="line">CREATE DATABASE nova_cell0;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_api.* TO &#x27;nova&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova.* TO &#x27;nova&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line"></span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO &#x27;nova&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON nova_cell0.* TO &#x27;nova&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">  </span><br><span class="line">. admin-openrc</span><br><span class="line">openstack user create --domain default --password-prompt nova</span><br><span class="line">openstack role add --project service --user nova admin</span><br><span class="line"></span><br><span class="line">openstack service create --name nova \</span><br><span class="line">  --description &quot;OpenStack Compute&quot; compute</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute public http://controller:8774/v2.1</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute internal http://controller:8774/v2.1</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  compute admin http://controller:8774/v2.1</span><br><span class="line">  </span><br><span class="line">yum install openstack-nova-api openstack-nova-conductor \</span><br><span class="line">  openstack-nova-novncproxy openstack-nova-scheduler -y</span><br><span class="line">  </span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line"></span><br><span class="line">[api_database]</span><br><span class="line">connection = mysql+pymysql://nova:redhat@controller/nova_api</span><br><span class="line"></span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://nova:redhat@controller/nova</span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller:5672/</span><br><span class="line"></span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000/</span><br><span class="line">auth_url = http://controller:5000/</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line">[DEFAULT]</span><br><span class="line">my_ip = 192.168.13.20</span><br><span class="line"></span><br><span class="line">[vnc]</span><br><span class="line">enabled = true</span><br><span class="line">server_listen = $my_ip</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line"></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c &quot;nova-manage api_db sync&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 map_cell0&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 create_cell --name=cell1 --verbose&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage db sync&quot; nova</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 list_cells&quot; nova</span><br><span class="line"></span><br><span class="line">systemctl enable \</span><br><span class="line">    openstack-nova-api.service \</span><br><span class="line">    openstack-nova-scheduler.service \</span><br><span class="line">    openstack-nova-conductor.service \</span><br><span class="line">    openstack-nova-novncproxy.service \</span><br><span class="line">    --now</span><br><span class="line">    </span><br><span class="line"># compute node </span><br><span class="line">yum install openstack-nova-compute</span><br><span class="line"></span><br><span class="line"># 不同节点替换my_ip</span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">my_ip = 192.168.13.21</span><br><span class="line"></span><br><span class="line">[api]</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000/</span><br><span class="line">auth_url = http://controller:5000/</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = Default</span><br><span class="line">user_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line">[vnc]</span><br><span class="line">enabled = true</span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http://controller:6080/vnc_auto.html</span><br><span class="line"></span><br><span class="line">[glance]</span><br><span class="line">api_servers = http://controller:9292</span><br><span class="line"></span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/nova/tmp</span><br><span class="line"></span><br><span class="line">[placement]</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http://controller:5000/v3</span><br><span class="line">username = placement</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">egrep -c &#x27;(vmx|svm)&#x27; /proc/cpuinfo</span><br><span class="line"></span><br><span class="line">systemctl enable libvirtd.service openstack-nova-compute.service --now </span><br><span class="line"></span><br><span class="line"># controller node </span><br><span class="line">openstack compute service list --service nova-compute</span><br><span class="line">su -s /bin/sh -c &quot;nova-manage cell_v2 discover_hosts --verbose&quot; nova</span><br><span class="line"></span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[scheduler]</span><br><span class="line">discover_hosts_in_cells_interval = 300</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">openstack compute service list</span><br><span class="line">openstack catalog list</span><br><span class="line">nova-status upgrade check</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"># neutron</span><br><span class="line"></span><br><span class="line"># controller node 执行</span><br><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE neutron;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON neutron.* TO &#x27;neutron&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">  </span><br><span class="line">. admin-openrc</span><br><span class="line">openstack user create --domain default --password-prompt neutron</span><br><span class="line">openstack role add --project service --user neutron admin</span><br><span class="line">openstack service create --name neutron \</span><br><span class="line">  --description &quot;OpenStack Networking&quot; network</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network public http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network internal http://controller:9696</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  network admin http://controller:9696</span><br><span class="line">  </span><br><span class="line">yum install openstack-neutron openstack-neutron-ml2 \</span><br><span class="line">  openstack-neutron-linuxbridge ebtables</span><br><span class="line">  </span><br><span class="line">vim /etc/neutron/neutron.conf</span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://neutron:redhat@controller/neutron</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins = router</span><br><span class="line">allow_overlapping_ips = true</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = true</span><br><span class="line">notify_nova_on_port_data_changes = true</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = redhat</span><br><span class="line">[nova]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = redhat</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/plugins/ml2/ml2_conf.ini</span><br><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan,vxlan</span><br><span class="line">tenant_network_types = vxlan</span><br><span class="line">mechanism_drivers = linuxbridge,l2population</span><br><span class="line">extension_drivers = port_security</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[ml2_type_vxlan]</span><br><span class="line">vni_ranges = 1:1000</span><br><span class="line">[securitygroup]    </span><br><span class="line">enable_ipset = true</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens160</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = true</span><br><span class="line">local_ip = 192.168.13.20</span><br><span class="line">l2_population = true</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = true</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line">yum install bridge-utils			# 该命令所有节点上执行</span><br><span class="line">modprobe br_netfilter			# 该命令所有节点上执行</span><br><span class="line">echo br_netfilter &gt; /etc/modules-load.d/br_netfilter.conf			# 该命令所有节点上执行</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">sysctl -a | grep bridge				# 确保下面的为 1</span><br><span class="line">net.bridge.bridge-nf-call-arptables = 1</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/l3_agent.ini</span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/dhcp_agent.ini</span><br><span class="line">[DEFAULT]</span><br><span class="line">interface_driver = linuxbridge</span><br><span class="line">dhcp_driver = neutron.agent.linux.dhcp.Dnsmasq</span><br><span class="line">enable_isolated_metadata = true</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/metadata_agent.ini </span><br><span class="line">[DEFAULT]</span><br><span class="line">nova_metadata_host = controller</span><br><span class="line">metadata_proxy_shared_secret = redhat</span><br><span class="line"></span><br><span class="line">vim/etc/nova/nova.conf</span><br><span class="line">[neutron]</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = redhat</span><br><span class="line">service_metadata_proxy = true</span><br><span class="line">metadata_proxy_shared_secret = redhat</span><br><span class="line"></span><br><span class="line">ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br><span class="line">su -s /bin/sh -c &quot;neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head&quot; neutron</span><br><span class="line">  </span><br><span class="line">systemctl restart openstack-nova-api.service</span><br><span class="line">systemctl enable neutron-server.service \</span><br><span class="line">   neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">   neutron-metadata-agent.service \</span><br><span class="line">   --now</span><br><span class="line">   </span><br><span class="line">systemctl enable neutron-l3-agent.service --now </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># compute node</span><br><span class="line">yum install openstack-neutron-linuxbridge ebtables ipset</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/neutron.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = redhat</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/neutron/tmp</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini </span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens160</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = true</span><br><span class="line">local_ip = 192.168.13.21</span><br><span class="line">l2_population = true</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_security_group = true</span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br><span class="line"></span><br><span class="line">vim  /etc/nova/nova.conf</span><br><span class="line">[neutron]</span><br><span class="line"># ...</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = redhat</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-nova-compute.service</span><br><span class="line">systemctl enable neutron-linuxbridge-agent.service --now </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 验证</span><br><span class="line">. admin-openrc</span><br><span class="line">[root@controller ~]# openstack network agent list </span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line">| 1e065961-ca8a-4fef-8d0b-65cb8525108a | Metadata agent     | controller | None              | :-)   | UP    | neutron-metadata-agent    |</span><br><span class="line">| 3acf922b-2984-4d6a-aa2a-ed0ccba26c1c | Linux bridge agent | controller | None              | :-)   | UP    | neutron-linuxbridge-agent |</span><br><span class="line">| 63815950-35ab-4298-8726-bfc416e2fb35 | Linux bridge agent | compute02  | None              | :-)   | UP    | neutron-linuxbridge-agent |</span><br><span class="line">| 9ec3deda-192f-4a52-882f-9a468277beee | L3 agent           | controller | nova              | :-)   | UP    | neutron-l3-agent          |</span><br><span class="line">| d41fbf03-5391-43c9-bba4-02d2fdd959e5 | DHCP agent         | controller | nova              | :-)   | UP    | neutron-dhcp-agent        |</span><br><span class="line">| f4d841d6-ef98-4fca-8548-30975d7a6aff | Linux bridge agent | compute01  | None              | :-)   | UP    | neutron-linuxbridge-agent |</span><br><span class="line">+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># dashboard</span><br><span class="line">yum install openstack-dashboard</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENSTACK_HOST = &quot;controller&quot;</span><br><span class="line">ALLOWED_HOSTS = [&#x27;*&#x27;]</span><br><span class="line">SESSION_ENGINE = &#x27;django.contrib.sessions.backends.cache&#x27;</span><br><span class="line">CACHES = &#123;</span><br><span class="line">    &#x27;default&#x27;: &#123;</span><br><span class="line">         &#x27;BACKEND&#x27;: &#x27;django.core.cache.backends.memcached.MemcachedCache&#x27;,</span><br><span class="line">         &#x27;LOCATION&#x27;: &#x27;controller:11211&#x27;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = &quot;http://%s:5000/v3&quot; % OPENSTACK_HOST</span><br><span class="line">TIME_ZONE = &quot;Asia/Shanghai&quot;</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    &quot;identity&quot;: 3,</span><br><span class="line">    &quot;image&quot;: 2,</span><br><span class="line">    &quot;volume&quot;: 3,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = &quot;Default&quot;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = &quot;user&quot;</span><br><span class="line"></span><br><span class="line">vim /etc/httpd/conf.d/openstack-dashboard.conf</span><br><span class="line">WSGIApplicationGroup %&#123;GLOBAL&#125;</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service memcached.service</span><br><span class="line"></span><br><span class="line">vim /usr/share/openstack-dashboard/openstack_dashboard/defaults.py </span><br><span class="line">WEBROOT = &#x27;/dashboard&#x27;  # from openstack_auth</span><br><span class="line"></span><br><span class="line">vim /usr/share/openstack-dashboard/openstack_dashboard/test/settings.py </span><br><span class="line">WEBROOT = &#x27;/dashboard&#x27;</span><br><span class="line"></span><br><span class="line">systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cDovLzE5Mi4xNjguMTMuMjAvZGFzaGJvYXJk">http://192.168.13.20/dashboard</span></p>
<p>Default</p>
<p>admin</p>
<p>redhat</p>
<p>机器重启后无法登陆，重启服务 <code>systemctl restart httpd.service memcached.service</code></p>
<h3 id="发放云主机"><a class="markdownIt-Anchor" href="#发放云主机">#</a> 发放云主机</h3>
<p>开启配置后，可以支持多域</p>
<p>OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</p>
<h4 id="创建镜像"><a class="markdownIt-Anchor" href="#创建镜像">#</a> 创建镜像</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240330230051647.png" alt="image-20240330230051647"></p>
<p>创建虚拟机时，不能比创建镜像时指定的最小磁盘和最小内存小，否则虚拟机会发放失败</p>
<h4 id="创建实例类型"><a class="markdownIt-Anchor" href="#创建实例类型">#</a> 创建实例类型</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240330230640185.png" alt="image-20240330230640185"></p>
<h4 id="创建外部网络"><a class="markdownIt-Anchor" href="#创建外部网络">#</a> 创建外部网络</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240330232923961.png" alt="image-20240330232923961"></p>
<p>一般来说，宿主机会有两块网卡，一块用于管理网络，一块用于 node 之间通信和访问 Internet</p>
<p>只有通过 L3 Agent 才可以访问 Internet，L3Agent 只有 controller 上才有，compute 节点必须通过上图中 ens37 网络到 controller，才可以访问 Internet。此时网络节点可以称 vRouter</p>
<p>此时这种方式叫做集中式路由。每个 compute node 有自己的网络节点的时候称为分布式路由</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"># 添加一块桥接网卡</span><br><span class="line">nmcli device up ens224</span><br><span class="line">nmcli connection modify ens224 ipv4.address 192.168.1.100/24 ipv4.dns 8.8.8.8 ipv4.gateway 192.168.1.1 ipv4.method manual autoconnect yes</span><br><span class="line">nmcli connection up ens224</span><br><span class="line"></span><br><span class="line"># controller node </span><br><span class="line"># 配置第二块网卡提供业务网络</span><br><span class="line">vim /etc/neutron/plugins/ml2/ml2_conf.ini </span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line"></span><br><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini</span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens224</span><br><span class="line"></span><br><span class="line">systemctl restart neutron-server.service neutron-linuxbridge-agent.service</span><br><span class="line"></span><br><span class="line"># compute node </span><br><span class="line">vim /etc/neutron/plugins/ml2/linuxbridge_agent.ini </span><br><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:ens224</span><br><span class="line"></span><br><span class="line">systemctl restart neutron-linuxbridge-agent.service </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#######################</span><br><span class="line">ip a </span><br><span class="line">2: ens160: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:87:28:54 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    inet 192.168.13.20/24 brd 192.168.13.255 scope global noprefixroute ens160</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::20c:29ff:fe87:2854/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: ens224: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:87:28:5e brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp19s0</span><br><span class="line">    inet 192.168.1.100/24 brd 192.168.1.255 scope global noprefixroute ens224</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 2409:8a1e:3b41:f0f0:6dd3:d917:4cba:7b6/64 scope global dynamic noprefixroute </span><br><span class="line">       valid_lft 212884sec preferred_lft 126484sec</span><br><span class="line">    inet6 fe80::fe05:4ac6:73b8:b7d7/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">       </span><br><span class="line">此时ens224是业务网络，ens160是管理网络</span><br><span class="line">ens224也是上行链路</span><br><span class="line"></span><br><span class="line">[root@controller ~]# brctl show </span><br><span class="line">bridge name     bridge id               STP enabled     interfaces</span><br><span class="line">virbr0          8000.5254003bb141       yes</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">供应商网络类型</span><br><span class="line">local 只有本机能访问</span><br><span class="line">vlan 带标签的网络</span><br><span class="line">flat 不带标签的网络</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331135306896.png" alt="image-20240331135306896"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331135322478.png" alt="image-20240331135322478"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331135657000.png" alt="image-20240331135657000"></p>
<h4 id="创建用户和租户"><a class="markdownIt-Anchor" href="#创建用户和租户">#</a> 创建用户和租户</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331140213319.png" alt="image-20240331140213319"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331140310038.png" alt="image-20240331140310038"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331140854102.png" alt="image-20240331140854102"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331140953477.png" alt="image-20240331140953477"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331142451867.png" alt="image-20240331142451867"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331142502501.png" alt="image-20240331142502501"></p>
<h4 id="创建网络过程"><a class="markdownIt-Anchor" href="#创建网络过程">#</a> 创建网络过程</h4>
<p>管理员操作：创建网络 -&gt; 创建路由 禁用 dhcp</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331152924281.png" alt="image-20240331152924281"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331152951577.png" alt="image-20240331152951577"></p>
<p>切换至租户：创建网络，添加路由器接口</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331153033771.png" alt="image-20240331153033771"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404165722581.png" alt="image-20240404165722581"></p>
<p>最后的网络拓扑如下</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331152751856.png" alt="image-20240331152751856"></p>
<p>注意：管理员既有管理权限，也有项目权限。用户只有项目权限，所以创建路由不在一个地方</p>
<h4 id="创建安全组"><a class="markdownIt-Anchor" href="#创建安全组">#</a> 创建安全组</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331153439809.png" alt="image-20240331153439809"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331153452616.png" alt="image-20240331153452616"></p>
<h4 id="创建浮动ip"><a class="markdownIt-Anchor" href="#创建浮动ip">#</a> 创建浮动 ip</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331153620660.png" alt="image-20240331153620660"></p>
<h4 id="创建秘钥对"><a class="markdownIt-Anchor" href="#创建秘钥对">#</a> 创建秘钥对</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331154621290.png" alt="image-20240331154621290"></p>
<h4 id="创建实例"><a class="markdownIt-Anchor" href="#创建实例">#</a> 创建实例</h4>
<h4 id="绑定浮动ip"><a class="markdownIt-Anchor" href="#绑定浮动ip">#</a> 绑定浮动 IP</h4>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240331163643142.png" alt="image-20240331163643142"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 配置更新，my_ip 需要是controller的ip，不然会导致虚拟机无法调度。novncproxy_base_url需要是ip，因为本机没有配置hosts</span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">my_ip = 192.168.13.20</span><br><span class="line">[vnc]</span><br><span class="line">enabled = true</span><br><span class="line">server_listen = 0.0.0.0</span><br><span class="line">server_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http://192.168.13.20:6080/vnc_auto.html</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>如果没有 snat，需要购买 nat 网关，否则无法访问外网</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># 报错解决</span><br><span class="line">Failed to allocate the network(s), not rescheduling</span><br><span class="line">https://blog.51cto.com/royfans/5612693</span><br><span class="line">在nova的计算节点修改 /etc/nova/nova.conf</span><br><span class="line"></span><br><span class="line"># Determine if instance should boot or fail on VIF plugging timeout. For more</span><br><span class="line"># information, refer to the documentation. (boolean value)</span><br><span class="line">vif_plugging_is_fatal=false</span><br><span class="line"></span><br><span class="line"># Timeout for Neutron VIF plugging event message arrival. For more information,</span><br><span class="line"># refer to the documentation. (integer value)</span><br><span class="line"># Minimum value: 0</span><br><span class="line">vif_plugging_timeout=0</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-nova-compute.service </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Unknown auth type: None</span><br><span class="line">https://blog.51cto.com/molewan/1906366</span><br><span class="line">所有节点都编辑neutron.conf</span><br><span class="line">vim /etc/neutron/neutron.conf</span><br><span class="line">[DEFAULT]</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins = router</span><br><span class="line">allow_overlapping_ips = true</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = true</span><br><span class="line">notify_nova_on_port_data_changes = true</span><br><span class="line">rpc_backend = rabbit</span><br><span class="line"></span><br><span class="line">controller重启</span><br><span class="line">systemctl restart neutron-server.service </span><br><span class="line">compute重启</span><br><span class="line">systemctl restart neutron-linuxbridge-agent.service</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Load key &quot;C:\\key000.pem&quot;: bad permissions</span><br><span class="line">https://blog.csdn.net/weixin_37989267/article/details/126270640</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 测试</span><br><span class="line">ssh -i c:\key000.pem centos@192.168.1.230</span><br><span class="line"></span><br><span class="line">[centos@111 ~]$ ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (36.155.132.76) 56(84) bytes of data.</span><br><span class="line">64 bytes from 36.155.132.76 (36.155.132.76): icmp_seq=1 ttl=52 time=12.3 ms</span><br><span class="line">64 bytes from 36.155.132.76 (36.155.132.76): icmp_seq=2 ttl=52 time=12.8 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[centos@111 ~]$ ping 192.168.1.1</span><br><span class="line">PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=1 ttl=63 time=0.963 ms</span><br><span class="line">64 bytes from 192.168.1.1: icmp_seq=2 ttl=63 time=2.33 ms</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[centos@111 ~]$ ping 192.168.100.254</span><br><span class="line">PING 192.168.100.254 (192.168.100.254) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.100.254: icmp_seq=1 ttl=64 time=0.848 ms</span><br><span class="line">64 bytes from 192.168.100.254: icmp_seq=2 ttl=64 time=1.16 ms</span><br></pre></td></tr></table></figure>
<h3 id="命令行管理openstack"><a class="markdownIt-Anchor" href="#命令行管理openstack">#</a> 命令行管理 OpenStack</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"># 创建不同用户的环境变量</span><br><span class="line"></span><br><span class="line">vim user2-openrc</span><br><span class="line">export OS_USERNAME=user2</span><br><span class="line">export OS_PASSWORD=redhat</span><br><span class="line">export OS_PROJECT_NAME=edu</span><br><span class="line">export OS_USER_DOMAIN_NAME=Default</span><br><span class="line">export OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">export OS_AUTH_URL=http://controller:5000/v3</span><br><span class="line">export OS_IDENTITY_API_VERSION=3</span><br><span class="line">export PS1=&#x27;[\u@\h \W user2]#&#x27;</span><br><span class="line"></span><br><span class="line">[root@controller ~ user2]#source  user2-openrc </span><br><span class="line">[root@controller ~ user2]#openstack server list </span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line">| ID                                   | Name | Status | Networks                            | Image          | Flavor    |</span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line">| b389755c-c00a-494c-8df1-9fec65a2cadc | 111  | ACTIVE | VPC01=192.168.100.27, 192.168.1.230 | centos7-qcows2 | t.large.7 |</span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line"></span><br><span class="line">[root@controller ~ user2]#source  admin-openrc </span><br><span class="line">[root@controller ~]#openstack server list --all</span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line">| ID                                   | Name | Status | Networks                            | Image          | Flavor    |</span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line">| b389755c-c00a-494c-8df1-9fec65a2cadc | 111  | ACTIVE | VPC01=192.168.100.27, 192.168.1.230 | centos7-qcows2 | t.large.7 |</span><br><span class="line">+--------------------------------------+------+--------+-------------------------------------+----------------+-----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 列出云主机</span><br><span class="line">nova list </span><br><span class="line">openstack server list </span><br><span class="line"></span><br><span class="line"># 删除云主机</span><br><span class="line">openstack server delete 111</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 列出密钥对</span><br><span class="line">[root@controller ~ user2]#openstack keypair list </span><br><span class="line">+--------+-------------------------------------------------+</span><br><span class="line">| Name   | Fingerprint                                     |</span><br><span class="line">+--------+-------------------------------------------------+</span><br><span class="line">| key000 | 4b:5b:72:fa:ef:14:15:d4:ef:d3:3e:c9:70:9c:7c:8b |</span><br><span class="line">+--------+-------------------------------------------------+</span><br><span class="line">openstack keypair delete key000</span><br><span class="line"></span><br><span class="line"># 列出安全组</span><br><span class="line">[root@controller ~ user2]#openstack security group list </span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+------+</span><br><span class="line">| ID                                   | Name    | Description            | Project                          | Tags |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+------+</span><br><span class="line">| 46131584-5aa3-4ed5-b98a-555b0d0b361f | default | Default security group | e087871141144d04809921dc4695c91a | []   |</span><br><span class="line">| c042b0bc-e7c0-460a-9666-09ebe0b14871 | sec0    |                        | e087871141144d04809921dc4695c91a | []   |</span><br><span class="line">+--------------------------------------+---------+------------------------+----------------------------------+------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 列出浮动IP</span><br><span class="line">[root@controller ~ user2]#openstack floating ip list </span><br><span class="line">+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+</span><br><span class="line">| ID                                   | Floating IP Address | Fixed IP Address | Port                                 | Floating Network                     | Project                          |</span><br><span class="line">+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+</span><br><span class="line">| 5e0d6da9-4d2e-4958-9772-0fea529062c4 | 192.168.1.226       | None             | None                                 | 4c8c74c7-8764-45c3-a7be-4b4de94aca42 | e087871141144d04809921dc4695c91a |</span><br><span class="line">| 94ebf368-704b-4b68-8ea0-bf054cc356c0 | 192.168.1.230       | 192.168.100.27   | 80555d60-734e-404b-83a1-e7a002e8a019 | 4c8c74c7-8764-45c3-a7be-4b4de94aca42 | e087871141144d04809921dc4695c91a |</span><br><span class="line">+--------------------------------------+---------------------+------------------+--------------------------------------+--------------------------------------+----------------------------------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 列出路由器</span><br><span class="line">[root@controller ~ user2]#openstack route list </span><br><span class="line">+--------------------------------------+---------+--------+-------+----------------------------------+</span><br><span class="line">| ID                                   | Name    | Status | State | Project                          |</span><br><span class="line">+--------------------------------------+---------+--------+-------+----------------------------------+</span><br><span class="line">| e4867095-b421-4cf8-8f6d-e461fb6bc005 | router0 | ACTIVE | UP    | e087871141144d04809921dc4695c91a |</span><br><span class="line">+--------------------------------------+---------+--------+-------+----------------------------------+</span><br><span class="line"></span><br><span class="line"># 列出子网</span><br><span class="line">[root@controller ~ user2]#openstack subnet list </span><br><span class="line">+--------------------------------------+---------------+--------------------------------------+------------------+</span><br><span class="line">| ID                                   | Name          | Network                              | Subnet           |</span><br><span class="line">+--------------------------------------+---------------+--------------------------------------+------------------+</span><br><span class="line">| 0bfeeedd-40b8-4604-bd29-c64537e54095 | publicsubnet1 | 4c8c74c7-8764-45c3-a7be-4b4de94aca42 | 192.168.1.0/24   |</span><br><span class="line">| f601029d-74bf-4ccc-a03a-a2d42731a2ae | subnet01      | 1630bf29-e5d9-41e7-971b-32f84e1cc8cb | 192.168.100.0/24 |</span><br><span class="line">+--------------------------------------+---------------+--------------------------------------+------------------+</span><br><span class="line"></span><br><span class="line">[root@controller ~ user2]#source admin-openrc </span><br><span class="line">[root@controller ~]#openstack project list </span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| 1845901c8800478b81b1e80de5148cf3 | admin     |</span><br><span class="line">| 49bda9ea06794ea180ab0d45e714ac83 | myproject |</span><br><span class="line">| 955a68e6247048d3a9a7d99a0e6fc895 | service   |</span><br><span class="line">| e087871141144d04809921dc4695c91a | edu       |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line">[root@controller ~]#openstack user list </span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| ID                               | Name      |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line">| 7b028a214e104565b90648e521c9a490 | admin     |</span><br><span class="line">| ea4d56a09b484ccc81a363b95064b4d0 | glance    |</span><br><span class="line">| 262dea2a3392437d9ef45e534360049e | myuser    |</span><br><span class="line">| 077dc3eac993404586105cf3c88cfe0b | placement |</span><br><span class="line">| 8de7eefc14074d4a857ad184aa1f02ba | nova      |</span><br><span class="line">| 6f8e00c5f08b460c97bc30bbc4377531 | neutron   |</span><br><span class="line">| 8d86d72b27d74bf18b5a36be3fc6cb40 | user2     |</span><br><span class="line">+----------------------------------+-----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack flavor list </span><br><span class="line">+--------------------------------------+-----------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID                                   | Name      |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+--------------------------------------+-----------+------+------+-----------+-------+-----------+</span><br><span class="line">| 2d14e3c1-42e7-4f24-aeb6-79560d8effdb | t.small.1 |  512 |   10 |         0 |     1 | True      |</span><br><span class="line">| 3917bde7-c655-4892-a1e2-2a1af2be58c8 | t.large.7 | 1024 |   20 |         0 |     2 | True      |</span><br><span class="line">+--------------------------------------+-----------+------+------+-----------+-------+-----------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller ~]# openstack image list </span><br><span class="line">+--------------------------------------+----------------+--------+</span><br><span class="line">| ID                                   | Name           | Status |</span><br><span class="line">+--------------------------------------+----------------+--------+</span><br><span class="line">| 30bddbe2-25d1-4b87-86a2-6eaf5d03f9d7 | centos7-qcows2 | active |</span><br><span class="line">| e4c7903b-fc16-4d62-b60c-0e5ca211054e | cirros         | active |</span><br><span class="line">+--------------------------------------+----------------+--------+</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="查看日志信息"><a class="markdownIt-Anchor" href="#查看日志信息">#</a> 查看日志信息</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">ca /var/log/nova</span><br><span class="line">nova-api.log  nova-conductor.log  nova-manage.log  nova-novncproxy.log  nova-scheduler.log</span><br><span class="line"></span><br><span class="line">[root@controller nova]# cd ../neutron/</span><br><span class="line">[root@controller neutron]# ls </span><br><span class="line">dhcp-agent.log  l3-agent.log  linuxbridge-agent.log  metadata-agent.log  server.log</span><br><span class="line"></span><br><span class="line">如果想要更详细日志，需要开启debug级别日志</span><br><span class="line"></span><br><span class="line"># 每个节点修改</span><br><span class="line">vim nova.conf</span><br><span class="line">debug=true</span><br></pre></td></tr></table></figure>
<p>云主机在本地存储时，使用本地磁盘空间位置</p>
<p>/var/lib/nova/instance</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@compute01 instances]# ls</span><br><span class="line">431b7e00-6d33-48f6-9b2b-2241410bddea  _base  compute_nodes  locks</span><br><span class="line">[root@compute01 instances]# cd 431b7e00-6d33-48f6-9b2b-2241410bddea/</span><br><span class="line">[root@compute01 431b7e00-6d33-48f6-9b2b-2241410bddea]# ls </span><br><span class="line">console.log  disk  disk.info</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_base 是基础盘</span><br><span class="line">xxx-xxx-xxx-xxx-xxx 是差分盘</span><br></pre></td></tr></table></figure>
<p>开源 openstack 默认使用的是本地硬盘</p>
<h3 id="cinder"><a class="markdownIt-Anchor" href="#cinder">#</a> cinder</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404144243112.png" alt="image-20240404144243112" style="zoom:50%;" /> 
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404144425508.png" alt="image-20240404144425508" style="zoom:50%;" /> 
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404145645486.png" alt="image-20240404145645486" style="zoom:50%;" /> 
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404145940122.png" alt="image-20240404145940122" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"># 安装cinder</span><br><span class="line"># controller node </span><br><span class="line">mysql -u root -p</span><br><span class="line">CREATE DATABASE cinder;</span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO &#x27;cinder&#x27;@&#x27;localhost&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">GRANT ALL PRIVILEGES ON cinder.* TO &#x27;cinder&#x27;@&#x27;%&#x27; \</span><br><span class="line">  IDENTIFIED BY &#x27;redhat&#x27;;</span><br><span class="line">  </span><br><span class="line">openstack user create --domain default --password-prompt cinder</span><br><span class="line"></span><br><span class="line">openstack role add --project service --user cinder admin</span><br><span class="line"></span><br><span class="line">openstack service create --name cinderv2 \</span><br><span class="line">  --description &quot;OpenStack Block Storage&quot; volumev2</span><br><span class="line">openstack service create --name cinderv3 \</span><br><span class="line">  --description &quot;OpenStack Block Storage&quot; volumev3</span><br><span class="line">  </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 public http://controller:8776/v2/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 internal http://controller:8776/v2/%\(project_id\)s </span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 admin http://controller:8776/v2/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 public http://controller:8776/v3/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 internal http://controller:8776/v3/%\(project_id\)s</span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 admin http://controller:8776/v3/%\(project_id\)s</span><br><span class="line">  </span><br><span class="line">yum install openstack-cinder -y</span><br><span class="line"></span><br><span class="line">vim  /etc/cinder/cinder.conf </span><br><span class="line">[database]</span><br><span class="line">connection = mysql+pymysql://cinder:redhat@controller/cinder</span><br><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit://openstack:redhat@controller</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = 192.168.1.20</span><br><span class="line">[keystone_authtoken]</span><br><span class="line">www_authenticate_uri = http://controller:5000</span><br><span class="line">auth_url = http://controller:5000</span><br><span class="line">memcached_servers = controller:11211</span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = default</span><br><span class="line">user_domain_name = default</span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = redhat</span><br><span class="line">[oslo_concurrency]</span><br><span class="line">lock_path = /var/lib/cinder/tmp</span><br><span class="line"></span><br><span class="line">su -s /bin/sh -c &quot;cinder-manage db sync&quot; cinder</span><br><span class="line"></span><br><span class="line">vim /etc/nova/nova.conf</span><br><span class="line">[cinder]</span><br><span class="line">os_region_name = RegionOne</span><br><span class="line"></span><br><span class="line">systemctl restart openstack-nova-api.service</span><br><span class="line">systemctl enable openstack-cinder-api.service openstack-cinder-scheduler.service --now</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># storage node </span><br><span class="line">此处复用controller node ,在controller上增加一块磁盘</span><br><span class="line">yum install lvm2 device-mapper-persistent-data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@controller ~]# lsblk </span><br><span class="line">NAME        MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sr0          11:0    1   1G  0 rom  </span><br><span class="line">nvme0n1     259:0    0  40G  0 disk </span><br><span class="line">└─nvme0n1p1 259:1    0  40G  0 part /</span><br><span class="line">nvme0n2     259:2    0  80G  0 disk </span><br><span class="line"></span><br><span class="line">pvcreate /dev/nvme0n2</span><br><span class="line">vgcreate cinder-volumes /dev/nvme0n2</span><br><span class="line"></span><br><span class="line">yum install openstack-cinder targetcli python3-keystone -y</span><br><span class="line"></span><br><span class="line">vim /etc/cinder/cinder.conf</span><br><span class="line">[lvm]</span><br><span class="line">volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">volume_group = cinder-volumes</span><br><span class="line">target_protocol = iscsi</span><br><span class="line">target_helper = lioadm</span><br><span class="line">[DEFAULT]</span><br><span class="line">enabled_backends = lvm</span><br><span class="line">glance_api_servers = http://controller:9292</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">systemctl enable openstack-cinder-volume.service target.service --now</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 校验</span><br><span class="line">[root@controller ~]# . admin-openrc </span><br><span class="line">[root@controller ~]# openstack volume service list</span><br><span class="line">+------------------+----------------+------+---------+-------+----------------------------+</span><br><span class="line">| Binary           | Host           | Zone | Status  | State | Updated At                 |</span><br><span class="line">+------------------+----------------+------+---------+-------+----------------------------+</span><br><span class="line">| cinder-scheduler | controller     | nova | enabled | up    | 2024-04-04T09:35:37.000000 |</span><br><span class="line">| cinder-volume    | controller@lvm | nova | enabled | up    | 2024-04-04T09:35:46.000000 |</span><br><span class="line">+------------------+----------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404173920622.png" alt="image-20240404173920622" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# vgdisplay  -v cinder-volumes</span><br><span class="line">   </span><br><span class="line">  --- Logical volume ---</span><br><span class="line">  LV Path                /dev/cinder-volumes/volume-84b2b73b-bfad-4bfa-97e7-fc6be4eb10a9</span><br><span class="line">  LV Name                volume-84b2b73b-bfad-4bfa-97e7-fc6be4eb10a9</span><br><span class="line">  VG Name                cinder-volumes</span><br><span class="line">  LV UUID                Q2qgz8-UJdJ-QlWd-mLo9-N3CW-WP3P-oMqRXN</span><br><span class="line">  LV Write Access        read/write</span><br><span class="line">  LV Creation host, time controller, 2024-04-04 17:41:24 +0800</span><br><span class="line">  LV Pool name           cinder-volumes-pool</span><br><span class="line">  LV Status              available</span><br><span class="line">  # open                 0</span><br><span class="line">  LV Size                2.00 GiB</span><br><span class="line">  Mapped size            0.00%</span><br><span class="line">  Current LE             512</span><br><span class="line">  Segments               1</span><br><span class="line">  Allocation             inherit</span><br><span class="line">  Read ahead sectors     auto</span><br><span class="line">  - currently set to     8192</span><br><span class="line">  Block device           253:4</span><br></pre></td></tr></table></figure>
<h3 id="keystone"><a class="markdownIt-Anchor" href="#keystone">#</a> keystone</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240404232439884.png" alt="image-20240404232439884"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openstack user create user2</span><br><span class="line">openstack user set --password-prompt user2</span><br><span class="line">openstack project create Huawei</span><br><span class="line">openstack role add --user user2 --project huawei admin</span><br></pre></td></tr></table></figure>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240405141643113.png" alt="image-20240405141643113" style="zoom:50%;" /> 
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/openstack-dashboard/</span><br><span class="line">cinder_policy.json    keystone_policy.json  neutron_policy.json   nova_policy.json      </span><br><span class="line">glance_policy.json    local_settings        nova_policy.d/       </span><br><span class="line"></span><br><span class="line">cp glance_policy.json /etc/glance/policy.json </span><br><span class="line">chown </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dashborad 下的json 是模板文件，需要复制到对应的配置目录下修改并重启服务生效</span><br><span class="line"></span><br><span class="line">上传镜像的时候，默认不能上传为公有镜像，需要修改policy.json</span><br><span class="line"></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h3 id="glance"><a class="markdownIt-Anchor" href="#glance">#</a> glance</h3>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240406183941236.png" alt="image-20240406183941236" style="zoom:50%;" /> 
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240406185433747.png" alt="image-20240406185433747" style="zoom:50%;" /> 
<h4 id="制作镜像"><a class="markdownIt-Anchor" href="#制作镜像">#</a> 制作镜像</h4>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">安装kvm</span><br><span class="line"></span><br><span class="line">在kvm中安装需要的虚拟机</span><br><span class="line"></span><br><span class="line">创建虚拟机磁盘</span><br><span class="line">qemu-img create -f qcow2 /root/qq.qcow2 10G -o preallocation=metadata</span><br><span class="line"></span><br><span class="line">最小化安装</span><br><span class="line"></span><br><span class="line">安装cloud-init</span><br><span class="line">yum install https://archives.fedoraproject.org/pub/epel/8/Everything/x86_64/Packages/e/epel-release-8-19.el8.noarch.rpm</span><br><span class="line">yum install cloud-init -y</span><br><span class="line"></span><br><span class="line">systemctl enable cloud-init-local.service cloud-init.service cloud-config.service cloud-final.service</span><br><span class="line"></span><br><span class="line">vim /etc/sysconfig/network-scripts/ifcfg-ens160 </span><br><span class="line">获取方式dhcp</span><br><span class="line">删除uuid</span><br><span class="line"></span><br><span class="line">vim /etc/cloud/cloud.cfg</span><br><span class="line"></span><br><span class="line">https://support.huaweicloud.com/intl/zh-cn/bestpractice-ims/ims_bp_0024.html</span><br><span class="line"></span><br><span class="line">关闭开启的实例</span><br><span class="line"></span><br><span class="line">压缩虚拟机镜像,在宿主机上执行</span><br><span class="line">qemu-img convert -c -O qcow2 /root/qq.qcow2 /tmp/ww.qcow2</span><br></pre></td></tr></table></figure>
<p>注入</p>
<p>systemctl status neutron-metadata-agent.service<br>
systemctl status openstack-nova-metadata-api.service</p>
<h3 id="升级搭建dalmatian版-openstack"><a class="markdownIt-Anchor" href="#升级搭建dalmatian版-openstack">#</a> 升级，搭建 [Dalmatian] 版 openstack</h3>
<p>注意：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">大部分步骤按照官网来即可，但是neutron按照官网存在问题，这里按照u版配置neutron的方式配置，verify正常</span><br><span class="line"></span><br><span class="line">注意nova.conf 中配置的keystone的端口是 80 还是 5000，协议是http还是https</span><br><span class="line">否则会导致无法登陆或者无法发放主机</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">https://blog.csdn.net/qq_41158292/article/details/135750315</span><br></pre></td></tr></table></figure>
<h3 id="创建网络"><a class="markdownIt-Anchor" href="#创建网络">#</a> 创建网络</h3>
<p>1. 创建租户 edu，租户内存在用户 user2</p>
<p>2. 在 admin 空间内，管理员视图下，创建网络 public。这是共享的，外部网络，关闭 dchp</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240408232800085.png" alt="image-20240408232800085"></p>
<p>3. 在 admin 空间内，管理员视图下，创建路由，项目为 edu</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240408232905803.png" alt="image-20240408232905803"></p>
<p>4. 切换至 user2，在项目视图下，创建网络 vpc01，不共享，子网随意写，开启 dhcp</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240408233004196.png" alt="image-20240408233004196"></p>
<p>5，user2，在项目视图下，添加路由的 接口</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240408233049592.png" alt="image-20240408233049592"></p>
<p>6. 最终网络拓扑图如下</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240408233205646.png" alt="image-20240408233205646" style="zoom:50%;" /> 
<h3 id="nova"><a class="markdownIt-Anchor" href="#nova">#</a> nova</h3>
<p>虚拟机生命周期管理</p>
<p>其他计算资源生命周期管理</p>
<p>Nova 依赖 Keystone 认证服务</p>
<p>通过 Nova 模块创建计算实例，Nova 调用 Glance 模块提供的镜像服务</p>
<p>通过 Nova 模块创建的计算实例启动时，连接到的虚拟或物理网络由 Neutron 负责</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240422213122040.png" alt="image-20240422213122040"></p>
<p>最后一个服务已经没有了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# openstack compute service list </span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">| ID | Binary         | Host       | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  2 | nova-scheduler | controller | internal | enabled | up    | 2024-04-22T13:36:31.000000 |</span><br><span class="line">|  6 | nova-conductor | controller | internal | enabled | up    | 2024-04-22T13:36:37.000000 |</span><br><span class="line">| 10 | nova-compute   | compute01  | nova     | enabled | up    | 2024-04-22T13:36:39.000000 |</span><br><span class="line">| 11 | nova-compute   | compute02  | nova     | enabled | up    | 2024-04-22T13:36:40.000000 |</span><br><span class="line">+----+----------------+------------+----------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@controller ~]# systemctl status openstack-nova-novncproxy.service </span><br><span class="line">● openstack-nova-novncproxy.service - OpenStack Nova NoVNC Proxy Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/openstack-nova-novncproxy.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2024-04-08 22:13:09 CST; 1 weeks 6 days ago</span><br><span class="line">   </span><br><span class="line"> controller 不需要安装vnc客户端，novncproxy集成在浏览器中。</span><br><span class="line"> 链接的时候通过http://controller:6080 连接</span><br><span class="line"> </span><br><span class="line"> tcp        0      0 0.0.0.0:6080            0.0.0.0:*               LISTEN      20389/python3     </span><br><span class="line"> </span><br><span class="line"> 通过nonvcproxy访问到 compute上面 的5900 实现 vnc访问</span><br><span class="line"> </span><br><span class="line"> tcp        0      0 0.0.0.0:5900            0.0.0.0:*               LISTEN      4881/qemu-kvm </span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240422214400251.png" alt="image-20240422214400251"></p>
<p>nova-api</p>
<p>对外提供 rest 接口的处理</p>
<p>对传入的参数进行合法性校验和约束限制</p>
<p>对请求的资源进行配额 (quota) 的校验和预留</p>
<p>资源的创建，更新，删除查询等</p>
<p>虚拟机生命周期的入口</p>
<p>可水平扩展部署</p>
<p>nova-conductor</p>
<p>G 版本引进</p>
<p>数据库操作。解耦其他组件 (nova-compute) 数据库访问。</p>
<p>Nova 复杂流程控制，如创建，冷迁移，热迁移，虚拟机规格调整，虚拟机重建。</p>
<p>其他组件的依赖。如 nova-compute 需要依赖 nova-conductor 启动成功后才能启动成功。</p>
<p>其他组件的心跳定时写入。</p>
<p>可水平扩展</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240422215610585.png" alt="image-20240422215610585"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240422215737162.png" alt="image-20240422215737162"></p>
<p>服务内组件之间的消息全部通过 MQ 来进行转发，包括控制、查询、监控指标等。</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240422215843874.png" alt="image-20240422215843874" style="zoom:67%;" /> 
<p>无中心架构</p>
<p>各组件无本地持久化状态</p>
<p>可水平扩展</p>
<p>通常将 nova-api、nova-scheduler、nova-condyctor 组件合并部署在控制节点上</p>
<p>通过部署多个控制节点实现 HA 和负载均衡</p>
<p>通过增加控制节点和计算节点实现简单方便的系统扩容</p>
<p>nova-api-Cell  网格化管理，适用于大规模 nova 管理</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423213730132.png" alt="image-20240423213730132"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423213748648.png" alt="image-20240423213748648"></p>
<p>一个 az 中可以有多个 HA</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423213926394.png" alt="image-20240423213926394"></p>
<p>region 一个区域，代表一个数据中心</p>
<p>一个 region 下可以有多个 az，提高资源可用率</p>
<p>ZA 下可以有多个主机集合。一般会将同一配置的主机放入一个主机集合，方便热迁移</p>
<p>一个主机集合中可以有多个主机组</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423214535271.png" alt="image-20240423214535271"></p>
<p>主机组可以设置亲和性</p>
<p>创建主机集合</p>
<p>主机聚合只能在 admin 下创建</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423215618659.png" alt="image-20240423215618659"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423215709934.png" alt="image-20240423215709934"></p>
<p>Nova-Scheduler 功能</p>
<p>筛选和确定将虚拟机实例分配到哪一台物理机</p>
<p>分配过程主要分为两步过滤和权重</p>
<p>通过过滤器选择满足条件的计算节点</p>
<p>通过权重选择最优的节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nova list</span><br><span class="line">+--------------------------------------+-----------+--------+------------+-------------+-------------------------------------+</span><br><span class="line">| ID                                   | Name      | Status | Task State | Power State | Networks                            |</span><br><span class="line">+--------------------------------------+-----------+--------+------------+-------------+-------------------------------------+</span><br><span class="line">| 93da63d8-4f0b-4818-a01b-50c7af88c6dd | volume111 | ACTIVE | -          | Running     | VPC01=192.168.200.37, 192.168.1.197 |</span><br><span class="line">+--------------------------------------+-----------+--------+------------+-------------+-------------------------------------+</span><br></pre></td></tr></table></figure>
<p>vmstate: 数据库中记录的虚拟机状态 t</p>
<p>ask state: 当前虚拟机的任务状态，一般是中间态或者 None</p>
<p>powerstate: 从 hypervisor 获取的虚拟机的真实状志</p>
<p>Status: 对外呈现的虚拟机状态</p>
<p>状态之间的关系</p>
<p>系统内部！记求 ymstate 和 task state，power  state</p>
<p>status 星由 vmstate 和 task state 联合生成的</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423221612792.png" alt="image-20240423221612792"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423221628004.png" alt="image-20240423221628004"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240423221636417.png" alt="image-20240423221636417"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20240424225838328.png" alt="image-20240424225838328"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> openstack server list --all </span><br><span class="line">+--------------------------------------+-----------+--------+-------------------------------------+---------+-----------+</span><br><span class="line">| ID                                   | Name      | Status | Networks                            | Image   | Flavor    |</span><br><span class="line">+--------------------------------------+-----------+--------+-------------------------------------+---------+-----------+</span><br><span class="line">| 93da63d8-4f0b-4818-a01b-50c7af88c6dd | volume111 | ACTIVE | VPC01=192.168.200.37, 192.168.1.197 | centos7 | t.large.7 |</span><br><span class="line">+--------------------------------------+-----------+--------+-------------------------------------+---------+-----------+</span><br><span class="line">openstack server show 93da63d8-4f0b-4818-a01b-50c7af88c6dd</span><br><span class="line">+-------------------------------------+----------------------------------------------------------+</span><br><span class="line">| Field                               | Value                                                    |</span><br><span class="line">+-------------------------------------+----------------------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig                   | AUTO                                                     |</span><br><span class="line">| OS-EXT-AZ:availability_zone         | nova                                                     |</span><br><span class="line">| OS-EXT-SRV-ATTR:host                | compute02                                                |</span><br><span class="line">| OS-EXT-SRV-ATTR:hypervisor_hostname | compute02                                                |</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

      <div class="tags">
          <a href="/tags/%E8%BF%90%E7%BB%B4/" rel="tag"><i class="ic i-tag"></i> 运维</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2024-04-24 23:53:41" itemprop="dateModified" datetime="2024-04-24T23:53:41+08:00">2024-04-24</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="John Doe WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="John Doe Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="John Doe PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/" title="虚拟化">http://example.com/2024/01/25/虚拟化/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;df5603d07727270fb9df59cff26f0b9a.jpg" title="集群与存储">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> 运维</span>
  <h3>集群与存储</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/01/31/%E5%8F%B0%E7%90%83/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;c90c53e559eb45717ddb50f413599f87.jpg" title="台球入门教程">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>台球入门教程</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text"> 虚拟化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kvm"><span class="toc-number">1.1.</span> <span class="toc-text"> kvm</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96-2"><span class="toc-number">1.1.1.</span> <span class="toc-text"> 虚拟化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kvm-qemu-libvirtd"><span class="toc-number">1.1.2.</span> <span class="toc-text"> KVM &#x2F;QEMU &#x2F;LIBVIRTD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#virsh-%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.3.</span> <span class="toc-text"> virsh 命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.1.4.</span> <span class="toc-text"> 虚拟机磁盘管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%8B%E9%9A%86%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.1.5.</span> <span class="toc-text"> 克隆虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9%E7%A3%81%E7%9B%98"><span class="toc-number">1.1.6.</span> <span class="toc-text"> 扩容磁盘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openstack"><span class="toc-number">1.2.</span> <span class="toc-text"> OpenStack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#openstack-%E7%BB%84%E4%BB%B6"><span class="toc-number">1.2.1.</span> <span class="toc-text"> openstack 组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">1.2.2.</span> <span class="toc-text"> 部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86"><span class="toc-number">1.2.3.</span> <span class="toc-text"> 项目管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C"><span class="toc-number">1.2.4.</span> <span class="toc-text"> 网络</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#openstack-2"><span class="toc-number">1.3.</span> <span class="toc-text"> openstack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6"><span class="toc-number">1.3.1.</span> <span class="toc-text"> 组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E6%94%BE%E4%BA%91%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.3.2.</span> <span class="toc-text"> 发放云主机</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%95%9C%E5%83%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text"> 创建镜像</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.2.2.</span> <span class="toc-text"> 创建实例类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%A4%96%E9%83%A8%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.2.3.</span> <span class="toc-text"> 创建外部网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%92%8C%E7%A7%9F%E6%88%B7"><span class="toc-number">1.3.2.4.</span> <span class="toc-text"> 创建用户和租户</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.2.5.</span> <span class="toc-text"> 创建网络过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%89%E5%85%A8%E7%BB%84"><span class="toc-number">1.3.2.6.</span> <span class="toc-text"> 创建安全组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%AE%E5%8A%A8ip"><span class="toc-number">1.3.2.7.</span> <span class="toc-text"> 创建浮动 ip</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%A7%98%E9%92%A5%E5%AF%B9"><span class="toc-number">1.3.2.8.</span> <span class="toc-text"> 创建秘钥对</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.3.2.9.</span> <span class="toc-text"> 创建实例</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E6%B5%AE%E5%8A%A8ip"><span class="toc-number">1.3.2.10.</span> <span class="toc-text"> 绑定浮动 IP</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%AE%A1%E7%90%86openstack"><span class="toc-number">1.3.3.</span> <span class="toc-text"> 命令行管理 OpenStack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E4%BF%A1%E6%81%AF"><span class="toc-number">1.3.4.</span> <span class="toc-text"> 查看日志信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cinder"><span class="toc-number">1.3.5.</span> <span class="toc-text"> cinder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#keystone"><span class="toc-number">1.3.6.</span> <span class="toc-text"> keystone</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#glance"><span class="toc-number">1.3.7.</span> <span class="toc-text"> glance</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%B6%E4%BD%9C%E9%95%9C%E5%83%8F"><span class="toc-number">1.3.7.1.</span> <span class="toc-text"> 制作镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%87%E7%BA%A7%E6%90%AD%E5%BB%BAdalmatian%E7%89%88-openstack"><span class="toc-number">1.3.8.</span> <span class="toc-text"> 升级，搭建 [Dalmatian] 版 openstack</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BD%91%E7%BB%9C"><span class="toc-number">1.3.9.</span> <span class="toc-text"> 创建网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#nova"><span class="toc-number">1.3.10.</span> <span class="toc-text"> nova</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2022/11/27/CDN/" rel="bookmark" title="CDN&DNS">CDN&DNS</a></li><li><a href="/2023/04/03/iptables2/" rel="bookmark" title="iptables">iptables</a></li><li><a href="/2023/04/05/Docker/" rel="bookmark" title="docker">docker</a></li><li><a href="/2023/04/15/Nginx_new/" rel="bookmark" title="Nginx">Nginx</a></li><li><a href="/2023/05/20/Kubernetes/" rel="bookmark" title="Kubernetes">Kubernetes</a></li><li><a href="/2023/05/30/jenkins/" rel="bookmark" title="Jenkins">Jenkins</a></li><li><a href="/2023/06/02/k8s%E9%AB%98%E7%BA%A7/" rel="bookmark" title="k8s高级">k8s高级</a></li><li><a href="/2024/01/01/istio/" rel="bookmark" title="istio">istio</a></li><li><a href="/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/" rel="bookmark" title="集群与存储">集群与存储</a></li><li class="active"><a href="/2024/01/25/%E8%99%9A%E6%8B%9F%E5%8C%96/" rel="bookmark" title="虚拟化">虚拟化</a></li><li><a href="/2024/02/01/%E7%9B%91%E6%8E%A7/" rel="bookmark" title="监控">监控</a></li><li><a href="/2024/02/15/Elastic%20Stack/" rel="bookmark" title="Elastic stack">Elastic stack</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">46</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">6</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">6</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/01/10/%E9%9B%86%E7%BE%A4%E4%B8%8E%E5%AD%98%E5%82%A8/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/01/31/%E5%8F%B0%E7%90%83/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%80%86%E5%90%91/" title="In 逆向">逆向</a>
</div>

    <span><a href="/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/" title="水滴rev">水滴rev</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%86%85%E7%BD%91/" title="In 内网">内网</a>
</div>

    <span><a href="/2022/12/25/%E5%86%85%E7%BD%91/" title="内网渗透">内网渗透</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/07/15/%E4%B8%AD%E9%97%B4%E4%BB%B6%E6%BC%8F%E6%B4%9E/" title="中间件漏洞">中间件漏洞</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/08/16/Unserialize/" title="unserialize">unserialize</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%80%86%E5%90%91/" title="In 逆向">逆向</a>
</div>

    <span><a href="/2023/08/15/%E7%A0%B4%E8%A7%A3%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E4%B9%8B%E8%AE%A4%E8%AF%86%E5%A3%B3%E4%B8%8E%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%89%B9%E5%BE%81/" title="破解基础知识之认识壳与程序的特征">破解基础知识之认识壳与程序的特征</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/11/17/JWT%20%E5%9F%BA%E7%A1%80/" title="JWT">JWT</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E8%BF%90%E7%BB%B4/" title="In 运维">运维</a>
</div>

    <span><a href="/2023/06/02/k8s%E9%AB%98%E7%BA%A7/" title="k8s高级">k8s高级</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/05/17/include/" title="file include">file include</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/04/16/Upload/" title="File upload">File upload</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%80%86%E5%90%91/" title="In 逆向">逆向</a>
</div>

    <span><a href="/2023/10/03/hg%20ker/" title="hg内核">hg内核</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/01/25/虚拟化/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>

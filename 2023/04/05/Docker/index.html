



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  

<link rel="canonical" href="http://example.com/2023/04/05/Docker/">



  <title>
Docker |
Yume Shoka = Hexo</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">Docker
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2023-04-05 13:38:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2023-04-05T13:38:45+08:00">2023-04-05</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclhfehz7j20zk0m8u0x.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giciusoyjnj219g0u0x56.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclfdu6exj20zk0m87hw.jpg"></li>
          <li class="item" data-background-image="https://tva4.sinaimg.cn/large/6833939bly1giclhtuo6nj20zk0m8ttm.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/05/Docker/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="docker"><a class="markdownIt-Anchor" href="#docker">#</a> Docker</h1>
<p><span class="exturl" data-url="aHR0cDovL3d3dy5kb2NrZXIuY29t">www.docker.com</span></p>
<p><span class="exturl" data-url="aHR0cDovL2h1Yi5kb2NrZXIuY29t">hub.docker.com</span></p>
<p>虚拟机缺点：</p>
<p>1. 资源占有多</p>
<p>2. 冗余步骤多</p>
<p>3. 启动慢</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230328205458587.png" alt="image-20230328205458587"></p>
<p>容器化技术：不是完整的操作系统，只保留了最核心的部分。直接运行在操作系统之上。容器之间相互隔离</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230328203952292.png" alt="image-20230328203952292"></p>
<p>传统虚拟机：虚拟出一套硬件，运行一套完整的操作系统，再运行软件</p>
<p>容器内的应用直接运行在宿主机的内核，是没有自己内核的，也没有虚拟硬件，所以轻便。每个容器相互隔离，都有属于自己的文件系统</p>
<p>更高效的资源应用</p>
<p>更见的系统运维</p>
<p>更便捷的升级和扩缩容</p>
<p>应用更快速的交付和部署</p>
<h2 id="docker安装"><a class="markdownIt-Anchor" href="#docker安装">#</a> docker 安装</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230328205612777.png" alt="image-20230328205612777"></p>
<p><code>镜像</code> ：image 类似于模板，可以通过模板创建容器服务。镜像 run 之后就是一个容器，用于提供服务。通过这个镜像可以创建多个容器，项目运行就是在容器中</p>
<p><code>容器</code> ：container docker 利用容器，独立运行一个或者一组应用，通过镜像来创建 ，可以启动，删除，停止等。可以把容器理解为一个简易的 linux 系统</p>
<p><code>仓库</code> ：repository 存放镜像的地方。分为共有和私有仓库，比如 docker hub。国内需要配置镜像加速，利用阿里云容器服务器或者其他</p>
<p>环境：centos7 + 华为云 + xshell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# uname -r</span><br><span class="line">3.10.0-1160.53.1.el7.x86_64</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>1. 卸载旧版本</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                 docker-client \</span><br><span class="line">                 docker-client-latest \</span><br><span class="line">                 docker-common \</span><br><span class="line">                 docker-latest \</span><br><span class="line">                 docker-latest-logrotate \</span><br><span class="line">                 docker-logrotate \</span><br><span class="line">                 docker-engine</span><br></pre></td></tr></table></figure>
<p><strong>2. 安装基本环境</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install -y yum-utils</span><br></pre></td></tr></table></figure>
<p><strong>3. 设置镜像仓库</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更新软件包索引</span><br><span class="line">yum makecache fast</span><br></pre></td></tr></table></figure>
<p><strong>4. 安装 docker 相关内容</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br></pre></td></tr></table></figure>
<p><strong>5. 启动 docker</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br><span class="line">docker version</span><br></pre></td></tr></table></figure>
<p><strong>6. 测试 docker 安装是否成功</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure>
<p><strong>7. 查看 hello-world 镜像</strong></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>
<p><strong>8. 卸载 docker</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">卸载依赖</span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin docker-ce-rootless-extras</span><br><span class="line">删除资源，也就是docker的默认工作路径</span><br><span class="line">sudo rm -rf /var/lib/docker</span><br><span class="line">sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>
<h2 id="镜像加速"><a class="markdownIt-Anchor" href="#镜像加速">#</a> 镜像加速</h2>
<p><span class="exturl" data-url="aHR0cDovL2NyLmNvbnNvbGUuYWxpeXVuLmNvbQ==">cr.console.aliyun.com</span></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">您可以通过修改daemon配置文件/etc/docker/daemon.json来使用加速器</span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://fn5y0qpk.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure>
<h2 id="docker-run之后发生了什么"><a class="markdownIt-Anchor" href="#docker-run之后发生了什么">#</a> docker run 之后发生了什么</h2>
<p><strong>1. 本机寻找镜像</strong></p>
<p><strong>2.1 本机有镜像，使用镜像运行</strong></p>
<p><strong>2.2 去 dockerhub 上下载</strong></p>
<p><strong>3.1 dockerhub 找不到镜像 - 返回错误</strong></p>
<p><strong>3.2dockerhub 找到镜像，下载到本地</strong></p>
<p><strong>4. 运行</strong></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230329195956959.png" alt="image-20230329195956959"></p>
<p>docker 是一个 cs 结构的系统，docker 的守护进程运行在主机上。通过 socket 从客户端访问</p>
<p>docker server 接收到 client 指定，就会执行这个命令</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230329200521395.png" alt="image-20230329200521395"></p>
<p>docker 有着比虚拟机更少的抽象层</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230329200736029.png" alt="image-20230329200736029"></p>
<p>docker 用的是宿主机的内核，vm 需要 guest os</p>
<p>docker 不需要重新加载操作系统内核，避免引导。</p>
<h2 id="docker命令"><a class="markdownIt-Anchor" href="#docker命令">#</a> docker 命令</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version/info    # 版本信息，系统信息</span><br><span class="line">docker --help          # 帮助命令</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="镜像命令"><a class="markdownIt-Anchor" href="#镜像命令">#</a> 镜像命令</h3>
<p><code>docker images   # 查看所有镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker images </span><br><span class="line">REPOSITORY                TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">loadbalancejsp_lbsnode1   latest    8d19a7525948   3 months ago    240MB</span><br><span class="line">loadbalancejsp_lbsnode2   latest    8d19a7525948   3 months ago    240MB</span><br><span class="line">tomcat                    8-jre8    f0e282263192   3 months ago    240MB</span><br><span class="line"></span><br><span class="line">仓库源                     标签       镜像ID          创建时间         镜像大小</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-a 显示全部镜像</span><br><span class="line"></span><br><span class="line">-q 只显示镜像ID</span><br></pre></td></tr></table></figure>
<p><code>docker search  # 搜索镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker search mysql</span><br><span class="line">NAME                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                           MySQL is a widely used, open-source relation…   13988     [OK]       </span><br><span class="line">mariadb                         MariaDB Server is a high performing open sou…   5333      [OK]       </span><br><span class="line">percona                         Percona Server is a fork of the MySQL relati…   602       [OK]       </span><br><span class="line"></span><br><span class="line">docker search mysql --filter=STARS=9000   STARS&gt;9000</span><br></pre></td></tr></table></figure>
<p><code>docker pull   #下载镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker pull mysql</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">72a69066d2fe: Pull complete   # 分层下载</span><br><span class="line">93619dbc5b36: Pull complete </span><br><span class="line">99da31dd6142: Pull complete </span><br><span class="line">626033c43d70: Pull complete </span><br><span class="line">37d5d7efb64e: Pull complete </span><br><span class="line">ac563158d721: Pull complete </span><br><span class="line">d2ba16033dad: Pull complete </span><br><span class="line">688ba7d5c01a: Pull complete </span><br><span class="line">00e060b6d11d: Pull complete </span><br><span class="line">1c04857f594f: Pull complete </span><br><span class="line">4d7cfa90e6ea: Pull complete </span><br><span class="line">e0431212d27d: Pull complete </span><br><span class="line">Digest: sha256:e9027fe4d91c0153429607251656806cc784e914937271037f7738bd5b8e7709</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  # 真实地址</span><br><span class="line"></span><br><span class="line">==</span><br><span class="line">docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line">分层可以实现层的共用</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">72a69066d2fe: Already exists </span><br><span class="line">93619dbc5b36: Already exists </span><br><span class="line">99da31dd6142: Already exists </span><br><span class="line">626033c43d70: Already exists </span><br><span class="line">37d5d7efb64e: Already exists </span><br><span class="line">ac563158d721: Already exists </span><br><span class="line">d2ba16033dad: Already exists </span><br><span class="line">0ceb82207cd7: Pull complete </span><br><span class="line">37f2405cae96: Pull complete </span><br><span class="line">e2482e017e53: Pull complete </span><br><span class="line">70deed891d42: Pull complete </span><br><span class="line">Digest: sha256:f2ad209efe9c67104167fc609cca6973c8422939491c9345270175a300419f94</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>docker rmi    # 删除镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker rmi c20</span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:f2ad209efe9c67104167fc609cca6973c8422939491c9345270175a300419f94</span><br><span class="line">Deleted: sha256:c20987f18b130f9d144c9828df630417e2a9523148930dc3963e9d0dab302a76</span><br><span class="line">Deleted: sha256:6567396b065ee734fb2dbb80c8923324a778426dfd01969f091f1ab2d52c7989</span><br><span class="line">Deleted: sha256:0910f12649d514b471f1583a16f672ab67e3d29d9833a15dc2df50dd5536e40f</span><br><span class="line">Deleted: sha256:6682af2fb40555c448b84711c7302d0f86fc716bbe9c7dc7dbd739ef9d757150</span><br><span class="line">Deleted: sha256:5c062c3ac20f576d24454e74781511a5f96739f289edaadf2de934d06e910b92</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker rmi c20 321  # 删除多个镜像</span><br><span class="line"></span><br><span class="line">#docker删除全部容器</span><br><span class="line">[root@hecs-346515 ~]# docker rmi -f $(docker images -qa)</span><br></pre></td></tr></table></figure>
<h3 id="容器命令"><a class="markdownIt-Anchor" href="#容器命令">#</a> 容器命令</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker pull centos</span><br></pre></td></tr></table></figure>
<p><strong>新建容器并启动</strong></p>
<p><code>docker run</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 参数说明</span><br><span class="line">--name=&quot;Name&quot;   容器名字，用于区分容器</span><br><span class="line">-d   以后台运行</span><br><span class="line">-it  使用交互方式运行，进入容器查看内容</span><br><span class="line">-p   指定容器端口 -p 8080:8080</span><br><span class="line">	-p ip:主机端口:容器端口</span><br><span class="line">	-p 主机端口:容器端口</span><br><span class="line">	-p 容器端口</span><br><span class="line">	容器端口</span><br><span class="line">-P   随机指定端口</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker run -it centos /bin/bash   # 启动并进入容器</span><br><span class="line">[root@3505a169c989 /]# exit</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>列出所有运行的容器</strong></p>
<p><code>docker ps -a</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker ps -a </span><br><span class="line">CONTAINER ID   IMAGE                     COMMAND                  CREATED         STATUS                          PORTS     NAMES</span><br><span class="line">3505a169c989   centos                    &quot;/bin/bash&quot;              2 minutes ago   Exited (0) About a minute ago             lucid_hypatia</span><br><span class="line">efe24d96f682   hello-world               &quot;/hello&quot;                 23 hours ago    Exited (0) 23 hours ago                   goofy_lichterman</span><br><span class="line">85c7b4c3d350   nginx:1.17                &quot;nginx -g &#x27;daemon of…&quot;   3 months ago    Exited (1) 3 months ago                   loadbalancejsp_nginx_1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-a 列出历史容器和当前运行的容器</span><br><span class="line">-n=?  显示最近创建的容器个数</span><br><span class="line">-q  只显示容器编号</span><br><span class="line"></span><br><span class="line">docker ps -qa</span><br></pre></td></tr></table></figure>
<p><strong>退出容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit  停止并退出</span><br><span class="line">ctrl + q + p  容器不停止退出</span><br></pre></td></tr></table></figure>
<p><strong>删除容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm id</span><br><span class="line">docker rm -f $(docker ps -aq)   # 删除所有容器</span><br><span class="line">docker ps -aq | xargs docker rm  # 删除所有容器</span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker start id</span><br><span class="line">docker restart id</span><br><span class="line">docker stop id</span><br><span class="line">docker kill id</span><br></pre></td></tr></table></figure>
<p><strong>后台启动容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d centos</span><br><span class="line"></span><br><span class="line">启动完之后因为没有前台进程，容器发现没有应用，自动停止</span><br></pre></td></tr></table></figure>
<p><strong>查看日志</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker logs</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker logs -f -t 741  </span><br><span class="line">[root@hecs-346515 ~]# docker logs -f -t --tail 10  741</span><br></pre></td></tr></table></figure>
<p><strong>查看容器中的进程信息</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker top 741</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                8024                8006                0                   14:05               ?                   00:00:00            nginx: master process nginx -g daemon off;</span><br><span class="line">101                 8075                8024                0                   14:05               ?                   00:00:00            nginx: worker process</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>查看镜像元数据</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]<span class="comment"># docker inspect 741</span></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;741038301edd946e2f2e193803d8e29aa31897212a310730c85f8b8194dbf45f&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2023-03-30T06:05:28.540089191Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;/docker-entrypoint.sh&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">            <span class="string">&quot;-g&quot;</span>,</span><br><span class="line">            <span class="string">&quot;daemon off;&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 8024,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2023-03-30T06:05:28.79217804Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;Image&quot;</span>: <span class="string">&quot;sha256:605c77e624ddb75e6110f997c58876baa13f8754486b461117934b24a9dc3a85&quot;</span>,</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>进入当前运行容器</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 ~]# docker exec -it 741 /bin/bash</span><br><span class="line">root@741038301edd:/# </span><br><span class="line"># 进入容器后开启新终端</span><br><span class="line">-i：以交互模式运行容器</span><br><span class="line">-t：为容器重新分配一个伪输入终端</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker attach 8cf</span><br><span class="line">[root@8cf0c194eae8 /]# </span><br><span class="line"># 进入容器正在执行的终端，不会启动新的进程</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>容器内拷贝文件到主机上</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker cp id:/root/ /home</span><br><span class="line">docker cp id:/容器目录  /本机目录</span><br><span class="line">docker 容器内命令</span><br><span class="line"></span><br><span class="line">-v 卷可以实现自动同步</span><br></pre></td></tr></table></figure>
<h2 id="使用docker"><a class="markdownIt-Anchor" href="#使用docker">#</a> 使用 docker</h2>
<h3 id="安装nginx"><a class="markdownIt-Anchor" href="#安装nginx">#</a> 安装 nginx</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker search nginx</span><br><span class="line">docker pull nginx </span><br><span class="line">docker run -d --name=nginx01 -p 8991:80 nginx</span><br><span class="line">curl 121.37.191.89:8991</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">whereis nginx 找到nginx</span><br></pre></td></tr></table></figure>
<h3 id="安装tomcat"><a class="markdownIt-Anchor" href="#安装tomcat">#</a> 安装 tomcat</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --rm  tomcat /bin/bash   # rm用完就删，一般用于测试</span><br><span class="line"></span><br><span class="line">docker run -d -p 8877:8080 --name=tomcat01 tomcat</span><br><span class="line">docker exec -it tomcat01 /bin/bash</span><br></pre></td></tr></table></figure>
<h3 id="安装eskibana"><a class="markdownIt-Anchor" href="#安装eskibana">#</a> 安装 es+kibana</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name es -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker stats   # 查看cpu状态</span><br><span class="line"></span><br><span class="line">docker run -d --name es2 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch </span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230330195235840.png" alt="image-20230330195235840"></p>
<h2 id="可视化"><a class="markdownIt-Anchor" href="#可视化">#</a> 可视化</h2>
<p><strong>portainer</strong></p>
<p><strong>Rancher</strong></p>
<p>portainer docker 图形化界面管理工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331202120533.png" alt="image-20230331202120533"></p>
<p>选择 local</p>
<h2 id="联合文件系统"><a class="markdownIt-Anchor" href="#联合文件系统">#</a> 联合文件系统</h2>
<p>UnionFS</p>
<p>UnionFS (联合文件系统）:Union 文件系统 (UnionFS) 是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来壬层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下 (unite several directories into a single virtualfilesystem)。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p>特性∶一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录</p>
<p>bootfs (boot file system) 主要包含 bootloader 和 kernel, bootloader 主要是引导加载 kernel, Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像的最底层 bootfs。这一层与我们典型的 LinuxlUnix 系统是一样的，包含 boot 加载器和内核。当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p>
<p>roots (root fle system)，在 boots 之上。包含的就是典型 Linux 系统中的 /dev, /proc, /bin, letc 等标准目录和文件。rootfs 就是各种不同的操作系统发行版，比如 Ubuntu，centos 等等。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331203141142.png" alt="image-20230331203141142"></p>
<p>对于一个精简的 OS , rootfs 可以很小，只需要包含最基本的命令，工具和程序库就可以了，因为底层直接用 Host 的 kernel , 自己只需要提供 rootfs 就可以了。由此可见对于不同的 linux 发行版，bootfs 基本是一致的，rootfs 会有差别，因此不同的发行版可以公用<br>
 bootfs。</p>
<h2 id="分层原理"><a class="markdownIt-Anchor" href="#分层原理">#</a> 分层原理</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:6515074984c6f8bb1b8a9962c8fb5f310fc85e70b04c88442a3939c026dbfad3&quot;,</span><br><span class="line">                &quot;sha256:4f169ae5a253d68d25f3f5fdd0deb31af20096bcffdec1fdda5cf8810d507d1f&quot;,</span><br><span class="line">                &quot;sha256:edae32ac2ac2a7f24eebb4b62ad2fa0a9434f47f4b56a3739106e1da4cb1aa6a&quot;,</span><br><span class="line">                &quot;sha256:f05805c5815d0394d09d3b64e3a58727f8d647f2c5a4d1fbb5e40ed5f8424e84&quot;,</span><br><span class="line">                &quot;sha256:460c946f1b353b51ebb7548ea8f8127118d9bdc7be5f8f2c3c4e73fc9968d705&quot;,</span><br><span class="line">                &quot;sha256:3241d073343d5c09cb9854032919de8fe88433c2867fac073a61ed5669e8cae8&quot;,</span><br><span class="line">                &quot;sha256:f5c79923df4c5c22157139e199d0143e8af29ac0f11f73fd4a56759c1f080c05&quot;,</span><br><span class="line">                &quot;sha256:a5d2135a0fbf3b167b687e40028e54e271588a2ece546bcdcf8da5751c4ba828&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331203518152.png" alt="image-20230331203518152"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含 3 个文件，而镜像包含了来自两个镜像层的 6 个文件。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331203612551.png" alt="image-20230331203612551"></p>
<p>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有 6 个文件，这是因为最上层中的文件 7 是文件 5 的一个更新版本。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331203723498.png" alt="image-20230331203723498"></p>
<p>这种情况下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中。Docker 通过存储引擎 (新版本采用快照机制) 的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统。</p>
<p>Linux 上可用的存储引擎有 AUFS、Overlay2、Device Mapper、Btrfs 以及 ZFS。顾名思义，每种存储引擎都基于 Linux 中对应的文件系统或者块设备技术，并且每种存储引擎都有其独有的性能特点。</p>
<p>Docker 在 Windows 上仅支持 windowsfilter 一种存储引擎，该引擎基于 NTFS 文件系统之上实现了分层和 CoW [1]。下图展示了与系统显示相同的三层镜像。所有镜像层堆叠并合并，对外提供统一的视图。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331203816012.png" alt="image-20230331203816012"></p>
<p>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<h2 id="commit"><a class="markdownIt-Anchor" href="#commit">#</a> commit</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker commit # 提交容器称为新的副本</span><br><span class="line">docker commit -m=&quot;descriptor&quot; -a=&quot;author&quot; id  name:tag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">docker run -it -p 8898:8080 tomcat</span><br><span class="line">docker exec -it ffcc /bin/bash</span><br><span class="line"></span><br><span class="line">docker commit -a=&quot;shabi&quot; -m=&quot;webapp/&quot; ffccc tomcatshabi:1.22</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331205200662.png" alt="image-20230331205200662"></p>
<p>通过 commit 提交后，在原始 tomcat 上面又增加了一层，所以文件会稍微变大一些</p>
<h2 id="容器数据卷"><a class="markdownIt-Anchor" href="#容器数据卷">#</a> 容器数据卷</h2>
<p>如果数据都在容器中，容器删除数据就会丢失，不能持久化</p>
<p>容器之间需要一个数据共享技术。docker 容器中产生的数据同步到本地，防止数据丢失</p>
<p>其实就是目录挂载。将我们容器内的目录，挂载到虚拟机上</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230331210323928.png" alt="image-20230331210323928"></p>
<p>容器间数据也是可以共享的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v 主机目录:容器目录 -p 8767:8080</span><br><span class="line"></span><br><span class="line">docker run -it -v  /home/testing:/home -p 8767:8080 tomcat /bin/bash</span><br><span class="line"></span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/testing&quot;,    //主机地址</span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,       //docker内地址</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>同步不受容器停止影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -v  /usr/local/nginx/conf/nginx.conf:/usr/local/nginx/conf/nginx.conf -p 80:80 nginx /bin/bash</span><br></pre></td></tr></table></figure>
<p>以后只需要本地修改即可，容器自动同步</p>
<p>安装 mysql，并挂载数据卷</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v /home/mysql_conf:/etc/mysql/conf.d/ -v /home/mysql_data:/var/lib/mysql  -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --name=mysql002  mysql</span><br><span class="line"></span><br><span class="line">mysql -uroot -p123456 -h121.37.191.89 -p3307</span><br></pre></td></tr></table></figure>
<p>删除容器也不会丢失数据，但会占用两倍内存</p>
<p>这就实现了容器持久化功能</p>
<p><strong>具名挂载、匿名挂载</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径 </span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 查看卷的情况</span><br><span class="line">[root@hecs-346515 ~]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     879266c77b0964e9bca1b3a1f6cf4d6089eb18d9b9c9e549d0c41357f6dc5a35</span><br><span class="line">local     dirtycow-vdso</span><br><span class="line">local     ee9d314e1c5f3010b8d64108293246853c90d3d820c20332c338ed9bdd3f168b</span><br><span class="line">local     f3924de885d11729faa0c5869488fd0aefca9e3f6bcaddc36c9ce95f4e891603</span><br><span class="line">local     fd3d617a1c288349a4717e3a73e63dbbcf900c51f2d69fe30f9fa726ac82a08d</span><br><span class="line">没有名称的就是匿名挂载</span><br><span class="line"></span><br><span class="line"># 具名挂载</span><br><span class="line">docker run -d -P --name nginx01 -v juming_nginx:/etc/nginx nginx</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker volume inspect juming_nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2023-04-02T21:42:24+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming_nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming_nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"># 所有docker内的卷，没有指定目录的情况下都在/var/lib/docker/volumes/</span><br><span class="line"></span><br><span class="line">我们通过具名挂载可以方便的找到一个卷</span><br></pre></td></tr></table></figure>
<p>如何区分指定路径和匿名挂载</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径   匿名</span><br><span class="line">-v 卷名:容器内路径 具名</span><br><span class="line">-v /usr/local:/etc/nginx/ 路径</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-v 容器内路径:rw/ro 改变读写权限</span><br><span class="line">docker run -d -P --name nginx01 -v juming_nginx:/etc/nginx:ro nginx</span><br><span class="line">readonly readwrite</span><br><span class="line"></span><br><span class="line">一旦设置了容器容器权限，对我们挂载出来的内容有限定</span><br><span class="line">默认是rw，ro说明只能通过宿主机操作，容器内部无法操作</span><br></pre></td></tr></table></figure>
<h2 id="dockerfile挂载"><a class="markdownIt-Anchor" href="#dockerfile挂载">#</a> Dockerfile 挂载</h2>
<p>dockerfile 就是用来构建 docker 镜像的文件</p>
<p>镜像是一层层的，命令也是一层层的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;voume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo &quot;---------------&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 docker-test]# docker build -f ./dockerfile1 -t hahaha .</span><br><span class="line">[+] Building 0.1s (5/5) FINISHED                                                                 </span><br><span class="line"> =&gt; [internal] load build definition from dockerfile1                                       0.1s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 123B                                                        0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                           0.1s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                             0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:latest                            0.0s</span><br><span class="line"> =&gt; [1/1] FROM docker.io/library/centos                                                     0.0s</span><br><span class="line"> =&gt; exporting to image                                                                      0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                     0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:29755edf1ce7d5c71c2c7cbbf8b0bd54f02ce72a4ebcaccdfd857aa0dcb99e  0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/hahaha                                                   0.0s</span><br><span class="line"></span><br><span class="line"># 这里的每个命令都是镜像的一层</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 docker-test]# docker run -it hahaha /bin/bash </span><br><span class="line">[root@74ee4cc3e927 /]# ls </span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var	   voume01</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr  volume02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;eb0e7a226b19aa2e8811eabaf339cf3cee05f3fec433af62212607e0010bda2e&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/eb0e7a226b19aa2e8811eabaf339cf3cee05f3fec433af62212607e0010bda2e/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;8b52d9050ada34758bacfe403a63a5b6a06e0c96cadb86830fa16aa9533a6fc8&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/8b52d9050ada34758bacfe403a63a5b6a06e0c96cadb86830fa16aa9533a6fc8/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;voume01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>构建镜像的时候没有挂载均，需要手动 - v 挂载</p>
<h2 id="数据卷容器"><a class="markdownIt-Anchor" href="#数据卷容器">#</a> 数据卷容器</h2>
<p>实现容器之间同步数据</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230402220831342.png" alt="image-20230402220831342"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --name docker01 hahaha </span><br><span class="line"></span><br><span class="line">docker run -it --name docker02 --volumes-from docker01 hahaha</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>父容器删除，其他容器的文件依然在</p>
<p>所有父容器和子容器都挂载在宿主机的文件中，如果宿主机挂载目录没了，三个容器都没了</p>
<p>数据卷的声明周期一直到没有容器使用位置</p>
<h2 id="dockerfile"><a class="markdownIt-Anchor" href="#dockerfile">#</a> Dockerfile</h2>
<p>dockerfile 是用来构建 dockerfile 的镜像文件，命令参数脚本</p>
<p>1. 编写 dockerfile</p>
<p>2.docker build 构建成为镜像</p>
<p>3.docker run 运行镜像</p>
<p>4.docker push 发布镜像</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230402224507380.png" alt="image-20230402224507380"></p>
<p>每个关键字都是大写字母</p>
<p>执行从上到下</p>
<p>#表示注释</p>
<p>每一个指令都会创建一个新的镜像层，并提交</p>
<p>发布项目都要发布 dockerfile</p>
<p>dockerfile 构建文件，定义了一切的步骤，源代码</p>
<p>dockerimages 通过 dockerfile 生成的镜像，最终发布和运行的版本</p>
<p>docker 容器：容器就是镜像运行起来提供服务</p>
<h3 id="dockerfile指令"><a class="markdownIt-Anchor" href="#dockerfile指令">#</a> dockerfile 指令</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM     	# 基础镜像</span><br><span class="line">MAINTAINER 	# 维护者信息</span><br><span class="line">RUN 		# 镜像构建的时候需要运行的命令</span><br><span class="line">ADD 		# 步骤：如果搭建tomcat，压缩包就需要add</span><br><span class="line">WORKDIR 	# 镜像工作目录</span><br><span class="line">volume		# 设置容器卷，挂载到那个位置</span><br><span class="line">EXPOSE		# 指定暴露端口</span><br><span class="line">CMD			# 指定容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line">ENTRYPOINT	# 指定容器启动的时候要运行的命令，可以追加命令</span><br><span class="line">ONBUILD		# 当构建一个被继承Dockerfile，这个时候就会运行ONBUILD指令</span><br><span class="line">CPOY		# 将文件拷贝到景象中</span><br><span class="line">ENV			# 构建的时候设置环境变量</span><br></pre></td></tr></table></figure>
<p>dockerhub 中大部分镜像都是从 FROM scratch 来的，然后配置需要的软件和配置来进行构建</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建一个centos</span></span><br><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> shabi&lt;<span class="number">21111</span>@qq.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y vim</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y net-tools</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> <span class="built_in">echo</span> <span class="variable">$MYPATH</span></span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建镜像</span></span><br><span class="line">docker build -f dockerfile -t centoshaha:<span class="number">0.5</span> . </span><br><span class="line"></span><br><span class="line">[root@hecs-<span class="number">346515</span> dockerfile]<span class="comment"># docker build -f dockerfile -t centoshaha:0.5 . </span></span><br><span class="line">[+] Building <span class="number">199.4</span>s (<span class="number">5</span>/<span class="number">7</span>)                                                                                             </span><br><span class="line">[+] Building <span class="number">200.1</span>s (<span class="number">5</span>/<span class="number">7</span>)                                                                                             </span><br><span class="line">[+] Building <span class="number">200.6</span>s (<span class="number">5</span>/<span class="number">7</span>)                                                                                             </span><br><span class="line">[+] Building <span class="number">200.9</span>s (<span class="number">5</span>/<span class="number">7</span>)                                                                                             </span><br><span class="line">[+] Building <span class="number">228.0</span>s (<span class="number">8</span>/<span class="number">8</span>) FINISHED                                                                                    </span><br><span class="line"> =&gt; [internal] load build definition <span class="keyword">from</span> dockerfile                                                             <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: <span class="number">219</span>B                                                                             <span class="number">0.0</span>s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; transferring context: <span class="number">2</span>B                                                                                  <span class="number">0.0</span>s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:<span class="number">7</span>                                                     <span class="number">16.0</span>s</span><br><span class="line"> =&gt; [<span class="number">1</span>/<span class="number">4</span>] <span class="keyword">FROM</span> docker.io/library/centos:<span class="number">7</span>@sha256:<span class="number">9</span>d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0  <span class="number">50.2</span>s</span><br><span class="line"> =&gt; =&gt; resolve docker.io/library/centos:<span class="number">7</span>@sha256:<span class="number">9</span>d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e09  <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; sha256:<span class="number">9</span>d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987 <span class="number">1.20</span>kB / <span class="number">1.20</span>kB                   <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; sha256:dead07b4d8ed7e29e98de0f4504d87e8880d4347859d839686a31da35a3b532f <span class="number">529</span>B / <span class="number">529</span>B                       <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; sha256:eeb6ee3f44bd0b5103bb561b4c16bcb82328cfe5809ab675bb17ab3a16c517c9 <span class="number">2.75</span>kB / <span class="number">2.75</span>kB                   <span class="number">0.0</span>s</span><br><span class="line"> =&gt; =&gt; sha256:<span class="number">2</span>d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc <span class="number">76.10</span>MB / <span class="number">76.10</span>MB                <span class="number">46.3</span>s</span><br><span class="line"> =&gt; =&gt; extracting sha256:<span class="number">2</span>d473b07cdd5f0912cd6f1a703352c82b512407db6b05b43f2553732b55df3bc                        <span class="number">3.6</span>s</span><br><span class="line"> =&gt; [<span class="number">2</span>/<span class="number">4</span>] <span class="keyword">WORKDIR</span><span class="language-bash"> /usr/local                                                                                     0.0s</span></span><br><span class="line"> =&gt; [<span class="number">3</span>/<span class="number">4</span>] <span class="keyword">RUN</span><span class="language-bash"> yum install -y vim                                                                               156.1s</span></span><br><span class="line"> =&gt; [<span class="number">4</span>/<span class="number">4</span>] <span class="keyword">RUN</span><span class="language-bash"> yum install -y net-tools                                                                           2.9s</span></span><br><span class="line"> =&gt; exporting to image                                                                                           <span class="number">2.7</span>s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                          <span class="number">2.7</span>s </span><br><span class="line"> =&gt; =&gt; writing image sha256:<span class="number">1</span>c525b4438024495ebbbf1f19a3e3ea730826dfcab5cb8337ea0fa0a0de853ad                     <span class="number">0.0</span>s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/centoshaha:<span class="number">0.5</span>    </span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404110343127.png" alt="image-20230404110343127"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 dockerfile]# docker history 1c5</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">1c525b443802   4 minutes ago   CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin/bash&quot;]                0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;echo $MYPATH&quot;]             0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   EXPOSE map[80/tcp:&#123;&#125;]                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   RUN /bin/sh -c yum install -y net-tools # bu…   176MB     buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      4 minutes ago   RUN /bin/sh -c yum install -y vim # buildkit    259MB     buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      7 minutes ago   WORKDIR /usr/local                              0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      7 minutes ago   ENV MYPATH=/usr/local                           0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      7 minutes ago   MAINTAINER shabi&lt;21111@qq.com&gt;                  0B        buildkit.dockerfile.v0</span><br><span class="line">&lt;missing&gt;      18 months ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      18 months ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      18 months ago   /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB     </span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker history 5d0</span><br><span class="line">IMAGE          CREATED         CREATED BY                                      SIZE      COMMENT</span><br><span class="line">5d0da3dc9764   18 months ago   /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B        </span><br><span class="line">&lt;missing&gt;      18 months ago   /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B        </span><br><span class="line">&lt;missing&gt;      18 months ago   /bin/sh -c #(nop) ADD file:805cb5e15fb6e0bb0…   231MB     </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">FROM centos:7</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker build -f cmd  -t cmd:0.5 . </span><br><span class="line">[+] Building 0.3s (5/5) FINISHED                                                                                      </span><br><span class="line"> =&gt; [internal] load build definition from cmd                                                                    0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 60B                                                                              0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:7                                                      0.2s</span><br><span class="line"> =&gt; CACHED [1/1] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426  0.0s</span><br><span class="line"> =&gt; exporting to image                                                                                           0.0s</span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                          0.0s</span><br><span class="line"> =&gt; =&gt; writing image sha256:3ced42c5b7de1bbe7659ef7bd2349ebf83eb13eab6d1afe69f029ef65a88f9ab                     0.0s</span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/cmd:0.5                                                                       0.0s</span><br><span class="line">[root@hecs-346515 dockerfile]# docker run -it cmd:0.5 </span><br><span class="line">.   .dockerenv	       bin  etc   lib	 media	opt   root  sbin  sys  usr</span><br><span class="line">..  anaconda-post.log  dev  home  lib64  mnt	proc  run   srv   tmp  var</span><br><span class="line"></span><br><span class="line">CMD			# 指定容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span><br><span class="line"></span><br><span class="line">docker run 3e -l    # -l不是命令所以报错</span><br><span class="line"></span><br><span class="line">docker run 3e ls -al  ls -al 替换了ls -a</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">vim entry</span><br><span class="line">FROM centos:7</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker run entry:0.5</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">anaconda-post.log</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker run entry:0.5 -l</span><br><span class="line">total 64</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr  4 03:18 .</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr  4 03:18 ..</span><br><span class="line">-rwxr-xr-x   1 root root     0 Apr  4 03:18 .dockerenv</span><br><span class="line">-rw-r--r--   1 root root 12114 Nov 13  2020 anaconda-post.log</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root   340 Apr  4 03:18 dev</span><br><span class="line">drwxr-xr-x   1 root root  4096 Apr  4 03:18 etc</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 home</span><br><span class="line">lrwxrwxrwx   1 root root     7 Nov 13  2020 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root     9 Nov 13  2020 lib64 -&gt; usr/lib64</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 media</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 mnt</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 opt</span><br><span class="line">dr-xr-xr-x 134 root root     0 Apr  4 03:18 proc</span><br><span class="line">dr-xr-x---   2 root root  4096 Nov 13  2020 root</span><br><span class="line">drwxr-xr-x  11 root root  4096 Nov 13  2020 run</span><br><span class="line">lrwxrwxrwx   1 root root     8 Nov 13  2020 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root  4096 Apr 11  2018 srv</span><br><span class="line">dr-xr-xr-x  13 root root     0 Apr  4 03:18 sys</span><br><span class="line">drwxrwxrwt   7 root root  4096 Nov 13  2020 tmp</span><br><span class="line">drwxr-xr-x  13 root root  4096 Nov 13  2020 usr</span><br><span class="line">drwxr-xr-x  18 root root  4096 Nov 13  2020 var</span><br><span class="line"></span><br><span class="line">ENTRYPOINT	# 指定容器启动的时候要运行的命令，可以追加命令</span><br></pre></td></tr></table></figure>
<blockquote>
<p>entrypoint 是追加，CMD 是覆盖</p>
</blockquote>
<h3 id="制作tomcat镜像"><a class="markdownIt-Anchor" href="#制作tomcat镜像">#</a> 制作 tomcat 镜像</h3>
<p>1、准备安装包</p>
<p>2、Dockerfile 是官方命名，构建时会自动寻找，就不需要 - f 指定了</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"><span class="keyword">MAINTAINER</span> shshshs&lt;<span class="number">110</span>@<span class="number">110</span>.com&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> readme.txt /usr/local/readme.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> apache-tomcat-10.1.7.tar.gz  /usr/local/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash"> jdk-20_linux-x64_bin.tar.gz  /usr/local/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> yum install -y vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> MYPATH /usr/local/</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$MYPATH</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/jdk-<span class="number">20</span></span><br><span class="line"><span class="keyword">ENV</span> CLASS_PATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line"><span class="keyword">ENV</span> CATALINA_HOME /usr/local/apache-tomcat-<span class="number">10.1</span>.<span class="number">7</span>/</span><br><span class="line"><span class="keyword">ENV</span> CATALINA_BASE /usr/local/apache-tomcat-<span class="number">10.1</span>.<span class="number">7</span>/</span><br><span class="line"><span class="keyword">ENV</span> PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> /usr/local/apache-tomcat-10.1.7/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/apache-tomcat-10.1.7/logs/catalina.out</span></span><br></pre></td></tr></table></figure>
<p>3. 构建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 dockerfile]# docker build -t ddcat:1.0 .</span><br><span class="line">[+] Building 61.4s (11/11) FINISHED                                                                                   </span><br><span class="line"> =&gt; [internal] load build definition from Dockerfile                                                             0.0s</span><br><span class="line"> =&gt; =&gt; transferring dockerfile: 690B                                                                             0.0s</span><br><span class="line"> =&gt; [internal] load .dockerignore                                                                                0.0s</span><br><span class="line"> =&gt; =&gt; transferring context: 2B                                                                                  0.0s</span><br><span class="line"> =&gt; [internal] load metadata for docker.io/library/centos:7                                                     15.3s</span><br><span class="line"> =&gt; CACHED [1/6] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426  0.0s</span><br><span class="line"> =&gt; [internal] load build context                                                                                2.3s</span><br><span class="line"> =&gt; =&gt; transferring context: 203.75MB                                                                            2.3s</span><br><span class="line"> =&gt; [2/6] COPY readme.txt /usr/local/readme.txt                                                                  0.5s</span><br><span class="line"> =&gt; [3/6] ADD apache-tomcat-10.1.7.tar.gz  /usr/local/                                                           0.4s</span><br><span class="line"> =&gt; [4/6] ADD jdk-20_linux-x64_bin.tar.gz  /usr/local/                                                           4.6s</span><br><span class="line"> =&gt; [5/6] RUN yum install -y vim                                                                                34.4s</span><br><span class="line"> =&gt; [6/6] WORKDIR /usr/local/                                                                                    0.0s </span><br><span class="line"> =&gt; exporting to image                                                                                           3.8s </span><br><span class="line"> =&gt; =&gt; exporting layers                                                                                          3.8s </span><br><span class="line"> =&gt; =&gt; writing image sha256:620e725ff485b1cae36720ea191ba0692cc5f2a857e516528e5b65653e752913                     0.0s </span><br><span class="line"> =&gt; =&gt; naming to docker.io/library/ddcat:1.0                                                                     0.0s </span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">4.启动镜像</span><br><span class="line">[root@hecs-346515 dockerfile]# docker run -d -p 8877:8080 --name=catcatcat -v /root/dockerfile/build/tomcat/test:/usr/local/apache-tomcat-10.1.7/webapps/test -v /root/dockerfile/build/tomcat/logs:/usr/local/apache-tomcat-10.1.7/logs ddcat:1.1</span><br><span class="line">4357a9cda1d960125ac7d4ab052902ec04848c0dbbce3beb26bccf4eaff84fa4</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5、访问测试</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404124622232.png" alt="image-20230404124622232"></p>
<p>6. 发布项目</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">version</span>=<span class="string">&quot;2.4&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/j2ee </span></span></span><br><span class="line"><span class="string"><span class="tag">        http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span>                                   </span><br></pre></td></tr></table></figure>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;%--    &lt;meta charset=<span class="string">&quot;UTF-8&quot;</span>&gt;--%&gt;</span><br><span class="line">&lt;%--    &lt;meta http-equiv=<span class="string">&quot;X-UA-Compatible&quot;</span> content=<span class="string">&quot;IE=edge&quot;</span>&gt;--%&gt;</span><br><span class="line">&lt;%--    &lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;--%&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/bootstrap.min.css&quot;</span>&gt;</span><br><span class="line">    &lt;link rel=<span class="string">&quot;stylesheet&quot;</span> href=<span class="string">&quot;css/bootstrap.min.css.map&quot;</span>&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/jquery-3.5.1.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;js/bootstrap.min.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">        $(function () &#123;</span><br><span class="line">            $.ajax(&#123;</span><br><span class="line">                url: <span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/type?method=findAllType&quot;</span>,</span><br><span class="line">                type: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">                dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">                success: function (data) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i in data) &#123;</span><br><span class="line">                        <span class="type">var</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;&lt;li&gt;&lt;a href=&#x27;$&#123;pageContext.request.contextPath&#125;/product?method=show&amp;tid=&quot;</span> + data[i].tid + <span class="string">&quot;&#x27;&gt;&quot;</span> + data[i].tname + <span class="string">&quot;&lt;/a&gt;&lt;/li&gt;&quot;</span>;</span><br><span class="line">                        $(<span class="string">&quot;#goodsType&quot;</span>).append(a);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                error: function () &#123;</span><br><span class="line">                    alert(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;nav class=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span><br><span class="line">        &lt;div class=<span class="string">&quot;container-fluid&quot;</span>&gt;</span><br><span class="line">            &lt;!-- Brand and toggle get grouped <span class="keyword">for</span> better mobile display --&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;navbar-header&quot;</span>&gt;</span><br><span class="line">                &lt;button type=<span class="string">&quot;button&quot;</span> class=<span class="string">&quot;navbar-toggle collapsed&quot;</span> data-toggle=<span class="string">&quot;collapse&quot;</span></span><br><span class="line">                        data-target=<span class="string">&quot;#bs-example-navbar-collapse-1&quot;</span> aria-expanded=<span class="string">&quot;false&quot;</span>&gt;</span><br><span class="line">                    &lt;span class=<span class="string">&quot;sr-only&quot;</span>&gt;Toggle navigation&lt;/span&gt;</span><br><span class="line">                    &lt;span class=<span class="string">&quot;icon-bar&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;span class=<span class="string">&quot;icon-bar&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">                    &lt;span class=<span class="string">&quot;icon-bar&quot;</span>&gt;&lt;/span&gt;</span><br><span class="line">                &lt;/button&gt;</span><br><span class="line">                &lt;a class=<span class="string">&quot;navbar-brand&quot;</span> href=<span class="string">&quot;#&quot;</span>&gt;myShop商城&lt;/a&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">            &lt;!-- Collect the nav links, forms, and other content <span class="keyword">for</span> toggling --&gt;</span><br><span class="line">            &lt;div class=<span class="string">&quot;collapse navbar-collapse&quot;</span> id=<span class="string">&quot;bs-example-navbar-collapse-1&quot;</span>&gt;</span><br><span class="line">                &lt;ul class=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span><br><span class="line">                    &lt;li class=<span class="string">&quot;active&quot;</span>&gt;&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/Login.jsp&quot;</span>&gt;登录&lt;span class=<span class="string">&quot;sr-only&quot;</span>&gt;(current)&lt;/span&gt;&lt;/a&gt;</span><br><span class="line">                    &lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/Register.jsp&quot;</span>&gt;注册&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user?method=loginOut&quot;</span>&gt;注销&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">                &lt;form class=<span class="string">&quot;navbar-form navbar-left&quot;</span>&gt;</span><br><span class="line">                    &lt;div class=<span class="string">&quot;form-group&quot;</span>&gt;</span><br><span class="line">                        &lt;input type=<span class="string">&quot;text&quot;</span> class=<span class="string">&quot;form-control&quot;</span> placeholder=<span class="string">&quot;搜索一下&quot;</span>&gt;</span><br><span class="line">                    &lt;/div&gt;</span><br><span class="line">                    &lt;button type=<span class="string">&quot;submit&quot;</span> class=<span class="string">&quot;btn btn-default&quot;</span>&gt;搜索&lt;/button&gt;</span><br><span class="line">                &lt;/form&gt;</span><br><span class="line">                &lt;ul class=<span class="string">&quot;nav navbar-nav navbar-right&quot;</span>&gt;</span><br><span class="line">                    &lt;li&gt;&lt;a href=<span class="string">&quot;#&quot;</span>&gt;购物车&lt;/a&gt;&lt;/li&gt;</span><br><span class="line">                &lt;/ul&gt;</span><br><span class="line">            &lt;/div&gt;&lt;!-- /.navbar-collapse --&gt;</span><br><span class="line">        &lt;/div&gt;&lt;!-- /.container-fluid --&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">    &lt;nav class=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">        &lt;ul id=<span class="string">&quot;goodsType&quot;</span>&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/nav&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">[root<span class="meta">@hecs</span>-<span class="number">346515</span> test]# pwd </span><br><span class="line">/root/dockerfile/build/tomcat/test</span><br><span class="line">[root<span class="meta">@hecs</span>-<span class="number">346515</span> test]# ls </span><br><span class="line">index.jsp  WEB_INF</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="发布镜像"><a class="markdownIt-Anchor" href="#发布镜像">#</a> 发布镜像</h2>
<p><strong>dockerhub</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#登录dockerhub</span><br><span class="line">[root@hecs-346515 test]# docker login -u kbshire -p </span><br><span class="line"></span><br><span class="line">[root@hecs-346515 test]# docker build -t kbshire/avcat:2.333 .</span><br><span class="line">[root@hecs-346515 test]# docker push kbshire/avcat:2.333</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>阿里云</strong></p>
<p>1. 创建命名空间</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404132912975.png" alt="image-20230404132912975"></p>
<p>2. 创建容器镜像</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404133112291.png" alt="image-20230404133112291"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404134421264.png" alt="image-20230404134421264"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404134504442.png" alt="image-20230404134504442"></p>
<h2 id="docker-网络"><a class="markdownIt-Anchor" href="#docker-网络">#</a> Docker 网络</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 dockerfile]# ip a </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether fa:16:3e:8b:e2:28 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.0.69/24 brd 192.168.0.255 scope global noprefixroute dynamic eth0</span><br><span class="line">       valid_lft 67882sec preferred_lft 67882sec</span><br><span class="line">    inet6 fe80::f816:3eff:fe8b:e228/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:27:32:a6:49 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:27ff:fe32:a649/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -P --name tomcat01 tomcat </span><br><span class="line"></span><br><span class="line">docker exec -it tomcat01 ip addr </span><br><span class="line"></span><br><span class="line"># yum install iproute</span><br><span class="line">[root@29ede5d03d63 local]# ip a </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">161: eth0@if162: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">linux是可以ping通容器内部的</span><br></pre></td></tr></table></figure>
<p>每启动一个 docker 容器，docker 就会给 docker 容器分配一个 ip，我们只要安装了 docker 就会有一个网卡 docker0</p>
<p>桥接模式，就是 evth-pair 技术</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">162: vetha5d997c@if161: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 82:60:95:bc:a3:22 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::8060:95ff:febc:a322/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>
<p>容器带来的网卡都是一对一对的</p>
<p>evth-pair 就是一队虚拟设备接口，他们是成对出现的，一端连着协议，一端彼此相连</p>
<p>evth-pair 连接各种网络设备</p>
<p>OpenStack，docker 容器之间，ovs 的连接都是使用 evth-pair</p>
<p>容器和容器之间可以互相通信</p>
<p>容器之间通信共用的 docker0，可以理解为一个路由器</p>
<p>不指定容器网络的情况下，都是 docker0 路由的，docker 回给我们的容器分配一个默认 ip</p>
<p>/16 的掩码最多可以有 65535 个地址</p>
<p>docker 使用 linux 桥接，宿主机中是一个 docker 网络的网桥 docker0</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230404142456521.png" alt="image-20230404142456521"></p>
<p>docker 中所有网络接口都是虚拟的，转发效率高</p>
<p>容器删除，veth-pair 也就被删除了</p>
<h3 id="link"><a class="markdownIt-Anchor" href="#link">#</a> –link</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 dockerfile]# docker run -it  -P --name centos05 --link gallant_poincare centoshaha:0.5</span><br><span class="line">[root@hecs-346515 ~]# docker exec -it centos05 ping gallant_poincare</span><br><span class="line">通过link实现可以通过服务名ping</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker exec -it gallant_poincare ping centos05</span><br><span class="line">ping: centos05: Name or service not known</span><br><span class="line"></span><br><span class="line">docker network inspect id</span><br><span class="line"></span><br><span class="line">[root@5e0c29c45f15 local]# cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	gallant_poincare cef544877c1d</span><br><span class="line">172.17.0.4	5e0c29c45f15</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>–link 就是在 hosts 中增加了 gallant_poincare 的映射</strong></p>
<p>不建议使用–link</p>
<p>docker0 的问题，他不支持容器名进行连接访问</p>
<h3 id="自定义网络"><a class="markdownIt-Anchor" href="#自定义网络">#</a> 自定义网络</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hecs-346515 dockerfile]# docker network ls </span><br><span class="line">NETWORK ID     NAME                     DRIVER    SCOPE</span><br><span class="line">ef281869253b   bridge                   bridge    local</span><br><span class="line">81efa88be64b   host                     host      local</span><br><span class="line">57ffa6ffd57d   loadbalancejsp_default   bridge    local</span><br><span class="line">55243546bae4   none                     null      local</span><br></pre></td></tr></table></figure>
<p><strong>网络模式</strong></p>
<p>bridge：docker 之间搭桥，自己创建也使用桥接</p>
<p>none：不配置网络，一般不用</p>
<p>host：和宿主机共享网络</p>
<p>container：容器内网络连通，局限很大</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">直接启动的命令默认--net bridge  这就是docker0</span><br><span class="line">docker0是默认的，不能通过域名访问</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker network create --driver bridge --subnet 10.1.0.0/16 --gateway 10.1.0.1 sbnet </span><br><span class="line">82c4a8b68c66715f88003b8ba4ef65de670286de1c73abee49ab26f9fceb063a</span><br><span class="line">[root@hecs-346515 dockerfile]# docker network ls </span><br><span class="line">NETWORK ID     NAME                     DRIVER    SCOPE</span><br><span class="line">ef281869253b   bridge                   bridge    local</span><br><span class="line">81efa88be64b   host                     host      local</span><br><span class="line">57ffa6ffd57d   loadbalancejsp_default   bridge    local</span><br><span class="line">55243546bae4   none                     null      local</span><br><span class="line">82c4a8b68c66   sbnet                    bridge    local</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 dockerfile]# docker network inspect sbnet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;sbnet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;82c4a8b68c66715f88003b8ba4ef65de670286de1c73abee49ab26f9fceb063a&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-04-04T18:25:48.537296679+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;10.1.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;10.1.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">docker run -it  -P --name=centos11 --net sbnet centos </span><br><span class="line">docker run -it  -P --name=centos12 --net sbnet centos</span><br><span class="line">docker exec -it centos11 ping centos12 </span><br><span class="line">不使用--link也能ping通</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>我们自定义的网络 docker 已经帮我们维护好了关系</p>
<p>可以使不同集群使用不同的网络，保证集群的安全和健康</p>
<h3 id="网络连通"><a class="markdownIt-Anchor" href="#网络连通">#</a> 网络连通</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">docker netowrk connect sbnet centos13</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker network connect sbnet centos13</span><br><span class="line"></span><br><span class="line">[root@hecs-346515 ~]# docker network inspect sbnet </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;sbnet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;82c4a8b68c66715f88003b8ba4ef65de670286de1c73abee49ab26f9fceb063a&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2023-04-04T18:25:48.537296679+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;10.1.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;10.1.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;872404abcfc68d09a65ec820c986aa2003737629a0bdf83406152793dc72f228&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;centos12&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;e393d20c796d4c081b726787210dc5a05d645d33c1a75fd6da529ac11db6e0c1&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:0a:01:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;10.1.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;974c928cc0854549c5cf9b8e257adf025bf9e1499b1169b46bf56c1632565bbe&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;centos13&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;a571e55079a80a2f36ff6e181194cadc1ec49b76bd51bb4485be030201a718c7&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:0a:01:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;10.1.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;ed93b6d1202d8953cd9ae12450e44538d1647620423a7cbf63d1bcd9f023e7a6&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;centos11&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;820d037e8faaad9c8a19cd0a58629c1ec1881cc2b9e5e26a21420a1bb8724ccd&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:0a:01:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;10.1.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">将centos13放到了bridge下，一个容器此时有两个地址</span><br></pre></td></tr></table></figure>
<p>要跨网络操作容器，需要 docker connect 连通</p>
<h3 id="redis集群"><a class="markdownIt-Anchor" href="#redis集群">#</a> Redis 集群</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">for port in $(seq 1 6); \</span><br><span class="line">do \</span><br><span class="line">mkdir -p /mydata/redis/node-$&#123;port&#125;/conf</span><br><span class="line">touch /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">cat &lt;&lt; EOF &gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span><br><span class="line">port 6379 </span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes </span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br><span class="line">EOF</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">run</span><span class="language-bash"> -p 6376:6379 -p 16376:16379 --name redis-6 -v /mydata/redis/node-6/data:/data -v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf -d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf </span></span><br><span class="line"></span><br><span class="line">redis-cli --cluster create <span class="number">172.38</span>.<span class="number">0.11</span>:<span class="number">6379</span> <span class="number">172.38</span>.<span class="number">0.12</span>:<span class="number">6379</span> <span class="number">172.38</span>.<span class="number">0.13</span>:<span class="number">6379</span> <span class="number">172.38</span>.<span class="number">0.14</span>:<span class="number">6379</span> <span class="number">172.38</span>.<span class="number">0.15</span>:<span class="number">637</span></span><br><span class="line"><span class="number">9</span> <span class="number">172.38</span>.<span class="number">0.16</span>:<span class="number">6379</span> --cluster-replicas <span class="number">1</span></span><br><span class="line"></span><br><span class="line">/data <span class="comment"># redis-cli -c</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; CLUSTER INFO</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:<span class="number">16384</span></span><br><span class="line">cluster_slots_ok:<span class="number">16384</span></span><br><span class="line">cluster_slots_pfail:<span class="number">0</span></span><br><span class="line">cluster_slots_fail:<span class="number">0</span></span><br><span class="line">cluster_known_nodes:<span class="number">6</span></span><br><span class="line">cluster_size:<span class="number">3</span></span><br><span class="line">cluster_current_epoch:<span class="number">6</span></span><br><span class="line">cluster_my_epoch:<span class="number">1</span></span><br><span class="line">cluster_stats_messages_ping_sent:<span class="number">82</span></span><br><span class="line">cluster_stats_messages_pong_sent:<span class="number">82</span></span><br><span class="line">cluster_stats_messages_sent:<span class="number">164</span></span><br><span class="line">cluster_stats_messages_ping_received:<span class="number">77</span></span><br><span class="line">cluster_stats_messages_pong_received:<span class="number">82</span></span><br><span class="line">cluster_stats_messages_meet_received:<span class="number">5</span></span><br><span class="line">cluster_stats_messages_received:<span class="number">164</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; CLUSTER NODES</span><br><span class="line">b75997d0df1dafbbf8db3642f424eedc0cd9695f <span class="number">172.38</span>.<span class="number">0.15</span>:<span class="number">6379</span>@<span class="number">16379</span> slave <span class="number">73</span>a37cfa8c760c3069bd4fb69f9b2a411f556124 <span class="number">0</span> <span class="number">1680661677823</span> <span class="number">5</span> connected</span><br><span class="line"><span class="number">73</span>a37cfa8c760c3069bd4fb69f9b2a411f556124 <span class="number">172.38</span>.<span class="number">0.11</span>:<span class="number">6379</span>@<span class="number">16379</span> myself,master - <span class="number">0</span> <span class="number">1680661677000</span> <span class="number">1</span> connected <span class="number">0</span>-<span class="number">5460</span></span><br><span class="line"><span class="number">51</span>c02482b19b9ab5dc20ff1852f375ada2f68986 <span class="number">172.38</span>.<span class="number">0.12</span>:<span class="number">6379</span>@<span class="number">16379</span> master - <span class="number">0</span> <span class="number">1680661677522</span> <span class="number">2</span> connected <span class="number">5461</span>-<span class="number">10922</span></span><br><span class="line">ba2557b0959bed1cc5a446bcd0403721bcb8d002 <span class="number">172.38</span>.<span class="number">0.14</span>:<span class="number">6379</span>@<span class="number">16379</span> slave <span class="number">3794</span>de303a95a3718988f3d313f332241b364d7c <span class="number">0</span> <span class="number">1680661677000</span> <span class="number">4</span> connected</span><br><span class="line"><span class="number">3794</span>de303a95a3718988f3d313f332241b364d7c <span class="number">172.38</span>.<span class="number">0.13</span>:<span class="number">6379</span>@<span class="number">16379</span> master - <span class="number">0</span> <span class="number">1680661676822</span> <span class="number">3</span> connected <span class="number">10923</span>-<span class="number">16383</span></span><br><span class="line"><span class="number">73007</span>d040ed6ca3c093fb5061a3358d1ae47a18a <span class="number">172.38</span>.<span class="number">0.16</span>:<span class="number">6379</span>@<span class="number">16379</span> slave <span class="number">51</span>c02482b19b9ab5dc20ff1852f375ada2f68986 <span class="number">0</span> <span class="number">1680661676000</span> <span class="number">6</span> connected</span><br><span class="line"></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; set a b </span><br><span class="line">-&gt; Redirected to slot [<span class="number">15495</span>] located at <span class="number">172.38</span>.<span class="number">0.13</span>:<span class="number">6379</span></span><br><span class="line">OK</span><br><span class="line"><span class="number">172.38</span>.<span class="number">0.13</span>:<span class="number">6379</span>&gt; get a </span><br><span class="line">^C</span><br><span class="line">/data <span class="comment"># redis-cli -c</span></span><br><span class="line"><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">6379</span>&gt; get a </span><br><span class="line">-&gt; Redirected to slot [<span class="number">15495</span>] located at <span class="number">172.38</span>.<span class="number">0.14</span>:<span class="number">6379</span></span><br><span class="line"><span class="string">&quot;b&quot;</span></span><br><span class="line"><span class="number">172.38</span>.<span class="number">0.14</span>:<span class="number">6379</span>&gt; CLUSTER NODES</span><br><span class="line">b75997d0df1dafbbf8db3642f424eedc0cd9695f <span class="number">172.38</span>.<span class="number">0.15</span>:<span class="number">6379</span>@<span class="number">16379</span> slave <span class="number">73</span>a37cfa8c760c3069bd4fb69f9b2a411f556124 <span class="number">0</span> <span class="number">1680661856417</span> <span class="number">5</span> connected</span><br><span class="line"><span class="number">73</span>a37cfa8c760c3069bd4fb69f9b2a411f556124 <span class="number">172.38</span>.<span class="number">0.11</span>:<span class="number">6379</span>@<span class="number">16379</span> master - <span class="number">0</span> <span class="number">1680661856517</span> <span class="number">1</span> connected <span class="number">0</span>-<span class="number">5460</span></span><br><span class="line">ba2557b0959bed1cc5a446bcd0403721bcb8d002 <span class="number">172.38</span>.<span class="number">0.14</span>:<span class="number">6379</span>@<span class="number">16379</span> myself,master - <span class="number">0</span> <span class="number">1680661855000</span> <span class="number">7</span> connected <span class="number">10923</span>-<span class="number">16383</span></span><br><span class="line"><span class="number">73007</span>d040ed6ca3c093fb5061a3358d1ae47a18a <span class="number">172.38</span>.<span class="number">0.16</span>:<span class="number">6379</span>@<span class="number">16379</span> slave <span class="number">51</span>c02482b19b9ab5dc20ff1852f375ada2f68986 <span class="number">0</span> <span class="number">1680661856016</span> <span class="number">6</span> connected</span><br><span class="line"><span class="number">51</span>c02482b19b9ab5dc20ff1852f375ada2f68986 <span class="number">172.38</span>.<span class="number">0.12</span>:<span class="number">6379</span>@<span class="number">16379</span> master - <span class="number">0</span> <span class="number">1680661855415</span> <span class="number">2</span> connected <span class="number">5461</span>-<span class="number">10922</span></span><br><span class="line"><span class="number">3794</span>de303a95a3718988f3d313f332241b364d7c <span class="number">172.38</span>.<span class="number">0.13</span>:<span class="number">6379</span>@<span class="number">16379</span> master,fail - <span class="number">1680661784244</span> <span class="number">1680661782238</span> <span class="number">3</span> connected</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="springboot-微服务打包docker镜像"><a class="markdownIt-Anchor" href="#springboot-微服务打包docker镜像">#</a> springboot 微服务打包 docker 镜像</h3>
<p>1. 构建 springboot 项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">创建package controller</span><br><span class="line">创建class HelloControllerpackage com.example.demo.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello,shabi&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package com.example.demo.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"></span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String hello() &#123;</span><br><span class="line">        return &quot;hello,shabi&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2. 打包应用</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230405110530946.png" alt="image-20230405110530946"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230405110610159.png" alt="image-20230405110610159"></p>
<p>3. 编写 dockerfile</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">FROM hzkjhub/java17:17.0.4</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [&quot;--server.port=8080&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br><span class="line">~                                               </span><br></pre></td></tr></table></figure>
<p>4. 构建镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker build -t shabi .</span><br><span class="line">docker run -P -it --name docker333  shabi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">curl 127.0.0.1:32778/hello</span><br></pre></td></tr></table></figure>
<p>5. 发布运行</p>
<p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW9nNHkxcTdNNA==">https://www.bilibili.com/video/BV1og4y1q7M4</span></p>
<h2 id="docker-compose"><a class="markdownIt-Anchor" href="#docker-compose">#</a> Docker Compose</h2>
<p>高效的管理容器。定义运行多个容器。使用 yaml 配置</p>
<blockquote>
<p>编写 dockerfile 保证我们的项目在任何地方可以运行</p>
<p>定义服务在 docker-compose.yml 中</p>
<p>docker-compose up</p>
</blockquote>
<p>批量容器编排</p>
<p>docker-compose 是 docker 的开源项目，需要安装</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.9&quot;</span>  <span class="comment"># optional since v1.27.0</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">web:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:5000&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/code</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>service 容器，应用</p>
<p>项目 project。一组关联的容器</p>
<h3 id="安装docker-compose"><a class="markdownIt-Anchor" href="#安装docker-compose">#</a> 安装 docker compose</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.17.2/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">sudo curl -L &quot;https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">docker-compose -version</span><br><span class="line">docker-compose version 1.29.2, build 5becea4c</span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cDovLzEueG4tLWFwcC1xdzJmcTAxaC5weQ==">1. 应用 app.py</span></p>
<p>2.dockerfile 将应用打包为镜像</p>
<p>3.docker-compose yaml 文件 定义整个服务，需要的环境</p>
<p>4. 启动 compose</p>
<p>流程</p>
<p>1. 创建网络</p>
<p>2. 执行 dockercompose.yaml</p>
<p>3. 启动服务</p>
<p>默认的服务名  <code>文件名_服务名_num</code></p>
<p><code>_num</code>  代表副本数量</p>
<p>docker-compose 自动维护一个网络，项目中的内容都在同个网络下，实现域名访问</p>
<p>启动 <code>docker-compose up -d</code></p>
<p>停止 <code>docker-compose down</code>   <code>ctrl+c</code></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230405201151236.png" alt="image-20230405201151236"></p>
<h2 id="docker-swarm"><a class="markdownIt-Anchor" href="#docker-swarm">#</a> docker swarm</h2>
<p>集群的方式部署</p>

  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2023-04-06 12:05:24" itemprop="dateModified" datetime="2023-04-06T12:05:24+08:00">2023-04-06</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="John Doe WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="John Doe Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="John Doe PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2023/04/05/Docker/" title="Docker">http://example.com/2023/04/05/Docker/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2023/04/01/Nginx/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva4.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclize41wj20zk0m87gk.jpg" title="Nginx">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Nginx</h3>
  </a>

    </div>
    <div class="item right">
    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker"><span class="toc-number">1.</span> <span class="toc-text"> Docker</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text"> docker 安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.2.</span> <span class="toc-text"> 镜像加速</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-run%E4%B9%8B%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88"><span class="toc-number">1.3.</span> <span class="toc-text"> docker run 之后发生了什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text"> docker 命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text"> 镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.2.</span> <span class="toc-text"> 容器命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8docker"><span class="toc-number">1.5.</span> <span class="toc-text"> 使用 docker</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx"><span class="toc-number">1.5.1.</span> <span class="toc-text"> 安装 nginx</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">1.5.2.</span> <span class="toc-text"> 安装 tomcat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85eskibana"><span class="toc-number">1.5.3.</span> <span class="toc-text"> 安装 es+kibana</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">1.6.</span> <span class="toc-text"> 可视化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.7.</span> <span class="toc-text"> 联合文件系统</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.</span> <span class="toc-text"> 分层原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#commit"><span class="toc-number">1.9.</span> <span class="toc-text"> commit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.10.</span> <span class="toc-text"> 容器数据卷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile%E6%8C%82%E8%BD%BD"><span class="toc-number">1.11.</span> <span class="toc-text"> Dockerfile 挂载</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.12.</span> <span class="toc-text"> 数据卷容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile"><span class="toc-number">1.13.</span> <span class="toc-text"> Dockerfile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E6%8C%87%E4%BB%A4"><span class="toc-number">1.13.1.</span> <span class="toc-text"> dockerfile 指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%B6%E4%BD%9Ctomcat%E9%95%9C%E5%83%8F"><span class="toc-number">1.13.2.</span> <span class="toc-text"> 制作 tomcat 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F"><span class="toc-number">1.14.</span> <span class="toc-text"> 发布镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-%E7%BD%91%E7%BB%9C"><span class="toc-number">1.15.</span> <span class="toc-text"> Docker 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#link"><span class="toc-number">1.15.1.</span> <span class="toc-text"> –link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">1.15.2.</span> <span class="toc-text"> 自定义网络</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%BF%9E%E9%80%9A"><span class="toc-number">1.15.3.</span> <span class="toc-text"> 网络连通</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#redis%E9%9B%86%E7%BE%A4"><span class="toc-number">1.15.4.</span> <span class="toc-text"> Redis 集群</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#springboot-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85docker%E9%95%9C%E5%83%8F"><span class="toc-number">1.15.5.</span> <span class="toc-text"> springboot 微服务打包 docker 镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-compose"><span class="toc-number">1.16.</span> <span class="toc-text"> Docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker-compose"><span class="toc-number">1.16.1.</span> <span class="toc-text"> 安装 docker compose</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-swarm"><span class="toc-number">1.17.</span> <span class="toc-text"> docker swarm</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">27</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">4</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">4</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/04/01/Nginx/" title="Nginx">Nginx</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/10/30/%E5%8F%91%E7%8E%B0%E5%B0%8F%E5%8F%AF%E7%88%B1%EF%BC%81/" title="about me">about me</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E9%80%86%E5%90%91/" title="In 逆向">逆向</a>
</div>

    <span><a href="/2022/11/01/%E6%B1%87%E7%BC%96/" title="汇编">汇编</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/05/17/include/" title="file include">file include</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/12/28/mysql/" title="Mysql">Mysql</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E5%86%85%E7%BD%91/" title="In 内网">内网</a>
</div>

    <span><a href="/2022/12/25/%E5%86%85%E7%BD%91/" title="内网渗透">内网渗透</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/%E7%A7%8B%E6%8B%9B/" title="In 秋招">秋招</a>
</div>

    <span><a href="/2022/10/28/%E7%A7%8B%E6%8B%9B%E9%9D%A2%E8%AF%95%E9%A2%98/" title="秋招面试题">秋招面试题</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/02/28/XSS/" title="XSS">XSS</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/08/16/Unserialize/" title="unserialize">unserialize</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/06/27/SSRF/" title="SSRF">SSRF</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2023/04/05/Docker/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>

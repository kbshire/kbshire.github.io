



<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="Hexo" href="http://example.com/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="Hexo" href="http://example.com/atom.xml" />
<link rel="alternate" type="application/json" title="Hexo" href="http://example.com/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="逆向" />


<link rel="canonical" href="http://example.com/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/">



  <title>
水滴rev - 逆向 |
Yume Shoka = Hexo</title>
<meta name="generator" content="Hexo 5.4.2"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">水滴rev
  </h1>
  
<div class="meta">
  <span class="item" title="Created: 2023-01-03 13:38:45">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">Posted on</span>
    <time itemprop="dateCreated datePublished" datetime="2023-01-03T13:38:45+08:00">2023-01-03</time>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="Toggle navigation bar">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Yume Shoka</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipew8gmvyj20zk0m87wh.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giph4lm9i7j20zk0m84qp.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipetv6p75j20zk0m8x6p.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclil3m4ej20zk0m8tn8.jpg"></li>
          <li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicli3sbvtj20zk0m8x6p.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">Home</a></span><i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E9%80%86%E5%90%91/" itemprop="item" rel="index" title="In 逆向"><span itemprop="name">逆向</span></a>
<meta itemprop="position" content="1" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="en">
  <link itemprop="mainEntityOfPage" href="http://example.com/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/avatar.jpg">
    <meta itemprop="name" content="John Doe">
    <meta itemprop="description" content=", ">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Hexo">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="滴水reverse"><a class="markdownIt-Anchor" href="#滴水reverse">#</a> 滴水 reverse</h1>
<h2 id="公开课"><a class="markdownIt-Anchor" href="#公开课">#</a> 公开课</h2>
<p>PE 文件结构</p>
<p>任何一个在 Windows 上运行的可执行文件都要遵守一定的格式，这个格式就是 PE 文件结构，比如:exe, dIl, 部分 sys</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/20191105010140189.png" alt="img"></p>
<p>此处可使用 PEID 或 ExeinfoPE 进行代替</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210120028888.png" alt="image-20221210120028888"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210132659775.png" alt="image-20221210132659775"></p>
<p>32 位计算机最大内存 4G，寻址宽度 32 位</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210141922512.png" alt="image-20221210141922512"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210141955667.png" alt="image-20221210141955667"></p>
<p>push esp-4 , 压栈，EIP +4</p>
<p>call EIP 跳转，esp-4 压栈</p>
<p>ret 将栈中的地址弹出到 EIP，esp-4</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211125947066.png" alt="image-20221211125947066"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211130508986.png" alt="image-20221211130508986"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211131806741.png" alt="image-20221211131806741"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133036307.png" alt="image-20221211133036307"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133000935.png" alt="image-20221211133000935"></p>
<p>arr [6] 是 ebp+4，放的是函数返回值的地址，修改了返回值在函数返回时会自动执行</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133428315.png" alt="image-20221211133428315"></p>
<p>全局变量在 pe 头的数据中，局部变量在堆栈中</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211135158527.png" alt="image-20221211135158527"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211135229931.png" alt="image-20221211135229931"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211134515487.png" alt="image-20221211134515487"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211134557068.png" alt="image-20221211134557068"></p>
<h2 id="进制"><a class="markdownIt-Anchor" href="#进制">#</a> 进制</h2>
<p>进制的本质是查数</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151456236.png" alt="image-20221212151456236"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151324431.png" alt="image-20221212151324431"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151333052.png" alt="image-20221212151333052"></p>
<h2 id="数据宽度"><a class="markdownIt-Anchor" href="#数据宽度">#</a> 数据宽度</h2>
<p>4 位宽度表示</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213152958630.png" alt="image-20221213152958630"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213153742328.png" alt="image-20221213153742328"></p>
<p>8 位宽度表示</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213153933311.png" alt="image-20221213153933311"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154014302.png" alt="image-20221213154014302"></p>
<p>16 位宽度表示</p>
<p>32 位宽度表示</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154324319.png" alt="image-20221213154324319"></p>
<p>6、几个重要的计量单位:</p>
<p>BYTE 字节 8BIT</p>
<p>WORD 字 16BIT 2 字节</p>
<p>DWORD 双字 32BIT 4 字节</p>
<p>or</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154728965.png" alt="image-20221213154728965"></p>
<p>and</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213155024628.png" alt="image-20221213155024628"></p>
<p>xor</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213155128086.png" alt="image-20221213155128086"></p>
<p>not</p>
<p>2+3</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210132659775.png" alt="image-20221210132659775"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213160855262.png" alt="image-20221213160855262"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213160948087.png" alt="image-20221213160948087"></p>
<h2 id="寄存器"><a class="markdownIt-Anchor" href="#寄存器">#</a> 寄存器</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213162041512.png" alt=" "></p>
<p>mov ebx,0x123456789    //ebx=23456789  忽略高位，1 是高位</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213171205765.png" alt="image-20221213171205765"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213171554801.png" alt="image-20221213171554801"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213174336225.png" alt="image-20221213174336225"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213175435630.png" alt="image-20221213175435630"></p>
<p><img data-src="../AppData/Roaming/Typora/typora-user-images/image-20221213182649856.png" alt="image-20221213182649856"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213183047619.png" alt="image-20221213183047619"></p>
<p><strong>我们可以打补丁或者其他方式拓展内存</strong></p>
<h2 id="内存"><a class="markdownIt-Anchor" href="#内存">#</a> 内存</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213183647234.png" alt="image-20221213183647234"></p>
<p>栈中每四个内存单元一组</p>
<img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213184806456.png" alt="image-20221213184806456" style="zoom:200%;" />
<p>数据窗口中以小端存储以 db 查看时</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214203828764.png" alt="image-20221214203828764"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214203909142.png" alt="image-20221214203909142"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214204249791.png" alt="image-20221214204249791"></p>
<p>0012FFDC = E4</p>
<p>0012FFDD = 7C</p>
<p>在数据窗口是小端在前</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214205211991.png" alt="image-20221214205211991"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214205617926.png" alt="image-20221214205617926"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210429166.png" alt="image-20221214210429166"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210441256.png" alt="image-20221214210441256"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210742628.png" alt="image-20221214210742628"></p>
<h2 id="堆栈"><a class="markdownIt-Anchor" href="#堆栈">#</a> 堆栈</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214213244308.png" alt="image-20221214213244308"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214213607192.png" alt="image-20221214213607192"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214214015040.png" alt="image-20221214214015040"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214214825379.png" alt="image-20221214214825379"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">push imm    //esp-4</span><br><span class="line">push al     //不能push8位</span><br><span class="line">push ax     //esp-2</span><br><span class="line">push eax    //esp-4</span><br><span class="line">push dword ptr ds:[12FFDC]   //esp-4</span><br><span class="line">push word ptr ds:[12FFDC]    //esp-2</span><br><span class="line">push byte ptr ds:[12FFDC]    //不能push 8位内存</span><br><span class="line"></span><br><span class="line">pushad   //将所有通用寄存器入栈</span><br><span class="line">popad </span><br></pre></td></tr></table></figure>
<h2 id="jcc"><a class="markdownIt-Anchor" href="#jcc">#</a> JCC</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219205236604.png" alt="image-20221219205236604"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219205328411.png" alt="image-20221219205328411"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210046713.png" alt="image-20221219210046713"></p>
<p>只计算最低有效字节中的 1 的个数</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210317802.png" alt="image-20221219210317802"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">看当前数据宽度/2 中间的位是否进位</span><br><span class="line">12345678  看5是否产生进位</span><br><span class="line">16位，8位一样 </span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210949437.png" alt="image-20221219210949437"></p>
<p>test 和 xor 的区别</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219211306372.png" alt="image-20221219211306372"></p>
<hr>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219212150517.png" alt="image-20221219212150517"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213621597.png" alt="image-20221219213621597"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213712037.png" alt="image-20221219213712037"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213903993.png" alt="image-20221219213903993"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adc al,cl</span><br><span class="line">al = al + cl + 进位标志carry(1)</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214113901.png" alt="image-20221219214113901"></p>
<p>Borrow</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214341294.png" alt="image-20221219214341294"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214413526.png" alt="image-20221219214413526"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219215219369.png" alt="image-20221219215219369"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">movs stos  移动方向由D标志位决定 </span><br><span class="line">D = 0 + </span><br><span class="line">D = 1 -</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219215520140.png" alt="image-20221219215520140"></p>
<h2 id="jcc-2"><a class="markdownIt-Anchor" href="#jcc-2">#</a> JCC</h2>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228171843970.png" alt="image-20221228171843970"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184206472.png" alt="image-20221228184206472"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184559423.png" alt="image-20221228184559423"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184754864.png" alt="image-20221228184754864"></p>
<p>test  可以判断寄存器中值是否为 0</p>
<p><strong>call 执行时首先将 call 的下一条命令入栈，通过当前地址 + 当前指令长度，指令长度通过硬编码确定，此时 esp-4，作为 call ret 之后的下一条执行，EIP 变为 call 的地址</strong></p>
<p><strong>ret 时将栈顶的返回地址给 EIP，esp+4</strong></p>
<p><strong>因此一个函数在被调用时，堆栈栈顶就是他返回后执行的下一条指令</strong></p>
<h2 id="堆栈图"><a class="markdownIt-Anchor" href="#堆栈图">#</a> 堆栈图</h2>
<p>定位到 winMain</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230210156563.png" alt="image-20221230210156563"></p>
<p>有如下函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">00401085  |.  6A 04         push    0x4</span><br><span class="line">00401087  |.  6A 03         push    0x3</span><br><span class="line">00401089  |.  E8 77FFFFFF   call    00401005</span><br><span class="line">0040108E  |.  83C4 08       add     esp,0x8</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">00401005   $ /E9 16000000   jmp     add</span><br><span class="line">0040100A   $ |E9 51000000   jmp     main</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">00401020 &gt;/&gt; \55            push    ebp</span><br><span class="line">00401021  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401023  |.  83EC 48       sub     esp,0x48</span><br><span class="line">00401026  |.  53            push    ebx</span><br><span class="line">00401027  |.  56            push    esi</span><br><span class="line">00401028  |.  57            push    edi</span><br><span class="line">00401029  |.  8D7D B8       lea     edi,[local.18]</span><br><span class="line">0040102C  |.  B9 12000000   mov     ecx,0x12</span><br><span class="line">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">00401038  |.  8B45 08       mov     eax,[arg.1]</span><br><span class="line">0040103B  |.  8945 FC       mov     [local.1],eax</span><br><span class="line">0040103E  |.  8B4D 0C       mov     ecx,[arg.2]</span><br><span class="line">00401041  |.  894D F8       mov     [local.2],ecx</span><br><span class="line">00401044  |.  8B45 FC       mov     eax,[local.1]</span><br><span class="line">00401047  |.  0345 F8       add     eax,[local.2]</span><br><span class="line">0040104A  |.  5F            pop     edi</span><br><span class="line">0040104B  |.  5E            pop     esi</span><br><span class="line">0040104C  |.  5B            pop     ebx</span><br><span class="line">0040104D  |.  8BE5          mov     esp,ebp</span><br><span class="line">0040104F  |.  5D            pop     ebp</span><br><span class="line">00401050  \.  C3            retn</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235920026.png" alt="image-20221230235920026"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235929733.png" alt="image-20221230235929733"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235938501.png" alt="image-20221230235938501"></p>
<blockquote>
<p>注意 1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">0018FE94     00000001</span><br><span class="line">0018FE98     0018FF48</span><br><span class="line">0018FE9C     00000000</span><br><span class="line">0018FEA0     7EFDE000</span><br><span class="line">0018FEA4     CCCCCCCC</span><br><span class="line">0018FEA8     CCCCCCCC</span><br><span class="line">0018FEAC     CCCCCCCC</span><br><span class="line">0018FEB0     CCCCCCCC</span><br><span class="line">0018FEB4     CCCCCCCC</span><br><span class="line">0018FEB8     CCCCCCCC</span><br><span class="line">0018FEBC     CCCCCCCC</span><br><span class="line">0018FEC0     CCCCCCCC</span><br><span class="line">0018FEC4     CCCCCCCC</span><br><span class="line">0018FEC8     CCCCCCCC</span><br><span class="line">0018FECC     CCCCCCCC</span><br><span class="line">0018FED0     CCCCCCCC</span><br><span class="line">0018FED4     CCCCCCCC</span><br><span class="line">0018FED8     CCCCCCCC</span><br><span class="line">0018FEDC     CCCCCCCC</span><br><span class="line">0018FEE0     CCCCCCCC</span><br><span class="line">0018FEE4     00000004</span><br><span class="line">0018FEE8     00000003</span><br><span class="line">0018FEEC     0018FF48</span><br><span class="line">0018FEF0     0040108E  add.0040108E</span><br><span class="line">0018FEF4     00000003</span><br><span class="line">0018FEF8     00000004</span><br><span class="line">0018FEFC     00000000</span><br></pre></td></tr></table></figure>
<p>这是 add esp, 0x8 之后的堆栈，并不是将他清空了，只是改变了 esp，垃圾数据还在那</p>
<p>注意 2：</p>
<p>CCCCCCCC 是 int3 的硬编码</p>
<p>注意 3：</p>
<p>esp+8 是外部传进来的参数</p>
<p>esp-4 是函数内部的局部变量</p>
<p>esp+4 是函数返回的地址</p>
<p>注意 4：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int add(int a, int b)</span><br><span class="line">&#123;</span><br><span class="line">	int c = a;</span><br><span class="line">	int d = b;</span><br><span class="line">	return c + d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;Hello World!\n&quot;);</span><br><span class="line">	add(3,4);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line">//这是函数代码</span><br></pre></td></tr></table></figure>
<p>注意 5：</p>
<p>add esp,0x8 是 cdecl 的外平栈</p>
<p>ret 8 是 stdcall 的内平栈</p>
<p>注意 6</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lea     edi,dword ptr ss:[ebp-0x48]</span><br><span class="line">mov     ecx,0x12</span><br><span class="line">mov     eax,0xCCCCCCCC</span><br><span class="line">rep     stos dword ptr es:[edi]</span><br></pre></td></tr></table></figure>
<p>的作用是重复 12 次，将 CCCCCCCC 的值不停填充到 ebp-48 的位置，每填充一次 edi+4，edi+4 或 - 4 由 df 标志位决定，df=0 +  df=1 -</p>
</blockquote>
<h2 id="函数"><a class="markdownIt-Anchor" href="#函数">#</a> 函数</h2>
<p>计算机的函数，是一个固定的一个程序段，或称其为一个子程序，它东可以实现固定运算功能的同时还带有一入口和一个出口，所谓的入口，就是函数所带的各个参数，我们可以通过这个入口，把函数的参数值代入子程序，供计算机处理，所谓出口，就是指函数的计算结果，也称为返回值，在计算机求得之后，由此口带回给调用它的程序。</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101174907969.png" alt="image-20230101174907969"></p>
<p>函数传参包括寄存器传参 (比如 this 指针) 和内存传参</p>
<p>函数返回结果可以通过寄存器返回 (一般为 EAX) 或者内存</p>
<p>Windows 堆栈特点</p>
<p>1. 现进后出</p>
<p>2. 向低地址扩展</p>
<p>windows 中的堆栈，是一块普通的内存，主要用来存储一些临时的数据和参数等可以把 Windows 中的堆栈想象成是一个公用的书箱，函数就像是使用箱子的人函数在执行的时候，会用到这个书箱，把一些数据存到里面，但用完的时候一定要记得把书拿走，否则会乱的，也就是说，你放进去几本书，走的时候也要拿走几本书，这个就是堆栈平衡.</p>
<h2 id="c语言"><a class="markdownIt-Anchor" href="#c语言">#</a> C 语言</h2>
<h3 id="vc60"><a class="markdownIt-Anchor" href="#vc60">#</a> VC6.0</h3>
<p><strong>快捷键</strong></p>
<p>F7 编译</p>
<p>F5 执行</p>
<p>shift + F5 结束</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103212249828.png" alt="image-20230103212249828"></p>
<p>函数名、参数名、变量名的命名规则：只能包含字母、数字和_且不能以数字开头.</p>
<p><strong>函数返回值</strong></p>
<p>1. 无参数，无返回值的格式形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void fun()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>当函数没有参数时不需要提升和降低堆栈</strong></p>
<p>2. 有参数，无返回值函数格式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">void fn(int a,double b)</span><br><span class="line">&#123;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>裸函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __declspec(naked) func1()</span><br><span class="line">&#123;</span><br><span class="line">	__asm</span><br><span class="line">	&#123;</span><br><span class="line">		ret</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> __declspec(naked) func1(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">调用裸函数中没有代码，没有ret,不能正常返回，会报错</span><br><span class="line">需要手动加内联汇编中ret返回 </span><br></pre></td></tr></table></figure>
<p>调用约定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__cdecl			从右至左入栈							调用者清理栈					默认调用约定</span><br><span class="line">__stdcall		从右至左入栈							自身清理堆栈					winapi调用方式</span><br><span class="line">__fastcall		ecx/edx传送前两个，从右至左入栈			自身清理堆栈，如果参数大于两个，小于两个不用清理</span><br></pre></td></tr></table></figure>
<p>函数入口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">main(int 1, char * * 0x005210d8) line 23</span><br><span class="line">mainCRTStartup() line 206 + 25 bytes</span><br><span class="line">KERNEL32! 74d433ca()</span><br><span class="line">NTDLL! 76f59ed2()</span><br><span class="line">NTDLL! 76f59ea5()</span><br></pre></td></tr></table></figure>
<p>更改入口点</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230104194840789.png" alt="image-20230104194840789"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">main 函数被调用前要先调用的函数如下:</span><br><span class="line">GetVersion()</span><br><span class="line">_heap_init()</span><br><span class="line">GetCommandLineA()</span><br><span class="line">_crtGetEnvironmentStringsA()</span><br><span class="line">_setargv(</span><br><span class="line">_setenvp()</span><br><span class="line">_cinit()</span><br><span class="line"></span><br><span class="line">以上函数都会在mainCRTStartup中初始化</span><br><span class="line"></span><br><span class="line">mainret = main(__argc,__argv,__environ);</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">00401180 &gt;/$  55            push    ebp</span><br><span class="line">00401181  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401183  |.  6A FF         push    -0x1</span><br><span class="line">00401185  |.  68 38214200   push    00422138</span><br><span class="line">0040118A  |.  68 30424000   push    _except_handler3                 ;  SE 处理程序安装</span><br><span class="line">0040118F  |.  64:A1 0000000&gt;mov     eax,dword ptr fs:[0]</span><br><span class="line">00401195  |.  50            push    eax</span><br><span class="line">00401196  |.  64:8925 00000&gt;mov     dword ptr fs:[0],esp</span><br><span class="line">0040119D  |.  83C4 F0       add     esp,-0x10</span><br><span class="line">004011A0  |.  53            push    ebx</span><br><span class="line">004011A1  |.  56            push    esi</span><br><span class="line">004011A2  |.  57            push    edi</span><br><span class="line">004011A3  |.  8965 E8       mov     [local.6],esp</span><br><span class="line">004011A6  |.  FF15 4CA14200 call    dword ptr ds:[&lt;&amp;KERNEL32.GetVers&gt;;  kernel32.GetVersion</span><br><span class="line">004011AC  |.  A3 707C4200   mov     dword ptr ds:[_osver],eax</span><br><span class="line">004011B1  |.  A1 707C4200   mov     eax,dword ptr ds:[_osver]</span><br><span class="line">004011B6  |.  C1E8 08       shr     eax,0x8</span><br><span class="line">004011B9  |.  25 FF000000   and     eax,0xFF</span><br><span class="line">004011BE  |.  A3 7C7C4200   mov     dword ptr ds:[_winminor],eax</span><br><span class="line">004011C3  |.  8B0D 707C4200 mov     ecx,dword ptr ds:[_osver]</span><br><span class="line">004011C9  |.  81E1 FF000000 and     ecx,0xFF</span><br><span class="line">004011CF  |.  890D 787C4200 mov     dword ptr ds:[_winmajor],ecx</span><br><span class="line">004011D5  |.  8B15 787C4200 mov     edx,dword ptr ds:[_winmajor]</span><br><span class="line">004011DB  |.  C1E2 08       shl     edx,0x8</span><br><span class="line">004011DE  |.  0315 7C7C4200 add     edx,dword ptr ds:[_winminor]</span><br><span class="line">004011E4  |.  8915 747C4200 mov     dword ptr ds:[_winver],edx</span><br><span class="line">004011EA  |.  A1 707C4200   mov     eax,dword ptr ds:[_osver]</span><br><span class="line">004011EF  |.  C1E8 10       shr     eax,0x10</span><br><span class="line">004011F2  |.  25 FFFF0000   and     eax,0xFFFF</span><br><span class="line">004011F7  |.  A3 707C4200   mov     dword ptr ds:[_osver],eax</span><br><span class="line">004011FC  |.  6A 00         push    0x0</span><br><span class="line">004011FE  |.  E8 BD2D0000   call    _heap_init</span><br><span class="line">00401203  |.  83C4 04       add     esp,0x4</span><br><span class="line">00401206  |.  85C0          test    eax,eax</span><br><span class="line">00401208  |.  75 0A         jnz     short 00401214</span><br><span class="line">0040120A  |.  6A 1C         push    0x1C</span><br><span class="line">0040120C  |.  E8 CF000000   call    fast_error_exit</span><br><span class="line">00401211  |.  83C4 04       add     esp,0x4</span><br><span class="line">00401214  |&gt;  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class="line">0040121B  |.  E8 A0270000   call    _ioinit</span><br><span class="line">00401220  |.  FF15 48A14200 call    dword ptr ds:[&lt;&amp;KERNEL32.GetComm&gt;; [GetCommandLineA</span><br><span class="line">00401226  |.  A3 04964200   mov     dword ptr ds:[_acmdln],eax</span><br><span class="line">0040122B  |.  E8 70250000   call    __crtGetEnvironmentStringsA</span><br><span class="line">00401230  |.  A3 487C4200   mov     dword ptr ds:[_aenvptr],eax</span><br><span class="line">00401235  |.  E8 56200000   call    _setargv</span><br><span class="line">0040123A  |.  E8 011F0000   call    _setenvp</span><br><span class="line">0040123F  |.  E8 1C1B0000   call    _cinit</span><br><span class="line">00401244  |.  8B0D 8C7C4200 mov     ecx,dword ptr ds:[_environ]</span><br><span class="line">0040124A  |.  890D 907C4200 mov     dword ptr ds:[__initenv],ecx</span><br><span class="line">00401250  |.  8B15 8C7C4200 mov     edx,dword ptr ds:[_environ]</span><br><span class="line">00401256  |.  52            push    edx</span><br><span class="line">00401257  |.  A1 847C4200   mov     eax,dword ptr ds:[__argv]</span><br><span class="line">0040125C  |.  50            push    eax</span><br><span class="line">0040125D  |.  8B0D 807C4200 mov     ecx,dword ptr ds:[__argc]</span><br><span class="line">00401263  |.  51            push    ecx</span><br><span class="line">00401264  |.  E8 A1FDFFFF   call    0040100A</span><br><span class="line">00401269  |.  83C4 0C       add     esp,0xC</span><br><span class="line">0040126C  |.  8945 E4       mov     [local.7],eax</span><br><span class="line">0040126F  |.  8B55 E4       mov     edx,[local.7]</span><br><span class="line">00401272  |.  52            push    edx                              ; /status</span><br><span class="line">00401273  |.  E8 281B0000   call    exit                             ; \exit</span><br><span class="line">00401278  |.  8B45 EC       mov     eax,[local.5]</span><br><span class="line">0040127B  |.  8B08          mov     ecx,dword ptr ds:[eax]</span><br><span class="line">0040127D  |.  8B11          mov     edx,dword ptr ds:[ecx]</span><br><span class="line">0040127F  |.  8955 E0       mov     [local.8],edx</span><br><span class="line">00401282  |.  8B45 EC       mov     eax,[local.5]</span><br><span class="line">00401285  |.  50            push    eax</span><br><span class="line">00401286  |.  8B4D E0       mov     ecx,[local.8]</span><br><span class="line">00401289  |.  51            push    ecx</span><br><span class="line">0040128A  |.  E8 A11C0000   call    _XcptFilter</span><br><span class="line">0040128F  |.  83C4 08       add     esp,0x8</span><br><span class="line">00401292  \.  C3            retn</span><br></pre></td></tr></table></figure>
<h3 id="数据类型"><a class="markdownIt-Anchor" href="#数据类型">#</a> 数据类型</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">基本类型：   	  整数类型</span><br><span class="line">			     浮点类型</span><br><span class="line">整数类型： <span class="type">char</span> <span class="type">short</span> <span class="title function_">int</span><span class="params">(<span class="number">32</span>)</span> <span class="title function_">long</span><span class="params">(<span class="number">32</span>)</span> </span><br><span class="line"></span><br><span class="line"><span class="type">char</span> i = <span class="number">0x12345678</span>;</span><br><span class="line">mov byte ptr [ebp<span class="number">-4</span>],<span class="number">78</span>h</span><br><span class="line"></span><br><span class="line"><span class="type">short</span> k = <span class="number">0x12345678</span>      k = <span class="number">5678</span></span><br><span class="line"></span><br><span class="line">整数类型 <span class="type">unsigned</span> <span class="type">signed</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">char</span>  a = <span class="number">0xFF</span>;    <span class="comment">//不写char默认int</span></span><br><span class="line"><span class="type">char</span> b = <span class="number">0xFF</span>;</span><br><span class="line">在内存中都是FF，但使用时有符号<span class="number">-1</span>，无符号<span class="number">255</span></span><br><span class="line">类型转化，比较大小</span><br><span class="line">    </span><br><span class="line">编译器对于有符号和无符号的jcc编译结果不一样</span><br><span class="line">jz je</span><br><span class="line">    </span><br><span class="line">浮点类型 <span class="type">float</span> <span class="type">double</span></span><br><span class="line"><span class="type">float</span> 存储方式 </span><br><span class="line">符号位      指数部分			尾数部分</span><br><span class="line"><span class="number">31</span><span class="number">-30</span>      <span class="number">30</span><span class="number">-22</span>            <span class="number">22</span><span class="number">-0</span></span><br><span class="line"><span class="type">double</span> 存储方式 </span><br><span class="line">符号位      指数部分			尾数部分</span><br><span class="line"><span class="number">63</span><span class="number">-62</span>      <span class="number">62</span><span class="number">-51</span>            <span class="number">51</span><span class="number">-0</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>将一个 float 型转化为内存存储格式的步骤为:</p>
<p>1、先将这个实数的绝对值化为二进制格式<br>
 2、将这个二进制格式实数的小数点左移或右移 n 位，直到小数点移动到第一个有效数字的右边。</p>
<p>3、从小数点右边第一位开始数出二十三位数字放入第 22 到第 0 位。</p>
<p>4、如果实数是正的，则在第 31 位放入 “0”，否则放入 “1”。</p>
<p>5、如果 n 是左移得到的，说明指数是正的，第 30 位放入 “1”。如果 n 是右移得到的或 n=0，则第 30 位放入 0</p>
<p>6、如果 n 是左移得到的，则将 n 减去 1 后化为二进制，并在左边加 “0” 补足七位，放入第 29 到第 23 位。</p>
<p>如果 n 是右移得到的或 n=0，则将 n 化为二进制后在左边加 “0” 补足七位，再各位求反，再放入第 29 到第 23 位</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">8.25</span><br><span class="line">1.转为二进制数,整数部分除二取余,倒序排列,整数部分乘二取整,正序排列</span><br><span class="line">	1000.01</span><br><span class="line">2.科学计数法,左移+右移-</span><br><span class="line">	1.00001*(2^3)</span><br><span class="line">3.存放尾数,加起来一共23位，不够用0补，补在最后</span><br><span class="line">	00001000000000000000000</span><br><span class="line">4.符号位正0负1</span><br><span class="line">	0</span><br><span class="line">5.指数部分,第一位为位移方向，左移1，右移0.剩下七位是指数二进制-1的值    (或者使用127+x转为二进制填充 )</span><br><span class="line">	10000010</span><br><span class="line">6.拼接</span><br><span class="line">	01000001000001000000000000000000</span><br><span class="line">	41040000</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">0.25</span><br><span class="line"></span><br><span class="line">0.01   -&gt; 1.0</span><br><span class="line">1 * (2^(-2))  右移</span><br><span class="line">FD = -2-1 = -3</span><br><span class="line"></span><br><span class="line">0</span><br><span class="line">0 1111101</span><br><span class="line">00000000000000000000000</span><br><span class="line"></span><br><span class="line">00111110100000000000000000000000</span><br><span class="line"></span><br><span class="line">3E800000</span><br></pre></td></tr></table></figure>
<p>尾数部分长度决定精确度，比如 8.4 的小数部分无限循环</p>
<p>比如 float 精确到 24 位 (尾数 + 科学计数法最前面的 0 或 1)，可以精确到小数点后 6 位</p>
<h3 id="编码"><a class="markdownIt-Anchor" href="#编码">#</a> 编码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">通过两个ASCII表示一个汉字，即为GB2312</span><br><span class="line"></span><br><span class="line">一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节(他称之为高字节）从0xA1用至0xF7，后面一个字(低字节)从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。</span><br><span class="line"></span><br><span class="line">一个char占一个字节，放不下gb2312</span><br><span class="line">gb2312每个字节最高位都是1 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>if</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if-else  /  if - if else else </span><br><span class="line">只会执行其中一种分支</span><br></pre></td></tr></table></figure>
<h3 id="程序内存"><a class="markdownIt-Anchor" href="#程序内存">#</a> 程序内存</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">代码区  可读可执行</span><br><span class="line"></span><br><span class="line">堆栈   参数，局部变量，临时数据</span><br><span class="line"></span><br><span class="line">堆    动态申请，大小可变，可读可写</span><br><span class="line"></span><br><span class="line">全局变量   可读可写,程序运行时分配</span><br><span class="line"></span><br><span class="line">常量区    只读</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>全局变量的特点:<br>
1、全局变量在程序编译完成后地址就已经确定下来了，只要程序启动，全局变量就已经存是否有值取决于声明时是否给定了初始值，如果没有，默认为 0</p>
<p>2、全局变量的值可以被所有函数所修改，里面存储的是最后一次修改的值.</p>
<p>3、全局变量所占内存会一直存在，知道整个进程结束.</p>
<p>4、全局变量的反汇编识别:</p>
<p>MOV 寄存器，byte/word/dword ptr ds: [0x12345678]</p>
<p>通过寄存器的宽度，或者 byte/word/dword 来判断全局变量的宽度</p>
<p>全局变量就是基址</p>
<p>局部变量的特点</p>
<p>1、局部变量在程序编译完成后并没有分配固定的地址.</p>
<p>2、在所属的方法没有被调用时，局部变量并不会分配内存地址，只有调用时才在堆栈中分配内存.</p>
<p>3、当局部变量所属的方法执行先毕后，局部变量所占用的内存将变成垃圾</p>
<p>4、局部变量只能在方法内部使用，函数 A 无法使用函数 B 的局部变量.</p>
<p>5、局部变量的反汇编识别:</p>
<p>判断参数个数</p>
<p>观察调用处的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">push 3</span><br><span class="line">call </span><br></pre></td></tr></table></figure>
<p>找到堆栈平衡的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">call</span><br><span class="line">add esp,0C</span><br><span class="line"></span><br><span class="line">或者函数内部</span><br><span class="line">ret 0xC</span><br></pre></td></tr></table></figure>
<p>1、不考虑 ebp、 esp</p>
<p>2、只找给别人赋值的寄存器 eax/ecx/edx/ebx/esi/edi</p>
<p>3、找到以后追查其来源，如果，该寄存器中的值不是在函数内存赋值的，那一定是传进来的参数.</p>
<p>公式一：寄存器 + ret4 = 参数个数</p>
<p>公式二：寄存器＋[ebp+8] +[ebp+0x] = 参数个数</p>
<h3 id="if语句"><a class="markdownIt-Anchor" href="#if语句">#</a> if 语句</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">int g_n = 10;</span><br><span class="line">void func(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">	if (x&gt;y)</span><br><span class="line">	&#123;</span><br><span class="line">		g_n = x;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mov eax,dword ptr [ebp+8]</span><br><span class="line">cmp eax,dword ptr [ebp+0x0C]</span><br><span class="line">jle func+29h(401049)</span><br><span class="line">mov ecx,dword ptr [ebp+8]</span><br><span class="line">mov dword ptr [424a30],ecx</span><br><span class="line">pop edi   401049</span><br></pre></td></tr></table></figure>
<p>在反汇编中 jcc 的代码和 if 中的判断条件是相反的</p>
<p>还原反汇编</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110133105437.png" alt="image-20230110133105437"></p>
<p>函数内部功能分析:</p>
<p>1、分析参数:[ebp+8] : x   [ebp+0Ch] :Y</p>
<p>2、分析局部变量</p>
<p>3、分析全局变量<br>
 mov dword ptr 004225c4,ecx</p>
<p>4、功能分析<br>
 eax, dword ptr [ebp+8]<br>
cmp eax, dword ptr [ebp+0Ch]</p>
<p>将参数 x 存到到 EAX 中，然后比较 EAX。与参数 Y 的大小如果 x&lt;=Y 那么跳转到 00401059 的位置</p>
<p>否则，将 X 的值存储到全局变量中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">int a</span><br><span class="line">int func(int x, int y)</span><br><span class="line">&#123;</span><br><span class="line">	int var1 = a;</span><br><span class="line">	if(x&lt;=y)</span><br><span class="line">	&#123;</span><br><span class="line">		y = var1 + y;</span><br><span class="line">        a = y;</span><br><span class="line">	&#125;</span><br><span class="line">	ret a</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>if 会有影响寄存器的语句，然后 JCC</p>
<p>if-else 中会有向下跳的 jmp，通过 jmp 跳过 else 之后的代码</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110141055410.png" alt="image-20230110141055410"></p>
<p>1、当每个条件跳转指令要跳转的地址前面都有 jmp 指令</p>
<p>2、这些 jmp 指令跳转的地址都是一样的</p>
<p>3、如果某个分支没有条件判断，则为 else 部分中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line"></span><br><span class="line">void HelloWorld()</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;helloworld&quot;);</span><br><span class="line">	getchar();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int arr[5] = &#123;1,2,3,4,5&#125;;</span><br><span class="line">	arr[6] = (int)HelloWorld;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">004010C0 &gt;/&gt; \55            push    ebp</span><br><span class="line">004010C1  |.  8BEC          mov     ebp,esp</span><br><span class="line">004010C3  |.  83EC 54       sub     esp,0x54</span><br><span class="line">004010C6  |.  53            push    ebx</span><br><span class="line">004010C7  |.  56            push    esi</span><br><span class="line">004010C8  |.  57            push    edi</span><br><span class="line">004010C9  |.  8D7D AC       lea     edi,[local.21]</span><br><span class="line">004010CC  |.  B9 15000000   mov     ecx,0x15</span><br><span class="line">004010D1  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">004010D6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">004010D8  |.  C745 EC 01000&gt;mov     dword ptr ss:[ebp-0x14],0x1</span><br><span class="line">004010DF  |.  C745 F0 02000&gt;mov     [local.4],0x2</span><br><span class="line">004010E6  |.  C745 F4 03000&gt;mov     [local.3],0x3</span><br><span class="line">004010ED  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class="line">004010F4  |.  C745 FC 05000&gt;mov     dword ptr ss:[ebp-0x4],0x5</span><br><span class="line">004010FB  |.  C745 04 05104&gt;mov     dword ptr ss:[ebp+0x4],00401005</span><br><span class="line">00401102  |.  33C0          xor     eax,eax</span><br><span class="line">00401104  |.  5F            pop     edi</span><br><span class="line">00401105  |.  5E            pop     esi</span><br><span class="line">00401106  |.  5B            pop     ebx</span><br><span class="line">00401107  |.  8BE5          mov     esp,ebp</span><br><span class="line">00401109  |.  5D            pop     ebp</span><br><span class="line">0040110A  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0018FF28   CCCCCCCC</span><br><span class="line">0018FF2C   CCCCCCCC</span><br><span class="line">0018FF30   CCCCCCCC</span><br><span class="line">0018FF34   CCCCCCCC</span><br><span class="line">0018FF38   CCCCCCCC</span><br><span class="line">0018FF3C   CCCCCCCC</span><br><span class="line">0018FF40   CCCCCCCC</span><br><span class="line">0018FF44   CCCCCCCC</span><br><span class="line">0018FF48  /0018FF88  ebp</span><br><span class="line">0018FF4C  |004015F9  返回到 88888.&lt;ModuleEntryPoint&gt;+0E9 来自 88888.0040100A</span><br><span class="line"></span><br><span class="line">0018FF28   CCCCCCCC</span><br><span class="line">0018FF2C   CCCCCCCC</span><br><span class="line">0018FF30   CCCCCCCC</span><br><span class="line">0018FF34   00000001</span><br><span class="line">0018FF38   00000002</span><br><span class="line">0018FF3C   00000003</span><br><span class="line">0018FF40   00000004</span><br><span class="line">0018FF44   00000005</span><br><span class="line">0018FF48   0018FF88  ebp</span><br><span class="line">0018FF4C   00401005  88888.00401005</span><br><span class="line"></span><br><span class="line">00401005   . /E9 16000000   jmp     HelloWorld</span><br><span class="line">0040100A   $ |E9 B1000000   jmp     main</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line"></span><br><span class="line">void Func()</span><br><span class="line">&#123;</span><br><span class="line">	int i;</span><br><span class="line">	int arr[5] = &#123;0&#125;;</span><br><span class="line"></span><br><span class="line">	for(i=0;i&lt;=5;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		arr[i]=0;</span><br><span class="line">		printf(&quot;hello world&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Func();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">004010C0 &gt;/&gt; \55            push    ebp</span><br><span class="line">004010C1  |.  8BEC          mov     ebp,esp</span><br><span class="line">004010C3  |.  83EC 40       sub     esp,0x40</span><br><span class="line">004010C6  |.  53            push    ebx</span><br><span class="line">004010C7  |.  56            push    esi</span><br><span class="line">004010C8  |.  57            push    edi</span><br><span class="line">004010C9  |.  8D7D C0       lea     edi,[local.16]</span><br><span class="line">004010CC  |.  B9 10000000   mov     ecx,0x10</span><br><span class="line">004010D1  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">004010D6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">004010D8  |.  E8 32FFFFFF   call    0040100F</span><br><span class="line">004010DD  |.  33C0          xor     eax,eax</span><br><span class="line">004010DF  |.  5F            pop     edi</span><br><span class="line">004010E0  |.  5E            pop     esi</span><br><span class="line">004010E1  |.  5B            pop     ebx</span><br><span class="line">004010E2  |.  83C4 40       add     esp,0x40</span><br><span class="line">004010E5  |.  3BEC          cmp     ebp,esp</span><br><span class="line">004010E7  |.  E8 E4030000   call    _chkesp</span><br><span class="line">004010EC  |.  8BE5          mov     esp,ebp</span><br><span class="line">004010EE  |.  5D            pop     ebp</span><br><span class="line">004010EF  \.  C3            retn</span><br><span class="line"></span><br><span class="line">00401005   . /E9 16000000   jmp     Func</span><br><span class="line">0040100A   $ |E9 B1000000   jmp     main</span><br><span class="line">0040100F  /$ |E9 0C000000   jmp     Func</span><br><span class="line"></span><br><span class="line">00401020 &gt;|&gt; \55            push    ebp</span><br><span class="line">00401021  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401023  |.  83EC 58       sub     esp,0x58</span><br><span class="line">00401026  |.  53            push    ebx</span><br><span class="line">00401027  |.  56            push    esi</span><br><span class="line">00401028  |.  57            push    edi</span><br><span class="line">00401029  |.  8D7D A8       lea     edi,[local.22]</span><br><span class="line">0040102C  |.  B9 16000000   mov     ecx,0x16</span><br><span class="line">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">00401038  |.  C745 E8 00000&gt;mov     [local.6],0x0</span><br><span class="line">0040103F  |.  33C0          xor     eax,eax</span><br><span class="line">00401041  |.  8945 EC       mov     [local.5],eax</span><br><span class="line">00401044  |.  8945 F0       mov     [local.4],eax</span><br><span class="line">00401047  |.  8945 F4       mov     [local.3],eax</span><br><span class="line">0040104A  |.  8945 F8       mov     [local.2],eax</span><br><span class="line">0040104D  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class="line">00401054  |.  EB 09         jmp     short 0040105F</span><br><span class="line">00401056  |&gt;  8B4D FC       /mov     ecx,[local.1]</span><br><span class="line">00401059  |.  83C1 01       |add     ecx,0x1</span><br><span class="line">0040105C  |.  894D FC       |mov     [local.1],ecx</span><br><span class="line">0040105F  |&gt;  837D FC 05     cmp     [local.1],0x5</span><br><span class="line">00401063  |.  7F 1A         |jg      short 0040107F</span><br><span class="line">00401065  |.  8B55 FC       |mov     edx,[local.1]</span><br><span class="line">00401068  |.  C74495 E8 000&gt;|mov     dword ptr ss:[ebp+edx*4-0x18],0&gt;</span><br><span class="line">00401070  |.  68 1C304200   |push    0042301C                        ; /format = &quot;hello world&quot;</span><br><span class="line">00401075  |.  E8 D6030000   |call    printf                          ; \printf</span><br><span class="line">0040107A  |.  83C4 04       |add     esp,0x4</span><br><span class="line">0040107D  |.^ EB D7         \jmp     short 00401056</span><br><span class="line">0040107F  |&gt;  5F            pop     edi</span><br><span class="line">00401080  |.  5E            pop     esi</span><br><span class="line">00401081  |.  5B            pop     ebx</span><br><span class="line">00401082  |.  83C4 58       add     esp,0x58</span><br><span class="line">00401085  |.  3BEC          cmp     ebp,esp</span><br><span class="line">00401087  |.  E8 44040000   call    _chkesp</span><br><span class="line">0040108C  |.  8BE5          mov     esp,ebp</span><br><span class="line">0040108E  |.  5D            pop     ebp</span><br><span class="line">0040108F  \.  C3            retn</span><br><span class="line"></span><br><span class="line">mov     dword ptr ss:[ebp+edx*4-0x18],0 在最后一次循环将ebp-4 = i变为了0，循环条件永远满足</span><br></pre></td></tr></table></figure>
<p>总结:</p>
<p>声明变量就是告诉计算机，我要用一块内存，你给我留着，宽度和存储格式有数据类型决定.</p>
<p>计算机什么时候把这块内存给你，取决于变量的作用范围，如果是全局变量，在程序编译完就已经分配了空间，如果是局所在的程序被调用的时候，才会分配空间.</p>
<p>全局变量如果不赋初始值，默认是 0，但局部变量在使用前一定要赋初值.</p>
<p>类型转换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">movsx   ;先符号扩展再传送</span><br><span class="line">mov al,0x0FF     </span><br><span class="line">movsx cx,al      11111111 11111111 </span><br><span class="line">movsx al,80</span><br><span class="line">movsx cx,al</span><br><span class="line"></span><br><span class="line">movzx</span><br><span class="line">mov al,0x0ff</span><br><span class="line">movzx cx,al</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">int -&gt; short 转换时高位丢失，即从低位开始截取</span><br><span class="line">int a = 0x12345678;</span><br><span class="line">short b = a;     b = 5678</span><br></pre></td></tr></table></figure>
<p>表达式</p>
<p>特点一:</p>
<p>表达式无论多么复杂，都只有一个结果</p>
<p>特点二:</p>
<p>只有表达式，可以编译通过，但并不生成代码，需要与赋值或者其他流程控制语句一起组合的时候才有意义</p>
<p>特点三:</p>
<p>当表达式中存在不同宽度的变量时，结果将转换为宽度最大的那个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">char a = 10;</span><br><span class="line">int b = 20;</span><br><span class="line">printf(&quot;%d&quot;,a+b);   ;a+b为int类型</span><br></pre></td></tr></table></figure>
<p>特点四:</p>
<p>当表达式中同时存在有符号和无符号数的时候，表达式的结构将转换为无符号数.</p>
<p>输出无符号或有符号根据输出的格式 % d 或 % u 决定</p>
<p>int x = a == b;    ;sete  setne</p>
<p>sete cmp 相等时 set 寄存器为 1</p>
<p>if(a) == if(a != 0)</p>
<p>if(!a) == if(a == 0)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">if (x&gt;1 &amp;&amp; x&gt;2 &amp;&amp; x&gt;3)</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;sb&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if (x&gt;1 || x&gt;2 || x&gt;3)</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;sb&quot;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00401020 &gt;/&gt; \55            push    ebp</span><br><span class="line">00401021  |.  8BEC          mov     ebp,esp</span><br><span class="line">00401023  |.  83EC 44       sub     esp,0x44</span><br><span class="line">00401026  |.  53            push    ebx</span><br><span class="line">00401027  |.  56            push    esi</span><br><span class="line">00401028  |.  57            push    edi</span><br><span class="line">00401029  |.  8D7D BC       lea     edi,[local.17]</span><br><span class="line">0040102C  |.  B9 11000000   mov     ecx,0x11</span><br><span class="line">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class="line">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line">00401038  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class="line">0040103F  |.  837D FC 01    cmp     [local.1],0x1</span><br><span class="line">00401043  |.  7E 19         jle     short 0040105E</span><br><span class="line">00401045  |.  837D FC 02    cmp     [local.1],0x2</span><br><span class="line">00401049  |.  7E 13         jle     short 0040105E</span><br><span class="line">0040104B  |.  837D FC 03    cmp     [local.1],0x3</span><br><span class="line">0040104F  |.  7E 0D         jle     short 0040105E</span><br><span class="line">00401051  |.  68 1C304200   push    0042301C                         ; /format = &quot;sb&quot;</span><br><span class="line">00401056  |.  E8 F5030000   call    printf                           ; \printf</span><br><span class="line">0040105B  |.  83C4 04       add     esp,0x4</span><br><span class="line">0040105E  |&gt;  837D FC 01    cmp     [local.1],0x1</span><br><span class="line">00401062  |.  7F 0C         jg      short 00401070</span><br><span class="line">00401064  |.  837D FC 02    cmp     [local.1],0x2</span><br><span class="line">00401068  |.  7F 06         jg      short 00401070</span><br><span class="line">0040106A  |.  837D FC 03    cmp     [local.1],0x3</span><br><span class="line">0040106E  |.  7E 0D         jle     short 0040107D</span><br><span class="line">00401070  |&gt;  68 1C304200   push    0042301C                         ; /format = &quot;sb&quot;</span><br><span class="line">00401075  |.  E8 D6030000   call    printf                           ; \printf</span><br><span class="line">0040107A  |.  83C4 04       add     esp,0x4</span><br><span class="line">0040107D  |&gt;  33C0          xor     eax,eax</span><br><span class="line">0040107F  |.  5F            pop     edi</span><br><span class="line">00401080  |.  5E            pop     esi</span><br><span class="line">00401081  |.  5B            pop     ebx</span><br><span class="line">00401082  |.  83C4 44       add     esp,0x44</span><br><span class="line">00401085  |.  3BEC          cmp     ebp,esp</span><br><span class="line">00401087  |.  E8 44040000   call    _chkesp</span><br><span class="line">0040108C  |.  8BE5          mov     esp,ebp</span><br><span class="line">0040108E  |.  5D            pop     ebp</span><br><span class="line">0040108F  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>C 语言没有 bool，C++ 才有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (x = 0)   //不执行</span><br><span class="line">if (x = 2)   //执行</span><br><span class="line">int a = 3;</span><br><span class="line">if (a == 3)  //执行</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1、将两个变量的值交换.</span><br><span class="line">2、将一个数组中的数倒序输出.</span><br><span class="line">3、找出数组里面最大的值，并返回</span><br><span class="line">4、将数组所有的元素相加，将结果返回</span><br><span class="line">5、将两个等长数组相同位置的值相加，存储到另外一个等长的数组中</span><br><span class="line">6、写一个函数int prime(int x)，如果x是素数返回值为1，否则返回0。</span><br><span class="line">7、俩俩比较数组的值，将最大的一个存储到数组的最后一个位置</span><br><span class="line">8、编写程序实现一个冒泡排序的算法.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="循环语句"><a class="markdownIt-Anchor" href="#循环语句">#</a> 循环语句</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">do...while   性能最高的循环</span><br><span class="line">while </span><br><span class="line">for</span><br><span class="line"></span><br><span class="line">int length = 10</span><br><span class="line">int m = 0</span><br><span class="line">int arr[10] = &#123;   &#125;</span><br><span class="line">while (m &lt; length - 1)</span><br><span class="line">&#123;</span><br><span class="line">	for (int i = 1; i &lt; length-1-m;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		swap(arr[i],arr[i+1]);</span><br><span class="line">	&#125;</span><br><span class="line">	m++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">如果返回值只有8位，使用al返回</span><br><span class="line">ax</span><br><span class="line">eax</span><br><span class="line"></span><br><span class="line">long long 在vc6中对应的是__int64</span><br><span class="line"></span><br><span class="line">__int64 Function()</span><br><span class="line">&#123;</span><br><span class="line">	__int64 x = 0x1234567890;</span><br><span class="line">	return x;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">00401020 &gt;/&gt; \55                    push    ebp</span><br><span class="line">00401021  |.  8BEC                  mov     ebp,esp</span><br><span class="line">00401023  |.  83EC 48               sub     esp,0x48</span><br><span class="line">00401026  |.  53                    push    ebx</span><br><span class="line">00401027  |.  56                    push    esi</span><br><span class="line">00401028  |.  57                    push    edi</span><br><span class="line">00401029  |.  8D7D B8               lea     edi,[local.18]</span><br><span class="line">0040102C  |.  B9 12000000           mov     ecx,0x12</span><br><span class="line">00401031  |.  B8 CCCCCCCC           mov     eax,0xCCCCCCCC</span><br><span class="line">00401036  |.  F3:AB                 rep     stos dword ptr es:[edi]</span><br><span class="line">00401038  |.  C745 F8 90785634      mov     [local.2],0x34567890</span><br><span class="line">0040103F  |.  C745 FC 12000000      mov     [local.1],0x12</span><br><span class="line">00401046  |.  8B45 F8               mov     eax,[local.2]</span><br><span class="line">00401049  |.  8B55 FC               mov     edx,[local.1]</span><br><span class="line">0040104C  |.  5F                    pop     edi</span><br><span class="line">0040104D  |.  5E                    pop     esi</span><br><span class="line">0040104E  |.  5B                    pop     ebx</span><br><span class="line">0040104F  |.  8BE5                  mov     esp,ebp</span><br><span class="line">00401051  |.  5D                    pop     ebp</span><br><span class="line">00401052  \.  C3                    retn</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>参数传递</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">void func(char a,char b,char c)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	char a = 1,b=2,c=3;</span><br><span class="line">	func(a,b,c);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0040D758  |.  C645 FC 01    mov     byte ptr ss:[ebp-0x4],0x1</span><br><span class="line">0040D75C  |.  C645 F8 02    mov     byte ptr ss:[ebp-0x8],0x2</span><br><span class="line">0040D760  |.  C645 F4 03    mov     byte ptr ss:[ebp-0xC],0x3</span><br><span class="line">0040D764  |.  8A45 F4       mov     al,byte ptr ss:[ebp-0xC]</span><br><span class="line">0040D767  |.  50            push    eax</span><br><span class="line">0040D768  |.  8A4D F8       mov     cl,byte ptr ss:[ebp-0x8]</span><br><span class="line">0040D76B  |.  51            push    ecx</span><br><span class="line">0040D76C  |.  8A55 FC       mov     dl,byte ptr ss:[ebp-0x4]</span><br><span class="line">0040D76F  |.  52            push    edx</span><br><span class="line">0040D770  |.  E8 9A38FFFF   call    0040100F</span><br><span class="line">0040D775  |.  83C4 0C       add     esp,0xC</span><br><span class="line"></span><br><span class="line">虽然定义的是char，但在压栈的时候还是会按照四字节的压，所以没法节约空间</span><br><span class="line"></span><br><span class="line">本机尺寸：本机32位，那么对32位的数据支持最好</span><br><span class="line"></span><br><span class="line">编译器遵守这个规则</span><br><span class="line"></span><br><span class="line">传输数据按照本机尺寸传，用还是按照原来大小用</span><br><span class="line"></span><br><span class="line">传参的时候如果是&lt;int的整数，一律使用int类型 </span><br><span class="line"></span><br><span class="line">参数传递的本质:将上层函数的变量，或者表达式的值“复制一份”，传递给下层函数.  可以理解为[ebp-4] 和 [ebp+8]的区别</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>局部变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">空函数会分配40h的缓冲区,如果使用局部变量会在40h的基础上增加，  只适用于vc6-debug</span><br><span class="line"></span><br><span class="line">void func()</span><br><span class="line">&#123;</span><br><span class="line">	char a = 1;</span><br><span class="line">	char b = 2;</span><br><span class="line">&#125;</span><br><span class="line">此时缓冲区分配了48，因为本机尺寸</span><br><span class="line"></span><br><span class="line">1、小于32位的局部变量，空间在分配时，按32位分配.</span><br><span class="line">2、使用时按实际的宽度使用.</span><br><span class="line">3、不要定义char/short类型的局部变量.</span><br><span class="line">4、参数与局部变量没有本质区别，都是局部变量，都在栈中</span><br><span class="line">5、完全可以把参数当初局部变量使用</span><br><span class="line"></span><br><span class="line">参数在执行前分配，局部变量在执行时分配，本质一样</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> a[<span class="number">3</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="number">0040</span>D740 &gt;/&gt; \<span class="number">55</span>            push    ebp</span><br><span class="line"><span class="number">0040</span>D741  |.  <span class="number">8B</span>EC          mov     ebp,esp</span><br><span class="line"><span class="number">0040</span>D743  |.  <span class="number">83</span>EC <span class="number">44</span>       sub     esp,<span class="number">0x44</span></span><br><span class="line"><span class="number">0040</span>D746  |.  <span class="number">53</span>            push    ebx</span><br><span class="line"><span class="number">0040</span>D747  |.  <span class="number">56</span>            push    esi</span><br><span class="line"><span class="number">0040</span>D748  |.  <span class="number">57</span>            push    edi</span><br><span class="line"><span class="number">0040</span>D749  |.  <span class="number">8</span>D7D BC       lea     edi,[local<span class="number">.17</span>]</span><br><span class="line"><span class="number">0040</span>D74C  |.  B9 <span class="number">11000000</span>   mov     ecx,<span class="number">0x11</span></span><br><span class="line"><span class="number">0040</span>D751  |.  B8 CCCCCCCC   mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">0040</span>D756  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">0040</span>D758  |.  C645 FC <span class="number">01</span>    mov     byte ptr ss:[ebp<span class="number">-0x4</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">0040</span>D75C  |.  C645 FD <span class="number">02</span>    mov     byte ptr ss:[ebp<span class="number">-0x3</span>],<span class="number">0x2</span></span><br><span class="line"><span class="number">0040</span>D760  |.  C645 FE <span class="number">03</span>    mov     byte ptr ss:[ebp<span class="number">-0x2</span>],<span class="number">0x3</span></span><br><span class="line"><span class="number">0040</span>D764  |.  <span class="number">5F</span>            pop     edi</span><br><span class="line"><span class="number">0040</span>D765  |.  <span class="number">5</span>E            pop     esi</span><br><span class="line"><span class="number">0040</span>D766  |.  <span class="number">5B</span>            pop     ebx</span><br><span class="line"><span class="number">0040</span>D767  |.  <span class="number">8B</span>E5          mov     esp,ebp</span><br><span class="line"><span class="number">0040</span>D769  |.  <span class="number">5</span>D            pop     ebp</span><br><span class="line"><span class="number">0040</span>D76A  \.  C3            retn</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> a[<span class="number">4</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>&#125;;</span><br><span class="line"><span class="number">0040</span>D740 &gt;/&gt; \<span class="number">55</span>            push    ebp</span><br><span class="line"><span class="number">0040</span>D741  |.  <span class="number">8B</span>EC          mov     ebp,esp</span><br><span class="line"><span class="number">0040</span>D743  |.  <span class="number">83</span>EC <span class="number">44</span>       sub     esp,<span class="number">0x44</span></span><br><span class="line"><span class="number">0040</span>D746  |.  <span class="number">53</span>            push    ebx</span><br><span class="line"><span class="number">0040</span>D747  |.  <span class="number">56</span>            push    esi</span><br><span class="line"><span class="number">0040</span>D748  |.  <span class="number">57</span>            push    edi</span><br><span class="line"><span class="number">0040</span>D749  |.  <span class="number">8</span>D7D BC       lea     edi,[local<span class="number">.17</span>]</span><br><span class="line"><span class="number">0040</span>D74C  |.  B9 <span class="number">11000000</span>   mov     ecx,<span class="number">0x11</span></span><br><span class="line"><span class="number">0040</span>D751  |.  B8 CCCCCCCC   mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">0040</span>D756  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">0040</span>D758  |.  C645 FC <span class="number">01</span>    mov     byte ptr ss:[ebp<span class="number">-0x4</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">0040</span>D75C  |.  C645 FD <span class="number">02</span>    mov     byte ptr ss:[ebp<span class="number">-0x3</span>],<span class="number">0x2</span></span><br><span class="line"><span class="number">0040</span>D760  |.  C645 FE <span class="number">03</span>    mov     byte ptr ss:[ebp<span class="number">-0x2</span>],<span class="number">0x3</span></span><br><span class="line"><span class="number">0040</span>D764  |.  C645 FF <span class="number">04</span>    mov     byte ptr ss:[ebp<span class="number">-0x1</span>],<span class="number">0x4</span></span><br><span class="line"><span class="number">0040</span>D768  |.  <span class="number">5F</span>            pop     edi</span><br><span class="line"><span class="number">0040</span>D769  |.  <span class="number">5</span>E            pop     esi</span><br><span class="line"><span class="number">0040</span>D76A  |.  <span class="number">5B</span>            pop     ebx</span><br><span class="line"><span class="number">0040</span>D76B  |.  <span class="number">8B</span>E5          mov     esp,ebp</span><br><span class="line"><span class="number">0040</span>D76D  |.  <span class="number">5</span>D            pop     ebp</span><br><span class="line"><span class="number">0040</span>D76E  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">数组声明是需要常量来提升堆栈，使用时[]内可以是变量</span><br><span class="line">    </span><br><span class="line"><span class="type">char</span> i[<span class="number">3</span>]  <span class="comment">//缓冲区分配40+4</span></span><br><span class="line"><span class="type">char</span> i[<span class="number">4</span>]  <span class="comment">//缓冲区分配40+4</span></span><br><span class="line"><span class="type">short</span> i[<span class="number">4</span>] <span class="comment">//缓冲区分配40+4*2</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//缓冲区分配是按照本机宽度位数的倍数分配的，参考char[3] 和 char[4]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> y = <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> r;</span><br><span class="line">    <span class="type">int</span> arr[<span class="number">10</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    </span><br><span class="line">    r = arr[<span class="number">1</span>];</span><br><span class="line">    r = arr[x];</span><br><span class="line">    r = arr[x+y];</span><br><span class="line">    r = arr[x*<span class="number">2</span>+y];</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D770 &gt;/&gt; \<span class="number">55</span>                  push    ebp</span><br><span class="line"><span class="number">0040</span>D771  |.  <span class="number">8B</span>EC                mov     ebp,esp</span><br><span class="line"><span class="number">0040</span>D773  |.  <span class="number">83</span>EC <span class="number">74</span>             sub     esp,<span class="number">0x74</span>        ;<span class="number">0x74</span><span class="number">-0x40</span>=<span class="number">0x34</span>=<span class="number">52</span>/<span class="number">4</span>=<span class="number">13</span> = <span class="number">10</span> + <span class="number">1</span> + <span class="number">1</span> + <span class="number">1</span></span><br><span class="line"><span class="number">0040</span>D776  |.  <span class="number">53</span>                  push    ebx</span><br><span class="line"><span class="number">0040</span>D777  |.  <span class="number">56</span>                  push    esi</span><br><span class="line"><span class="number">0040</span>D778  |.  <span class="number">57</span>                  push    edi</span><br><span class="line"><span class="number">0040</span>D779  |.  <span class="number">8</span>D7D <span class="number">8</span>C             lea     edi,[local<span class="number">.29</span>]</span><br><span class="line"><span class="number">0040</span>D77C  |.  B9 <span class="number">1</span>D000000         mov     ecx,<span class="number">0x1D</span></span><br><span class="line"><span class="number">0040</span>D781  |.  B8 CCCCCCCC         mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">0040</span>D786  |.  F3:AB               rep     stos dword ptr es:[edi]</span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D788  |.  C745 FC <span class="number">01000000</span>    mov     [local<span class="number">.1</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">0040</span>D78F  |.  C745 F8 <span class="number">02000000</span>    mov     [local<span class="number">.2</span>],<span class="number">0x2</span></span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D796  |.  C745 CC <span class="number">01000000</span>    mov     [local<span class="number">.13</span>],<span class="number">0x1</span>      ;低地址在上</span><br><span class="line"><span class="number">0040</span>D79D  |.  C745 D0 <span class="number">02000000</span>    mov     [local<span class="number">.12</span>],<span class="number">0x2</span></span><br><span class="line"><span class="number">0040</span>D7A4  |.  C745 D4 <span class="number">03000000</span>    mov     [local<span class="number">.11</span>],<span class="number">0x3</span></span><br><span class="line"><span class="number">0040</span>D7AB  |.  C745 D8 <span class="number">04000000</span>    mov     [local<span class="number">.10</span>],<span class="number">0x4</span></span><br><span class="line"><span class="number">0040</span>D7B2  |.  C745 DC <span class="number">05000000</span>    mov     [local<span class="number">.9</span>],<span class="number">0x5</span></span><br><span class="line"><span class="number">0040</span>D7B9  |.  C745 E0 <span class="number">06000000</span>    mov     [local<span class="number">.8</span>],<span class="number">0x6</span></span><br><span class="line"><span class="number">0040</span>D7C0  |.  C745 E4 <span class="number">07000000</span>    mov     [local<span class="number">.7</span>],<span class="number">0x7</span></span><br><span class="line"><span class="number">0040</span>D7C7  |.  C745 E8 <span class="number">08000000</span>    mov     [local<span class="number">.6</span>],<span class="number">0x8</span></span><br><span class="line"><span class="number">0040</span>D7CE  |.  C745 EC <span class="number">09000000</span>    mov     [local<span class="number">.5</span>],<span class="number">0x9</span></span><br><span class="line"><span class="number">0040</span>D7D5  |.  C745 F0 <span class="number">00000000</span>    mov     [local<span class="number">.4</span>],<span class="number">0x0</span></span><br><span class="line"></span><br><span class="line">;    r = arr[<span class="number">1</span>];</span><br><span class="line"><span class="number">0040</span>D7DC  |.  <span class="number">8B</span>45 D0             mov     eax,[local<span class="number">.12</span>]                                ; 反汇编中写的是定值，直接取值</span><br><span class="line"><span class="number">0040</span>D7DF  |.  <span class="number">8945</span> F4             mov     [local<span class="number">.3</span>],eax                                 ;r = arr[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">;    r = arr[x];</span><br><span class="line"><span class="number">0040</span>D7E2  |.  <span class="number">8B</span>4D FC             mov     ecx,[local<span class="number">.1</span>]									; ecx = <span class="number">1</span>     <span class="number">0x34</span> = <span class="number">52</span></span><br><span class="line"><span class="number">0040</span>D7E5  |.  <span class="number">8B</span>548D CC           mov     edx,dword ptr ss:[ebp+ecx*<span class="number">4</span><span class="number">-0x34</span>]             ; edx = <span class="number">4</span><span class="number">-34</span>=ebp<span class="number">-0x30</span>=[local<span class="number">.12</span>]=<span class="number">2</span></span><br><span class="line"><span class="number">0040</span>D7E9  |.  <span class="number">8955</span> F4             mov     [local<span class="number">.3</span>],edx									; r = <span class="number">2</span></span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D7EC  |.  <span class="number">8B</span>45 FC             mov     eax,[local<span class="number">.1</span>]									; <span class="number">1</span></span><br><span class="line"><span class="number">0040</span>D7EF  |.  <span class="number">0345</span> F8             add     eax,[local<span class="number">.2</span>]									; eax = <span class="number">1</span>+<span class="number">2</span> = <span class="number">3</span></span><br><span class="line"><span class="number">0040</span>D7F2  |.  <span class="number">8B</span>4C85 CC           mov     ecx,dword ptr ss:[ebp+eax*<span class="number">4</span><span class="number">-0x34</span>]				; ecx = [ebp<span class="number">-0x28</span>] = [local<span class="number">.10</span>] = <span class="number">4</span></span><br><span class="line"><span class="number">0040</span>D7F6  |.  <span class="number">894</span>D F4             mov     [local<span class="number">.3</span>],ecx									; r = <span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D7F9  |.  <span class="number">8B</span>55 FC             mov     edx,[local<span class="number">.1</span>]									; edx = <span class="number">1</span></span><br><span class="line"><span class="number">0040</span>D7FC  |.  <span class="number">8B</span>45 F8             mov     eax,[local<span class="number">.2</span>]									; eax = <span class="number">2</span></span><br><span class="line"><span class="number">0040</span>D7FF  |.  <span class="number">8</span>D0C50              lea     ecx,dword ptr ds:[eax+edx*<span class="number">2</span>]					; ecx = <span class="number">4</span></span><br><span class="line"><span class="number">0040</span>D802  |.  <span class="number">8B</span>548D CC           mov     edx,dword ptr ss:[ebp+ecx*<span class="number">4</span><span class="number">-0x34</span>]             ; edx = [local<span class="number">.9</span>] = <span class="number">5</span></span><br><span class="line"><span class="number">0040</span>D806  |.  <span class="number">8955</span> F4             mov     [local<span class="number">.3</span>],edx									; r= <span class="number">5</span></span><br><span class="line"><span class="number">0040</span>D809  |.  <span class="number">5F</span>                  pop     edi</span><br><span class="line"><span class="number">0040</span>D80A  |.  <span class="number">5</span>E                  pop     esi</span><br><span class="line"><span class="number">0040</span>D80B  |.  <span class="number">5B</span>                  pop     ebx</span><br><span class="line"><span class="number">0040</span>D80C  |.  <span class="number">8B</span>E5                mov     esp,ebp</span><br><span class="line"><span class="number">0040</span>D80E  |.  <span class="number">5</span>D                  pop     ebp</span><br><span class="line"><span class="number">0040</span>D80F  \.  C3                  retn</span><br><span class="line"></span><br><span class="line">[ebp+ecx*<span class="number">4</span><span class="number">-0x34</span>]  每次减去<span class="number">0x34</span>的原因，<span class="number">0x34</span> = <span class="number">52</span>，是该函数内所有局部变量一共分配的空间</span><br><span class="line">ecx的值即为数组下标,去对应数组的下标即可取到对应的值,注意下标从<span class="number">0</span>开始</span><br><span class="line"><span class="type">short</span> ecx * <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="type">int</span> a[<span class="number">10</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;     <span class="comment">//后面会用0补</span></span><br><span class="line"></span><br><span class="line">二维数组在汇编中和一维数组存储方式一样</span><br><span class="line">    </span><br><span class="line"><span class="type">int</span> a[<span class="number">3</span>][<span class="number">4</span>] = &#123;[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>],[],[]&#125;     <span class="comment">//编译报错</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">3</span>][<span class="number">4</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;;  <span class="comment">//正常执行</span></span><br><span class="line">多维数组只是用户使用方便，编译后的结果都一样</span><br><span class="line"><span class="type">int</span> a[][<span class="number">4</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;;   <span class="comment">//编译通过，编译器四个一组分配</span></span><br><span class="line"><span class="type">int</span> a[<span class="number">3</span>][] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>&#125;;   <span class="comment">//编译错误</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[<span class="number">5</span>][<span class="number">12</span>] = &#123;&#125;</span><br><span class="line">arr[<span class="number">1</span>][<span class="number">7</span>] = arr[<span class="number">1</span>*<span class="number">12</span>+<span class="number">7</span>];</span><br><span class="line"><span class="type">int</span> arr[<span class="number">5</span>][<span class="number">4</span>][<span class="number">3</span>] = arr[<span class="number">1</span>*<span class="number">4</span>*<span class="number">3</span> + <span class="number">2</span>*<span class="number">3</span> + <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">桶排序</span><br><span class="line"><span class="number">1.</span>找数组中最大的，创建max+<span class="number">1</span>个数的数组</span><br><span class="line"><span class="number">2.</span>下标对应改为出现的次数</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">dui</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a[<span class="number">10</span>] = &#123;<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> max = a[<span class="number">0</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> p = <span class="number">1</span>; p &lt; <span class="number">10</span>; p++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (a[p]&gt;max)</span><br><span class="line">		&#123;</span><br><span class="line">			max = a[p];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,max);</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> b[max] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= max<span class="number">-1</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		b[a[i]]++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= max<span class="number">-1</span>; i++)</span><br><span class="line">	&#123; </span><br><span class="line">		<span class="type">int</span> k = b[i];</span><br><span class="line">		<span class="keyword">if</span> (k &gt; <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">for</span> (<span class="type">int</span> m = k; m&gt;<span class="number">0</span>; m--)</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i);</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	dui();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230113171701402.png" alt="image-20230113171701402"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230114173623044.png" alt="image-20230114173623044"></p>
<h3 id="结构体"><a class="markdownIt-Anchor" href="#结构体">#</a> 结构体</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">B</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">float</span> x;</span><br><span class="line">    <span class="type">float</span> y;</span><br><span class="line">    <span class="type">float</span> z;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">A</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> m_up;</span><br><span class="line">	<span class="type">char</span> m_Name[<span class="number">32</span>];</span><br><span class="line">    <span class="type">int</span> m_Num;</span><br><span class="line">    ...</span><br><span class="line">    B zuobiao;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">A aa;</span><br><span class="line"><span class="comment">// aa + 4 //m_up</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A 通过一级偏移找到B zuobiao</span><br><span class="line">zuobiao通过二级偏移找到xyz</span><br><span class="line">    </span><br><span class="line">结构体在创建时不分配空间</span><br><span class="line">A aa;   此时分配空间</span><br><span class="line">aa.fXpos = <span class="number">2.1</span>;</span><br><span class="line"></span><br><span class="line">结构体在定义的时候，除了自身以外，可以存储任何类型</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">struct AA</span><br><span class="line">&#123;</span><br><span class="line">	int m;</span><br><span class="line">	int n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct  st</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	short b;</span><br><span class="line">	char c;</span><br><span class="line">	int arr[10];</span><br><span class="line">	AA aa;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">st x;</span><br><span class="line"></span><br><span class="line">void func()</span><br><span class="line">&#123;</span><br><span class="line">	x.a = 10;</span><br><span class="line">	x.b = 20;</span><br><span class="line">	x.c = 30;</span><br><span class="line">	x.arr[0] = 100;</span><br><span class="line">	x.aa.m = 22;</span><br><span class="line">&#125;</span><br><span class="line">void func2()</span><br><span class="line">&#123;</span><br><span class="line">	int a1  = x.a;</span><br><span class="line">	int y1 = x.arr[0];</span><br><span class="line">	int y2 = x.aa.m;</span><br><span class="line">&#125;</span><br><span class="line">st func()</span><br><span class="line">&#123;</span><br><span class="line">	st s;</span><br><span class="line">	s.a = 1;</span><br><span class="line">	s.b = 2;</span><br><span class="line">	s.c = 3;</span><br><span class="line">	return s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数组和结构体判断</p>
<p>等宽连续 - 数组</p>
<p>连续不等宽 - 大概率结构体</p>
<p>但结构体中都是相同类型的变量也可以逆成数组</p>
<p>结构体尽量定义为全局变量，减少复制次数，尽量不要当参数和返回值</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 结构体作为全局变量</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">st</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">short</span> b;</span><br><span class="line">	<span class="type">char</span> c;</span><br><span class="line">	<span class="type">int</span> arr[<span class="number">10</span>];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">st x;</span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	x.a = <span class="number">10</span>;</span><br><span class="line">	x.b = <span class="number">20</span>;</span><br><span class="line">	x.c = <span class="number">30</span>;</span><br><span class="line">	x.arr[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	x.arr[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">func2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a1 = x.a;</span><br><span class="line">	<span class="type">int</span> b1 = x.b;</span><br><span class="line">	<span class="type">int</span> c1 = x.c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	func();</span><br><span class="line">	func2();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">00401030</span> &gt;/&gt; \<span class="number">55</span>            push    ebp</span><br><span class="line"><span class="number">00401031</span>  |.  <span class="number">8B</span>EC          mov     ebp,esp</span><br><span class="line"><span class="number">00401033</span>  |.  <span class="number">83</span>EC <span class="number">40</span>       sub     esp,<span class="number">0x40</span></span><br><span class="line"><span class="number">00401036</span>  |.  <span class="number">53</span>            push    ebx</span><br><span class="line"><span class="number">00401037</span>  |.  <span class="number">56</span>            push    esi</span><br><span class="line"><span class="number">00401038</span>  |.  <span class="number">57</span>            push    edi</span><br><span class="line"><span class="number">00401039</span>  |.  <span class="number">8</span>D7D C0       lea     edi,[local<span class="number">.16</span>]</span><br><span class="line"><span class="number">0040103</span>C  |.  B9 <span class="number">10000000</span>   mov     ecx,<span class="number">0x10</span></span><br><span class="line"><span class="number">00401041</span>  |.  B8 CCCCCCCC   mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">00401046</span>  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">00401048</span>  |.  C705 <span class="number">507</span>C4200&gt;mov     dword ptr ds:[<span class="number">0x427C50</span>],<span class="number">0xA</span></span><br><span class="line"><span class="number">00401052</span>  |.  <span class="number">66</span>:C705 <span class="number">547</span>C4&gt;mov     word ptr ds:[<span class="number">0x427C54</span>],<span class="number">0x14</span></span><br><span class="line"><span class="number">0040105B</span>  |.  C605 <span class="number">567</span>C4200&gt;mov     byte ptr ds:[<span class="number">0x427C56</span>],<span class="number">0x1E</span></span><br><span class="line"><span class="number">00401062</span>  |.  C705 <span class="number">587</span>C4200&gt;mov     dword ptr ds:[<span class="number">0x427C58</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">0040106</span>C  |.  C705 <span class="number">5</span>C7C4200&gt;mov     dword ptr ds:[<span class="number">0x427C5C</span>],<span class="number">0x2</span></span><br><span class="line"><span class="number">00401076</span>  |.  <span class="number">5F</span>            pop     edi</span><br><span class="line"><span class="number">00401077</span>  |.  <span class="number">5</span>E            pop     esi</span><br><span class="line"><span class="number">00401078</span>  |.  <span class="number">5B</span>            pop     ebx</span><br><span class="line"><span class="number">00401079</span>  |.  <span class="number">8B</span>E5          mov     esp,ebp</span><br><span class="line"><span class="number">0040107B</span>  |.  <span class="number">5</span>D            pop     ebp</span><br><span class="line"><span class="number">0040107</span>C  \.  C3            retn</span><br><span class="line"></span><br><span class="line"><span class="number">00401090</span> &gt;/&gt; \<span class="number">55</span>            push    ebp</span><br><span class="line"><span class="number">00401091</span>  |.  <span class="number">8B</span>EC          mov     ebp,esp</span><br><span class="line"><span class="number">00401093</span>  |.  <span class="number">83</span>EC <span class="number">4</span>C       sub     esp,<span class="number">0x4C</span></span><br><span class="line"><span class="number">00401096</span>  |.  <span class="number">53</span>            push    ebx</span><br><span class="line"><span class="number">00401097</span>  |.  <span class="number">56</span>            push    esi</span><br><span class="line"><span class="number">00401098</span>  |.  <span class="number">57</span>            push    edi</span><br><span class="line"><span class="number">00401099</span>  |.  <span class="number">8</span>D7D B4       lea     edi,[local<span class="number">.19</span>]</span><br><span class="line"><span class="number">0040109</span>C  |.  B9 <span class="number">13000000</span>   mov     ecx,<span class="number">0x13</span></span><br><span class="line"><span class="number">004010</span>A1  |.  B8 CCCCCCCC   mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">004010</span>A6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">004010</span>A8  |.  A1 <span class="number">507</span>C4200   mov     eax,dword ptr ds:[<span class="number">0x427C50</span>]</span><br><span class="line"><span class="number">004010</span>AD  |.  <span class="number">8945</span> FC       mov     [local<span class="number">.1</span>],eax</span><br><span class="line"><span class="number">004010B</span>0  |.  <span class="number">0F</span>BF0D <span class="number">547</span>C42&gt;movsx   ecx,word ptr ds:[<span class="number">0x427C54</span>]</span><br><span class="line"><span class="number">004010B</span>7  |.  <span class="number">894</span>D F8       mov     [local<span class="number">.2</span>],ecx</span><br><span class="line"><span class="number">004010B</span>A  |.  <span class="number">0F</span>BE15 <span class="number">567</span>C42&gt;movsx   edx,byte ptr ds:[<span class="number">0x427C56</span>]</span><br><span class="line"><span class="number">004010</span>C1  |.  <span class="number">8955</span> F4       mov     [local<span class="number">.3</span>],edx</span><br><span class="line"><span class="number">004010</span>C4  |.  <span class="number">5F</span>            pop     edi</span><br><span class="line"><span class="number">004010</span>C5  |.  <span class="number">5</span>E            pop     esi</span><br><span class="line"><span class="number">004010</span>C6  |.  <span class="number">5B</span>            pop     ebx</span><br><span class="line"><span class="number">004010</span>C7  |.  <span class="number">8B</span>E5          mov     esp,ebp</span><br><span class="line"><span class="number">004010</span>C9  |.  <span class="number">5</span>D            pop     ebp</span><br><span class="line"><span class="number">004010</span>CA  \.  C3            retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//结构体作为局部变量</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Pointer</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> x_pos;</span><br><span class="line">	<span class="type">float</span> y_pos;</span><br><span class="line">	<span class="type">float</span> z_pos;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">st</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">short</span> b;</span><br><span class="line">	<span class="type">char</span> c;</span><br><span class="line">	<span class="type">int</span> arr[<span class="number">10</span>];</span><br><span class="line">	Pointer p1;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	st x;</span><br><span class="line">	x.a = <span class="number">10</span>;</span><br><span class="line">	x.b = <span class="number">20</span>;</span><br><span class="line">	x.c = <span class="number">30</span>;</span><br><span class="line">	x.arr[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	x.arr[<span class="number">1</span>] = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">	x.p1.x_pos = <span class="number">2.1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">func</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">00401020</span> &gt;/&gt; \<span class="number">55</span>                    push    ebp</span><br><span class="line"><span class="number">00401021</span>  |.  <span class="number">8B</span>EC                  mov     ebp,esp</span><br><span class="line"><span class="number">00401023</span>  |.  <span class="number">83</span>EC <span class="number">7</span>C               sub     esp,<span class="number">0x7C</span></span><br><span class="line"><span class="number">00401026</span>  |.  <span class="number">53</span>                    push    ebx</span><br><span class="line"><span class="number">00401027</span>  |.  <span class="number">56</span>                    push    esi</span><br><span class="line"><span class="number">00401028</span>  |.  <span class="number">57</span>                    push    edi</span><br><span class="line"><span class="number">00401029</span>  |.  <span class="number">8</span>D7D <span class="number">84</span>               lea     edi,[local<span class="number">.31</span>]</span><br><span class="line"><span class="number">0040102</span>C  |.  B9 <span class="number">1F</span>000000           mov     ecx,<span class="number">0x1F</span></span><br><span class="line"><span class="number">00401031</span>  |.  B8 CCCCCCCC           mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">00401036</span>  |.  F3:AB                 rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">00401038</span>  |.  C745 C4 <span class="number">0</span>A000000      mov     dword ptr ss:[ebp<span class="number">-0x3C</span>],<span class="number">0xA</span></span><br><span class="line"><span class="number">0040103F</span>  |.  <span class="number">66</span>:C745 C8 <span class="number">1400</span>       mov     word ptr ss:[ebp<span class="number">-0x38</span>],<span class="number">0x14</span></span><br><span class="line"><span class="number">00401045</span>  |.  C645 CA <span class="number">1</span>E            mov     byte ptr ss:[ebp<span class="number">-0x36</span>],<span class="number">0x1E</span></span><br><span class="line"><span class="number">00401049</span>  |.  C745 CC <span class="number">01000000</span>      mov     dword ptr ss:[ebp<span class="number">-0x34</span>],<span class="number">0x1</span></span><br><span class="line"><span class="number">00401050</span>  |.  C745 D0 <span class="number">02000000</span>      mov     dword ptr ss:[ebp<span class="number">-0x30</span>],<span class="number">0x2</span></span><br><span class="line"><span class="number">00401057</span>  |.  C745 F4 <span class="number">66660640</span>      mov     dword ptr ss:[ebp<span class="number">-0xC</span>],<span class="number">0x40066666</span></span><br><span class="line"><span class="number">0040105</span>E  |.  <span class="number">5F</span>                    pop     edi</span><br><span class="line"><span class="number">0040105F</span>  |.  <span class="number">5</span>E                    pop     esi</span><br><span class="line"><span class="number">00401060</span>  |.  <span class="number">5B</span>                    pop     ebx</span><br><span class="line"><span class="number">00401061</span>  |.  <span class="number">8B</span>E5                  mov     esp,ebp</span><br><span class="line"><span class="number">00401063</span>  |.  <span class="number">5</span>D                    pop     ebp</span><br><span class="line"><span class="number">00401064</span>  \.  C3                    retn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//当结构体中变量不等宽时，分空间不再按照本机宽度分</span></span><br><span class="line"><span class="comment">//局部变量int+short+char 还是按照12字节分</span></span><br><span class="line"><span class="comment">//结构体中变量等宽时和局部变量一样</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">st</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">int</span> b;</span><br><span class="line">	<span class="type">int</span> c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	st x;</span><br><span class="line">	x.a = <span class="number">10</span>;</span><br><span class="line">	x.b = <span class="number">20</span>;</span><br><span class="line">	x.c = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">	<span class="type">int</span> b = <span class="number">20</span>;</span><br><span class="line">	<span class="type">int</span> c = <span class="number">30</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func3</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> arr[<span class="number">3</span>] = &#123;<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">func</span>();</span><br><span class="line">	<span class="built_in">func2</span>();</span><br><span class="line">    <span class="built_in">func3</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func</span><br><span class="line"><span class="number">00401020</span> &gt;/&gt; \<span class="number">55</span>                   push    ebp</span><br><span class="line"><span class="number">00401021</span>  |.  <span class="number">8B</span>EC                 mov     ebp,esp</span><br><span class="line"><span class="number">00401023</span>  |.  <span class="number">83</span>EC <span class="number">4</span>C              sub     esp,<span class="number">0x4C</span></span><br><span class="line"><span class="number">00401026</span>  |.  <span class="number">53</span>                   push    ebx</span><br><span class="line"><span class="number">00401027</span>  |.  <span class="number">56</span>                   push    esi</span><br><span class="line"><span class="number">00401028</span>  |.  <span class="number">57</span>                   push    edi</span><br><span class="line"><span class="number">00401029</span>  |.  <span class="number">8</span>D7D B4              lea     edi,[local<span class="number">.19</span>]</span><br><span class="line"><span class="number">0040102</span>C  |.  B9 <span class="number">13000000</span>          mov     ecx,<span class="number">0x13</span></span><br><span class="line"><span class="number">00401031</span>  |.  B8 CCCCCCCC          mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">00401036</span>  |.  F3:AB                rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">00401038</span>  |.  C745 F4 <span class="number">0</span>A000000     mov     [local<span class="number">.3</span>],<span class="number">0xA</span></span><br><span class="line"><span class="number">0040103F</span>  |.  C745 F8 <span class="number">14000000</span>     mov     [local<span class="number">.2</span>],<span class="number">0x14</span></span><br><span class="line"><span class="number">00401046</span>  |.  C745 FC <span class="number">1E000000</span>     mov     [local<span class="number">.1</span>],<span class="number">0x1E</span></span><br><span class="line"><span class="number">0040104</span>D  |.  <span class="number">5F</span>                   pop     edi</span><br><span class="line"><span class="number">0040104</span>E  |.  <span class="number">5</span>E                   pop     esi</span><br><span class="line"><span class="number">0040104F</span>  |.  <span class="number">5B</span>                   pop     ebx</span><br><span class="line"><span class="number">00401050</span>  |.  <span class="number">8B</span>E5                 mov     esp,ebp</span><br><span class="line"><span class="number">00401052</span>  |.  <span class="number">5</span>D                   pop     ebp</span><br><span class="line"><span class="number">00401053</span>  \.  C3                   retn</span><br><span class="line"></span><br><span class="line">func2</span><br><span class="line"><span class="number">00401080</span> &gt;/&gt; \<span class="number">55</span>                   push    ebp</span><br><span class="line"><span class="number">00401081</span>  |.  <span class="number">8B</span>EC                 mov     ebp,esp</span><br><span class="line"><span class="number">00401083</span>  |.  <span class="number">83</span>EC <span class="number">4</span>C              sub     esp,<span class="number">0x4C</span></span><br><span class="line"><span class="number">00401086</span>  |.  <span class="number">53</span>                   push    ebx</span><br><span class="line"><span class="number">00401087</span>  |.  <span class="number">56</span>                   push    esi</span><br><span class="line"><span class="number">00401088</span>  |.  <span class="number">57</span>                   push    edi</span><br><span class="line"><span class="number">00401089</span>  |.  <span class="number">8</span>D7D B4              lea     edi,[local<span class="number">.19</span>]</span><br><span class="line"><span class="number">0040108</span>C  |.  B9 <span class="number">13000000</span>          mov     ecx,<span class="number">0x13</span></span><br><span class="line"><span class="number">00401091</span>  |.  B8 CCCCCCCC          mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">00401096</span>  |.  F3:AB                rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">00401098</span>  |.  C745 FC <span class="number">0</span>A000000     mov     [local<span class="number">.1</span>],<span class="number">0xA</span></span><br><span class="line"><span class="number">0040109F</span>  |.  C745 F8 <span class="number">14000000</span>     mov     [local<span class="number">.2</span>],<span class="number">0x14</span></span><br><span class="line"><span class="number">004010</span>A6  |.  C745 F4 <span class="number">1E000000</span>     mov     [local<span class="number">.3</span>],<span class="number">0x1E</span></span><br><span class="line"><span class="number">004010</span>AD  |.  <span class="number">5F</span>                   pop     edi</span><br><span class="line"><span class="number">004010</span>AE  |.  <span class="number">5</span>E                   pop     esi</span><br><span class="line"><span class="number">004010</span>AF  |.  <span class="number">5B</span>                   pop     ebx</span><br><span class="line"><span class="number">004010B</span>0  |.  <span class="number">8B</span>E5                 mov     esp,ebp</span><br><span class="line"><span class="number">004010B</span>2  |.  <span class="number">5</span>D                   pop     ebp</span><br><span class="line"><span class="number">004010B</span>3  \.  C3                   retn</span><br><span class="line"></span><br><span class="line">func3</span><br><span class="line"><span class="number">004106F</span>0 &gt;/&gt; \<span class="number">55</span>                    push    ebp</span><br><span class="line"><span class="number">004106F</span>1  |.  <span class="number">8B</span>EC                  mov     ebp,esp</span><br><span class="line"><span class="number">004106F</span>3  |.  <span class="number">83</span>EC <span class="number">4</span>C               sub     esp,<span class="number">0x4C</span></span><br><span class="line"><span class="number">004106F</span>6  |.  <span class="number">53</span>                    push    ebx</span><br><span class="line"><span class="number">004106F</span>7  |.  <span class="number">56</span>                    push    esi</span><br><span class="line"><span class="number">004106F</span>8  |.  <span class="number">57</span>                    push    edi</span><br><span class="line"><span class="number">004106F</span>9  |.  <span class="number">8</span>D7D B4               lea     edi,[local<span class="number">.19</span>]</span><br><span class="line"><span class="number">004106F</span>C  |.  B9 <span class="number">13000000</span>   		mov     ecx,<span class="number">0x13</span></span><br><span class="line"><span class="number">00410701</span>  |.  B8 CCCCCCCC   		mov     eax,<span class="number">0xCCCCCCCC</span></span><br><span class="line"><span class="number">00410706</span>  |.  F3:AB         		rep     stos dword ptr es:[edi]</span><br><span class="line"><span class="number">00410708</span>  |.  C745 F4 <span class="number">0</span>A000&gt;		mov     [local<span class="number">.3</span>],<span class="number">0xA</span></span><br><span class="line"><span class="number">0041070F</span>  |.  C745 F8 <span class="number">14000</span>&gt;		mov     [local<span class="number">.2</span>],<span class="number">0x14</span></span><br><span class="line"><span class="number">00410716</span>  |.  C745 FC <span class="number">1E000</span>&gt;		mov     [local<span class="number">.1</span>],<span class="number">0x1E</span></span><br><span class="line"><span class="number">0041071</span>D  |.  <span class="number">5F</span>            		pop     edi</span><br><span class="line"><span class="number">0041071</span>E  |.  <span class="number">5</span>E            		pop     esi</span><br><span class="line"><span class="number">0041071F</span>  |.  <span class="number">5B</span>            		pop     ebx</span><br><span class="line"><span class="number">00410720</span>  |.  <span class="number">8B</span>E5          		mov     esp,ebp</span><br><span class="line"><span class="number">00410722</span>  |.  <span class="number">5</span>D            		pop     ebp</span><br><span class="line"><span class="number">00410723</span>  \.  C3            		retn</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结构体可以作为参数和返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">struct st</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	short b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void func(st x)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	st x;</span><br><span class="line">	x.a = 1;</span><br><span class="line">	x.b = 2;</span><br><span class="line">	x.c = 3;</span><br><span class="line">	func(x);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00401040 55                   push        ebp</span><br><span class="line">00401041 8B EC                mov         ebp,esp</span><br><span class="line">00401043 83 EC 48             sub         esp,48h</span><br><span class="line">00401046 53                   push        ebx</span><br><span class="line">00401047 56                   push        esi</span><br><span class="line">00401048 57                   push        edi</span><br><span class="line">00401049 8D 7D B8             lea         edi,[ebp-48h]</span><br><span class="line">0040104C B9 12 00 00 00       mov         ecx,12h</span><br><span class="line">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">00401058 C7 45 F8 01 00 00 00 mov         dword ptr [ebp-8],1</span><br><span class="line">0040105F 66 C7 45 FC 02 00    mov         word ptr [ebp-4],offset main+23h (00401063)</span><br><span class="line">00401065 C6 45 FE 03          mov         byte ptr [ebp-2],3</span><br><span class="line">00401069 8B 45 FC             mov         eax,dword ptr [ebp-4]</span><br><span class="line">0040106C 50                   push        eax</span><br><span class="line">0040106D 8B 4D F8             mov         ecx,dword ptr [ebp-8]</span><br><span class="line">00401070 51                   push        ecx</span><br><span class="line">00401071 E8 A3 FF FF FF       call        @ILT+20(func) (00401019)</span><br><span class="line">00401076 83 C4 08             add         esp,8</span><br><span class="line">00401079 33 C0                xor         eax,eax</span><br><span class="line">0040107B 5F                   pop         edi</span><br><span class="line">0040107C 5E                   pop         esi</span><br><span class="line">0040107D 5B                   pop         ebx</span><br><span class="line">0040107E 83 C4 48             add         esp,48h</span><br><span class="line">00401081 3B EC                cmp         ebp,esp</span><br><span class="line">00401083 E8 E8 00 00 00       call        __chkesp (00401170)</span><br><span class="line">00401088 8B E5                mov         esp,ebp</span><br><span class="line">0040108A 5D                   pop         ebp</span><br><span class="line">0040108B C3                   ret</span><br><span class="line"></span><br><span class="line">ebp-4</span><br><span class="line">0018FF44  02 00 03 CC 88 FF 18</span><br><span class="line">ebp-8</span><br><span class="line">0018FF40  01 00 00 00 02 00 03</span><br><span class="line">第二次push的时候把short和char一起push了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct st</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">	int c;</span><br><span class="line">	int d;</span><br><span class="line">	int e;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void func(st x)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	st x;</span><br><span class="line">	x.a = 1;</span><br><span class="line">	x.b = 2;</span><br><span class="line">	x.c = 3;</span><br><span class="line">	x.d = 4;</span><br><span class="line">	x.e = 5;</span><br><span class="line">	func(x);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">00401040 55                   push        ebp</span><br><span class="line">00401041 8B EC                mov         ebp,esp</span><br><span class="line">00401043 83 EC 54             sub         esp,54h</span><br><span class="line">00401046 53                   push        ebx</span><br><span class="line">00401047 56                   push        esi</span><br><span class="line">00401048 57                   push        edi</span><br><span class="line">00401049 8D 7D AC             lea         edi,[ebp-54h]</span><br><span class="line">0040104C B9 15 00 00 00       mov         ecx,15h</span><br><span class="line">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">00401058 C7 45 EC 01 00 00 00 mov         dword ptr [ebp-14h],1</span><br><span class="line">0040105F C7 45 F0 02 00 00 00 mov         dword ptr [ebp-10h],2</span><br><span class="line">00401066 C7 45 F4 03 00 00 00 mov         dword ptr [ebp-0Ch],3</span><br><span class="line">0040106D C7 45 F8 04 00 00 00 mov         dword ptr [ebp-8],4</span><br><span class="line">00401074 C7 45 FC 05 00 00 00 mov         dword ptr [ebp-4],5</span><br><span class="line">0040107B 83 EC 14             sub         esp,14h</span><br><span class="line">0040107E B9 05 00 00 00       mov         ecx,5</span><br><span class="line">00401083 8D 75 EC             lea         esi,[ebp-14h]</span><br><span class="line">00401086 8B FC                mov         edi,esp</span><br><span class="line">00401088 F3 A5                rep movs    dword ptr [edi],dword ptr [esi]</span><br><span class="line">0040108A E8 8A FF FF FF       call        @ILT+20(func) (00401019)</span><br><span class="line">0040108F 83 C4 14             add         esp,14h</span><br><span class="line">00401092 33 C0                xor         eax,eax</span><br><span class="line">00401094 5F                   pop         edi</span><br><span class="line">00401095 5E                   pop         esi</span><br><span class="line">00401096 5B                   pop         ebx</span><br><span class="line">00401097 83 C4 54             add         esp,54h</span><br><span class="line">0040109A 3B EC                cmp         ebp,esp</span><br><span class="line">0040109C E8 CF 00 00 00       call        __chkesp (00401170)</span><br><span class="line">004010A1 8B E5                mov         esp,ebp</span><br><span class="line">004010A3 5D                   pop         ebp</span><br><span class="line">004010A4 C3                   ret</span><br><span class="line"></span><br><span class="line">此时传参和push原理一样，此时先把所有堆栈提升，再填充提升的堆栈</span><br><span class="line">结构体传参通过堆栈传参</span><br></pre></td></tr></table></figure>
<p>结构体作为返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">00401040 55                   push        ebp</span><br><span class="line">00401041 8B EC                mov         ebp,esp</span><br><span class="line">00401043 83 EC 70             sub         esp,70h</span><br><span class="line">00401046 53                   push        ebx</span><br><span class="line">00401047 56                   push        esi</span><br><span class="line">00401048 57                   push        edi</span><br><span class="line">00401049 8D 7D 90             lea         edi,[ebp-70h]</span><br><span class="line">0040104C B9 1C 00 00 00       mov         ecx,1Ch</span><br><span class="line">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">00401058 8D 45 D0             lea         eax,[ebp-30h]</span><br><span class="line">0040105B 50                   push        eax</span><br><span class="line">0040105C E8 BD FF FF FF       call        @ILT+25(func3) (0040101e)</span><br><span class="line">00401061 83 C4 04             add         esp,4</span><br><span class="line"></span><br><span class="line">00401064 8B 08                mov         ecx,dword ptr [eax]</span><br><span class="line">00401066 89 4D E0             mov         dword ptr [ebp-20h],ecx</span><br><span class="line">00401069 8B 50 04             mov         edx,dword ptr [eax+4]</span><br><span class="line">0040106C 89 55 E4             mov         dword ptr [ebp-1Ch],edx</span><br><span class="line">0040106F 8B 48 08             mov         ecx,dword ptr [eax+8]</span><br><span class="line">00401072 89 4D E8             mov         dword ptr [ebp-18h],ecx</span><br><span class="line">00401075 8B 50 0C             mov         edx,dword ptr [eax+0Ch]</span><br><span class="line">00401078 89 55 EC             mov         dword ptr [ebp-14h],edx</span><br><span class="line">0040107B 8B 45 E0             mov         eax,dword ptr [ebp-20h]</span><br><span class="line">0040107E 89 45 F0             mov         dword ptr [ebp-10h],eax</span><br><span class="line">00401081 8B 4D E4             mov         ecx,dword ptr [ebp-1Ch]</span><br><span class="line">00401084 89 4D F4             mov         dword ptr [ebp-0Ch],ecx</span><br><span class="line">00401087 8B 55 E8             mov         edx,dword ptr [ebp-18h]</span><br><span class="line">0040108A 89 55 F8             mov         dword ptr [ebp-8],edx</span><br><span class="line">0040108D 8B 45 EC             mov         eax,dword ptr [ebp-14h]</span><br><span class="line">00401090 89 45 FC             mov         dword ptr [ebp-4],eax</span><br><span class="line">00401093 33 C0                xor         eax,eax</span><br><span class="line">00401095 5F                   pop         edi</span><br><span class="line">00401096 5E                   pop         esi</span><br><span class="line">00401097 5B                   pop         ebx</span><br><span class="line">00401098 83 C4 70             add         esp,70h</span><br><span class="line">0040109B 3B EC                cmp         ebp,esp</span><br><span class="line">0040109D E8 CE 00 00 00       call        __chkesp (00401170)</span><br><span class="line">004010A2 8B E5                mov         esp,ebp</span><br><span class="line">004010A4 5D                   pop         ebp</span><br><span class="line">004010A5 C3                   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">004106F0 55                   push        ebp</span><br><span class="line">004106F1 8B EC                mov         ebp,esp</span><br><span class="line">004106F3 83 EC 50             sub         esp,50h</span><br><span class="line">004106F6 53                   push        ebx</span><br><span class="line">004106F7 56                   push        esi</span><br><span class="line">004106F8 57                   push        edi</span><br><span class="line">004106F9 8D 7D B0             lea         edi,[ebp-50h]</span><br><span class="line">004106FC B9 14 00 00 00       mov         ecx,14h</span><br><span class="line">00410701 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">00410706 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">00410708 C7 45 F0 01 00 00 00 mov         dword ptr [ebp-10h],1</span><br><span class="line">0041070F 66 C7 45 F4 02 00    mov         word ptr [ebp-0Ch],offset func+23h (00410713)</span><br><span class="line">00410715 C6 45 F6 03          mov         byte ptr [ebp-0Ah],3</span><br><span class="line">00410719 C7 45 F8 04 00 00 00 mov         dword ptr [ebp-8],4</span><br><span class="line">00410720 C7 45 FC 05 00 00 00 mov         dword ptr [ebp-4],5</span><br><span class="line"></span><br><span class="line">00410727 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class="line">0041072A 8B 4D F0             mov         ecx,dword ptr [ebp-10h]</span><br><span class="line">0041072D 89 08                mov         dword ptr [eax],ecx</span><br><span class="line">0041072F 8B 55 F4             mov         edx,dword ptr [ebp-0Ch]</span><br><span class="line">00410732 89 50 04             mov         dword ptr [eax+4],edx</span><br><span class="line">00410735 8B 4D F8             mov         ecx,dword ptr [ebp-8]</span><br><span class="line">00410738 89 48 08             mov         dword ptr [eax+8],ecx</span><br><span class="line">0041073B 8B 55 FC             mov         edx,dword ptr [ebp-4]</span><br><span class="line">0041073E 89 50 0C             mov         dword ptr [eax+0Ch],edx</span><br><span class="line">00410741 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class="line"></span><br><span class="line">00410744 5F                   pop         edi</span><br><span class="line">00410745 5E                   pop         esi</span><br><span class="line">00410746 5B                   pop         ebx</span><br><span class="line">00410747 8B E5                mov         esp,ebp</span><br><span class="line">00410749 5D                   pop         ebp</span><br><span class="line">0041074A C3                   ret</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>总结：如果不用指针，别声明结构体为局部变量，别把结构体当做返回值和参数</p>
<hr>
<p>sizeof</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">sizeof(char);</span><br><span class="line"></span><br><span class="line">char arr1[10]</span><br><span class="line">short arr2[10]   //20</span><br><span class="line">int arr3[10]     //40</span><br><span class="line"></span><br><span class="line">sizeof(arr1)     //10</span><br><span class="line">sizeof(arr1[10])   //1</span><br><span class="line"></span><br><span class="line">struct s1</span><br><span class="line">&#123;</span><br><span class="line">	char a;</span><br><span class="line">	int b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;   //12</span><br><span class="line">a 0 0 0</span><br><span class="line">b b b b</span><br><span class="line">c 0 0 0</span><br><span class="line">struct s2</span><br><span class="line">&#123;</span><br><span class="line">	int c;</span><br><span class="line">	char a;</span><br><span class="line">	char b;</span><br><span class="line">&#125;;   //8</span><br><span class="line">c c c c</span><br><span class="line">a b 0 0</span><br><span class="line"></span><br><span class="line">sizeof(s1);    //12</span><br><span class="line">sizeof(s2);    //8</span><br><span class="line"></span><br><span class="line">对齐参数：结构体中参数以几字节对齐,取值1,2,4,8 默认为8</span><br><span class="line">#pragma pack(1)</span><br><span class="line">struct ha</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	__int64 b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;</span><br><span class="line">#pragma pack()</span><br><span class="line">sizeof(ha)   //13</span><br><span class="line"></span><br><span class="line">如果这个值比结构体成员的sizeof值小，那么该成员的偏移量应该以此值为准，即是说，结构体成员的偏移量应该取二者的最小值.</span><br><span class="line"></span><br><span class="line">#pragma pack(2)</span><br><span class="line">struct ha</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	__int64 b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;</span><br><span class="line">#pragma pack()</span><br><span class="line">sizeof(ha)   //14</span><br><span class="line"></span><br><span class="line">#pragma pack(4)</span><br><span class="line">struct ha</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	__int64 b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;</span><br><span class="line">#pragma pack()</span><br><span class="line">sizeof(ha)   //16</span><br><span class="line"></span><br><span class="line">#pragma pack(4)</span><br><span class="line">struct ha</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	__int64 b;</span><br><span class="line">	char c;</span><br><span class="line">&#125;;</span><br><span class="line">#pragma pack()</span><br><span class="line">sizeof(ha)   //24</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122135557244.png" alt="image-20230122135557244"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122140313752.png" alt="image-20230122140313752"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122140354031.png" alt="image-20230122140354031"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">对齐原则</span><br><span class="line">原则一:数据成员对齐规则。结构的数据成员，第一个数据成员放在offset为0的地方，以后每个数据成员存储的起始位置要从该成员大小的整数倍开始(比如int在32位机为4字节，则要从4的整数倍地址开始存储).</span><br><span class="line">原则二:结构体的总大小，也就是sizeof的结果，必须是其内部最大成员的整数倍，不足的要补齐。</span><br><span class="line">原则三:如果一个结构里有某些结构体成员，则结构体成员要从其内部最大元素大小的整数倍地址开始存储。(struct a里存有struct b， b里有char，int，double等元素，那b应该从8的整数倍开始存储.)</span><br><span class="line">原则四:对齐参数如果比结构体成员的sizeof值小，该成员的偏移量应该以此值为准.也就是说，结构体成员的偏移量应该取二者的最小值.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122141122230.png" alt="image-20230122141122230"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142241459.png" alt="image-20230122142241459"></p>
<p>取结构体中变量最大的和默认相比，取小的</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142505891.png" alt="image-20230122142505891"></p>
<p><strong>按照数据型由小到大的顺序进行书写</strong></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142714801.png" alt="image-20230122142714801"></p>
<p>嵌套结构体按照嵌套的结构体中变量最大的是对齐宽度，但结构体还是按照原来大小累加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">struct S1</span><br><span class="line">&#123;</span><br><span class="line">	//16</span><br><span class="line">	char c;</span><br><span class="line">	double i;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct S3</span><br><span class="line">&#123;</span><br><span class="line">	//32</span><br><span class="line">	char c1;</span><br><span class="line">	S1 s;</span><br><span class="line">	char c2;</span><br><span class="line">	char c3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct S4</span><br><span class="line">&#123;</span><br><span class="line">	//40</span><br><span class="line">	char c1;</span><br><span class="line">	S1 s;</span><br><span class="line">	char c2;</span><br><span class="line">	double c3;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct S5</span><br><span class="line">&#123;</span><br><span class="line">	//16</span><br><span class="line">	int c1;</span><br><span class="line">	char c2[10];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	printf(&quot;%d %d %d %d %d\n&quot;,sizeof(S1),sizeof(S3),sizeof(S4),sizeof(S5),sizeof(1));</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="typedef"><a class="markdownIt-Anchor" href="#typedef">#</a> typedef</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">typedef为C语言的关键字，作用是为一种数据类型定义一个新名字。这里的数据类型包括内部数据类型(int, char等)和自定</span><br><span class="line"></span><br><span class="line">typedef unsigned char BYTE;</span><br><span class="line"></span><br><span class="line">typedef int vector[10];</span><br><span class="line">vector v;</span><br><span class="line">v[0] = 1;</span><br><span class="line"></span><br><span class="line">typedef struct student</span><br><span class="line">&#123;</span><br><span class="line">	char a[10];</span><br><span class="line">&#125;stu;</span><br><span class="line">main()</span><br><span class="line">&#123;</span><br><span class="line">	stu s;</span><br><span class="line">	s.a[0] = &#x27;a&#x27;;</span><br><span class="line">	s.a[1] = &#x27;b&#x27;;</span><br><span class="line">	s.a[2] = &#x27;c&#x27;;</span><br><span class="line">	s.a[3] = &#x27;\0&#x27;;  //s.a[3] = 0;   \0和0都是结束符号</span><br><span class="line">	printf(&quot;%s&quot;,s.arr);    //abc</span><br><span class="line">	</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">stu 是 student结构体的别名，两个都可以使用</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#include &quot;string.h&quot;</span><br><span class="line">strcpy(s.arr,&quot;china&quot;);</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">nPos</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">float</span> x;</span><br><span class="line">	<span class="type">float</span> y;</span><br><span class="line">	<span class="type">float</span> z;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Monster</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> id;</span><br><span class="line">	<span class="type">char</span> name[<span class="number">32</span>];</span><br><span class="line">	<span class="type">int</span> Hp;</span><br><span class="line">	<span class="type">int</span> blue;</span><br><span class="line">	nPos pos;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Monster mon[<span class="number">10</span>];   <span class="comment">//结构体数组</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">value</span><span class="params">(<span class="type">int</span> n,<span class="type">char</span> *name,<span class="type">int</span> hp,<span class="type">int</span> blue, <span class="type">float</span> x,<span class="type">float</span> y,<span class="type">float</span> z)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	mon[i].name = name;</span><br><span class="line">	mon[i].pos.x = x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">find</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">9</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mon[i].id == x)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="switch"><a class="markdownIt-Anchor" href="#switch">#</a> Switch</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123104349398.png" alt="image-20230123104349398"></p>
<p>case 后面必须是常量表达式</p>
<p>case 后常量表达式的值不能一样</p>
<p>switch 后面表达式必须为整数</p>
<p>没有 break 时会顺序向下执行，直到遇到 break</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	func(<span class="number">2</span>);     <span class="comment">//2</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">(<span class="type">int</span> x)</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line"></span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	func(<span class="number">2</span>);   <span class="comment">//234</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//表达式都不成立执行default，default可以省略但不建议</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>switch 反汇编分析</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">func</span>(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">00401020</span> <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">00401021</span> <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">00401023</span> <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">00401026</span> <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">00401027</span> <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">00401028</span> <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">00401029</span> <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040102</span>C B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">00401031</span> B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">00401036</span> F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"></span><br><span class="line"><span class="number">00401038</span> <span class="number">8B</span> <span class="number">45</span> <span class="number">08</span>             mov         eax,dword ptr [ebp+<span class="number">8</span>]</span><br><span class="line"><span class="number">0040103B</span> <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040103</span>E <span class="number">83</span> <span class="number">7</span>D FC <span class="number">01</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">1</span></span><br><span class="line"><span class="number">00401042</span> <span class="number">74</span> <span class="number">0</span>E                je          func+<span class="number">32</span>h (<span class="number">00401052</span>)</span><br><span class="line"></span><br><span class="line"><span class="number">00401044</span> <span class="number">83</span> <span class="number">7</span>D FC <span class="number">02</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">2</span></span><br><span class="line"><span class="number">00401048</span> <span class="number">74</span> <span class="number">17</span>                je          func+<span class="number">41</span>h (<span class="number">00401061</span>)</span><br><span class="line"><span class="number">0040104</span>A <span class="number">83</span> <span class="number">7</span>D FC <span class="number">03</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">3</span></span><br><span class="line"><span class="number">0040104</span>E <span class="number">74</span> <span class="number">20</span>                je          func+<span class="number">50</span>h (<span class="number">00401070</span>)</span><br><span class="line"><span class="number">00401050</span> EB <span class="number">2</span>D                jmp         func+<span class="number">5F</span>h (<span class="number">0040107f</span>)</span><br><span class="line"><span class="number">00401052</span> <span class="number">68</span> <span class="number">28</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;1&quot;</span> (<span class="number">00422028</span>)</span><br><span class="line"><span class="number">00401057</span> E8 E4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="function">call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040105C 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040105F EB 2B                jmp         func+6<span class="title">Ch</span> <span class="params">(<span class="number">0040108</span>c)</span></span></span><br><span class="line"><span class="function">00401061 68 24 20 42 00       push        offset string &quot;2&quot; <span class="params">(<span class="number">00422024</span>)</span></span></span><br><span class="line"><span class="function">00401066 E8 D5 00 00 00       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040106B 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040106E EB 1C                jmp         func+6<span class="title">Ch</span> <span class="params">(<span class="number">0040108</span>c)</span></span></span><br><span class="line"><span class="function">00401070 68 20 20 42 00       push        offset string &quot;4&quot; <span class="params">(<span class="number">00422020</span>)</span></span></span><br><span class="line"><span class="function">00401075 E8 C6 00 00 00       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040107A 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040107D EB 0D                jmp         func+6<span class="title">Ch</span> <span class="params">(<span class="number">0040108</span>c)</span></span></span><br><span class="line"><span class="function">0040107F 68 1C 20 42 00       push        offset string &quot;5&quot; <span class="params">(<span class="number">0042201</span>c)</span></span></span><br><span class="line"><span class="function">00401084 E8 B7 00 00 00       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">00401089 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040108C 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040108D 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040108E 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040108F 83 C4 44             add         esp,44h</span></span><br><span class="line"><span class="function">00401092 3B EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function">00401094 E8 27 01 00 00       call        __<span class="title">chkesp</span> <span class="params">(<span class="number">004011</span>c0)</span></span></span><br><span class="line"><span class="function">00401099 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040109B 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040109C C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="comment">//分支条件比较少时&lt;4和if-else反汇编类似</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="comment">//分支大于4时在内存中生成大表  [edx*4+4010B1h]通过寻址</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">func</span>(<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line"><span class="number">00401020</span> <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">00401021</span> <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">00401023</span> <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">00401026</span> <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">00401027</span> <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">00401028</span> <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">00401029</span> <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040102</span>C B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">00401031</span> B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">00401036</span> F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"><span class="number">00401038</span> <span class="number">8B</span> <span class="number">45</span> <span class="number">08</span>             mov         eax,dword ptr [ebp+<span class="number">8</span>]</span><br><span class="line"><span class="number">0040103B</span> <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040103</span>E <span class="number">8B</span> <span class="number">4</span>D FC             mov         ecx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">00401041</span> <span class="number">83</span> E9 <span class="number">01</span>             sub         ecx,<span class="number">1</span></span><br><span class="line"><span class="number">00401044</span> <span class="number">89</span> <span class="number">4</span>D FC             mov         dword ptr [ebp<span class="number">-4</span>],ecx</span><br><span class="line"><span class="number">00401047</span> <span class="number">83</span> <span class="number">7</span>D FC <span class="number">03</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">3</span></span><br><span class="line"><span class="number">0040104B</span> <span class="number">77</span> <span class="number">46</span>                ja          $L539+<span class="number">0F</span>h (<span class="number">00401093</span>)</span><br><span class="line"><span class="number">0040104</span>D <span class="number">8B</span> <span class="number">55</span> FC             mov         edx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">00401050</span> FF <span class="number">24</span> <span class="number">95</span> B1 <span class="number">10</span> <span class="number">40</span> <span class="number">00</span> jmp         dword ptr [edx*<span class="number">4</span>+<span class="number">4010B</span>1h]</span><br><span class="line">$L533:</span><br><span class="line"><span class="number">00401057</span> <span class="number">68</span> <span class="number">2</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;1&quot;</span> (<span class="number">0042202</span>c)</span><br><span class="line"><span class="number">0040105</span>C E8 DF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       <span class="function">call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">00401061 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">00401064 EB 3A                jmp         $L539+1<span class="title">Ch</span> <span class="params">(<span class="number">004010</span>a0)</span></span></span><br><span class="line"><span class="function">$L535:</span></span><br><span class="line"><span class="function"><span class="number">00401066</span> <span class="number">68</span> <span class="number">28</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;2&quot;</span> (<span class="number">00422028</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040106B</span> E8 D0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">00401070</span> <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">00401073</span> EB <span class="number">2B</span>                jmp         $L539+<span class="number">1</span>Ch (<span class="number">004010</span>a0)</span></span><br><span class="line"><span class="function">$L537:</span></span><br><span class="line"><span class="function"><span class="number">00401075</span> <span class="number">68</span> <span class="number">24</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;3&quot;</span> (<span class="number">00422024</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040107</span>A E8 C1 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040107F</span> <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">00401082</span> EB <span class="number">1</span>C                jmp         $L539+<span class="number">1</span>Ch (<span class="number">004010</span>a0)</span></span><br><span class="line"><span class="function">$L539:</span></span><br><span class="line"><span class="function"><span class="number">00401084</span> <span class="number">68</span> <span class="number">20</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;4&quot;</span> (<span class="number">00422020</span>)</span></span><br><span class="line"><span class="function"><span class="number">00401089</span> E8 B2 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040108</span>E <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">00401091</span> EB <span class="number">0</span>D                jmp         $L539+<span class="number">1</span>Ch (<span class="number">004010</span>a0)</span></span><br><span class="line"><span class="function"><span class="number">00401093</span> <span class="number">68</span> <span class="number">1</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;5&quot;</span> (<span class="number">0042201</span>c)</span></span><br><span class="line"><span class="function"><span class="number">00401098</span> E8 A3 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040109</span>D <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">004010</span>A0 <span class="number">5F</span>                   pop         edi</span></span><br><span class="line"><span class="function"><span class="number">004010</span>A1 <span class="number">5</span>E                   pop         esi</span></span><br><span class="line"><span class="function"><span class="number">004010</span>A2 <span class="number">5B</span>                   pop         ebx</span></span><br><span class="line"><span class="function"><span class="number">004010</span>A3 <span class="number">83</span> C4 <span class="number">44</span>             add         esp,<span class="number">44</span>h</span></span><br><span class="line"><span class="function"><span class="number">004010</span>A6 <span class="number">3B</span> EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function"><span class="number">004010</span>A8 E8 <span class="number">13</span> <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>       call        __chkesp (<span class="number">004011</span>c0)</span></span><br><span class="line"><span class="function"><span class="number">004010</span>AD <span class="number">8B</span> E5                mov         esp,ebp</span></span><br><span class="line"><span class="function"><span class="number">004010</span>AF <span class="number">5</span>D                   pop         ebp</span></span><br><span class="line"><span class="function"><span class="number">004010B</span>0 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">//case顺序交换不影响大表的生成，即可以是无序的</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123113122801.png" alt="image-20230123113122801"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只要case连续且数目足够就会生成大表</span></span><br><span class="line"><span class="comment">//case连续没有空缺</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">301</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">302</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">303</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">304</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;4&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">305</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;5&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">306</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;6&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">307</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;7&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">308</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">309</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">310</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;sb&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D7D0 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D7D1 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D7D3 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D7D6 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D7D7 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D7D8 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D7D9 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D7DC B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"><span class="number">0040</span>D7E8 <span class="number">8B</span> <span class="number">45</span> <span class="number">08</span>             mov         eax,dword ptr [ebp+<span class="number">8</span>]</span><br><span class="line"><span class="number">0040</span>D7EB <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040</span>D7EE <span class="number">8B</span> <span class="number">4</span>D FC             mov         ecx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D7F1 <span class="number">81</span> E9 <span class="number">2</span>D <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>    sub         ecx,<span class="number">12</span>Dh</span><br><span class="line"><span class="number">0040</span>D7F7 <span class="number">89</span> <span class="number">4</span>D FC             mov         dword ptr [ebp<span class="number">-4</span>],ecx</span><br><span class="line"><span class="number">0040</span>D7FA <span class="number">83</span> <span class="number">7</span>D FC <span class="number">09</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">9</span></span><br><span class="line"><span class="number">0040</span>D7FE <span class="number">0F</span> <span class="number">87</span> A6 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    ja          $L551+<span class="number">0F</span>h (<span class="number">0040</span>d8aa)</span><br><span class="line"><span class="number">0040</span>D804 <span class="number">8B</span> <span class="number">55</span> FC             mov         edx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D807 FF <span class="number">24</span> <span class="number">95</span> C8 D8 <span class="number">40</span> <span class="number">00</span> jmp         dword ptr [edx*<span class="number">4</span>+<span class="number">40</span>D8C8h]</span><br><span class="line">$L533:</span><br><span class="line"><span class="number">0040</span>D80E <span class="number">68</span> C0 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;1&quot;</span> (<span class="number">00422f</span>c0)</span><br><span class="line"><span class="number">0040</span>D813 E8 <span class="number">28</span> <span class="number">39</span> <span class="function">FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D818 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D81B E9 97 00 00 00       jmp         $L551+1<span class="title">Ch</span> <span class="params">(<span class="number">0040</span>d8b7)</span></span></span><br><span class="line"><span class="function">$L535:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D820 <span class="number">68</span> BC <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;2&quot;</span> (<span class="number">00422f</span>bc)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D825 E8 <span class="number">16</span> <span class="number">39</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D82A <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D82D E9 <span class="number">85</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L537:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D832 <span class="number">68</span> B8 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;3&quot;</span> (<span class="number">00422f</span>b8)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D837 E8 <span class="number">04</span> <span class="number">39</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D83C <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D83F EB <span class="number">76</span>                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L539:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D841 <span class="number">68</span> B4 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;4&quot;</span> (<span class="number">00422f</span>b4)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D846 E8 F5 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D84B <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D84E EB <span class="number">67</span>                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L541:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D850 <span class="number">68</span> <span class="number">64</span> <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;5&quot;</span> (<span class="number">00422f</span>64)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D855 E8 E6 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85A <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85D EB <span class="number">58</span>                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L543:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85F <span class="number">68</span> <span class="number">3</span>C <span class="number">21</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;6&quot;</span> (<span class="number">0042213</span>c)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D864 E8 D7 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D869 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D86C EB <span class="number">49</span>                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L545:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D86E <span class="number">68</span> <span class="number">2</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;7&quot;</span> (<span class="number">0042202</span>c)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D873 E8 C8 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D878 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D87B EB <span class="number">3</span>A                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L547:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D87D <span class="number">68</span> <span class="number">28</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;8&quot;</span> (<span class="number">00422028</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D882 E8 B9 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D887 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D88A EB <span class="number">2B</span>                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L549:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D88C <span class="number">68</span> <span class="number">24</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;9&quot;</span> (<span class="number">00422024</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D891 E8 AA <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D896 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D899 EB <span class="number">1</span>C                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function">$L551:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D89B <span class="number">68</span> <span class="number">20</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;A&quot;</span> (<span class="number">00422020</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8A0 E8 <span class="number">9B</span> <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8A5 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8A8 EB <span class="number">0</span>D                jmp         $L551+<span class="number">1</span>Ch (<span class="number">0040</span>d8b7)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8AA <span class="number">68</span> <span class="number">1</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;sb&quot;</span> (<span class="number">0042201</span>c)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8AF E8 <span class="number">8</span>C <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B4 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B7 <span class="number">5F</span>                   pop         edi</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B8 <span class="number">5</span>E                   pop         esi</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B9 <span class="number">5B</span>                   pop         ebx</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8BA <span class="number">83</span> C4 <span class="number">44</span>             add         esp,<span class="number">44</span>h</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8BD <span class="number">3B</span> EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8BF E8 FC <span class="number">38</span> FF FF       call        __chkesp (<span class="number">004011</span>c0)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8C4 <span class="number">8B</span> E5                mov         esp,ebp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8C6 <span class="number">5</span>D                   pop         ebp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8C7 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8C8  <span class="number">0</span>E D8 <span class="number">40</span> <span class="number">00</span>  .谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8CC  <span class="number">20</span> D8 <span class="number">40</span> <span class="number">00</span>   谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8D0  <span class="number">32</span> D8 <span class="number">40</span> <span class="number">00</span>  <span class="number">2</span>谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8D4  <span class="number">41</span> D8 <span class="number">40</span> <span class="number">00</span>  A谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8D8  <span class="number">50</span> D8 <span class="number">40</span> <span class="number">00</span>  P谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8DC  <span class="number">5F</span> D8 <span class="number">40</span> <span class="number">00</span>  _谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8E0  <span class="number">6</span>E D8 <span class="number">40</span> <span class="number">00</span>  n谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8E4  <span class="number">7</span>D D8 <span class="number">40</span> <span class="number">00</span>  &#125;谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8E8  <span class="number">8</span>C D8 <span class="number">40</span> <span class="number">00</span>  屫@.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8EC  <span class="number">9B</span> D8 <span class="number">40</span> <span class="number">00</span>  涁@.</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">//case不连续且差值不大</span></span><br><span class="line"><span class="function">//如果中间出现不连续的case会用default补大表空缺 </span></span><br><span class="line"><span class="function">//空缺的地方会用case补，下面的两个<span class="number">0040</span>D886</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8A4  <span class="number">0</span>E D8 <span class="number">40</span> <span class="number">00</span>  .谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8A8  <span class="number">86</span> D8 <span class="number">40</span> <span class="number">00</span>  嗀@.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8AC  <span class="number">86</span> D8 <span class="number">40</span> <span class="number">00</span>  嗀@.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B0  <span class="number">1</span>D D8 <span class="number">40</span> <span class="number">00</span>  .谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B4  <span class="number">2</span>C D8 <span class="number">40</span> <span class="number">00</span>  ,谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D8B8  <span class="number">3B</span> D8 <span class="number">40</span> <span class="number">00</span>  ;</span>谸.</span><br><span class="line"><span class="number">0040</span>D8BC  <span class="number">4</span>A D8 <span class="number">40</span> <span class="number">00</span>  J谸.</span><br><span class="line"><span class="number">0040</span>D8C0  <span class="number">59</span> D8 <span class="number">40</span> <span class="number">00</span>  Y谸.</span><br><span class="line"><span class="number">0040</span>D8C4  <span class="number">68</span> D8 <span class="number">40</span> <span class="number">00</span>  h谸.</span><br><span class="line"><span class="number">0040</span>D8C8  <span class="number">77</span> D8 <span class="number">40</span> <span class="number">00</span>  w谸.</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//如果case不连续且差值过大 使用大表加小表</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">int</span> x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">301</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">308</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">309</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">310</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;sb&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D7D0 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D7D1 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D7D3 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D7D6 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D7D7 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D7D8 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D7D9 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D7DC B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"><span class="number">0040</span>D7E8 <span class="number">8B</span> <span class="number">45</span> <span class="number">08</span>             mov         eax,dword ptr [ebp+<span class="number">8</span>]</span><br><span class="line"><span class="number">0040</span>D7EB <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040</span>D7EE <span class="number">8B</span> <span class="number">4</span>D FC             mov         ecx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D7F1 <span class="number">81</span> E9 <span class="number">2</span>D <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>    sub         ecx,<span class="number">12</span>Dh</span><br><span class="line"><span class="number">0040</span>D7F7 <span class="number">89</span> <span class="number">4</span>D FC             mov         dword ptr [ebp<span class="number">-4</span>],ecx</span><br><span class="line"><span class="number">0040</span>D7FA <span class="number">83</span> <span class="number">7</span>D FC <span class="number">09</span>          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">9</span></span><br><span class="line"><span class="number">0040</span>D7FE <span class="number">77</span> <span class="number">4</span>E                ja          $L539+<span class="number">0F</span>h (<span class="number">0040</span>d84e)</span><br><span class="line"><span class="number">0040</span>D800 <span class="number">8B</span> <span class="number">45</span> FC             mov         eax,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D803 <span class="number">33</span> D2                <span class="keyword">xor</span>         edx,edx</span><br><span class="line"><span class="number">0040</span>D805 <span class="number">8</span>A <span class="number">90</span> <span class="number">80</span> D8 <span class="number">40</span> <span class="number">00</span>    mov         dl,<span class="function">byte <span class="title">ptr</span>  <span class="params">(<span class="number">0040</span>d880)</span>[eax]   <span class="comment">//内存0040d880中偏移量为[eax]的值</span></span></span><br><span class="line"><span class="function">0040D80B FF 24 95 6C D8 40 00 jmp         dword ptr [edx*4+40D86Ch]</span></span><br><span class="line"><span class="function">$L533:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D812 <span class="number">68</span> <span class="number">2</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;1&quot;</span> (<span class="number">0042202</span>c)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D817 E8 <span class="number">24</span> <span class="number">39</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D81C <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D81F EB <span class="number">3</span>A                jmp         $L539+<span class="number">1</span>Ch (<span class="number">0040</span>d85b)</span></span><br><span class="line"><span class="function">$L535:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D821 <span class="number">68</span> <span class="number">28</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;8&quot;</span> (<span class="number">00422028</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D826 E8 <span class="number">15</span> <span class="number">39</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D82B <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D82E EB <span class="number">2B</span>                jmp         $L539+<span class="number">1</span>Ch (<span class="number">0040</span>d85b)</span></span><br><span class="line"><span class="function">$L537:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D830 <span class="number">68</span> <span class="number">24</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;9&quot;</span> (<span class="number">00422024</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D835 E8 <span class="number">06</span> <span class="number">39</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D83A <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D83D EB <span class="number">1</span>C                jmp         $L539+<span class="number">1</span>Ch (<span class="number">0040</span>d85b)</span></span><br><span class="line"><span class="function">$L539:</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D83F <span class="number">68</span> <span class="number">20</span> <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;A&quot;</span> (<span class="number">00422020</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D844 E8 F7 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D849 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D84C EB <span class="number">0</span>D                jmp         $L539+<span class="number">1</span>Ch (<span class="number">0040</span>d85b)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D84E <span class="number">68</span> <span class="number">1</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;sb&quot;</span> (<span class="number">0042201</span>c)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D853 E8 E8 <span class="number">38</span> FF FF       call        printf (<span class="number">00401140</span>)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D858 <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85B <span class="number">5F</span>                   pop         edi</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85C <span class="number">5</span>E                   pop         esi</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85D <span class="number">5B</span>                   pop         ebx</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D85E <span class="number">83</span> C4 <span class="number">44</span>             add         esp,<span class="number">44</span>h</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D861 <span class="number">3B</span> EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D863 E8 <span class="number">58</span> <span class="number">39</span> FF FF       call        __chkesp (<span class="number">004011</span>c0)</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D868 <span class="number">8B</span> E5                mov         esp,ebp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D86A <span class="number">5</span>D                   pop         ebp</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D86B C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="number">0040</span>D86C  <span class="number">12</span> D8 <span class="number">40</span> <span class="number">00</span>  .谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D870  <span class="number">21</span> D8 <span class="number">40</span> <span class="number">00</span>  !谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D874  <span class="number">30</span> D8 <span class="number">40</span> <span class="number">00</span>  <span class="number">0</span>谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D878  <span class="number">3F</span> D8 <span class="number">40</span> <span class="number">00</span>  ?谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D87C  <span class="number">4</span>E D8 <span class="number">40</span> <span class="number">00</span>  N谸.</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D880  <span class="number">00</span> <span class="number">04</span> <span class="number">04</span> <span class="number">04</span>  ....</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D884  <span class="number">04</span> <span class="number">04</span> <span class="number">04</span> <span class="number">01</span>  ....</span></span><br><span class="line"><span class="function"><span class="number">0040</span>D888  <span class="number">02</span> <span class="number">03</span> CC CC  ..烫</span></span><br><span class="line"><span class="function">//中间的<span class="number">04</span>就是代替大表中的default</span></span><br><span class="line"><span class="function">//如果空缺的太多会生成一张小表来替代大表中default填充，变为大表加小表</span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">//差值过大</span></span><br><span class="line"><span class="function">void func(int x)</span></span><br><span class="line"><span class="function">&#123;</span></span><br><span class="line">	<span class="keyword">switch</span>(x)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">1301</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">5308</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;8&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">10309</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> <span class="number">20310</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;sb&quot;</span>);</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D7D0 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D7D1 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D7D3 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D7D6 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D7D7 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D7D8 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D7D9 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D7DC B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"><span class="number">0040</span>D7E8 <span class="number">8B</span> <span class="number">45</span> <span class="number">08</span>             mov         eax,dword ptr [ebp+<span class="number">8</span>]</span><br><span class="line"><span class="number">0040</span>D7EB <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040</span>D7EE <span class="number">81</span> <span class="number">7</span>D FC <span class="number">45</span> <span class="number">28</span> <span class="number">00</span> <span class="number">00</span> cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">2845</span>h</span><br><span class="line"><span class="number">0040</span>D7F5 <span class="number">7F</span> <span class="number">1</span>D                jg          func+<span class="number">44</span>h (<span class="number">0040</span>d814)</span><br><span class="line"><span class="number">0040</span>D7F7 <span class="number">81</span> <span class="number">7</span>D FC <span class="number">45</span> <span class="number">28</span> <span class="number">00</span> <span class="number">00</span> cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">2845</span>h</span><br><span class="line"><span class="number">0040</span>D7FE <span class="number">74</span> <span class="number">3</span>D                je          func+<span class="number">6</span>Dh (<span class="number">0040</span>d83d)</span><br><span class="line"><span class="number">0040</span>D800 <span class="number">81</span> <span class="number">7</span>D FC <span class="number">15</span> <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">515</span>h</span><br><span class="line"><span class="number">0040</span>D807 <span class="number">74</span> <span class="number">16</span>                je          func+<span class="number">4F</span>h (<span class="number">0040</span>d81f)</span><br><span class="line"><span class="number">0040</span>D809 <span class="number">81</span> <span class="number">7</span>D FC BC <span class="number">14</span> <span class="number">00</span> <span class="number">00</span> cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">14B</span>Ch</span><br><span class="line"><span class="number">0040</span>D810 <span class="number">74</span> <span class="number">1</span>C                je          func+<span class="number">5</span>Eh (<span class="number">0040</span>d82e)</span><br><span class="line"><span class="number">0040</span>D812 EB <span class="number">47</span>                jmp         func+<span class="number">8B</span>h (<span class="number">0040</span>d85b)</span><br><span class="line"><span class="number">0040</span>D814 <span class="number">81</span> <span class="number">7</span>D FC <span class="number">56</span> <span class="number">4F</span> <span class="number">00</span> <span class="number">00</span> cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">4F</span>56h</span><br><span class="line"><span class="number">0040</span>D81B <span class="number">74</span> <span class="number">2F</span>                je          func+<span class="number">7</span>Ch (<span class="number">0040</span>d84c)</span><br><span class="line"><span class="number">0040</span>D81D EB <span class="number">3</span>C                jmp         func+<span class="number">8B</span>h (<span class="number">0040</span>d85b)</span><br><span class="line"><span class="number">0040</span>D81F <span class="number">68</span> <span class="number">2</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;1&quot;</span> (<span class="number">0042202</span>c)</span><br><span class="line"><span class="number">0040</span>D824 E8 <span class="number">17</span> <span class="number">39</span> <span class="function">FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D829 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D82C EB 3A                jmp         func+98<span class="title">h</span> <span class="params">(<span class="number">0040</span>d868)</span></span></span><br><span class="line"><span class="function">0040D82E 68 28 20 42 00       push        offset string &quot;8&quot; <span class="params">(<span class="number">00422028</span>)</span></span></span><br><span class="line"><span class="function">0040D833 E8 08 39 FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D838 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D83B EB 2B                jmp         func+98<span class="title">h</span> <span class="params">(<span class="number">0040</span>d868)</span></span></span><br><span class="line"><span class="function">0040D83D 68 24 20 42 00       push        offset string &quot;9&quot; <span class="params">(<span class="number">00422024</span>)</span></span></span><br><span class="line"><span class="function">0040D842 E8 F9 38 FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D847 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D84A EB 1C                jmp         func+98<span class="title">h</span> <span class="params">(<span class="number">0040</span>d868)</span></span></span><br><span class="line"><span class="function">0040D84C 68 20 20 42 00       push        offset string &quot;A&quot; <span class="params">(<span class="number">00422020</span>)</span></span></span><br><span class="line"><span class="function">0040D851 E8 EA 38 FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D856 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D859 EB 0D                jmp         func+98<span class="title">h</span> <span class="params">(<span class="number">0040</span>d868)</span></span></span><br><span class="line"><span class="function">0040D85B 68 1C 20 42 00       push        offset string &quot;sb&quot; <span class="params">(<span class="number">0042201</span>c)</span></span></span><br><span class="line"><span class="function">0040D860 E8 DB 38 FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D865 83 C4 04             add         esp,4</span></span><br><span class="line"><span class="function">0040D868 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040D869 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040D86A 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040D86B 83 C4 44             add         esp,44h</span></span><br><span class="line"><span class="function">0040D86E 3B EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function">0040D870 E8 4B 39 FF FF       call        __<span class="title">chkesp</span> <span class="params">(<span class="number">004011</span>c0)</span></span></span><br><span class="line"><span class="function">0040D875 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040D877 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040D878 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="comment">//用case最大的-case最小的，得出的范围称为k，如果要判断的值-case最小的值不在范围k之内，直接default</span></span></span><br><span class="line"><span class="function"><span class="comment">//edx 存放的是a 与case 中最小值的差值，而eax*4+地址存放的是每个case的地址</span></span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123120353631.png" alt="image-20230123120353631"></p>
<h3 id="循环对比分析"><a class="markdownIt-Anchor" href="#循环对比分析">#</a> 循环对比分析</h3>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;=<span class="number">10</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D920 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D921 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D923 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D926 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D927 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D928 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D929 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D92C B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D931 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D936 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D938 C7 <span class="number">45</span> FC <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span>							;<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="number">0040</span>D93F EB <span class="number">09</span>                jmp         func2+<span class="number">2</span>Ah (<span class="number">0040</span>d94a)</span><br><span class="line"><span class="number">0040</span>D941 <span class="number">8B</span> <span class="number">45</span> FC             mov         eax,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D944 <span class="number">83</span> C0 <span class="number">01</span>             add         eax,<span class="number">1</span></span><br><span class="line"><span class="number">0040</span>D947 <span class="number">89</span> <span class="number">45</span> FC             mov         dword ptr [ebp<span class="number">-4</span>],eax</span><br><span class="line"><span class="number">0040</span>D94A <span class="number">83</span> <span class="number">7</span>D FC <span class="number">0</span>A          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span>Ah							;i&lt;=<span class="number">10</span></span><br><span class="line"><span class="number">0040</span>D94E <span class="number">7F</span> <span class="number">13</span>                jg          func2+<span class="number">43</span>h (<span class="number">0040</span>d963)							;i&gt;<span class="number">10</span>,ret</span><br><span class="line"><span class="number">0040</span>D950 <span class="number">8B</span> <span class="number">4</span>D FC             mov         ecx,dword ptr [ebp<span class="number">-4</span>]							;i&lt;=<span class="number">10</span></span><br><span class="line"><span class="number">0040</span>D953 <span class="number">51</span>                   push        ecx											;ecx = i</span><br><span class="line"><span class="number">0040</span>D954 <span class="number">68</span> C4 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;%d\n&quot;</span> (<span class="number">00422f</span>c4)</span><br><span class="line"><span class="number">0040</span>D959 E8 E2 <span class="number">37</span> FF FF       call        <span class="built_in">printf</span> (<span class="number">00401140</span>)</span><br><span class="line"><span class="number">0040</span>D95E <span class="number">83</span> C4 <span class="number">08</span>             add         esp,<span class="number">8</span></span><br><span class="line"><span class="number">0040</span>D961 EB DE                jmp         func2+<span class="number">21</span>h (<span class="number">0040</span>d941)</span><br><span class="line"><span class="number">0040</span>D963 <span class="number">5F</span>                   pop         edi</span><br><span class="line"><span class="number">0040</span>D964 <span class="number">5</span>E                   pop         esi</span><br><span class="line"><span class="number">0040</span>D965 <span class="number">5B</span>                   pop         ebx</span><br><span class="line"><span class="number">0040</span>D966 <span class="number">83</span> C4 <span class="number">44</span>             add         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D969 <span class="number">3B</span> EC                cmp         ebp,esp</span><br><span class="line"><span class="number">0040</span>D96B E8 <span class="number">50</span> <span class="number">38</span> FF FF       call        __chkesp (<span class="number">004011</span>c0)</span><br><span class="line"><span class="number">0040</span>D970 <span class="number">8B</span> E5                mov         esp,ebp</span><br><span class="line"><span class="number">0040</span>D972 <span class="number">5</span>D                   pop         ebp</span><br><span class="line"><span class="number">0040</span>D973 C3                   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="built_in">func3</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(i&lt;=<span class="number">10</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,i);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D980 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D981 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D983 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D986 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D987 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D988 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D989 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D98C B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D991 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D996 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D998 C7 <span class="number">45</span> FC <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span></span><br><span class="line"><span class="number">0040</span>D99F <span class="number">83</span> <span class="number">7</span>D FC <span class="number">0</span>A          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span>Ah</span><br><span class="line"><span class="number">0040</span>D9A3 <span class="number">7F</span> <span class="number">1</span>C                jg          func3+<span class="number">41</span>h (<span class="number">0040</span>d9c1)</span><br><span class="line"><span class="number">0040</span>D9A5 <span class="number">8B</span> <span class="number">45</span> FC             mov         eax,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D9A8 <span class="number">50</span>                   push        eax</span><br><span class="line"><span class="number">0040</span>D9A9 <span class="number">68</span> C4 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;%d\n&quot;</span> (<span class="number">00422f</span>c4)</span><br><span class="line"><span class="number">0040</span>D9AE E8 <span class="number">8</span>D <span class="number">37</span> <span class="function">FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D9B3 83 C4 08             add         esp,8</span></span><br><span class="line"><span class="function">0040D9B6 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class="line"><span class="function">0040D9B9 83 C1 01             add         ecx,1</span></span><br><span class="line"><span class="function">0040D9BC 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class="line"><span class="function">0040D9BF EB DE                jmp         func3+1<span class="title">Fh</span> <span class="params">(<span class="number">0040</span>d99f)</span></span></span><br><span class="line"><span class="function">0040D9C1 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040D9C2 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040D9C3 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040D9C4 83 C4 44             add         esp,44h</span></span><br><span class="line"><span class="function">0040D9C7 3B EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function">0040D9C9 E8 F2 37 FF FF       call        __<span class="title">chkesp</span> <span class="params">(<span class="number">004011</span>c0)</span></span></span><br><span class="line"><span class="function">0040D9CE 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040D9D0 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040D9D1 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func4</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">do</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;<span class="keyword">while</span>(i&lt;=<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D980 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D981 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D983 <span class="number">83</span> EC <span class="number">44</span>             sub         esp,<span class="number">44</span>h</span><br><span class="line"><span class="number">0040</span>D986 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D987 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D988 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D989 <span class="number">8</span>D <span class="number">7</span>D BC             lea         edi,[ebp<span class="number">-44</span>h]</span><br><span class="line"><span class="number">0040</span>D98C B9 <span class="number">11</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">11</span>h</span><br><span class="line"><span class="number">0040</span>D991 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D996 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">    </span><br><span class="line"><span class="number">0040</span>D998 C7 <span class="number">45</span> FC <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span></span><br><span class="line"><span class="number">0040</span>D99F <span class="number">83</span> <span class="number">7</span>D FC <span class="number">0</span>A          cmp         dword ptr [ebp<span class="number">-4</span>],<span class="number">0</span>Ah</span><br><span class="line"><span class="number">0040</span>D9A3 <span class="number">7F</span> <span class="number">1</span>C                jg          func3+<span class="number">41</span>h (<span class="number">0040</span>d9c1)</span><br><span class="line"><span class="number">0040</span>D9A5 <span class="number">8B</span> <span class="number">45</span> FC             mov         eax,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040</span>D9A8 <span class="number">50</span>                   push        eax</span><br><span class="line"><span class="number">0040</span>D9A9 <span class="number">68</span> C4 <span class="number">2F</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;%d\n&quot;</span> (<span class="number">00422f</span>c4)</span><br><span class="line"><span class="number">0040</span>D9AE E8 <span class="number">8</span>D <span class="number">37</span> <span class="function">FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D9B3 83 C4 08             add         esp,8</span></span><br><span class="line"><span class="function">0040D9B6 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class="line"><span class="function">0040D9B9 83 C1 01             add         ecx,1</span></span><br><span class="line"><span class="function">0040D9BC 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class="line"><span class="function">0040D9BF EB DE                jmp         func3+1<span class="title">Fh</span> <span class="params">(<span class="number">0040</span>d99f)</span></span></span><br><span class="line"><span class="function">0040D9C1 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040D9C2 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040D9C3 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040D9C4 83 C4 44             add         esp,44h</span></span><br><span class="line"><span class="function">0040D9C7 3B EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function">0040D9C9 E8 F2 37 FF FF       call        __<span class="title">chkesp</span> <span class="params">(<span class="number">004011</span>c0)</span></span></span><br><span class="line"><span class="function">0040D9CE 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040D9D0 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040D9D1 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>
<h3 id="指针"><a class="markdownIt-Anchor" href="#指针">#</a> 指针</h3>
<p>总结:<br>
1、带有 <code>*</code>  的变量类型的标准写法: <code>变量类型* 变量名</code></p>
<p>2、任何类型都可以带 <code>*</code>  加上 <code>*</code>  以后是新的类型</p>
<p>3、* 可以是任意多个</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//赋值</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Stu</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">func</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span>* x;</span><br><span class="line">	<span class="type">short</span>* y;</span><br><span class="line">	<span class="type">int</span>* z;</span><br><span class="line">	Stu* stu;</span><br><span class="line">	<span class="type">int</span>** a;</span><br><span class="line"></span><br><span class="line">	x = (<span class="type">char</span>*)<span class="number">1</span>;</span><br><span class="line">	y = (<span class="type">short</span>*)<span class="number">2</span>;</span><br><span class="line">	z = (<span class="type">int</span>*)<span class="number">3</span>;</span><br><span class="line">	stu = (Stu*)<span class="number">4</span>;</span><br><span class="line">	a = (<span class="type">int</span>**)<span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"><span class="number">0040</span>D740 <span class="number">55</span>                   push        ebp</span><br><span class="line"><span class="number">0040</span>D741 <span class="number">8B</span> EC                mov         ebp,esp</span><br><span class="line"><span class="number">0040</span>D743 <span class="number">83</span> EC <span class="number">54</span>             sub         esp,<span class="number">54</span>h</span><br><span class="line"><span class="number">0040</span>D746 <span class="number">53</span>                   push        ebx</span><br><span class="line"><span class="number">0040</span>D747 <span class="number">56</span>                   push        esi</span><br><span class="line"><span class="number">0040</span>D748 <span class="number">57</span>                   push        edi</span><br><span class="line"><span class="number">0040</span>D749 <span class="number">8</span>D <span class="number">7</span>D AC             lea         edi,[ebp<span class="number">-54</span>h]</span><br><span class="line"><span class="number">0040</span>D74C B9 <span class="number">15</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>       mov         ecx,<span class="number">15</span>h</span><br><span class="line"><span class="number">0040</span>D751 B8 CC CC CC CC       mov         eax,<span class="number">0</span>CCCCCCCCh</span><br><span class="line"><span class="number">0040</span>D756 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"><span class="number">0040</span>D758 C7 <span class="number">45</span> FC <span class="number">01</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-4</span>],<span class="number">1</span></span><br><span class="line"><span class="number">0040</span>D75F C7 <span class="number">45</span> F8 <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-8</span>],<span class="number">2</span></span><br><span class="line"><span class="number">0040</span>D766 C7 <span class="number">45</span> F4 <span class="number">03</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-0</span>Ch],<span class="number">3</span></span><br><span class="line"><span class="number">0040</span>D76D C7 <span class="number">45</span> F0 <span class="number">04</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-10</span>h],<span class="number">4</span></span><br><span class="line"><span class="number">0040</span>D774 C7 <span class="number">45</span> EC <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-14</span>h],<span class="number">5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//带*类型变量赋值必须使用完整写法</span></span><br><span class="line"><span class="comment">//不加家多少个*，宽度永远是4字节</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//++/--加多少取决于类型减去一个*之后的数据宽度</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">func2</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span>* x;</span><br><span class="line">	<span class="type">short</span>* y;</span><br><span class="line">	<span class="type">int</span>* z;</span><br><span class="line"></span><br><span class="line">	x = (<span class="type">char</span>*)<span class="number">1</span>;</span><br><span class="line">	y = (<span class="type">short</span>*)<span class="number">2</span>;</span><br><span class="line">	z = (<span class="type">int</span>*)<span class="number">3</span>;</span><br><span class="line">	</span><br><span class="line">	x++;</span><br><span class="line">	y++;</span><br><span class="line">	z++;</span><br><span class="line">	<span class="comment">//2,4,7</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,x,y,z);</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>** x1;</span><br><span class="line">	<span class="type">short</span>** y1;</span><br><span class="line">	<span class="type">int</span>** z1;</span><br><span class="line"></span><br><span class="line">	x1 = (<span class="type">char</span>**)<span class="number">1</span>;</span><br><span class="line">	y1 = (<span class="type">short</span>**)<span class="number">2</span>;</span><br><span class="line">	z1 = (<span class="type">int</span>**)<span class="number">3</span>;</span><br><span class="line">	</span><br><span class="line">	x1++;</span><br><span class="line">	y1++;</span><br><span class="line">	z1++;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,x1,y1,z1);</span><br><span class="line">	<span class="comment">//5,6,7</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">	<span class="type">char</span>* x;</span><br><span class="line">	<span class="type">short</span>* y;</span><br><span class="line">	<span class="type">int</span>* z;</span><br><span class="line"></span><br><span class="line">	x = (<span class="type">char</span>*)<span class="number">100</span>;</span><br><span class="line">	y = (<span class="type">short</span>*)<span class="number">100</span>;</span><br><span class="line">	z = (<span class="type">int</span>*)<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	x+=<span class="number">5</span>;</span><br><span class="line">	y+=<span class="number">5</span>;</span><br><span class="line">	z+=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,x,y,z);  <span class="comment">//105 110 120</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">char</span>**** x;</span><br><span class="line">	<span class="type">short</span>**** y;</span><br><span class="line">	<span class="type">int</span>**** z;</span><br><span class="line"></span><br><span class="line">	x = (<span class="type">char</span>****)<span class="number">100</span>;</span><br><span class="line">	y = (<span class="type">short</span>****)<span class="number">100</span>;</span><br><span class="line">	z = (<span class="type">int</span>****)<span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">	x+=<span class="number">5</span>;</span><br><span class="line">	y+=<span class="number">5</span>;</span><br><span class="line">	z+=<span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,x,y,z);  <span class="comment">//120,120,120</span></span><br><span class="line">总结:</span><br><span class="line"><span class="number">1.</span>带*类型的变量可以加、减一个整数，但不能乘或者除.</span><br><span class="line"><span class="number">2.</span>带*类型变量与其他整数相加或者相减时:</span><br><span class="line"><span class="comment">//带*类型变量＋N=带*类型变量+N(去掉一个*后类型的宽度)</span></span><br><span class="line"><span class="comment">//带*类型变量一N=带*类型变量–N(去掉一个*后类型的宽度)</span></span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">	char**** x;</span><br><span class="line">	char**** y;</span><br><span class="line"></span><br><span class="line">	x = (char****)200;</span><br><span class="line">	y = (char****)100;</span><br><span class="line"></span><br><span class="line">	int a = x-y; </span><br><span class="line"></span><br><span class="line">	printf(&quot;%d \n&quot;,a);  //25</span><br><span class="line">	</span><br><span class="line">	char* x;</span><br><span class="line">	char* y;</span><br><span class="line"></span><br><span class="line">	x = (char*)200;</span><br><span class="line">	y = (char*)100;</span><br><span class="line"></span><br><span class="line">	int a = x-y;  //*相减结果为int</span><br><span class="line"></span><br><span class="line">	printf(&quot;%d \n&quot;,a); //100</span><br><span class="line">	</span><br><span class="line">	short* x;</span><br><span class="line">	short* y;</span><br><span class="line"></span><br><span class="line">	x = (short*)200;</span><br><span class="line">	y = (short*)100;</span><br><span class="line"></span><br><span class="line">	int a = x-y; </span><br><span class="line"></span><br><span class="line">	printf(&quot;%d \n&quot;,a);   //50</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">总结:</span><br><span class="line">1、两个类型相同的带*类型的变量可以进行减法操作</span><br><span class="line">2、想减的结果要除以去掉一个*的数据的宽度.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//带*的类型可以做大小比较</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	short**** x;</span><br><span class="line">	short**** y;</span><br><span class="line"></span><br><span class="line">	x = (short****)200;</span><br><span class="line">	y = (short****)100;</span><br><span class="line"></span><br><span class="line">	if(x&gt;y)</span><br><span class="line">		printf(&quot;1&quot;);    //1</span><br><span class="line">	else</span><br><span class="line">		printf(&quot;2&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">char** arr[10]    //40</span><br><span class="line">0040D740 55                   push        ebp</span><br><span class="line">0040D741 8B EC                mov         ebp,esp</span><br><span class="line">0040D743 83 EC 68             sub         esp,68h    //0x68-0x40=0x28=40/4=10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">struct Student</span><br><span class="line">&#123;</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;; </span><br><span class="line"></span><br><span class="line">Student**** s;</span><br><span class="line">s = (Student****)100;</span><br><span class="line">s++;  //104</span><br><span class="line">s += 2;  //112</span><br><span class="line">s -= 3;  //100</span><br><span class="line">s += 2.5;  //pointer on left; needs integral value on right</span><br><span class="line"></span><br><span class="line">Student**** s1;</span><br><span class="line">Student**** s2;</span><br><span class="line">int x;</span><br><span class="line">s1 = (Student****)200;</span><br><span class="line">s2 = (Student****)100;</span><br><span class="line">x = s1-s2;  //25</span><br><span class="line"></span><br><span class="line">Student* s;</span><br><span class="line">s = (Student*)100;</span><br><span class="line">s++;  //108</span><br><span class="line">s+=2;  //124</span><br><span class="line">s-=3;  //100</span><br><span class="line"></span><br><span class="line">Student* s1;</span><br><span class="line">Student* s2;</span><br><span class="line">int x;</span><br><span class="line">s1 = (Student*)200;</span><br><span class="line">s2 = (Student*)100;</span><br><span class="line">x=s1-s2  //12</span><br><span class="line"></span><br><span class="line">void func2()</span><br><span class="line">&#123;</span><br><span class="line">#if 0</span><br><span class="line">	Student**** s;</span><br><span class="line">	s = (Student****)100;</span><br><span class="line">	s++;  </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line">	s += 2;  </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line">	s -= 3; </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line"></span><br><span class="line">	Student**** s1;</span><br><span class="line">	Student**** s2;</span><br><span class="line">	int x;</span><br><span class="line">	s1 = (Student****)200;</span><br><span class="line">	s2 = (Student****)100;</span><br><span class="line">	x = s1-s2; </span><br><span class="line">	printf(&quot;%d\n&quot;,x);</span><br><span class="line"></span><br><span class="line">	Student* s;</span><br><span class="line">	s = (Student*)100;</span><br><span class="line">	s++;  </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line">	s+=2;  </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line">	s-=3;  </span><br><span class="line">	printf(&quot;%d\n&quot;,s);</span><br><span class="line"></span><br><span class="line">	Student* s1;</span><br><span class="line">	Student* s2;</span><br><span class="line">	int x;</span><br><span class="line">	s1 = (Student*)200;</span><br><span class="line">	s2 = (Student*)100;</span><br><span class="line">	x=s1-s2;  </span><br><span class="line">	printf(&quot;%d\n&quot;,x);</span><br><span class="line"></span><br><span class="line">	#endif</span><br><span class="line">&#125;</span><br><span class="line">Student**** 4</span><br><span class="line">Student* 8</span><br><span class="line"></span><br><span class="line">Student s;</span><br><span class="line">int x = (Studnet)s;   //x</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">struct Student</span><br><span class="line">&#123;</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;;</span><br><span class="line">Student s;</span><br><span class="line">int m = 10;</span><br><span class="line">s = (Student)x;    //不能转，int不能和结构体类型互相转换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int* x;</span><br><span class="line">Student* y;</span><br><span class="line">x = (int*) 10;</span><br><span class="line">y = (Student*)x;    //可以转</span><br><span class="line"></span><br><span class="line">int* x;</span><br><span class="line">Student y;</span><br><span class="line">x = (Studnet*)y;   //不能转</span><br><span class="line"></span><br><span class="line">&amp;是地址符，类型是其后面的类型加一个“*”，任何变量都可以使用来获取地址，但不能用在常量上。</span><br><span class="line">&amp;可以取任何一个变量的地址</span><br><span class="line">&amp;a 的类型是a的类型+*</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char***** a = (char*****)10;</span><br><span class="line">&amp;a = char******</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125132226542.png" alt="image-20230125132226542"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125133522040.png" alt="image-20230125133522040"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230221165556550.png" alt="image-20230221165556550"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span>  x=<span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* px = &amp;x;</span><br><span class="line"><span class="type">char</span> x1 = *px;</span><br><span class="line">*x == x的类型减去一个*</span><br><span class="line"></span><br><span class="line">变量类型本来带*才能加*</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[<span class="number">5</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;   <span class="comment">//开辟8个字节缓冲区</span></span><br><span class="line"><span class="type">int</span>* x = &amp;arr[<span class="number">0</span>];   <span class="comment">//第一个变量的地址</span></span><br><span class="line"><span class="type">int</span>* px = arr;      <span class="comment">//两种等价的写法</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i&lt;<span class="number">5</span>;i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,arr[i]);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,*(px+i));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//px是int*类型，运算时去掉一个*,变为int类型，偏移时每次+4找到数组中对应位置，*在解引用</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line">void func3()</span><br><span class="line">&#123;</span><br><span class="line">	char a = 10;</span><br><span class="line">	short b = 20;</span><br><span class="line">	int c = 30;</span><br><span class="line"></span><br><span class="line">	char* pa = &amp;a;</span><br><span class="line">	short* pb = &amp;b;</span><br><span class="line">	int* pc = &amp;c;</span><br><span class="line"></span><br><span class="line">	char** ppa = &amp;pa;</span><br><span class="line">	short** ppb = &amp;pb;</span><br><span class="line">	int** ppc = &amp;pc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0040D740 55                   push        ebp</span><br><span class="line">0040D741 8B EC                mov         ebp,esp</span><br><span class="line">0040D743 83 EC 64             sub         esp,64h</span><br><span class="line">0040D746 53                   push        ebx</span><br><span class="line">0040D747 56                   push        esi</span><br><span class="line">0040D748 57                   push        edi</span><br><span class="line">0040D749 8D 7D 9C             lea         edi,[ebp-64h]</span><br><span class="line">0040D74C B9 19 00 00 00       mov         ecx,19h</span><br><span class="line">0040D751 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">0040D756 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"></span><br><span class="line">0040D758 C6 45 FC 0A          mov         byte ptr [ebp-4],0Ah</span><br><span class="line">0040D75C 66 C7 45 F8 14 00    mov         word ptr [ebp-8],offset func3+20h (0040d760)</span><br><span class="line">0040D762 C7 45 F4 1E 00 00 00 mov         dword ptr [ebp-0Ch],1Eh</span><br><span class="line">0040D769 8D 45 FC             lea         eax,[ebp-4]</span><br><span class="line">0040D76C 89 45 F0             mov         dword ptr [ebp-10h],eax</span><br><span class="line">0040D76F 8D 4D F8             lea         ecx,[ebp-8]</span><br><span class="line">0040D772 89 4D EC             mov         dword ptr [ebp-14h],ecx</span><br><span class="line">0040D775 8D 55 F4             lea         edx,[ebp-0Ch]</span><br><span class="line">0040D778 89 55 E8             mov         dword ptr [ebp-18h],edx</span><br><span class="line">0040D77B 8D 45 F0             lea         eax,[ebp-10h]</span><br><span class="line">0040D77E 89 45 E4             mov         dword ptr [ebp-1Ch],eax</span><br><span class="line">0040D781 8D 4D EC             lea         ecx,[ebp-14h]</span><br><span class="line">0040D784 89 4D E0             mov         dword ptr [ebp-20h],ecx</span><br><span class="line">0040D787 8D 55 E8             lea         edx,[ebp-18h]</span><br><span class="line">0040D78A 89 55 DC             mov         dword ptr [ebp-24h],edx</span><br><span class="line">0040D78D 5F                   pop         edi</span><br><span class="line">0040D78E 5E                   pop         esi</span><br><span class="line">0040D78F 5B                   pop         ebx</span><br><span class="line">0040D790 8B E5                mov         esp,ebp</span><br><span class="line">0040D792 5D                   pop         ebp</span><br><span class="line">0040D793 C3                   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void func4()</span><br><span class="line">&#123;</span><br><span class="line">	int p = 10;</span><br><span class="line">	int******* p7;</span><br><span class="line">	int****** p6;</span><br><span class="line">	int***** p5;</span><br><span class="line">	int**** p4;</span><br><span class="line">	int*** p3;</span><br><span class="line">	int** p2;</span><br><span class="line">	int* p1;</span><br><span class="line"></span><br><span class="line">	p1 = &amp;p;</span><br><span class="line">	p2 = &amp;p1;</span><br><span class="line">	p3 = &amp;p2;</span><br><span class="line">	p4 = &amp;p3;</span><br><span class="line">	p5 = &amp;p4;</span><br><span class="line">	p6 = &amp;p5;</span><br><span class="line">	p7 = &amp;p6;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0040D870 55                   push        ebp</span><br><span class="line">0040D871 8B EC                mov         ebp,esp</span><br><span class="line">0040D873 83 EC 60             sub         esp,60h</span><br><span class="line">0040D876 53                   push        ebx</span><br><span class="line">0040D877 56                   push        esi</span><br><span class="line">0040D878 57                   push        edi</span><br><span class="line">0040D879 8D 7D A0             lea         edi,[ebp-60h]</span><br><span class="line">0040D87C B9 18 00 00 00       mov         ecx,18h</span><br><span class="line">0040D881 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">0040D886 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line"></span><br><span class="line">0040D888 C7 45 FC 0A 00 00 00 mov         dword ptr [ebp-4],0Ah</span><br><span class="line">0040D88F 8D 45 FC             lea         eax,[ebp-4]</span><br><span class="line">0040D892 89 45 E0             mov         dword ptr [ebp-20h],eax</span><br><span class="line">0040D895 8D 4D E0             lea         ecx,[ebp-20h]</span><br><span class="line">0040D898 89 4D E4             mov         dword ptr [ebp-1Ch],ecx</span><br><span class="line">0040D89B 8D 55 E4             lea         edx,[ebp-1Ch]</span><br><span class="line">0040D89E 89 55 E8             mov         dword ptr [ebp-18h],edx</span><br><span class="line">0040D8A1 8D 45 E8             lea         eax,[ebp-18h]</span><br><span class="line">0040D8A4 89 45 EC             mov         dword ptr [ebp-14h],eax</span><br><span class="line">0040D8A7 8D 4D EC             lea         ecx,[ebp-14h]</span><br><span class="line">0040D8AA 89 4D F0             mov         dword ptr [ebp-10h],ecx</span><br><span class="line">0040D8AD 8D 55 F0             lea         edx,[ebp-10h]</span><br><span class="line">0040D8B0 89 55 F4             mov         dword ptr [ebp-0Ch],edx</span><br><span class="line">0040D8B3 8D 45 F4             lea         eax,[ebp-0Ch]</span><br><span class="line">0040D8B6 89 45 F8             mov         dword ptr [ebp-8],eax</span><br><span class="line">0040D8B9 5F                   pop         edi</span><br><span class="line">0040D8BA 5E                   pop         esi</span><br><span class="line">0040D8BB 5B                   pop         ebx</span><br><span class="line">0040D8BC 8B E5                mov         esp,ebp</span><br><span class="line">0040D8BE 5D                   pop         ebp</span><br><span class="line">0040D8BF C3                   ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void fun()</span><br><span class="line">&#123;</span><br><span class="line">	int arr[5] = &#123;1,2,3,4,5&#125;;</span><br><span class="line">	for (int k = 0;k&lt;5;k++)</span><br><span class="line">	&#123;</span><br><span class="line">		*(arr+k) = 5 - k;</span><br><span class="line">	&#125;</span><br><span class="line">	for (int i = 0;i&lt;5;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;%d\n&quot;,*(arr+i));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126121202168.png" alt="image-20230126121202168"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">char arr[] = &#123;</span><br><span class="line">	0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09,</span><br><span class="line">	0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,</span><br><span class="line">	0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,</span><br><span class="line">	0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0x0A,0x00,</span><br><span class="line">	0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class="line">	0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,</span><br><span class="line">	0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,</span><br><span class="line">	0x00,0x02,0x74,0x0F,0x41,0x00,0x06,0x08,0x00,0x00,</span><br><span class="line">	0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,</span><br><span class="line">	0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void FindBloodAddr()</span><br><span class="line">&#123;</span><br><span class="line">	int i = 0, length = sizeof(arr)/sizeof(arr[0]);</span><br><span class="line">	while(i&lt;length - 4)</span><br><span class="line">	&#123;</span><br><span class="line">		int* p = (int*)(arr+i);</span><br><span class="line">		if(*p == 0x64)</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;[%X] = %d\n&quot;,p,*p);</span><br><span class="line">		&#125;</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	FindBloodAddr();</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void FindNum()</span><br><span class="line">&#123;</span><br><span class="line">	char* add = data;   </span><br><span class="line"></span><br><span class="line">	printf(&quot;%X\n&quot;,add);</span><br><span class="line">	for(int i=0; i&lt;sizeof(data)/sizeof(char)-4; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		//*(add+i)</span><br><span class="line">		if(*(int*)(add+i) == 0x64)</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;%d\n&quot;,i);</span><br><span class="line">			printf(&quot;[%X]=%d\n&quot;, (int*)(add+i), *(int*)(add+i));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> names[] = <span class="string">&quot;ABCDE&quot;</span>;</span><br><span class="line">==</span><br><span class="line"><span class="type">char</span> arr[<span class="number">6</span>] = &#123;<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;0&#x27;</span>&#125;;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,arr )</span><br><span class="line"></span><br><span class="line">代码区</span><br><span class="line">堆栈区</span><br><span class="line">全局变量区 - 可读可写</span><br><span class="line">常量区 - 可读不可写</span><br><span class="line">    </span><br><span class="line"> </span><br><span class="line"><span class="type">char</span>* x = <span class="string">&quot;China&quot;</span>;   <span class="comment">//char*指向的字符串不能改，因为存储在常量区，char*的地址可以改</span></span><br><span class="line"><span class="type">char</span> y[] = <span class="string">&quot;China&quot;</span>;  <span class="comment">//全局区</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	*(x+<span class="number">1</span>) = <span class="string">&quot;A&quot;</span>;    <span class="comment">//不能修改常量区 0xC0000005</span></span><br><span class="line">    x = <span class="string">&quot;abx&quot;</span>;</span><br><span class="line">	</span><br><span class="line">	y[<span class="number">1</span>] = <span class="string">&#x27;A&#x27;</span>;    <span class="comment">//常量区的内容复制到局部变量中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span>* x = <span class="string">&quot;China&quot;</span>;     <span class="comment">//china在常量区，x是china在常量区的首地址 </span></span><br><span class="line">	<span class="type">char</span> y[] = <span class="string">&quot;China&quot;</span>;    <span class="comment">//china在常量区，被拷贝到栈中</span></span><br><span class="line">	*(x+<span class="number">1</span>) = <span class="string">&quot;A&quot;</span>;          <span class="comment">//0xC0000005</span></span><br><span class="line">	  </span><br><span class="line">	y[<span class="number">1</span>] = <span class="string">&#x27;A&#x27;</span>;   		   <span class="comment">//修改栈中数据</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strlen</span><span class="params">(<span class="type">char</span>* s)</span>   <span class="comment">//返回值是s的长度，不包括\0</span></span></span><br><span class="line"><span class="function"></span>&#123; </span><br><span class="line">	<span class="type">int</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(*(s) != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        </span><br><span class="line">        ret++;</span><br><span class="line">        s++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">strcpy</span><span class="params">(<span class="type">char</span>* dest, <span class="type">char</span>* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span>* ret = dest;</span><br><span class="line">    <span class="keyword">while</span>(*(dest++) = *(src)++);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">strcat</span><span class="params">(<span class="type">char</span>* dest, <span class="type">char</span>* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">char</span>* ret = dest;</span><br><span class="line"> 	<span class="keyword">while</span>(*dest != <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        dest++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(*dest++ = *src++);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strcmp</span><span class="params">(<span class="type">char</span>*s1, <span class="type">char</span>* s2)</span> <span class="comment">//一样返回0，不一样返回1</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span>(*s1!=<span class="number">0</span> &amp;&amp; *s2!=<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(*s1++ != *s2++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">FindRoleNameAddr</span><span class="params">(<span class="type">char</span>* pData, <span class="type">char</span>* pRoleName)</span> <span class="comment">//返回值为指针的为指针函数</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//返回值为带*类型的函数为指针函数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;string.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span> data[] = &#123;</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x04</span>,<span class="number">0x05</span>,<span class="number">0x06</span>,<span class="number">0x07</span>,<span class="number">0x07</span>,<span class="number">0x09</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x10</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x0C</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x44</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x33</span>,<span class="number">0x00</span>,<span class="number">0x47</span>,<span class="number">0x0C</span>,<span class="number">0x0E</span>,<span class="number">0x00</span>,<span class="number">0x0D</span>,<span class="number">0x00</span>,<span class="number">0x11</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0A</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x74</span>,<span class="number">0x0F</span>,<span class="number">0x41</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x05</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0A</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x57</span>,<span class="number">0x4F</span>,<span class="number">0x57</span>,<span class="number">0x00</span>,<span class="number">0x06</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x0F</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0D</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strlen</span><span class="params">(<span class="type">char</span>* s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span>(*s != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		len++;</span><br><span class="line">		s++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">strcpy</span><span class="params">(<span class="type">char</span>* dest, <span class="type">char</span>* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span>* ret = dest;   <span class="comment">//需要先保存首地址，后续dest指针会随着循环向后移，但返回时还是返回首地址</span></span><br><span class="line">	<span class="keyword">while</span>((*dest++) = (*src++));   <span class="comment">//这是赋值语句，0也会被复制，先复制在判断</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	while(*src != 0) </span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		*dest = *src;</span></span><br><span class="line"><span class="comment">		src++;</span></span><br><span class="line"><span class="comment">		dest++;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">strcat</span><span class="params">(<span class="type">char</span>* dest, <span class="type">char</span>* src)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span>* ret = dest;</span><br><span class="line">	<span class="keyword">while</span>(*dest != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		dest++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span>(*dest != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		*dest = *src;</span><br><span class="line">		dest++;</span><br><span class="line">		src++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">strcmp</span><span class="params">(<span class="type">char</span>* s1, <span class="type">char</span>* s2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">while</span>(*s1 !=<span class="number">0</span> || *s2 != <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(*s1 == *s2)</span><br><span class="line">		&#123;</span><br><span class="line">			s1++;</span><br><span class="line">			s2++;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">FindRoleNameAddr</span><span class="params">(<span class="type">char</span>* pData, <span class="type">char</span>* pRoleName)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> total = <span class="built_in">sizeof</span>(data)/<span class="built_in">sizeof</span>(data[<span class="number">0</span>]);</span><br><span class="line">	<span class="type">int</span> length = <span class="built_in">strlen</span>(pRoleName);</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;=total-length; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(*(pData+i) == <span class="number">0x57</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">if</span>(<span class="built_in">strncmp</span>(&amp;pData[i],pRoleName,<span class="number">3</span>) == <span class="number">0</span>)</span><br><span class="line">				<span class="keyword">return</span> &amp;pData[i];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> arr2[] = <span class="string">&quot;WOW&quot;</span>;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,data);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,<span class="built_in">FindRoleNameAddr</span>(data, arr2));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126151524978.png" alt="image-20230126151524978"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">//指针数组</span><br><span class="line">int*** arr[5];</span><br><span class="line"></span><br><span class="line">char a1 = &#x27;A&#x27;;</span><br><span class="line">char* p1 = &amp;a1;</span><br><span class="line"></span><br><span class="line">char* arr = &quot;china&quot;;</span><br><span class="line">printf(&quot;%s\n&quot;,arr);  //china</span><br><span class="line"></span><br><span class="line">char arr[10] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class="line">printf(&quot;%s\n&quot;,arr);   //china</span><br><span class="line">0040D7B8 C6 45 F4 63          mov         byte ptr [ebp-0Ch],63h</span><br><span class="line">0040D7BC C6 45 F5 68          mov         byte ptr [ebp-0Bh],68h</span><br><span class="line">0040D7C0 C6 45 F6 69          mov         byte ptr [ebp-0Ah],69h</span><br><span class="line">0040D7C4 C6 45 F7 6E          mov         byte ptr [ebp-9],6Eh</span><br><span class="line">0040D7C8 C6 45 F8 61          mov         byte ptr [ebp-8],61h</span><br><span class="line">0040D7CC 33 C0                xor         eax,eax</span><br><span class="line">0040D7CE 89 45 F9             mov         dword ptr [ebp-7],eax</span><br><span class="line">0040D7D1 88 45 FD             mov         byte ptr [ebp-3],al</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char arr[5] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class="line">printf(&quot;%s\n&quot;,arr);   //china烫虉</span><br><span class="line"></span><br><span class="line">char arr[5] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class="line">printf(&quot;%c\n&quot;,arr);   //@</span><br><span class="line"></span><br><span class="line">char arr[6] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;,&#x27;\0&#x27;&#125;;</span><br><span class="line">printf(&quot;%s\n&quot;,arr);   //china</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char* arr[] = &#123;&quot;if&quot;,&quot;or&quot;,&quot;while&quot;,&quot;for&quot;&#125;;</span><br><span class="line"></span><br><span class="line">char* p1 = &quot;if&quot;</span><br><span class="line">char* p2 = &quot;for&quot;;</span><br><span class="line">char* p3 = &quot;while&quot;;</span><br><span class="line">char* p4 = &quot;switch&quot;;</span><br><span class="line">char* keyword[] = &#123;p1,p2,p3,p4&#125;;</span><br><span class="line"></span><br><span class="line">for(int i=0;i&lt;4;i++)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;%s\n&quot;,*(arr+i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230224153206988.png" alt="image-20230224153206988"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">//结构体指针</span><br><span class="line">struct Stu</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">	int c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Stu* stu;</span><br><span class="line">stu = (Stu*)100;</span><br><span class="line">stu++;  //+12</span><br><span class="line"></span><br><span class="line">Stu* Stu1 = (Stu*)20;</span><br><span class="line">int x = stu - stu1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Stu s;</span><br><span class="line">s.a = 10;</span><br><span class="line">s.b = 20;</span><br><span class="line">s.c = 30;</span><br><span class="line">Stu *ss = &amp;s;</span><br><span class="line">ss-&gt;a = 100;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int x = 10;</span><br><span class="line">Stu* s = (Stu*)&amp;x;</span><br><span class="line">printf(&quot;%d %d %d&quot;,s-&gt;a,s-&gt;b,s-&gt;c);   //10,x,x  x取决于内存中有什么</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">int x1 = 1;</span><br><span class="line">int x2 = 2;</span><br><span class="line">int x3 = 3;</span><br><span class="line"></span><br><span class="line">int* arr[3];</span><br><span class="line">arr[0] = &amp;x1;</span><br><span class="line">arr[1] = &amp;x2;</span><br><span class="line">arr[2] = &amp;x3;</span><br><span class="line"></span><br><span class="line">char* p1 = &quot;if&quot;</span><br><span class="line">char* p2 = &quot;for&quot;;</span><br><span class="line">char* p3 = &quot;while&quot;;</span><br><span class="line">char* p4 = &quot;switch&quot;;</span><br><span class="line">char* keyword[] = &#123;p1,p2,p3,p4&#125;;</span><br><span class="line"></span><br><span class="line">for(int i=0;i&lt;4;i++)</span><br><span class="line">&#123;</span><br><span class="line">    printf(&quot;%s\n&quot;,*(arr+i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230127133346425.png" alt="image-20230127133346425"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">TagPlayer</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">	<span class="type">int</span> id;</span><br><span class="line">	<span class="type">int</span> level;</span><br><span class="line">&#125;Player;</span><br><span class="line"></span><br><span class="line"><span class="type">char</span> data[] = &#123;</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x01</span>,<span class="number">0x02</span>,<span class="number">0x03</span>,<span class="number">0x04</span>,<span class="number">0x05</span>,<span class="number">0x06</span>,<span class="number">0x07</span>,<span class="number">0x07</span>,<span class="number">0x09</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x20</span>,<span class="number">0x10</span>,<span class="number">0x03</span>,<span class="number">0x03</span>,<span class="number">0x0C</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x44</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x33</span>,<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0A</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x10</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x00</span>,<span class="number">0x74</span>,<span class="number">0x0F</span>,<span class="number">0x41</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x01</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0A</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x02</span>,<span class="number">0x57</span>,<span class="number">0x4F</span>,<span class="number">0x57</span>,<span class="number">0x00</span>,<span class="number">0x06</span>,<span class="number">0x08</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x0F</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x0D</span>,<span class="number">0x00</span>,</span><br><span class="line">	<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x23</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x00</span>,<span class="number">0x64</span>,<span class="number">0x00</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">fun</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">char</span>* haha = data;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(data)/<span class="keyword">sizeof</span>(data[<span class="number">0</span>])-<span class="keyword">sizeof</span>(Player); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		Player* hehe = (Player*)(haha+i);</span><br><span class="line">		<span class="keyword">if</span>(hehe-&gt;id == <span class="number">0x01</span> &amp;&amp; hehe-&gt;level == <span class="number">0x08</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;%X\ %d \n&quot;</span>,&amp;(hehe-&gt;id),hehe-&gt;id);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	fun();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">*(p1+x)  = p1[x]</span><br><span class="line">两种写法一样</span><br><span class="line"></span><br><span class="line"><span class="type">char</span>** p2;</span><br><span class="line">*(*(p2+<span class="number">1</span>)) +<span class="number">4</span></span><br><span class="line">*(*(p2+<span class="number">1</span>)+<span class="number">1</span>) +<span class="number">4</span>+<span class="number">1</span></span><br><span class="line">*(*(p2+<span class="number">2</span>)+<span class="number">3</span>) == p2[<span class="number">2</span>][<span class="number">3</span>]  +<span class="number">8</span>+<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="type">char</span>*** p3;</span><br><span class="line">*(*(*(p3+<span class="number">1</span>)+<span class="number">2</span>)+<span class="number">3</span>) == p3[<span class="number">1</span>][<span class="number">2</span>][<span class="number">3</span>]  +<span class="number">4</span>+<span class="number">8</span>+<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体指针</span></span><br><span class="line">Student* s;</span><br><span class="line"></span><br><span class="line"><span class="comment">//数组指针</span></span><br><span class="line"><span class="built_in">int</span> (*px)[<span class="number">5</span>];  </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">sizeof</span>(px));  <span class="comment">//4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//赋值</span></span><br><span class="line">px = ((*px)[<span class="number">5</span>])<span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//*px 指向 int[5]</span></span><br><span class="line">px++;  +<span class="number">20</span> </span><br><span class="line"></span><br><span class="line"><span class="type">int</span> arr[<span class="number">16</span>] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>&#125;;</span><br><span class="line"><span class="built_in">int</span> (*px)[<span class="number">2</span>];</span><br><span class="line">px = (<span class="built_in">int</span> (*px)[<span class="number">2</span>])arr;  </span><br><span class="line">*px == &amp;arr[<span class="number">0</span>]</span><br><span class="line">*(*px) == arr[<span class="number">0</span>]</span><br><span class="line">*(*(px)) = <span class="number">1</span></span><br><span class="line">*(*(px+<span class="number">1</span>)+<span class="number">1</span>) == <span class="number">4</span>  +<span class="number">8b</span>yte+<span class="number">4b</span>yte   <span class="number">1</span>+<span class="number">3</span> </span><br><span class="line">*(*(px+<span class="number">3</span>)+<span class="number">3</span>) == <span class="number">4</span>  +<span class="number">3</span>*<span class="number">8b</span>yte+<span class="number">3</span>*<span class="number">4b</span>yte   <span class="number">3</span>*<span class="number">2</span>+<span class="number">3</span> </span><br><span class="line"><span class="comment">//px 和 *px 里面的值一样</span></span><br><span class="line"><span class="comment">//但运算时宽度不一样  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//指针数组</span></span><br><span class="line"><span class="type">int</span>* p[<span class="number">5</span>];</span><br><span class="line"><span class="comment">//这个数组的所有元素都是指针类型</span></span><br><span class="line"><span class="comment">//数组指针</span></span><br><span class="line"><span class="built_in">int</span> (*p)[<span class="number">5</span>];</span><br><span class="line"><span class="comment">//这个指针存放着一个数组的首地址，或者说这个指针指向一个数组的首地址。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//int (*p)[5] 可以不指向一个数组</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">int</span> (*px)[<span class="number">5</span>];</span><br><span class="line">*(*(px+<span class="number">2</span>)+<span class="number">2</span>)  <span class="number">2</span>*<span class="number">4</span>*<span class="number">5</span>+<span class="number">2</span>*<span class="number">4</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//二维数组指针</span></span><br><span class="line"><span class="built_in">char</span> (*px)[<span class="number">2</span>][<span class="number">3</span>];</span><br><span class="line">*(*(*(px+<span class="number">2</span>)+<span class="number">3</span>)+<span class="number">4</span>)  <span class="number">2</span>*<span class="number">3</span>*<span class="number">2</span>+<span class="number">3</span>*<span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">char</span> (*px)[<span class="number">2</span>][<span class="number">3</span>][<span class="number">2</span>];</span><br><span class="line">px = (<span class="built_in">char</span> (*px)[<span class="number">2</span>][<span class="number">3</span>][<span class="number">2</span>])code;</span><br><span class="line">*(*(*(*(px+<span class="number">2</span>)+<span class="number">3</span>)+<span class="number">1</span>)+<span class="number">4</span>)</span><br><span class="line"><span class="number">2</span>*<span class="number">2</span>*<span class="number">3</span>*<span class="number">2</span>*<span class="number">1</span> + <span class="number">3</span>*<span class="number">3</span>*<span class="number">2</span>*<span class="number">1</span> + <span class="number">1</span>*<span class="number">2</span>*<span class="number">1</span> + <span class="number">4</span>*<span class="number">1</span></span><br><span class="line">    </span><br><span class="line"><span class="built_in">int</span> (*pFun)(<span class="type">int</span>,<span class="type">int</span>)    <span class="comment">//sizeof() = 4   是返回值为int，有两个int参数</span></span><br><span class="line">pFun++   <span class="comment">//illegal 因为宽度不确定</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Function</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>  </span>&#123; &#125;</span><br><span class="line">pFun = Function;</span><br><span class="line"><span class="type">int</span> sb = <span class="built_in">pFun</span>(<span class="number">1</span>,<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225163935045.png" alt="image-20230225163935045"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225172241524.png" alt="image-20230225172241524"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int arr[] = &#123;1,2,3,4,5,6,7&#125;;</span><br><span class="line">	int (*px)[5];</span><br><span class="line">	px = (int (*)[5])arr;</span><br><span class="line"></span><br><span class="line">	printf(&quot;%X %X\n&quot;,*(px+1)[2],px[1][2]);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0040D768 C7 45 E4 01 00 00 00 mov         dword ptr [ebp-1Ch],1</span><br><span class="line">0040D76F C7 45 E8 02 00 00 00 mov         dword ptr [ebp-18h],2</span><br><span class="line">0040D776 C7 45 EC 03 00 00 00 mov         dword ptr [ebp-14h],3</span><br><span class="line">0040D77D C7 45 F0 04 00 00 00 mov         dword ptr [ebp-10h],4</span><br><span class="line">0040D784 C7 45 F4 05 00 00 00 mov         dword ptr [ebp-0Ch],5</span><br><span class="line">0040D78B C7 45 F8 06 00 00 00 mov         dword ptr [ebp-8],6</span><br><span class="line">0040D792 C7 45 FC 07 00 00 00 mov         dword ptr [ebp-4],7</span><br><span class="line">0040D799 8D 45 E4             lea         eax,[ebp-1Ch]   &amp;arr[0]</span><br><span class="line">0040D79C 89 45 E0             mov         dword ptr [ebp-20h],eax  </span><br><span class="line">0040D79F 8B 4D E0             mov         ecx,dword ptr [ebp-20h]</span><br><span class="line">0040D7A2 8B 51 1C             mov         edx,dword ptr [ecx+1Ch]</span><br><span class="line">0040D7A5 52                   push        edx</span><br><span class="line">0040D7A6 8B 45 E0             mov         eax,dword ptr [ebp-20h]</span><br><span class="line">0040D7A9 8B 48 3C             mov         ecx,dword ptr [eax+3Ch]</span><br><span class="line">0040D7AC 51                   push        ecx</span><br><span class="line">0040D7AD 68 1C 20 42 00       push        offset string &quot;%d %d %d\n&quot; (0042201c)</span><br><span class="line">0040D7B2 E8 09 39 FF FF       call        printf (004010c0)</span><br><span class="line">0040D7B7 83 C4 0C             add         esp,0Ch</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int arr[] = &#123;1,2,3,4,5,6,7&#125;;</span><br><span class="line">	int (*px)[5];</span><br><span class="line">	px = (int (*)[5])arr;</span><br><span class="line">	for(int i=0; i&lt;sizeof(arr)/sizeof(arr[0]); i++)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;%d\n&quot;,*(*(px)+i));</span><br><span class="line">	&#125;</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="../AppData/Roaming/Typora/typora-user-images/image-20230130142624937.png" alt="image-20230130142624937"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">int (*px)[2];</span><br><span class="line">int (*py)[2][3];</span><br><span class="line">char (*pz)[2];</span><br><span class="line">char (*pk)[2][3];</span><br><span class="line"></span><br><span class="line">*(*(px+0)+0)   03020100</span><br><span class="line">*(*(px+1)+0)    20000907</span><br><span class="line">*(*(px+2)+3)   1100</span><br><span class="line">*(*(*(py+1)+2)+3)   01</span><br><span class="line">*(*(pz+2)+3)  07</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int *(pFunc)(int,int)</span><br><span class="line">sizeof = 4</span><br><span class="line"></span><br><span class="line">int Function(int x, int y)</span><br><span class="line">&#123;&#125;</span><br><span class="line"></span><br><span class="line">int (*pFun)(int,int);</span><br><span class="line">pFun = Function;</span><br><span class="line">int x= pFun(1,2);</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230130145723603.png" alt="image-20230130145723603"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">int Func(int x,int y)</span><br><span class="line">&#123;</span><br><span class="line">	return x*y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">0040D770 55                   push        ebp</span><br><span class="line">0040D771 8B EC                mov         ebp,esp</span><br><span class="line">0040D773 83 EC 40             sub         esp,40h</span><br><span class="line">0040D776 53                   push        ebx</span><br><span class="line">0040D777 56                   push        esi</span><br><span class="line">0040D778 57                   push        edi</span><br><span class="line">0040D779 8D 7D C0             lea         edi,[ebp-40h]</span><br><span class="line">0040D77C B9 10 00 00 00       mov         ecx,10h</span><br><span class="line">0040D781 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class="line">0040D786 F3 AB                rep stos    dword ptr [edi]</span><br><span class="line">0040D788 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class="line">0040D78B 0F AF 45 0C          imul        eax,dword ptr [ebp+0Ch]</span><br><span class="line">0040D78F 5F                   pop         edi</span><br><span class="line">0040D790 5E                   pop         esi</span><br><span class="line">0040D791 5B                   pop         ebx</span><br><span class="line">0040D792 8B E5                mov         esp,ebp</span><br><span class="line">0040D794 5D                   pop         ebp</span><br><span class="line">0040D795 C3                   ret</span><br><span class="line">55</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">unsigned char Func[] = &#123;</span><br><span class="line">	0x55,              </span><br><span class="line">    0x8B, 0xEC,           </span><br><span class="line">    0x83, 0xEC, 0x40,        </span><br><span class="line">    0x53,              </span><br><span class="line">    0x56,              </span><br><span class="line">    0x57,              </span><br><span class="line">    0x8D, 0x7D, 0xC0,        </span><br><span class="line">    0xB9, 0x10, 0x00, 0x00, 0x00,  </span><br><span class="line">    0xB8, 0xCC, 0xCC, 0xCC, 0xCC,  </span><br><span class="line">    0xF3, 0xAB,    </span><br><span class="line">    0x8B, 0x45, 0x08,     </span><br><span class="line">    0x0F, 0xAF, 0x45, 0x0C,</span><br><span class="line">    0x5F,              </span><br><span class="line">    0x5E,              </span><br><span class="line">    0x5B,              </span><br><span class="line">    0x8B, 0xE5,           </span><br><span class="line">    0x5D,              </span><br><span class="line">    0xC3              </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	int (*p)(int,int);</span><br><span class="line">	p = (int (*)(int,int))&amp;Func;</span><br><span class="line">	int x = p(3,4);</span><br><span class="line">	printf(&quot;%d\n&quot;,x);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="位运算"><a class="markdownIt-Anchor" href="#位运算">#</a> 位运算</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">算术移位</span><br><span class="line">SAL/SAR Reg/Mem,CL/Imm</span><br><span class="line"></span><br><span class="line">SAL:算术左移，补0</span><br><span class="line">SAR:算术右移，补符号位</span><br><span class="line"></span><br><span class="line">逻辑位移</span><br><span class="line">SHL 补0</span><br><span class="line">SHR 补0</span><br><span class="line"></span><br><span class="line">循环位移 </span><br><span class="line">ROL</span><br><span class="line">ROR</span><br><span class="line"></span><br><span class="line">带进位的循环移位指令</span><br><span class="line">RCL</span><br><span class="line">RCR</span><br><span class="line"></span><br><span class="line">2&amp;3 = 2</span><br><span class="line">2|3 = 3</span><br><span class="line">~2 = fd</span><br><span class="line">2^3 = 1</span><br><span class="line"></span><br><span class="line">int x</span><br><span class="line">x &gt;&gt; rol</span><br><span class="line">x &lt;&lt; shr</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="define"><a class="markdownIt-Anchor" href="#define">#</a> define</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">替换</span><br><span class="line">编译</span><br><span class="line">连接</span><br><span class="line"></span><br><span class="line">typedef只能给类型起别名</span><br><span class="line">define可以给任何起别名</span><br><span class="line"></span><br><span class="line">define定义的变量不在常量区，在替换的环节直接替换为</span><br><span class="line"></span><br><span class="line">#define PI 3.14   //无参数宏</span><br><span class="line">#define MAX(A,B) ((A)&gt;(B)?(A):(B))     //无堆栈调用</span><br><span class="line">#define \ 定义多行</span><br><span class="line"></span><br><span class="line">//避免重复包含</span><br><span class="line">#if !define(ZZZ)</span><br><span class="line">#define ZZZ </span><br><span class="line">...</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//stdafx.h</span><br><span class="line"></span><br><span class="line">#if !defined(AFX_STDAFX_H__7058845C_68A9_4312_A9CE_A08FAB5CE1F2__INCLUDED_)</span><br><span class="line">#define AFX_STDAFX_H__7058845C_68A9_4312_A9CE_A08FAB5CE1F2__INCLUDED_</span><br><span class="line"></span><br><span class="line">#if _MSC_VER &gt; 1000</span><br><span class="line">#pragma once     //pragma对编译器兼容不好，如果版本&gt;1000才使用pragma once ,否则就使用上面的方法</span><br><span class="line">#endif // _MSC_VER &gt; 1000</span><br><span class="line"></span><br><span class="line">#define WIN32_LEAN_AND_MEAN		// Exclude rarely-used stuff from Windows headers</span><br><span class="line"></span><br><span class="line">#include &lt;stdio.h&gt;</span><br></pre></td></tr></table></figure>
<h3 id="malloc"><a class="markdownIt-Anchor" href="#malloc">#</a> malloc</h3>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="string">&quot;&quot;</span> 先到当前目录，&lt;&gt;先到安装目录</span><br><span class="line"></span><br><span class="line"><span class="type">int</span>* ptr;</span><br><span class="line">ptr = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>)*<span class="number">128</span>); <span class="comment">//void* malloc(size_t size)   void*类型不确定，用的时候强转</span></span><br><span class="line"><span class="keyword">if</span> (ptr == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">0</span>;        <span class="comment">//无法分配内存的时候返回NULL</span></span><br><span class="line"><span class="built_in">memset</span>(ptr,<span class="number">0</span>,<span class="keyword">sizeof</span>(<span class="type">int</span>)*<span class="number">128</span>);    <span class="comment">//初始化分配的内存空间</span></span><br><span class="line">*(ptr) = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">free</span>(ptr);   <span class="comment">//释放堆空间</span></span><br><span class="line">ptr = <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fopen</span><br><span class="line">fseek  设置文件指针</span><br><span class="line">ftell  文件大小</span><br><span class="line">fclose</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201143200063.png" alt="image-20230201143200063"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;stdlib.h&quot;</span><br><span class="line">#include &quot;malloc.h&quot;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	FILE *fp = NULL;</span><br><span class="line">	fp = fopen(&quot;C:\\Windows\\System32\\notepad.exe&quot;,&quot;rb&quot;);</span><br><span class="line">	</span><br><span class="line">	if(fp == NULL) return -1;</span><br><span class="line"></span><br><span class="line">	fseek(fp,0,SEEK_END);</span><br><span class="line"></span><br><span class="line">	int len = ftell(fp);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	//printf(&quot;%d\n&quot;,len);</span><br><span class="line">	char* ptr;</span><br><span class="line">	ptr = (char*)malloc(len);</span><br><span class="line">	if(ptr == NULL) return -1;</span><br><span class="line">	memset(ptr,0,len);</span><br><span class="line"></span><br><span class="line">	int c;</span><br><span class="line">	while(1)</span><br><span class="line">	&#123;</span><br><span class="line">		c = fgetc(fp);</span><br><span class="line">		if(feof(fp)) break;</span><br><span class="line">		printf(&quot;%c&quot;, c);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;%X\n&quot;,ptr);</span><br><span class="line"></span><br><span class="line">	free(ptr);</span><br><span class="line">	ptr = NULL;</span><br><span class="line">	fclose(fp);</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="pe"><a class="markdownIt-Anchor" href="#pe">#</a> PE</h2>
<h3 id="pe结构"><a class="markdownIt-Anchor" href="#pe结构">#</a> PE 结构</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sys dll exe 4D5A开头 MZ的ASCII</span><br><span class="line"></span><br><span class="line">PE结构是分节的</span><br><span class="line">1.节省硬盘空间，内存中的空隙会更大(任何exe都有自己的4G空间，2G程序，2G操作系统，通过指针访问低2G,通过驱动访问高2G)</span><br><span class="line">2.对齐：早期程序硬盘对齐200H，内存对齐1000H.现在大部分都是1000H字节对齐，增加读写速度</span><br><span class="line">3.节省内存，不在复制全部节</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203140027163.png" alt="image-20230203140027163"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">DOS头</span><br><span class="line">WORD e_magic    MZ判断是否是可执行文件</span><br><span class="line">DWORD e_lfanew  从文件开始算，偏移e_lfanew个字节就是PE文件开始 </span><br><span class="line"></span><br><span class="line">NT头</span><br><span class="line">Machine</span><br><span class="line">NumberOfSections</span><br><span class="line">TimeDateStamp</span><br><span class="line">SizeOfOptionalHeader</span><br><span class="line">Characteristics</span><br><span class="line"></span><br><span class="line">可选PE头</span><br><span class="line">Magic</span><br><span class="line">SizeOfCode</span><br><span class="line">SizeOfInitializedData</span><br><span class="line">SizeOfUnInitializedData</span><br><span class="line">AddressOfEntryPoint</span><br><span class="line">BaseOfCode</span><br><span class="line">BaseOfData</span><br><span class="line">ImageBase</span><br><span class="line">SectionAlignment;</span><br><span class="line">FileAlignment</span><br><span class="line">SizeOfImage</span><br><span class="line">SizeOfHeaders</span><br><span class="line">CheckSum</span><br><span class="line">SizeOfStackReverse</span><br><span class="line">SizeOfStackCommit</span><br><span class="line">SizeOfHeapReverse</span><br><span class="line">SizeOfHeapCommit</span><br></pre></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//x64 regedit.exe</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_DOS_HEADER</span> &#123;</span>      <span class="comment">// DOS .EXE header</span></span><br><span class="line">    WORD   e_magic;  <span class="number">5</span>A4D                     <span class="comment">// Magic number MZ标记用于判断是否是可执行文件								</span></span><br><span class="line">    WORD   e_cblp;   <span class="number">0090</span>                   <span class="comment">// Bytes on last page of file</span></span><br><span class="line">    WORD   e_cp;     <span class="number">0003</span>                   <span class="comment">// Pages in file</span></span><br><span class="line">    WORD   e_crlc;   <span class="number">0000</span>                   <span class="comment">// Relocations</span></span><br><span class="line">    WORD   e_cparhdr;   <span class="number">0004</span>                <span class="comment">// Size of header in paragraphs</span></span><br><span class="line">    WORD   e_minalloc;  <span class="number">0000</span>                <span class="comment">// Minimum extra paragraphs needed</span></span><br><span class="line">    WORD   e_maxalloc;  FFFF                <span class="comment">// Maximum extra paragraphs needed</span></span><br><span class="line">    WORD   e_ss;  <span class="number">0000</span>                      <span class="comment">// Initial (relative) SS value</span></span><br><span class="line">    WORD   e_sp;  <span class="number">00B</span>8                      <span class="comment">// Initial SP value</span></span><br><span class="line">    WORD   e_csum;  <span class="number">0000</span>                     <span class="comment">// Checksum</span></span><br><span class="line">    WORD   e_ip;    <span class="number">0000</span>                     <span class="comment">// Initial IP value</span></span><br><span class="line">    WORD   e_cs;    <span class="number">0000</span>                    <span class="comment">// Initial (relative) CS value</span></span><br><span class="line">    WORD   e_lfarlc;     <span class="number">0040</span>                <span class="comment">// File address of relocation table</span></span><br><span class="line">    WORD   e_ovno;       <span class="number">0000</span>               <span class="comment">// Overlay number</span></span><br><span class="line">    WORD   e_res[<span class="number">4</span>];     <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>               <span class="comment">// Reserved words</span></span><br><span class="line">    WORD   e_oemid;      <span class="number">0000</span>               <span class="comment">// OEM identifier (for e_oeminfo)</span></span><br><span class="line">    WORD   e_oeminfo;    <span class="number">0000</span>               <span class="comment">// OEM information; e_oemid specific</span></span><br><span class="line">    WORD   e_res2[<span class="number">10</span>];   <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span> <span class="number">0000</span>               <span class="comment">// Reserved words</span></span><br><span class="line">    DWORD  e_lfanew;     <span class="number">0000</span> <span class="number">00F</span>8               <span class="comment">// File address of new exe header PE头相对于文件的偏移，定位PE文件</span></span><br><span class="line">&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br><span class="line"><span class="comment">//0x40</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class="line">    DWORD Signature;    <span class="number">00004550</span></span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class="line"><span class="comment">//E0+14+4=0xF8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class="line">    WORD    Machine;        <span class="number">8664</span>   <span class="comment">//程序运行的CPU型号，0x0任何处理器，0x14C 386及后续处理器</span></span><br><span class="line">    WORD    NumberOfSections;    <span class="number">0007</span>   <span class="comment">//文件中节的总数，要新增或者合并节，修改值</span></span><br><span class="line">    DWORD   TimeDateStamp;     AC6AAA87   <span class="comment">//时间戳：文件创建时间，编译器填写，可以用于判断map文件生成时间</span></span><br><span class="line">    DWORD   PointerToSymbolTable; <span class="number">00000000</span>  </span><br><span class="line">    DWORD   NumberOfSymbols;   <span class="number">00000000</span></span><br><span class="line">    WORD    SizeOfOptionalHeader;   <span class="number">00F</span>0   <span class="comment">//可选PE头大小，32位默认E0H，64位默认F0，大小可以自定义</span></span><br><span class="line">    WORD    Characteristics;     <span class="number">0022</span>      <span class="comment">//可执行文件为10F，每位有不同含义</span></span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br><span class="line"><span class="comment">//0x14</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IMAGE_OPTIONAL_HEADER</span> &#123;</span></span><br><span class="line">    WORD    Magic;		 <span class="number">020B</span>     <span class="comment">//10B 32位下PE   20B 64位下pe</span></span><br><span class="line">    BYTE    MajorLinkerVersion; <span class="number">0</span>E</span><br><span class="line">    BYTE    MinorLinkerVersion; <span class="number">14</span></span><br><span class="line">    DWORD   SizeOfCode;  <span class="number">00023400</span>     <span class="comment">//所有 节的和，必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class="line">    DWORD   SizeOfInitializedData;  <span class="number">00079400</span>    <span class="comment">//已初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class="line">    DWORD   SizeOfUninitializedData; <span class="number">00000000</span>   <span class="comment">//未初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class="line">    DWORD   AddressOfEntryPoint;   <span class="number">00023520</span>     <span class="comment">//程序入口，但在内存中真正的入口在imagebase+OEP,一个exe中包含多个pe文件，且exe有独立空间</span></span><br><span class="line">    DWORD   BaseOfCode;			<span class="number">00001000</span>		<span class="comment">//代码开始的基址</span></span><br><span class="line">    DWORD   BaseOfData;			<span class="number">40000000</span>		<span class="comment">//数据开始的基址</span></span><br><span class="line">    DWORD   ImageBase;			<span class="number">00000100</span>		<span class="comment">//内存镜像地址，内存中数据是哪里开始的</span></span><br><span class="line">    DWORD   SectionAlignment;	<span class="number">00001000</span>        <span class="comment">//内存对齐</span></span><br><span class="line">    DWORD   FileAlignment;		<span class="number">00000002</span>        <span class="comment">//文件对齐</span></span><br><span class="line">    WORD    MajorOperatingSystemVersion;	<span class="number">000</span>A		</span><br><span class="line">    WORD    MinorOperatingSystemVersion;    <span class="number">0000</span></span><br><span class="line">    WORD    MajorImageVersion;				<span class="number">000</span>A</span><br><span class="line">    WORD    MinorImageVersion;				<span class="number">0000</span></span><br><span class="line">    WORD    MajorSubsystemVersion;			<span class="number">000</span>A</span><br><span class="line">    WORD    MinorSubsystemVersion;			<span class="number">0000</span></span><br><span class="line">    DWORD   Win32VersionValue;				<span class="number">00000000</span></span><br><span class="line">    DWORD   SizeOfImage;					<span class="number">000</span>A2000    <span class="comment">//内存中整个PE文件的映射的尺寸，必须是FileAlignment的整数倍</span></span><br><span class="line">    DWORD   SizeOfHeaders;					<span class="number">00000400</span>    <span class="comment">//所有头+节表按照文件对齐后的大小</span></span><br><span class="line">    DWORD   CheckSum;						<span class="number">0005</span>D8CD</span><br><span class="line">    WORD    Subsystem;						<span class="number">0020</span></span><br><span class="line">    WORD    DllCharacteristics;				C160</span><br><span class="line">    DWORD   SizeOfStackReserve;				<span class="number">00080000</span>	<span class="comment">//初始化时保留的堆栈大小</span></span><br><span class="line">    DWORD   SizeOfStackCommit;				<span class="number">00000000</span></span><br><span class="line">    DWORD   SizeOfHeapReserve;				<span class="number">00004000</span></span><br><span class="line">    DWORD   SizeOfHeapCommit;				<span class="number">00000000</span></span><br><span class="line">    DWORD   LoaderFlags;					<span class="number">00100000</span>	</span><br><span class="line">    DWORD   NumberOfRvaAndSizes;			<span class="number">00000000</span>	<span class="comment">//目录项目数</span></span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class="line"><span class="comment">//0xE0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">//Unpacker.exe</span><br><span class="line">typedef struct _IMAGE_DOS_HEADER &#123;      // DOS .EXE header</span><br><span class="line">    WORD   e_magic;  5A4D                     // Magic number MZ标记用于判断是否是可执行文件								</span><br><span class="line">    WORD   e_cblp;   0090                   // Bytes on last page of file</span><br><span class="line">    WORD   e_cp;     0003                   // Pages in file</span><br><span class="line">    WORD   e_crlc;   0000                   // Relocations</span><br><span class="line">    WORD   e_cparhdr;   0004                // Size of header in paragraphs</span><br><span class="line">    WORD   e_minalloc;  0000                // Minimum extra paragraphs needed</span><br><span class="line">    WORD   e_maxalloc;  FFFF                // Maximum extra paragraphs needed</span><br><span class="line">    WORD   e_ss;  0000                      // Initial (relative) SS value</span><br><span class="line">    WORD   e_sp;  00B8                      // Initial SP value</span><br><span class="line">    WORD   e_csum;  0000                     // Checksum</span><br><span class="line">    WORD   e_ip;    0000                     // Initial IP value</span><br><span class="line">    WORD   e_cs;    0000                    // Initial (relative) CS value</span><br><span class="line">    WORD   e_lfarlc;     0040                // File address of relocation table</span><br><span class="line">    WORD   e_ovno;       0000               // Overlay number</span><br><span class="line">    WORD   e_res[4];     0000 0000 0000 0000               // Reserved words</span><br><span class="line">    WORD   e_oemid;      0000               // OEM identifier (for e_oeminfo)</span><br><span class="line">    WORD   e_oeminfo;    0000               // OEM information; e_oemid specific</span><br><span class="line">    WORD   e_res2[10];   0000 0000 0000 0000 0000 0000 0000 0000 0000 0000               // Reserved words</span><br><span class="line">    DWORD  e_lfanew;     0000 0108               // File address of new exe header PE头相对于文件的偏移，定位PE文件</span><br><span class="line">&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br><span class="line">//0x40</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">typedef struct _IMAGE_NT_HEADERS &#123;</span><br><span class="line">    DWORD Signature;    00004550</span><br><span class="line">    IMAGE_FILE_HEADER FileHeader;</span><br><span class="line">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class="line">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_FILE_HEADER &#123;</span><br><span class="line">    WORD    Machine;        014C   //程序运行的CPU型号，0x0任何处理器，0x14 386及后续处理器</span><br><span class="line">    WORD    NumberOfSections;    0004   //文件中节的总数，要新增或者合并节，修改值</span><br><span class="line">    DWORD   TimeDateStamp;     491D4B09   //时间戳：文件创建时间，编译器填写</span><br><span class="line">    DWORD   PointerToSymbolTable; 00000000  </span><br><span class="line">    DWORD   NumberOfSymbols;   00000000</span><br><span class="line">    WORD    SizeOfOptionalHeader;   00E0   //可选PE投大小，32位默认E0H，64位默认F0，大小可以自定义</span><br><span class="line">    WORD    Characteristics;     010F      //可执行文件尾10F</span><br><span class="line">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br><span class="line">//0x14</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_OPTIONAL_HEADER &#123;</span><br><span class="line">    WORD    Magic;		 10B     //10B32位下PE   20B64位下pe</span><br><span class="line">    BYTE    MajorLinkerVersion; 06</span><br><span class="line">    BYTE    MinorLinkerVersion; 00</span><br><span class="line">    DWORD   SizeOfCode;  11000     //所有代码节的和，必须是FileAlignment的整数倍，编译器填的没用</span><br><span class="line">    DWORD   SizeOfInitializedData;  2F000    //已初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span><br><span class="line">    DWORD   SizeOfUninitializedData; 00000000   //未初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span><br><span class="line">    DWORD   AddressOfEntryPoint;   10D4F     //程序入口</span><br><span class="line">    DWORD   BaseOfCode;			00001000		//代码开始的基址</span><br><span class="line">    DWORD   BaseOfData;			12000		//数据开始的基址</span><br><span class="line">    DWORD   ImageBase;			400000		//内存镜像地址</span><br><span class="line">    DWORD   SectionAlignment;	00001000        //内存对齐</span><br><span class="line">    DWORD   FileAlignment;		00001000        //文件对齐</span><br><span class="line">    WORD    MajorOperatingSystemVersion;	0004		</span><br><span class="line">    WORD    MinorOperatingSystemVersion;    0000</span><br><span class="line">    WORD    MajorImageVersion;				0000</span><br><span class="line">    WORD    MinorImageVersion;				0000</span><br><span class="line">    WORD    MajorSubsystemVersion;			0004</span><br><span class="line">    WORD    MinorSubsystemVersion;			0000</span><br><span class="line">    DWORD   Win32VersionValue;				00000000</span><br><span class="line">    DWORD   SizeOfImage;					41000    //内存中整个PE文件的映射的尺寸，必须是FileAlignment的整数倍，即拉伸后大小，imagebuffer</span><br><span class="line">    DWORD   SizeOfHeaders;					1000    //所有头+节表按照文件对齐后的大小，严格按照FileAlignment对齐</span><br><span class="line">    DWORD   CheckSum;						00000000  //每两个字节相加，存到checksum，存不下自然溢出</span><br><span class="line">    WORD    Subsystem;						0002</span><br><span class="line">    WORD    DllCharacteristics;				0000</span><br><span class="line">    DWORD   SizeOfStackReserve;				100000	//初始化时保留的堆栈大小</span><br><span class="line">    DWORD   SizeOfStackCommit;				1000</span><br><span class="line">    DWORD   SizeOfHeapReserve;				100000</span><br><span class="line">    DWORD   SizeOfHeapCommit;				1000</span><br><span class="line">    DWORD   LoaderFlags;					00000000	</span><br><span class="line">    DWORD   NumberOfRvaAndSizes;			00000010	//目录项目数</span><br><span class="line">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class="line">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class="line">//E0</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203150643470.png" alt="image-20230203150643470"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230204150314850.png" alt="image-20230204150314850"></p>
<p>将文件读取到内存中，此时称 FileBuffer，如果内存对齐和文件对齐一样，那么不拉伸，但还是不能直接加载</p>
<p>如果两者不一样，需要先在内存中进行拉伸，此事成为 image buffer</p>
<p>image buffer 从 imagebase 开始</p>
<p>imagebase 用于模块对齐和保护指针</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301170240621.png" alt="image-20230301170240621"></p>
<p>正常情况下 OEP 在 text 代码段中，OEP 真正的位置 = OEP + imagebase</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdlib.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;malloc.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> FILEPATH <span class="string">&quot;C:\\Users\\shinya\\Desktop\\Unpacker.exe&quot;</span></span></span><br><span class="line"></span><br><span class="line">LPVOID <span class="title function_">ReadPELoader</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">	FILE *fp = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	fp = fopen(FILEPATH, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (fp == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;fp = NULL&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fseek(fp, <span class="number">0</span>, SEEK_END);</span><br><span class="line"></span><br><span class="line">	len = ftell(fp);</span><br><span class="line"></span><br><span class="line">	fseek(fp, <span class="number">0</span>, SEEK_SET);</span><br><span class="line"></span><br><span class="line">	pFileBuffer = <span class="built_in">malloc</span>(len);</span><br><span class="line">	<span class="keyword">if</span> (!pFileBuffer)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;ptr = NULL&quot;</span>);</span><br><span class="line">		fclose(fp);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="type">size_t</span> reader = fread(pFileBuffer, len, <span class="number">1</span>, fp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!reader)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;reader= 0&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">		fclose(fp);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>, pFileBuffer);</span><br><span class="line">	fclose(fp);</span><br><span class="line">	<span class="keyword">return</span> pFileBuffer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">PrintNTHeader</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pPEHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER32 pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pFileBuffer = ReadPELoader();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (!pFileBuffer)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;文件读取失败&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (*((PWORD)pFileBuffer) != IMAGE_DOS_SIGNATURE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;不是有效mz标识&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;MZ标志:%X\n&quot;</span>, pDosHeader-&gt;e_magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;PE偏移:%X\n&quot;</span>, pDosHeader-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断是否是有效的PE标志</span></span><br><span class="line">	<span class="keyword">if</span> (*((PDWORD)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew)) != IMAGE_NT_SIGNATURE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;不是有效的PE标志\n&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印NT头</span></span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;NT:%X\n&quot;</span>, pNTHeader-&gt;Signature);</span><br><span class="line">	pPEHeader = (PIMAGE_FILE_HEADER)(((DWORD)pNTHeader) + <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;PE:%X\n&quot;</span>, pPEHeader-&gt;Machine);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;节的数量:%X\n&quot;</span>, pPEHeader-&gt;NumberOfSections);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;SizeOfOptionalHeader:%X\n&quot;</span>, pPEHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//可选PE头</span></span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pPEHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional_PE:%X\n&quot;</span>, pOptionHeader-&gt;Magic);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">	PrintNTHeader();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">LPVOID <span class="title">OpenFile</span><span class="params">(<span class="type">char</span>* FilePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FILE* fp;</span><br><span class="line">	fp = <span class="built_in">fopen</span>(FilePath,<span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(fp == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fseek</span>(fp,<span class="number">0</span>,SEEK_END);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获得文件指针长度</span></span><br><span class="line">	<span class="type">int</span> len = <span class="built_in">ftell</span>(fp);  </span><br><span class="line"></span><br><span class="line">	<span class="built_in">fseek</span>(fp,<span class="number">0</span>,SEEK_SET);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开辟堆区</span></span><br><span class="line">	LPVOID ptr;</span><br><span class="line">	ptr = (LPVOID)<span class="built_in">malloc</span>(len);</span><br><span class="line">	<span class="keyword">if</span>(ptr == <span class="literal">NULL</span>) </span><br><span class="line">	&#123;</span><br><span class="line">		cout&lt;&lt; <span class="string">&quot;ptr == NULL&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(ptr);</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(ptr,<span class="number">0</span>,len);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//读文件</span></span><br><span class="line">	<span class="type">size_t</span> reader = <span class="built_in">fread</span>(ptr,len,<span class="number">1</span>,fp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(reader == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout&lt;&lt; <span class="string">&quot;reader == NULL&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(ptr);</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(fp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> ptr;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ResolvePEHeader</span><span class="params">(<span class="type">char</span>* FilePath)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = (LPVOID)<span class="built_in">OpenFile</span>(FilePath);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(pFileBuffer == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;pFileBuffer == NULL\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (*(PWORD)pDosHeader != IMAGE_DOS_SIGNATURE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;not a valid mz signature\n&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;valid mz signature\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------DOS header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;DOS header: e_magic=%X\n&quot;</span>,pDosHeader-&gt;e_magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;DOS header: e_lfanew=%X\n&quot;</span>,pDosHeader-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------NT header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;NT header: Signature=%X\n&quot;</span>,pNTHeader-&gt;Signature);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------File header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: Machine=%X\n&quot;</span>,pFileHeader-&gt;Machine);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: NumberOfSections=%X\n&quot;</span>,pFileHeader-&gt;NumberOfSections);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: TimeDateStamp=%X\n&quot;</span>,pFileHeader-&gt;TimeDateStamp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: SizeOfOptionalHeader=%X\n&quot;</span>,pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: Characteristics=%X\n&quot;</span>,pFileHeader-&gt;Characteristics);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------Optional header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: Magic=%X\n&quot;</span>,pOptionHeader-&gt;Magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfCode=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfCode);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: AddressOfEntryPoint=%X\n&quot;</span>,pOptionHeader-&gt;AddressOfEntryPoint);	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: BaseOfCode=%X\n&quot;</span>,pOptionHeader-&gt;BaseOfCode);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: BaseOfData=%X\n&quot;</span>,pOptionHeader-&gt;BaseOfData);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: ImageBase=%X\n&quot;</span>,pOptionHeader-&gt;ImageBase);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SectionAlignment=%X\n&quot;</span>,pOptionHeader-&gt;SectionAlignment);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: FileAlignment=%X\n&quot;</span>,pOptionHeader-&gt;FileAlignment);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfImage=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfImage);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfHeaders=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfHeaders);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: CheckSum=%X\n&quot;</span>,pOptionHeader-&gt;CheckSum);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">char</span>* FilePath = <span class="string">&quot;C:\\Users\\shinya\\Desktop\\Unpacker.exe&quot;</span>;</span><br><span class="line">	<span class="built_in">ResolvePEHeader</span>(FilePath) ;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">union Test     //类型</span><br><span class="line">&#123;</span><br><span class="line">	char x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;;</span><br><span class="line">sizeof取成员变量中最大的</span><br><span class="line"></span><br><span class="line">1、联合体的成员是共享内存空间的中</span><br><span class="line">2、联合体的内存空间大小是联合体成员中对内存空间大小要求最大的空间大小</span><br><span class="line">3、联合体最多只有一个成员有效</span><br><span class="line"></span><br><span class="line">Test test;</span><br><span class="line">test.y = 0x12345678;</span><br><span class="line">printf(&quot;%X\n&quot;,test.x);	//0x78</span><br><span class="line">printf(&quot;%X\n&quot;,test.y);  //0x12345678</span><br><span class="line"></span><br><span class="line">union</span><br><span class="line">&#123;</span><br><span class="line">	char x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;Testhaha;      //变量</span><br><span class="line">Testhaha.y = 0x12345678;</span><br><span class="line">printf(&quot;%d&quot;,Testhaha)   //0x12345678</span><br><span class="line"></span><br><span class="line">结构体也可以这么写</span><br><span class="line">struct</span><br><span class="line">&#123;</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;shabi;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="节表"><a class="markdownIt-Anchor" href="#节表">#</a> 节表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_SECTION_HEADER &#123;</span><br><span class="line">    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];// 节表名称,如“.text” ,如果不是以\0结尾，系统会截取8个字节长度处理</span><br><span class="line">  //IMAGE_SIZEOF_SHORT_NAME=8,创建长度为9的数组，最后以0结尾，不要用char*</span><br><span class="line">    union &#123;</span><br><span class="line">      //　共用体，也叫联合体，在一个“联合”内可以定义多种不同的数据类型， </span><br><span class="line">//一个被说明为该“联合”类型的变量中，允许装入该“联合”所定义的任何一种数据，这些数据共享同一段内存，</span><br><span class="line">//以达到节省空间的目的。union变量所占用的内存长度等于最长的成员的内存长度。</span><br><span class="line">            DWORD   PhysicalAddress; //当前节的名称 ， 占8字节</span><br><span class="line">            DWORD   VirtualSize; //内存中文件对齐大小</span><br><span class="line">    &#125; Misc;   //对齐前的真实尺寸，可以不准确,没有程序照样运行，misc可以大于sizeofrawdata</span><br><span class="line">    DWORD   VirtualAddress; //在内存中的偏移地址 +imageOfBase=真正的位置</span><br><span class="line">    DWORD   SizeOfRawData; //当前节在文件中对齐后的大小 也就是节点的大小</span><br><span class="line">    DWORD   PointerToRawData; //当前节在文件中的偏移 也就是文件的开始位置，一定是文件对齐的整数倍</span><br><span class="line">    DWORD   PointerToRelocations; // 调试相关</span><br><span class="line">    DWORD   PointerToLinenumbers;// 调试相关</span><br><span class="line">    WORD    NumberOfRelocations;// 调试相关</span><br><span class="line">    WORD    NumberOfLinenumbers;// 调试相关</span><br><span class="line">    DWORD   Characteristics; //文件属性，比如该节数据属性是否为可执行属性，都在这里面</span><br><span class="line">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205140709262.png" alt="image-20230205140709262"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230302175633767.png" alt="image-20230302175633767"></p>
<p>MISC = a - b</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205140950190.png" alt="image-20230205140950190"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205143439207.png" alt="image-20230205143439207"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">标志(属性块) 常用特征值对照表：</span><br><span class="line"></span><br><span class="line">[值:00000020h] [IMAGE_SCN_CNT_CODE                // Section contains code.(包含可执行代码)]</span><br><span class="line">[值:00000040h] [IMAGE_SCN_CNT_INITIALIZED_DATA    // Section contains initialized data.(该块包含已初始化的数据)]</span><br><span class="line">[值:00000080h] [IMAGE_SCN_CNT_UNINITIALIZED_DATA  // Section contains uninitialized data.(该块包含未初始化的数据)]</span><br><span class="line">[值:00000200h] [IMAGE_SCN_LNK_INFO                // Section contains comments or some other type of information.]</span><br><span class="line">[值:00000800h] [IMAGE_SCN_LNK_REMOVE              // Section contents will not become part of image.]</span><br><span class="line">[值:00001000h] [IMAGE_SCN_LNK_COMDAT              // Section contents comdat.]</span><br><span class="line">[值:00004000h] [IMAGE_SCN_NO_DEFER_SPEC_EXC       // Reset speculative exceptions handling bits in the TLB entries for this section.]</span><br><span class="line">[值:00008000h] [IMAGE_SCN_GPREL                   // Section content can be accessed relative to GP.]</span><br><span class="line">[值:00500000h] [IMAGE_SCN_ALIGN_16BYTES           // Default alignment if no others are specified.]</span><br><span class="line">[值:01000000h] [IMAGE_SCN_LNK_NRELOC_OVFL         // Section contains extended relocations.]</span><br><span class="line">[值:02000000h] [IMAGE_SCN_MEM_DISCARDABLE         // Section can be discarded.]</span><br><span class="line">[值:04000000h] [IMAGE_SCN_MEM_NOT_CACHED          // Section is not cachable.]</span><br><span class="line">[值:08000000h] [IMAGE_SCN_MEM_NOT_PAGED           // Section is not pageable.]</span><br><span class="line">[值:10000000h] [IMAGE_SCN_MEM_SHARED              // Section is shareable(该块为共享块).]</span><br><span class="line">[值:20000000h] [IMAGE_SCN_MEM_EXECUTE             // Section is executable.(该块可执行)]</span><br><span class="line">[值:40000000h] [IMAGE_SCN_MEM_READ                // Section is readable.(该块可读)]</span><br><span class="line">[值:80000000h] [IMAGE_SCN_MEM_WRITE               // Section is writeable.(该块可写)]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>手动画图列数据</p>
<p>写程序解析节表</p>
<p>使用 notepad</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DOS头 00h-40h</span><br><span class="line">40H-F7 垃圾数据</span><br><span class="line">F8-FB signature</span><br><span class="line">FC-10F 标准PE头 NumberOfSection = 7  sizeofoptionalheader = 0xF0</span><br><span class="line">110H-1FF 可选PE头</span><br><span class="line">200-227 节表1 .text   025E00  400</span><br><span class="line">228-24F 节表2 .rdata  9A00    26200</span><br><span class="line">250-277 节表3 .data   0E00    2FC00</span><br><span class="line">278-29F 节表4 .pdata  1200    30A00</span><br><span class="line">2A0-2C7 节表5 .didat  0200    31C00  </span><br><span class="line">2C8-2ef 节表6 .rsrc   0C00    31E00</span><br><span class="line">2f0-317 节表7 .reloc  0400    32A00</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Unpacker.exe</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DOS头 00h-39h</span><br><span class="line">垃圾数据 40h-107h</span><br><span class="line">NT头 108h-</span><br><span class="line">file header 10Ch-11f</span><br><span class="line">optional header 120-1ff</span><br><span class="line">section </span><br><span class="line">200 - 227 </span><br><span class="line">.text  </span><br><span class="line">misc 10AF0</span><br><span class="line">VA 1000</span><br><span class="line">soraw 11000</span><br><span class="line">ptrd 1000</span><br><span class="line">char 60000020</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"><span class="keyword">while</span>(pFileHeader-&gt;NumberOfSections &gt; <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> name[<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        name[i] = pSectionHeader-&gt;Name[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;---------SECTION_HEADER---------\n&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: Name=%s\n&quot;</span>, name);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: Misc=%X\n&quot;</span>, pSectionHeader-&gt;Misc);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: VirtualAddress=%X\n&quot;</span>, pSectionHeader-&gt;VirtualAddress);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: SizeOfRawData=%X\n&quot;</span>, pSectionHeader-&gt;SizeOfRawData);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: PointerToRawData=%X\n&quot;</span>, pSectionHeader-&gt;PointerToRawData);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Section header: Characteristics=%X\n&quot;</span>, pSectionHeader-&gt;Characteristics);</span><br><span class="line">    pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">    pFileHeader-&gt;NumberOfSections--;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303182144938.png" alt="image-20230303182144938"></p>
<p>sizeofheader = 所有头 + 节表 文件对齐后大小</p>
<p>MISC 可能大于 sizeofrawdata，含有未初始化的数据，比如 char arr [1000]; 文件中不分配，但内存中分配</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">FileBuffer -&gt; ImageBuffer</span><br><span class="line"></span><br><span class="line">1.分配新的内存，分配sizeofimage大小，初始化为0  (FileBuffer是按照文件大小分的，即ftell得出的尺寸)</span><br><span class="line"></span><br><span class="line">----接下来分块移动到内存中</span><br><span class="line"></span><br><span class="line">2.复制sizeofheaders，注意内存和文件的对齐，即内存中headers之后不一定直接是节</span><br><span class="line"></span><br><span class="line">3.循环复制节，从pintertorawdata开始，复制sizeofrawdata大小，复制到virtualaddress</span><br><span class="line"></span><br><span class="line">ImageBuffer -&gt; NewBuffer</span><br><span class="line">1.开辟最后一个节的pointertorawdaata + sizeofrawdata</span><br><span class="line"></span><br><span class="line">2.复制头</span><br><span class="line"></span><br><span class="line">3.把virtualaddress 复制到 pointertorawdata ，大小为sizeofrawdata</span><br><span class="line"></span><br><span class="line">空闲节添加代码</span><br><span class="line">1/读到filebuffer</span><br><span class="line">2.到imagebuffer</span><br><span class="line">3.判断空闲区是否够</span><br><span class="line">4.判断加哪 imagebase + VA + MISC</span><br><span class="line">5.复制shellcode</span><br><span class="line">6.修正E8 x-imagebuffer+imagebase</span><br><span class="line">7.修正E9</span><br><span class="line">8.修改OEP</span><br><span class="line">9.image -&gt; nnew</span><br><span class="line">10.存盘</span><br><span class="line"></span><br><span class="line">如果不往代码区里填，需要改属性，判断拉伸后剩余空间是否够</span><br><span class="line">在任意节里添加，封装函数</span><br><span class="line">属性通过 | 取并集</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230206140901033.png" alt="image-20230206140901033"></p>
<p>用函数写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DWORD ReadPEFile(IN LPSTR lpszFile, OUT LPVOID* pFileBuffer); //失败返回0，否则实际读取大小</span><br><span class="line"></span><br><span class="line">DWORD CopyFileBufferToImageBuffer(IN LPVOID PFileBuffer, OUT LPVOID* pImageBuffer);  //失败返回0，否则返回复制大小</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">bool MemeryToFile(IN LPVOID pMemBuffer, IN SIZE_T size, OUT LPSTR lpszFile);</span><br><span class="line"></span><br><span class="line">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, IN DWORD dwRva); //dwrva rva的值，返回转换后的rva的值，是吧返回0</span><br></pre></td></tr></table></figure>
<p>2. 将 RVA 转为 FOA   RVA 相对偏移地址就是下面的 1234，即内存中相对的偏移</p>
<p>FOA 文件中偏移，即下面的 634</p>
<p>imagebuffer 中并不能运行，还需要做一些别的工作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">imagebuffer中为501234的节在文件中什么位置 ，malloc返回500000</span><br><span class="line">imagebuffer开始的地址时malloc分的地址</span><br><span class="line"></span><br><span class="line">1.用501234-500000 = 1234</span><br><span class="line"></span><br><span class="line">2.循环判断1234在那个节中，大于第n个节virtualaddress，小于第n个节的virtualaddress+misc.virtualsize</span><br><span class="line"></span><br><span class="line">3.1234-第n个节表 = 1234 - 1000 = 234，即距离当前节开始的偏移</span><br><span class="line"></span><br><span class="line">4.pointertorawdata  +  234 = 400 + 234</span><br><span class="line"></span><br><span class="line">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, IN char* FilePath, DWORD dwRva)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(sizeof(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	printf(&quot;pFileBuffer: %X\n&quot;, pFileBuffer); //450068</span><br><span class="line">	printf(&quot;DWRVA: %X\n&quot;, dwRva); </span><br><span class="line">	DWORD MemOffset = (dwRva - (DWORD)pFileBuffer); //45C29C - 450068 = C234</span><br><span class="line">	printf(&quot;MemOffset: %X\n&quot;, MemOffset); </span><br><span class="line">	int NumOfSec = 0;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	DWORD thisVA = 0;</span><br><span class="line">	DWORD thisFile = 0;</span><br><span class="line">	while (pFileHeader-&gt;NumberOfSections &gt; 0)</span><br><span class="line">	&#123;</span><br><span class="line">		if ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class="line">		&#123;</span><br><span class="line">			thisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class="line">			thisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class="line">			printf(&quot;thisVA:%X\n&quot;,thisVA);  //C000</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">		pFileHeader-&gt;NumberOfSections--;</span><br><span class="line">		NumOfSec++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	printf(&quot;NumOfSec:%d\n&quot;, NumOfSec+1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	DWORD thisoffset = MemOffset - thisVA; //C234-C000 = 234;</span><br><span class="line"></span><br><span class="line">	printf(&quot;thisoffset:%X\n&quot;,thisoffset);</span><br><span class="line"></span><br><span class="line">	DWORD FilePos = thisoffset + thisFile; // 234 + AC00 = AE34</span><br><span class="line"></span><br><span class="line">	printf(&quot;FilePos:%X\n&quot;,FilePos);</span><br><span class="line"></span><br><span class="line">	return FilePos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void test()</span><br><span class="line">&#123;</span><br><span class="line">	//char* FilePath = &quot;C:\\Windows\\System32\\notepad.exe&quot;;</span><br><span class="line">	char* FilePath = &quot;C:\\Users\\shinya\\Desktop\\Unpacker.exe&quot;;</span><br><span class="line">	LPVOID pFileBuffer = (LPVOID)OpenFile(FilePath);</span><br><span class="line"></span><br><span class="line">	//ResolvePEHeader(pFileBuffer, FilePath);</span><br><span class="line">	RvaToFileOffset(pFileBuffer, FilePath,((DWORD)pFileBuffer+0x19543));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303212608618.png" alt="image-20230303212608618"></p>
<h3 id="代码节空白区添加代码"><a class="markdownIt-Anchor" href="#代码节空白区添加代码">#</a> 代码节空白区添加代码</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line">12:       MessageBox(0,0,0,0);</span><br><span class="line">004011A8 8B F4                mov         esi,esp</span><br><span class="line">004011AA 6A 00                push        0</span><br><span class="line">004011AC 6A 00                push        0</span><br><span class="line">004011AE 6A 00                push        0</span><br><span class="line">004011B0 6A 00                push        0</span><br><span class="line">004011B2 FF 15 E4 F2 43 00    call        dword ptr [__imp__MessageBoxA@16 (0043f2e4)]</span><br><span class="line"></span><br><span class="line">75EBFD1E 8B FF                mov         edi,edi</span><br><span class="line">75EBFD20 55                   push        ebp</span><br><span class="line">75EBFD21 8B EC                mov         ebp,esp</span><br><span class="line">75EBFD23 6A 00                push        0</span><br><span class="line">75EBFD25 FF 75 14             push        dword ptr [ebp+14h]</span><br><span class="line">75EBFD28 FF 75 10             push        dword ptr [ebp+10h]</span><br><span class="line">75EBFD2B FF 75 0C             push        dword ptr [ebp+0Ch]</span><br><span class="line">75EBFD2E FF 75 08             push        dword ptr [ebp+8]</span><br><span class="line">75EBFD31 E8 A0 FF FF FF       call        75EBFCD6</span><br><span class="line">75EBFD36 5D                   pop         ebp</span><br><span class="line">75EBFD37 C2 10 00             ret         10h</span><br><span class="line"></span><br><span class="line">call E8</span><br><span class="line">jmp E9</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">7650FD1E &gt;  8BFF            mov     edi,edi</span><br><span class="line">7650FD20    55              push    ebp</span><br><span class="line">7650FD21    8BEC            mov     ebp,esp</span><br><span class="line">7650FD23    6A 00           push    0x0</span><br><span class="line">7650FD25    FF75 14         push    dword ptr ss:[ebp+0x14]</span><br><span class="line">7650FD28    FF75 10         push    dword ptr ss:[ebp+0x10]</span><br><span class="line">7650FD2B    FF75 0C         push    dword ptr ss:[ebp+0xC]</span><br><span class="line">7650FD2E    FF75 08         push    dword ptr ss:[ebp+0x8]</span><br><span class="line">7650FD31    E8 A0FFFFFF     call    MessageBoxExA</span><br><span class="line">7650FD36    5D              pop     ebp</span><br><span class="line">7650FD37    C2 1000         retn    0x10</span><br><span class="line"></span><br><span class="line">760634D0 &lt;user32.MessageB | 8BFF                        | mov edi,edi                           |</span><br><span class="line">760634D2                  | 55                          | push ebp                              |</span><br><span class="line">760634D3                  | 8BEC                        | mov ebp,esp                           |</span><br><span class="line">760634D5                  | 833D 948C0876 00            | cmp dword ptr ds:[76088C94],0         |</span><br><span class="line">760634DC                  | 74 22                       | je user32.76063500                    |</span><br><span class="line">760634DE                  | 64:A1 18000000              | mov eax,dword ptr fs:[18]             |</span><br><span class="line">760634E4                  | BA 9C910876                 | mov edx,user32.7608919C               |</span><br><span class="line">760634E9                  | 8B48 24                     | mov ecx,dword ptr ds:[eax+24]         |</span><br><span class="line">760634EC                  | 33C0                        | xor eax,eax                           |</span><br><span class="line">760634EE                  | F0:0FB10A                   | lock cmpxchg dword ptr ds:[edx],ecx   |</span><br><span class="line">760634F2                  | 85C0                        | test eax,eax                          |</span><br><span class="line">760634F4                  | 75 0A                       | jne user32.76063500                   |</span><br><span class="line">760634F6                  | C705 008D0876 01000000      | mov dword ptr ds:[76088D00],1         |</span><br><span class="line">76063500                  | 6A FF                       | push FFFFFFFF                         |</span><br><span class="line">76063502                  | 6A 00                       | push 0                                |</span><br><span class="line">76063504                  | FF75 14                     | push dword ptr ss:[ebp+14]            |</span><br><span class="line">76063507                  | FF75 10                     | push dword ptr ss:[ebp+10]            |</span><br><span class="line">7606350A                  | FF75 0C                     | push dword ptr ss:[ebp+C]             |</span><br><span class="line">7606350D                  | FF75 08                     | push dword ptr ss:[ebp+8]             |</span><br><span class="line">76063510                  | E8 3B020000                 | call &lt;user32.MessageBoxTimeoutA&gt;      |</span><br><span class="line">76063515                  | 5D                          | pop ebp                               |</span><br><span class="line">76063516                  | C2 1000                     | ret 10                                |</span><br><span class="line"></span><br><span class="line">E8 3B020000                 | call &lt;user32.MessageBoxTimeoutA&gt;</span><br><span class="line">E9 ????????					| jmp ????????</span><br><span class="line"></span><br><span class="line">跳转的地址 = E8这条指令下一行地址 + X					  X =  跳转的地址 - E8这条指令下一行地址</span><br><span class="line">跳转的地址 = E8当前的地址 + 5 + X						X = 跳转的地址 - （E8的地址 + 5）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">6A 00 6A 00 6A 00 6A 00 E8 00 00 00 00 E9 00 00 00 00</span><br><span class="line"></span><br><span class="line">ImageBase = 400000</span><br><span class="line">400000 + 10D4F = 410D4F</span><br><span class="line">410D4F-411b02</span><br><span class="line">760634D0 - 411afd</span><br><span class="line">11af0</span><br><span class="line"></span><br><span class="line">1.将节中多余部分改写为6A 00 6A 00 6A 00 6A 00 E8 00 00 00 00 E9 00 00 00 00</span><br><span class="line">2.计算E8 和 E9之后的地址</span><br><span class="line">跳转的地址 = E8这条指令下一行地址 + X</span><br><span class="line">E8 = 760634D0 - 411afd     (411afd为E9的地址，就是E8的下一条地址)</span><br><span class="line">E9 = 410D4F - 411b02       (imagebase+OEP)-(imagebase+E9下一条地址)</span><br><span class="line">3.更改OEP为我们代码开始的地址 ，不需要加imagebase</span><br><span class="line"></span><br><span class="line">程序开始时先执行我们的代码，执行结束后在由我们写的jmp跳转到OEP，执行正常的程序</span><br><span class="line">MessageBox  = 76E534D0</span><br><span class="line">E9 = 11afd</span><br><span class="line">76E534D0 - (400000+11afd) = 76A419D3</span><br><span class="line">E9-&gt;next = 11b02</span><br><span class="line">410D4F - 411b02</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MessageBox = 75BDFD1E</span><br><span class="line">E9 = b5fd</span><br><span class="line">75BDFD1E - 100b5fd = 74BD 4721</span><br><span class="line">E9-&gt;next = b602</span><br><span class="line">3689 - b602 =FFFF 8087</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">创建新节</span><br><span class="line">1.新增一个节</span><br><span class="line">2.在新节后面填充一个节大小的00</span><br><span class="line">3.修改PE头中节的数量</span><br><span class="line">4.修改sizeofimage</span><br><span class="line">5.原有数据后新增内存对齐整数倍的一个节</span><br><span class="line">6.修改节表</span><br><span class="line"></span><br><span class="line">notepad中节表后面存在非零的有用数据，所以需要把nt，file，option，节表提升抬升，提升到垃圾数据中</span><br><span class="line"></span><br><span class="line">如果提升也不能用就需要扩大节，只能扩大最后一个节</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">扩大节</span><br><span class="line">1.拉伸到内存 -&gt; filebuffer -&gt; imagebuffer</span><br><span class="line">2.分配一块显得空间,newimagebuffer，大小为 sizeofimage + x</span><br><span class="line">3.将最后一个接的sizeofrawdata和virtualsize 改为N     N=内存对齐后尺寸+新增大小</span><br><span class="line">3.修改sizeofimage大小</span><br><span class="line">扩大节：</span><br><span class="line"></span><br><span class="line">1、拉伸到内存（只是逻辑上，实际代码操作并不需要这一步），需要注入的代码为 ShellCode</span><br><span class="line"></span><br><span class="line">2、分配一块新的空间：SizeOfImage + sizeof ( ShellCode)</span><br><span class="line"></span><br><span class="line">3、扩大节，修改最后一个节的 SizeOfRawData 和 VirtualSize</span><br><span class="line"></span><br><span class="line">   OrgSecSize = max ( SizeOfRawData 或 VirtualSize内存对齐后的值 ) </span><br><span class="line"></span><br><span class="line">   ∵ 有些初始化数据未全部写入文件，VirtualSize 可能比 SizeOfRawData 大，必须保证添加的代码不影响到原程序</span><br><span class="line"></span><br><span class="line">   VirtualSize = OrgSecSize + sizeof ( ShellCode)</span><br><span class="line"></span><br><span class="line">   SizeOfRawData = ( OrgSecSize + sizeof(ShellCode) ) 按文件对齐后的值</span><br><span class="line"></span><br><span class="line">4、修改SizeOfImage大小</span><br><span class="line"></span><br><span class="line">   SizeOfImage = (最后一节 VirtualAddress + VirtualSize) 按内存对齐后的值</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">合并节 可以节省节表</span><br><span class="line">0.拉伸到内存 </span><br><span class="line">1.修改sectionnumber</span><br><span class="line">2.将第一个节内存大小，文件大小改成一样</span><br><span class="line">VirtualSize=sizeofrawdata=sizeofimage-virtualaddress[0]=VA[-1]+max&#123;sizeofraw,VSize&#125;-headers(内存对齐后)</span><br><span class="line">3.virtualaddress不改  pointertorawdata 不改</span><br><span class="line">4.该属性</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">扩大最后一个节</span><br><span class="line">合并所有节</span><br><span class="line">输出全部目录</span><br><span class="line">返回对齐后大小 Align(int x, int y);</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307192218718.png" alt="image-20230307192218718"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">image_directory </span><br><span class="line">记录编译器生成的数据在哪里</span><br><span class="line"></span><br><span class="line">#define IIAGE_NUMBEROF_DIRECTORY_ENTRIES 16</span><br><span class="line">分别是:导出表、导入表、资源表、异常信息表、安全证书表、重定位表、调试信息表、版权所以表、全局指针表TLS表、加载配置表、绑定导入表、IAT表、延迟导入表、COM信息表最后一个保留未使用。</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//关于节表的所有实验：</span></span><br><span class="line"><span class="comment">//千万不要做黑盒!!!</span></span><br><span class="line"><span class="function">DWORD <span class="title">ReadPEFile</span><span class="params">(IN LPSTR lpszFile, OUT LPVOID* pFileBuffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FILE* fp;</span><br><span class="line">	fp = <span class="built_in">fopen</span>((LPSTR)lpszFile, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">if</span>(fp == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fseek</span>(fp,<span class="number">0</span>,SEEK_END);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//获得文件指针长度</span></span><br><span class="line">	<span class="type">int</span> len = <span class="built_in">ftell</span>(fp);  </span><br><span class="line"></span><br><span class="line">	<span class="built_in">fseek</span>(fp,<span class="number">0</span>,SEEK_SET);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开辟堆区</span></span><br><span class="line">	LPVOID ptr = <span class="literal">NULL</span>;</span><br><span class="line">	ptr = (LPVOID)<span class="built_in">malloc</span>(len);</span><br><span class="line">	<span class="keyword">if</span>(ptr == <span class="literal">NULL</span>) </span><br><span class="line">	&#123;</span><br><span class="line">		cout&lt;&lt; <span class="string">&quot;ptr == NULL&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(ptr);</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(ptr,<span class="number">0</span>,len);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//读文件</span></span><br><span class="line">	<span class="type">size_t</span> reader = <span class="built_in">fread</span>(ptr,len,<span class="number">1</span>,fp);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(reader == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout&lt;&lt; <span class="string">&quot;reader == NULL&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(ptr);</span><br><span class="line">		<span class="built_in">fclose</span>(fp);</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//传出参数复制</span></span><br><span class="line">	*pFileBuffer = ptr;</span><br><span class="line">	ptr = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">fclose</span>(fp);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ResolvePEHeader</span><span class="params">(IN LPVOID pFileBuffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(pFileBuffer == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;pFileBuffer == NULL\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//定义PE结构</span></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断MZ标记</span></span><br><span class="line">	<span class="keyword">if</span> (*(PWORD)pDosHeader != IMAGE_DOS_SIGNATURE)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;not a valid mz signature\n&quot;</span>);</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//printf(&quot;valid mz signature\n&quot;);</span></span><br><span class="line">	<span class="comment">//DOS头</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------DOS header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;DOS header: e_magic=%X\n&quot;</span>,pDosHeader-&gt;e_magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;DOS header: e_lfanew=%X\n&quot;</span>,pDosHeader-&gt;e_lfanew);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//NT header	</span></span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------NT header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;NT header: Signature=%X\n&quot;</span>,pNTHeader-&gt;Signature);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//file header</span></span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------File header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: Machine=%X\n&quot;</span>,pFileHeader-&gt;Machine);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: NumberOfSections=%X\n&quot;</span>,pFileHeader-&gt;NumberOfSections);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: TimeDateStamp=%X\n&quot;</span>,pFileHeader-&gt;TimeDateStamp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: SizeOfOptionalHeader=%X\n&quot;</span>,pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;File header: Characteristics=%X\n&quot;</span>,pFileHeader-&gt;Characteristics);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//optional header</span></span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;---------Optional header---------\n&quot;</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: Magic=%X\n&quot;</span>,pOptionHeader-&gt;Magic);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfCode=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfCode);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: AddressOfEntryPoint=%X\n&quot;</span>,pOptionHeader-&gt;AddressOfEntryPoint);	</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: BaseOfCode=%X\n&quot;</span>,pOptionHeader-&gt;BaseOfCode);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: BaseOfData=%X\n&quot;</span>,pOptionHeader-&gt;BaseOfData);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: ImageBase=%X\n&quot;</span>,pOptionHeader-&gt;ImageBase);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SectionAlignment=%X\n&quot;</span>,pOptionHeader-&gt;SectionAlignment);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: FileAlignment=%X\n&quot;</span>,pOptionHeader-&gt;FileAlignment);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfImage=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfImage);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: SizeOfHeaders=%X\n&quot;</span>,pOptionHeader-&gt;SizeOfHeaders);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Optional header: CheckSum=%X\n&quot;</span>,pOptionHeader-&gt;CheckSum);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//section header</span></span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	<span class="keyword">while</span>(pFileHeader-&gt;NumberOfSections &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//防止在name=8个字符时产生越界</span></span><br><span class="line">		<span class="type">unsigned</span> <span class="type">char</span> name[<span class="number">9</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">		<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)</span><br><span class="line">		&#123;</span><br><span class="line">			name[i] = pSectionHeader-&gt;Name[i];</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="comment">//section header print</span></span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;---------SECTION_HEADER---------\n&quot;</span>);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: Name=%s\n&quot;</span>, name);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: Misc=%X\n&quot;</span>, pSectionHeader-&gt;Misc);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: VirtualAddress=%X\n&quot;</span>, pSectionHeader-&gt;VirtualAddress);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: SizeOfRawData=%X\n&quot;</span>, pSectionHeader-&gt;SizeOfRawData);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: PointerToRawData=%X\n&quot;</span>, pSectionHeader-&gt;PointerToRawData);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Section header: Characteristics=%X\n&quot;</span>, pSectionHeader-&gt;Characteristics);</span><br><span class="line">		pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">		pFileHeader-&gt;NumberOfSections--;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">RvaToFileOffset</span><span class="params">(IN LPVOID pFileBuffer, DWORD dwRva)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//define pe structure</span></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionTemp = pSectionHeader;</span><br><span class="line">	<span class="keyword">if</span> (dwRva &lt;= pOptionHeader-&gt;SizeOfHeaders)</span><br><span class="line">		<span class="keyword">return</span> (DWORD)dwRva;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">0</span>; n &lt; pFileHeader-&gt;NumberOfSections; n++, pSectionTemp++)</span><br><span class="line">		&#123;	<span class="comment">//判断 :   文件对齐+文件偏移&gt;file_panyi&gt;文件偏移  (即是在文件的哪个节中)</span></span><br><span class="line">			<span class="keyword">if</span> ((dwRva &gt;= pSectionTemp-&gt;VirtualAddress) &amp;&amp; (dwRva &lt; pSectionTemp-&gt;VirtualAddress + pSectionTemp-&gt;Misc.VirtualSize))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="keyword">return</span> dwRva - pSectionTemp-&gt;VirtualAddress + pSectionTemp-&gt;PointerToRawData;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="comment">//printf(&quot;pFileBuffer: %X\n&quot;, pFileBuffer); //450068</span></span><br><span class="line">	<span class="comment">//printf(&quot;DWRVA: %X\n&quot;, dwRva); </span></span><br><span class="line">	<span class="comment">//DWORD MemOffset = (dwRva - (DWORD)pImageBuffer); //45C29C - 450068 = C234，内存中的rva</span></span><br><span class="line">	DWORD MemOffset = (dwRva);</span><br><span class="line">	<span class="comment">//printf(&quot;MemOffset: %X\n&quot;, MemOffset); </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//当前RVA在哪个节中</span></span><br><span class="line">	<span class="type">int</span> NumOfSec = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//RVA所在节的VirtualAddress</span></span><br><span class="line">	DWORD thisVA = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//RVA所在节的PointerToRawData</span></span><br><span class="line">	DWORD thisFile = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//距离当前节开始的便宜</span></span><br><span class="line">	DWORD thisoffset = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//在文件中的FOA</span></span><br><span class="line">	DWORD FilePos = <span class="number">0</span>;</span><br><span class="line">	<span class="comment">//判断在哪个节的条件</span></span><br><span class="line">	<span class="keyword">while</span> (pFileHeader-&gt;NumberOfSections &gt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class="line">		&#123;</span><br><span class="line">			thisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class="line">			thisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class="line">			<span class="comment">//printf(&quot;thisVA:%X\n&quot;,thisVA);  //C000</span></span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">		pFileHeader-&gt;NumberOfSections--;</span><br><span class="line">		NumOfSec++;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;NumOfSec:%d\n&quot;, NumOfSec+1);</span></span><br><span class="line"></span><br><span class="line">	thisoffset = MemOffset - thisVA; <span class="comment">//C234-C000 = 234;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;thisoffset:%X\n&quot;,thisoffset);</span></span><br><span class="line"></span><br><span class="line">	FilePos = thisoffset + thisFile; <span class="comment">// 234 + AC00 = AE34</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;FilePos:%X\n&quot;,FilePos);</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> FilePos;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">CopyFileBufferToImageBuffer</span><span class="params">(IN LPVOID pFileBuffer, OUT LPVOID* pImageBuffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	void *memset(void *s,int c,size_t n)</span></span><br><span class="line"><span class="comment">	将已开辟内存空间 s 的首 n 个字节的值设为值 c（给空间初始化）</span></span><br><span class="line"><span class="comment">	void *memcpy(void *dest, const void *src, size_t n);</span></span><br><span class="line"><span class="comment">	用来将src地址处的内容拷贝n个字节的数据至目标地址dest指向的内存中去  ,函数返回指向dest的指针</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义PE header</span></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算共复制了多少</span></span><br><span class="line">	DWORD TotalSize = <span class="number">0</span>;	</span><br><span class="line">	<span class="comment">//为imagebuffer开辟堆空间</span></span><br><span class="line">	LPVOID pTempImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	pTempImageBuffer = (LPVOID)<span class="built_in">malloc</span>(pOptionHeader-&gt;SizeOfImage);</span><br><span class="line">	<span class="keyword">if</span> (pTempImageBuffer == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;为imagebuffer申请内存失败&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(pTempImageBuffer, <span class="number">0</span>, pOptionHeader-&gt;SizeOfImage);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复制headers , 从filebuffer 到 imagebuffer</span></span><br><span class="line">	<span class="built_in">memcpy</span>(pTempImageBuffer, pFileBuffer, pOptionHeader-&gt;SizeOfHeaders);</span><br><span class="line">	TotalSize += pOptionHeader-&gt;SizeOfHeaders;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//文件和内存对齐不一样的情况</span></span><br><span class="line">	<span class="comment">//if (pOptionHeader-&gt;FileAlignment &lt; pOptionHeader-&gt;SectionAlignment)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	int memcal = pOptionHeader-&gt;SizeOfHeaders / pOptionHeader-&gt;SectionAlignment;    //if header in file = 1234 , 1234/1000 , then 1000*2 in image</span></span><br><span class="line">	<span class="comment">//	pImageBuffer += memcal * pOptionHeader-&gt;SectionAlignment;</span></span><br><span class="line">	<span class="comment">//	//memset(pImageBuffer + pOptionHeader-&gt;SizeOfHeaders, 0, memcal * pOptionHeader-&gt;SectionAlignment);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//循环复制节表</span></span><br><span class="line">	<span class="comment">//while (pFileHeader-&gt;NumberOfSections &gt; 0)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	memcpy((LPVOID)((DWORD)pTempImageBuffer + pSectionHeader-&gt;VirtualAddress), (LPVOID)((DWORD)pFileBuffer + pSectionHeader-&gt;PointerToRawData), pSectionHeader-&gt;SizeOfRawData);</span></span><br><span class="line">	<span class="comment">//	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class="line">	<span class="comment">//	TotalSize += pSectionHeader-&gt;SizeOfRawData;</span></span><br><span class="line">	<span class="comment">//	pFileHeader-&gt;NumberOfSections--;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; pFileHeader-&gt;NumberOfSections; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>((LPVOID)((DWORD)pTempImageBuffer + pSectionHeader[i].VirtualAddress), (LPVOID)((DWORD)pFileBuffer + pSectionHeader[i].PointerToRawData), pSectionHeader[i].SizeOfRawData);</span><br><span class="line">		TotalSize += pSectionHeader[i].SizeOfRawData;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	*pImageBuffer = pTempImageBuffer;</span><br><span class="line">	<span class="comment">//return TotalSize;</span></span><br><span class="line">	<span class="keyword">return</span> TotalSize;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">CopyImageBufferToNewBuffer</span><span class="params">(LPVOID pImageBuffer, LPVOID *pNewBuffer)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//LPVOID pFileBuffer = (LPVOID)OpenFile();</span></span><br><span class="line">	<span class="comment">//pMemBuffer = CopyFileBufferToImageBuffer(pFileBuffer);</span></span><br><span class="line">	<span class="comment">//LPVOID pFileBuffer = NULL;</span></span><br><span class="line">	<span class="comment">//pMemBuffer = CopyFileBufferToImageBuffer(pFileBuffer,&amp;pFileBuffer);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//定义PE header</span></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//为newbuffer开辟堆空间</span></span><br><span class="line">	<span class="type">int</span> secNum = pFileHeader-&gt;NumberOfSections;  <span class="comment">//节的数量</span></span><br><span class="line">	DWORD pointerdata = <span class="number">0</span>;    <span class="comment">//当前节的PointerToRawData</span></span><br><span class="line">	DWORD sizedata = <span class="number">0</span>;   <span class="comment">//当前节的SizeOfRawData</span></span><br><span class="line">	<span class="comment">//DWORD FileAlig = pOptionHeader-&gt;FileAlignment;   //文件对齐</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//计算最后一个节所在位置+大小，用于后续开辟空间</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	while (secNum &gt; 0)</span></span><br><span class="line"><span class="comment">	&#123;</span></span><br><span class="line"><span class="comment">		if (secNum == 1)</span></span><br><span class="line"><span class="comment">		&#123;</span></span><br><span class="line"><span class="comment">			pointerdata = pSectionHeader-&gt;PointerToRawData;</span></span><br><span class="line"><span class="comment">			sizedata = pSectionHeader-&gt;SizeOfRawData;</span></span><br><span class="line"><span class="comment">			//cout &lt;&lt;  pointerdata &lt;&lt; &quot; &quot; &lt;&lt; sizedata &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"><span class="comment">		&#125;</span></span><br><span class="line"><span class="comment">		pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class="line"><span class="comment">		secNum--;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> m=<span class="number">0</span>;m&lt;pFileHeader-&gt;NumberOfSections;m++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span>(m == pFileHeader-&gt;NumberOfSections<span class="number">-1</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			pointerdata = pSectionHeader[m].PointerToRawData;</span><br><span class="line">			sizedata = pSectionHeader[m].SizeOfRawData;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">continue</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开辟内存</span></span><br><span class="line">	*pNewBuffer = (LPVOID)<span class="built_in">malloc</span>(pointerdata + sizedata);</span><br><span class="line">	<span class="keyword">if</span> (*pNewBuffer == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;为imagebuffer申请内存失败\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(*pNewBuffer, <span class="number">0</span>, pointerdata + sizedata);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复制headers , 从filebuffer 到 imagebuffer</span></span><br><span class="line">	<span class="built_in">memcpy</span>(*pNewBuffer, pImageBuffer, pOptionHeader-&gt;SizeOfHeaders);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复制section</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; pFileHeader-&gt;NumberOfSections; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>((LPVOID)((DWORD)(*pNewBuffer) + pSectionHeader[i].PointerToRawData), (LPVOID)((DWORD)pImageBuffer + pSectionHeader[i].VirtualAddress), pSectionHeader[i].SizeOfRawData);</span><br><span class="line">		<span class="comment">//memcpy((LPVOID)((DWORD)(*pNewBuffer) + pSectionHeader[i].PointerToRawData), (LPVOID)((DWORD)pImageBuffer + pSectionHeader[i].VirtualAddress), pSectionHeader[i].SizeOfRawData);</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> pointerdata + sizedata;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">MemeryToFile</span><span class="params">(IN LPVOID pMemBuffer, IN <span class="type">size_t</span> size, OUT LPSTR lpszFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	FILE *fp = <span class="literal">NULL</span>;</span><br><span class="line">	fp = <span class="built_in">fopen</span>(lpszFile, <span class="string">&quot;wb+&quot;</span>);</span><br><span class="line">	<span class="keyword">if</span> (fp == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">fwrite</span>(pMemBuffer, size, <span class="number">1</span>, fp);</span><br><span class="line">	<span class="built_in">fclose</span>(fp);</span><br><span class="line">	fp = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestAddCodeInCodeSec</span><span class="params">(IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; sizeof(shellcode)/sizeof(shellcode[0]) &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断空闲区大小是否足够添加shellcode</span></span><br><span class="line">	<span class="keyword">if</span>(pSectionHeader-&gt;SizeOfRawData - pSectionHeader-&gt;Misc.VirtualSize &lt; <span class="built_in">sizeof</span>(shellcode)/<span class="built_in">sizeof</span>(shellcode[<span class="number">0</span>]))</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;空闲区不够!!\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="built_in">free</span>(pImageBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//加shellcode的位置</span></span><br><span class="line">	PBYTE addPos = (PBYTE)((DWORD)pImageBuffer + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复制shellcode</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; (PBYTE)addPos &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="built_in">memcpy</span>(addPos ,shellcode, <span class="built_in">sizeof</span>(shellcode)/<span class="built_in">sizeof</span>(shellcode[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正E8</span></span><br><span class="line">	<span class="comment">//DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD) - (DWORD)pImageBuffer));</span></span><br><span class="line">	DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize +<span class="number">8</span> +<span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,e8);</span><br><span class="line">	<span class="built_in">memcpy</span>(addPos+<span class="number">9</span>,&amp;e8,<span class="built_in">sizeof</span>(DWORD));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正E9</span></span><br><span class="line">	<span class="comment">//DWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD+5) - (DWORD)pImageBuffer));</span></span><br><span class="line">	DWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize + <span class="number">13</span> + <span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,e9);</span><br><span class="line">	<span class="built_in">memcpy</span>(addPos+<span class="number">14</span>,&amp;e9,<span class="built_in">sizeof</span>(DWORD));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正OEP</span></span><br><span class="line">	<span class="comment">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos - (DWORD)pImageBuffer;</span></span><br><span class="line">	pOptionHeader-&gt;AddressOfEntryPoint = pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize;</span><br><span class="line"></span><br><span class="line">	DWORD size = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestAddCodeInAnySec</span><span class="params">(DWORD NumOfSec, IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; sizeof(shellcode)/sizeof(shellcode[0]) &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="keyword">if</span>(NumOfSec &gt; pFileHeader-&gt;NumberOfSections)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;超出最大节数量\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断空闲区大小是否足够添加shellcode</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span>(pSectionHeader[NumOfSec<span class="number">-1</span>].SizeOfRawData - pSectionHeader[NumOfSec<span class="number">-1</span>].Misc.VirtualSize &lt; <span class="built_in">sizeof</span>(shellcode)/<span class="built_in">sizeof</span>(shellcode[<span class="number">0</span>]))</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;空闲区不够!!\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="built_in">free</span>(pImageBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//加shellcode的位置</span></span><br><span class="line">	PBYTE addPos = (PBYTE)((DWORD)pImageBuffer + pSectionHeader[NumOfSec<span class="number">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class="number">-1</span>].Misc.VirtualSize);</span><br><span class="line">    <span class="comment">//PVOID codeBegin = (PBYTE)((pFileOptionHeader-&gt;SizeOfHeaders) + (DWORD)ImageBuffer + pFileSectionHeader-&gt;Misc.VirtualSize);</span></span><br><span class="line">	<span class="comment">//复制shellcode</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt; (PBYTE)addPos &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="built_in">memcpy</span>(addPos ,shellcode, <span class="built_in">sizeof</span>(shellcode)/<span class="built_in">sizeof</span>(shellcode[<span class="number">0</span>]));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正E8</span></span><br><span class="line">	DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + pSectionHeader[NumOfSec<span class="number">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class="number">-1</span>].Misc.VirtualSize +<span class="number">8</span> +<span class="number">5</span>);</span><br><span class="line">	<span class="comment">//DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD) - (DWORD)pImageBuffer));</span></span><br><span class="line">	<span class="comment">//DWORD e8 = ((DWORD)MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)((DWORD)addPos + 0xD) - (DWORD)pImageBuffer)));</span></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,e8);</span><br><span class="line">	<span class="built_in">memcpy</span>(addPos+<span class="number">9</span>,&amp;e8,<span class="built_in">sizeof</span>(DWORD));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正E9</span></span><br><span class="line">	<span class="comment">//DWORD e9 = (pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint) - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD+5) - (DWORD)pImageBuffer));</span></span><br><span class="line">    <span class="comment">//DWORD e9 = (pOptionHeader-&gt;AddressOfEntryPoint+pOptionHeader-&gt;ImageBase-(pOptionHeader-&gt;ImageBase + 18) + (DWORD)pImageBuffer);</span></span><br><span class="line">	DWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + pSectionHeader[NumOfSec<span class="number">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class="number">-1</span>].Misc.VirtualSize + <span class="number">13</span> + <span class="number">5</span>);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%X\n&quot;</span>,e9);</span><br><span class="line">	<span class="built_in">memcpy</span>(addPos+<span class="number">14</span>,&amp;e9,<span class="built_in">sizeof</span>(DWORD));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修正OEP</span></span><br><span class="line">	<span class="comment">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos - (DWORD)pImageBuffer;</span></span><br><span class="line">	<span class="comment">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos;</span></span><br><span class="line">	pOptionHeader-&gt;AddressOfEntryPoint = pSectionHeader[NumOfSec<span class="number">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class="number">-1</span>].Misc.VirtualSize;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	pSectionHeader[NumOfSec<span class="number">-1</span>].Characteristics = pSectionHeader[NumOfSec<span class="number">-1</span>].Characteristics | pSectionHeader[<span class="number">0</span>].Characteristics;</span><br><span class="line"></span><br><span class="line">	DWORD size = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestAddSec</span><span class="params">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//判断空闲区大小是否足够添加节表</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> ((DWORD)pImageBuffer + pOptionHeader-&gt;SizeOfHeaders - pDosHeader-&gt;e_lfanew - IMAGE_SIZEOF_FILE_HEADER - pFileHeader-&gt;SizeOfOptionalHeader - pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER &lt; <span class="number">2</span> * IMAGE_SIZEOF_SECTION_HEADER)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;headers中空闲区不够!!\n&quot;</span>;</span><br><span class="line">		<span class="built_in">free</span>(pFileBuffer);</span><br><span class="line">		<span class="built_in">free</span>(pImageBuffer);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//把节表中第一个节复制到节表中最后一个节</span></span><br><span class="line">	<span class="comment">//计算开始复制的位置和第一个节的位置</span></span><br><span class="line">	LPVOID SecBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + <span class="number">4</span>);</span><br><span class="line">	<span class="comment">//LPVOID MyBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class="line">	LPVOID MyBegin = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader+(pFileHeader-&gt;NumberOfSections)*IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line"></span><br><span class="line">	<span class="built_in">memcpy</span>(MyBegin, SecBegin, IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在新增节表后面再加IMAGE_SIZEOF_SECTION_HEADER个0</span></span><br><span class="line">	LPVOID ZeroBegin = (PIMAGE_SECTION_HEADER)MyBegin + <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">memset</span>(ZeroBegin, <span class="number">0</span>, <span class="number">40</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//修改NumberOfSections</span></span><br><span class="line">	pFileHeader-&gt;NumberOfSections += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//新增节，NewSize为新增节的大小</span></span><br><span class="line">	<span class="comment">//LPVOID codeBegin = (LPVOID)((DWORD)pImageBuffer + pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].SizeOfRawData);</span></span><br><span class="line">	<span class="comment">//memset(codeBegin, 1, AddNumber);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改SizeOfImage</span></span><br><span class="line">	pOptionHeader-&gt;SizeOfImage += ((AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class="number">1</span>)* pOptionHeader-&gt;SectionAlignment;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改节表</span></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[0] = (BYTE)&quot;s&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[1] = (BYTE)&quot;b&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[2] = (BYTE)&quot;s&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[3] = (BYTE)&quot;b&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[4] = (BYTE)&quot;s&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[5] = (BYTE)&quot;b&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[6] = (BYTE)&quot;s&quot;;</span></span><br><span class="line"><span class="comment">	pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[7] = (BYTE)&quot;b&quot;;</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].Misc.VirtualSize = AddNumber;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].VirtualAddress = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].SizeOfRawData;</span><br><span class="line">	DWORD num = (AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class="number">1</span>;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].SizeOfRawData = ((AddNumber/pOptionHeader-&gt;SectionAlignment)+<span class="number">1</span>) * pOptionHeader-&gt;SectionAlignment;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].Characteristics = pSectionHeader[<span class="number">0</span>].Characteristics;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].PointerToRawData =  pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].PointerToRawData + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].SizeOfRawData;</span><br><span class="line">	DWORD size = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestAddSecInDosStub</span><span class="params">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	DWORD elfanew = pDosHeader-&gt;e_lfanew;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	<span class="comment">//保留原始属性???</span></span><br><span class="line">	DWORD NumOfSec = pFileHeader-&gt;NumberOfSections;</span><br><span class="line">	DWORD virtualsize = pSectionHeader[NumOfSec - <span class="number">1</span>].Misc.VirtualSize;</span><br><span class="line">	DWORD virtualaddress = pSectionHeader[NumOfSec - <span class="number">1</span>].VirtualAddress;</span><br><span class="line">	DWORD pointertorawdata = pSectionHeader[NumOfSec - <span class="number">1</span>].PointerToRawData;</span><br><span class="line">	DWORD sizeofrawdata = pSectionHeader[NumOfSec - <span class="number">1</span>].SizeOfRawData;</span><br><span class="line">	DWORD sectionalignment = pOptionHeader-&gt;SectionAlignment;</span><br><span class="line">	<span class="comment">//判断空闲区大小是否足够添加节表</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//if ((DWORD)pImageBuffer + pOptionHeader-&gt;SizeOfHeaders - pDosHeader-&gt;e_lfanew - IMAGE_SIZEOF_FILE_HEADER - pFileHeader-&gt;SizeOfOptionalHeader - pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER &lt; 2 * IMAGE_SIZEOF_SECTION_HEADER)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;提升并覆盖dos stub!\n&quot;</span>;</span><br><span class="line">	LPVOID dest = (LPVOID)((DWORD)pImageBuffer + <span class="number">0x40</span>);  <span class="comment">//DOS有用数据结束，垃圾数据开始</span></span><br><span class="line">	LPVOID source = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew); <span class="comment">//NT begin position</span></span><br><span class="line">	DWORD size = pDosHeader-&gt;e_lfanew - <span class="number">0x40</span>;  <span class="comment">//向上提升的空间</span></span><br><span class="line">	cout &lt;&lt; size &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	DWORD shabi = (<span class="number">4</span> + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER); <span class="comment">//signature，nt，file，option，节表提升抬升</span></span><br><span class="line">	<span class="built_in">memcpy</span>(dest, source, shabi);</span><br><span class="line">	<span class="comment">//LPVOID newone = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER + 4 - size);</span></span><br><span class="line">	<span class="comment">//memset(newone,0,size);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//更新e-&gt;lfanew</span></span><br><span class="line">	pDosHeader-&gt;e_lfanew = elfanew - size;</span><br><span class="line">	<span class="comment">//更新头指针</span></span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	<span class="comment">//PE头</span></span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(((DWORD)pNTHeader) + <span class="number">4</span>);	<span class="comment">//NT头地址 + 4 为 FileHeader 首址</span></span><br><span class="line">	<span class="comment">//可选PE头	</span></span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);<span class="comment">//SIZEOF_FILE_HEADER为固定值且不存在于PE文件字段中</span></span><br><span class="line">	<span class="comment">//首个节表</span></span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//开始新增节</span></span><br><span class="line">	<span class="comment">//把节表中第一个节复制到节表中最后一个节</span></span><br><span class="line">	<span class="comment">//计算开始复制的位置和第一个节的位置</span></span><br><span class="line">	LPVOID SecBegin = (LPVOID)pSectionHeader; <span class="comment">//第一个节的位置</span></span><br><span class="line">	LPVOID MyBegin =  (LPVOID)((DWORD)SecBegin + pFileHeader-&gt;NumberOfSections * <span class="number">40</span>);<span class="comment">//复制到的目标位置</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//LPVOID SecBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader - size); //第一个节的位置</span></span><br><span class="line">	<span class="comment">//LPVOID MyBegin =  (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER - size);//复制到的目标位置</span></span><br><span class="line">	<span class="comment">//LPVOID MyBegin = (LPVOID)(PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + (pFileHeader-&gt;NumberOfSections)*IMAGE_SIZEOF_SECTION_HEADER - size);  //复制到的目标位置</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; pFileHeader-&gt;NumberOfSections &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="built_in">memcpy</span>(MyBegin, SecBegin, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//在新增节表后面再加IMAGE_SIZEOF_SECTION_HEADER个0</span></span><br><span class="line">	<span class="comment">//memset((PBYTE)MyBegin + NumOfSec * 40 + IMAGE_SIZEOF_SECTION_HEADER, 0, IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class="line">	<span class="built_in">memset</span>((PBYTE)MyBegin + <span class="number">40</span>, <span class="number">0</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改NumberOfSections</span></span><br><span class="line">	pFileHeader-&gt;NumberOfSections += <span class="number">1</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="comment">//新增节，NewSize为新增节的大小</span></span><br><span class="line">	<span class="comment">//LPVOID codeBegin = (LPVOID)((DWORD)pImageBuffer + pSectionHeader[pFileHeader-&gt;NumberOfSections-2].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections-2].SizeOfRawData);</span></span><br><span class="line">	<span class="comment">//memset(codeBegin, 0, AddNumber);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改SizeOfImage</span></span><br><span class="line">	pOptionHeader-&gt;SizeOfImage += ((AddNumber / sectionalignment) + <span class="number">1</span>)* sectionalignment;</span><br><span class="line">	<span class="comment">//修改节表</span></span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].Misc.VirtualSize = AddNumber;  <span class="comment">//vitualsize = 新增大小</span></span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].VirtualAddress = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].SizeOfRawData;  <span class="comment">//上一个节的VirtualAddress+sizeofrawdata</span></span><br><span class="line">	DWORD num = (AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class="number">1</span>;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].SizeOfRawData = ((AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class="number">1</span>) * pOptionHeader-&gt;SectionAlignment; <span class="comment">//sizeofrawdata 对齐后</span></span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].Characteristics = pSectionHeader[<span class="number">0</span>].Characteristics;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].PointerToRawData = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].PointerToRawData + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">2</span>].SizeOfRawData;</span><br><span class="line">	DWORD size1 = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//valid program</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestExpandLastSec</span><span class="params">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//开辟大小为SizeOfImage + x的空间</span></span><br><span class="line">	LPVOID newspace = (LPVOID)<span class="built_in">malloc</span>(pOptionHeader-&gt;SizeOfImage + AddNumber);</span><br><span class="line">	<span class="comment">//修改最后一个节的属性</span></span><br><span class="line">	<span class="comment">//virtualsize内存对齐后的值</span></span><br><span class="line">	DWORD newvirtualsize = (pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].Misc.VirtualSize / pOptionHeader-&gt;SectionAlignment +<span class="number">1</span> ) * pOptionHeader-&gt;SectionAlignment;</span><br><span class="line">	<span class="comment">//max(sizeofrawdat,virtualsize)</span></span><br><span class="line">	DWORD maxsize = newvirtualsize &gt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].SizeOfRawData ? newvirtualsize : pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].SizeOfRawData;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].SizeOfRawData = (((maxsize + AddNumber)/pOptionHeader-&gt;SectionAlignment)+<span class="number">1</span>) *  pOptionHeader-&gt;SectionAlignment;</span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].Misc.VirtualSize = maxsize + AddNumber;</span><br><span class="line">	cout &lt;&lt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].SizeOfRawData &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].Misc.VirtualSize &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改sizeofimage</span></span><br><span class="line">	<span class="comment">//注意修正SizeofImage，错误的sizeofimage会导致非法的win32程序</span></span><br><span class="line">	<span class="comment">//pOptionHeader-&gt;SizeOfImage = ((pSectionHeader[pFileHeader-&gt;NumberOfSections-1].Misc.VirtualSize + pSectionHeader[pFileHeader-&gt;NumberOfSections-1].VirtualAddress + AddNumber)/pOptionHeader-&gt;SectionAlignment + 1) * pOptionHeader-&gt;SectionAlignment;</span></span><br><span class="line">	pOptionHeader-&gt;SizeOfImage = \</span><br><span class="line">		(((pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].Misc.VirtualSize + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class="number">1</span>].VirtualAddress) / pOptionHeader-&gt;SectionAlignment) + <span class="number">1</span>) * pOptionHeader-&gt;SectionAlignment;</span><br><span class="line">	<span class="comment">//修改character</span></span><br><span class="line">	pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].Characteristics = pSectionHeader[<span class="number">0</span>].Characteristics | pSectionHeader[pFileHeader-&gt;NumberOfSections<span class="number">-1</span>].Characteristics;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	DWORD size1 = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line">	<span class="built_in">free</span>(newspace);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回对齐后大小，x为对齐前大小，y为pOptionHeader-&gt;SectionAlignment/pOptionHeader-&gt;FileAlignment</span></span><br><span class="line"><span class="function">DWORD <span class="title">Align</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">return</span> ((x/y)+<span class="number">1</span>)*y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//merge all section to one section</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestMergeSec</span><span class="params">(IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pFirstSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line">	pFirstSectionHeader = pSectionHeader;</span><br><span class="line">	<span class="comment">//保留原来节表数量</span></span><br><span class="line">	DWORD origin_sec = pFileHeader-&gt;NumberOfSections;</span><br><span class="line">	<span class="comment">//修改第一个节的属性</span></span><br><span class="line">	pSectionHeader[<span class="number">0</span>].Misc.VirtualSize = pSectionHeader[<span class="number">0</span>].SizeOfRawData = (((copySizeFromFile - pSectionHeader[<span class="number">0</span>].VirtualAddress)/pOptionHeader-&gt;FileAlignment)+<span class="number">1</span>)*pOptionHeader-&gt;FileAlignment;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;pFileHeader-&gt;NumberOfSections;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pSectionHeader[<span class="number">0</span>].Characteristics = pSectionHeader[<span class="number">0</span>].Characteristics | pSectionHeader[i].Characteristics;</span><br><span class="line">		<span class="built_in">memset</span>(pSectionHeader+i, <span class="number">0</span>, IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//modify sectionnumber</span></span><br><span class="line">	pFileHeader-&gt;NumberOfSections = <span class="number">1</span>;</span><br><span class="line">	<span class="comment">//memset(pFirstSectionHeader+40,0,(origin_sec-1)*40);</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	DWORD size1 = <span class="built_in">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> isSucc = <span class="built_in">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class="line">	<span class="keyword">if</span> (isSucc == <span class="literal">true</span>) cout &lt;&lt; <span class="string">&quot;Success\n&quot;</span>;</span><br><span class="line">	<span class="keyword">else</span> cout &lt;&lt; <span class="string">&quot;woshishabi\n&quot;</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintImageDirectory</span><span class="params">(IN LPSTR lpszFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pImageBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	LPVOID pNewBuffer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line">	DWORD copySizeFromFile = <span class="built_in">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="comment">//pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span></span><br><span class="line">	<span class="type">char</span>* name[<span class="number">16</span>] = &#123;<span class="string">&quot;导出表&quot;</span>,<span class="string">&quot;导入表&quot;</span>,<span class="string">&quot;资源表&quot;</span>,<span class="string">&quot;异常表&quot;</span>,<span class="string">&quot;安全证书表&quot;</span>,<span class="string">&quot;重定位表&quot;</span>,<span class="string">&quot;调试信息表&quot;</span>,<span class="string">&quot;版权所有表&quot;</span>,<span class="string">&quot;全局指针表&quot;</span>,<span class="string">&quot;TLS表&quot;</span>,<span class="string">&quot;加载配置表&quot;</span>,<span class="string">&quot;绑定导入表&quot;</span>,<span class="string">&quot;IAT表&quot;</span>,<span class="string">&quot;延迟导入表&quot;</span>,<span class="string">&quot;COM&quot;</span>,<span class="string">&quot;Reverse&quot;</span>&#125;;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;pOptionHeader-&gt;NumberOfRvaAndSizes;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;------------------------------------\n&quot;</span>;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,name[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Size:%X\n&quot;</span>,pOptionHeader-&gt;DataDirectory[i].Size);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;VirtualAddress:%X\n&quot;</span>,pOptionHeader-&gt;DataDirectory[i].VirtualAddress);</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>参考了大佬们的文章:</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NsYXlvYS9hcnRpY2xlL2RldGFpbHMvMTIyNDU5NDM5"> 增节_ma_lic 的博客 - CSDN 博客</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5ODA1NDc3L2FydGljbGUvZGV0YWlscy8xMjA1NDQ4OTA=">扩大节_滴水逆向扩大节_Revival_S 的博客 - CSDN 博客</span></p>
</blockquote>
<h3 id="静态链接库"><a class="markdownIt-Anchor" href="#静态链接库">#</a> 静态链接库</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.创建静态lib</span><br><span class="line">2.复制debug下的 .lib 和 ../.h到当前工程 </span><br><span class="line">3.使用静态或者动态链接</span><br><span class="line">静态： 在需要使用的项目中 #include &quot;x.h&quot;   #pragma comment(lib,&quot;x.lib&quot;)</span><br><span class="line">隐式：不写第二个pragama ，使用setting -&gt; link -&gt; 对象/模块库  -&gt; 复制自己的lib名称</span><br><span class="line"></span><br><span class="line">使用：和普通函数调用一样</span><br><span class="line">int x= Plus(1,2);</span><br></pre></td></tr></table></figure>
<p>手动连接</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230212154955361.png" alt="image-20230212154955361"></p>
<p>#include 中只有函数说明，没有实现，VC 中对象 / 库模块中默认包含了很多，见上图</p>
<p>代码的重复使用</p>
<p>二进制代码直接编译到 exe 中</p>
<p>改 lib 代码需要重新编译 exe</p>
<h3 id="动态链接库"><a class="markdownIt-Anchor" href="#动态链接库">#</a> 动态链接库</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">函数声明：</span><br><span class="line">extern &quot;C&quot; _declspec(dllexport) __stdcall int Add(int ,int);</span><br><span class="line"></span><br><span class="line">1、 extern表示这是个全局函数，可以供各个其他的函数调用;  </span><br><span class="line">2、&quot;℃”按照c语言的方式进行编译、链接</span><br><span class="line">3、declspec(dllexport)告诉编译器此函数为导出函数;</span><br><span class="line"></span><br><span class="line">如果不加 “C”会按照C++导出为了防止重载会在函数名后加上符号</span><br><span class="line"></span><br><span class="line">动态链接库代码编译后在自己的dll中</span><br></pre></td></tr></table></figure>
<p>VC6 自带 depend 识别 dll</p>
<p>如果不加 extern “C” 导出：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308194335559.png" alt="image-20230308194335559"></p>
<p>如果加 extern “C” ：</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308194531511.png" alt="image-20230308194531511"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">使用dll</span><br><span class="line">1.隐式连接</span><br><span class="line">1.将lib，dll放在工程目录下，代码存在于dll中</span><br><span class="line">2.#pragma comment(lib,&quot;x.lib&quot;)</span><br><span class="line">3.extern &quot;C&quot; _declspec(dllimport) __stdcall int Add(int ,int); 添加到调用文件中</span><br><span class="line">如果导出时加了__stdcall，那么在导入时也需要加，建议导出方式为stdcall</span><br><span class="line"></span><br><span class="line">2,.显示连接</span><br><span class="line">定义函数指针 typedef int (__stdcall *lpPlus)(int ,int);</span><br><span class="line">声明指针类型变量 lpPlus myPlus;</span><br><span class="line">动态加载dll到内存中 #include &lt;Windows.h&gt;  HINSTANCE hModule = LoadLibrary(&quot;x.dll&quot;);   如果加了__stdcall ,函数名会变为_Plus@8 </span><br><span class="line">获取函数地址 mpPlus = (lpPlus)GetProcAddress(hModule, &quot;Plus&quot;);</span><br><span class="line">myPlus(1,2);</span><br></pre></td></tr></table></figure>
<p>dll 中代码修改后不需要重新编译 exe，dll 的代码不在 exe 里，在 dll’的空间中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Handle是代表系统的内核对象，如文件句柄，线程句柄，进程句柄。</span><br><span class="line">HMODULE是代表应用程序载入的模块</span><br><span class="line">HINSTANCE在win32下与HMODULE是相同的东西Win16遗留</span><br><span class="line">HWND是窗口句柄</span><br><span class="line">本质都是无符号整数 unsigned int</span><br><span class="line">这么设计可以可读性更好，避免进行运算</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.def无函数名导出</span><br><span class="line">新建.def文件,使用序号到达隐藏</span><br><span class="line">头文件不能再加export</span><br><span class="line">创建.def</span><br><span class="line">@是导出序号</span><br><span class="line"></span><br><span class="line">EXPORTS</span><br><span class="line">Plus @12</span><br><span class="line">Sub @15 NONAME</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308202844475.png" alt="image-20230308202844475"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#pragma comment(lib,&quot;TestDll.lib&quot;)</span><br><span class="line">extern &quot;C&quot; _declspec(dllimport) int Add(int ,int);</span><br><span class="line">extern &quot;C&quot; _declspec(dllimport) int Mul(int ,int);</span><br><span class="line"></span><br><span class="line">void testDll()</span><br><span class="line">&#123;</span><br><span class="line">	typedef int (*lpAdd)(int ,int);</span><br><span class="line">	typedef int (*lpMul)(int ,int);</span><br><span class="line">	lpAdd myadd;</span><br><span class="line">	lpMul mymul;</span><br><span class="line">	HINSTANCE hModule = LoadLibrary(&quot;TestDll.dll&quot;);</span><br><span class="line">	myadd = (lpAdd)GetProcAddress(hModule, &quot;Add&quot;);</span><br><span class="line">	mymul = (lpMul)GetProcAddress(hModule, &quot;Mul&quot;);</span><br><span class="line">	cout &lt;&lt; myadd(3,4) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	cout &lt;&lt; mymul(3,4) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="导出表"><a class="markdownIt-Anchor" href="#导出表">#</a> 导出表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">exe和dll都可以提供函数。一般情况是dll提供函数。</span><br><span class="line">提供函数给别人用必须要用导出表</span><br><span class="line">如果导出表的RVA和size都是00000000证明他没有导出表</span><br><span class="line"></span><br><span class="line">IMAGE_DIRECTORY_ENTRY_EXPORT</span><br><span class="line">&#123;</span><br><span class="line">	DWORD VitualAddress;</span><br><span class="line">	DWORD Size;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">virtualaddress是内存中的，需要转成FOA</span><br><span class="line">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, DWORD dwRva)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	//define pe structure</span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(sizeof(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class="line"></span><br><span class="line">	printf(&quot;pFileBuffer: %X\n&quot;, pFileBuffer); //450068</span><br><span class="line">	printf(&quot;DWRVA: %X\n&quot;, dwRva); </span><br><span class="line">	DWORD MemOffset = (dwRva - (DWORD)pFileBuffer); //45C29C - 450068 = C234，内存中的rva</span><br><span class="line">	printf(&quot;MemOffset: %X\n&quot;, MemOffset); </span><br><span class="line"></span><br><span class="line">	//当前RVA在哪个节中</span><br><span class="line">	int NumOfSec = 0;</span><br><span class="line">	//RVA所在节的VirtualAddress</span><br><span class="line">	DWORD thisVA = 0;</span><br><span class="line">	//RVA所在节的PointerToRawData</span><br><span class="line">	DWORD thisFile = 0;</span><br><span class="line">	//距离当前节开始的便宜</span><br><span class="line">	DWORD thisoffset = 0;</span><br><span class="line">	//在文件中的FOA</span><br><span class="line">	DWORD FilePos = 0;</span><br><span class="line">	//判断在哪个节的条件</span><br><span class="line">	while (pFileHeader-&gt;NumberOfSections &gt; 0)</span><br><span class="line">	&#123;</span><br><span class="line">		if ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class="line">		&#123;</span><br><span class="line">			thisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class="line">			thisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class="line">			printf(&quot;thisVA:%X\n&quot;,thisVA);  //C000</span><br><span class="line">			break;</span><br><span class="line">		&#125;</span><br><span class="line">		pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class="line">		pFileHeader-&gt;NumberOfSections--;</span><br><span class="line">		NumOfSec++;</span><br><span class="line">	&#125;</span><br><span class="line">	printf(&quot;NumOfSec:%d\n&quot;, NumOfSec+1);</span><br><span class="line">	thisoffset = MemOffset - thisVA; //C234-C000 = 234;</span><br><span class="line">	printf(&quot;thisoffset:%X\n&quot;,thisoffset);</span><br><span class="line">	FilePos = thisoffset + thisFile; // 234 + AC00 = AE3</span><br><span class="line">	printf(&quot;FilePos:%X\n&quot;,FilePos);</span><br><span class="line">	return FilePos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">typedef struct _IMAGE_EXPORT_DIRECTORY &#123;</span><br><span class="line">    DWORD   Characteristics;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    WORD    MajorVersion;</span><br><span class="line">    WORD    MinorVersion;</span><br><span class="line">    DWORD   Name;</span><br><span class="line">    DWORD   Base;</span><br><span class="line">    DWORD   NumberOfFunctions;</span><br><span class="line">    DWORD   NumberOfNames;</span><br><span class="line">    DWORD   AddressOfFunctions;     // RVA from base of image</span><br><span class="line">    DWORD   AddressOfNames;         // RVA from base of image</span><br><span class="line">    DWORD   AddressOfNameOrdinals;  // RVA from base of image</span><br><span class="line">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br><span class="line"></span><br><span class="line">AddressofFunctions是函数地址，但是他是RVA</span><br><span class="line">导出函数数量由NumberofFunctions决定</span><br><span class="line">AddressOfName是函数名的地址，还是RVA，noname导出这里就不会有</span><br><span class="line">名字的数量是由NumberOfNames决定，这里只包含以函数名导出的函数的个数</span><br><span class="line">AddressOfFunctions 和 AddressOfnames 长度可以不一样，可以存在noname函数或者两个函数名称指向一个函数地址</span><br><span class="line">NumberofName只代表以函数名导出的个数</span><br><span class="line">AddressOfNameOrdinals，大小是NumberOfNames，导出序号 = base + AddressOfNameOrdinals</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">通过函数名找函数时，先把AddressOfName转成FOA找到里面的名字，再进行比较字符串</span><br><span class="line">再把查找到的AddressOfNames索引到AddressOfNameOrdinals中找索引对应的值，这个值就是AddressOfFunctions里面的值</span><br><span class="line">比如AddressOfNames中索引为2，到AddressOfNameOrdinals也找索引为2对应的序号，这个序号就是AddressOfFunctions中对应的下标</span><br><span class="line"></span><br><span class="line">系统认为的导出函数的个数 = AddressOfNameOrdinals最大序号 - 最小序号 + 1</span><br><span class="line">如果序号不连续这个数量就会有问题</span><br><span class="line"></span><br><span class="line">用序号找</span><br><span class="line">序号 - base = AddressOfFunctions的下标</span><br><span class="line"></span><br><span class="line">为什么要分成3张表?</span><br><span class="line">1、函数导出的个数与函数名的个数未必一样.所以要将函数地址表和函数名称表分开</span><br><span class="line">2、函数地址表是不是一定大于函数名称表?</span><br><span class="line">未必，一个相同的函数地址，可能有多个不同的名字</span><br><span class="line">3、如何根据函数的名字获取一个函数的地址?</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310152135716.png" alt="image-20230310152135716"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310154212089.png" alt="image-20230310154212089"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310160821694.png" alt="image-20230310160821694"></p>
<p>hmodule 是拉伸后的，filebuffer 是文件中的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">PrintfExportDir</span><span class="params">(IN LPSTR lpszFile)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	LPVOID pFileBuffer = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//从filebuffer - imagebuffer</span></span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pFirstSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line"><span class="comment">//	cout &lt;&lt; hex &lt;&lt; pOptionHeader-&gt;DataDirectory[0].VirtualAddress &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="comment">//把VirtualAddress转为foa</span></span><br><span class="line">	DWORD FOA = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress);</span><br><span class="line">	<span class="comment">//打印export ditectory</span></span><br><span class="line"><span class="comment">//	cout &lt;&lt; hex &lt;&lt; FOA &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;Characteristics:%X\n&quot;</span>,pExportDirectory-&gt;Characteristics);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;TimeDateStamp:%X\n&quot;</span>,pExportDirectory-&gt;TimeDateStamp);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;MajorVersion:%X\n&quot;</span>,pExportDirectory-&gt;MajorVersion);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;MinorVersion:%X\n&quot;</span>,pExportDirectory-&gt;MinorVersion);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;Name:%X\n&quot;</span>,pExportDirectory-&gt;Name);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;Base:%X\n&quot;</span>,pExportDirectory-&gt;Base);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;NumberOfFunctions:%X\n&quot;</span>,pExportDirectory-&gt;NumberOfFunctions);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;NumberOfNames:%X\n&quot;</span>,pExportDirectory-&gt;NumberOfNames);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;AddressOfFunctions:%X\n&quot;</span>,pExportDirectory-&gt;AddressOfFunctions);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;AddressOfNameOrdinals:%X\n&quot;</span>,pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;pExportDirectory-&gt;AddressOfNames:%X\n&quot;</span>,pExportDirectory-&gt;AddressOfNames);</span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;-------------------&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印addresofFunction</span></span><br><span class="line">	DWORD NumOfFunFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;pExportDirectory-&gt;NumberOfFunctions;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; hex &lt;&lt; *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + i*<span class="number">4</span>) &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;-------------------&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	<span class="comment">//打印addressofnames</span></span><br><span class="line">	DWORD AddressFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class="line">	DWORD nameFOA = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* name = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;pExportDirectory-&gt;NumberOfNames;k++)</span><br><span class="line">	&#123;</span><br><span class="line">		nameFOA = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, *(PDWORD)((DWORD)pFileBuffer + AddressFoa));</span><br><span class="line">		name = (<span class="type">char</span>*)(nameFOA + (DWORD)pFileBuffer);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%s\n&quot;</span>,name);</span><br><span class="line">		AddressFoa += <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;-------------------&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//打印AddressOfNameOrdinals</span></span><br><span class="line">	DWORD OrdinalFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> m=<span class="number">0</span>;m&lt;pExportDirectory-&gt;NumberOfNames;m++)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; hex &lt;&lt; *(PWORD)((DWORD)pFileBuffer + OrdinalFoa + m*<span class="number">2</span>) + pExportDirectory-&gt;Base &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetFunctionAddrByName</span><span class="params">(IN LPSTR lpszFile, IN LPVOID pFileBuffer, IN <span class="type">char</span>* pFuncName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pFirstSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="comment">//把VirtualAddress转为foa</span></span><br><span class="line">	DWORD FOA = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress);</span><br><span class="line">	DWORD nameFOA = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* name = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class="line">	DWORD AddressFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class="line">	DWORD OrdinalFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line">	DWORD NumOfFunFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k=<span class="number">0</span>;k&lt;pExportDirectory-&gt;NumberOfNames;k++)</span><br><span class="line">	&#123;</span><br><span class="line">		nameFOA = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, *(PDWORD)((DWORD)pFileBuffer + AddressFoa));</span><br><span class="line">		name = (<span class="type">char</span>*)(nameFOA + (DWORD)pFileBuffer);</span><br><span class="line">		<span class="keyword">if</span> (<span class="built_in">strcmp</span>(name,(<span class="type">char</span>*)pFuncName) == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			DWORD num = *(PWORD)((DWORD)pFileBuffer + OrdinalFoa + k*<span class="number">2</span>);</span><br><span class="line">			DWORD haha = *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + num*<span class="number">4</span>);</span><br><span class="line">			<span class="comment">//cout &lt;&lt; hex &lt;&lt; haha &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">			<span class="keyword">return</span> haha;</span><br><span class="line">		&#125;</span><br><span class="line">		AddressFoa += <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">DWORD <span class="title">GetFunctionAddrByOrdinals</span><span class="params">(IN LPSTR lpszFile, IN LPVOID pFileBuffer, IN DWORD OutNum)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	DWORD fileLen = <span class="built_in">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_SECTION_HEADER pFirstSectionHeader = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class="line">	pNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class="line">	pFileHeader = (PIMAGE_FILE_HEADER)(<span class="built_in">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	<span class="comment">//把VirtualAddress转为foa</span></span><br><span class="line">	DWORD FOA = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class="number">0</span>].VirtualAddress);</span><br><span class="line">	DWORD nameFOA = <span class="number">0</span>;</span><br><span class="line">	<span class="type">char</span>* name = <span class="literal">NULL</span>;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class="line">	DWORD AddressFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class="line">	DWORD OrdinalFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class="line">	DWORD NumOfFunFoa = <span class="built_in">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> xiabiao = OutNum - pExportDirectory-&gt;Base;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;pExportDirectory-&gt;NumberOfFunctions;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (i == xiabiao)</span><br><span class="line">		&#123;</span><br><span class="line">			DWORD address = *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + i*<span class="number">4</span>);</span><br><span class="line">			<span class="keyword">return</span> address;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="重定位表"><a class="markdownIt-Anchor" href="#重定位表">#</a> 重定位表</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311170507585.png" alt="image-20230311170507585"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">程序加载可以理解为贴图的过程，先开辟4G虚拟内存，先把exe放在ImageBase，分SizeOfimage大小</span><br><span class="line">在加载dll，一般在70000000开始，每个dll都从自己的imagebase开始，分sizeofimage大小</span><br><span class="line">dll贴完，指向oep，程序就可以运行了</span><br><span class="line"></span><br><span class="line">一般情况下，EX都是可以按照ImageBase的地址进行加载的.因为Exe拥有自己独立的4GB 的虚拟内存空间但DLL不是DLL是有EXE使用它，才加载到相关EXE的进程空间的.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">为了提高搜索的速度，模块间地址也是要对齐的模块地址对齐为10000H也就是64K</span><br><span class="line"></span><br><span class="line">编译时生成的地址= ImageBase + RVA</span><br><span class="line">如果加载的时候没有按照预定加载，那么绝对地址会不可用</span><br><span class="line">所以需要一张表保存绝对地址</span><br><span class="line"></span><br><span class="line">目录向的第六个结构是重定位表</span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_DATA_DIRECTORY &#123;</span><br><span class="line">    DWORD   VirtualAddress;</span><br><span class="line">    DWORD   Size;</span><br><span class="line">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br><span class="line"></span><br><span class="line">RVA -&gt; FOA</span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_BASE_RELOCATION &#123;</span><br><span class="line">    DWORD   VirtualAddress;</span><br><span class="line">    DWORD   SizeOfBlock;</span><br><span class="line">&#125; IMAGE_BASE_RELOCATION;</span><br><span class="line">typedef IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311173859344.png" alt="image-20230311173859344"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">virtualaddress放修改的起始地址</span><br><span class="line">Virtualaddress + 块中数据 = 要修改的地址的RVA</span><br><span class="line">每一块中是一页中需要修改的地址</span><br><span class="line">每页为4k，每个页只需要12位二进制，因此2字节够标识所有的地址，即块内数据都是2字节</span><br><span class="line">内存中的页大小是1000H也就是说2的12次方就可以表示一个页内所有的偏移地址具体项的宽度是16字节高四位代表类型:值为3代表的是需要修改的数据值为o代表的是用于数据对齐的数据，可以不用修改.也就是说我们只关注高四位为3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">但分空间还是要分16个，因为内存对齐</span><br><span class="line">因此计算RVA时只需要计算低12位，低12位 + x就是需要修改的RVA</span><br><span class="line">高四位果 = 3，那么需要改修， =0代表不需要修复</span><br><span class="line"></span><br><span class="line">最后一个块是一个全0结构， &amp; 判断</span><br><span class="line"></span><br><span class="line">块中多少 = (SizeOfBlock - 8) / 2</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311175130539.png" alt="image-20230311175130539"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">void PrintRelocationDirectory(IN LPSTR lpszFile)</span><br><span class="line">&#123;</span><br><span class="line">	LPVOID pFileBuffer = NULL;</span><br><span class="line">	DWORD fileLen = ReadPEFile(lpszFile, &amp;pFileBuffer);</span><br><span class="line"></span><br><span class="line">	PIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class="line">	PIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class="line">	PIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class="line">	PIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class="line">	PIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class="line">	PIMAGE_EXPORT_DIRECTORY pExportDirectory = NULL;</span><br><span class="line">	PIMAGE_BASE_RELOCATION pRelocationDirectory = NULL;</span><br><span class="line">	PIMAGE_BASE_RELOCATION pRelocationTable = NULL;</span><br><span class="line"></span><br><span class="line">	pDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;	// 强转 DOS_HEADER 结构体指针</span><br><span class="line">	//可选PE头	  简化后的处理</span><br><span class="line">	pOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class="line">	pRelocationTable = (PIMAGE_BASE_RELOCATION)((DWORD)pFileBuffer + RvaToFileOffset(pFileBuffer, pOptionHeader-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress));</span><br><span class="line">	//pRelocationTable = (PIMAGE_BASE_RELOCATION)(RvaToFileOffset(pFileBuffer, pOptionHeader-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress));</span><br><span class="line">	printf(&quot;Relocation Table Rva: %#x\n&quot;, pRelocationTable-&gt;VirtualAddress);</span><br><span class="line">#if 1</span><br><span class="line">	int i = 1;</span><br><span class="line">	//pRelocationTable = (PIMAGE_BASE_RELOCATION)RvaToFileOffset(pFileBuffer,pRelocationTable-&gt;VirtualAddress);</span><br><span class="line">	while ( pRelocationTable-&gt;VirtualAddress &amp;&amp; pRelocationTable-&gt;SizeOfBlock)</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;第%d个块VirtualAddress:%X\n&quot;, i, pRelocationTable-&gt;VirtualAddress);</span><br><span class="line">		printf(&quot;第%d个块SizeOfBlock:%X\n&quot;, i,pRelocationTable-&gt;SizeOfBlock);</span><br><span class="line">		printf(&quot;第%d个块项数:%X\n&quot;, i, (pRelocationTable-&gt;SizeOfBlock - 8)/2);</span><br><span class="line">		pRelocationTable = (PIMAGE_BASE_RELOCATION)(pRelocationTable-&gt;SizeOfBlock + (DWORD)pRelocationTable);</span><br><span class="line">		i++;</span><br><span class="line">	&#125;</span><br><span class="line">#endif</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5Z2wzNS9hcnRpY2xlL2RldGFpbHMvMTE4OTMxNTI4"> 打印出重定位表（C 语言实现）_打印重定位表_lygl35 的博客 - CSDN 博客</span></p>
<h3 id="移动导出表"><a class="markdownIt-Anchor" href="#移动导出表">#</a> 移动导出表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.在DLL中新增节，返回FOA</span><br><span class="line">2.复制AddressOfFunctions 长度 4*NumberOfFunctions</span><br><span class="line">3.移动AddressOfNameOrdinals 长度 2*NumberOfNames</span><br><span class="line">4.复制AddressOfNames 长度  4*NumberOfNames</span><br><span class="line">5.复制函数名 长度不确定，直接修复AddressOfNames，复制完一个名字，算下一个地址在哪里，算完在修复Names表</span><br><span class="line">6.复制_IMAGE_EXPORT_DIRECTORY结构</span><br><span class="line">7.修复_IMAGE_EXPORT_DIRECTORY中的AddressOfFunctions，AddressOfNames，AddressOfNameOrdinals</span><br><span class="line">8.修复目录项中的值，指向新的_IMAGE_EXPORT_DIRECTORY</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.新增节</span><br><span class="line">2.目录项改为新增节起始位置</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230312153214517.png" alt="image-20230312153214517"></p>
<h3 id="iat"><a class="markdownIt-Anchor" href="#iat">#</a> IAT</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">12:       MessageBox(0,0,0,0);</span><br><span class="line">00401658 8B F4                mov         esi,esp</span><br><span class="line">0040165A 6A 00                push        0</span><br><span class="line">0040165C 6A 00                push        0</span><br><span class="line">0040165E 6A 00                push        0</span><br><span class="line">00401660 6A 00                push        0</span><br><span class="line">00401662 FF 15 44 63 48 00    call        dword ptr [__imp__MessageBoxA@16 (00486344)]</span><br><span class="line">00401668 3B F4                cmp         esi,esp</span><br><span class="line">0040166A E8 91 23 02 00       call        __chkesp (00423a00)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">我们自己写的程序，call后的地址是写死的，直接编译到exe中，不管中间是否有jmp</span><br><span class="line">调用dll的程序，call后是[x],[x]才是dll中函数真实的地址，x是exe空间内，[x]在dll空间内，x只有在所有dll都贴完只有才改x</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313165403957.png" alt="image-20230313165403957"></p>
<p>重定位表只能保证自己程序中的地址是正确的</p>
<p>IAT 是保证调用 dll 的时候 call 的地址是正确的</p>
<p>E8 call 是偏移</p>
<p>FF 15 call 是绝对地址</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313171609509.png" alt="image-20230313171609509"></p>
<p>只要用 dll 函数，全都是通过 [x] 调用，这样形成的表叫做 IAT 表</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313171956653.png" alt="image-20230313171956653"></p>
<p>IAThook</p>
<h3 id="导入表"><a class="markdownIt-Anchor" href="#导入表">#</a> 导入表</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123;</span><br><span class="line">    union &#123;</span><br><span class="line">        DWORD   Characteristics;            // 0 for terminating null import descriptor</span><br><span class="line">        DWORD   OriginalFirstThunk;         // RVA to original unbound IAT (PIMAGE_THUNK_DATA)</span><br><span class="line">    &#125; DUMMYUNIONNAME;</span><br><span class="line">    DWORD   TimeDateStamp;                  // 0 if not bound,</span><br><span class="line">                                            // -1 if bound, and real date\time stamp</span><br><span class="line">                                            //     in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND)</span><br><span class="line">                                            // O.W. date/time stamp of DLL bound to (Old BIND)</span><br><span class="line"> </span><br><span class="line">    DWORD   ForwarderChain;                 // -1 if no forwarders</span><br><span class="line">    DWORD   Name;</span><br><span class="line">    DWORD   FirstThunk;                     // RVA to IAT (if bound this IAT has actual addresses)</span><br><span class="line">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class="line">typedef IMAGE_IMPORT_DESCRIPTOR UNALIGNED *PIMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>
<p>PE 文件加载前</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230222142303612.png" alt="image-20230222142303612"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">通过导入表的FirstThunk找到IAT</span><br><span class="line">或者通过IMAGE_DATA_DIRECTORY的倒数第三张表找到IAT</span><br></pre></td></tr></table></figure>
<p>加载后</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230222143253824.png" alt="image-20230222143253824"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">INT 表作为加载后函数名的备份</span><br></pre></td></tr></table></figure>
<p>定位导入表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">目录项目的第二个结构就是导入表</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="绑定导入表"><a class="markdownIt-Anchor" href="#绑定导入表">#</a> 绑定导入表</h3>
<p>timedatestamp = -1 代表已经绑定了地址，真正的绑定时间为 IMAGE_BOUND_IMPORT_DES 的 TimeDateStamp</p>
<p>0 带包代表还没绑定</p>
<p>绑定导入表位于数据目录的第 12 项</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _IMAGE_BOUND_IMPORT_DESCRIPTOR &#123;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    WORD    OffsetModuleName;</span><br><span class="line">    WORD    NumberOfModuleForwarderRefs;    // Array of zero or more IMAGE_BOUND_FORWARDER_REF follows</span><br><span class="line">&#125; IMAGE_BOUND_IMPORT_DESCRIPTOR,  *PIMAGE_BOUND_IMPORT_DESCRIPTOR;</span><br><span class="line"></span><br><span class="line">typedef struct _IMAGE_BOUND_FORWARDER_REF &#123;</span><br><span class="line">    DWORD   TimeDateStamp;</span><br><span class="line">    WORD    OffsetModuleName;</span><br><span class="line">    WORD    Reserved;</span><br><span class="line">&#125; IMAGE_BOUND_FORWARDER_REF, *PIMAGE_BOUND_FORWARDER_REF;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="c"><a class="markdownIt-Anchor" href="#c">#</a> C++</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">haha</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="type">int</span> z;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">(haha h)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	haha sb;</span><br><span class="line">	<span class="built_in">fun</span>(sb);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">00401068</span> <span class="number">83</span> EC <span class="number">0</span>C             sub         esp,<span class="number">0</span>Ch</span><br><span class="line"><span class="number">0040106B</span> <span class="number">8B</span> C4                mov         eax,esp</span><br><span class="line"><span class="number">0040106</span>D <span class="number">8B</span> <span class="number">4</span>D F4             mov         ecx,dword ptr [ebp<span class="number">-0</span>Ch]</span><br><span class="line"><span class="number">00401070</span> <span class="number">89</span> <span class="number">08</span>                mov         dword ptr [eax],ecx</span><br><span class="line"><span class="number">00401072</span> <span class="number">8B</span> <span class="number">55</span> F8             mov         edx,dword ptr [ebp<span class="number">-8</span>]</span><br><span class="line"><span class="number">00401075</span> <span class="number">89</span> <span class="number">50</span> <span class="number">04</span>             mov         dword ptr [eax+<span class="number">4</span>],edx</span><br><span class="line"><span class="number">00401078</span> <span class="number">8B</span> <span class="number">4</span>D FC             mov         ecx,dword ptr [ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040107B</span> <span class="number">89</span> <span class="number">48</span> <span class="number">08</span>             mov         dword ptr [eax+<span class="number">8</span>],ecx</span><br><span class="line"><span class="number">0040107</span>E E8 <span class="number">82</span> FF FF FF       call        @ILT+<span class="number">0</span>(fun) (<span class="number">00401005</span>)</span><br><span class="line"><span class="number">00401083</span> <span class="number">83</span> C4 <span class="number">0</span>C             add         esp,<span class="number">0</span>Ch</span><br><span class="line"></span><br><span class="line">结构体作为参数时传的是结构体的副本，应该使用结构体指针</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Max</span><span class="params">(haha* sb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(sb-&gt;x &gt; sb-&gt;y);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体指针用-&gt;取结构体的成员</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">haha</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="type">int</span> z;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Max</span><span class="params">(haha* sb)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(sb-&gt;x &gt; sb-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//结构体中不计算函数的大小</span></span><br><span class="line"><span class="comment">//函数在结构体里时会默认传递一个参数，即结构体的首地址，放在ECX中，用于标识成员在那个对象中</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//当参数和变量同名时使用this</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">    <span class="keyword">this</span>-&gt;y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//返回当前对象首地址</span></span><br><span class="line"><span class="keyword">return</span> *(<span class="type">int</span>*)<span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//this不允许重新赋值</span></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225145426715.png" alt="image-20230225145426715"></p>
<p>3. 孔结构体大小是多少</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span>-&gt;x + <span class="keyword">this</span>-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Sub</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span>-&gt;x - <span class="keyword">this</span>-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Mul</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span>-&gt;x * <span class="keyword">this</span>-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Div</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> (<span class="keyword">this</span>-&gt;x / <span class="keyword">this</span>-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Cal haha;</span><br><span class="line">	haha.x = <span class="number">5</span>;</span><br><span class="line">	haha.y = <span class="number">2</span>;</span><br><span class="line">	<span class="type">int</span> a = haha.<span class="built_in">Add</span>();</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d \n&quot;</span>, a);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D768 C7 <span class="number">45</span> F8 <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-8</span>],<span class="number">5</span></span><br><span class="line"><span class="number">0040</span>D76F C7 <span class="number">45</span> FC <span class="number">02</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> mov         dword ptr [ebp<span class="number">-4</span>],<span class="number">2</span></span><br><span class="line"><span class="number">0040</span>D776 <span class="number">8</span>D <span class="number">4</span>D F8             lea         ecx,[ebp<span class="number">-8</span>]</span><br><span class="line"><span class="number">0040</span>D779 E8 B4 <span class="number">38</span> FF FF       call        @ILT+<span class="number">45</span>(Cal::Add) (<span class="number">00401032</span>)</span><br><span class="line"><span class="number">0040</span>D77E <span class="number">89</span> <span class="number">45</span> F4             mov         dword ptr [ebp<span class="number">-0</span>Ch],eax</span><br><span class="line"><span class="number">0040</span>D781 <span class="number">8B</span> <span class="number">45</span> F4             mov         eax,dword ptr [ebp<span class="number">-0</span>Ch]</span><br><span class="line"><span class="number">0040</span>D784 <span class="number">50</span>                   push        eax</span><br><span class="line"><span class="number">0040</span>D785 <span class="number">68</span> <span class="number">1</span>C <span class="number">20</span> <span class="number">42</span> <span class="number">00</span>       push        offset string <span class="string">&quot;%d %d %d %d\n&quot;</span> (<span class="number">0042201</span>c)</span><br><span class="line"><span class="number">0040</span>D78A E8 <span class="number">31</span> <span class="number">39</span> <span class="function">FF FF       call        <span class="title">printf</span> <span class="params">(<span class="number">004010</span>c0)</span></span></span><br><span class="line"><span class="function">0040D78F 83 C4 08             add         esp,8</span></span><br><span class="line"><span class="function">0040D792 33 C0                <span class="keyword">xor</span>         eax,eax</span></span><br><span class="line"><span class="function">0040D794 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040D795 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040D796 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040D797 83 C4 4C             add         esp,4Ch</span></span><br><span class="line"><span class="function">0040D79A 3B EC                cmp         ebp,esp</span></span><br><span class="line"><span class="function">0040D79C E8 9F 39 FF FF       call        __<span class="title">chkesp</span> <span class="params">(<span class="number">00401140</span>)</span></span></span><br><span class="line"><span class="function">0040D7A1 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040D7A3 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040D7A4 C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">0040D80A 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class="line"><span class="function">0040D80D 8B 45 FC             mov         eax,dword ptr [ebp-4]</span></span><br><span class="line"><span class="function">0040D810 8B 00                mov         eax,dword ptr [eax]</span></span><br><span class="line"><span class="function">0040D812 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class="line"><span class="function">0040D815 03 41 04             add         eax,dword ptr [ecx+4]</span></span><br><span class="line"><span class="function">0040D818 5F                   pop         edi</span></span><br><span class="line"><span class="function">0040D819 5E                   pop         esi</span></span><br><span class="line"><span class="function">0040D81A 5B                   pop         ebx</span></span><br><span class="line"><span class="function">0040D81B 8B E5                mov         esp,ebp</span></span><br><span class="line"><span class="function">0040D81D 5D                   pop         ebp</span></span><br><span class="line"><span class="function">0040D81E C3                   ret</span></span><br><span class="line"><span class="function"></span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//空结构体大小为1，如果没有成员变量只有成员函数，那么大小也是1</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cal</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Sub</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Mul</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Div</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d \n&quot;</span>, <span class="built_in">sizeof</span>(Cal));   <span class="comment">//1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Cal</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Add</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Sub</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Mul</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">Div</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;%d \n&quot;</span>, <span class="built_in">sizeof</span>(Cal));   <span class="comment">//1</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//入栈顺序从右到左</span></span><br><span class="line"><span class="comment">//最后在把this使用ecx传参</span></span><br><span class="line"><span class="comment">//采用内平栈</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="type">int</span> z;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">int</span> x,<span class="type">int</span> y, <span class="type">int</span> z)</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">		<span class="keyword">this</span>-&gt;y = y;		</span><br><span class="line">		<span class="keyword">this</span>-&gt;z = z;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Cal haha;</span><br><span class="line">	haha.<span class="built_in">init</span>(<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//printf(&quot;%d \n&quot;, a);</span></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D768 <span class="number">6</span>A <span class="number">05</span>                push        <span class="number">5</span></span><br><span class="line"><span class="number">0040</span>D76A <span class="number">6</span>A <span class="number">04</span>                push        <span class="number">4</span></span><br><span class="line"><span class="number">0040</span>D76C <span class="number">6</span>A <span class="number">03</span>                push        <span class="number">3</span></span><br><span class="line"><span class="number">0040</span>D76E <span class="number">8</span>D <span class="number">4</span>D F4             lea         ecx,[ebp<span class="number">-0</span>Ch]</span><br><span class="line"><span class="number">0040</span>D771 E8 C1 <span class="number">38</span> FF FF       call        @ILT+<span class="number">50</span>(Cal::init) (<span class="number">00401037</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="number">0040</span>D7C9 <span class="number">5B</span>                   pop         ebx</span><br><span class="line"><span class="number">0040</span>D7CA <span class="number">8B</span> E5                mov         esp,ebp</span><br><span class="line"><span class="number">0040</span>D7CC <span class="number">5</span>D                   pop         ebp</span><br><span class="line"><span class="number">0040</span>D7CD C2 <span class="number">0</span>C <span class="number">00</span>             ret         <span class="number">0</span>Ch</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="构造函数"><a class="markdownIt-Anchor" href="#构造函数">#</a> 构造函数</h3>
<p>1. 没有返回值</p>
<p>2. 根类同名</p>
<p>3. 在创建对象的时候调用</p>
<p>可以重载构造函数，但参数不能完全一样</p>
<p>成员函数也可以重载，名字一样，参数类型或者个数不一样</p>
<h3 id="析构函数"><a class="markdownIt-Anchor" href="#析构函数">#</a> 析构函数</h3>
<p>堆是动态分配，自己申请自己释放</p>
<p>析构函数不能重载</p>
<p>不能有任何参数</p>
<p>不能有返回值</p>
<p>用于清理工作</p>
<p>不一定一定要有</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Person</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="type">char</span>* arr;</span><br><span class="line">	<span class="built_in">Person</span>(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">		<span class="keyword">this</span>-&gt;y = y;</span><br><span class="line">		arr = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="number">100</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	~<span class="built_in">Person</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">free</span>(arr);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h3 id="继承"><a class="markdownIt-Anchor" href="#继承">#</a> 继承</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">struct Man</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct Mankind:Man</span><br><span class="line">&#123;</span><br><span class="line">	int c;</span><br><span class="line">	int d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	Mankind m;</span><br><span class="line">	m.a = 1;</span><br><span class="line">	m.d = 2;</span><br><span class="line">    std::cout &lt;&lt; &quot;Hello World!\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">上面的代码反汇编时和: 一样</span><br><span class="line">struct Mankind</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">	int c;</span><br><span class="line">	int d;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>继承就是数据复制</p>
<p>减少重复代码</p>
<p>父类 基类</p>
<p>子类 派生类</p>
<p>可以用父类的指针访问子类的对象，但该指针不能访问子类特有的成员</p>
<p>子类的指针访问父类的对象需要强转，但可能会访问到父类不存在的对象</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> <span class="title class_">Man</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> a;</span><br><span class="line">	<span class="type">int</span> b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Mankind</span>:Man</span><br><span class="line">&#123;</span><br><span class="line">	<span class="type">int</span> c;</span><br><span class="line">	<span class="type">int</span> d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">fun</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Man n;</span><br><span class="line">	Mankind m;</span><br><span class="line"></span><br><span class="line">	Man* haha = &amp;m;</span><br><span class="line">	Mankind* xixi = (Mankind*)&amp;n;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">fun</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多层继承时会计算所有成员变量的大小</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">struct A</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct B:A</span><br><span class="line">&#123;</span><br><span class="line">	int c;</span><br><span class="line">	int d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct C:B</span><br><span class="line">&#123;</span><br><span class="line">	int e;</span><br><span class="line">	int f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void fun()</span><br><span class="line">&#123;</span><br><span class="line">	C c;</span><br><span class="line">	A* pa = &amp;c;</span><br><span class="line">	B* pb = &amp;c;</span><br><span class="line">	</span><br><span class="line">	sizeof(c);  //24</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">struct A</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct B:A</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct C:B</span><br><span class="line">&#123;</span><br><span class="line">	int e;</span><br><span class="line">	int f;</span><br><span class="line">&#125;;</span><br><span class="line">void fun()</span><br><span class="line">&#123;</span><br><span class="line">	C c;</span><br><span class="line">	c.A::a = 1;</span><br><span class="line">	c.B::a = 2;</span><br><span class="line">	//不指定空间全部按照子类处理</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多重继承</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">struct A</span><br><span class="line">&#123;</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct B</span><br><span class="line">&#123;</span><br><span class="line">	int c;</span><br><span class="line">	int d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct C:A,B</span><br><span class="line">&#123;</span><br><span class="line">	int e;</span><br><span class="line">	int f;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sizeof()  //24</span><br></pre></td></tr></table></figure>
<p>多重继承增加了程序的复杂度，容易出错</p>
<p>微软建议使用单继承，如果需要多重继承可以改为多层继承</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230226151844722.png" alt="image-20230226151844722"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230226152028331.png" alt="image-20230226152028331"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">struct DateInfo</span><br><span class="line">&#123;</span><br><span class="line">	int year;</span><br><span class="line">	int month;</span><br><span class="line">	int day;</span><br><span class="line">	DateInfo(int x, int y, int z)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;year = x;</span><br><span class="line">		this-&gt;month = y;</span><br><span class="line">		this-&gt;day = z;</span><br><span class="line">	&#125;</span><br><span class="line">	DateInfo()</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;year = 2015;</span><br><span class="line">		this-&gt;month = 4;</span><br><span class="line">		this-&gt;day = 2;</span><br><span class="line">	&#125;</span><br><span class="line">	void SetDay(int day)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;day = day;</span><br><span class="line">	&#125;</span><br><span class="line">	int GetDay()</span><br><span class="line">	&#123;</span><br><span class="line">		printf(&quot;%d\n&quot;, this-&gt;day);</span><br><span class="line">		return this-&gt;day;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct TimeInfo:DateInfo</span><br><span class="line">&#123;</span><br><span class="line">	int hours;</span><br><span class="line">	int minutes;</span><br><span class="line">	int seconds;</span><br><span class="line">	TimeInfo(int x, int y, int z)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;hours = x;</span><br><span class="line">		this-&gt;minutes = y;</span><br><span class="line">		this-&gt;seconds = z;</span><br><span class="line">	&#125;</span><br><span class="line">	int GetHour()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; this-&gt;hours &lt;&lt; &quot; \n&quot;;</span><br><span class="line">		return this-&gt;hours;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void func1()</span><br><span class="line">&#123;</span><br><span class="line">	DateInfo d;</span><br><span class="line">	TimeInfo t(1,2,3);</span><br><span class="line"></span><br><span class="line">	DateInfo* date = &amp;t;</span><br><span class="line">	TimeInfo* time = &amp;t;</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; date-&gt;day &lt;&lt; &quot; &quot; &lt;&lt; time-&gt;hours &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MyString</span><br><span class="line">&#123;</span><br><span class="line">	char* arr;</span><br><span class="line">	MyString()</span><br><span class="line">	&#123;</span><br><span class="line">		arr = (char*)malloc(1024);</span><br><span class="line">	&#125;</span><br><span class="line">	MyString(int length)</span><br><span class="line">	&#123;</span><br><span class="line">		arr = (char*)malloc(length);</span><br><span class="line">	&#125;</span><br><span class="line">	~MyString()</span><br><span class="line">	&#123;</span><br><span class="line">		free(arr);</span><br><span class="line">	&#125;</span><br><span class="line">	void SetString(char* str)</span><br><span class="line">	&#123;</span><br><span class="line">		int i = 0;</span><br><span class="line">		int length = strlen(str);</span><br><span class="line">		while(str[i] != 0 &amp;&amp; length&gt;0)</span><br><span class="line">		&#123;</span><br><span class="line">			arr[i] = str[i];</span><br><span class="line">			i++;</span><br><span class="line">			length--;</span><br><span class="line">		&#125;</span><br><span class="line">		arr[i] = &#x27;\0&#x27;;</span><br><span class="line">	&#125;</span><br><span class="line">	void PrintString()</span><br><span class="line">	&#123;</span><br><span class="line">		int i = 0;</span><br><span class="line">		</span><br><span class="line">		while(arr[i] != 0)</span><br><span class="line">		&#123;</span><br><span class="line">			printf(&quot;%c&quot;, arr[i]);</span><br><span class="line">			i++;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		printf(&quot;\n&quot;,i);</span><br><span class="line">	&#125;</span><br><span class="line">	void AppendString(char* str2)</span><br><span class="line">	&#123;</span><br><span class="line">		strcat(arr, str2);</span><br><span class="line">	&#125;</span><br><span class="line">	void Size()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; strlen(arr) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;	</span><br><span class="line">	MyString string1;</span><br><span class="line"></span><br><span class="line">	string1.SetString(&quot;woshishabi&quot;);</span><br><span class="line"></span><br><span class="line">	string1.PrintString();</span><br><span class="line"></span><br><span class="line">	string1.AppendString(&quot;haha&quot;);</span><br><span class="line"></span><br><span class="line">	string1.PrintString();</span><br><span class="line"></span><br><span class="line">	string1.Size();</span><br><span class="line">	</span><br><span class="line">	printf(&quot;Hello World!\n&quot;);</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">//formbase.h</span><br><span class="line">class formbase</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line"></span><br><span class="line">	formbase();</span><br><span class="line">	~formbase();</span><br><span class="line"></span><br><span class="line">	void fun1();</span><br><span class="line">	void fun2();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//formbase.cpp</span><br><span class="line">#include &quot;formbase.h&quot;</span><br><span class="line"></span><br><span class="line">formbase::formbase()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">formbase::~formbase()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void formbase::fun1()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void formbase::fun2()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1、xxx.h 只是一个文件，可以是任何的后缀名，如果你愿意，可以叫 xxx.exe</p>
<p>2、#include 的作用只是把里面的内容复制过来仅此而已。如: #include “abc.exe”</p>
<p>3、xxx.h 与 xxx.cpp 并不要求一定同名</p>
<h3 id="权限控制"><a class="markdownIt-Anchor" href="#权限控制">#</a> 权限控制</h3>
<p>public 的意思是，这个成员哪里都可以用，不用担心被修改，所以，一旦发布成 public 的成员，是不能够改名字的.</p>
<p>private 的意思是，这个成员只用于内部使用，不要在其他的地方使用.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">struct Person</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	int x;</span><br><span class="line">private:</span><br><span class="line">	int y;</span><br><span class="line">private:</span><br><span class="line">	void fun1();</span><br><span class="line">	void fun2();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>1、对外提供的函数或者变量，发布成 public 的但不能随意改动.</p>
<p>2、可能会变动的函数或者变量，定义成 private 的这样编译器会在使用的时候做检测.</p>
<p>3、只有结构体内部的函数才可以访问 private 的成员.</p>
<p>4、public/private 可以修饰函数也可以修饰变量.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//通过指针强制访问private</span><br><span class="line">void haha()</span><br><span class="line">&#123;</span><br><span class="line">	Person p;</span><br><span class="line">	p.init(45, 67);</span><br><span class="line">	int* x = (int*)&amp;p;</span><br><span class="line">	int m = *(x + 0);</span><br><span class="line">	int n = *(x + 1);</span><br><span class="line">	std::cout &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt; n &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>struct 中默认全是 public</p>
<p>class 中默认全是 private</p>
<p><strong>class 继承时会将原来的 public 变为 private，如果想要保持 pubic，需要 <code>class Sub:public Person</code> </strong></p>
<p>构造时先构造父类，在构造子类，因为需要继承构造之后的子类</p>
<p>没有构造函数的时候系统会给一个默认的构造函数，</p>
<p>public 继承会复制父类私有的成员，但无法直接使用，需要通过指针访问</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class shabi</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	shabi()</span><br><span class="line">	&#123;</span><br><span class="line">		a= 99;</span><br><span class="line">		b= 88;</span><br><span class="line">	&#125;</span><br><span class="line">private:</span><br><span class="line">	int a;</span><br><span class="line">	int b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class zhizhang:public shabi</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void xixi()</span><br><span class="line">&#123;</span><br><span class="line">	zhizhang zz;</span><br><span class="line">	zz.x = 77;</span><br><span class="line">	zz.y = 66;</span><br><span class="line">	int *q = (int*)&amp;zz;</span><br><span class="line">	std::cout &lt;&lt; *(q+0) &lt;&lt; &quot; &quot; &lt;&lt; *(q+1) &lt;&lt; &quot; &quot; &lt;&lt; *(q+2) &lt;&lt; &quot; &quot; &lt;&lt; *(q+3) &lt;&lt; &quot; \n&quot;;</span><br><span class="line">&#125;</span><br><span class="line">//99 88 77 66 </span><br></pre></td></tr></table></figure>
<p>将上一节课的所有练习改为 class 实现</p>
<p>1、添加 private/public 进行权限控制.</p>
<p>2、将类的定义与实现分开来写：定义写到 xxx.h 中函数实现写在 xx.x…cpp 中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">//xixixi.h</span><br><span class="line">class MyString</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	MyString();</span><br><span class="line">	MyString(int length);</span><br><span class="line">	~MyString();</span><br><span class="line">private:</span><br><span class="line">	char* arr;</span><br><span class="line">public:</span><br><span class="line">	void SetString(char* str);</span><br><span class="line">	void PrintString();</span><br><span class="line">	void AppendString(char* str2);</span><br><span class="line">	void Size();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">//xixixi.cpp</span><br><span class="line">MyString::MyString()</span><br><span class="line">&#123;</span><br><span class="line">	arr = (char*)malloc(1024);</span><br><span class="line">&#125;</span><br><span class="line">MyString::MyString(int length)</span><br><span class="line">&#123;</span><br><span class="line">	arr = (char*)malloc(length);</span><br><span class="line">&#125;</span><br><span class="line">MyString::~MyString()</span><br><span class="line">&#123;</span><br><span class="line">	free(arr);</span><br><span class="line">&#125;</span><br><span class="line">void MyString::SetString(char* str)</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0;</span><br><span class="line">    int length = strlen(str);</span><br><span class="line">    while(str[i] != 0 &amp;&amp; length&gt;0)</span><br><span class="line">    &#123;</span><br><span class="line">        arr[i] = str[i];</span><br><span class="line">        i++;</span><br><span class="line">        length--;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[i] = &#x27;\0&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">void MyString::PrintString()</span><br><span class="line">&#123;</span><br><span class="line">    int i = 0;</span><br><span class="line"></span><br><span class="line">    while(arr[i] != 0)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(&quot;%c&quot;, arr[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    printf(&quot;\n&quot;,i);</span><br><span class="line">&#125;</span><br><span class="line">void MyString::AppendString(char* str2)</span><br><span class="line">&#123;</span><br><span class="line">	strcat(arr, str2);</span><br><span class="line">&#125;</span><br><span class="line">void MyString::Size()</span><br><span class="line">&#123;</span><br><span class="line">	std::cout &lt;&lt; strlen(arr) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;	</span><br><span class="line"></span><br><span class="line">	MyString string1;</span><br><span class="line"></span><br><span class="line">	string1.SetString(&quot;woshishabi&quot;);</span><br><span class="line"></span><br><span class="line">	string1.PrintString();</span><br><span class="line"></span><br><span class="line">	string1.AppendString(&quot;haha&quot;);</span><br><span class="line"></span><br><span class="line">	string1.PrintString();</span><br><span class="line"></span><br><span class="line">	string1.Size();</span><br><span class="line">	</span><br><span class="line">	printf(&quot;Hello World!\n&quot;);</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="虚函数表"><a class="markdownIt-Anchor" href="#虚函数表">#</a> 虚函数表</h3>
<p>直接调用和间接调用</p>
<p>直接调用 call 地址 E8 …</p>
<p>间接调用 call […]  FF …</p>
<p>虚函数通过对象调用时和普通函数没有区别</p>
<p>虚函数通过指针调用时是间接调用的</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func1</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Hello World 111 !\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func2</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;Hello World! 222 \n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Test t;</span><br><span class="line">	Test* pt = &amp;t;</span><br><span class="line">	pt-&gt;<span class="built_in">func1</span>();</span><br><span class="line">	pt-&gt;<span class="built_in">func2</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">00401398</span> <span class="number">8</span>D <span class="number">4</span>D FC             lea         ecx,[ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040139B</span> E8 F1 FC FF FF       call        @ILT+<span class="number">140</span>(Test::Test) (<span class="number">00401091</span>)</span><br><span class="line"><span class="number">24</span>:       Test* pt = &amp;t;</span><br><span class="line"><span class="number">004013</span>A0 <span class="number">8</span>D <span class="number">45</span> FC             lea         eax,[ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">004013</span>A3 <span class="number">89</span> <span class="number">45</span> F8             mov         dword ptr [ebp<span class="number">-8</span>],eax</span><br><span class="line"><span class="number">25</span>:       pt-&gt;<span class="built_in">func1</span>();</span><br><span class="line"><span class="number">004013</span>A6 <span class="number">8B</span> <span class="number">4</span>D F8             mov         ecx,dword ptr [ebp<span class="number">-8</span>]</span><br><span class="line"><span class="number">004013</span>A9 E8 <span class="number">61</span> FC FF FF       call        @ILT+<span class="number">10</span>(Test::func1) (<span class="number">0040100f</span>)</span><br><span class="line"><span class="number">26</span>:       pt-&gt;<span class="built_in">func2</span>();</span><br><span class="line"><span class="number">004013</span>AE <span class="number">8B</span> <span class="number">4</span>D F8             mov         ecx,dword ptr [ebp<span class="number">-8</span>]</span><br><span class="line"><span class="number">004013B</span>1 <span class="number">8B</span> <span class="number">11</span>                mov         edx,dword ptr [ecx]</span><br><span class="line"><span class="number">004013B</span>3 <span class="number">8B</span> F4                mov         esi,esp</span><br><span class="line"><span class="number">004013B</span>5 <span class="number">8B</span> <span class="number">4</span>D F8             mov         ecx,dword ptr [ebp<span class="number">-8</span>]</span><br><span class="line"><span class="number">004013B</span>8 FF <span class="number">12</span>                call        dword ptr [edx]</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"><span class="built_in">sizeof</span>(Test) = <span class="number">12</span>;</span><br><span class="line">虚函数 + <span class="number">4</span>字节，不管有多少虚函数，他指向一个数组，数组中存储对象中所有虚函数地址</span><br><span class="line">虚函数表在对象的首地址，是一个四字节的地址 </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230228161556184.png" alt="image-20230228161556184"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">class Base</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;333\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Sub :Base</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func4()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;444\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func5()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;555\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func6()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;666\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">//打印Sub虚函数表，画图</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Base* bp1 = &amp;base;</span><br><span class="line">Base* bp2 = (Base*)&amp;sub;</span><br><span class="line">printf(&quot;%X\n&quot;,bp1);</span><br><span class="line">printf(&quot;%X\n&quot;,bp2);</span><br><span class="line"></span><br><span class="line">printf(&quot;%X\n&quot;, *(((int*)bp1) + 0));</span><br><span class="line">printf(&quot;%X\n&quot;, *(((int*)bp1) + 1));</span><br><span class="line"></span><br><span class="line">printf(&quot;%X\n&quot;, *(((int*)bp2) + 0));</span><br><span class="line">printf(&quot;%X\n&quot;, *(((int*)bp2) + 1));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">18FF44</span><br><span class="line">18FF40</span><br><span class="line">432020</span><br><span class="line">18FF88</span><br><span class="line">432048</span><br><span class="line">432020</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">0018FF38  40 FF 18 00  @...  //sub</span><br><span class="line">0018FF3C  44 FF 18 00  D...  //Base</span><br><span class="line">0018FF40  48 20 43 00  H C.  //sub虚表</span><br><span class="line">0018FF44  20 20 43 00    C.</span><br><span class="line">0018FF48  88 FF 18 00  ....  //ebp</span><br><span class="line"></span><br><span class="line">00432020  05 10 40 00  ..@.</span><br><span class="line">00432024  78 10 40 00  x.@.</span><br><span class="line">00432028  96 10 40 00  ..@.</span><br><span class="line">0043202C  00 00 00 00  ....</span><br><span class="line">00432030  31 31 31 0A  111.</span><br><span class="line">00432034  00 00 00 00  ....</span><br><span class="line">00432038  32 32 32 0A  222.</span><br><span class="line">0043203C  00 00 00 00  ....</span><br><span class="line">00432040  33 33 33 0A  333.</span><br><span class="line">00432044  00 00 00 00  ....</span><br><span class="line">00432048  05 10 40 00  ..@.</span><br><span class="line">0043204C  78 10 40 00  x.@.</span><br><span class="line">00432050  96 10 40 00  ..@.</span><br><span class="line">00432054  69 10 40 00  i.@.</span><br><span class="line">00432058  C3 10 40 00  ..@.</span><br><span class="line">0043205C  14 10 40 00  ..@.</span><br><span class="line">00432060  00 00 00 00  ....</span><br><span class="line">00432064  34 34 34 0A  444.</span><br><span class="line">00432068  00 00 00 00  ....</span><br><span class="line">0043206C  35 35 35 0A  555.</span><br><span class="line">00432070  00 00 00 00  ....</span><br><span class="line">00432074  36 36 36 0A  666.</span><br><span class="line">00432078  00 00 00 00  ....</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Base base;</span><br><span class="line">	Sub sub;</span><br><span class="line"></span><br><span class="line">	Base* bp1 = &amp;base;</span><br><span class="line">	Base* bp2 = (Base*)&amp;sub;</span><br><span class="line"></span><br><span class="line">	typedef void(*pFunc)(void);</span><br><span class="line"></span><br><span class="line">	pFunc ppp;</span><br><span class="line"></span><br><span class="line">	ppp = (pFunc)*((int*)(*(int*)(bp1)+0)+0);   //取值范围bp1+0+0 - bp1+0+2   111-333</span><br><span class="line">	ppp = (pFunc)*((int*)(*(int*)(bp2)+0)+3);   //取值范围bp2+0+0 - bp2+0+5   111-666</span><br><span class="line">	</span><br><span class="line">	ppp();</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230228181939235.png" alt="image-20230228181939235"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">class Base</span><br><span class="line">&#123;</span><br><span class="line">public:</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;333\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">class Sub :Base</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;sub:111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;Sub:222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func6()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;666\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line">//打印Sub虚函数表，画图</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">0018FF38  40 FF 18 00  @...  //sub</span><br><span class="line">0018FF3C  44 FF 18 00  D...  //Base</span><br><span class="line">0018FF40  48 20 43 00  H C.  //sub虚表</span><br><span class="line">0018FF44  20 20 43 00    C.</span><br><span class="line">0018FF48  88 FF 18 00  ....  //ebp</span><br><span class="line"></span><br><span class="line">0432020  0A 10 40 00  ..@.</span><br><span class="line">00432024  7D 10 40 00  &#125;.@.</span><br><span class="line">00432028  9B 10 40 00  ..@.</span><br><span class="line">0043202C  00 00 00 00  ....</span><br><span class="line">00432030  31 31 31 0A  111.</span><br><span class="line">00432034  00 00 00 00  ....</span><br><span class="line">00432038  32 32 32 0A  222.</span><br><span class="line">0043203C  00 00 00 00  ....</span><br><span class="line">00432040  33 33 33 0A  333.</span><br><span class="line">00432044  00 00 00 00  ....</span><br><span class="line">00432048  1E 10 40 00  ..@.</span><br><span class="line">0043204C  3C 10 40 00  &lt;.@.</span><br><span class="line">00432050  9B 10 40 00  ..@.</span><br><span class="line">00432054  05 10 40 00  ..@.</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Base base;</span><br><span class="line">	Sub sub;</span><br><span class="line"></span><br><span class="line">	Base* bp1 = &amp;base;</span><br><span class="line">	Base* bp2 = (Base*)&amp;sub;</span><br><span class="line"></span><br><span class="line">	typedef void(*pFunc)(void);</span><br><span class="line"></span><br><span class="line">	pFunc ppp;</span><br><span class="line"></span><br><span class="line">	ppp = (pFunc)*((int*)(*(int*)(bp1)+0)+0);   //取值范围bp1+0+0 - bp1+0+2   111-333</span><br><span class="line">	ppp = (pFunc)*((int*)(*(int*)(bp2)+0)+3);   //取值范围bp2+0+0 - bp2+0+3   sub111-sub222-333-666</span><br><span class="line">	</span><br><span class="line">	ppp();</span><br><span class="line">	</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多继承</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class B</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;333\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func4()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;444\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class C:A,B</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func5()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;555\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func6()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;666\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sizeof(C) = 8;</span><br><span class="line">有几个直接分类就有几个虚函数表</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301140806277.png" alt="image-20230301140806277"></p>
<p>多重继承有覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class B</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;333\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func4()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;444\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class C:A,B</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;sub:555\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;sub:666\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">		virtual void func7()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;77\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sizeof(C) = 8;</span><br><span class="line">有几个直接分类就有几个虚函数表</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class A</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func1()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;111\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func2()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;222\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class B:A</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func3()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;333\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func4()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;444\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">class C: B</span><br><span class="line">&#123;</span><br><span class="line">	virtual void func5()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;555\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">	virtual void func6()</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; &quot;666\n&quot;;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="动态绑定"><a class="markdownIt-Anchor" href="#动态绑定">#</a> 动态绑定</h3>
<p>编译器确定的成为前期或者编译器绑定</p>
<p>调用时再知道地址的成为运行期绑定 / 动态绑定 / 晚绑定</p>
<p>成员变量和普通的成员函数时编译时绑定</p>
<p>virtual 函数时动态绑定，call 是 FFcall，通过虚表实现</p>
<p>动态绑定就是多态，相同函数体现出了不同的行为</p>
<p>多态实现了父类的指针访问子类的方法</p>
<p>虚析构在继承的时候有用，把父类的析构定义成虚函数，这样子类在析构时不会调用父类的析构</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301150809049.png" alt="image-20230301150809049"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301150833000.png" alt="image-20230301150833000"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">	<span class="built_in">Base</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;x = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;y = <span class="number">2</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,<span class="keyword">this</span>-&gt;x,<span class="keyword">this</span>-&gt;y);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sub1</span>:Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> A;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">Sub1</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;x = <span class="number">3</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;y = <span class="number">4</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;A = <span class="number">5</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,<span class="keyword">this</span>-&gt;x,<span class="keyword">this</span>-&gt;y,<span class="keyword">this</span>-&gt;A);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sub2</span>:Base</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> B;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">Sub2</span>()</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">this</span>-&gt;x = <span class="number">6</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;y = <span class="number">7</span>;</span><br><span class="line">		<span class="keyword">this</span>-&gt;B = <span class="number">8</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,<span class="keyword">this</span>-&gt;x,<span class="keyword">this</span>-&gt;y,<span class="keyword">this</span>-&gt;B);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Base b;</span><br><span class="line">	Sub1 s1;</span><br><span class="line">	Sub2 s2;</span><br><span class="line">	Base* arr[] = &#123;&amp;b,(Base*)&amp;s1,(Base*)&amp;s2&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		arr[i]-&gt;<span class="built_in">print</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果Base的print存在virtual，那么结果为1 2  3 4 5  6 7 8，可以使用父类的指针访问子类的print</span></span><br><span class="line"><span class="comment">//如果没有virtual,那么结果为1 2  3 4  6 7，调用的都是父类的方法</span></span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">sing</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout&lt;&lt; <span class="string">&quot;nishishabi&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span>:<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">sing</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout&lt;&lt; <span class="string">&quot;wangwang&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>:<span class="keyword">public</span> Animal</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">sing</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		std::cout&lt;&lt; <span class="string">&quot;miaomiao!!!&quot;</span> &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Dog d;</span><br><span class="line"></span><br><span class="line">	Animal* a = (Animal*)&amp;d;</span><br><span class="line">	a-&gt;<span class="built_in">sing</span>();   <span class="comment">//if virtual exists,print wangwang,else print nishishabi</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="模板"><a class="markdownIt-Anchor" href="#模板">#</a> 模板</h3>
<p>函数模板</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sort</span><span class="params">(T arr, <span class="type">int</span> nLength)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> k=<span class="number">0</span>; k&lt;nLength<span class="number">-1</span>; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nLength-k<span class="number">-1</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]&gt;arr[i+<span class="number">1</span>])</span><br><span class="line">            &#123;</span><br><span class="line">                T temp = arr[i];</span><br><span class="line">                arr[i] = arr[i+<span class="number">1</span>];</span><br><span class="line">                arr[i+<span class="number">1</span>] = temp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">E</span>&gt;</span><br><span class="line"><span class="comment">//T和E是两个不同的类型，T是int* E是int</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Find</span><span class="params">(T arr, <span class="type">int</span> nLength, E nElement)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> nBegin = <span class="number">0</span>, nEnd = nLength - <span class="number">1</span>, nIndex;</span><br><span class="line">	<span class="keyword">while</span> (nBegin &lt;= nEnd)</span><br><span class="line">	&#123;</span><br><span class="line">		nIndex = (nBegin + nEnd) / <span class="number">2</span>;</span><br><span class="line">		<span class="keyword">if</span> (nElement &gt; arr[nIndex])</span><br><span class="line">		&#123;</span><br><span class="line">			nBegin = nIndex + <span class="number">1</span>;</span><br><span class="line">;		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (nElement &lt; arr[nIndex])</span><br><span class="line">		&#123;</span><br><span class="line">			nEnd = nIndex - <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">return</span> nIndex;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>类模板</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">M</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">T <span class="title">Max</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">M <span class="title">Min</span><span class="params">()</span></span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	T x;</span><br><span class="line">	T y;</span><br><span class="line">	M a;</span><br><span class="line">	M b;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230302153313237.png" alt="image-20230302153313237"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">E</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">swap</span><span class="params">(T x, T y, E sb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	E temp = *x;</span><br><span class="line">	*x = *y;</span><br><span class="line">	*y = temp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">double</span> a = <span class="number">4.45</span>, b = <span class="number">8.99</span>, c;</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">swap</span>(&amp;a,&amp;b,c);</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; b &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">T</span>, <span class="keyword">class</span> <span class="title class_">E</span>&gt;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">sort</span><span class="params">(T arr, <span class="type">int</span> nLength, E sb)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; nLength - <span class="number">1</span>; k++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nLength - k - <span class="number">1</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">            <span class="comment">//class Base&#x27; does not define this operator or a conversion to a type acceptable to the predefined operator</span></span><br><span class="line">			<span class="keyword">if</span> (*arr[i] &gt; *arr[i + <span class="number">1</span>])</span><br><span class="line">			&#123;</span><br><span class="line">				E temp = *arr[i];</span><br><span class="line">				*arr[i] = *arr[i + <span class="number">1</span>];</span><br><span class="line">				*arr[i + <span class="number">1</span>] = *temp;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">	Base b1, b2, b3, b4, b5;</span><br><span class="line">	Base* arr1[<span class="number">5</span>] = &#123; &amp;b1, &amp;b2, &amp;b3, &amp;b4, &amp;b5 &#125;;</span><br><span class="line">	<span class="built_in">sort</span>(arr1, <span class="number">5</span>, &amp;b1);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">5</span>;i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,arr1[i]);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    </span><br></pre></td></tr></table></figure>
<h3 id="引用类型"><a class="markdownIt-Anchor" href="#引用类型">#</a> 引用类型</h3>
<p>指针传递的时候指针可以修改</p>
<p>能使用指针的就能使用引用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test</span><span class="params">(<span class="type">int</span>&amp; x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	x = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test2</span><span class="params">(<span class="type">int</span>* x)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	*x = <span class="number">10086</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">100</span>;</span><br><span class="line">	<span class="built_in">Test</span>(a);</span><br><span class="line">	std::cout&lt;&lt; a &lt;&lt; <span class="string">&quot;\n&quot;</span>;  <span class="comment">//1</span></span><br><span class="line">	<span class="built_in">Test2</span>(&amp;a);</span><br><span class="line">	std::cout&lt;&lt; a &lt;&lt; <span class="string">&quot;\n&quot;</span>;  <span class="comment">//10086</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">174</span>:      <span class="built_in">Test</span>(a);</span><br><span class="line"><span class="number">0040181F</span> <span class="number">8</span>D <span class="number">45</span> FC             lea         eax,[ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">00401822</span> <span class="number">50</span>                   push        eax</span><br><span class="line"><span class="number">00401823</span> E8 <span class="number">04</span> F9 FF FF       call        @ILT+<span class="number">295</span>(Test) (<span class="number">0040112</span>c)</span><br><span class="line"><span class="number">00401828</span> <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span><br><span class="line"><span class="number">176</span>:      <span class="built_in">Test2</span>(&amp;a);</span><br><span class="line"><span class="number">00401847</span> <span class="number">8</span>D <span class="number">55</span> FC             lea         edx,[ebp<span class="number">-4</span>]</span><br><span class="line"><span class="number">0040184</span>A <span class="number">52</span>                   push        edx</span><br><span class="line"><span class="number">0040184B</span> E8 E0 F9 FF FF       call        @ILT+<span class="number">555</span>(Test2) (<span class="number">00401230</span>)</span><br><span class="line"><span class="number">00401850</span> <span class="number">83</span> C4 <span class="number">04</span>             add         esp,<span class="number">4</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>引用和指针在汇编是一样的，都是 lea，但编译器不允许引用再指向别的地方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、引用类型是C++里面的类型</span><br><span class="line">2、引用类型只能赋值一次，不能重新赋值</span><br><span class="line">3、引用只是变量的一个别名.</span><br><span class="line">4、引用可以理解成是编译器维护的一个指针，但并不占用空间(如何去理解这句话?).</span><br><span class="line">5、使用引用可以像指针那样去访问、修改对象的内容，但更加安全.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2、从反汇编的角度说说引用与指针的区  参数传递，读写变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int sb = 100;</span><br><span class="line">const int&amp; x = sb;</span><br><span class="line">std::cout&lt;&lt; x &lt;&lt; &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">sb = 15;</span><br><span class="line">std::cout&lt;&lt; x &lt;&lt; &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">x = 13;  //error</span><br><span class="line">std::cout&lt;&lt; x &lt;&lt; &quot;\n&quot;;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/kingcat666/article/details/44852565">C<ins> 中引用（&amp;）的用法和拷贝 / 赋值函数的区别_c</ins> 拷贝和引用的区别_Zenhobby 的博客 - CSDN 博客</a></p>
<p>可以参考一下上面的连接，对但不完全对</p>
<h3 id="友元函数"><a class="markdownIt-Anchor" href="#友元函数">#</a> 友元函数</h3>
<p>让类外面的方法也可以访问类中的私有成员</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">class Person</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">public:</span><br><span class="line">	Person(int x, int y)</span><br><span class="line">	&#123;</span><br><span class="line">		this-&gt;x = x;</span><br><span class="line">		this-&gt;y = y;</span><br><span class="line">	&#125;</span><br><span class="line">	//声明友元函数</span><br><span class="line">	friend void Print(const Person&amp; refPer);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">void Print(const Person&amp; refPer)</span><br><span class="line">&#123;</span><br><span class="line">	std::cout &lt;&lt; refPer.x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>友元类让另一个类访问一个类的私有成员</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">什么情况下需要友元函数:</span><br><span class="line">1）运算符重载的某些场合需要使用友元.</span><br><span class="line">2两个类要共享数据的时候.中</span><br><span class="line">友元函数和类的成员函数的区别</span><br><span class="line">(1）成员函数有this指针，而友元函数没有this指针</span><br><span class="line">(2)友元函数是不能被继承的，就像父亲的朋友未必是儿子的朋友</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="运算符重载"><a class="markdownIt-Anchor" href="#运算符重载">#</a> 运算符重载</h3>
<p>函数必须返回自己的类型</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">class Number</span><br><span class="line">&#123;</span><br><span class="line">private:</span><br><span class="line">	int x;</span><br><span class="line">	int y;</span><br><span class="line">public:</span><br><span class="line">	Number();</span><br><span class="line">	Number operator++();</span><br><span class="line">	Number operator+(const Number&amp; p);</span><br><span class="line">	//bool operator&gt;(const Number&amp; p);</span><br><span class="line">	void print();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Number::Number()</span><br><span class="line">&#123;</span><br><span class="line">	this-&gt;x = 1;</span><br><span class="line">	this-&gt;y = 2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number Number::operator++()</span><br><span class="line">&#123;</span><br><span class="line">	this-&gt;x++;</span><br><span class="line">	this-&gt;y++;</span><br><span class="line">	return *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number Number::operator+(const Number&amp; p)</span><br><span class="line">&#123;</span><br><span class="line">	this-&gt;x += p.x;</span><br><span class="line">	this-&gt;y += p.y;</span><br><span class="line">	//return Number();</span><br><span class="line">	return *this;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void Number::print()</span><br><span class="line">&#123;</span><br><span class="line">	std::cout &lt;&lt; this-&gt;x &lt;&lt; &quot; &quot; &lt;&lt; this-&gt;y &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	Number n;</span><br><span class="line">	Number n1;</span><br><span class="line">	n.print();</span><br><span class="line">	n = n + n1;</span><br><span class="line">	n.print();</span><br><span class="line">	printf(&quot;Hello World!\n&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">. :: ?: sizeof # 不能重载</span><br><span class="line">运算符重载就是函数替换</span><br><span class="line">常用的运算符重载 &lt; &gt; == =</span><br></pre></td></tr></table></figure>
<p>定义一个类使用友元函数实现重载 operator</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303155110456.png" alt="image-20230303155110456"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303155158528.png" alt="image-20230303155158528"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">可实现对不同类的操作，不使用友元一定会对<span class="keyword">this</span>操作</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Number</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="type">int</span> x;</span><br><span class="line">	<span class="type">int</span> y;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Number</span>();</span><br><span class="line">	<span class="built_in">Number</span>(<span class="type">int</span> x, <span class="type">int</span> y);</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 1</span></span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>++(Number&amp; p1);</span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>--(Number&amp; p1);</span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>+(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>-(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>*(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> Number <span class="keyword">operator</span>/(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&gt;(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&gt;=(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="keyword">friend</span> <span class="type">bool</span> <span class="keyword">operator</span>&lt;=(Number&amp; p1, Number&amp; p2);</span><br><span class="line">	<span class="function"><span class="keyword">friend</span> <span class="type">void</span> <span class="title">print</span><span class="params">(Number&amp; p1)</span></span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">(Number&amp; p1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	std::cout &lt;&lt; p1.x &lt;&lt; <span class="string">&quot; &quot;</span> &lt;&lt; p1.y &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number::<span class="built_in">Number</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;x = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">this</span>-&gt;y = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number::<span class="built_in">Number</span>(<span class="type">int</span> x, <span class="type">int</span> y)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;x = x;</span><br><span class="line">	<span class="keyword">this</span>-&gt;y = y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>++(Number&amp; p1)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x++;</span><br><span class="line">	p1.y++;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>--(Number&amp; p1)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x--;</span><br><span class="line">	p1.y--;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>+(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x += p2.x;</span><br><span class="line">	p1.y += p2.y;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>-(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x -= p2.x;</span><br><span class="line">	p1.y -= p2.y;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>*(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x *= p2.x;</span><br><span class="line">	p1.y *= p2.y;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Number <span class="keyword">operator</span>/(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	p1.x /= p2.x;</span><br><span class="line">	p1.y /= p2.y;</span><br><span class="line">	<span class="keyword">return</span> p1;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&gt;(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (p1.x &gt; p2.x &amp;&amp; p1.y &gt; p2.y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&lt;(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (p1.x &lt; p2.x &amp;&amp; p1.y &lt; p2.y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&gt;=(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (p1.x &gt;= p2.x &amp;&amp; p1.y &gt;= p2.y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="keyword">operator</span>&lt;=(Number&amp; p1, Number&amp; p2)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (p1.x &lt;= p2.x &amp;&amp; p1.y &lt;= p2.y)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	Number n1;</span><br><span class="line">	<span class="built_in">print</span>(n1);</span><br><span class="line">	n1++;</span><br><span class="line">	<span class="built_in">print</span>(n1);</span><br><span class="line">	n1--;</span><br><span class="line">	<span class="built_in">print</span>(n1);</span><br><span class="line">	<span class="function">Number <span class="title">n2</span><span class="params">(<span class="number">10</span>,<span class="number">11</span>)</span></span>;</span><br><span class="line">	<span class="function">Number <span class="title">n3</span><span class="params">(<span class="number">100</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">	n2 = n2 + n3;</span><br><span class="line">	<span class="built_in">print</span>(n2);</span><br><span class="line">	n2 = n2 - n3;</span><br><span class="line">	<span class="built_in">print</span>(n2);</span><br><span class="line">	<span class="function">Number <span class="title">n4</span><span class="params">(<span class="number">100</span>, <span class="number">200</span>)</span></span>;</span><br><span class="line">	<span class="function">Number <span class="title">n5</span><span class="params">(<span class="number">10</span>, <span class="number">50</span>)</span></span>;</span><br><span class="line">	n4 = n4 / n5;</span><br><span class="line">	<span class="built_in">print</span>(n4);</span><br><span class="line">	n4 = n4 * n5;</span><br><span class="line">	<span class="built_in">print</span>(n4);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (n4 &gt; n5)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;both n4 x&amp;y &gt; n5 \n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (n4 &lt; n5)</span><br><span class="line">	&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;both n4 x&amp;y &lt; n5 \n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="new-delete"><a class="markdownIt-Anchor" href="#new-delete">#</a> new-delete</h3>
<p>静态库函数直接编译到 exe 里，dll 在自己模块里</p>
<p>找 call 时先找函数修改的内存空间，在看哪个 call 改写了这个空间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">malloc -&gt; _nh_malloc_dbg -&gt; _heap_alloc_dbg -&gt; _heap_alloc_base -&gt; HeapAlloc</span><br><span class="line">free -&gt; free_dbg -&gt; _free_base -&gt; HeapFree</span><br><span class="line">HeapAlloc 和 HeapFree 是Kernel32的 DLL</span><br><span class="line"></span><br><span class="line">new -&gt; _free_dbg -&gt; _nh_malloc_dbg -&gt; _heap_alloc_dbg -&gt; _heap_alloc_base -&gt; HeapAlloc</span><br><span class="line">delete -&gt; free_dbg -&gt; _free_base -&gt; HeapFree</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int* pi = new int;</span><br><span class="line">delete pi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">int* pi = new int(5);   //初始值为5的int</span><br><span class="line"></span><br><span class="line">Person* pa = new Person();</span><br><span class="line"></span><br><span class="line">int* i = new int[5];</span><br><span class="line">delete[] i;</span><br></pre></td></tr></table></figure>
<h3 id="vector"><a class="markdownIt-Anchor" href="#vector">#</a> Vector</h3>
<p>1、本质就是一个数组</p>
<p>2、可以动态扩充容量</p>
<p>3、支持下标方法，查询性能好</p>
<p>4、新增数据和删除数据较差</p>
<p>1、实现一个 Vector 类</p>
<p>2、读懂每一个方法的反汇编实现</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230304154132126.png" alt="image-20230304154132126"></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUCCESS 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MALLOC_ERROR -2   <span class="comment">//申请内存失败</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INDEX_ERROR -3     <span class="comment">//失败的索引号</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vector</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Vector</span>();</span><br><span class="line">	<span class="built_in">Vector</span>(DWORD dwSize);</span><br><span class="line">	~<span class="built_in">Vector</span>();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">DWORD <span class="title">at</span><span class="params">(DWORD dwIndex, OUT T * pEle)</span></span>;   <span class="comment">//根据给定的元素得到索引</span></span><br><span class="line">	<span class="function">DWORD <span class="title">push_back</span><span class="params">(T Element)</span></span>;    <span class="comment">//将元素存储到容器最后一个位置</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">pop_back</span><span class="params">()</span></span>;   <span class="comment">//删除最后一个元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">insert</span><span class="params">(DWORD dwIndex, T Element)</span></span>;  <span class="comment">//向指定位置新增一个元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">capacity</span><span class="params">()</span></span>;  <span class="comment">//返回在不增容的情况下还能存储多少元素</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;     <span class="comment">//清空所有元素</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">empty</span><span class="params">()</span></span>;    <span class="comment">//判断vector是否为空，返回true时为空</span></span><br><span class="line">	<span class="function">DWORD <span class="title">erase</span><span class="params">(DWORD dwIndex)</span></span>;  <span class="comment">//删除指定元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">size</span><span class="params">()</span></span>;  <span class="comment">//返回vector元素数量大小</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span>;   <span class="comment">//打印</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">expand</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	DWORD m_dwIndex;  <span class="comment">//下一个可用索引</span></span><br><span class="line">	DWORD m_dwIncrement; <span class="comment">//每次新增容大小</span></span><br><span class="line">	DWORD m_dwLen;   <span class="comment">//当前容器长度</span></span><br><span class="line">	DWORD m_dwInitSize;  <span class="comment">//默认初始化大小</span></span><br><span class="line">	T *m_pVector;  <span class="comment">//容器指针</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Vector&lt;T&gt;::<span class="built_in">Vector</span>():<span class="built_in">m_dwInitSize</span>(<span class="number">100</span>),<span class="built_in">m_dwIncrement</span>(<span class="number">5</span>)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//int* i = new int[5];</span></span><br><span class="line">	<span class="comment">//创建长度为m_dwInitSize个T对象</span></span><br><span class="line">	m_pVector = <span class="keyword">new</span> T[m_dwInitSize];</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(m_pVector, <span class="number">0</span>, m_dwInitSize * <span class="built_in">sizeof</span>(T));</span><br><span class="line">	<span class="comment">//设置其他值</span></span><br><span class="line">	m_dwIndex = <span class="number">0</span>;</span><br><span class="line">	m_dwLen = m_dwInitSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Vector&lt;T&gt;::<span class="built_in">Vector</span>(DWORD dwSize)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//创建长度为dwSize个T对象</span></span><br><span class="line">	m_pVector = <span class="keyword">new</span> T[dwSize];</span><br><span class="line">	<span class="comment">//初始化</span></span><br><span class="line">	<span class="built_in">memset</span>(m_pVector, <span class="number">0</span>, dwSize * <span class="built_in">sizeof</span>(T));</span><br><span class="line">	<span class="comment">//设置其他值</span></span><br><span class="line">	m_dwIndex = <span class="number">0</span>;</span><br><span class="line">	m_dwLen = dwSize;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">Vector&lt;T&gt;::~<span class="built_in">Vector</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">delete</span>[] m_pVector;</span><br><span class="line">	m_pVector = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">at</span>(DWORD dwIndex, OUT T* pEle)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断索引是否越界</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex &lt; <span class="number">0</span> || dwIndex &gt; m_dwIndex)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//复制到pEle中</span></span><br><span class="line">	<span class="built_in">memcpy</span>(pEle, &amp;m_pVector[dwIndex], <span class="built_in">sizeof</span>(T));</span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">push_back</span>(T Element)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断是否需要增容</span></span><br><span class="line">	<span class="keyword">if</span> (m_dwIndex &gt;= m_dwLen)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">expand</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//复制到最后一个位置</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_pVector[m_dwIndex], &amp;Element, <span class="built_in">sizeof</span>(T));</span><br><span class="line">	m_dwIndex++;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Vector&lt;T&gt;::<span class="built_in">pop_back</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">memset</span>(&amp;m_pVector[m_dwLen - <span class="number">1</span>], <span class="number">0</span>, <span class="built_in">sizeof</span>(T));</span><br><span class="line">	m_dwIndex--;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">insert</span>(DWORD dwIndex, T Element)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断合理区间</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex&lt;<span class="number">0</span> || dwIndex&gt;m_dwIndex)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//判断是否需要增容，如果需要就调用增容的函数										</span></span><br><span class="line">	<span class="keyword">if</span> (m_dwIndex &gt;= m_dwLen)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">expand</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//后移</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = m_dwIndex; i &gt; dwIndex; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;m_pVector[i], &amp;m_pVector[i<span class="number">-1</span>], <span class="built_in">sizeof</span>(T));</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//复制</span></span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;m_pVector[dwIndex], &amp;Element, <span class="built_in">sizeof</span>(T));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//修改其他值</span></span><br><span class="line">	m_dwIndex++;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">capacity</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> m_dwLen - m_dwIndex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Vector&lt;T&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">memset</span>(m_pVector, <span class="number">0</span>, <span class="built_in">sizeof</span>(T) * m_dwLen);</span><br><span class="line">	m_dwIndex = <span class="number">0</span>;</span><br><span class="line">	m_dwLen = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> Vector&lt;T&gt;::<span class="built_in">empty</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (m_dwLen == <span class="number">0</span> &amp; m_dwIndex == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">erase</span>(DWORD dwIndex)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (dwIndex &gt; m_dwIndex &amp;&amp; dwIndex &lt; <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = dwIndex; i &lt; m_dwLen; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;m_pVector[i], &amp;m_pVector[i + <span class="number">1</span>], <span class="built_in">sizeof</span>(T));</span><br><span class="line">	&#125;</span><br><span class="line">	m_dwIndex--;</span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD Vector&lt;T&gt;::<span class="built_in">size</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">return</span> m_dwLen;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> Vector&lt;T&gt;::<span class="built_in">print</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; m_dwLen; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; m_pVector[i] &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> Vector&lt;T&gt;::<span class="built_in">expand</span>()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	T* newPointer = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="comment">//计算增加后的长度</span></span><br><span class="line">	DWORD newLen = m_dwIncrement + m_dwLen;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//申请空间</span></span><br><span class="line">	newPointer = <span class="keyword">new</span> T[newLen];</span><br><span class="line">	<span class="built_in">memset</span>(newPointer, <span class="number">0</span>, <span class="built_in">sizeof</span>(T)*newLen);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//数据复制到新空间</span></span><br><span class="line">	<span class="built_in">memcpy</span>(newPointer, m_pVector, <span class="built_in">sizeof</span>(T)*m_dwLen);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//释放原来空间</span></span><br><span class="line">	<span class="keyword">delete</span>[] m_pVector;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//属性赋值</span></span><br><span class="line">	m_pVector = newPointer;</span><br><span class="line">	newPointer = <span class="literal">NULL</span>;</span><br><span class="line">	m_dwLen = newLen;</span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> 0</span></span><br><span class="line">	<span class="keyword">if</span> (m_dwIndex &gt;= m_dwLen) </span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//创建一个新容器</span></span><br><span class="line">		T* p = <span class="keyword">new</span> T[m_dwLen + m_dwIncrement];</span><br><span class="line">		<span class="comment">//复制原来容器元素到新容器</span></span><br><span class="line">		<span class="built_in">memcpy</span>(p, m_pVector, <span class="built_in">sizeof</span>(T)*m_dwLen);</span><br><span class="line">		<span class="comment">//删除原数据</span></span><br><span class="line">		<span class="keyword">delete</span>[] m_pVector;</span><br><span class="line">		m_pVector = p;</span><br><span class="line">		m_dwLen = m_dwLen + m_dwIncrement;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;当前容量充足&quot;</span>);</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="function">Vector&lt;<span class="type">int</span>&gt; <span class="title">haha</span><span class="params">(<span class="number">5</span>)</span></span>;</span><br><span class="line">	<span class="comment">//for (size_t i = 0; i &lt; haha.size(); i++)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	haha.insert(i, i);</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//haha.print();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//int p = 0;</span></span><br><span class="line">	<span class="comment">//haha.at(50, &amp;p);</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; p &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//cout &lt;&lt;haha.capacity() &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//haha.erase(90);</span></span><br><span class="line">	<span class="comment">//haha.erase(91);</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; haha.capacity() &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="comment">//haha.print();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//if (haha.empty() == 1)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; &quot;empty!\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//else</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; &quot;not empty\n&quot;;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//haha.clear();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//if (haha.empty() == 1)</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; &quot;empty!\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line">	<span class="comment">//else</span></span><br><span class="line">	<span class="comment">//&#123;</span></span><br><span class="line">	<span class="comment">//	cout &lt;&lt; &quot;not empty\n&quot;;</span></span><br><span class="line">	<span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//haha.clear();</span></span><br><span class="line">	haha.<span class="built_in">push_back</span>(<span class="number">5</span>);</span><br><span class="line">	haha.<span class="built_in">push_back</span>(<span class="number">4</span>);</span><br><span class="line">	haha.<span class="built_in">push_back</span>(<span class="number">3</span>);</span><br><span class="line">	haha.<span class="built_in">push_back</span>(<span class="number">2</span>);</span><br><span class="line">	haha.<span class="built_in">push_back</span>(<span class="number">1</span>);</span><br><span class="line">	<span class="comment">//haha.print();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//haha.print();</span></span><br><span class="line">	<span class="comment">//haha.pop_back();</span></span><br><span class="line">	<span class="comment">//haha.print();</span></span><br><span class="line"></span><br><span class="line">	cout &lt;&lt; haha.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	haha.<span class="built_in">insert</span>(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line">	cout &lt;&lt; haha.<span class="built_in">size</span>() &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">	haha.<span class="built_in">print</span>();</span><br><span class="line"></span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;Hello World!\n&quot;</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="链表"><a class="markdownIt-Anchor" href="#链表">#</a> 链表</h3>
<p>1、数据分散存储</p>
<p>2、查询性能没有 Vector 好</p>
<p>3、新增与删除的性能好于 Vector</p>
<p>单链表，循环链表，双向链表</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;malloc.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUCCESS 1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INDEX_ERROR -2    <span class="comment">//失败的索引号</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> BUFFER_ERROR -3   <span class="comment">//申请内存失败</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LinkList</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">LinkList</span>();</span><br><span class="line">	~<span class="built_in">LinkList</span>();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;  <span class="comment">//是否为空，空1 非空0</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">()</span></span>;   <span class="comment">//清空链表</span></span><br><span class="line">	<span class="function">DWORD <span class="title">GetElement</span><span class="params">(IN DWORD dwIndex, OUT T&amp; Element)</span></span>;    <span class="comment">//根据索引获取元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">GetElementIndex</span><span class="params">(IN T&amp; Element)</span></span>;    <span class="comment">//根据元素获取索引</span></span><br><span class="line">	<span class="function">DWORD <span class="title">Insert</span><span class="params">(IN T Element)</span></span>;     <span class="comment">//新增元素到最后</span></span><br><span class="line">	<span class="function">DWORD <span class="title">Insert</span><span class="params">(IN DWORD dwIndex, IN T Element)</span></span>;    <span class="comment">//根据索引新增元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">Delete</span><span class="params">(IN DWORD dwIndex)</span></span>;    <span class="comment">//根据索引删除元素</span></span><br><span class="line">	<span class="function">DWORD <span class="title">GetSize</span><span class="params">()</span></span>;    <span class="comment">//获取链表元素数量</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Print</span><span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">_NODE</span></span><br><span class="line">	&#123;</span><br><span class="line">		T  Data;</span><br><span class="line">		_NODE *pNext;</span><br><span class="line">	&#125;NODE, *PNODE;</span><br><span class="line">	<span class="comment">//PNODE GetIndexCurrentNode(DWORD dwIndex); //获取索引为dwIndex的指针</span></span><br><span class="line">	<span class="comment">//PNODE GetIndexPreviousNode(DWORD dwIndex); //获取索引为dwIndex的前一个节点指针</span></span><br><span class="line">	<span class="comment">//PNODE GetIndexNextNode(DWORD dwIndex); //获取索引为dwIndex的后一个节点指针</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	PNODE m_pList;						<span class="comment">//链表头指针，指向第一个节点				</span></span><br><span class="line">	DWORD m_dwLength;						<span class="comment">//元素的数量		</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">LinkList&lt;T&gt;::<span class="built_in">LinkList</span>():<span class="built_in">m_pList</span>(<span class="literal">NULL</span>),<span class="built_in">m_dwLength</span>(<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">LinkList&lt;T&gt;::~<span class="built_in">LinkList</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">clear</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> LinkList&lt;T&gt;::<span class="built_in">IsEmpty</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断头结点</span></span><br><span class="line">	<span class="keyword">if</span> (m_pList == <span class="literal">NULL</span> || m_dwLength == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;invalid index\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkList&lt;T&gt;::<span class="built_in">clear</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//判断链表是否非空</span></span><br><span class="line">	<span class="built_in">IsEmpty</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">//循环删除节点</span></span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line">	PNODE pdeleteNode = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; m_dwLength; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		pdeleteNode = ptempNode;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line">		<span class="keyword">delete</span> pdeleteNode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//删除最后一个二节点，长度置0</span></span><br><span class="line">	m_dwLength = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">GetElement</span>(IN DWORD dwIndex, OUT T &amp; Element) <span class="comment">//根据索引获取元素</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span> (dwIndex &lt;<span class="number">0</span> || dwIndex &gt; m_dwLength)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;index out of range\n&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line">	DWORD data = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; dwIndex; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line">	&#125;</span><br><span class="line">	data = ptempNode-&gt;Data;</span><br><span class="line">	Element = data;</span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">GetElementIndex</span>(IN T &amp; Element)</span><br><span class="line">&#123;</span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (m_pList == <span class="literal">NULL</span> || m_dwLength == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;invalid index\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; m_dwLength; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//memcmp(ptempNode,Element,sizeof(T))</span></span><br><span class="line">		<span class="keyword">if</span> (ptempNode-&gt;Data == Element)</span><br><span class="line">		&#123;</span><br><span class="line">			Element == ptempNode-&gt;Data;</span><br><span class="line">			<span class="keyword">return</span> i;</span><br><span class="line">		&#125;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ERROR;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">Insert</span>(IN T Element)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//有元素，遍历到最后一个</span></span><br><span class="line">	PNODE pNewnode = <span class="keyword">new</span> NODE;</span><br><span class="line">	<span class="built_in">memset</span>(pNewnode, <span class="number">0</span>, <span class="built_in">sizeof</span>(NODE));</span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;pNewnode-&gt;Data, &amp;Element, <span class="built_in">sizeof</span>(T));</span><br><span class="line"></span><br><span class="line">	<span class="comment">//是否为空,空就往头结点后面插</span></span><br><span class="line">	<span class="keyword">if</span> (m_pList == <span class="literal">NULL</span> || m_dwLength == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		m_pList = pNewnode;</span><br><span class="line">		m_dwLength++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//不为空</span></span><br><span class="line">	PNODE ptempNode = m_pList;   <span class="comment">//保存头指针</span></span><br><span class="line">	<span class="comment">//while(ptempNode-&gt;next != NULL)</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; m_dwLength<span class="number">-1</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">	ptempNode-&gt;pNext = pNewnode;</span><br><span class="line">	pNewnode-&gt;pNext = <span class="literal">NULL</span>;</span><br><span class="line">	m_dwLength++;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">Insert</span>(IN DWORD dwIndex, IN T Element)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">	PNODE pNewnode = <span class="keyword">new</span> NODE;</span><br><span class="line">	<span class="built_in">memset</span>(pNewnode, <span class="number">0</span>, <span class="built_in">sizeof</span>(PNODE));</span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;pNewnode-&gt;Data, &amp;Element, <span class="built_in">sizeof</span>(T));</span><br><span class="line">	<span class="comment">//判断是否为空,即此时链表为空，要往第1个位置插</span></span><br><span class="line">	<span class="keyword">if</span> (m_pList == <span class="literal">NULL</span> || m_dwLength == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (dwIndex == <span class="number">0</span>)</span><br><span class="line">		&#123;</span><br><span class="line">			m_pList = pNewnode;</span><br><span class="line">			m_dwLength++;</span><br><span class="line">			<span class="keyword">return</span> SUCCESS;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//是否索引有效</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex &lt;<span class="number">0</span> || dwIndex &gt; m_dwLength)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;index out of range\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="comment">//如果索引为0，即链表不为空，但想往第一个位置插</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		pNewnode-&gt;pNext = m_pList;</span><br><span class="line">		m_pList = pNewnode;</span><br><span class="line"></span><br><span class="line">		m_dwLength++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dwIndex == m_dwLength)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//如果索引为链表尾，即链表不为空，但要往最后一个插</span></span><br><span class="line">		<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; m_dwLength - <span class="number">1</span>; i++)</span><br><span class="line">		&#123;</span><br><span class="line">			ptempNode = ptempNode-&gt;pNext;</span><br><span class="line">		&#125;</span><br><span class="line">		ptempNode-&gt;pNext = pNewnode;</span><br><span class="line">		pNewnode-&gt;pNext = <span class="literal">NULL</span>;</span><br><span class="line">		m_dwLength++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果索引为链表中</span></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; dwIndex<span class="number">-1</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;  <span class="comment">//循环到前一个节点</span></span><br><span class="line">	&#125;</span><br><span class="line">	ptempNode-&gt;pNext = pNewnode;  <span class="comment">//把前一个节点和新节点相连</span></span><br><span class="line">	pNewnode-&gt;pNext = ptempNode-&gt;pNext-&gt;pNext;  <span class="comment">//新节点和原来的next相连</span></span><br><span class="line">	m_dwLength++;</span><br><span class="line">	<span class="comment">// 1 2 3   5  6</span></span><br><span class="line">	<span class="comment">//       4</span></span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">Delete</span>(IN DWORD dwIndex)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">//  1. 判断链表是否为空	</span></span><br><span class="line">	<span class="keyword">if</span> (m_pList == <span class="literal">NULL</span> || m_dwLength == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span> ERROR;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  2. 判断索引值是否有效</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex &lt;<span class="number">0</span> || dwIndex &gt; m_dwLength)</span><br><span class="line">	&#123;</span><br><span class="line">		cout &lt;&lt; <span class="string">&quot;index out of range\n&quot;</span>;</span><br><span class="line">		<span class="keyword">return</span> INDEX_ERROR;</span><br><span class="line">	&#125;</span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line">	<span class="comment">//  3. 如果链表中只有头节点，且要删除头节点			</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex == <span class="number">0</span> &amp;&amp; m_dwLength == <span class="number">1</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">delete</span> m_pList;</span><br><span class="line">		m_pList = <span class="literal">NULL</span>;</span><br><span class="line">		m_dwLength--;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//  4. 如果要删除头节点		</span></span><br><span class="line">	<span class="keyword">if</span> (dwIndex == <span class="number">0</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">//H 1 2 3 4 5</span></span><br><span class="line">		<span class="keyword">delete</span> m_pList;</span><br><span class="line">		m_pList = ptempNode-&gt;pNext;</span><br><span class="line">		m_dwLength--;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  5. 如果是其他情况</span></span><br><span class="line">	ptempNode = m_pList;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; dwIndex<span class="number">-1</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// H 1 2 3 4 5</span></span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line">	&#125;</span><br><span class="line">	ptempNode-&gt;pNext = ptempNode-&gt;pNext-&gt;pNext;</span><br><span class="line">	<span class="keyword">delete</span> ptempNode-&gt;pNext;</span><br><span class="line"></span><br><span class="line">	m_dwLength--;</span><br><span class="line">	<span class="keyword">return</span> SUCCESS;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD LinkList&lt;T&gt;::<span class="built_in">GetSize</span>()</span><br><span class="line">&#123;</span><br><span class="line">	DWORD size = <span class="number">0</span>;</span><br><span class="line">	PNODE ptempNode = m_pList;</span><br><span class="line">	<span class="keyword">while</span> (ptempNode != <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		ptempNode = ptempNode-&gt;pNext;</span><br><span class="line">		size++;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> LinkList&lt;T&gt;::<span class="built_in">Print</span>()</span><br><span class="line">&#123;</span><br><span class="line">	PNODE pTempNode = m_pList;</span><br><span class="line">	<span class="keyword">for</span> (DWORD i = <span class="number">0</span>; i &lt; m_dwLength; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pTempNode-&gt;Data);</span><br><span class="line">		pTempNode = pTempNode-&gt;pNext;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//LinkList&lt;int&gt; Link;</span></span><br><span class="line">	<span class="comment">//Link.Insert(0,9);</span></span><br><span class="line">	<span class="comment">//Link.Insert(1,8);</span></span><br><span class="line">	<span class="comment">//Link.Insert(7);</span></span><br><span class="line">	<span class="comment">//Link.Insert(6);</span></span><br><span class="line">	<span class="comment">//9 8 7 6</span></span><br><span class="line">	<span class="comment">//int x = 6;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; Link.GetElementIndex(x) &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; Link.GetSize() &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//int w;</span></span><br><span class="line">	<span class="comment">//Link.GetElement(3,w);</span></span><br><span class="line">	<span class="comment">//cout &lt;&lt; w &lt;&lt; &quot;\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Link.Delete(2);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Link.Print();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Link.Delete(0);</span></span><br><span class="line">	<span class="comment">//Link.Print();</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//bool haha = IsEmpty();</span></span><br><span class="line">	<span class="comment">//if(haha == true) cout &lt;&lt; &quot;empty\n&quot;;</span></span><br><span class="line">	<span class="comment">//else cout &lt;&lt; &quot;not empty\n&quot;;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//Link.clear();</span></span><br><span class="line">	<span class="comment">//Link.Print();</span></span><br><span class="line"></span><br><span class="line">	LinkList&lt;<span class="type">int</span>&gt;* shabi = <span class="keyword">new</span> LinkList&lt;<span class="type">int</span>&gt;;</span><br><span class="line">	shabi-&gt;<span class="built_in">Insert</span>(<span class="number">0</span>,<span class="number">9</span>);</span><br><span class="line">	shabi-&gt;<span class="built_in">Insert</span>(<span class="number">1</span>,<span class="number">8</span>);</span><br><span class="line">	shabi-&gt;<span class="built_in">Insert</span>(<span class="number">7</span>);</span><br><span class="line">	shabi-&gt;<span class="built_in">Insert</span>(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//shabi-&gt;Print();</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">	shabi-&gt;<span class="built_in">Delete</span>(<span class="number">2</span>);</span><br><span class="line">	<span class="comment">//shabi-&gt;Print();</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	shabi-&gt;<span class="built_in">clear</span>();</span><br><span class="line">	<span class="comment">//shabi-&gt;Print();</span></span><br><span class="line">	cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">&quot;Hello World!\n&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="二叉树"><a class="markdownIt-Anchor" href="#二叉树">#</a> 二叉树</h3>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307171158951.png" alt="image-20230307171158951"></p>
<p>前序遍历</p>
<p>​	根左右</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G D A F E M H Z</span><br></pre></td></tr></table></figure>
<p>中序遍历</p>
<p>​	左根右</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>后序遍历</p>
<p>​	左右根</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307171937417.png" alt="image-20230307171937417"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;windows.h&quot;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &quot;stdlib.h&quot;</span><br><span class="line">#include &quot;malloc.h&quot;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">#define SUCCESS           			  1 // 执行成功	</span><br><span class="line">#define ERRORR						 -1 // 执行失败	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//基础怪物模板</span><br><span class="line">class Monster &#123;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">	int Id;  //怪物编号</span><br><span class="line">	char Name[20];//名字</span><br><span class="line">	int Level;//等级</span><br><span class="line">public:</span><br><span class="line">	Monster() &#123;&#125;;//构造 ,默认怪物</span><br><span class="line">	Monster(int Id, char* Name, int Level);   //怪物参数</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Monster::Monster(int Id, char* Name, int Level) </span><br><span class="line">&#123;</span><br><span class="line">	this-&gt;Id = Id;</span><br><span class="line">	this-&gt;Level = Level;</span><br><span class="line">	memcpy(&amp;this-&gt;Name, Name, strlen(Name) + 1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">class TreeNode &#123;</span><br><span class="line">public:</span><br><span class="line">	T element; //节点数据</span><br><span class="line">	TreeNode&lt;T&gt;* pLeft; //左树指针</span><br><span class="line">	TreeNode&lt;T&gt;* pRight;//右树指针</span><br><span class="line"></span><br><span class="line">	TreeNode(T&amp; ele) &#123;</span><br><span class="line">		//初始化node节点</span><br><span class="line">		memset(&amp;element, 0, sizeof(TreeNode));</span><br><span class="line">		//为元素复制</span><br><span class="line">		memcpy(&amp;element, &amp;ele, sizeof(T));</span><br><span class="line">		pLeft = pRight = NULL;</span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">class BsortTree &#123;</span><br><span class="line">public:</span><br><span class="line">	BsortTree();</span><br><span class="line">	~BsortTree();</span><br><span class="line">public:</span><br><span class="line">	void InOrderTraverse(TreeNode&lt;T&gt;* pNode); //中序遍历</span><br><span class="line">	void PreOrderTraverse(TreeNode&lt;T&gt;* pNode);//前序遍历</span><br><span class="line">	void PostOrderTraverse(TreeNode&lt;T&gt;* pNode);//后序遍历</span><br><span class="line">	TreeNode&lt;T&gt;* GetRoot();//返回根节点</span><br><span class="line">	int GetDepth(TreeNode&lt;T&gt;* Node);// 返回当前节点高度</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">	void Init();//初始化一些数值</span><br><span class="line">	void Destroy(TreeNode&lt;T&gt;* Node);</span><br><span class="line">private:</span><br><span class="line">	TreeNode&lt;T&gt;* pRootNode; //根节点指针</span><br><span class="line">	int size;//树中元素总数</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">void BsortTree&lt;T&gt;::Init()</span><br><span class="line">&#123;</span><br><span class="line">	Monster m1(1, (char*)&quot;AAA&quot;, 50);</span><br><span class="line">	Monster m2(2, (char*)&quot;BBB&quot;, 100);</span><br><span class="line">	Monster m3(3, (char*)&quot;CCC&quot;, 74);</span><br><span class="line">	Monster m4(4, (char*)&quot;DDD&quot;, 56);</span><br><span class="line">	Monster m5(5, (char*)&quot;EEE&quot;, 88);</span><br><span class="line">	Monster m6(6, (char*)&quot;FFF&quot;, 999);</span><br><span class="line">	Monster m7(7, (char*)&quot;GGG&quot;, 7);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n1 = new TreeNode&lt;Monster&gt;(m1);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n2 = new TreeNode&lt;Monster&gt;(m2);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n3 = new TreeNode&lt;Monster&gt;(m3);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n4 = new TreeNode&lt;Monster&gt;(m4);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n5 = new TreeNode&lt;Monster&gt;(m5);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n6 = new TreeNode&lt;Monster&gt;(m6);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n7 = new TreeNode&lt;Monster&gt;(m7);</span><br><span class="line"></span><br><span class="line">	pRootNode = n5;</span><br><span class="line">	n5-&gt;pLeft = n4;</span><br><span class="line">	n5-&gt;pRight = n6;</span><br><span class="line">	n4-&gt;pLeft = n1;</span><br><span class="line">	n1-&gt;pRight = n2;</span><br><span class="line">	n6-&gt;pLeft = n3;</span><br><span class="line">	n3-&gt;pRight = n7;</span><br><span class="line">	size = 7;</span><br><span class="line">		//						5</span><br><span class="line">		//			4									6</span><br><span class="line">		//1									3</span><br><span class="line">		//		2									7</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">void BsortTree&lt;T&gt;::Destroy(TreeNode&lt;T&gt;* pNode)</span><br><span class="line">&#123;</span><br><span class="line">	if (pNode == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		Destroy(pNode-&gt;pLeft);</span><br><span class="line">		Destroy(pNode-&gt;pRight);</span><br><span class="line">		delete pNode;</span><br><span class="line">		pNode = NULL;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">BsortTree&lt;T&gt;::BsortTree() &#123;</span><br><span class="line">	Init();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">BsortTree&lt;T&gt;::~BsortTree()</span><br><span class="line">&#123;</span><br><span class="line">	//释放所有节点空间</span><br><span class="line">	Destroy(pRootNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 返回当前节点高度Node</span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">int BsortTree&lt;T&gt;::GetDepth(TreeNode&lt;T&gt;* Node) &#123;</span><br><span class="line">	if (Node == NULL) &#123;</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line">	else</span><br><span class="line">	&#123;</span><br><span class="line">		int Left = GetDepth(Node-&gt;pLeft);</span><br><span class="line">		int Right = GetDepth(Node-&gt;pRight);</span><br><span class="line">		return (Left &gt; Right) ? (Left + 1) : (Right + 1);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//获取根节点</span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::GetRoot() </span><br><span class="line">&#123;</span><br><span class="line">	return pRootNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//中序遍历</span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">void BsortTree&lt;T&gt;::InOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class="line">&#123;</span><br><span class="line">	//列出怪的名字</span><br><span class="line">	if (pNode == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	InOrderTraverse(pNode-&gt;pLeft);</span><br><span class="line">	cout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	InOrderTraverse(pNode-&gt;pRight);</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//前序遍历</span><br><span class="line">template&lt;class T&gt;//前序遍历</span><br><span class="line">void BsortTree&lt;T&gt;::PreOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class="line">&#123;</span><br><span class="line">	if (pNode == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	cout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	PreOrderTraverse(pNode-&gt;pLeft);</span><br><span class="line">	PreOrderTraverse(pNode-&gt;pRight);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//后序遍历</span><br><span class="line">template&lt;class T&gt;</span><br><span class="line">void BsortTree&lt;T&gt;::PostOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class="line">&#123;</span><br><span class="line">	if (pNode == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		return;</span><br><span class="line">	&#125;</span><br><span class="line">	PostOrderTraverse(pNode-&gt;pLeft);</span><br><span class="line">	PostOrderTraverse(pNode-&gt;pRight);</span><br><span class="line">	cout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void test()</span><br><span class="line">&#123;</span><br><span class="line">	BsortTree&lt;Monster&gt;* p = new BsortTree&lt;Monster&gt;();</span><br><span class="line">	p-&gt;InOrderTraverse(p-&gt;GetRoot());</span><br><span class="line">	p-&gt;PostOrderTraverse(p-&gt;GetRoot());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">	test();</span><br><span class="line">    std::cout &lt;&lt; &quot;Hello World!\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>搜索二叉树</p>
<p>1. 有很好的查询性能</p>
<p>2. 有很好的新增和删除性能</p>
<p>3. 若左子树不空，则左子树上所有结点的值均小于它的根结点的值</p>
<p>即 左小右大</p>
<p>搜索二叉树中序遍历后就是排序后的结果</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308170011973.png" alt="image-20230308170011973"></p>
<p>删除叶子节点，直接删</p>
<p>删除节点只有一个子树，直接把下面节点提上去</p>
<p>既有左也有右，用右子树最小节点取代原节点，递归删除最小节点   、 或者左边最大</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;windows.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SUCCESS           			  1 <span class="comment">// 执行成功	</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ERRORR			 -1 <span class="comment">// 执行失败	</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//基础怪物模板</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Monster</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="type">int</span> Id;  <span class="comment">//怪物编号</span></span><br><span class="line">	<span class="type">char</span> Name[<span class="number">20</span>];<span class="comment">//名字</span></span><br><span class="line">	<span class="type">int</span> Level;<span class="comment">//等级</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">Monster</span>() &#123;&#125;;<span class="comment">//构造 ,默认怪物</span></span><br><span class="line">	<span class="built_in">Monster</span>(<span class="type">int</span> Id, <span class="type">char</span>* Name, <span class="type">int</span> Level);   <span class="comment">//怪物参数</span></span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> Monster::<span class="keyword">operator</span>&lt;(<span class="type">const</span> Monster&amp; p) &#123;</span><br><span class="line">		<span class="keyword">return</span>  <span class="keyword">this</span>-&gt;Id &lt; p.Id ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">bool</span> Monster::<span class="keyword">operator</span>&gt;(<span class="type">const</span> Monster&amp; p) &#123;</span><br><span class="line">		<span class="keyword">return</span>  <span class="keyword">this</span>-&gt;Id &gt; p.Id ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">bool</span> Monster::<span class="keyword">operator</span>==(<span class="type">const</span> Monster&amp; p) &#123;</span><br><span class="line">		<span class="keyword">return</span>   <span class="keyword">this</span>-&gt;Id == p.Id ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Monster::<span class="built_in">Monster</span>(<span class="type">int</span> Id, <span class="type">char</span>* Name, <span class="type">int</span> Level) &#123;</span><br><span class="line">	<span class="keyword">this</span>-&gt;Id = Id;</span><br><span class="line">	<span class="built_in">memcpy</span>(&amp;<span class="keyword">this</span>-&gt;Name, Name, <span class="built_in">strlen</span>(Name)+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">this</span>-&gt;Level=Level;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	T element; <span class="comment">//节点数据</span></span><br><span class="line">	TreeNode&lt;T&gt;* pLeft; <span class="comment">//左树指针</span></span><br><span class="line">	TreeNode&lt;T&gt;* pRight;<span class="comment">//右树指针</span></span><br><span class="line">	TreeNode&lt;T&gt;* pParent;<span class="comment">//父节点指针</span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">TreeNode</span>(T&amp; ele) &#123;</span><br><span class="line">		<span class="comment">//初始化</span></span><br><span class="line">		<span class="built_in">memset</span>(&amp;element, <span class="number">0</span>, <span class="built_in">sizeof</span>(TreeNode));</span><br><span class="line">		<span class="built_in">memcpy</span>(&amp;element, &amp;ele, <span class="built_in">sizeof</span>(T));</span><br><span class="line">		pLeft = pRight = <span class="literal">NULL</span>;</span><br><span class="line">			</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	bool operator&lt;(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class="line"><span class="comment">		return  this-&gt;element&lt;p-&gt;element  ? true : false;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	bool operator&gt;(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class="line"><span class="comment">		return this-&gt;element&gt;p-&gt;element ? true : false;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	bool operator==(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class="line"><span class="comment">		return this-&gt;element == p-&gt;element ? true : false;</span></span><br><span class="line"><span class="comment">	&#125;*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BsortTree</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">BsortTree</span>();</span><br><span class="line">	~<span class="built_in">BsortTree</span>();</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">InOrderTraverse</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>; <span class="comment">//中序遍历</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">PreOrderTraverse</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class="comment">//前序遍历</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">PostOrderTraverse</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class="comment">//后序遍历</span></span><br><span class="line">	<span class="function">TreeNode&lt;T&gt;* <span class="title">GetRoot</span><span class="params">()</span></span>;<span class="comment">//返回根节点</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">GetDepth</span><span class="params">(TreeNode&lt;T&gt;* Node)</span></span>;<span class="comment">// 返回当前节点高度</span></span><br><span class="line">	<span class="function"><span class="type">bool</span> <span class="title">IsEmpty</span><span class="params">()</span></span>;<span class="comment">//判断树是否为空</span></span><br><span class="line">	<span class="function">DWORD <span class="title">Insert</span><span class="params">(T element)</span></span>;<span class="comment">//新增节点</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Delete</span><span class="params">(T element)</span></span>;<span class="comment">//删除节点</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">Init</span><span class="params">()</span></span>;<span class="comment">//初始化一些数值</span></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">clear</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class="comment">//删除所有节点</span></span><br><span class="line">	<span class="function">DWORD <span class="title">InsertNode</span><span class="params">(TreeNode&lt;T&gt;* pNode, T element)</span></span>;</span><br><span class="line">	<span class="function">TreeNode&lt;T&gt;* <span class="title">DeleteNode</span><span class="params">(T element, TreeNode&lt;T&gt;* pNode)</span></span>;</span><br><span class="line">	<span class="function">TreeNode&lt;T&gt;* <span class="title">GetMinNode</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class="comment">//获取以pNode为根的最小节点，注：删除NODE下，寻找PNODE右树的最小节点顶到NODE节点上。再删除原最小节点</span></span><br><span class="line">	<span class="function">TreeNode&lt;T&gt;* <span class="title">GetMaxNode</span><span class="params">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class="comment">//获取以pNode为根的最大节点</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">	TreeNode&lt;T&gt;* pRootNode; <span class="comment">//根节点指针</span></span><br><span class="line">	<span class="type">int</span> size;<span class="comment">//树中元素总数</span></span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class="built_in">GetMinNode</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line">	TreeNode&lt;T&gt;* pMin = <span class="literal">NULL</span>;</span><br><span class="line">	<span class="keyword">if</span> (pNode!=<span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="type">int</span> data = pNode-&gt;element;<span class="comment">//说一下，这里为什么不用T类型，因为T代表整个类型大小，但是我们只需要NODE头4个字节的数据,这里有一点不通用，节点的头四个字节数据类型被限制了。</span></span><br><span class="line">		<span class="keyword">if</span> (data&gt;=pNode-&gt;element) &#123;</span><br><span class="line">			pMin = (TreeNode&lt;T&gt;*)pNode-&gt;element;<span class="comment">//把下一个比较小的节点存起来</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">GetMinNode</span>(pNode-&gt;pLeft); <span class="comment">//这里为什么用pNode-&gt;pLeft呢，因为根据左树节点比根树节点小。</span></span><br><span class="line">		<span class="keyword">return</span> pMin;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class="built_in">DeleteNode</span>(T element, TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line">	<span class="keyword">if</span> (pRootNode == <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (element == pNode-&gt;element)</span><br><span class="line">		&#123;</span><br><span class="line">		<span class="keyword">if</span> (pNode-&gt;pLeft != <span class="literal">NULL</span> &amp;&amp; pNode-&gt;pRight == <span class="literal">NULL</span>) </span><br><span class="line">		&#123;<span class="comment">//左子树</span></span><br><span class="line">			TreeNode&lt;T&gt;* pPt = pNode-&gt;pParent;<span class="comment">//拿到当前节点的父节点</span></span><br><span class="line">			pPt-&gt;pLeft = pNode-&gt;pLeft;</span><br><span class="line">			<span class="keyword">delete</span> pNode;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (pNode-&gt;pLeft = <span class="literal">NULL</span> &amp;&amp; pNode-&gt;pRight != <span class="literal">NULL</span>) </span><br><span class="line">		&#123;<span class="comment">//右子树</span></span><br><span class="line">			TreeNode&lt;T&gt;* pPt = pNode-&gt;pParent;<span class="comment">//拿到当前节点的父节点</span></span><br><span class="line">			pPt-&gt;pRight = pNode-&gt;pRight;</span><br><span class="line">			<span class="keyword">delete</span> pNode;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (pNode-&gt;pLeft == <span class="literal">NULL</span>&amp;&amp;pNode-&gt;pRight == <span class="literal">NULL</span>) </span><br><span class="line">		&#123;<span class="comment">//左右树均为空</span></span><br><span class="line">			TreeNode&lt;T&gt;* p;</span><br><span class="line">			p = pNode-&gt;pParent;</span><br><span class="line">			<span class="keyword">if</span> (p-&gt;pLeft != <span class="literal">NULL</span>&amp;&amp;p-&gt;pRight == <span class="literal">NULL</span>) &#123;<span class="comment">//这里实际意义就是看当前节点在父节点的左边还是右边</span></span><br><span class="line">				<span class="keyword">delete</span> p-&gt;pLeft;</span><br><span class="line">				p-&gt;pLeft = <span class="literal">NULL</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> (p-&gt;pLeft == <span class="literal">NULL</span>&amp;&amp;p-&gt;pRight != <span class="literal">NULL</span>) &#123;</span><br><span class="line">				<span class="keyword">delete</span> p-&gt;pRight;</span><br><span class="line">				p-&gt;pRight = <span class="literal">NULL</span>;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//</span></span><br><span class="line">			<span class="keyword">delete</span> p-&gt;pRight;</span><br><span class="line">			p-&gt;pRight = <span class="literal">NULL</span>;     <span class="comment">//这两行就是代表子节点一样，且不为空，删除哪个都一样。</span></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (pNode-&gt;pLeft != <span class="literal">NULL</span>&amp;&amp;pNode-&gt;pRight != <span class="literal">NULL</span>) &#123;<span class="comment">//左右子树均不为空</span></span><br><span class="line">			TreeNode&lt;T&gt;* pCurrent = pNode-&gt;pRight;</span><br><span class="line">			TreeNode&lt;T&gt;* pMin = <span class="built_in">GetMinNode</span>(pNode-&gt;pRight);<span class="comment">//GetMinNode是一个递归函数，返回NODE子树里的最小节点</span></span><br><span class="line">			pNode-&gt;element = (<span class="type">int</span>)pMin;<span class="comment">//把最小的节点元素抬到Pnode节点这里来</span></span><br><span class="line">			<span class="built_in">DeleteNode</span>(pNode-&gt;element, pCurrent);<span class="comment">//此时此刻，Pnode已经替换为最小节点的元素了，</span></span><br><span class="line">												 <span class="comment">//那么只需要删除pCurrent（pNode-&gt;pRight）下的子树最小节点就可以了，这里用的递归。</span></span><br><span class="line"></span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (element &gt; pNode-&gt;element) </span><br><span class="line">		&#123;<span class="comment">//Element 大于Pnode的E。那么就往Pnode右树开始找</span></span><br><span class="line">			<span class="built_in">DeleteNode</span>(element, pNode-&gt;pRight);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span></span><br><span class="line">		&#123;</span><br><span class="line">			<span class="built_in">DeleteNode</span>(element, pNode-&gt;pLeft);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">Delete</span>(T element) &#123;</span><br><span class="line">	<span class="built_in">DeleteNode</span>(T element, TreeNode&lt;T&gt;* pNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD BsortTree&lt;T&gt;::<span class="built_in">InsertNode</span>(TreeNode&lt;T&gt;* pNode, T element) &#123;</span><br><span class="line">	<span class="comment">//建立一个节点，把元素存进去</span></span><br><span class="line">	TreeNode&lt;T&gt;* pElement = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;T&gt;(element);</span><br><span class="line">	<span class="comment">//如果元素等于当前节点就直接返回</span></span><br><span class="line">	<span class="keyword">if</span> (pNode-&gt;element==element  ) &#123;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果pnode节点的左子节点为null且element&lt;pnode节点</span></span><br><span class="line">	<span class="keyword">if</span> (pNode-&gt;pLeft == <span class="literal">NULL</span> &amp;&amp; pNode-&gt;element&gt;element  ) &#123;</span><br><span class="line">		pNode-&gt;pLeft = pElement;</span><br><span class="line">		size++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//如果pnode节点的右子节点为null且element&gt;pnode节点</span></span><br><span class="line">	<span class="keyword">if</span> (pNode-&gt;pRight == <span class="literal">NULL</span>&amp;&amp;pNode-&gt;element&lt;element  ) &#123;</span><br><span class="line">		pNode-&gt;pRight = pElement;</span><br><span class="line">		size++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//pnode左节点不为空且element&lt;pnode节点----------此处为递归</span></span><br><span class="line">	<span class="keyword">if</span> (pNode-&gt;element&gt;element) &#123;</span><br><span class="line"></span><br><span class="line">		<span class="built_in">InsertNode</span>(pNode-&gt;pLeft, element);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">InsertNode</span>(pNode-&gt;pRight, element);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">DWORD BsortTree&lt;T&gt;::<span class="built_in">Insert</span>(T element) &#123;</span><br><span class="line">	<span class="keyword">if</span> (!pRootNode) &#123;<span class="comment">//如果根节点为空</span></span><br><span class="line">		pRootNode = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;T&gt;(element);</span><br><span class="line">		size++;</span><br><span class="line">		<span class="keyword">return</span> SUCCESS;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">InsertNode</span>(pRootNode, element);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">bool</span> BsortTree&lt;T&gt;::<span class="built_in">IsEmpty</span>() &#123;</span><br><span class="line">	<span class="keyword">return</span> size == <span class="number">0</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">BsortTree&lt;T&gt;::~<span class="built_in">BsortTree</span>() &#123;</span><br><span class="line">	<span class="comment">//循环删除节点元素</span></span><br><span class="line">	<span class="built_in">clear</span>(pRootNode);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">clear</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line">	<span class="keyword">if</span> (pNode != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">clear</span>(pNode-&gt;pLeft);</span><br><span class="line">		<span class="built_in">clear</span>(pNode-&gt;pRight);</span><br><span class="line">		<span class="keyword">delete</span> pNode;</span><br><span class="line">		pNode = <span class="literal">NULL</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line">BsortTree&lt;T&gt;::<span class="built_in">BsortTree</span>() &#123;</span><br><span class="line">	<span class="built_in">Init</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;<span class="comment">// 返回当前节点高度,Node</span></span><br><span class="line"><span class="type">int</span> BsortTree&lt;T&gt;::<span class="built_in">GetDepth</span>(TreeNode&lt;T&gt;* Node) &#123;</span><br><span class="line">	<span class="keyword">if</span> (Node == NUll) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">int</span> Left = <span class="built_in">GetDepth</span>(Node-&gt;pLeft);</span><br><span class="line">		<span class="type">int</span> Right = <span class="built_in">GetDepth</span>(Node-&gt;pRight);</span><br><span class="line">		<span class="keyword">return</span> (Left &gt; Right) ? (Left + <span class="number">1</span>) : (Right + <span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取根节点</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"> TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class="built_in">GetRoot</span>() &#123;</span><br><span class="line">	<span class="keyword">return</span> pRootNode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//中序遍历</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">InOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (pNode == <span class="literal">NULL</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">InOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pNode-&gt;element);</span><br><span class="line">		<span class="built_in">InOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//前序遍历</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;<span class="comment">//前序遍历</span></span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">PreOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line">	<span class="keyword">if</span> (pNode != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pNode-&gt;element);</span><br><span class="line">		<span class="built_in">PreOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class="line">		<span class="built_in">PreOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//后序遍历</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">PostOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class="line">	<span class="keyword">if</span> (pNode != <span class="literal">NULL</span>) &#123;</span><br><span class="line">		<span class="built_in">PostOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class="line">		<span class="built_in">PostOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pNode-&gt;element);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> <span class="title class_">T</span>&gt;</span><br><span class="line"><span class="type">void</span> BsortTree&lt;T&gt;::<span class="built_in">Init</span>() &#123;</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="function">Monster <span class="title">m1</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;混世魔王&quot;</span>,<span class="number">50</span>)</span></span>;</span><br><span class="line">	<span class="function">Monster <span class="title">m2</span><span class="params">(<span class="number">2</span>, <span class="string">&quot;金斯尔&quot;</span>, <span class="number">100</span>)</span></span>;</span><br><span class="line">	<span class="function">Monster <span class="title">m3</span><span class="params">(<span class="number">3</span>, <span class="string">&quot;游离&quot;</span>, <span class="number">74</span>)</span></span>;</span><br><span class="line">	<span class="function">Monster <span class="title">m4</span><span class="params">(<span class="number">4</span>, <span class="string">&quot;尔康&quot;</span>, <span class="number">56</span>)</span></span>;</span><br><span class="line">	<span class="function">Monster <span class="title">m5</span><span class="params">(<span class="number">5</span>, <span class="string">&quot;二讹&quot;</span>, <span class="number">88</span>)</span></span>;</span><br><span class="line">	<span class="function">Monster <span class="title">m6</span><span class="params">(<span class="number">6</span>, <span class="string">&quot;传奇&quot;</span>, <span class="number">999</span>)</span></span>;</span><br><span class="line">	TreeNode&lt;Monster&gt;* n1 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m1);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n2 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m2);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n3 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m3);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n4 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m4);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n5 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m5);</span><br><span class="line">	TreeNode&lt;Monster&gt;* n6 = <span class="keyword">new</span> <span class="built_in">TreeNode</span>&lt;Monster&gt;(m6);</span><br><span class="line"></span><br><span class="line">	pRootNode = n3;</span><br><span class="line">	n3-&gt;pLeft = n2;</span><br><span class="line">	n3-&gt;pRight = n1;</span><br><span class="line">	n1-&gt;pLeft = n4;</span><br><span class="line">	n1-&gt;pRight = n5;</span><br><span class="line">	<span class="comment">//n5-&gt;pRight = n6;</span></span><br><span class="line">	<span class="comment">//size = 6;</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 3</span></span><br><span class="line"><span class="comment">  2     1</span></span><br><span class="line"><span class="comment">      4    5</span></span><br><span class="line"><span class="comment">	          6</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>上面的代码参参考了<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQwODgzMi9hcnRpY2xlL2RldGFpbHMvMTE2NDY2MTM3">滴水二叉树实现详细注释_wow. 的博客 - CSDN 博客</span>的代码，实在写不出</p>
<h3 id="vectorlinklistbtree反汇编"><a class="markdownIt-Anchor" href="#vectorlinklistbtree反汇编">#</a> Vector，LinkList，Btree 反汇编</h3>
<h2 id="win32"><a class="markdownIt-Anchor" href="#win32">#</a> win32</h2>
<h3 id="宽字符"><a class="markdownIt-Anchor" href="#宽字符">#</a> 宽字符</h3>
<p>ASCII：0xxxxxxx</p>
<p>extend ASCII：0xxxxxxx-1xxxxxxx</p>
<p>GB2312：用两个字节存储一个汉字，最高位都是 1，可能乱码，因为可能不同国家都对他做了扩展，其次存储不方便</p>
<p>Unicode：解决乱码</p>
<p>乱码就是一个多个符号对应同一个编码</p>
<p>utf8/utf16: 变长的 Unicode</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//中ASCII d6 d0  unicode 4e 2d</span><br><span class="line">char x = &#x27;中&#x27;;    //产生截断D0</span><br><span class="line">wchar_t x1 = &#x27;中&#x27;;   //D0 D6,按照ASCII解析</span><br><span class="line">wchar_t x2 = L&#x27;中&#x27;;   //2d 4e按照Unicode解析</span><br><span class="line"></span><br><span class="line">char x[] = &quot;中国&quot;;  //使用扩展ASCII，以00(\n)结尾</span><br><span class="line">wchar_t x1[] = L&quot;中国&quot;;   //使用Unicode，结尾是00 00 (\0\0)</span><br><span class="line"></span><br><span class="line">printf(&quot;%s\n&quot;,x);</span><br><span class="line">wprintf(L&quot;%s\n&quot;,x1);</span><br><span class="line"></span><br><span class="line">#include &lt;locale.h&gt;</span><br><span class="line">int main &#123;</span><br><span class="line">	setlocale(LC_ALL,&quot;&quot;)</span><br><span class="line">&#125;//设置地域，这样才能正常打印</span><br><span class="line"></span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line">strlen(x)</span><br><span class="line">wcslen(x1);</span><br><span class="line"></span><br><span class="line">wcscpy(x1,x1);</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309190055917.png" alt="image-20230309190055917"></p>
<p>Win32 API  (应用程序接口)</p>
<p>主要存放在 windows/system32 下面所有的 DLL，是 Windows 提供的函数，供使用</p>
<p>Kernel32.dll: 最核心的功能模块，比如管理内存、进程和线程相关的函数等</p>
<p>User32.dll: 是 Windows 用户界面相关应用程序接口，如创建窗口和发送消息等.</p>
<p>GDI32.dll: 全称是 Graphical Device Interface (图形设备接口), 包含用于画图和显示文本的函数比如要显示一个程序窗口，就调用了其中的函数来画这个窗口</p>
<p>这些 dll 是一个 ring3 接口，通过这些 dll 调用内核函数，可以理解为 ring3 和 ring0 的接口</p>
<p>Windows 类型</p>
<p>CHAR</p>
<p>WCHAR</p>
<p>TCHAR 是个可变类型，取决于当前工程是宽字节还是窄字节</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CHAR cha[] = &quot;中国&quot;;</span><br><span class="line">WCHAR chw[] = L&quot;中国&quot;;</span><br><span class="line">TCHAR cht[] = TEXT(&quot;中国&quot;);</span><br></pre></td></tr></table></figure>
<p>LPSTR（PSTR）</p>
<p>LPTSTR（PTSTR）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PSTR pszChar[] = &quot;中国&quot;;</span><br><span class="line">PWSTR pszWChar[] = L&quot;中国&quot;;</span><br><span class="line">PTSTR pszTChar[] = TEXT(&quot;中国&quot;);</span><br></pre></td></tr></table></figure>
<p>Windows 内核函数都是 w 的，如果是 a 调用，系统会先转成 w 在调用。并且都是用 c 写的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MessageBox() 也是一个宏，根据当前项目决定使用a还是w</span><br></pre></td></tr></table></figure>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309192926826.png" alt="image-20230309192926826"></p>
<p>创建 win32application</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309193255058.png" alt="image-20230309193255058"></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdafx.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//APIENTRY = winapi = __stdcall</span></span><br><span class="line"><span class="type">int</span> APIENTRY <span class="title function_">WinMain</span><span class="params">(HINSTANCE hInstance,</span></span><br><span class="line"><span class="params">                     HINSTANCE hPrevInstance,</span></span><br><span class="line"><span class="params">                     LPSTR     lpCmdLine,</span></span><br><span class="line"><span class="params">                     <span class="type">int</span>       nCmdShow)</span></span><br><span class="line">&#123;</span><br><span class="line"> 	<span class="comment">// <span class="doctag">TODO:</span> Place code here.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//hinstance 就是imagebase,在setting-&gt;Link-&gt;output-&gt;base address,里面是十进制</span></span><br><span class="line"><span class="comment">//win32没有控制台，没法输出，要是用OutputDebugString()需要按照以下方法，新建一个类，在源文件中包含</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">.h</span><br><span class="line"><span class="type">void</span> __cdecl <span class="title function_">OutputDebugStringF</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format, ...)</span>;</span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> DEBUG</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DbgPrintf OutputDebugStringF</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> DbgPrintf</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// DEBUG </span></span></span><br><span class="line"></span><br><span class="line">.cpp</span><br><span class="line"><span class="type">void</span> __cdecl <span class="title function_">OutputDebugStringF</span><span class="params">(<span class="type">const</span> <span class="type">char</span>* format, ...)</span></span><br><span class="line">&#123;</span><br><span class="line">	va_list vlArgs;</span><br><span class="line">	<span class="type">char</span> *strBuffer = (<span class="type">char</span>*)GlobalAlloc(GPTR, <span class="number">4096</span>);</span><br><span class="line">	va_start(vlArgs, format);</span><br><span class="line">	_vsnprintf(strBuffer, <span class="number">4096</span> - <span class="number">1</span>, format, vlArgs);</span><br><span class="line">	va_end(vlArgs);</span><br><span class="line">	<span class="built_in">strcat</span>(strBuffer, <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">	OutputDebugStringF(strBuffer);</span><br><span class="line">	GlobalFree(strBuffer);</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">DWORD errors = GetLastError(); 放到出问题那行下面，得到错误编号</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR pCmdLine, int nCmdShow);</span><br><span class="line">hInstance 称为“实例句柄”或“模块句柄”。操作系统使用此值在内存中加载可执行文件时标识可执行文件 (EXE) 。 某些Windows函数需要实例句柄，例如加载图标或位图。</span><br><span class="line">hPrevInstance 没有意义。 它在 16 位Windows中使用，但现在始终为零。</span><br><span class="line">pCmdLine 包含命令行参数作为 Unicode 字符串。</span><br><span class="line">nCmdShow 是一个标志，指示主应用程序窗口是最小化、最大化还是正常显示。</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;locale.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">	//TestVector();</span><br><span class="line">	setlocale(LC_ALL,&quot;&quot;);</span><br><span class="line">	wchar_t x1[] = L&quot;傻逼&quot;;</span><br><span class="line">	wprintf(L&quot;%s\n&quot;,x1);</span><br><span class="line">	cout &lt;&lt; wcslen(x1) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	wchar_t x2[] = L&quot;你是智障&quot;;</span><br><span class="line">	//wcscpy(x2,x1);</span><br><span class="line">	//wprintf(L&quot;%s\n&quot;,x2);</span><br><span class="line">	//cout &lt;&lt; wcscmp(x1,x1) &lt;&lt; &quot;\n&quot;; </span><br><span class="line">	wchar_t x3[] = L&quot;你是傻逼&quot;;</span><br><span class="line">	//x1第一次在x3中出现的位置，否则返回null</span><br><span class="line">	cout &lt;&lt; wcsstr(x3,x1) &lt;&lt; &quot;\n&quot;;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	printf(&quot;Hello World!\n&quot;);</span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="事件-消息"><a class="markdownIt-Anchor" href="#事件-消息">#</a> 事件、消息</h3>
<p>Windows 中的事件是一个 “动作”，这个动作可能是用户操作应用程序产生的，也可能是 Windows 自己产生的</p>
<p>而消息，就是用来描述这些 “动作” 的，比如:</p>
<p>Windows 为了能够准确的描述这些信息，提供了一个结构体：ISG，该结构体里面记录的事件的详细信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef struct tagMsg</span><br><span class="line">&#123;</span><br><span class="line">	HWND hwnd;      //窗口句柄，由那个窗口处理</span><br><span class="line">	UINT message;   //动作类型/消息类型</span><br><span class="line">	WPARAM wParam;  //消息的详细说明</span><br><span class="line">	LPARAM lParam;  //消息的详细说明</span><br><span class="line">	DWORD time;     //时间</span><br><span class="line">	POINT pt;       //坐标,x,y</span><br><span class="line">&#125;MSG,*PMSG;</span><br></pre></td></tr></table></figure>
<p>系统消息队列与应用程序消息队列</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310192516428.png" alt="image-20230310192516428"></p>
<p>判断消息的类型是不是我关心的是就处理不是让 windows 去处理</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310193925308.png" alt="image-20230310193925308"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310194619857.png" alt="image-20230310194619857"></p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310203005194.png" alt="image-20230310203005194"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">// Win32 Less 2.cpp : Defines the entry point for the application.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">#include &quot;stdafx.h&quot;</span><br><span class="line">#include &quot;Tools.h&quot;</span><br><span class="line"></span><br><span class="line">//声明WindowProc,否则在定义前使用会报错,WindowProc 定义窗口的行为-其外观、用户交互方式等。</span><br><span class="line">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);</span><br><span class="line"></span><br><span class="line">int APIENTRY WinMain(HINSTANCE hInstance,</span><br><span class="line">                     HINSTANCE hPrevInstance,</span><br><span class="line">                     LPSTR     lpCmdLine,</span><br><span class="line">                     int       nCmdShow)</span><br><span class="line">&#123;</span><br><span class="line"> 	// TODO: Place code here.</span><br><span class="line"></span><br><span class="line">	//创建窗口名字</span><br><span class="line">	TCHAR className[] = &quot;shabi&quot;; </span><br><span class="line"></span><br><span class="line">	//定义一个自己的窗口，并定义样式</span><br><span class="line">	WNDCLASS wndclass = &#123;0&#125;;</span><br><span class="line">	wndclass.hbrBackground = (HBRUSH)COLOR_MENU;</span><br><span class="line">	wndclass.lpfnWndProc = WindowProc;</span><br><span class="line">	wndclass.lpszClassName = className;</span><br><span class="line">	wndclass.hInstance = hInstance;</span><br><span class="line"></span><br><span class="line">	//注册窗口</span><br><span class="line">	RegisterClass(&amp;wndclass);</span><br><span class="line"></span><br><span class="line">	//创建窗口并接收唯一标识窗口的句柄。</span><br><span class="line">	HWND hwnd = CreateWindowEx(</span><br><span class="line">		0,                              // Optional window styles.</span><br><span class="line">		className,                     // Window class</span><br><span class="line">		TEXT(&quot;Learn to Program Windows&quot;),    // Window text</span><br><span class="line">		WS_OVERLAPPEDWINDOW,            // Window style</span><br><span class="line"></span><br><span class="line">		// Size and position</span><br><span class="line">		CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class="line"></span><br><span class="line">		NULL,       // Parent window    </span><br><span class="line">		NULL,       // Menu</span><br><span class="line">		hInstance,  // Instance handle</span><br><span class="line">		NULL        // Additional application data</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line">	if (hwnd == NULL)</span><br><span class="line">	&#123;</span><br><span class="line">		return 0;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ShowWindow(hwnd, nCmdShow);</span><br><span class="line"></span><br><span class="line">	//消息处理</span><br><span class="line">	MSG msg;</span><br><span class="line">    while (GetMessage(&amp;msg, NULL, 0, 0) &gt; 0)</span><br><span class="line">    &#123;</span><br><span class="line">        TranslateMessage(&amp;msg);</span><br><span class="line">        DispatchMessage(&amp;msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">	return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//</span><br><span class="line">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)</span><br><span class="line">&#123;</span><br><span class="line">    switch (uMsg)</span><br><span class="line">    &#123;</span><br><span class="line">		case WM_DESTROY:</span><br><span class="line">			PostQuitMessage(0);</span><br><span class="line">			return 0;</span><br><span class="line">			</span><br><span class="line">		case WM_PAINT:</span><br><span class="line">        &#123;</span><br><span class="line">            PAINTSTRUCT ps;</span><br><span class="line">            HDC hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class="line">			</span><br><span class="line">            // All painting occurs here, between BeginPaint and EndPaint.</span><br><span class="line">			</span><br><span class="line">            FillRect(hdc, &amp;ps.rcPaint, (HBRUSH) (COLOR_WINDOW+1));</span><br><span class="line">			</span><br><span class="line">            EndPaint(hwnd, &amp;ps);</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">	//处理不关注事件</span><br><span class="line">    return DefWindowProc(hwnd, uMsg, wParam, lParam);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><span class="exturl" data-url="aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL3dpbmRvd3Mvd2luMzIvbGVhcm53aW4zMi9jcmVhdGluZy1hLXdpbmRvdw==">创建窗口 - Win32 apps | Microsoft Learn</span></p>
<p>消息类型</p>
<p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MDIxMTgwL2FydGljbGUvZGV0YWlscy8xMDAwMjA5MTE=">Windows 消息类型及说明（全面）_战胜。的博客 - CSDN 博客</span></p>
<p><span class="exturl" data-url="aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL3dpbmRvd3Mvd2luMzIvd2lubXNnL2Fib3V0LW1lc3NhZ2VzLWFuZC1tZXNzYWdlLXF1ZXVlcw==">关于消息和消息队列 - Win32 apps | Microsoft Learn</span></p>
<blockquote>
<p>如果直接定义而不初始化，那么没初始化的参数的地方还是 CC，系统执行到这里就会产生中断，</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311112852539.png" alt="image-20230311112852539"></p>
<p>WNDCLASS wndclass = {0}；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">00401061   mov         dword ptr [ebp-30h],0</span><br><span class="line">00401068   mov         ecx,9</span><br><span class="line">0040106D   xor         eax,eax</span><br><span class="line">0040106F   lea         edi,[ebp-2Ch]</span><br><span class="line">00401072   rep stos    dword ptr [edi]</span><br></pre></td></tr></table></figure>
<p>系统会循环填充所有参数为 0</p>
<p><img data-src="https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311113120902.png" alt="image-20230311113120902"></p>
</blockquote>

      <div class="tags">
          <a href="/tags/%E9%80%86%E5%90%91/" rel="tag"><i class="ic i-tag"></i> 逆向</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">Edited on</span>
    <time title="Modified: 2023-03-13 19:49:42" itemprop="dateModified" datetime="2023-03-13T19:49:42+08:00">2023-03-13</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> Donate</button>
  <p>Give me a cup of [coffee]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="John Doe WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="John Doe Alipay">
        <p>Alipay</p>
      </div>
      
      <div>
        <img data-src="/images/paypal.png" alt="John Doe PayPal">
        <p>PayPal</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>Post author:  </strong>John Doe <i class="ic i-at"><em>@</em></i>Hexo
  </li>
  <li class="link">
    <strong>Post link: </strong>
    <a href="http://example.com/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/" title="水滴rev">http://example.com/2023/01/03/滴水reverse/</a>
  </li>
  <li class="license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2022/12/31/webshell/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph47e9vtj20zk0m8x6l.jpg" title="webshell">
  <span class="type">Previous Post</span>
  <span class="category"><i class="ic i-flag"></i> web安全</span>
  <h3>webshell</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2023/01/17/Segment%20Routing/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyhsblkj20zk0m81kx.jpg" title="Segment Routing">
  <span class="type">Next Post</span>
  <span class="category"><i class="ic i-flag"></i> </span>
  <h3>Segment Routing</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="Contents">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BB%B4%E6%B0%B4reverse"><span class="toc-number">1.</span> <span class="toc-text"> 滴水 reverse</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AC%E5%BC%80%E8%AF%BE"><span class="toc-number">1.1.</span> <span class="toc-text"> 公开课</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%88%B6"><span class="toc-number">1.2.</span> <span class="toc-text"> 进制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%BD%E5%BA%A6"><span class="toc-number">1.3.</span> <span class="toc-text"> 数据宽度</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text"> 寄存器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E5%AD%98"><span class="toc-number">1.5.</span> <span class="toc-text"> 内存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E6%A0%88"><span class="toc-number">1.6.</span> <span class="toc-text"> 堆栈</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jcc"><span class="toc-number">1.7.</span> <span class="toc-text"> JCC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jcc-2"><span class="toc-number">1.8.</span> <span class="toc-text"> JCC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A0%86%E6%A0%88%E5%9B%BE"><span class="toc-number">1.9.</span> <span class="toc-text"> 堆栈图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0"><span class="toc-number">1.10.</span> <span class="toc-text"> 函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c%E8%AF%AD%E8%A8%80"><span class="toc-number">1.11.</span> <span class="toc-text"> C 语言</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vc60"><span class="toc-number">1.11.1.</span> <span class="toc-text"> VC6.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.11.2.</span> <span class="toc-text"> 数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%96%E7%A0%81"><span class="toc-number">1.11.3.</span> <span class="toc-text"> 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E5%86%85%E5%AD%98"><span class="toc-number">1.11.4.</span> <span class="toc-text"> 程序内存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#if%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.11.5.</span> <span class="toc-text"> if 语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5"><span class="toc-number">1.11.6.</span> <span class="toc-text"> 循环语句</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-number">1.11.7.</span> <span class="toc-text"> 结构体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#typedef"><span class="toc-number">1.11.8.</span> <span class="toc-text"> typedef</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#switch"><span class="toc-number">1.11.9.</span> <span class="toc-text"> Switch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BE%AA%E7%8E%AF%E5%AF%B9%E6%AF%94%E5%88%86%E6%9E%90"><span class="toc-number">1.11.10.</span> <span class="toc-text"> 循环对比分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E9%92%88"><span class="toc-number">1.11.11.</span> <span class="toc-text"> 指针</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">1.11.12.</span> <span class="toc-text"> 位运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#define"><span class="toc-number">1.11.13.</span> <span class="toc-text"> define</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#malloc"><span class="toc-number">1.11.14.</span> <span class="toc-text"> malloc</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pe"><span class="toc-number">1.12.</span> <span class="toc-text"> PE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pe%E7%BB%93%E6%9E%84"><span class="toc-number">1.12.1.</span> <span class="toc-text"> PE 结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8A%82%E8%A1%A8"><span class="toc-number">1.12.2.</span> <span class="toc-text"> 节表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%8A%82%E7%A9%BA%E7%99%BD%E5%8C%BA%E6%B7%BB%E5%8A%A0%E4%BB%A3%E7%A0%81"><span class="toc-number">1.12.3.</span> <span class="toc-text"> 代码节空白区添加代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">1.12.4.</span> <span class="toc-text"> 静态链接库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93"><span class="toc-number">1.12.5.</span> <span class="toc-text"> 动态链接库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%87%BA%E8%A1%A8"><span class="toc-number">1.12.6.</span> <span class="toc-text"> 导出表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8"><span class="toc-number">1.12.7.</span> <span class="toc-text"> 重定位表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%BB%E5%8A%A8%E5%AF%BC%E5%87%BA%E8%A1%A8"><span class="toc-number">1.12.8.</span> <span class="toc-text"> 移动导出表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#iat"><span class="toc-number">1.12.9.</span> <span class="toc-text"> IAT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E8%A1%A8"><span class="toc-number">1.12.10.</span> <span class="toc-text"> 导入表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%AF%BC%E5%85%A5%E8%A1%A8"><span class="toc-number">1.12.11.</span> <span class="toc-text"> 绑定导入表</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c"><span class="toc-number">1.13.</span> <span class="toc-text"> C++</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.13.1.</span> <span class="toc-text"> 构造函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.13.2.</span> <span class="toc-text"> 析构函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">1.13.3.</span> <span class="toc-text"> 继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6"><span class="toc-number">1.13.4.</span> <span class="toc-text"> 权限控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0%E8%A1%A8"><span class="toc-number">1.13.5.</span> <span class="toc-text"> 虚函数表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E7%BB%91%E5%AE%9A"><span class="toc-number">1.13.6.</span> <span class="toc-text"> 动态绑定</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.13.7.</span> <span class="toc-text"> 模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.13.8.</span> <span class="toc-text"> 引用类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0"><span class="toc-number">1.13.9.</span> <span class="toc-text"> 友元函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="toc-number">1.13.10.</span> <span class="toc-text"> 运算符重载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#new-delete"><span class="toc-number">1.13.11.</span> <span class="toc-text"> new-delete</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vector"><span class="toc-number">1.13.12.</span> <span class="toc-text"> Vector</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%A1%A8"><span class="toc-number">1.13.13.</span> <span class="toc-text"> 链表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C%E5%8F%89%E6%A0%91"><span class="toc-number">1.13.14.</span> <span class="toc-text"> 二叉树</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vectorlinklistbtree%E5%8F%8D%E6%B1%87%E7%BC%96"><span class="toc-number">1.13.15.</span> <span class="toc-text"> Vector，LinkList，Btree 反汇编</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#win32"><span class="toc-number">1.14.</span> <span class="toc-text"> win32</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%BD%E5%AD%97%E7%AC%A6"><span class="toc-number">1.14.1.</span> <span class="toc-text"> 宽字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6-%E6%B6%88%E6%81%AF"><span class="toc-number">1.14.2.</span> <span class="toc-text"> 事件、消息</span></a></li></ol></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="Related">
        <ul>
          <li><a href="/2022/11/01/%E6%B1%87%E7%BC%96/" rel="bookmark" title="汇编">汇编</a></li><li><a href="/2022/11/11/reverse/" rel="bookmark" title="逆向">逆向</a></li><li class="active"><a href="/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/" rel="bookmark" title="水滴rev">水滴rev</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="Overview">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="John Doe"
      data-src="/images/avatar.jpg">
  <p class="name" itemprop="name">John Doe</p>
  <div class="description" itemprop="description"></div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">31</span>
        <span class="name">posts</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">4</span>
        <span class="name">categories</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">4</span>
        <span class="name">tags</span>
      </a>
    </div>
</nav>

<div class="social">
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>Home</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2022/12/31/webshell/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2023/01/17/Segment%20Routing/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          
<div class="rpost pjax">
  <h2>Random Posts</h2>
  <ul>
      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/04/02/Nginx_new/" title="Nginx">Nginx</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/08/16/Unserialize/" title="unserialize">unserialize</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/12/28/mysql/" title="Mysql">Mysql</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/01/17/Segment%20Routing/" title="Segment Routing">Segment Routing</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/12/27/SSTI/" title="SSTI">SSTI</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/03/16/SQL%E6%B3%A8%E5%85%A5/" title="SQL injection">SQL injection</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/05/17/include/" title="file include">file include</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2022/02/28/XSS/" title="XSS">XSS</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
</div>

    <span><a href="/2023/04/07/TCPIP_new/" title="TCP&#x2F;IP">TCP/IP</a></span>
  </li>

      
  <li class="item">
    
<div class="breadcrumb">
<a href="/categories/web%E5%AE%89%E5%85%A8/" title="In web安全">web安全</a>
</div>

    <span><a href="/2022/05/27/CSRF/" title="CSRF">CSRF</a></span>
  </li>

  </ul>
</div>
<div>
  <h2>Recent Comments</h2>
  <ul class="leancloud-recent-comment"></ul>
</div>

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2010 – 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">John Doe @ Yume Shoka</span>
  </div>
  <div class="powered-by">
    Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2023/01/03/滴水reverse/',
    favicon: {
      show: "（●´3｀●）Goooood",
      hide: "(´Д｀)Booooom"
    },
    search : {
      placeholder: "Search for Posts",
      empty: "We didn't find any results for the search: ${query}",
      stats: "${hits} results found in ${time} ms"
    },
    valine: true,fancybox: true,
    copyright: 'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>

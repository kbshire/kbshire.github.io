{
    "version": "https://jsonfeed.org/version/1",
    "title": "Hexo • All posts by \"逆向\" tag",
    "description": "",
    "home_page_url": "http://example.com",
    "items": [
        {
            "id": "http://example.com/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/",
            "url": "http://example.com/2023/01/03/%E6%BB%B4%E6%B0%B4reverse/",
            "title": "水滴rev",
            "date_published": "2023-01-03T05:38:45.000Z",
            "content_html": "<h1 id=\"滴水reverse\"><a class=\"markdownIt-Anchor\" href=\"#滴水reverse\">#</a> 滴水 reverse</h1>\n<h2 id=\"公开课\"><a class=\"markdownIt-Anchor\" href=\"#公开课\">#</a> 公开课</h2>\n<p>PE 文件结构</p>\n<p>任何一个在 Windows 上运行的可执行文件都要遵守一定的格式，这个格式就是 PE 文件结构，比如:exe, dIl, 部分 sys</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/20191105010140189.png\" alt=\"img\"></p>\n<p>此处可使用 PEID 或 ExeinfoPE 进行代替</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210120028888.png\" alt=\"image-20221210120028888\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210132659775.png\" alt=\"image-20221210132659775\"></p>\n<p>32 位计算机最大内存 4G，寻址宽度 32 位</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210141922512.png\" alt=\"image-20221210141922512\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210141955667.png\" alt=\"image-20221210141955667\"></p>\n<p>push esp-4 , 压栈，EIP +4</p>\n<p>call EIP 跳转，esp-4 压栈</p>\n<p>ret 将栈中的地址弹出到 EIP，esp-4</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211125947066.png\" alt=\"image-20221211125947066\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211130508986.png\" alt=\"image-20221211130508986\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211131806741.png\" alt=\"image-20221211131806741\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133036307.png\" alt=\"image-20221211133036307\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133000935.png\" alt=\"image-20221211133000935\"></p>\n<p>arr [6] 是 ebp+4，放的是函数返回值的地址，修改了返回值在函数返回时会自动执行</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211133428315.png\" alt=\"image-20221211133428315\"></p>\n<p>全局变量在 pe 头的数据中，局部变量在堆栈中</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211135158527.png\" alt=\"image-20221211135158527\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211135229931.png\" alt=\"image-20221211135229931\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211134515487.png\" alt=\"image-20221211134515487\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221211134557068.png\" alt=\"image-20221211134557068\"></p>\n<h2 id=\"进制\"><a class=\"markdownIt-Anchor\" href=\"#进制\">#</a> 进制</h2>\n<p>进制的本质是查数</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151456236.png\" alt=\"image-20221212151456236\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151324431.png\" alt=\"image-20221212151324431\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221212151333052.png\" alt=\"image-20221212151333052\"></p>\n<h2 id=\"数据宽度\"><a class=\"markdownIt-Anchor\" href=\"#数据宽度\">#</a> 数据宽度</h2>\n<p>4 位宽度表示</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213152958630.png\" alt=\"image-20221213152958630\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213153742328.png\" alt=\"image-20221213153742328\"></p>\n<p>8 位宽度表示</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213153933311.png\" alt=\"image-20221213153933311\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154014302.png\" alt=\"image-20221213154014302\"></p>\n<p>16 位宽度表示</p>\n<p>32 位宽度表示</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154324319.png\" alt=\"image-20221213154324319\"></p>\n<p>6、几个重要的计量单位:</p>\n<p>BYTE 字节 8BIT</p>\n<p>WORD 字 16BIT 2 字节</p>\n<p>DWORD 双字 32BIT 4 字节</p>\n<p>or</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213154728965.png\" alt=\"image-20221213154728965\"></p>\n<p>and</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213155024628.png\" alt=\"image-20221213155024628\"></p>\n<p>xor</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213155128086.png\" alt=\"image-20221213155128086\"></p>\n<p>not</p>\n<p>2+3</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210132659775.png\" alt=\"image-20221210132659775\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213160855262.png\" alt=\"image-20221213160855262\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213160948087.png\" alt=\"image-20221213160948087\"></p>\n<h2 id=\"寄存器\"><a class=\"markdownIt-Anchor\" href=\"#寄存器\">#</a> 寄存器</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213162041512.png\" alt=\" \"></p>\n<p>mov ebx,0x123456789    //ebx=23456789  忽略高位，1 是高位</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213171205765.png\" alt=\"image-20221213171205765\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213171554801.png\" alt=\"image-20221213171554801\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213174336225.png\" alt=\"image-20221213174336225\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213175435630.png\" alt=\"image-20221213175435630\"></p>\n<p><img data-src=\"../AppData/Roaming/Typora/typora-user-images/image-20221213182649856.png\" alt=\"image-20221213182649856\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213183047619.png\" alt=\"image-20221213183047619\"></p>\n<p><strong>我们可以打补丁或者其他方式拓展内存</strong></p>\n<h2 id=\"内存\"><a class=\"markdownIt-Anchor\" href=\"#内存\">#</a> 内存</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213183647234.png\" alt=\"image-20221213183647234\"></p>\n<p>栈中每四个内存单元一组</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221213184806456.png\" alt=\"image-20221213184806456\" style=\"zoom:200%;\" />\n<p>数据窗口中以小端存储以 db 查看时</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214203828764.png\" alt=\"image-20221214203828764\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214203909142.png\" alt=\"image-20221214203909142\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214204249791.png\" alt=\"image-20221214204249791\"></p>\n<p>0012FFDC = E4</p>\n<p>0012FFDD = 7C</p>\n<p>在数据窗口是小端在前</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214205211991.png\" alt=\"image-20221214205211991\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214205617926.png\" alt=\"image-20221214205617926\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210429166.png\" alt=\"image-20221214210429166\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210441256.png\" alt=\"image-20221214210441256\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214210742628.png\" alt=\"image-20221214210742628\"></p>\n<h2 id=\"堆栈\"><a class=\"markdownIt-Anchor\" href=\"#堆栈\">#</a> 堆栈</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214213244308.png\" alt=\"image-20221214213244308\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214213607192.png\" alt=\"image-20221214213607192\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214214015040.png\" alt=\"image-20221214214015040\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221214214825379.png\" alt=\"image-20221214214825379\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push imm    //esp-4</span><br><span class=\"line\">push al     //不能push8位</span><br><span class=\"line\">push ax     //esp-2</span><br><span class=\"line\">push eax    //esp-4</span><br><span class=\"line\">push dword ptr ds:[12FFDC]   //esp-4</span><br><span class=\"line\">push word ptr ds:[12FFDC]    //esp-2</span><br><span class=\"line\">push byte ptr ds:[12FFDC]    //不能push 8位内存</span><br><span class=\"line\"></span><br><span class=\"line\">pushad   //将所有通用寄存器入栈</span><br><span class=\"line\">popad </span><br></pre></td></tr></table></figure>\n<h2 id=\"jcc\"><a class=\"markdownIt-Anchor\" href=\"#jcc\">#</a> JCC</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219205236604.png\" alt=\"image-20221219205236604\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219205328411.png\" alt=\"image-20221219205328411\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210046713.png\" alt=\"image-20221219210046713\"></p>\n<p>只计算最低有效字节中的 1 的个数</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210317802.png\" alt=\"image-20221219210317802\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">看当前数据宽度/2 中间的位是否进位</span><br><span class=\"line\">12345678  看5是否产生进位</span><br><span class=\"line\">16位，8位一样 </span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219210949437.png\" alt=\"image-20221219210949437\"></p>\n<p>test 和 xor 的区别</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219211306372.png\" alt=\"image-20221219211306372\"></p>\n<hr>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219212150517.png\" alt=\"image-20221219212150517\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213621597.png\" alt=\"image-20221219213621597\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213712037.png\" alt=\"image-20221219213712037\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219213903993.png\" alt=\"image-20221219213903993\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adc al,cl</span><br><span class=\"line\">al = al + cl + 进位标志carry(1)</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214113901.png\" alt=\"image-20221219214113901\"></p>\n<p>Borrow</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214341294.png\" alt=\"image-20221219214341294\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219214413526.png\" alt=\"image-20221219214413526\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219215219369.png\" alt=\"image-20221219215219369\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movs stos  移动方向由D标志位决定 </span><br><span class=\"line\">D = 0 + </span><br><span class=\"line\">D = 1 -</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221219215520140.png\" alt=\"image-20221219215520140\"></p>\n<h2 id=\"jcc-2\"><a class=\"markdownIt-Anchor\" href=\"#jcc-2\">#</a> JCC</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228171843970.png\" alt=\"image-20221228171843970\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184206472.png\" alt=\"image-20221228184206472\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184559423.png\" alt=\"image-20221228184559423\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221228184754864.png\" alt=\"image-20221228184754864\"></p>\n<p>test  可以判断寄存器中值是否为 0</p>\n<p><strong>call 执行时首先将 call 的下一条命令入栈，通过当前地址 + 当前指令长度，指令长度通过硬编码确定，此时 esp-4，作为 call ret 之后的下一条执行，EIP 变为 call 的地址</strong></p>\n<p><strong>ret 时将栈顶的返回地址给 EIP，esp+4</strong></p>\n<p><strong>因此一个函数在被调用时，堆栈栈顶就是他返回后执行的下一条指令</strong></p>\n<h2 id=\"堆栈图\"><a class=\"markdownIt-Anchor\" href=\"#堆栈图\">#</a> 堆栈图</h2>\n<p>定位到 winMain</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230210156563.png\" alt=\"image-20221230210156563\"></p>\n<p>有如下函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401085  |.  6A 04         push    0x4</span><br><span class=\"line\">00401087  |.  6A 03         push    0x3</span><br><span class=\"line\">00401089  |.  E8 77FFFFFF   call    00401005</span><br><span class=\"line\">0040108E  |.  83C4 08       add     esp,0x8</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401005   $ /E9 16000000   jmp     add</span><br><span class=\"line\">0040100A   $ |E9 51000000   jmp     main</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401020 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">00401021  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401023  |.  83EC 48       sub     esp,0x48</span><br><span class=\"line\">00401026  |.  53            push    ebx</span><br><span class=\"line\">00401027  |.  56            push    esi</span><br><span class=\"line\">00401028  |.  57            push    edi</span><br><span class=\"line\">00401029  |.  8D7D B8       lea     edi,[local.18]</span><br><span class=\"line\">0040102C  |.  B9 12000000   mov     ecx,0x12</span><br><span class=\"line\">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00401038  |.  8B45 08       mov     eax,[arg.1]</span><br><span class=\"line\">0040103B  |.  8945 FC       mov     [local.1],eax</span><br><span class=\"line\">0040103E  |.  8B4D 0C       mov     ecx,[arg.2]</span><br><span class=\"line\">00401041  |.  894D F8       mov     [local.2],ecx</span><br><span class=\"line\">00401044  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">00401047  |.  0345 F8       add     eax,[local.2]</span><br><span class=\"line\">0040104A  |.  5F            pop     edi</span><br><span class=\"line\">0040104B  |.  5E            pop     esi</span><br><span class=\"line\">0040104C  |.  5B            pop     ebx</span><br><span class=\"line\">0040104D  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">0040104F  |.  5D            pop     ebp</span><br><span class=\"line\">00401050  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235920026.png\" alt=\"image-20221230235920026\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235929733.png\" alt=\"image-20221230235929733\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221230235938501.png\" alt=\"image-20221230235938501\"></p>\n<blockquote>\n<p>注意 1:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0018FE94     00000001</span><br><span class=\"line\">0018FE98     0018FF48</span><br><span class=\"line\">0018FE9C     00000000</span><br><span class=\"line\">0018FEA0     7EFDE000</span><br><span class=\"line\">0018FEA4     CCCCCCCC</span><br><span class=\"line\">0018FEA8     CCCCCCCC</span><br><span class=\"line\">0018FEAC     CCCCCCCC</span><br><span class=\"line\">0018FEB0     CCCCCCCC</span><br><span class=\"line\">0018FEB4     CCCCCCCC</span><br><span class=\"line\">0018FEB8     CCCCCCCC</span><br><span class=\"line\">0018FEBC     CCCCCCCC</span><br><span class=\"line\">0018FEC0     CCCCCCCC</span><br><span class=\"line\">0018FEC4     CCCCCCCC</span><br><span class=\"line\">0018FEC8     CCCCCCCC</span><br><span class=\"line\">0018FECC     CCCCCCCC</span><br><span class=\"line\">0018FED0     CCCCCCCC</span><br><span class=\"line\">0018FED4     CCCCCCCC</span><br><span class=\"line\">0018FED8     CCCCCCCC</span><br><span class=\"line\">0018FEDC     CCCCCCCC</span><br><span class=\"line\">0018FEE0     CCCCCCCC</span><br><span class=\"line\">0018FEE4     00000004</span><br><span class=\"line\">0018FEE8     00000003</span><br><span class=\"line\">0018FEEC     0018FF48</span><br><span class=\"line\">0018FEF0     0040108E  add.0040108E</span><br><span class=\"line\">0018FEF4     00000003</span><br><span class=\"line\">0018FEF8     00000004</span><br><span class=\"line\">0018FEFC     00000000</span><br></pre></td></tr></table></figure>\n<p>这是 add esp, 0x8 之后的堆栈，并不是将他清空了，只是改变了 esp，垃圾数据还在那</p>\n<p>注意 2：</p>\n<p>CCCCCCCC 是 int3 的硬编码</p>\n<p>注意 3：</p>\n<p>esp+8 是外部传进来的参数</p>\n<p>esp-4 是函数内部的局部变量</p>\n<p>esp+4 是函数返回的地址</p>\n<p>注意 4：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int add(int a, int b)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint c = a;</span><br><span class=\"line\">\tint d = b;</span><br><span class=\"line\">\treturn c + d;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;Hello World!\\n&quot;);</span><br><span class=\"line\">\tadd(3,4);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//这是函数代码</span><br></pre></td></tr></table></figure>\n<p>注意 5：</p>\n<p>add esp,0x8 是 cdecl 的外平栈</p>\n<p>ret 8 是 stdcall 的内平栈</p>\n<p>注意 6</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">lea     edi,dword ptr ss:[ebp-0x48]</span><br><span class=\"line\">mov     ecx,0x12</span><br><span class=\"line\">mov     eax,0xCCCCCCCC</span><br><span class=\"line\">rep     stos dword ptr es:[edi]</span><br></pre></td></tr></table></figure>\n<p>的作用是重复 12 次，将 CCCCCCCC 的值不停填充到 ebp-48 的位置，每填充一次 edi+4，edi+4 或 - 4 由 df 标志位决定，df=0 +  df=1 -</p>\n</blockquote>\n<h2 id=\"函数\"><a class=\"markdownIt-Anchor\" href=\"#函数\">#</a> 函数</h2>\n<p>计算机的函数，是一个固定的一个程序段，或称其为一个子程序，它东可以实现固定运算功能的同时还带有一入口和一个出口，所谓的入口，就是函数所带的各个参数，我们可以通过这个入口，把函数的参数值代入子程序，供计算机处理，所谓出口，就是指函数的计算结果，也称为返回值，在计算机求得之后，由此口带回给调用它的程序。</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101174907969.png\" alt=\"image-20230101174907969\"></p>\n<p>函数传参包括寄存器传参 (比如 this 指针) 和内存传参</p>\n<p>函数返回结果可以通过寄存器返回 (一般为 EAX) 或者内存</p>\n<p>Windows 堆栈特点</p>\n<p>1. 现进后出</p>\n<p>2. 向低地址扩展</p>\n<p>windows 中的堆栈，是一块普通的内存，主要用来存储一些临时的数据和参数等可以把 Windows 中的堆栈想象成是一个公用的书箱，函数就像是使用箱子的人函数在执行的时候，会用到这个书箱，把一些数据存到里面，但用完的时候一定要记得把书拿走，否则会乱的，也就是说，你放进去几本书，走的时候也要拿走几本书，这个就是堆栈平衡.</p>\n<h2 id=\"c语言\"><a class=\"markdownIt-Anchor\" href=\"#c语言\">#</a> C 语言</h2>\n<h3 id=\"vc60\"><a class=\"markdownIt-Anchor\" href=\"#vc60\">#</a> VC6.0</h3>\n<p><strong>快捷键</strong></p>\n<p>F7 编译</p>\n<p>F5 执行</p>\n<p>shift + F5 结束</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103212249828.png\" alt=\"image-20230103212249828\"></p>\n<p>函数名、参数名、变量名的命名规则：只能包含字母、数字和_且不能以数字开头.</p>\n<p><strong>函数返回值</strong></p>\n<p>1. 无参数，无返回值的格式形式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void fun()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>当函数没有参数时不需要提升和降低堆栈</strong></p>\n<p>2. 有参数，无返回值函数格式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void fn(int a,double b)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>裸函数</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> __declspec(naked) func1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tret</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"type\">int</span> __declspec(naked) func1(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">调用裸函数中没有代码，没有ret,不能正常返回，会报错</span><br><span class=\"line\">需要手动加内联汇编中ret返回 </span><br></pre></td></tr></table></figure>\n<p>调用约定</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__cdecl\t\t\t从右至左入栈\t\t\t\t\t\t\t调用者清理栈\t\t\t\t\t默认调用约定</span><br><span class=\"line\">__stdcall\t\t从右至左入栈\t\t\t\t\t\t\t自身清理堆栈\t\t\t\t\twinapi调用方式</span><br><span class=\"line\">__fastcall\t\tecx/edx传送前两个，从右至左入栈\t\t\t自身清理堆栈，如果参数大于两个，小于两个不用清理</span><br></pre></td></tr></table></figure>\n<p>函数入口</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main(int 1, char * * 0x005210d8) line 23</span><br><span class=\"line\">mainCRTStartup() line 206 + 25 bytes</span><br><span class=\"line\">KERNEL32! 74d433ca()</span><br><span class=\"line\">NTDLL! 76f59ed2()</span><br><span class=\"line\">NTDLL! 76f59ea5()</span><br></pre></td></tr></table></figure>\n<p>更改入口点</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230104194840789.png\" alt=\"image-20230104194840789\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">main 函数被调用前要先调用的函数如下:</span><br><span class=\"line\">GetVersion()</span><br><span class=\"line\">_heap_init()</span><br><span class=\"line\">GetCommandLineA()</span><br><span class=\"line\">_crtGetEnvironmentStringsA()</span><br><span class=\"line\">_setargv(</span><br><span class=\"line\">_setenvp()</span><br><span class=\"line\">_cinit()</span><br><span class=\"line\"></span><br><span class=\"line\">以上函数都会在mainCRTStartup中初始化</span><br><span class=\"line\"></span><br><span class=\"line\">mainret = main(__argc,__argv,__environ);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401180 &gt;/$  55            push    ebp</span><br><span class=\"line\">00401181  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401183  |.  6A FF         push    -0x1</span><br><span class=\"line\">00401185  |.  68 38214200   push    00422138</span><br><span class=\"line\">0040118A  |.  68 30424000   push    _except_handler3                 ;  SE 处理程序安装</span><br><span class=\"line\">0040118F  |.  64:A1 0000000&gt;mov     eax,dword ptr fs:[0]</span><br><span class=\"line\">00401195  |.  50            push    eax</span><br><span class=\"line\">00401196  |.  64:8925 00000&gt;mov     dword ptr fs:[0],esp</span><br><span class=\"line\">0040119D  |.  83C4 F0       add     esp,-0x10</span><br><span class=\"line\">004011A0  |.  53            push    ebx</span><br><span class=\"line\">004011A1  |.  56            push    esi</span><br><span class=\"line\">004011A2  |.  57            push    edi</span><br><span class=\"line\">004011A3  |.  8965 E8       mov     [local.6],esp</span><br><span class=\"line\">004011A6  |.  FF15 4CA14200 call    dword ptr ds:[&lt;&amp;KERNEL32.GetVers&gt;;  kernel32.GetVersion</span><br><span class=\"line\">004011AC  |.  A3 707C4200   mov     dword ptr ds:[_osver],eax</span><br><span class=\"line\">004011B1  |.  A1 707C4200   mov     eax,dword ptr ds:[_osver]</span><br><span class=\"line\">004011B6  |.  C1E8 08       shr     eax,0x8</span><br><span class=\"line\">004011B9  |.  25 FF000000   and     eax,0xFF</span><br><span class=\"line\">004011BE  |.  A3 7C7C4200   mov     dword ptr ds:[_winminor],eax</span><br><span class=\"line\">004011C3  |.  8B0D 707C4200 mov     ecx,dword ptr ds:[_osver]</span><br><span class=\"line\">004011C9  |.  81E1 FF000000 and     ecx,0xFF</span><br><span class=\"line\">004011CF  |.  890D 787C4200 mov     dword ptr ds:[_winmajor],ecx</span><br><span class=\"line\">004011D5  |.  8B15 787C4200 mov     edx,dword ptr ds:[_winmajor]</span><br><span class=\"line\">004011DB  |.  C1E2 08       shl     edx,0x8</span><br><span class=\"line\">004011DE  |.  0315 7C7C4200 add     edx,dword ptr ds:[_winminor]</span><br><span class=\"line\">004011E4  |.  8915 747C4200 mov     dword ptr ds:[_winver],edx</span><br><span class=\"line\">004011EA  |.  A1 707C4200   mov     eax,dword ptr ds:[_osver]</span><br><span class=\"line\">004011EF  |.  C1E8 10       shr     eax,0x10</span><br><span class=\"line\">004011F2  |.  25 FFFF0000   and     eax,0xFFFF</span><br><span class=\"line\">004011F7  |.  A3 707C4200   mov     dword ptr ds:[_osver],eax</span><br><span class=\"line\">004011FC  |.  6A 00         push    0x0</span><br><span class=\"line\">004011FE  |.  E8 BD2D0000   call    _heap_init</span><br><span class=\"line\">00401203  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00401206  |.  85C0          test    eax,eax</span><br><span class=\"line\">00401208  |.  75 0A         jnz     short 00401214</span><br><span class=\"line\">0040120A  |.  6A 1C         push    0x1C</span><br><span class=\"line\">0040120C  |.  E8 CF000000   call    fast_error_exit</span><br><span class=\"line\">00401211  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00401214  |&gt;  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class=\"line\">0040121B  |.  E8 A0270000   call    _ioinit</span><br><span class=\"line\">00401220  |.  FF15 48A14200 call    dword ptr ds:[&lt;&amp;KERNEL32.GetComm&gt;; [GetCommandLineA</span><br><span class=\"line\">00401226  |.  A3 04964200   mov     dword ptr ds:[_acmdln],eax</span><br><span class=\"line\">0040122B  |.  E8 70250000   call    __crtGetEnvironmentStringsA</span><br><span class=\"line\">00401230  |.  A3 487C4200   mov     dword ptr ds:[_aenvptr],eax</span><br><span class=\"line\">00401235  |.  E8 56200000   call    _setargv</span><br><span class=\"line\">0040123A  |.  E8 011F0000   call    _setenvp</span><br><span class=\"line\">0040123F  |.  E8 1C1B0000   call    _cinit</span><br><span class=\"line\">00401244  |.  8B0D 8C7C4200 mov     ecx,dword ptr ds:[_environ]</span><br><span class=\"line\">0040124A  |.  890D 907C4200 mov     dword ptr ds:[__initenv],ecx</span><br><span class=\"line\">00401250  |.  8B15 8C7C4200 mov     edx,dword ptr ds:[_environ]</span><br><span class=\"line\">00401256  |.  52            push    edx</span><br><span class=\"line\">00401257  |.  A1 847C4200   mov     eax,dword ptr ds:[__argv]</span><br><span class=\"line\">0040125C  |.  50            push    eax</span><br><span class=\"line\">0040125D  |.  8B0D 807C4200 mov     ecx,dword ptr ds:[__argc]</span><br><span class=\"line\">00401263  |.  51            push    ecx</span><br><span class=\"line\">00401264  |.  E8 A1FDFFFF   call    0040100A</span><br><span class=\"line\">00401269  |.  83C4 0C       add     esp,0xC</span><br><span class=\"line\">0040126C  |.  8945 E4       mov     [local.7],eax</span><br><span class=\"line\">0040126F  |.  8B55 E4       mov     edx,[local.7]</span><br><span class=\"line\">00401272  |.  52            push    edx                              ; /status</span><br><span class=\"line\">00401273  |.  E8 281B0000   call    exit                             ; \\exit</span><br><span class=\"line\">00401278  |.  8B45 EC       mov     eax,[local.5]</span><br><span class=\"line\">0040127B  |.  8B08          mov     ecx,dword ptr ds:[eax]</span><br><span class=\"line\">0040127D  |.  8B11          mov     edx,dword ptr ds:[ecx]</span><br><span class=\"line\">0040127F  |.  8955 E0       mov     [local.8],edx</span><br><span class=\"line\">00401282  |.  8B45 EC       mov     eax,[local.5]</span><br><span class=\"line\">00401285  |.  50            push    eax</span><br><span class=\"line\">00401286  |.  8B4D E0       mov     ecx,[local.8]</span><br><span class=\"line\">00401289  |.  51            push    ecx</span><br><span class=\"line\">0040128A  |.  E8 A11C0000   call    _XcptFilter</span><br><span class=\"line\">0040128F  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">00401292  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<h3 id=\"数据类型\"><a class=\"markdownIt-Anchor\" href=\"#数据类型\">#</a> 数据类型</h3>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">基本类型：   \t  整数类型</span><br><span class=\"line\">\t\t\t     浮点类型</span><br><span class=\"line\">整数类型： <span class=\"type\">char</span> <span class=\"type\">short</span> <span class=\"title function_\">int</span><span class=\"params\">(<span class=\"number\">32</span>)</span> <span class=\"title function_\">long</span><span class=\"params\">(<span class=\"number\">32</span>)</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> i = <span class=\"number\">0x12345678</span>;</span><br><span class=\"line\">mov byte ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">78</span>h</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">short</span> k = <span class=\"number\">0x12345678</span>      k = <span class=\"number\">5678</span></span><br><span class=\"line\"></span><br><span class=\"line\">整数类型 <span class=\"type\">unsigned</span> <span class=\"type\">signed</span></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span>  a = <span class=\"number\">0xFF</span>;    <span class=\"comment\">//不写char默认int</span></span><br><span class=\"line\"><span class=\"type\">char</span> b = <span class=\"number\">0xFF</span>;</span><br><span class=\"line\">在内存中都是FF，但使用时有符号<span class=\"number\">-1</span>，无符号<span class=\"number\">255</span></span><br><span class=\"line\">类型转化，比较大小</span><br><span class=\"line\">    </span><br><span class=\"line\">编译器对于有符号和无符号的jcc编译结果不一样</span><br><span class=\"line\">jz je</span><br><span class=\"line\">    </span><br><span class=\"line\">浮点类型 <span class=\"type\">float</span> <span class=\"type\">double</span></span><br><span class=\"line\"><span class=\"type\">float</span> 存储方式 </span><br><span class=\"line\">符号位      指数部分\t\t\t尾数部分</span><br><span class=\"line\"><span class=\"number\">31</span><span class=\"number\">-30</span>      <span class=\"number\">30</span><span class=\"number\">-22</span>            <span class=\"number\">22</span><span class=\"number\">-0</span></span><br><span class=\"line\"><span class=\"type\">double</span> 存储方式 </span><br><span class=\"line\">符号位      指数部分\t\t\t尾数部分</span><br><span class=\"line\"><span class=\"number\">63</span><span class=\"number\">-62</span>      <span class=\"number\">62</span><span class=\"number\">-51</span>            <span class=\"number\">51</span><span class=\"number\">-0</span></span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>将一个 float 型转化为内存存储格式的步骤为:</p>\n<p>1、先将这个实数的绝对值化为二进制格式<br>\n 2、将这个二进制格式实数的小数点左移或右移 n 位，直到小数点移动到第一个有效数字的右边。</p>\n<p>3、从小数点右边第一位开始数出二十三位数字放入第 22 到第 0 位。</p>\n<p>4、如果实数是正的，则在第 31 位放入 “0”，否则放入 “1”。</p>\n<p>5、如果 n 是左移得到的，说明指数是正的，第 30 位放入 “1”。如果 n 是右移得到的或 n=0，则第 30 位放入 0</p>\n<p>6、如果 n 是左移得到的，则将 n 减去 1 后化为二进制，并在左边加 “0” 补足七位，放入第 29 到第 23 位。</p>\n<p>如果 n 是右移得到的或 n=0，则将 n 化为二进制后在左边加 “0” 补足七位，再各位求反，再放入第 29 到第 23 位</p>\n</blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">8.25</span><br><span class=\"line\">1.转为二进制数,整数部分除二取余,倒序排列,整数部分乘二取整,正序排列</span><br><span class=\"line\">\t1000.01</span><br><span class=\"line\">2.科学计数法,左移+右移-</span><br><span class=\"line\">\t1.00001*(2^3)</span><br><span class=\"line\">3.存放尾数,加起来一共23位，不够用0补，补在最后</span><br><span class=\"line\">\t00001000000000000000000</span><br><span class=\"line\">4.符号位正0负1</span><br><span class=\"line\">\t0</span><br><span class=\"line\">5.指数部分,第一位为位移方向，左移1，右移0.剩下七位是指数二进制-1的值    (或者使用127+x转为二进制填充 )</span><br><span class=\"line\">\t10000010</span><br><span class=\"line\">6.拼接</span><br><span class=\"line\">\t01000001000001000000000000000000</span><br><span class=\"line\">\t41040000</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0.25</span><br><span class=\"line\"></span><br><span class=\"line\">0.01   -&gt; 1.0</span><br><span class=\"line\">1 * (2^(-2))  右移</span><br><span class=\"line\">FD = -2-1 = -3</span><br><span class=\"line\"></span><br><span class=\"line\">0</span><br><span class=\"line\">0 1111101</span><br><span class=\"line\">00000000000000000000000</span><br><span class=\"line\"></span><br><span class=\"line\">00111110100000000000000000000000</span><br><span class=\"line\"></span><br><span class=\"line\">3E800000</span><br></pre></td></tr></table></figure>\n<p>尾数部分长度决定精确度，比如 8.4 的小数部分无限循环</p>\n<p>比如 float 精确到 24 位 (尾数 + 科学计数法最前面的 0 或 1)，可以精确到小数点后 6 位</p>\n<h3 id=\"编码\"><a class=\"markdownIt-Anchor\" href=\"#编码\">#</a> 编码</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">通过两个ASCII表示一个汉字，即为GB2312</span><br><span class=\"line\"></span><br><span class=\"line\">一个小于127的字符的意义与原来相同，但两个大于127的字符连在一起时，就表示一个汉字，前面的一个字节(他称之为高字节）从0xA1用至0xF7，后面一个字(低字节)从0xA1到0xFE，这样我们就可以组合出大约7000多个简体汉字了。</span><br><span class=\"line\"></span><br><span class=\"line\">一个char占一个字节，放不下gb2312</span><br><span class=\"line\">gb2312每个字节最高位都是1 </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>if</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if-else  /  if - if else else </span><br><span class=\"line\">只会执行其中一种分支</span><br></pre></td></tr></table></figure>\n<h3 id=\"程序内存\"><a class=\"markdownIt-Anchor\" href=\"#程序内存\">#</a> 程序内存</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">代码区  可读可执行</span><br><span class=\"line\"></span><br><span class=\"line\">堆栈   参数，局部变量，临时数据</span><br><span class=\"line\"></span><br><span class=\"line\">堆    动态申请，大小可变，可读可写</span><br><span class=\"line\"></span><br><span class=\"line\">全局变量   可读可写,程序运行时分配</span><br><span class=\"line\"></span><br><span class=\"line\">常量区    只读</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>全局变量的特点:<br>\n1、全局变量在程序编译完成后地址就已经确定下来了，只要程序启动，全局变量就已经存是否有值取决于声明时是否给定了初始值，如果没有，默认为 0</p>\n<p>2、全局变量的值可以被所有函数所修改，里面存储的是最后一次修改的值.</p>\n<p>3、全局变量所占内存会一直存在，知道整个进程结束.</p>\n<p>4、全局变量的反汇编识别:</p>\n<p>MOV 寄存器，byte/word/dword ptr ds: [0x12345678]</p>\n<p>通过寄存器的宽度，或者 byte/word/dword 来判断全局变量的宽度</p>\n<p>全局变量就是基址</p>\n<p>局部变量的特点</p>\n<p>1、局部变量在程序编译完成后并没有分配固定的地址.</p>\n<p>2、在所属的方法没有被调用时，局部变量并不会分配内存地址，只有调用时才在堆栈中分配内存.</p>\n<p>3、当局部变量所属的方法执行先毕后，局部变量所占用的内存将变成垃圾</p>\n<p>4、局部变量只能在方法内部使用，函数 A 无法使用函数 B 的局部变量.</p>\n<p>5、局部变量的反汇编识别:</p>\n<p>判断参数个数</p>\n<p>观察调用处的代码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 3</span><br><span class=\"line\">call </span><br></pre></td></tr></table></figure>\n<p>找到堆栈平衡的代码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">call</span><br><span class=\"line\">add esp,0C</span><br><span class=\"line\"></span><br><span class=\"line\">或者函数内部</span><br><span class=\"line\">ret 0xC</span><br></pre></td></tr></table></figure>\n<p>1、不考虑 ebp、 esp</p>\n<p>2、只找给别人赋值的寄存器 eax/ecx/edx/ebx/esi/edi</p>\n<p>3、找到以后追查其来源，如果，该寄存器中的值不是在函数内存赋值的，那一定是传进来的参数.</p>\n<p>公式一：寄存器 + ret4 = 参数个数</p>\n<p>公式二：寄存器＋[ebp+8] +[ebp+0x] = 参数个数</p>\n<h3 id=\"if语句\"><a class=\"markdownIt-Anchor\" href=\"#if语句\">#</a> if 语句</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int g_n = 10;</span><br><span class=\"line\">void func(int x, int y)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif (x&gt;y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tg_n = x;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax,dword ptr [ebp+8]</span><br><span class=\"line\">cmp eax,dword ptr [ebp+0x0C]</span><br><span class=\"line\">jle func+29h(401049)</span><br><span class=\"line\">mov ecx,dword ptr [ebp+8]</span><br><span class=\"line\">mov dword ptr [424a30],ecx</span><br><span class=\"line\">pop edi   401049</span><br></pre></td></tr></table></figure>\n<p>在反汇编中 jcc 的代码和 if 中的判断条件是相反的</p>\n<p>还原反汇编</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110133105437.png\" alt=\"image-20230110133105437\"></p>\n<p>函数内部功能分析:</p>\n<p>1、分析参数:[ebp+8] : x   [ebp+0Ch] :Y</p>\n<p>2、分析局部变量</p>\n<p>3、分析全局变量<br>\n mov dword ptr 004225c4,ecx</p>\n<p>4、功能分析<br>\n eax, dword ptr [ebp+8]<br>\ncmp eax, dword ptr [ebp+0Ch]</p>\n<p>将参数 x 存到到 EAX 中，然后比较 EAX。与参数 Y 的大小如果 x&lt;=Y 那么跳转到 00401059 的位置</p>\n<p>否则，将 X 的值存储到全局变量中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int a</span><br><span class=\"line\">int func(int x, int y)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint var1 = a;</span><br><span class=\"line\">\tif(x&lt;=y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\ty = var1 + y;</span><br><span class=\"line\">        a = y;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tret a</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>if 会有影响寄存器的语句，然后 JCC</p>\n<p>if-else 中会有向下跳的 jmp，通过 jmp 跳过 else 之后的代码</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230110141055410.png\" alt=\"image-20230110141055410\"></p>\n<p>1、当每个条件跳转指令要跳转的地址前面都有 jmp 指令</p>\n<p>2、这些 jmp 指令跳转的地址都是一样的</p>\n<p>3、如果某个分支没有条件判断，则为 else 部分中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">void HelloWorld()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;helloworld&quot;);</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint arr[5] = &#123;1,2,3,4,5&#125;;</span><br><span class=\"line\">\tarr[6] = (int)HelloWorld;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">004010C0 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">004010C1  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">004010C3  |.  83EC 54       sub     esp,0x54</span><br><span class=\"line\">004010C6  |.  53            push    ebx</span><br><span class=\"line\">004010C7  |.  56            push    esi</span><br><span class=\"line\">004010C8  |.  57            push    edi</span><br><span class=\"line\">004010C9  |.  8D7D AC       lea     edi,[local.21]</span><br><span class=\"line\">004010CC  |.  B9 15000000   mov     ecx,0x15</span><br><span class=\"line\">004010D1  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">004010D6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">004010D8  |.  C745 EC 01000&gt;mov     dword ptr ss:[ebp-0x14],0x1</span><br><span class=\"line\">004010DF  |.  C745 F0 02000&gt;mov     [local.4],0x2</span><br><span class=\"line\">004010E6  |.  C745 F4 03000&gt;mov     [local.3],0x3</span><br><span class=\"line\">004010ED  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class=\"line\">004010F4  |.  C745 FC 05000&gt;mov     dword ptr ss:[ebp-0x4],0x5</span><br><span class=\"line\">004010FB  |.  C745 04 05104&gt;mov     dword ptr ss:[ebp+0x4],00401005</span><br><span class=\"line\">00401102  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00401104  |.  5F            pop     edi</span><br><span class=\"line\">00401105  |.  5E            pop     esi</span><br><span class=\"line\">00401106  |.  5B            pop     ebx</span><br><span class=\"line\">00401107  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">00401109  |.  5D            pop     ebp</span><br><span class=\"line\">0040110A  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">0018FF28   CCCCCCCC</span><br><span class=\"line\">0018FF2C   CCCCCCCC</span><br><span class=\"line\">0018FF30   CCCCCCCC</span><br><span class=\"line\">0018FF34   CCCCCCCC</span><br><span class=\"line\">0018FF38   CCCCCCCC</span><br><span class=\"line\">0018FF3C   CCCCCCCC</span><br><span class=\"line\">0018FF40   CCCCCCCC</span><br><span class=\"line\">0018FF44   CCCCCCCC</span><br><span class=\"line\">0018FF48  /0018FF88  ebp</span><br><span class=\"line\">0018FF4C  |004015F9  返回到 88888.&lt;ModuleEntryPoint&gt;+0E9 来自 88888.0040100A</span><br><span class=\"line\"></span><br><span class=\"line\">0018FF28   CCCCCCCC</span><br><span class=\"line\">0018FF2C   CCCCCCCC</span><br><span class=\"line\">0018FF30   CCCCCCCC</span><br><span class=\"line\">0018FF34   00000001</span><br><span class=\"line\">0018FF38   00000002</span><br><span class=\"line\">0018FF3C   00000003</span><br><span class=\"line\">0018FF40   00000004</span><br><span class=\"line\">0018FF44   00000005</span><br><span class=\"line\">0018FF48   0018FF88  ebp</span><br><span class=\"line\">0018FF4C   00401005  88888.00401005</span><br><span class=\"line\"></span><br><span class=\"line\">00401005   . /E9 16000000   jmp     HelloWorld</span><br><span class=\"line\">0040100A   $ |E9 B1000000   jmp     main</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">void Func()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint i;</span><br><span class=\"line\">\tint arr[5] = &#123;0&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfor(i=0;i&lt;=5;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tarr[i]=0;</span><br><span class=\"line\">\t\tprintf(&quot;hello world&quot;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tFunc();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">004010C0 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">004010C1  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">004010C3  |.  83EC 40       sub     esp,0x40</span><br><span class=\"line\">004010C6  |.  53            push    ebx</span><br><span class=\"line\">004010C7  |.  56            push    esi</span><br><span class=\"line\">004010C8  |.  57            push    edi</span><br><span class=\"line\">004010C9  |.  8D7D C0       lea     edi,[local.16]</span><br><span class=\"line\">004010CC  |.  B9 10000000   mov     ecx,0x10</span><br><span class=\"line\">004010D1  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">004010D6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">004010D8  |.  E8 32FFFFFF   call    0040100F</span><br><span class=\"line\">004010DD  |.  33C0          xor     eax,eax</span><br><span class=\"line\">004010DF  |.  5F            pop     edi</span><br><span class=\"line\">004010E0  |.  5E            pop     esi</span><br><span class=\"line\">004010E1  |.  5B            pop     ebx</span><br><span class=\"line\">004010E2  |.  83C4 40       add     esp,0x40</span><br><span class=\"line\">004010E5  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">004010E7  |.  E8 E4030000   call    _chkesp</span><br><span class=\"line\">004010EC  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">004010EE  |.  5D            pop     ebp</span><br><span class=\"line\">004010EF  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\">00401005   . /E9 16000000   jmp     Func</span><br><span class=\"line\">0040100A   $ |E9 B1000000   jmp     main</span><br><span class=\"line\">0040100F  /$ |E9 0C000000   jmp     Func</span><br><span class=\"line\"></span><br><span class=\"line\">00401020 &gt;|&gt; \\55            push    ebp</span><br><span class=\"line\">00401021  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401023  |.  83EC 58       sub     esp,0x58</span><br><span class=\"line\">00401026  |.  53            push    ebx</span><br><span class=\"line\">00401027  |.  56            push    esi</span><br><span class=\"line\">00401028  |.  57            push    edi</span><br><span class=\"line\">00401029  |.  8D7D A8       lea     edi,[local.22]</span><br><span class=\"line\">0040102C  |.  B9 16000000   mov     ecx,0x16</span><br><span class=\"line\">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00401038  |.  C745 E8 00000&gt;mov     [local.6],0x0</span><br><span class=\"line\">0040103F  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00401041  |.  8945 EC       mov     [local.5],eax</span><br><span class=\"line\">00401044  |.  8945 F0       mov     [local.4],eax</span><br><span class=\"line\">00401047  |.  8945 F4       mov     [local.3],eax</span><br><span class=\"line\">0040104A  |.  8945 F8       mov     [local.2],eax</span><br><span class=\"line\">0040104D  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class=\"line\">00401054  |.  EB 09         jmp     short 0040105F</span><br><span class=\"line\">00401056  |&gt;  8B4D FC       /mov     ecx,[local.1]</span><br><span class=\"line\">00401059  |.  83C1 01       |add     ecx,0x1</span><br><span class=\"line\">0040105C  |.  894D FC       |mov     [local.1],ecx</span><br><span class=\"line\">0040105F  |&gt;  837D FC 05     cmp     [local.1],0x5</span><br><span class=\"line\">00401063  |.  7F 1A         |jg      short 0040107F</span><br><span class=\"line\">00401065  |.  8B55 FC       |mov     edx,[local.1]</span><br><span class=\"line\">00401068  |.  C74495 E8 000&gt;|mov     dword ptr ss:[ebp+edx*4-0x18],0&gt;</span><br><span class=\"line\">00401070  |.  68 1C304200   |push    0042301C                        ; /format = &quot;hello world&quot;</span><br><span class=\"line\">00401075  |.  E8 D6030000   |call    printf                          ; \\printf</span><br><span class=\"line\">0040107A  |.  83C4 04       |add     esp,0x4</span><br><span class=\"line\">0040107D  |.^ EB D7         \\jmp     short 00401056</span><br><span class=\"line\">0040107F  |&gt;  5F            pop     edi</span><br><span class=\"line\">00401080  |.  5E            pop     esi</span><br><span class=\"line\">00401081  |.  5B            pop     ebx</span><br><span class=\"line\">00401082  |.  83C4 58       add     esp,0x58</span><br><span class=\"line\">00401085  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">00401087  |.  E8 44040000   call    _chkesp</span><br><span class=\"line\">0040108C  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">0040108E  |.  5D            pop     ebp</span><br><span class=\"line\">0040108F  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\">mov     dword ptr ss:[ebp+edx*4-0x18],0 在最后一次循环将ebp-4 = i变为了0，循环条件永远满足</span><br></pre></td></tr></table></figure>\n<p>总结:</p>\n<p>声明变量就是告诉计算机，我要用一块内存，你给我留着，宽度和存储格式有数据类型决定.</p>\n<p>计算机什么时候把这块内存给你，取决于变量的作用范围，如果是全局变量，在程序编译完就已经分配了空间，如果是局所在的程序被调用的时候，才会分配空间.</p>\n<p>全局变量如果不赋初始值，默认是 0，但局部变量在使用前一定要赋初值.</p>\n<p>类型转换</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">movsx   ;先符号扩展再传送</span><br><span class=\"line\">mov al,0x0FF     </span><br><span class=\"line\">movsx cx,al      11111111 11111111 </span><br><span class=\"line\">movsx al,80</span><br><span class=\"line\">movsx cx,al</span><br><span class=\"line\"></span><br><span class=\"line\">movzx</span><br><span class=\"line\">mov al,0x0ff</span><br><span class=\"line\">movzx cx,al</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int -&gt; short 转换时高位丢失，即从低位开始截取</span><br><span class=\"line\">int a = 0x12345678;</span><br><span class=\"line\">short b = a;     b = 5678</span><br></pre></td></tr></table></figure>\n<p>表达式</p>\n<p>特点一:</p>\n<p>表达式无论多么复杂，都只有一个结果</p>\n<p>特点二:</p>\n<p>只有表达式，可以编译通过，但并不生成代码，需要与赋值或者其他流程控制语句一起组合的时候才有意义</p>\n<p>特点三:</p>\n<p>当表达式中存在不同宽度的变量时，结果将转换为宽度最大的那个</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">char a = 10;</span><br><span class=\"line\">int b = 20;</span><br><span class=\"line\">printf(&quot;%d&quot;,a+b);   ;a+b为int类型</span><br></pre></td></tr></table></figure>\n<p>特点四:</p>\n<p>当表达式中同时存在有符号和无符号数的时候，表达式的结构将转换为无符号数.</p>\n<p>输出无符号或有符号根据输出的格式 % d 或 % u 决定</p>\n<p>int x = a == b;    ;sete  setne</p>\n<p>sete cmp 相等时 set 寄存器为 1</p>\n<p>if(a) == if(a != 0)</p>\n<p>if(!a) == if(a == 0)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (x&gt;1 &amp;&amp; x&gt;2 &amp;&amp; x&gt;3)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;sb&quot;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if (x&gt;1 || x&gt;2 || x&gt;3)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;sb&quot;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00401020 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">00401021  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401023  |.  83EC 44       sub     esp,0x44</span><br><span class=\"line\">00401026  |.  53            push    ebx</span><br><span class=\"line\">00401027  |.  56            push    esi</span><br><span class=\"line\">00401028  |.  57            push    edi</span><br><span class=\"line\">00401029  |.  8D7D BC       lea     edi,[local.17]</span><br><span class=\"line\">0040102C  |.  B9 11000000   mov     ecx,0x11</span><br><span class=\"line\">00401031  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401036  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00401038  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class=\"line\">0040103F  |.  837D FC 01    cmp     [local.1],0x1</span><br><span class=\"line\">00401043  |.  7E 19         jle     short 0040105E</span><br><span class=\"line\">00401045  |.  837D FC 02    cmp     [local.1],0x2</span><br><span class=\"line\">00401049  |.  7E 13         jle     short 0040105E</span><br><span class=\"line\">0040104B  |.  837D FC 03    cmp     [local.1],0x3</span><br><span class=\"line\">0040104F  |.  7E 0D         jle     short 0040105E</span><br><span class=\"line\">00401051  |.  68 1C304200   push    0042301C                         ; /format = &quot;sb&quot;</span><br><span class=\"line\">00401056  |.  E8 F5030000   call    printf                           ; \\printf</span><br><span class=\"line\">0040105B  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">0040105E  |&gt;  837D FC 01    cmp     [local.1],0x1</span><br><span class=\"line\">00401062  |.  7F 0C         jg      short 00401070</span><br><span class=\"line\">00401064  |.  837D FC 02    cmp     [local.1],0x2</span><br><span class=\"line\">00401068  |.  7F 06         jg      short 00401070</span><br><span class=\"line\">0040106A  |.  837D FC 03    cmp     [local.1],0x3</span><br><span class=\"line\">0040106E  |.  7E 0D         jle     short 0040107D</span><br><span class=\"line\">00401070  |&gt;  68 1C304200   push    0042301C                         ; /format = &quot;sb&quot;</span><br><span class=\"line\">00401075  |.  E8 D6030000   call    printf                           ; \\printf</span><br><span class=\"line\">0040107A  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">0040107D  |&gt;  33C0          xor     eax,eax</span><br><span class=\"line\">0040107F  |.  5F            pop     edi</span><br><span class=\"line\">00401080  |.  5E            pop     esi</span><br><span class=\"line\">00401081  |.  5B            pop     ebx</span><br><span class=\"line\">00401082  |.  83C4 44       add     esp,0x44</span><br><span class=\"line\">00401085  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">00401087  |.  E8 44040000   call    _chkesp</span><br><span class=\"line\">0040108C  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">0040108E  |.  5D            pop     ebp</span><br><span class=\"line\">0040108F  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>C 语言没有 bool，C++ 才有</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">if (x = 0)   //不执行</span><br><span class=\"line\">if (x = 2)   //执行</span><br><span class=\"line\">int a = 3;</span><br><span class=\"line\">if (a == 3)  //执行</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、将两个变量的值交换.</span><br><span class=\"line\">2、将一个数组中的数倒序输出.</span><br><span class=\"line\">3、找出数组里面最大的值，并返回</span><br><span class=\"line\">4、将数组所有的元素相加，将结果返回</span><br><span class=\"line\">5、将两个等长数组相同位置的值相加，存储到另外一个等长的数组中</span><br><span class=\"line\">6、写一个函数int prime(int x)，如果x是素数返回值为1，否则返回0。</span><br><span class=\"line\">7、俩俩比较数组的值，将最大的一个存储到数组的最后一个位置</span><br><span class=\"line\">8、编写程序实现一个冒泡排序的算法.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"循环语句\"><a class=\"markdownIt-Anchor\" href=\"#循环语句\">#</a> 循环语句</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">do...while   性能最高的循环</span><br><span class=\"line\">while </span><br><span class=\"line\">for</span><br><span class=\"line\"></span><br><span class=\"line\">int length = 10</span><br><span class=\"line\">int m = 0</span><br><span class=\"line\">int arr[10] = &#123;   &#125;</span><br><span class=\"line\">while (m &lt; length - 1)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfor (int i = 1; i &lt; length-1-m;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tswap(arr[i],arr[i+1]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tm++;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>返回值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">如果返回值只有8位，使用al返回</span><br><span class=\"line\">ax</span><br><span class=\"line\">eax</span><br><span class=\"line\"></span><br><span class=\"line\">long long 在vc6中对应的是__int64</span><br><span class=\"line\"></span><br><span class=\"line\">__int64 Function()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__int64 x = 0x1234567890;</span><br><span class=\"line\">\treturn x;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">00401020 &gt;/&gt; \\55                    push    ebp</span><br><span class=\"line\">00401021  |.  8BEC                  mov     ebp,esp</span><br><span class=\"line\">00401023  |.  83EC 48               sub     esp,0x48</span><br><span class=\"line\">00401026  |.  53                    push    ebx</span><br><span class=\"line\">00401027  |.  56                    push    esi</span><br><span class=\"line\">00401028  |.  57                    push    edi</span><br><span class=\"line\">00401029  |.  8D7D B8               lea     edi,[local.18]</span><br><span class=\"line\">0040102C  |.  B9 12000000           mov     ecx,0x12</span><br><span class=\"line\">00401031  |.  B8 CCCCCCCC           mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401036  |.  F3:AB                 rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00401038  |.  C745 F8 90785634      mov     [local.2],0x34567890</span><br><span class=\"line\">0040103F  |.  C745 FC 12000000      mov     [local.1],0x12</span><br><span class=\"line\">00401046  |.  8B45 F8               mov     eax,[local.2]</span><br><span class=\"line\">00401049  |.  8B55 FC               mov     edx,[local.1]</span><br><span class=\"line\">0040104C  |.  5F                    pop     edi</span><br><span class=\"line\">0040104D  |.  5E                    pop     esi</span><br><span class=\"line\">0040104E  |.  5B                    pop     ebx</span><br><span class=\"line\">0040104F  |.  8BE5                  mov     esp,ebp</span><br><span class=\"line\">00401051  |.  5D                    pop     ebp</span><br><span class=\"line\">00401052  \\.  C3                    retn</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>参数传递</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void func(char a,char b,char c)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar a = 1,b=2,c=3;</span><br><span class=\"line\">\tfunc(a,b,c);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">0040D758  |.  C645 FC 01    mov     byte ptr ss:[ebp-0x4],0x1</span><br><span class=\"line\">0040D75C  |.  C645 F8 02    mov     byte ptr ss:[ebp-0x8],0x2</span><br><span class=\"line\">0040D760  |.  C645 F4 03    mov     byte ptr ss:[ebp-0xC],0x3</span><br><span class=\"line\">0040D764  |.  8A45 F4       mov     al,byte ptr ss:[ebp-0xC]</span><br><span class=\"line\">0040D767  |.  50            push    eax</span><br><span class=\"line\">0040D768  |.  8A4D F8       mov     cl,byte ptr ss:[ebp-0x8]</span><br><span class=\"line\">0040D76B  |.  51            push    ecx</span><br><span class=\"line\">0040D76C  |.  8A55 FC       mov     dl,byte ptr ss:[ebp-0x4]</span><br><span class=\"line\">0040D76F  |.  52            push    edx</span><br><span class=\"line\">0040D770  |.  E8 9A38FFFF   call    0040100F</span><br><span class=\"line\">0040D775  |.  83C4 0C       add     esp,0xC</span><br><span class=\"line\"></span><br><span class=\"line\">虽然定义的是char，但在压栈的时候还是会按照四字节的压，所以没法节约空间</span><br><span class=\"line\"></span><br><span class=\"line\">本机尺寸：本机32位，那么对32位的数据支持最好</span><br><span class=\"line\"></span><br><span class=\"line\">编译器遵守这个规则</span><br><span class=\"line\"></span><br><span class=\"line\">传输数据按照本机尺寸传，用还是按照原来大小用</span><br><span class=\"line\"></span><br><span class=\"line\">传参的时候如果是&lt;int的整数，一律使用int类型 </span><br><span class=\"line\"></span><br><span class=\"line\">参数传递的本质:将上层函数的变量，或者表达式的值“复制一份”，传递给下层函数.  可以理解为[ebp-4] 和 [ebp+8]的区别</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>局部变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">空函数会分配40h的缓冲区,如果使用局部变量会在40h的基础上增加，  只适用于vc6-debug</span><br><span class=\"line\"></span><br><span class=\"line\">void func()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar a = 1;</span><br><span class=\"line\">\tchar b = 2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">此时缓冲区分配了48，因为本机尺寸</span><br><span class=\"line\"></span><br><span class=\"line\">1、小于32位的局部变量，空间在分配时，按32位分配.</span><br><span class=\"line\">2、使用时按实际的宽度使用.</span><br><span class=\"line\">3、不要定义char/short类型的局部变量.</span><br><span class=\"line\">4、参数与局部变量没有本质区别，都是局部变量，都在栈中</span><br><span class=\"line\">5、完全可以把参数当初局部变量使用</span><br><span class=\"line\"></span><br><span class=\"line\">参数在执行前分配，局部变量在执行时分配，本质一样</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> a[<span class=\"number\">3</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>&#125;;</span><br><span class=\"line\"><span class=\"number\">0040</span>D740 &gt;/&gt; \\<span class=\"number\">55</span>            push    ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D741  |.  <span class=\"number\">8B</span>EC          mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D743  |.  <span class=\"number\">83</span>EC <span class=\"number\">44</span>       sub     esp,<span class=\"number\">0x44</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D746  |.  <span class=\"number\">53</span>            push    ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D747  |.  <span class=\"number\">56</span>            push    esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D748  |.  <span class=\"number\">57</span>            push    edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D749  |.  <span class=\"number\">8</span>D7D BC       lea     edi,[local<span class=\"number\">.17</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D74C  |.  B9 <span class=\"number\">11000000</span>   mov     ecx,<span class=\"number\">0x11</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D751  |.  B8 CCCCCCCC   mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D756  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D758  |.  C645 FC <span class=\"number\">01</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x4</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D75C  |.  C645 FD <span class=\"number\">02</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x3</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D760  |.  C645 FE <span class=\"number\">03</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x2</span>],<span class=\"number\">0x3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D764  |.  <span class=\"number\">5F</span>            pop     edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D765  |.  <span class=\"number\">5</span>E            pop     esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D766  |.  <span class=\"number\">5B</span>            pop     ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D767  |.  <span class=\"number\">8B</span>E5          mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D769  |.  <span class=\"number\">5</span>D            pop     ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D76A  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> a[<span class=\"number\">4</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>&#125;;</span><br><span class=\"line\"><span class=\"number\">0040</span>D740 &gt;/&gt; \\<span class=\"number\">55</span>            push    ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D741  |.  <span class=\"number\">8B</span>EC          mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D743  |.  <span class=\"number\">83</span>EC <span class=\"number\">44</span>       sub     esp,<span class=\"number\">0x44</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D746  |.  <span class=\"number\">53</span>            push    ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D747  |.  <span class=\"number\">56</span>            push    esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D748  |.  <span class=\"number\">57</span>            push    edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D749  |.  <span class=\"number\">8</span>D7D BC       lea     edi,[local<span class=\"number\">.17</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D74C  |.  B9 <span class=\"number\">11000000</span>   mov     ecx,<span class=\"number\">0x11</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D751  |.  B8 CCCCCCCC   mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D756  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D758  |.  C645 FC <span class=\"number\">01</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x4</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D75C  |.  C645 FD <span class=\"number\">02</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x3</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D760  |.  C645 FE <span class=\"number\">03</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x2</span>],<span class=\"number\">0x3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D764  |.  C645 FF <span class=\"number\">04</span>    mov     byte ptr ss:[ebp<span class=\"number\">-0x1</span>],<span class=\"number\">0x4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D768  |.  <span class=\"number\">5F</span>            pop     edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D769  |.  <span class=\"number\">5</span>E            pop     esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D76A  |.  <span class=\"number\">5B</span>            pop     ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D76B  |.  <span class=\"number\">8B</span>E5          mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D76D  |.  <span class=\"number\">5</span>D            pop     ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D76E  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">数组声明是需要常量来提升堆栈，使用时[]内可以是变量</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"type\">char</span> i[<span class=\"number\">3</span>]  <span class=\"comment\">//缓冲区分配40+4</span></span><br><span class=\"line\"><span class=\"type\">char</span> i[<span class=\"number\">4</span>]  <span class=\"comment\">//缓冲区分配40+4</span></span><br><span class=\"line\"><span class=\"type\">short</span> i[<span class=\"number\">4</span>] <span class=\"comment\">//缓冲区分配40+4*2</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">//缓冲区分配是按照本机宽度位数的倍数分配的，参考char[3] 和 char[4]</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> x = <span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> y = <span class=\"number\">2</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> r;</span><br><span class=\"line\">    <span class=\"type\">int</span> arr[<span class=\"number\">10</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\">    r = arr[<span class=\"number\">1</span>];</span><br><span class=\"line\">    r = arr[x];</span><br><span class=\"line\">    r = arr[x+y];</span><br><span class=\"line\">    r = arr[x*<span class=\"number\">2</span>+y];</span><br><span class=\"line\">&#125;    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D770 &gt;/&gt; \\<span class=\"number\">55</span>                  push    ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D771  |.  <span class=\"number\">8B</span>EC                mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D773  |.  <span class=\"number\">83</span>EC <span class=\"number\">74</span>             sub     esp,<span class=\"number\">0x74</span>        ;<span class=\"number\">0x74</span><span class=\"number\">-0x40</span>=<span class=\"number\">0x34</span>=<span class=\"number\">52</span>/<span class=\"number\">4</span>=<span class=\"number\">13</span> = <span class=\"number\">10</span> + <span class=\"number\">1</span> + <span class=\"number\">1</span> + <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D776  |.  <span class=\"number\">53</span>                  push    ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D777  |.  <span class=\"number\">56</span>                  push    esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D778  |.  <span class=\"number\">57</span>                  push    edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D779  |.  <span class=\"number\">8</span>D7D <span class=\"number\">8</span>C             lea     edi,[local<span class=\"number\">.29</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D77C  |.  B9 <span class=\"number\">1</span>D000000         mov     ecx,<span class=\"number\">0x1D</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D781  |.  B8 CCCCCCCC         mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D786  |.  F3:AB               rep     stos dword ptr es:[edi]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D788  |.  C745 FC <span class=\"number\">01000000</span>    mov     [local<span class=\"number\">.1</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D78F  |.  C745 F8 <span class=\"number\">02000000</span>    mov     [local<span class=\"number\">.2</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D796  |.  C745 CC <span class=\"number\">01000000</span>    mov     [local<span class=\"number\">.13</span>],<span class=\"number\">0x1</span>      ;低地址在上</span><br><span class=\"line\"><span class=\"number\">0040</span>D79D  |.  C745 D0 <span class=\"number\">02000000</span>    mov     [local<span class=\"number\">.12</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7A4  |.  C745 D4 <span class=\"number\">03000000</span>    mov     [local<span class=\"number\">.11</span>],<span class=\"number\">0x3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7AB  |.  C745 D8 <span class=\"number\">04000000</span>    mov     [local<span class=\"number\">.10</span>],<span class=\"number\">0x4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7B2  |.  C745 DC <span class=\"number\">05000000</span>    mov     [local<span class=\"number\">.9</span>],<span class=\"number\">0x5</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7B9  |.  C745 E0 <span class=\"number\">06000000</span>    mov     [local<span class=\"number\">.8</span>],<span class=\"number\">0x6</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7C0  |.  C745 E4 <span class=\"number\">07000000</span>    mov     [local<span class=\"number\">.7</span>],<span class=\"number\">0x7</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7C7  |.  C745 E8 <span class=\"number\">08000000</span>    mov     [local<span class=\"number\">.6</span>],<span class=\"number\">0x8</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7CE  |.  C745 EC <span class=\"number\">09000000</span>    mov     [local<span class=\"number\">.5</span>],<span class=\"number\">0x9</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7D5  |.  C745 F0 <span class=\"number\">00000000</span>    mov     [local<span class=\"number\">.4</span>],<span class=\"number\">0x0</span></span><br><span class=\"line\"></span><br><span class=\"line\">;    r = arr[<span class=\"number\">1</span>];</span><br><span class=\"line\"><span class=\"number\">0040</span>D7DC  |.  <span class=\"number\">8B</span>45 D0             mov     eax,[local<span class=\"number\">.12</span>]                                ; 反汇编中写的是定值，直接取值</span><br><span class=\"line\"><span class=\"number\">0040</span>D7DF  |.  <span class=\"number\">8945</span> F4             mov     [local<span class=\"number\">.3</span>],eax                                 ;r = arr[<span class=\"number\">1</span>] = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">;    r = arr[x];</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E2  |.  <span class=\"number\">8B</span>4D FC             mov     ecx,[local<span class=\"number\">.1</span>]\t\t\t\t\t\t\t\t\t; ecx = <span class=\"number\">1</span>     <span class=\"number\">0x34</span> = <span class=\"number\">52</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7E5  |.  <span class=\"number\">8B</span>548D CC           mov     edx,dword ptr ss:[ebp+ecx*<span class=\"number\">4</span><span class=\"number\">-0x34</span>]             ; edx = <span class=\"number\">4</span><span class=\"number\">-34</span>=ebp<span class=\"number\">-0x30</span>=[local<span class=\"number\">.12</span>]=<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7E9  |.  <span class=\"number\">8955</span> F4             mov     [local<span class=\"number\">.3</span>],edx\t\t\t\t\t\t\t\t\t; r = <span class=\"number\">2</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D7EC  |.  <span class=\"number\">8B</span>45 FC             mov     eax,[local<span class=\"number\">.1</span>]\t\t\t\t\t\t\t\t\t; <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7EF  |.  <span class=\"number\">0345</span> F8             add     eax,[local<span class=\"number\">.2</span>]\t\t\t\t\t\t\t\t\t; eax = <span class=\"number\">1</span>+<span class=\"number\">2</span> = <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7F2  |.  <span class=\"number\">8B</span>4C85 CC           mov     ecx,dword ptr ss:[ebp+eax*<span class=\"number\">4</span><span class=\"number\">-0x34</span>]\t\t\t\t; ecx = [ebp<span class=\"number\">-0x28</span>] = [local<span class=\"number\">.10</span>] = <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7F6  |.  <span class=\"number\">894</span>D F4             mov     [local<span class=\"number\">.3</span>],ecx\t\t\t\t\t\t\t\t\t; r = <span class=\"number\">4</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D7F9  |.  <span class=\"number\">8B</span>55 FC             mov     edx,[local<span class=\"number\">.1</span>]\t\t\t\t\t\t\t\t\t; edx = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7FC  |.  <span class=\"number\">8B</span>45 F8             mov     eax,[local<span class=\"number\">.2</span>]\t\t\t\t\t\t\t\t\t; eax = <span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7FF  |.  <span class=\"number\">8</span>D0C50              lea     ecx,dword ptr ds:[eax+edx*<span class=\"number\">2</span>]\t\t\t\t\t; ecx = <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D802  |.  <span class=\"number\">8B</span>548D CC           mov     edx,dword ptr ss:[ebp+ecx*<span class=\"number\">4</span><span class=\"number\">-0x34</span>]             ; edx = [local<span class=\"number\">.9</span>] = <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D806  |.  <span class=\"number\">8955</span> F4             mov     [local<span class=\"number\">.3</span>],edx\t\t\t\t\t\t\t\t\t; r= <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D809  |.  <span class=\"number\">5F</span>                  pop     edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D80A  |.  <span class=\"number\">5</span>E                  pop     esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D80B  |.  <span class=\"number\">5B</span>                  pop     ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D80C  |.  <span class=\"number\">8B</span>E5                mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D80E  |.  <span class=\"number\">5</span>D                  pop     ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D80F  \\.  C3                  retn</span><br><span class=\"line\"></span><br><span class=\"line\">[ebp+ecx*<span class=\"number\">4</span><span class=\"number\">-0x34</span>]  每次减去<span class=\"number\">0x34</span>的原因，<span class=\"number\">0x34</span> = <span class=\"number\">52</span>，是该函数内所有局部变量一共分配的空间</span><br><span class=\"line\">ecx的值即为数组下标,去对应数组的下标即可取到对应的值,注意下标从<span class=\"number\">0</span>开始</span><br><span class=\"line\"><span class=\"type\">short</span> ecx * <span class=\"number\">2</span></span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"type\">int</span> a[<span class=\"number\">10</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>&#125;     <span class=\"comment\">//后面会用0补</span></span><br><span class=\"line\"></span><br><span class=\"line\">二维数组在汇编中和一维数组存储方式一样</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"type\">int</span> a[<span class=\"number\">3</span>][<span class=\"number\">4</span>] = &#123;[<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>],[],[]&#125;     <span class=\"comment\">//编译报错</span></span><br><span class=\"line\"><span class=\"type\">int</span> a[<span class=\"number\">3</span>][<span class=\"number\">4</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>,<span class=\"number\">12</span>&#125;;  <span class=\"comment\">//正常执行</span></span><br><span class=\"line\">多维数组只是用户使用方便，编译后的结果都一样</span><br><span class=\"line\"><span class=\"type\">int</span> a[][<span class=\"number\">4</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>,<span class=\"number\">12</span>&#125;;   <span class=\"comment\">//编译通过，编译器四个一组分配</span></span><br><span class=\"line\"><span class=\"type\">int</span> a[<span class=\"number\">3</span>][] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>,<span class=\"number\">12</span>&#125;;   <span class=\"comment\">//编译错误</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> arr[<span class=\"number\">5</span>][<span class=\"number\">12</span>] = &#123;&#125;</span><br><span class=\"line\">arr[<span class=\"number\">1</span>][<span class=\"number\">7</span>] = arr[<span class=\"number\">1</span>*<span class=\"number\">12</span>+<span class=\"number\">7</span>];</span><br><span class=\"line\"><span class=\"type\">int</span> arr[<span class=\"number\">5</span>][<span class=\"number\">4</span>][<span class=\"number\">3</span>] = arr[<span class=\"number\">1</span>*<span class=\"number\">4</span>*<span class=\"number\">3</span> + <span class=\"number\">2</span>*<span class=\"number\">3</span> + <span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">桶排序</span><br><span class=\"line\"><span class=\"number\">1.</span>找数组中最大的，创建max+<span class=\"number\">1</span>个数的数组</span><br><span class=\"line\"><span class=\"number\">2.</span>下标对应改为出现的次数</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">dui</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a[<span class=\"number\">10</span>] = &#123;<span class=\"number\">9</span>,<span class=\"number\">8</span>,<span class=\"number\">7</span>,<span class=\"number\">7</span>,<span class=\"number\">6</span>,<span class=\"number\">6</span>,<span class=\"number\">3</span>,<span class=\"number\">3</span>,<span class=\"number\">1</span>,<span class=\"number\">1</span>&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">int</span> max = a[<span class=\"number\">0</span>];</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> p = <span class=\"number\">1</span>; p &lt; <span class=\"number\">10</span>; p++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (a[p]&gt;max)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tmax = a[p];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,max);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">int</span> b[max] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt;= max<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tb[a[i]]++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (i = <span class=\"number\">0</span>; i &lt;= max<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">\t&#123; </span><br><span class=\"line\">\t\t<span class=\"type\">int</span> k = b[i];</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (k &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> m = k; m&gt;<span class=\"number\">0</span>; m--)</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d &quot;</span>,i);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tdui();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230113171701402.png\" alt=\"image-20230113171701402\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230114173623044.png\" alt=\"image-20230114173623044\"></p>\n<h3 id=\"结构体\"><a class=\"markdownIt-Anchor\" href=\"#结构体\">#</a> 结构体</h3>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">B</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"type\">float</span> x;</span><br><span class=\"line\">    <span class=\"type\">float</span> y;</span><br><span class=\"line\">    <span class=\"type\">float</span> z;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    <span class=\"type\">int</span> m_up;</span><br><span class=\"line\">\t<span class=\"type\">char</span> m_Name[<span class=\"number\">32</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> m_Num;</span><br><span class=\"line\">    ...</span><br><span class=\"line\">    B zuobiao;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">A aa;</span><br><span class=\"line\"><span class=\"comment\">// aa + 4 //m_up</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">A 通过一级偏移找到B zuobiao</span><br><span class=\"line\">zuobiao通过二级偏移找到xyz</span><br><span class=\"line\">    </span><br><span class=\"line\">结构体在创建时不分配空间</span><br><span class=\"line\">A aa;   此时分配空间</span><br><span class=\"line\">aa.fXpos = <span class=\"number\">2.1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">结构体在定义的时候，除了自身以外，可以存储任何类型</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct AA</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint m;</span><br><span class=\"line\">\tint n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">struct  st</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tshort b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">\tint arr[10];</span><br><span class=\"line\">\tAA aa;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">st x;</span><br><span class=\"line\"></span><br><span class=\"line\">void func()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tx.a = 10;</span><br><span class=\"line\">\tx.b = 20;</span><br><span class=\"line\">\tx.c = 30;</span><br><span class=\"line\">\tx.arr[0] = 100;</span><br><span class=\"line\">\tx.aa.m = 22;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void func2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a1  = x.a;</span><br><span class=\"line\">\tint y1 = x.arr[0];</span><br><span class=\"line\">\tint y2 = x.aa.m;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">st func()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tst s;</span><br><span class=\"line\">\ts.a = 1;</span><br><span class=\"line\">\ts.b = 2;</span><br><span class=\"line\">\ts.c = 3;</span><br><span class=\"line\">\treturn s;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>数组和结构体判断</p>\n<p>等宽连续 - 数组</p>\n<p>连续不等宽 - 大概率结构体</p>\n<p>但结构体中都是相同类型的变量也可以逆成数组</p>\n<p>结构体尽量定义为全局变量，减少复制次数，尽量不要当参数和返回值</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 结构体作为全局变量</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">st</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> a;</span><br><span class=\"line\">\t<span class=\"type\">short</span> b;</span><br><span class=\"line\">\t<span class=\"type\">char</span> c;</span><br><span class=\"line\">\t<span class=\"type\">int</span> arr[<span class=\"number\">10</span>];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">st x;</span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tx.a = <span class=\"number\">10</span>;</span><br><span class=\"line\">\tx.b = <span class=\"number\">20</span>;</span><br><span class=\"line\">\tx.c = <span class=\"number\">30</span>;</span><br><span class=\"line\">\tx.arr[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">\tx.arr[<span class=\"number\">1</span>] = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func2</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a1 = x.a;</span><br><span class=\"line\">\t<span class=\"type\">int</span> b1 = x.b;</span><br><span class=\"line\">\t<span class=\"type\">int</span> c1 = x.c;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfunc();</span><br><span class=\"line\">\tfunc2();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401030</span> &gt;/&gt; \\<span class=\"number\">55</span>            push    ebp</span><br><span class=\"line\"><span class=\"number\">00401031</span>  |.  <span class=\"number\">8B</span>EC          mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401033</span>  |.  <span class=\"number\">83</span>EC <span class=\"number\">40</span>       sub     esp,<span class=\"number\">0x40</span></span><br><span class=\"line\"><span class=\"number\">00401036</span>  |.  <span class=\"number\">53</span>            push    ebx</span><br><span class=\"line\"><span class=\"number\">00401037</span>  |.  <span class=\"number\">56</span>            push    esi</span><br><span class=\"line\"><span class=\"number\">00401038</span>  |.  <span class=\"number\">57</span>            push    edi</span><br><span class=\"line\"><span class=\"number\">00401039</span>  |.  <span class=\"number\">8</span>D7D C0       lea     edi,[local<span class=\"number\">.16</span>]</span><br><span class=\"line\"><span class=\"number\">0040103</span>C  |.  B9 <span class=\"number\">10000000</span>   mov     ecx,<span class=\"number\">0x10</span></span><br><span class=\"line\"><span class=\"number\">00401041</span>  |.  B8 CCCCCCCC   mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">00401046</span>  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">00401048</span>  |.  C705 <span class=\"number\">507</span>C4200&gt;mov     dword ptr ds:[<span class=\"number\">0x427C50</span>],<span class=\"number\">0xA</span></span><br><span class=\"line\"><span class=\"number\">00401052</span>  |.  <span class=\"number\">66</span>:C705 <span class=\"number\">547</span>C4&gt;mov     word ptr ds:[<span class=\"number\">0x427C54</span>],<span class=\"number\">0x14</span></span><br><span class=\"line\"><span class=\"number\">0040105B</span>  |.  C605 <span class=\"number\">567</span>C4200&gt;mov     byte ptr ds:[<span class=\"number\">0x427C56</span>],<span class=\"number\">0x1E</span></span><br><span class=\"line\"><span class=\"number\">00401062</span>  |.  C705 <span class=\"number\">587</span>C4200&gt;mov     dword ptr ds:[<span class=\"number\">0x427C58</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">0040106</span>C  |.  C705 <span class=\"number\">5</span>C7C4200&gt;mov     dword ptr ds:[<span class=\"number\">0x427C5C</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\"><span class=\"number\">00401076</span>  |.  <span class=\"number\">5F</span>            pop     edi</span><br><span class=\"line\"><span class=\"number\">00401077</span>  |.  <span class=\"number\">5</span>E            pop     esi</span><br><span class=\"line\"><span class=\"number\">00401078</span>  |.  <span class=\"number\">5B</span>            pop     ebx</span><br><span class=\"line\"><span class=\"number\">00401079</span>  |.  <span class=\"number\">8B</span>E5          mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040107B</span>  |.  <span class=\"number\">5</span>D            pop     ebp</span><br><span class=\"line\"><span class=\"number\">0040107</span>C  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401090</span> &gt;/&gt; \\<span class=\"number\">55</span>            push    ebp</span><br><span class=\"line\"><span class=\"number\">00401091</span>  |.  <span class=\"number\">8B</span>EC          mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401093</span>  |.  <span class=\"number\">83</span>EC <span class=\"number\">4</span>C       sub     esp,<span class=\"number\">0x4C</span></span><br><span class=\"line\"><span class=\"number\">00401096</span>  |.  <span class=\"number\">53</span>            push    ebx</span><br><span class=\"line\"><span class=\"number\">00401097</span>  |.  <span class=\"number\">56</span>            push    esi</span><br><span class=\"line\"><span class=\"number\">00401098</span>  |.  <span class=\"number\">57</span>            push    edi</span><br><span class=\"line\"><span class=\"number\">00401099</span>  |.  <span class=\"number\">8</span>D7D B4       lea     edi,[local<span class=\"number\">.19</span>]</span><br><span class=\"line\"><span class=\"number\">0040109</span>C  |.  B9 <span class=\"number\">13000000</span>   mov     ecx,<span class=\"number\">0x13</span></span><br><span class=\"line\"><span class=\"number\">004010</span>A1  |.  B8 CCCCCCCC   mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">004010</span>A6  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">004010</span>A8  |.  A1 <span class=\"number\">507</span>C4200   mov     eax,dword ptr ds:[<span class=\"number\">0x427C50</span>]</span><br><span class=\"line\"><span class=\"number\">004010</span>AD  |.  <span class=\"number\">8945</span> FC       mov     [local<span class=\"number\">.1</span>],eax</span><br><span class=\"line\"><span class=\"number\">004010B</span>0  |.  <span class=\"number\">0F</span>BF0D <span class=\"number\">547</span>C42&gt;movsx   ecx,word ptr ds:[<span class=\"number\">0x427C54</span>]</span><br><span class=\"line\"><span class=\"number\">004010B</span>7  |.  <span class=\"number\">894</span>D F8       mov     [local<span class=\"number\">.2</span>],ecx</span><br><span class=\"line\"><span class=\"number\">004010B</span>A  |.  <span class=\"number\">0F</span>BE15 <span class=\"number\">567</span>C42&gt;movsx   edx,byte ptr ds:[<span class=\"number\">0x427C56</span>]</span><br><span class=\"line\"><span class=\"number\">004010</span>C1  |.  <span class=\"number\">8955</span> F4       mov     [local<span class=\"number\">.3</span>],edx</span><br><span class=\"line\"><span class=\"number\">004010</span>C4  |.  <span class=\"number\">5F</span>            pop     edi</span><br><span class=\"line\"><span class=\"number\">004010</span>C5  |.  <span class=\"number\">5</span>E            pop     esi</span><br><span class=\"line\"><span class=\"number\">004010</span>C6  |.  <span class=\"number\">5B</span>            pop     ebx</span><br><span class=\"line\"><span class=\"number\">004010</span>C7  |.  <span class=\"number\">8B</span>E5          mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">004010</span>C9  |.  <span class=\"number\">5</span>D            pop     ebp</span><br><span class=\"line\"><span class=\"number\">004010</span>CA  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//结构体作为局部变量</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Pointer</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">float</span> x_pos;</span><br><span class=\"line\">\t<span class=\"type\">float</span> y_pos;</span><br><span class=\"line\">\t<span class=\"type\">float</span> z_pos;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">st</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a;</span><br><span class=\"line\">\t<span class=\"type\">short</span> b;</span><br><span class=\"line\">\t<span class=\"type\">char</span> c;</span><br><span class=\"line\">\t<span class=\"type\">int</span> arr[<span class=\"number\">10</span>];</span><br><span class=\"line\">\tPointer p1;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tst x;</span><br><span class=\"line\">\tx.a = <span class=\"number\">10</span>;</span><br><span class=\"line\">\tx.b = <span class=\"number\">20</span>;</span><br><span class=\"line\">\tx.c = <span class=\"number\">30</span>;</span><br><span class=\"line\">\tx.arr[<span class=\"number\">0</span>] = <span class=\"number\">1</span>;</span><br><span class=\"line\">\tx.arr[<span class=\"number\">1</span>] = <span class=\"number\">2</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx.p1.x_pos = <span class=\"number\">2.1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401020</span> &gt;/&gt; \\<span class=\"number\">55</span>                    push    ebp</span><br><span class=\"line\"><span class=\"number\">00401021</span>  |.  <span class=\"number\">8B</span>EC                  mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401023</span>  |.  <span class=\"number\">83</span>EC <span class=\"number\">7</span>C               sub     esp,<span class=\"number\">0x7C</span></span><br><span class=\"line\"><span class=\"number\">00401026</span>  |.  <span class=\"number\">53</span>                    push    ebx</span><br><span class=\"line\"><span class=\"number\">00401027</span>  |.  <span class=\"number\">56</span>                    push    esi</span><br><span class=\"line\"><span class=\"number\">00401028</span>  |.  <span class=\"number\">57</span>                    push    edi</span><br><span class=\"line\"><span class=\"number\">00401029</span>  |.  <span class=\"number\">8</span>D7D <span class=\"number\">84</span>               lea     edi,[local<span class=\"number\">.31</span>]</span><br><span class=\"line\"><span class=\"number\">0040102</span>C  |.  B9 <span class=\"number\">1F</span>000000           mov     ecx,<span class=\"number\">0x1F</span></span><br><span class=\"line\"><span class=\"number\">00401031</span>  |.  B8 CCCCCCCC           mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">00401036</span>  |.  F3:AB                 rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">00401038</span>  |.  C745 C4 <span class=\"number\">0</span>A000000      mov     dword ptr ss:[ebp<span class=\"number\">-0x3C</span>],<span class=\"number\">0xA</span></span><br><span class=\"line\"><span class=\"number\">0040103F</span>  |.  <span class=\"number\">66</span>:C745 C8 <span class=\"number\">1400</span>       mov     word ptr ss:[ebp<span class=\"number\">-0x38</span>],<span class=\"number\">0x14</span></span><br><span class=\"line\"><span class=\"number\">00401045</span>  |.  C645 CA <span class=\"number\">1</span>E            mov     byte ptr ss:[ebp<span class=\"number\">-0x36</span>],<span class=\"number\">0x1E</span></span><br><span class=\"line\"><span class=\"number\">00401049</span>  |.  C745 CC <span class=\"number\">01000000</span>      mov     dword ptr ss:[ebp<span class=\"number\">-0x34</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\"><span class=\"number\">00401050</span>  |.  C745 D0 <span class=\"number\">02000000</span>      mov     dword ptr ss:[ebp<span class=\"number\">-0x30</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\"><span class=\"number\">00401057</span>  |.  C745 F4 <span class=\"number\">66660640</span>      mov     dword ptr ss:[ebp<span class=\"number\">-0xC</span>],<span class=\"number\">0x40066666</span></span><br><span class=\"line\"><span class=\"number\">0040105</span>E  |.  <span class=\"number\">5F</span>                    pop     edi</span><br><span class=\"line\"><span class=\"number\">0040105F</span>  |.  <span class=\"number\">5</span>E                    pop     esi</span><br><span class=\"line\"><span class=\"number\">00401060</span>  |.  <span class=\"number\">5B</span>                    pop     ebx</span><br><span class=\"line\"><span class=\"number\">00401061</span>  |.  <span class=\"number\">8B</span>E5                  mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">00401063</span>  |.  <span class=\"number\">5</span>D                    pop     ebp</span><br><span class=\"line\"><span class=\"number\">00401064</span>  \\.  C3                    retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当结构体中变量不等宽时，分空间不再按照本机宽度分</span></span><br><span class=\"line\"><span class=\"comment\">//局部变量int+short+char 还是按照12字节分</span></span><br><span class=\"line\"><span class=\"comment\">//结构体中变量等宽时和局部变量一样</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">st</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a;</span><br><span class=\"line\">\t<span class=\"type\">int</span> b;</span><br><span class=\"line\">\t<span class=\"type\">int</span> c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tst x;</span><br><span class=\"line\">\tx.a = <span class=\"number\">10</span>;</span><br><span class=\"line\">\tx.b = <span class=\"number\">20</span>;</span><br><span class=\"line\">\tx.c = <span class=\"number\">30</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a = <span class=\"number\">10</span>;</span><br><span class=\"line\">\t<span class=\"type\">int</span> b = <span class=\"number\">20</span>;</span><br><span class=\"line\">\t<span class=\"type\">int</span> c = <span class=\"number\">30</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func3</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> arr[<span class=\"number\">3</span>] = &#123;<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>&#125;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">func2</span>();</span><br><span class=\"line\">    <span class=\"built_in\">func3</span>();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">func</span><br><span class=\"line\"><span class=\"number\">00401020</span> &gt;/&gt; \\<span class=\"number\">55</span>                   push    ebp</span><br><span class=\"line\"><span class=\"number\">00401021</span>  |.  <span class=\"number\">8B</span>EC                 mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401023</span>  |.  <span class=\"number\">83</span>EC <span class=\"number\">4</span>C              sub     esp,<span class=\"number\">0x4C</span></span><br><span class=\"line\"><span class=\"number\">00401026</span>  |.  <span class=\"number\">53</span>                   push    ebx</span><br><span class=\"line\"><span class=\"number\">00401027</span>  |.  <span class=\"number\">56</span>                   push    esi</span><br><span class=\"line\"><span class=\"number\">00401028</span>  |.  <span class=\"number\">57</span>                   push    edi</span><br><span class=\"line\"><span class=\"number\">00401029</span>  |.  <span class=\"number\">8</span>D7D B4              lea     edi,[local<span class=\"number\">.19</span>]</span><br><span class=\"line\"><span class=\"number\">0040102</span>C  |.  B9 <span class=\"number\">13000000</span>          mov     ecx,<span class=\"number\">0x13</span></span><br><span class=\"line\"><span class=\"number\">00401031</span>  |.  B8 CCCCCCCC          mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">00401036</span>  |.  F3:AB                rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">00401038</span>  |.  C745 F4 <span class=\"number\">0</span>A000000     mov     [local<span class=\"number\">.3</span>],<span class=\"number\">0xA</span></span><br><span class=\"line\"><span class=\"number\">0040103F</span>  |.  C745 F8 <span class=\"number\">14000000</span>     mov     [local<span class=\"number\">.2</span>],<span class=\"number\">0x14</span></span><br><span class=\"line\"><span class=\"number\">00401046</span>  |.  C745 FC <span class=\"number\">1E000000</span>     mov     [local<span class=\"number\">.1</span>],<span class=\"number\">0x1E</span></span><br><span class=\"line\"><span class=\"number\">0040104</span>D  |.  <span class=\"number\">5F</span>                   pop     edi</span><br><span class=\"line\"><span class=\"number\">0040104</span>E  |.  <span class=\"number\">5</span>E                   pop     esi</span><br><span class=\"line\"><span class=\"number\">0040104F</span>  |.  <span class=\"number\">5B</span>                   pop     ebx</span><br><span class=\"line\"><span class=\"number\">00401050</span>  |.  <span class=\"number\">8B</span>E5                 mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">00401052</span>  |.  <span class=\"number\">5</span>D                   pop     ebp</span><br><span class=\"line\"><span class=\"number\">00401053</span>  \\.  C3                   retn</span><br><span class=\"line\"></span><br><span class=\"line\">func2</span><br><span class=\"line\"><span class=\"number\">00401080</span> &gt;/&gt; \\<span class=\"number\">55</span>                   push    ebp</span><br><span class=\"line\"><span class=\"number\">00401081</span>  |.  <span class=\"number\">8B</span>EC                 mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401083</span>  |.  <span class=\"number\">83</span>EC <span class=\"number\">4</span>C              sub     esp,<span class=\"number\">0x4C</span></span><br><span class=\"line\"><span class=\"number\">00401086</span>  |.  <span class=\"number\">53</span>                   push    ebx</span><br><span class=\"line\"><span class=\"number\">00401087</span>  |.  <span class=\"number\">56</span>                   push    esi</span><br><span class=\"line\"><span class=\"number\">00401088</span>  |.  <span class=\"number\">57</span>                   push    edi</span><br><span class=\"line\"><span class=\"number\">00401089</span>  |.  <span class=\"number\">8</span>D7D B4              lea     edi,[local<span class=\"number\">.19</span>]</span><br><span class=\"line\"><span class=\"number\">0040108</span>C  |.  B9 <span class=\"number\">13000000</span>          mov     ecx,<span class=\"number\">0x13</span></span><br><span class=\"line\"><span class=\"number\">00401091</span>  |.  B8 CCCCCCCC          mov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">00401096</span>  |.  F3:AB                rep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">00401098</span>  |.  C745 FC <span class=\"number\">0</span>A000000     mov     [local<span class=\"number\">.1</span>],<span class=\"number\">0xA</span></span><br><span class=\"line\"><span class=\"number\">0040109F</span>  |.  C745 F8 <span class=\"number\">14000000</span>     mov     [local<span class=\"number\">.2</span>],<span class=\"number\">0x14</span></span><br><span class=\"line\"><span class=\"number\">004010</span>A6  |.  C745 F4 <span class=\"number\">1E000000</span>     mov     [local<span class=\"number\">.3</span>],<span class=\"number\">0x1E</span></span><br><span class=\"line\"><span class=\"number\">004010</span>AD  |.  <span class=\"number\">5F</span>                   pop     edi</span><br><span class=\"line\"><span class=\"number\">004010</span>AE  |.  <span class=\"number\">5</span>E                   pop     esi</span><br><span class=\"line\"><span class=\"number\">004010</span>AF  |.  <span class=\"number\">5B</span>                   pop     ebx</span><br><span class=\"line\"><span class=\"number\">004010B</span>0  |.  <span class=\"number\">8B</span>E5                 mov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">004010B</span>2  |.  <span class=\"number\">5</span>D                   pop     ebp</span><br><span class=\"line\"><span class=\"number\">004010B</span>3  \\.  C3                   retn</span><br><span class=\"line\"></span><br><span class=\"line\">func3</span><br><span class=\"line\"><span class=\"number\">004106F</span>0 &gt;/&gt; \\<span class=\"number\">55</span>                    push    ebp</span><br><span class=\"line\"><span class=\"number\">004106F</span>1  |.  <span class=\"number\">8B</span>EC                  mov     ebp,esp</span><br><span class=\"line\"><span class=\"number\">004106F</span>3  |.  <span class=\"number\">83</span>EC <span class=\"number\">4</span>C               sub     esp,<span class=\"number\">0x4C</span></span><br><span class=\"line\"><span class=\"number\">004106F</span>6  |.  <span class=\"number\">53</span>                    push    ebx</span><br><span class=\"line\"><span class=\"number\">004106F</span>7  |.  <span class=\"number\">56</span>                    push    esi</span><br><span class=\"line\"><span class=\"number\">004106F</span>8  |.  <span class=\"number\">57</span>                    push    edi</span><br><span class=\"line\"><span class=\"number\">004106F</span>9  |.  <span class=\"number\">8</span>D7D B4               lea     edi,[local<span class=\"number\">.19</span>]</span><br><span class=\"line\"><span class=\"number\">004106F</span>C  |.  B9 <span class=\"number\">13000000</span>   \t\tmov     ecx,<span class=\"number\">0x13</span></span><br><span class=\"line\"><span class=\"number\">00410701</span>  |.  B8 CCCCCCCC   \t\tmov     eax,<span class=\"number\">0xCCCCCCCC</span></span><br><span class=\"line\"><span class=\"number\">00410706</span>  |.  F3:AB         \t\trep     stos dword ptr es:[edi]</span><br><span class=\"line\"><span class=\"number\">00410708</span>  |.  C745 F4 <span class=\"number\">0</span>A000&gt;\t\tmov     [local<span class=\"number\">.3</span>],<span class=\"number\">0xA</span></span><br><span class=\"line\"><span class=\"number\">0041070F</span>  |.  C745 F8 <span class=\"number\">14000</span>&gt;\t\tmov     [local<span class=\"number\">.2</span>],<span class=\"number\">0x14</span></span><br><span class=\"line\"><span class=\"number\">00410716</span>  |.  C745 FC <span class=\"number\">1E000</span>&gt;\t\tmov     [local<span class=\"number\">.1</span>],<span class=\"number\">0x1E</span></span><br><span class=\"line\"><span class=\"number\">0041071</span>D  |.  <span class=\"number\">5F</span>            \t\tpop     edi</span><br><span class=\"line\"><span class=\"number\">0041071</span>E  |.  <span class=\"number\">5</span>E            \t\tpop     esi</span><br><span class=\"line\"><span class=\"number\">0041071F</span>  |.  <span class=\"number\">5B</span>            \t\tpop     ebx</span><br><span class=\"line\"><span class=\"number\">00410720</span>  |.  <span class=\"number\">8B</span>E5          \t\tmov     esp,ebp</span><br><span class=\"line\"><span class=\"number\">00410722</span>  |.  <span class=\"number\">5</span>D            \t\tpop     ebp</span><br><span class=\"line\"><span class=\"number\">00410723</span>  \\.  C3            \t\tretn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>结构体可以作为参数和返回值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct st</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tshort b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void func(st x)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tst x;</span><br><span class=\"line\">\tx.a = 1;</span><br><span class=\"line\">\tx.b = 2;</span><br><span class=\"line\">\tx.c = 3;</span><br><span class=\"line\">\tfunc(x);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00401040 55                   push        ebp</span><br><span class=\"line\">00401041 8B EC                mov         ebp,esp</span><br><span class=\"line\">00401043 83 EC 48             sub         esp,48h</span><br><span class=\"line\">00401046 53                   push        ebx</span><br><span class=\"line\">00401047 56                   push        esi</span><br><span class=\"line\">00401048 57                   push        edi</span><br><span class=\"line\">00401049 8D 7D B8             lea         edi,[ebp-48h]</span><br><span class=\"line\">0040104C B9 12 00 00 00       mov         ecx,12h</span><br><span class=\"line\">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">00401058 C7 45 F8 01 00 00 00 mov         dword ptr [ebp-8],1</span><br><span class=\"line\">0040105F 66 C7 45 FC 02 00    mov         word ptr [ebp-4],offset main+23h (00401063)</span><br><span class=\"line\">00401065 C6 45 FE 03          mov         byte ptr [ebp-2],3</span><br><span class=\"line\">00401069 8B 45 FC             mov         eax,dword ptr [ebp-4]</span><br><span class=\"line\">0040106C 50                   push        eax</span><br><span class=\"line\">0040106D 8B 4D F8             mov         ecx,dword ptr [ebp-8]</span><br><span class=\"line\">00401070 51                   push        ecx</span><br><span class=\"line\">00401071 E8 A3 FF FF FF       call        @ILT+20(func) (00401019)</span><br><span class=\"line\">00401076 83 C4 08             add         esp,8</span><br><span class=\"line\">00401079 33 C0                xor         eax,eax</span><br><span class=\"line\">0040107B 5F                   pop         edi</span><br><span class=\"line\">0040107C 5E                   pop         esi</span><br><span class=\"line\">0040107D 5B                   pop         ebx</span><br><span class=\"line\">0040107E 83 C4 48             add         esp,48h</span><br><span class=\"line\">00401081 3B EC                cmp         ebp,esp</span><br><span class=\"line\">00401083 E8 E8 00 00 00       call        __chkesp (00401170)</span><br><span class=\"line\">00401088 8B E5                mov         esp,ebp</span><br><span class=\"line\">0040108A 5D                   pop         ebp</span><br><span class=\"line\">0040108B C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\">ebp-4</span><br><span class=\"line\">0018FF44  02 00 03 CC 88 FF 18</span><br><span class=\"line\">ebp-8</span><br><span class=\"line\">0018FF40  01 00 00 00 02 00 03</span><br><span class=\"line\">第二次push的时候把short和char一起push了</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">struct st</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">\tint e;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void func(st x)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tst x;</span><br><span class=\"line\">\tx.a = 1;</span><br><span class=\"line\">\tx.b = 2;</span><br><span class=\"line\">\tx.c = 3;</span><br><span class=\"line\">\tx.d = 4;</span><br><span class=\"line\">\tx.e = 5;</span><br><span class=\"line\">\tfunc(x);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00401040 55                   push        ebp</span><br><span class=\"line\">00401041 8B EC                mov         ebp,esp</span><br><span class=\"line\">00401043 83 EC 54             sub         esp,54h</span><br><span class=\"line\">00401046 53                   push        ebx</span><br><span class=\"line\">00401047 56                   push        esi</span><br><span class=\"line\">00401048 57                   push        edi</span><br><span class=\"line\">00401049 8D 7D AC             lea         edi,[ebp-54h]</span><br><span class=\"line\">0040104C B9 15 00 00 00       mov         ecx,15h</span><br><span class=\"line\">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">00401058 C7 45 EC 01 00 00 00 mov         dword ptr [ebp-14h],1</span><br><span class=\"line\">0040105F C7 45 F0 02 00 00 00 mov         dword ptr [ebp-10h],2</span><br><span class=\"line\">00401066 C7 45 F4 03 00 00 00 mov         dword ptr [ebp-0Ch],3</span><br><span class=\"line\">0040106D C7 45 F8 04 00 00 00 mov         dword ptr [ebp-8],4</span><br><span class=\"line\">00401074 C7 45 FC 05 00 00 00 mov         dword ptr [ebp-4],5</span><br><span class=\"line\">0040107B 83 EC 14             sub         esp,14h</span><br><span class=\"line\">0040107E B9 05 00 00 00       mov         ecx,5</span><br><span class=\"line\">00401083 8D 75 EC             lea         esi,[ebp-14h]</span><br><span class=\"line\">00401086 8B FC                mov         edi,esp</span><br><span class=\"line\">00401088 F3 A5                rep movs    dword ptr [edi],dword ptr [esi]</span><br><span class=\"line\">0040108A E8 8A FF FF FF       call        @ILT+20(func) (00401019)</span><br><span class=\"line\">0040108F 83 C4 14             add         esp,14h</span><br><span class=\"line\">00401092 33 C0                xor         eax,eax</span><br><span class=\"line\">00401094 5F                   pop         edi</span><br><span class=\"line\">00401095 5E                   pop         esi</span><br><span class=\"line\">00401096 5B                   pop         ebx</span><br><span class=\"line\">00401097 83 C4 54             add         esp,54h</span><br><span class=\"line\">0040109A 3B EC                cmp         ebp,esp</span><br><span class=\"line\">0040109C E8 CF 00 00 00       call        __chkesp (00401170)</span><br><span class=\"line\">004010A1 8B E5                mov         esp,ebp</span><br><span class=\"line\">004010A3 5D                   pop         ebp</span><br><span class=\"line\">004010A4 C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\">此时传参和push原理一样，此时先把所有堆栈提升，再填充提升的堆栈</span><br><span class=\"line\">结构体传参通过堆栈传参</span><br></pre></td></tr></table></figure>\n<p>结构体作为返回值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401040 55                   push        ebp</span><br><span class=\"line\">00401041 8B EC                mov         ebp,esp</span><br><span class=\"line\">00401043 83 EC 70             sub         esp,70h</span><br><span class=\"line\">00401046 53                   push        ebx</span><br><span class=\"line\">00401047 56                   push        esi</span><br><span class=\"line\">00401048 57                   push        edi</span><br><span class=\"line\">00401049 8D 7D 90             lea         edi,[ebp-70h]</span><br><span class=\"line\">0040104C B9 1C 00 00 00       mov         ecx,1Ch</span><br><span class=\"line\">00401051 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">00401056 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">00401058 8D 45 D0             lea         eax,[ebp-30h]</span><br><span class=\"line\">0040105B 50                   push        eax</span><br><span class=\"line\">0040105C E8 BD FF FF FF       call        @ILT+25(func3) (0040101e)</span><br><span class=\"line\">00401061 83 C4 04             add         esp,4</span><br><span class=\"line\"></span><br><span class=\"line\">00401064 8B 08                mov         ecx,dword ptr [eax]</span><br><span class=\"line\">00401066 89 4D E0             mov         dword ptr [ebp-20h],ecx</span><br><span class=\"line\">00401069 8B 50 04             mov         edx,dword ptr [eax+4]</span><br><span class=\"line\">0040106C 89 55 E4             mov         dword ptr [ebp-1Ch],edx</span><br><span class=\"line\">0040106F 8B 48 08             mov         ecx,dword ptr [eax+8]</span><br><span class=\"line\">00401072 89 4D E8             mov         dword ptr [ebp-18h],ecx</span><br><span class=\"line\">00401075 8B 50 0C             mov         edx,dword ptr [eax+0Ch]</span><br><span class=\"line\">00401078 89 55 EC             mov         dword ptr [ebp-14h],edx</span><br><span class=\"line\">0040107B 8B 45 E0             mov         eax,dword ptr [ebp-20h]</span><br><span class=\"line\">0040107E 89 45 F0             mov         dword ptr [ebp-10h],eax</span><br><span class=\"line\">00401081 8B 4D E4             mov         ecx,dword ptr [ebp-1Ch]</span><br><span class=\"line\">00401084 89 4D F4             mov         dword ptr [ebp-0Ch],ecx</span><br><span class=\"line\">00401087 8B 55 E8             mov         edx,dword ptr [ebp-18h]</span><br><span class=\"line\">0040108A 89 55 F8             mov         dword ptr [ebp-8],edx</span><br><span class=\"line\">0040108D 8B 45 EC             mov         eax,dword ptr [ebp-14h]</span><br><span class=\"line\">00401090 89 45 FC             mov         dword ptr [ebp-4],eax</span><br><span class=\"line\">00401093 33 C0                xor         eax,eax</span><br><span class=\"line\">00401095 5F                   pop         edi</span><br><span class=\"line\">00401096 5E                   pop         esi</span><br><span class=\"line\">00401097 5B                   pop         ebx</span><br><span class=\"line\">00401098 83 C4 70             add         esp,70h</span><br><span class=\"line\">0040109B 3B EC                cmp         ebp,esp</span><br><span class=\"line\">0040109D E8 CE 00 00 00       call        __chkesp (00401170)</span><br><span class=\"line\">004010A2 8B E5                mov         esp,ebp</span><br><span class=\"line\">004010A4 5D                   pop         ebp</span><br><span class=\"line\">004010A5 C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">004106F0 55                   push        ebp</span><br><span class=\"line\">004106F1 8B EC                mov         ebp,esp</span><br><span class=\"line\">004106F3 83 EC 50             sub         esp,50h</span><br><span class=\"line\">004106F6 53                   push        ebx</span><br><span class=\"line\">004106F7 56                   push        esi</span><br><span class=\"line\">004106F8 57                   push        edi</span><br><span class=\"line\">004106F9 8D 7D B0             lea         edi,[ebp-50h]</span><br><span class=\"line\">004106FC B9 14 00 00 00       mov         ecx,14h</span><br><span class=\"line\">00410701 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">00410706 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">00410708 C7 45 F0 01 00 00 00 mov         dword ptr [ebp-10h],1</span><br><span class=\"line\">0041070F 66 C7 45 F4 02 00    mov         word ptr [ebp-0Ch],offset func+23h (00410713)</span><br><span class=\"line\">00410715 C6 45 F6 03          mov         byte ptr [ebp-0Ah],3</span><br><span class=\"line\">00410719 C7 45 F8 04 00 00 00 mov         dword ptr [ebp-8],4</span><br><span class=\"line\">00410720 C7 45 FC 05 00 00 00 mov         dword ptr [ebp-4],5</span><br><span class=\"line\"></span><br><span class=\"line\">00410727 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class=\"line\">0041072A 8B 4D F0             mov         ecx,dword ptr [ebp-10h]</span><br><span class=\"line\">0041072D 89 08                mov         dword ptr [eax],ecx</span><br><span class=\"line\">0041072F 8B 55 F4             mov         edx,dword ptr [ebp-0Ch]</span><br><span class=\"line\">00410732 89 50 04             mov         dword ptr [eax+4],edx</span><br><span class=\"line\">00410735 8B 4D F8             mov         ecx,dword ptr [ebp-8]</span><br><span class=\"line\">00410738 89 48 08             mov         dword ptr [eax+8],ecx</span><br><span class=\"line\">0041073B 8B 55 FC             mov         edx,dword ptr [ebp-4]</span><br><span class=\"line\">0041073E 89 50 0C             mov         dword ptr [eax+0Ch],edx</span><br><span class=\"line\">00410741 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class=\"line\"></span><br><span class=\"line\">00410744 5F                   pop         edi</span><br><span class=\"line\">00410745 5E                   pop         esi</span><br><span class=\"line\">00410746 5B                   pop         ebx</span><br><span class=\"line\">00410747 8B E5                mov         esp,ebp</span><br><span class=\"line\">00410749 5D                   pop         ebp</span><br><span class=\"line\">0041074A C3                   ret</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>总结：如果不用指针，别声明结构体为局部变量，别把结构体当做返回值和参数</p>\n<hr>\n<p>sizeof</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sizeof(char);</span><br><span class=\"line\"></span><br><span class=\"line\">char arr1[10]</span><br><span class=\"line\">short arr2[10]   //20</span><br><span class=\"line\">int arr3[10]     //40</span><br><span class=\"line\"></span><br><span class=\"line\">sizeof(arr1)     //10</span><br><span class=\"line\">sizeof(arr1[10])   //1</span><br><span class=\"line\"></span><br><span class=\"line\">struct s1</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;   //12</span><br><span class=\"line\">a 0 0 0</span><br><span class=\"line\">b b b b</span><br><span class=\"line\">c 0 0 0</span><br><span class=\"line\">struct s2</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tchar a;</span><br><span class=\"line\">\tchar b;</span><br><span class=\"line\">&#125;;   //8</span><br><span class=\"line\">c c c c</span><br><span class=\"line\">a b 0 0</span><br><span class=\"line\"></span><br><span class=\"line\">sizeof(s1);    //12</span><br><span class=\"line\">sizeof(s2);    //8</span><br><span class=\"line\"></span><br><span class=\"line\">对齐参数：结构体中参数以几字节对齐,取值1,2,4,8 默认为8</span><br><span class=\"line\">#pragma pack(1)</span><br><span class=\"line\">struct ha</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\t__int64 b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">#pragma pack()</span><br><span class=\"line\">sizeof(ha)   //13</span><br><span class=\"line\"></span><br><span class=\"line\">如果这个值比结构体成员的sizeof值小，那么该成员的偏移量应该以此值为准，即是说，结构体成员的偏移量应该取二者的最小值.</span><br><span class=\"line\"></span><br><span class=\"line\">#pragma pack(2)</span><br><span class=\"line\">struct ha</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\t__int64 b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">#pragma pack()</span><br><span class=\"line\">sizeof(ha)   //14</span><br><span class=\"line\"></span><br><span class=\"line\">#pragma pack(4)</span><br><span class=\"line\">struct ha</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\t__int64 b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">#pragma pack()</span><br><span class=\"line\">sizeof(ha)   //16</span><br><span class=\"line\"></span><br><span class=\"line\">#pragma pack(4)</span><br><span class=\"line\">struct ha</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\t__int64 b;</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">#pragma pack()</span><br><span class=\"line\">sizeof(ha)   //24</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122135557244.png\" alt=\"image-20230122135557244\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122140313752.png\" alt=\"image-20230122140313752\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122140354031.png\" alt=\"image-20230122140354031\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对齐原则</span><br><span class=\"line\">原则一:数据成员对齐规则。结构的数据成员，第一个数据成员放在offset为0的地方，以后每个数据成员存储的起始位置要从该成员大小的整数倍开始(比如int在32位机为4字节，则要从4的整数倍地址开始存储).</span><br><span class=\"line\">原则二:结构体的总大小，也就是sizeof的结果，必须是其内部最大成员的整数倍，不足的要补齐。</span><br><span class=\"line\">原则三:如果一个结构里有某些结构体成员，则结构体成员要从其内部最大元素大小的整数倍地址开始存储。(struct a里存有struct b， b里有char，int，double等元素，那b应该从8的整数倍开始存储.)</span><br><span class=\"line\">原则四:对齐参数如果比结构体成员的sizeof值小，该成员的偏移量应该以此值为准.也就是说，结构体成员的偏移量应该取二者的最小值.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122141122230.png\" alt=\"image-20230122141122230\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142241459.png\" alt=\"image-20230122142241459\"></p>\n<p>取结构体中变量最大的和默认相比，取小的</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142505891.png\" alt=\"image-20230122142505891\"></p>\n<p><strong>按照数据型由小到大的顺序进行书写</strong></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230122142714801.png\" alt=\"image-20230122142714801\"></p>\n<p>嵌套结构体按照嵌套的结构体中变量最大的是对齐宽度，但结构体还是按照原来大小累加</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct S1</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//16</span><br><span class=\"line\">\tchar c;</span><br><span class=\"line\">\tdouble i;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct S3</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//32</span><br><span class=\"line\">\tchar c1;</span><br><span class=\"line\">\tS1 s;</span><br><span class=\"line\">\tchar c2;</span><br><span class=\"line\">\tchar c3;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct S4</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//40</span><br><span class=\"line\">\tchar c1;</span><br><span class=\"line\">\tS1 s;</span><br><span class=\"line\">\tchar c2;</span><br><span class=\"line\">\tdouble c3;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct S5</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//16</span><br><span class=\"line\">\tint c1;</span><br><span class=\"line\">\tchar c2[10];</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;%d %d %d %d %d\\n&quot;,sizeof(S1),sizeof(S3),sizeof(S4),sizeof(S5),sizeof(1));</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"typedef\"><a class=\"markdownIt-Anchor\" href=\"#typedef\">#</a> typedef</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef为C语言的关键字，作用是为一种数据类型定义一个新名字。这里的数据类型包括内部数据类型(int, char等)和自定</span><br><span class=\"line\"></span><br><span class=\"line\">typedef unsigned char BYTE;</span><br><span class=\"line\"></span><br><span class=\"line\">typedef int vector[10];</span><br><span class=\"line\">vector v;</span><br><span class=\"line\">v[0] = 1;</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct student</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar a[10];</span><br><span class=\"line\">&#125;stu;</span><br><span class=\"line\">main()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tstu s;</span><br><span class=\"line\">\ts.a[0] = &#x27;a&#x27;;</span><br><span class=\"line\">\ts.a[1] = &#x27;b&#x27;;</span><br><span class=\"line\">\ts.a[2] = &#x27;c&#x27;;</span><br><span class=\"line\">\ts.a[3] = &#x27;\\0&#x27;;  //s.a[3] = 0;   \\0和0都是结束符号</span><br><span class=\"line\">\tprintf(&quot;%s&quot;,s.arr);    //abc</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">stu 是 student结构体的别名，两个都可以使用</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;string.h&quot;</span><br><span class=\"line\">strcpy(s.arr,&quot;china&quot;);</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">nPos</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">float</span> x;</span><br><span class=\"line\">\t<span class=\"type\">float</span> y;</span><br><span class=\"line\">\t<span class=\"type\">float</span> z;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Monster</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> id;</span><br><span class=\"line\">\t<span class=\"type\">char</span> name[<span class=\"number\">32</span>];</span><br><span class=\"line\">\t<span class=\"type\">int</span> Hp;</span><br><span class=\"line\">\t<span class=\"type\">int</span> blue;</span><br><span class=\"line\">\tnPos pos;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Monster mon[<span class=\"number\">10</span>];   <span class=\"comment\">//结构体数组</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">value</span><span class=\"params\">(<span class=\"type\">int</span> n,<span class=\"type\">char</span> *name,<span class=\"type\">int</span> hp,<span class=\"type\">int</span> blue, <span class=\"type\">float</span> x,<span class=\"type\">float</span> y,<span class=\"type\">float</span> z)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tmon[i].name = name;</span><br><span class=\"line\">\tmon[i].pos.x = x;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">find</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;=<span class=\"number\">9</span>;i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (mon[i].id == x)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"built_in\">printf</span>();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"switch\"><a class=\"markdownIt-Anchor\" href=\"#switch\">#</a> Switch</h3>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123104349398.png\" alt=\"image-20230123104349398\"></p>\n<p>case 后面必须是常量表达式</p>\n<p>case 后常量表达式的值不能一样</p>\n<p>switch 后面表达式必须为整数</p>\n<p>没有 break 时会顺序向下执行，直到遇到 break</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfunc(<span class=\"number\">2</span>);     <span class=\"comment\">//2</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">----------------------------------------------------------------</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfunc(<span class=\"number\">2</span>);   <span class=\"comment\">//234</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//表达式都不成立执行default，default可以省略但不建议</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>switch 反汇编分析</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401020</span> <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">00401021</span> <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401023</span> <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">00401026</span> <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">00401027</span> <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">00401028</span> <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">00401029</span> <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040102</span>C B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">00401031</span> B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">00401036</span> F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401038</span> <span class=\"number\">8B</span> <span class=\"number\">45</span> <span class=\"number\">08</span>             mov         eax,dword ptr [ebp+<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"number\">0040103B</span> <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040103</span>E <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">01</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">00401042</span> <span class=\"number\">74</span> <span class=\"number\">0</span>E                je          func+<span class=\"number\">32</span>h (<span class=\"number\">00401052</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401044</span> <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">02</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">00401048</span> <span class=\"number\">74</span> <span class=\"number\">17</span>                je          func+<span class=\"number\">41</span>h (<span class=\"number\">00401061</span>)</span><br><span class=\"line\"><span class=\"number\">0040104</span>A <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">03</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">0040104</span>E <span class=\"number\">74</span> <span class=\"number\">20</span>                je          func+<span class=\"number\">50</span>h (<span class=\"number\">00401070</span>)</span><br><span class=\"line\"><span class=\"number\">00401050</span> EB <span class=\"number\">2</span>D                jmp         func+<span class=\"number\">5F</span>h (<span class=\"number\">0040107f</span>)</span><br><span class=\"line\"><span class=\"number\">00401052</span> <span class=\"number\">68</span> <span class=\"number\">28</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;1&quot;</span> (<span class=\"number\">00422028</span>)</span><br><span class=\"line\"><span class=\"number\">00401057</span> E8 E4 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       <span class=\"function\">call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040105C 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040105F EB 2B                jmp         func+6<span class=\"title\">Ch</span> <span class=\"params\">(<span class=\"number\">0040108</span>c)</span></span></span><br><span class=\"line\"><span class=\"function\">00401061 68 24 20 42 00       push        offset string &quot;2&quot; <span class=\"params\">(<span class=\"number\">00422024</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">00401066 E8 D5 00 00 00       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040106B 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040106E EB 1C                jmp         func+6<span class=\"title\">Ch</span> <span class=\"params\">(<span class=\"number\">0040108</span>c)</span></span></span><br><span class=\"line\"><span class=\"function\">00401070 68 20 20 42 00       push        offset string &quot;4&quot; <span class=\"params\">(<span class=\"number\">00422020</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">00401075 E8 C6 00 00 00       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040107A 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040107D EB 0D                jmp         func+6<span class=\"title\">Ch</span> <span class=\"params\">(<span class=\"number\">0040108</span>c)</span></span></span><br><span class=\"line\"><span class=\"function\">0040107F 68 1C 20 42 00       push        offset string &quot;5&quot; <span class=\"params\">(<span class=\"number\">0042201</span>c)</span></span></span><br><span class=\"line\"><span class=\"function\">00401084 E8 B7 00 00 00       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">00401089 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040108C 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040108D 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040108E 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040108F 83 C4 44             add         esp,44h</span></span><br><span class=\"line\"><span class=\"function\">00401092 3B EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\">00401094 E8 27 01 00 00       call        __<span class=\"title\">chkesp</span> <span class=\"params\">(<span class=\"number\">004011</span>c0)</span></span></span><br><span class=\"line\"><span class=\"function\">00401099 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040109B 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040109C C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"comment\">//分支条件比较少时&lt;4和if-else反汇编类似</span></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"comment\">//分支大于4时在内存中生成大表  [edx*4+4010B1h]通过寻址</span></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">1</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">2</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">3</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">4</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">00401020</span> <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">00401021</span> <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401023</span> <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">00401026</span> <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">00401027</span> <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">00401028</span> <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">00401029</span> <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040102</span>C B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">00401031</span> B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">00401036</span> F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"><span class=\"number\">00401038</span> <span class=\"number\">8B</span> <span class=\"number\">45</span> <span class=\"number\">08</span>             mov         eax,dword ptr [ebp+<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"number\">0040103B</span> <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040103</span>E <span class=\"number\">8B</span> <span class=\"number\">4</span>D FC             mov         ecx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">00401041</span> <span class=\"number\">83</span> E9 <span class=\"number\">01</span>             sub         ecx,<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">00401044</span> <span class=\"number\">89</span> <span class=\"number\">4</span>D FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],ecx</span><br><span class=\"line\"><span class=\"number\">00401047</span> <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">03</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">0040104B</span> <span class=\"number\">77</span> <span class=\"number\">46</span>                ja          $L539+<span class=\"number\">0F</span>h (<span class=\"number\">00401093</span>)</span><br><span class=\"line\"><span class=\"number\">0040104</span>D <span class=\"number\">8B</span> <span class=\"number\">55</span> FC             mov         edx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">00401050</span> FF <span class=\"number\">24</span> <span class=\"number\">95</span> B1 <span class=\"number\">10</span> <span class=\"number\">40</span> <span class=\"number\">00</span> jmp         dword ptr [edx*<span class=\"number\">4</span>+<span class=\"number\">4010B</span>1h]</span><br><span class=\"line\">$L533:</span><br><span class=\"line\"><span class=\"number\">00401057</span> <span class=\"number\">68</span> <span class=\"number\">2</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;1&quot;</span> (<span class=\"number\">0042202</span>c)</span><br><span class=\"line\"><span class=\"number\">0040105</span>C E8 DF <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       <span class=\"function\">call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">00401061 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">00401064 EB 3A                jmp         $L539+1<span class=\"title\">Ch</span> <span class=\"params\">(<span class=\"number\">004010</span>a0)</span></span></span><br><span class=\"line\"><span class=\"function\">$L535:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401066</span> <span class=\"number\">68</span> <span class=\"number\">28</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;2&quot;</span> (<span class=\"number\">00422028</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040106B</span> E8 D0 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401070</span> <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401073</span> EB <span class=\"number\">2B</span>                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">004010</span>a0)</span></span><br><span class=\"line\"><span class=\"function\">$L537:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401075</span> <span class=\"number\">68</span> <span class=\"number\">24</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;3&quot;</span> (<span class=\"number\">00422024</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040107</span>A E8 C1 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040107F</span> <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401082</span> EB <span class=\"number\">1</span>C                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">004010</span>a0)</span></span><br><span class=\"line\"><span class=\"function\">$L539:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401084</span> <span class=\"number\">68</span> <span class=\"number\">20</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;4&quot;</span> (<span class=\"number\">00422020</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401089</span> E8 B2 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040108</span>E <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401091</span> EB <span class=\"number\">0</span>D                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">004010</span>a0)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401093</span> <span class=\"number\">68</span> <span class=\"number\">1</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;5&quot;</span> (<span class=\"number\">0042201</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">00401098</span> E8 A3 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040109</span>D <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A0 <span class=\"number\">5F</span>                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A1 <span class=\"number\">5</span>E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A2 <span class=\"number\">5B</span>                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A3 <span class=\"number\">83</span> C4 <span class=\"number\">44</span>             add         esp,<span class=\"number\">44</span>h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A6 <span class=\"number\">3B</span> EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>A8 E8 <span class=\"number\">13</span> <span class=\"number\">01</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       call        __chkesp (<span class=\"number\">004011</span>c0)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>AD <span class=\"number\">8B</span> E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010</span>AF <span class=\"number\">5</span>D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">004010B</span>0 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\">//case顺序交换不影响大表的生成，即可以是无序的</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123113122801.png\" alt=\"image-20230123113122801\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//只要case连续且数目足够就会生成大表</span></span><br><span class=\"line\"><span class=\"comment\">//case连续没有空缺</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">301</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">302</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;2&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">303</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;3&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">304</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;4&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">305</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;5&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">306</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;6&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">307</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;7&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">308</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;8&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">309</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;9&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">310</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;sb&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D7D0 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D1 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D3 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D6 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D7 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D8 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D9 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7DC B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E8 <span class=\"number\">8B</span> <span class=\"number\">45</span> <span class=\"number\">08</span>             mov         eax,dword ptr [ebp+<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EB <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EE <span class=\"number\">8B</span> <span class=\"number\">4</span>D FC             mov         ecx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F1 <span class=\"number\">81</span> E9 <span class=\"number\">2</span>D <span class=\"number\">01</span> <span class=\"number\">00</span> <span class=\"number\">00</span>    sub         ecx,<span class=\"number\">12</span>Dh</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F7 <span class=\"number\">89</span> <span class=\"number\">4</span>D FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],ecx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7FA <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">09</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7FE <span class=\"number\">0F</span> <span class=\"number\">87</span> A6 <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>    ja          $L551+<span class=\"number\">0F</span>h (<span class=\"number\">0040</span>d8aa)</span><br><span class=\"line\"><span class=\"number\">0040</span>D804 <span class=\"number\">8B</span> <span class=\"number\">55</span> FC             mov         edx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D807 FF <span class=\"number\">24</span> <span class=\"number\">95</span> C8 D8 <span class=\"number\">40</span> <span class=\"number\">00</span> jmp         dword ptr [edx*<span class=\"number\">4</span>+<span class=\"number\">40</span>D8C8h]</span><br><span class=\"line\">$L533:</span><br><span class=\"line\"><span class=\"number\">0040</span>D80E <span class=\"number\">68</span> C0 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;1&quot;</span> (<span class=\"number\">00422f</span>c0)</span><br><span class=\"line\"><span class=\"number\">0040</span>D813 E8 <span class=\"number\">28</span> <span class=\"number\">39</span> <span class=\"function\">FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D818 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D81B E9 97 00 00 00       jmp         $L551+1<span class=\"title\">Ch</span> <span class=\"params\">(<span class=\"number\">0040</span>d8b7)</span></span></span><br><span class=\"line\"><span class=\"function\">$L535:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D820 <span class=\"number\">68</span> BC <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;2&quot;</span> (<span class=\"number\">00422f</span>bc)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D825 E8 <span class=\"number\">16</span> <span class=\"number\">39</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D82A <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D82D E9 <span class=\"number\">85</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L537:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D832 <span class=\"number\">68</span> B8 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;3&quot;</span> (<span class=\"number\">00422f</span>b8)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D837 E8 <span class=\"number\">04</span> <span class=\"number\">39</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D83C <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D83F EB <span class=\"number\">76</span>                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L539:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D841 <span class=\"number\">68</span> B4 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;4&quot;</span> (<span class=\"number\">00422f</span>b4)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D846 E8 F5 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D84B <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D84E EB <span class=\"number\">67</span>                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L541:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D850 <span class=\"number\">68</span> <span class=\"number\">64</span> <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;5&quot;</span> (<span class=\"number\">00422f</span>64)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D855 E8 E6 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85A <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85D EB <span class=\"number\">58</span>                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L543:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85F <span class=\"number\">68</span> <span class=\"number\">3</span>C <span class=\"number\">21</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;6&quot;</span> (<span class=\"number\">0042213</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D864 E8 D7 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D869 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D86C EB <span class=\"number\">49</span>                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L545:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D86E <span class=\"number\">68</span> <span class=\"number\">2</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;7&quot;</span> (<span class=\"number\">0042202</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D873 E8 C8 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D878 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D87B EB <span class=\"number\">3</span>A                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L547:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D87D <span class=\"number\">68</span> <span class=\"number\">28</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;8&quot;</span> (<span class=\"number\">00422028</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D882 E8 B9 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D887 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D88A EB <span class=\"number\">2B</span>                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L549:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D88C <span class=\"number\">68</span> <span class=\"number\">24</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;9&quot;</span> (<span class=\"number\">00422024</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D891 E8 AA <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D896 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D899 EB <span class=\"number\">1</span>C                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\">$L551:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D89B <span class=\"number\">68</span> <span class=\"number\">20</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;A&quot;</span> (<span class=\"number\">00422020</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8A0 E8 <span class=\"number\">9B</span> <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8A5 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8A8 EB <span class=\"number\">0</span>D                jmp         $L551+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d8b7)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8AA <span class=\"number\">68</span> <span class=\"number\">1</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;sb&quot;</span> (<span class=\"number\">0042201</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8AF E8 <span class=\"number\">8</span>C <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B4 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B7 <span class=\"number\">5F</span>                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B8 <span class=\"number\">5</span>E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B9 <span class=\"number\">5B</span>                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8BA <span class=\"number\">83</span> C4 <span class=\"number\">44</span>             add         esp,<span class=\"number\">44</span>h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8BD <span class=\"number\">3B</span> EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8BF E8 FC <span class=\"number\">38</span> FF FF       call        __chkesp (<span class=\"number\">004011</span>c0)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8C4 <span class=\"number\">8B</span> E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8C6 <span class=\"number\">5</span>D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8C7 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8C8  <span class=\"number\">0</span>E D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  .谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8CC  <span class=\"number\">20</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>   谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8D0  <span class=\"number\">32</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  <span class=\"number\">2</span>谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8D4  <span class=\"number\">41</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  A谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8D8  <span class=\"number\">50</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  P谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8DC  <span class=\"number\">5F</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  _谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8E0  <span class=\"number\">6</span>E D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  n谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8E4  <span class=\"number\">7</span>D D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  &#125;谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8E8  <span class=\"number\">8</span>C D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  屫@.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8EC  <span class=\"number\">9B</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  涁@.</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\">//case不连续且差值不大</span></span><br><span class=\"line\"><span class=\"function\">//如果中间出现不连续的case会用default补大表空缺 </span></span><br><span class=\"line\"><span class=\"function\">//空缺的地方会用case补，下面的两个<span class=\"number\">0040</span>D886</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8A4  <span class=\"number\">0</span>E D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  .谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8A8  <span class=\"number\">86</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  嗀@.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8AC  <span class=\"number\">86</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  嗀@.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B0  <span class=\"number\">1</span>D D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  .谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B4  <span class=\"number\">2</span>C D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  ,谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D8B8  <span class=\"number\">3B</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  ;</span>谸.</span><br><span class=\"line\"><span class=\"number\">0040</span>D8BC  <span class=\"number\">4</span>A D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  J谸.</span><br><span class=\"line\"><span class=\"number\">0040</span>D8C0  <span class=\"number\">59</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  Y谸.</span><br><span class=\"line\"><span class=\"number\">0040</span>D8C4  <span class=\"number\">68</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  h谸.</span><br><span class=\"line\"><span class=\"number\">0040</span>D8C8  <span class=\"number\">77</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  w谸.</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//如果case不连续且差值过大 使用大表加小表</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"type\">int</span> x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">301</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">308</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;8&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">309</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;9&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">310</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;sb&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D7D0 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D1 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D3 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D6 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D7 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D8 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D9 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7DC B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E8 <span class=\"number\">8B</span> <span class=\"number\">45</span> <span class=\"number\">08</span>             mov         eax,dword ptr [ebp+<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EB <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EE <span class=\"number\">8B</span> <span class=\"number\">4</span>D FC             mov         ecx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F1 <span class=\"number\">81</span> E9 <span class=\"number\">2</span>D <span class=\"number\">01</span> <span class=\"number\">00</span> <span class=\"number\">00</span>    sub         ecx,<span class=\"number\">12</span>Dh</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F7 <span class=\"number\">89</span> <span class=\"number\">4</span>D FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],ecx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7FA <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">09</span>          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">9</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D7FE <span class=\"number\">77</span> <span class=\"number\">4</span>E                ja          $L539+<span class=\"number\">0F</span>h (<span class=\"number\">0040</span>d84e)</span><br><span class=\"line\"><span class=\"number\">0040</span>D800 <span class=\"number\">8B</span> <span class=\"number\">45</span> FC             mov         eax,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D803 <span class=\"number\">33</span> D2                <span class=\"keyword\">xor</span>         edx,edx</span><br><span class=\"line\"><span class=\"number\">0040</span>D805 <span class=\"number\">8</span>A <span class=\"number\">90</span> <span class=\"number\">80</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>    mov         dl,<span class=\"function\">byte <span class=\"title\">ptr</span>  <span class=\"params\">(<span class=\"number\">0040</span>d880)</span>[eax]   <span class=\"comment\">//内存0040d880中偏移量为[eax]的值</span></span></span><br><span class=\"line\"><span class=\"function\">0040D80B FF 24 95 6C D8 40 00 jmp         dword ptr [edx*4+40D86Ch]</span></span><br><span class=\"line\"><span class=\"function\">$L533:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D812 <span class=\"number\">68</span> <span class=\"number\">2</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;1&quot;</span> (<span class=\"number\">0042202</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D817 E8 <span class=\"number\">24</span> <span class=\"number\">39</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D81C <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D81F EB <span class=\"number\">3</span>A                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d85b)</span></span><br><span class=\"line\"><span class=\"function\">$L535:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D821 <span class=\"number\">68</span> <span class=\"number\">28</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;8&quot;</span> (<span class=\"number\">00422028</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D826 E8 <span class=\"number\">15</span> <span class=\"number\">39</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D82B <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D82E EB <span class=\"number\">2B</span>                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d85b)</span></span><br><span class=\"line\"><span class=\"function\">$L537:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D830 <span class=\"number\">68</span> <span class=\"number\">24</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;9&quot;</span> (<span class=\"number\">00422024</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D835 E8 <span class=\"number\">06</span> <span class=\"number\">39</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D83A <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D83D EB <span class=\"number\">1</span>C                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d85b)</span></span><br><span class=\"line\"><span class=\"function\">$L539:</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D83F <span class=\"number\">68</span> <span class=\"number\">20</span> <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;A&quot;</span> (<span class=\"number\">00422020</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D844 E8 F7 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D849 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D84C EB <span class=\"number\">0</span>D                jmp         $L539+<span class=\"number\">1</span>Ch (<span class=\"number\">0040</span>d85b)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D84E <span class=\"number\">68</span> <span class=\"number\">1</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;sb&quot;</span> (<span class=\"number\">0042201</span>c)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D853 E8 E8 <span class=\"number\">38</span> FF FF       call        printf (<span class=\"number\">00401140</span>)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D858 <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85B <span class=\"number\">5F</span>                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85C <span class=\"number\">5</span>E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85D <span class=\"number\">5B</span>                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D85E <span class=\"number\">83</span> C4 <span class=\"number\">44</span>             add         esp,<span class=\"number\">44</span>h</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D861 <span class=\"number\">3B</span> EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D863 E8 <span class=\"number\">58</span> <span class=\"number\">39</span> FF FF       call        __chkesp (<span class=\"number\">004011</span>c0)</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D868 <span class=\"number\">8B</span> E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D86A <span class=\"number\">5</span>D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D86B C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D86C  <span class=\"number\">12</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  .谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D870  <span class=\"number\">21</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  !谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D874  <span class=\"number\">30</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  <span class=\"number\">0</span>谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D878  <span class=\"number\">3F</span> D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  ?谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D87C  <span class=\"number\">4</span>E D8 <span class=\"number\">40</span> <span class=\"number\">00</span>  N谸.</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D880  <span class=\"number\">00</span> <span class=\"number\">04</span> <span class=\"number\">04</span> <span class=\"number\">04</span>  ....</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D884  <span class=\"number\">04</span> <span class=\"number\">04</span> <span class=\"number\">04</span> <span class=\"number\">01</span>  ....</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"number\">0040</span>D888  <span class=\"number\">02</span> <span class=\"number\">03</span> CC CC  ..烫</span></span><br><span class=\"line\"><span class=\"function\">//中间的<span class=\"number\">04</span>就是代替大表中的default</span></span><br><span class=\"line\"><span class=\"function\">//如果空缺的太多会生成一张小表来替代大表中default填充，变为大表加小表</span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\">//差值过大</span></span><br><span class=\"line\"><span class=\"function\">void func(int x)</span></span><br><span class=\"line\"><span class=\"function\">&#123;</span></span><br><span class=\"line\">\t<span class=\"keyword\">switch</span>(x)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">1301</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;1&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">5308</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;8&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">10309</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;9&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">case</span> <span class=\"number\">20310</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;A&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">default</span>:</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;sb&quot;</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D7D0 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D1 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D3 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D6 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D7 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D8 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D7D9 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7DC B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E1 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E6 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7E8 <span class=\"number\">8B</span> <span class=\"number\">45</span> <span class=\"number\">08</span>             mov         eax,dword ptr [ebp+<span class=\"number\">8</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EB <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D7EE <span class=\"number\">81</span> <span class=\"number\">7</span>D FC <span class=\"number\">45</span> <span class=\"number\">28</span> <span class=\"number\">00</span> <span class=\"number\">00</span> cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">2845</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F5 <span class=\"number\">7F</span> <span class=\"number\">1</span>D                jg          func+<span class=\"number\">44</span>h (<span class=\"number\">0040</span>d814)</span><br><span class=\"line\"><span class=\"number\">0040</span>D7F7 <span class=\"number\">81</span> <span class=\"number\">7</span>D FC <span class=\"number\">45</span> <span class=\"number\">28</span> <span class=\"number\">00</span> <span class=\"number\">00</span> cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">2845</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D7FE <span class=\"number\">74</span> <span class=\"number\">3</span>D                je          func+<span class=\"number\">6</span>Dh (<span class=\"number\">0040</span>d83d)</span><br><span class=\"line\"><span class=\"number\">0040</span>D800 <span class=\"number\">81</span> <span class=\"number\">7</span>D FC <span class=\"number\">15</span> <span class=\"number\">05</span> <span class=\"number\">00</span> <span class=\"number\">00</span> cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">515</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D807 <span class=\"number\">74</span> <span class=\"number\">16</span>                je          func+<span class=\"number\">4F</span>h (<span class=\"number\">0040</span>d81f)</span><br><span class=\"line\"><span class=\"number\">0040</span>D809 <span class=\"number\">81</span> <span class=\"number\">7</span>D FC BC <span class=\"number\">14</span> <span class=\"number\">00</span> <span class=\"number\">00</span> cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">14B</span>Ch</span><br><span class=\"line\"><span class=\"number\">0040</span>D810 <span class=\"number\">74</span> <span class=\"number\">1</span>C                je          func+<span class=\"number\">5</span>Eh (<span class=\"number\">0040</span>d82e)</span><br><span class=\"line\"><span class=\"number\">0040</span>D812 EB <span class=\"number\">47</span>                jmp         func+<span class=\"number\">8B</span>h (<span class=\"number\">0040</span>d85b)</span><br><span class=\"line\"><span class=\"number\">0040</span>D814 <span class=\"number\">81</span> <span class=\"number\">7</span>D FC <span class=\"number\">56</span> <span class=\"number\">4F</span> <span class=\"number\">00</span> <span class=\"number\">00</span> cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">4F</span>56h</span><br><span class=\"line\"><span class=\"number\">0040</span>D81B <span class=\"number\">74</span> <span class=\"number\">2F</span>                je          func+<span class=\"number\">7</span>Ch (<span class=\"number\">0040</span>d84c)</span><br><span class=\"line\"><span class=\"number\">0040</span>D81D EB <span class=\"number\">3</span>C                jmp         func+<span class=\"number\">8B</span>h (<span class=\"number\">0040</span>d85b)</span><br><span class=\"line\"><span class=\"number\">0040</span>D81F <span class=\"number\">68</span> <span class=\"number\">2</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;1&quot;</span> (<span class=\"number\">0042202</span>c)</span><br><span class=\"line\"><span class=\"number\">0040</span>D824 E8 <span class=\"number\">17</span> <span class=\"number\">39</span> <span class=\"function\">FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D829 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D82C EB 3A                jmp         func+98<span class=\"title\">h</span> <span class=\"params\">(<span class=\"number\">0040</span>d868)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D82E 68 28 20 42 00       push        offset string &quot;8&quot; <span class=\"params\">(<span class=\"number\">00422028</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D833 E8 08 39 FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D838 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D83B EB 2B                jmp         func+98<span class=\"title\">h</span> <span class=\"params\">(<span class=\"number\">0040</span>d868)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D83D 68 24 20 42 00       push        offset string &quot;9&quot; <span class=\"params\">(<span class=\"number\">00422024</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D842 E8 F9 38 FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D847 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D84A EB 1C                jmp         func+98<span class=\"title\">h</span> <span class=\"params\">(<span class=\"number\">0040</span>d868)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D84C 68 20 20 42 00       push        offset string &quot;A&quot; <span class=\"params\">(<span class=\"number\">00422020</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D851 E8 EA 38 FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D856 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D859 EB 0D                jmp         func+98<span class=\"title\">h</span> <span class=\"params\">(<span class=\"number\">0040</span>d868)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D85B 68 1C 20 42 00       push        offset string &quot;sb&quot; <span class=\"params\">(<span class=\"number\">0042201</span>c)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D860 E8 DB 38 FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D865 83 C4 04             add         esp,4</span></span><br><span class=\"line\"><span class=\"function\">0040D868 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040D869 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040D86A 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040D86B 83 C4 44             add         esp,44h</span></span><br><span class=\"line\"><span class=\"function\">0040D86E 3B EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\">0040D870 E8 4B 39 FF FF       call        __<span class=\"title\">chkesp</span> <span class=\"params\">(<span class=\"number\">004011</span>c0)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D875 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D877 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D878 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span></span><br><span class=\"line\"><span class=\"function\"><span class=\"comment\">//用case最大的-case最小的，得出的范围称为k，如果要判断的值-case最小的值不在范围k之内，直接default</span></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"comment\">//edx 存放的是a 与case 中最小值的差值，而eax*4+地址存放的是每个case的地址</span></span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230123120353631.png\" alt=\"image-20230123120353631\"></p>\n<h3 id=\"循环对比分析\"><a class=\"markdownIt-Anchor\" href=\"#循环对比分析\">#</a> 循环对比分析</h3>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;=<span class=\"number\">10</span>;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,i);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D920 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D921 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D923 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D926 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D927 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D928 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D929 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D92C B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D931 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D936 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D938 C7 <span class=\"number\">45</span> FC <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span>\t\t\t\t\t\t\t;<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"number\">0040</span>D93F EB <span class=\"number\">09</span>                jmp         func2+<span class=\"number\">2</span>Ah (<span class=\"number\">0040</span>d94a)</span><br><span class=\"line\"><span class=\"number\">0040</span>D941 <span class=\"number\">8B</span> <span class=\"number\">45</span> FC             mov         eax,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D944 <span class=\"number\">83</span> C0 <span class=\"number\">01</span>             add         eax,<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D947 <span class=\"number\">89</span> <span class=\"number\">45</span> FC             mov         dword ptr [ebp<span class=\"number\">-4</span>],eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D94A <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">0</span>A          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span>Ah\t\t\t\t\t\t\t;i&lt;=<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D94E <span class=\"number\">7F</span> <span class=\"number\">13</span>                jg          func2+<span class=\"number\">43</span>h (<span class=\"number\">0040</span>d963)\t\t\t\t\t\t\t;i&gt;<span class=\"number\">10</span>,ret</span><br><span class=\"line\"><span class=\"number\">0040</span>D950 <span class=\"number\">8B</span> <span class=\"number\">4</span>D FC             mov         ecx,dword ptr [ebp<span class=\"number\">-4</span>]\t\t\t\t\t\t\t;i&lt;=<span class=\"number\">10</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D953 <span class=\"number\">51</span>                   push        ecx\t\t\t\t\t\t\t\t\t\t\t;ecx = i</span><br><span class=\"line\"><span class=\"number\">0040</span>D954 <span class=\"number\">68</span> C4 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;%d\\n&quot;</span> (<span class=\"number\">00422f</span>c4)</span><br><span class=\"line\"><span class=\"number\">0040</span>D959 E8 E2 <span class=\"number\">37</span> FF FF       call        <span class=\"built_in\">printf</span> (<span class=\"number\">00401140</span>)</span><br><span class=\"line\"><span class=\"number\">0040</span>D95E <span class=\"number\">83</span> C4 <span class=\"number\">08</span>             add         esp,<span class=\"number\">8</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D961 EB DE                jmp         func2+<span class=\"number\">21</span>h (<span class=\"number\">0040</span>d941)</span><br><span class=\"line\"><span class=\"number\">0040</span>D963 <span class=\"number\">5F</span>                   pop         edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D964 <span class=\"number\">5</span>E                   pop         esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D965 <span class=\"number\">5B</span>                   pop         ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D966 <span class=\"number\">83</span> C4 <span class=\"number\">44</span>             add         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D969 <span class=\"number\">3B</span> EC                cmp         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D96B E8 <span class=\"number\">50</span> <span class=\"number\">38</span> FF FF       call        __chkesp (<span class=\"number\">004011</span>c0)</span><br><span class=\"line\"><span class=\"number\">0040</span>D970 <span class=\"number\">8B</span> E5                mov         esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D972 <span class=\"number\">5</span>D                   pop         ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D973 C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"built_in\">func3</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(i&lt;=<span class=\"number\">10</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,i);</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D980 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D981 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D983 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D986 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D987 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D988 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D989 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D98C B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D991 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D996 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D998 C7 <span class=\"number\">45</span> FC <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D99F <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">0</span>A          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span>Ah</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A3 <span class=\"number\">7F</span> <span class=\"number\">1</span>C                jg          func3+<span class=\"number\">41</span>h (<span class=\"number\">0040</span>d9c1)</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A5 <span class=\"number\">8B</span> <span class=\"number\">45</span> FC             mov         eax,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A8 <span class=\"number\">50</span>                   push        eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A9 <span class=\"number\">68</span> C4 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;%d\\n&quot;</span> (<span class=\"number\">00422f</span>c4)</span><br><span class=\"line\"><span class=\"number\">0040</span>D9AE E8 <span class=\"number\">8</span>D <span class=\"number\">37</span> <span class=\"function\">FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9B3 83 C4 08             add         esp,8</span></span><br><span class=\"line\"><span class=\"function\">0040D9B6 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class=\"line\"><span class=\"function\">0040D9B9 83 C1 01             add         ecx,1</span></span><br><span class=\"line\"><span class=\"function\">0040D9BC 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class=\"line\"><span class=\"function\">0040D9BF EB DE                jmp         func3+1<span class=\"title\">Fh</span> <span class=\"params\">(<span class=\"number\">0040</span>d99f)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9C1 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040D9C2 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040D9C3 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040D9C4 83 C4 44             add         esp,44h</span></span><br><span class=\"line\"><span class=\"function\">0040D9C7 3B EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\">0040D9C9 E8 F2 37 FF FF       call        __<span class=\"title\">chkesp</span> <span class=\"params\">(<span class=\"number\">004011</span>c0)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9CE 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D9D0 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D9D1 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func4</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> i = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">do</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>);</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;<span class=\"keyword\">while</span>(i&lt;=<span class=\"number\">10</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D980 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D981 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D983 <span class=\"number\">83</span> EC <span class=\"number\">44</span>             sub         esp,<span class=\"number\">44</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D986 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D987 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D988 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D989 <span class=\"number\">8</span>D <span class=\"number\">7</span>D BC             lea         edi,[ebp<span class=\"number\">-44</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D98C B9 <span class=\"number\">11</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">11</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D991 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D996 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"number\">0040</span>D998 C7 <span class=\"number\">45</span> FC <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D99F <span class=\"number\">83</span> <span class=\"number\">7</span>D FC <span class=\"number\">0</span>A          cmp         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">0</span>Ah</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A3 <span class=\"number\">7F</span> <span class=\"number\">1</span>C                jg          func3+<span class=\"number\">41</span>h (<span class=\"number\">0040</span>d9c1)</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A5 <span class=\"number\">8B</span> <span class=\"number\">45</span> FC             mov         eax,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A8 <span class=\"number\">50</span>                   push        eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D9A9 <span class=\"number\">68</span> C4 <span class=\"number\">2F</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;%d\\n&quot;</span> (<span class=\"number\">00422f</span>c4)</span><br><span class=\"line\"><span class=\"number\">0040</span>D9AE E8 <span class=\"number\">8</span>D <span class=\"number\">37</span> <span class=\"function\">FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9B3 83 C4 08             add         esp,8</span></span><br><span class=\"line\"><span class=\"function\">0040D9B6 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class=\"line\"><span class=\"function\">0040D9B9 83 C1 01             add         ecx,1</span></span><br><span class=\"line\"><span class=\"function\">0040D9BC 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class=\"line\"><span class=\"function\">0040D9BF EB DE                jmp         func3+1<span class=\"title\">Fh</span> <span class=\"params\">(<span class=\"number\">0040</span>d99f)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9C1 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040D9C2 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040D9C3 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040D9C4 83 C4 44             add         esp,44h</span></span><br><span class=\"line\"><span class=\"function\">0040D9C7 3B EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\">0040D9C9 E8 F2 37 FF FF       call        __<span class=\"title\">chkesp</span> <span class=\"params\">(<span class=\"number\">004011</span>c0)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D9CE 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D9D0 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D9D1 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"指针\"><a class=\"markdownIt-Anchor\" href=\"#指针\">#</a> 指针</h3>\n<p>总结:<br>\n1、带有 <code>*</code>  的变量类型的标准写法: <code>变量类型* 变量名</code></p>\n<p>2、任何类型都可以带 <code>*</code>  加上 <code>*</code>  以后是新的类型</p>\n<p>3、* 可以是任意多个</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//赋值</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">Stu</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> a;</span><br><span class=\"line\">\t<span class=\"type\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* x;</span><br><span class=\"line\">\t<span class=\"type\">short</span>* y;</span><br><span class=\"line\">\t<span class=\"type\">int</span>* z;</span><br><span class=\"line\">\tStu* stu;</span><br><span class=\"line\">\t<span class=\"type\">int</span>** a;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (<span class=\"type\">char</span>*)<span class=\"number\">1</span>;</span><br><span class=\"line\">\ty = (<span class=\"type\">short</span>*)<span class=\"number\">2</span>;</span><br><span class=\"line\">\tz = (<span class=\"type\">int</span>*)<span class=\"number\">3</span>;</span><br><span class=\"line\">\tstu = (Stu*)<span class=\"number\">4</span>;</span><br><span class=\"line\">\ta = (<span class=\"type\">int</span>**)<span class=\"number\">5</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"number\">0040</span>D740 <span class=\"number\">55</span>                   push        ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D741 <span class=\"number\">8B</span> EC                mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">0040</span>D743 <span class=\"number\">83</span> EC <span class=\"number\">54</span>             sub         esp,<span class=\"number\">54</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D746 <span class=\"number\">53</span>                   push        ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D747 <span class=\"number\">56</span>                   push        esi</span><br><span class=\"line\"><span class=\"number\">0040</span>D748 <span class=\"number\">57</span>                   push        edi</span><br><span class=\"line\"><span class=\"number\">0040</span>D749 <span class=\"number\">8</span>D <span class=\"number\">7</span>D AC             lea         edi,[ebp<span class=\"number\">-54</span>h]</span><br><span class=\"line\"><span class=\"number\">0040</span>D74C B9 <span class=\"number\">15</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span>       mov         ecx,<span class=\"number\">15</span>h</span><br><span class=\"line\"><span class=\"number\">0040</span>D751 B8 CC CC CC CC       mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">0040</span>D756 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"><span class=\"number\">0040</span>D758 C7 <span class=\"number\">45</span> FC <span class=\"number\">01</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D75F C7 <span class=\"number\">45</span> F8 <span class=\"number\">02</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-8</span>],<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D766 C7 <span class=\"number\">45</span> F4 <span class=\"number\">03</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-0</span>Ch],<span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D76D C7 <span class=\"number\">45</span> F0 <span class=\"number\">04</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-10</span>h],<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D774 C7 <span class=\"number\">45</span> EC <span class=\"number\">05</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-14</span>h],<span class=\"number\">5</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//带*类型变量赋值必须使用完整写法</span></span><br><span class=\"line\"><span class=\"comment\">//不加家多少个*，宽度永远是4字节</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//++/--加多少取决于类型减去一个*之后的数据宽度</span></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">func2</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* x;</span><br><span class=\"line\">\t<span class=\"type\">short</span>* y;</span><br><span class=\"line\">\t<span class=\"type\">int</span>* z;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (<span class=\"type\">char</span>*)<span class=\"number\">1</span>;</span><br><span class=\"line\">\ty = (<span class=\"type\">short</span>*)<span class=\"number\">2</span>;</span><br><span class=\"line\">\tz = (<span class=\"type\">int</span>*)<span class=\"number\">3</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tx++;</span><br><span class=\"line\">\ty++;</span><br><span class=\"line\">\tz++;</span><br><span class=\"line\">\t<span class=\"comment\">//2,4,7</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,x,y,z);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">char</span>** x1;</span><br><span class=\"line\">\t<span class=\"type\">short</span>** y1;</span><br><span class=\"line\">\t<span class=\"type\">int</span>** z1;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx1 = (<span class=\"type\">char</span>**)<span class=\"number\">1</span>;</span><br><span class=\"line\">\ty1 = (<span class=\"type\">short</span>**)<span class=\"number\">2</span>;</span><br><span class=\"line\">\tz1 = (<span class=\"type\">int</span>**)<span class=\"number\">3</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tx1++;</span><br><span class=\"line\">\ty1++;</span><br><span class=\"line\">\tz1++;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,x1,y1,z1);</span><br><span class=\"line\">\t<span class=\"comment\">//5,6,7</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t<span class=\"type\">char</span>* x;</span><br><span class=\"line\">\t<span class=\"type\">short</span>* y;</span><br><span class=\"line\">\t<span class=\"type\">int</span>* z;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (<span class=\"type\">char</span>*)<span class=\"number\">100</span>;</span><br><span class=\"line\">\ty = (<span class=\"type\">short</span>*)<span class=\"number\">100</span>;</span><br><span class=\"line\">\tz = (<span class=\"type\">int</span>*)<span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx+=<span class=\"number\">5</span>;</span><br><span class=\"line\">\ty+=<span class=\"number\">5</span>;</span><br><span class=\"line\">\tz+=<span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,x,y,z);  <span class=\"comment\">//105 110 120</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">char</span>**** x;</span><br><span class=\"line\">\t<span class=\"type\">short</span>**** y;</span><br><span class=\"line\">\t<span class=\"type\">int</span>**** z;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (<span class=\"type\">char</span>****)<span class=\"number\">100</span>;</span><br><span class=\"line\">\ty = (<span class=\"type\">short</span>****)<span class=\"number\">100</span>;</span><br><span class=\"line\">\tz = (<span class=\"type\">int</span>****)<span class=\"number\">100</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx+=<span class=\"number\">5</span>;</span><br><span class=\"line\">\ty+=<span class=\"number\">5</span>;</span><br><span class=\"line\">\tz+=<span class=\"number\">5</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,x,y,z);  <span class=\"comment\">//120,120,120</span></span><br><span class=\"line\">总结:</span><br><span class=\"line\"><span class=\"number\">1.</span>带*类型的变量可以加、减一个整数，但不能乘或者除.</span><br><span class=\"line\"><span class=\"number\">2.</span>带*类型变量与其他整数相加或者相减时:</span><br><span class=\"line\"><span class=\"comment\">//带*类型变量＋N=带*类型变量+N(去掉一个*后类型的宽度)</span></span><br><span class=\"line\"><span class=\"comment\">//带*类型变量一N=带*类型变量–N(去掉一个*后类型的宽度)</span></span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\tchar**** x;</span><br><span class=\"line\">\tchar**** y;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (char****)200;</span><br><span class=\"line\">\ty = (char****)100;</span><br><span class=\"line\"></span><br><span class=\"line\">\tint a = x-y; </span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%d \\n&quot;,a);  //25</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tchar* x;</span><br><span class=\"line\">\tchar* y;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (char*)200;</span><br><span class=\"line\">\ty = (char*)100;</span><br><span class=\"line\"></span><br><span class=\"line\">\tint a = x-y;  //*相减结果为int</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%d \\n&quot;,a); //100</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tshort* x;</span><br><span class=\"line\">\tshort* y;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (short*)200;</span><br><span class=\"line\">\ty = (short*)100;</span><br><span class=\"line\"></span><br><span class=\"line\">\tint a = x-y; </span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%d \\n&quot;,a);   //50</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">总结:</span><br><span class=\"line\">1、两个类型相同的带*类型的变量可以进行减法操作</span><br><span class=\"line\">2、想减的结果要除以去掉一个*的数据的宽度.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//带*的类型可以做大小比较</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tshort**** x;</span><br><span class=\"line\">\tshort**** y;</span><br><span class=\"line\"></span><br><span class=\"line\">\tx = (short****)200;</span><br><span class=\"line\">\ty = (short****)100;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif(x&gt;y)</span><br><span class=\"line\">\t\tprintf(&quot;1&quot;);    //1</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t\tprintf(&quot;2&quot;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">char** arr[10]    //40</span><br><span class=\"line\">0040D740 55                   push        ebp</span><br><span class=\"line\">0040D741 8B EC                mov         ebp,esp</span><br><span class=\"line\">0040D743 83 EC 68             sub         esp,68h    //0x68-0x40=0x28=40/4=10</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">struct Student</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;; </span><br><span class=\"line\"></span><br><span class=\"line\">Student**** s;</span><br><span class=\"line\">s = (Student****)100;</span><br><span class=\"line\">s++;  //104</span><br><span class=\"line\">s += 2;  //112</span><br><span class=\"line\">s -= 3;  //100</span><br><span class=\"line\">s += 2.5;  //pointer on left; needs integral value on right</span><br><span class=\"line\"></span><br><span class=\"line\">Student**** s1;</span><br><span class=\"line\">Student**** s2;</span><br><span class=\"line\">int x;</span><br><span class=\"line\">s1 = (Student****)200;</span><br><span class=\"line\">s2 = (Student****)100;</span><br><span class=\"line\">x = s1-s2;  //25</span><br><span class=\"line\"></span><br><span class=\"line\">Student* s;</span><br><span class=\"line\">s = (Student*)100;</span><br><span class=\"line\">s++;  //108</span><br><span class=\"line\">s+=2;  //124</span><br><span class=\"line\">s-=3;  //100</span><br><span class=\"line\"></span><br><span class=\"line\">Student* s1;</span><br><span class=\"line\">Student* s2;</span><br><span class=\"line\">int x;</span><br><span class=\"line\">s1 = (Student*)200;</span><br><span class=\"line\">s2 = (Student*)100;</span><br><span class=\"line\">x=s1-s2  //12</span><br><span class=\"line\"></span><br><span class=\"line\">void func2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">#if 0</span><br><span class=\"line\">\tStudent**** s;</span><br><span class=\"line\">\ts = (Student****)100;</span><br><span class=\"line\">\ts++;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\">\ts += 2;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\">\ts -= 3; </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\"></span><br><span class=\"line\">\tStudent**** s1;</span><br><span class=\"line\">\tStudent**** s2;</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\ts1 = (Student****)200;</span><br><span class=\"line\">\ts2 = (Student****)100;</span><br><span class=\"line\">\tx = s1-s2; </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,x);</span><br><span class=\"line\"></span><br><span class=\"line\">\tStudent* s;</span><br><span class=\"line\">\ts = (Student*)100;</span><br><span class=\"line\">\ts++;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\">\ts+=2;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\">\ts-=3;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,s);</span><br><span class=\"line\"></span><br><span class=\"line\">\tStudent* s1;</span><br><span class=\"line\">\tStudent* s2;</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\ts1 = (Student*)200;</span><br><span class=\"line\">\ts2 = (Student*)100;</span><br><span class=\"line\">\tx=s1-s2;  </span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,x);</span><br><span class=\"line\"></span><br><span class=\"line\">\t#endif</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">Student**** 4</span><br><span class=\"line\">Student* 8</span><br><span class=\"line\"></span><br><span class=\"line\">Student s;</span><br><span class=\"line\">int x = (Studnet)s;   //x</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct Student</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">Student s;</span><br><span class=\"line\">int m = 10;</span><br><span class=\"line\">s = (Student)x;    //不能转，int不能和结构体类型互相转换</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int* x;</span><br><span class=\"line\">Student* y;</span><br><span class=\"line\">x = (int*) 10;</span><br><span class=\"line\">y = (Student*)x;    //可以转</span><br><span class=\"line\"></span><br><span class=\"line\">int* x;</span><br><span class=\"line\">Student y;</span><br><span class=\"line\">x = (Studnet*)y;   //不能转</span><br><span class=\"line\"></span><br><span class=\"line\">&amp;是地址符，类型是其后面的类型加一个“*”，任何变量都可以使用来获取地址，但不能用在常量上。</span><br><span class=\"line\">&amp;可以取任何一个变量的地址</span><br><span class=\"line\">&amp;a 的类型是a的类型+*</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">char***** a = (char*****)10;</span><br><span class=\"line\">&amp;a = char******</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125132226542.png\" alt=\"image-20230125132226542\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125133522040.png\" alt=\"image-20230125133522040\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230221165556550.png\" alt=\"image-20230221165556550\"></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">int</span>  x=<span class=\"number\">10</span>;</span><br><span class=\"line\"><span class=\"type\">int</span>* px = &amp;x;</span><br><span class=\"line\"><span class=\"type\">char</span> x1 = *px;</span><br><span class=\"line\">*x == x的类型减去一个*</span><br><span class=\"line\"></span><br><span class=\"line\">变量类型本来带*才能加*</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> arr[<span class=\"number\">5</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>&#125;;   <span class=\"comment\">//开辟8个字节缓冲区</span></span><br><span class=\"line\"><span class=\"type\">int</span>* x = &amp;arr[<span class=\"number\">0</span>];   <span class=\"comment\">//第一个变量的地址</span></span><br><span class=\"line\"><span class=\"type\">int</span>* px = arr;      <span class=\"comment\">//两种等价的写法</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">for</span>(<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i&lt;<span class=\"number\">5</span>;i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d &quot;</span>,arr[i]);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d &quot;</span>,*(px+i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//px是int*类型，运算时去掉一个*,变为int类型，偏移时每次+4找到数组中对应位置，*在解引用</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void func3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar a = 10;</span><br><span class=\"line\">\tshort b = 20;</span><br><span class=\"line\">\tint c = 30;</span><br><span class=\"line\"></span><br><span class=\"line\">\tchar* pa = &amp;a;</span><br><span class=\"line\">\tshort* pb = &amp;b;</span><br><span class=\"line\">\tint* pc = &amp;c;</span><br><span class=\"line\"></span><br><span class=\"line\">\tchar** ppa = &amp;pa;</span><br><span class=\"line\">\tshort** ppb = &amp;pb;</span><br><span class=\"line\">\tint** ppc = &amp;pc;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">0040D740 55                   push        ebp</span><br><span class=\"line\">0040D741 8B EC                mov         ebp,esp</span><br><span class=\"line\">0040D743 83 EC 64             sub         esp,64h</span><br><span class=\"line\">0040D746 53                   push        ebx</span><br><span class=\"line\">0040D747 56                   push        esi</span><br><span class=\"line\">0040D748 57                   push        edi</span><br><span class=\"line\">0040D749 8D 7D 9C             lea         edi,[ebp-64h]</span><br><span class=\"line\">0040D74C B9 19 00 00 00       mov         ecx,19h</span><br><span class=\"line\">0040D751 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">0040D756 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"></span><br><span class=\"line\">0040D758 C6 45 FC 0A          mov         byte ptr [ebp-4],0Ah</span><br><span class=\"line\">0040D75C 66 C7 45 F8 14 00    mov         word ptr [ebp-8],offset func3+20h (0040d760)</span><br><span class=\"line\">0040D762 C7 45 F4 1E 00 00 00 mov         dword ptr [ebp-0Ch],1Eh</span><br><span class=\"line\">0040D769 8D 45 FC             lea         eax,[ebp-4]</span><br><span class=\"line\">0040D76C 89 45 F0             mov         dword ptr [ebp-10h],eax</span><br><span class=\"line\">0040D76F 8D 4D F8             lea         ecx,[ebp-8]</span><br><span class=\"line\">0040D772 89 4D EC             mov         dword ptr [ebp-14h],ecx</span><br><span class=\"line\">0040D775 8D 55 F4             lea         edx,[ebp-0Ch]</span><br><span class=\"line\">0040D778 89 55 E8             mov         dword ptr [ebp-18h],edx</span><br><span class=\"line\">0040D77B 8D 45 F0             lea         eax,[ebp-10h]</span><br><span class=\"line\">0040D77E 89 45 E4             mov         dword ptr [ebp-1Ch],eax</span><br><span class=\"line\">0040D781 8D 4D EC             lea         ecx,[ebp-14h]</span><br><span class=\"line\">0040D784 89 4D E0             mov         dword ptr [ebp-20h],ecx</span><br><span class=\"line\">0040D787 8D 55 E8             lea         edx,[ebp-18h]</span><br><span class=\"line\">0040D78A 89 55 DC             mov         dword ptr [ebp-24h],edx</span><br><span class=\"line\">0040D78D 5F                   pop         edi</span><br><span class=\"line\">0040D78E 5E                   pop         esi</span><br><span class=\"line\">0040D78F 5B                   pop         ebx</span><br><span class=\"line\">0040D790 8B E5                mov         esp,ebp</span><br><span class=\"line\">0040D792 5D                   pop         ebp</span><br><span class=\"line\">0040D793 C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void func4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint p = 10;</span><br><span class=\"line\">\tint******* p7;</span><br><span class=\"line\">\tint****** p6;</span><br><span class=\"line\">\tint***** p5;</span><br><span class=\"line\">\tint**** p4;</span><br><span class=\"line\">\tint*** p3;</span><br><span class=\"line\">\tint** p2;</span><br><span class=\"line\">\tint* p1;</span><br><span class=\"line\"></span><br><span class=\"line\">\tp1 = &amp;p;</span><br><span class=\"line\">\tp2 = &amp;p1;</span><br><span class=\"line\">\tp3 = &amp;p2;</span><br><span class=\"line\">\tp4 = &amp;p3;</span><br><span class=\"line\">\tp5 = &amp;p4;</span><br><span class=\"line\">\tp6 = &amp;p5;</span><br><span class=\"line\">\tp7 = &amp;p6;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">0040D870 55                   push        ebp</span><br><span class=\"line\">0040D871 8B EC                mov         ebp,esp</span><br><span class=\"line\">0040D873 83 EC 60             sub         esp,60h</span><br><span class=\"line\">0040D876 53                   push        ebx</span><br><span class=\"line\">0040D877 56                   push        esi</span><br><span class=\"line\">0040D878 57                   push        edi</span><br><span class=\"line\">0040D879 8D 7D A0             lea         edi,[ebp-60h]</span><br><span class=\"line\">0040D87C B9 18 00 00 00       mov         ecx,18h</span><br><span class=\"line\">0040D881 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">0040D886 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\"></span><br><span class=\"line\">0040D888 C7 45 FC 0A 00 00 00 mov         dword ptr [ebp-4],0Ah</span><br><span class=\"line\">0040D88F 8D 45 FC             lea         eax,[ebp-4]</span><br><span class=\"line\">0040D892 89 45 E0             mov         dword ptr [ebp-20h],eax</span><br><span class=\"line\">0040D895 8D 4D E0             lea         ecx,[ebp-20h]</span><br><span class=\"line\">0040D898 89 4D E4             mov         dword ptr [ebp-1Ch],ecx</span><br><span class=\"line\">0040D89B 8D 55 E4             lea         edx,[ebp-1Ch]</span><br><span class=\"line\">0040D89E 89 55 E8             mov         dword ptr [ebp-18h],edx</span><br><span class=\"line\">0040D8A1 8D 45 E8             lea         eax,[ebp-18h]</span><br><span class=\"line\">0040D8A4 89 45 EC             mov         dword ptr [ebp-14h],eax</span><br><span class=\"line\">0040D8A7 8D 4D EC             lea         ecx,[ebp-14h]</span><br><span class=\"line\">0040D8AA 89 4D F0             mov         dword ptr [ebp-10h],ecx</span><br><span class=\"line\">0040D8AD 8D 55 F0             lea         edx,[ebp-10h]</span><br><span class=\"line\">0040D8B0 89 55 F4             mov         dword ptr [ebp-0Ch],edx</span><br><span class=\"line\">0040D8B3 8D 45 F4             lea         eax,[ebp-0Ch]</span><br><span class=\"line\">0040D8B6 89 45 F8             mov         dword ptr [ebp-8],eax</span><br><span class=\"line\">0040D8B9 5F                   pop         edi</span><br><span class=\"line\">0040D8BA 5E                   pop         esi</span><br><span class=\"line\">0040D8BB 5B                   pop         ebx</span><br><span class=\"line\">0040D8BC 8B E5                mov         esp,ebp</span><br><span class=\"line\">0040D8BE 5D                   pop         ebp</span><br><span class=\"line\">0040D8BF C3                   ret</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void fun()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint arr[5] = &#123;1,2,3,4,5&#125;;</span><br><span class=\"line\">\tfor (int k = 0;k&lt;5;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t*(arr+k) = 5 - k;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tfor (int i = 0;i&lt;5;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tprintf(&quot;%d\\n&quot;,*(arr+i));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126121202168.png\" alt=\"image-20230126121202168\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">char arr[] = &#123;</span><br><span class=\"line\">\t0x00,0x01,0x02,0x03,0x04,0x05,0x06,0x07,0x07,0x09,</span><br><span class=\"line\">\t0x00,0x20,0x10,0x03,0x03,0x0C,0x00,0x00,0x44,0x00,</span><br><span class=\"line\">\t0x00,0x33,0x00,0x47,0x0C,0x0E,0x00,0x0D,0x00,0x11,</span><br><span class=\"line\">\t0x00,0x00,0x00,0x02,0x64,0x00,0x00,0x00,0x0A,0x00,</span><br><span class=\"line\">\t0x00,0x00,0x64,0x10,0x00,0x00,0x00,0x00,0x00,0x00,</span><br><span class=\"line\">\t0x00,0x00,0x02,0x00,0x74,0x0F,0x41,0x00,0x00,0x00,</span><br><span class=\"line\">\t0x01,0x00,0x00,0x00,0x05,0x00,0x00,0x00,0x0A,0x00,</span><br><span class=\"line\">\t0x00,0x02,0x74,0x0F,0x41,0x00,0x06,0x08,0x00,0x00,</span><br><span class=\"line\">\t0x00,0x00,0x00,0x64,0x00,0x0F,0x00,0x00,0x0D,0x00,</span><br><span class=\"line\">\t0x00,0x00,0x23,0x00,0x00,0x64,0x00,0x00,0x64,0x00</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void FindBloodAddr()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint i = 0, length = sizeof(arr)/sizeof(arr[0]);</span><br><span class=\"line\">\twhile(i&lt;length - 4)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tint* p = (int*)(arr+i);</span><br><span class=\"line\">\t\tif(*p == 0x64)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tprintf(&quot;[%X] = %d\\n&quot;,p,*p);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tFindBloodAddr();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void FindNum()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar* add = data;   </span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%X\\n&quot;,add);</span><br><span class=\"line\">\tfor(int i=0; i&lt;sizeof(data)/sizeof(char)-4; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//*(add+i)</span><br><span class=\"line\">\t\tif(*(int*)(add+i) == 0x64)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tprintf(&quot;%d\\n&quot;,i);</span><br><span class=\"line\">\t\t\tprintf(&quot;[%X]=%d\\n&quot;, (int*)(add+i), *(int*)(add+i));</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">char</span> names[] = <span class=\"string\">&quot;ABCDE&quot;</span>;</span><br><span class=\"line\">==</span><br><span class=\"line\"><span class=\"type\">char</span> arr[<span class=\"number\">6</span>] = &#123;<span class=\"string\">&#x27;a&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;b&#x27;</span>,<span class=\"string\">&#x27;d&#x27;</span>,<span class=\"string\">&#x27;e&#x27;</span>,<span class=\"string\">&#x27;0&#x27;</span>&#125;;</span><br><span class=\"line\"><span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s\\n&quot;</span>,arr )</span><br><span class=\"line\"></span><br><span class=\"line\">代码区</span><br><span class=\"line\">堆栈区</span><br><span class=\"line\">全局变量区 - 可读可写</span><br><span class=\"line\">常量区 - 可读不可写</span><br><span class=\"line\">    </span><br><span class=\"line\"> </span><br><span class=\"line\"><span class=\"type\">char</span>* x = <span class=\"string\">&quot;China&quot;</span>;   <span class=\"comment\">//char*指向的字符串不能改，因为存储在常量区，char*的地址可以改</span></span><br><span class=\"line\"><span class=\"type\">char</span> y[] = <span class=\"string\">&quot;China&quot;</span>;  <span class=\"comment\">//全局区</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t*(x+<span class=\"number\">1</span>) = <span class=\"string\">&quot;A&quot;</span>;    <span class=\"comment\">//不能修改常量区 0xC0000005</span></span><br><span class=\"line\">    x = <span class=\"string\">&quot;abx&quot;</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\ty[<span class=\"number\">1</span>] = <span class=\"string\">&#x27;A&#x27;</span>;    <span class=\"comment\">//常量区的内容复制到局部变量中</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">char</span>* x = <span class=\"string\">&quot;China&quot;</span>;     <span class=\"comment\">//china在常量区，x是china在常量区的首地址 </span></span><br><span class=\"line\">\t<span class=\"type\">char</span> y[] = <span class=\"string\">&quot;China&quot;</span>;    <span class=\"comment\">//china在常量区，被拷贝到栈中</span></span><br><span class=\"line\">\t*(x+<span class=\"number\">1</span>) = <span class=\"string\">&quot;A&quot;</span>;          <span class=\"comment\">//0xC0000005</span></span><br><span class=\"line\">\t  </span><br><span class=\"line\">\ty[<span class=\"number\">1</span>] = <span class=\"string\">&#x27;A&#x27;</span>;   \t\t   <span class=\"comment\">//修改栈中数据</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">strlen</span><span class=\"params\">(<span class=\"type\">char</span>* s)</span>   <span class=\"comment\">//返回值是s的长度，不包括\\0</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123; </span><br><span class=\"line\">\t<span class=\"type\">int</span> ret = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*(s) != <span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        </span><br><span class=\"line\">        ret++;</span><br><span class=\"line\">        s++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">strcpy</span><span class=\"params\">(<span class=\"type\">char</span>* dest, <span class=\"type\">char</span>* src)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">char</span>* ret = dest;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*(dest++) = *(src)++);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">strcat</span><span class=\"params\">(<span class=\"type\">char</span>* dest, <span class=\"type\">char</span>* src)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">char</span>* ret = dest;</span><br><span class=\"line\"> \t<span class=\"keyword\">while</span>(*dest != <span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        dest++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*dest++ = *src++);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">strcmp</span><span class=\"params\">(<span class=\"type\">char</span>*s1, <span class=\"type\">char</span>* s2)</span> <span class=\"comment\">//一样返回0，不一样返回1</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(*s1!=<span class=\"number\">0</span> &amp;&amp; *s2!=<span class=\"number\">0</span>)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(*s1++ != *s2++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">FindRoleNameAddr</span><span class=\"params\">(<span class=\"type\">char</span>* pData, <span class=\"type\">char</span>* pRoleName)</span> <span class=\"comment\">//返回值为指针的为指针函数</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//返回值为带*类型的函数为指针函数</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;string.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> data[] = &#123;</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x01</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x04</span>,<span class=\"number\">0x05</span>,<span class=\"number\">0x06</span>,<span class=\"number\">0x07</span>,<span class=\"number\">0x07</span>,<span class=\"number\">0x09</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x20</span>,<span class=\"number\">0x10</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x0C</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x44</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x33</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x47</span>,<span class=\"number\">0x0C</span>,<span class=\"number\">0x0E</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0D</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x11</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0A</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x10</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x74</span>,<span class=\"number\">0x0F</span>,<span class=\"number\">0x41</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x01</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x05</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0A</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x57</span>,<span class=\"number\">0x4F</span>,<span class=\"number\">0x57</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x06</span>,<span class=\"number\">0x08</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0F</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0D</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x23</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">strlen</span><span class=\"params\">(<span class=\"type\">char</span>* s)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> len = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(*s != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tlen++;</span><br><span class=\"line\">\t\ts++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> len;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">strcpy</span><span class=\"params\">(<span class=\"type\">char</span>* dest, <span class=\"type\">char</span>* src)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* ret = dest;   <span class=\"comment\">//需要先保存首地址，后续dest指针会随着循环向后移，但返回时还是返回首地址</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span>((*dest++) = (*src++));   <span class=\"comment\">//这是赋值语句，0也会被复制，先复制在判断</span></span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\twhile(*src != 0) </span></span><br><span class=\"line\"><span class=\"comment\">\t&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t*dest = *src;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tsrc++;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tdest++;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">strcat</span><span class=\"params\">(<span class=\"type\">char</span>* dest, <span class=\"type\">char</span>* src)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* ret = dest;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(*dest != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tdest++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(*dest != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t*dest = *src;</span><br><span class=\"line\">\t\tdest++;</span><br><span class=\"line\">\t\tsrc++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ret;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">strcmp</span><span class=\"params\">(<span class=\"type\">char</span>* s1, <span class=\"type\">char</span>* s2)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(*s1 !=<span class=\"number\">0</span> || *s2 != <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(*s1 == *s2)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\ts1++;</span><br><span class=\"line\">\t\t\ts2++;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">char</span>* <span class=\"title\">FindRoleNameAddr</span><span class=\"params\">(<span class=\"type\">char</span>* pData, <span class=\"type\">char</span>* pRoleName)</span> </span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> total = <span class=\"built_in\">sizeof</span>(data)/<span class=\"built_in\">sizeof</span>(data[<span class=\"number\">0</span>]);</span><br><span class=\"line\">\t<span class=\"type\">int</span> length = <span class=\"built_in\">strlen</span>(pRoleName);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;=total-length; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(*(pData+i) == <span class=\"number\">0x57</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">strncmp</span>(&amp;pData[i],pRoleName,<span class=\"number\">3</span>) == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> &amp;pData[i];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">char</span> arr2[] = <span class=\"string\">&quot;WOW&quot;</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,data);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,<span class=\"built_in\">FindRoleNameAddr</span>(data, arr2));</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230126151524978.png\" alt=\"image-20230126151524978\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//指针数组</span><br><span class=\"line\">int*** arr[5];</span><br><span class=\"line\"></span><br><span class=\"line\">char a1 = &#x27;A&#x27;;</span><br><span class=\"line\">char* p1 = &amp;a1;</span><br><span class=\"line\"></span><br><span class=\"line\">char* arr = &quot;china&quot;;</span><br><span class=\"line\">printf(&quot;%s\\n&quot;,arr);  //china</span><br><span class=\"line\"></span><br><span class=\"line\">char arr[10] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class=\"line\">printf(&quot;%s\\n&quot;,arr);   //china</span><br><span class=\"line\">0040D7B8 C6 45 F4 63          mov         byte ptr [ebp-0Ch],63h</span><br><span class=\"line\">0040D7BC C6 45 F5 68          mov         byte ptr [ebp-0Bh],68h</span><br><span class=\"line\">0040D7C0 C6 45 F6 69          mov         byte ptr [ebp-0Ah],69h</span><br><span class=\"line\">0040D7C4 C6 45 F7 6E          mov         byte ptr [ebp-9],6Eh</span><br><span class=\"line\">0040D7C8 C6 45 F8 61          mov         byte ptr [ebp-8],61h</span><br><span class=\"line\">0040D7CC 33 C0                xor         eax,eax</span><br><span class=\"line\">0040D7CE 89 45 F9             mov         dword ptr [ebp-7],eax</span><br><span class=\"line\">0040D7D1 88 45 FD             mov         byte ptr [ebp-3],al</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">char arr[5] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class=\"line\">printf(&quot;%s\\n&quot;,arr);   //china烫虉</span><br><span class=\"line\"></span><br><span class=\"line\">char arr[5] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;&#125;;</span><br><span class=\"line\">printf(&quot;%c\\n&quot;,arr);   //@</span><br><span class=\"line\"></span><br><span class=\"line\">char arr[6] = &#123;&#x27;c&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;n&#x27;,&#x27;a&#x27;,&#x27;\\0&#x27;&#125;;</span><br><span class=\"line\">printf(&quot;%s\\n&quot;,arr);   //china</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">char* arr[] = &#123;&quot;if&quot;,&quot;or&quot;,&quot;while&quot;,&quot;for&quot;&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">char* p1 = &quot;if&quot;</span><br><span class=\"line\">char* p2 = &quot;for&quot;;</span><br><span class=\"line\">char* p3 = &quot;while&quot;;</span><br><span class=\"line\">char* p4 = &quot;switch&quot;;</span><br><span class=\"line\">char* keyword[] = &#123;p1,p2,p3,p4&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">for(int i=0;i&lt;4;i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    printf(&quot;%s\\n&quot;,*(arr+i));</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230224153206988.png\" alt=\"image-20230224153206988\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//结构体指针</span><br><span class=\"line\">struct Stu</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Stu* stu;</span><br><span class=\"line\">stu = (Stu*)100;</span><br><span class=\"line\">stu++;  //+12</span><br><span class=\"line\"></span><br><span class=\"line\">Stu* Stu1 = (Stu*)20;</span><br><span class=\"line\">int x = stu - stu1;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Stu s;</span><br><span class=\"line\">s.a = 10;</span><br><span class=\"line\">s.b = 20;</span><br><span class=\"line\">s.c = 30;</span><br><span class=\"line\">Stu *ss = &amp;s;</span><br><span class=\"line\">ss-&gt;a = 100;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int x = 10;</span><br><span class=\"line\">Stu* s = (Stu*)&amp;x;</span><br><span class=\"line\">printf(&quot;%d %d %d&quot;,s-&gt;a,s-&gt;b,s-&gt;c);   //10,x,x  x取决于内存中有什么</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int x1 = 1;</span><br><span class=\"line\">int x2 = 2;</span><br><span class=\"line\">int x3 = 3;</span><br><span class=\"line\"></span><br><span class=\"line\">int* arr[3];</span><br><span class=\"line\">arr[0] = &amp;x1;</span><br><span class=\"line\">arr[1] = &amp;x2;</span><br><span class=\"line\">arr[2] = &amp;x3;</span><br><span class=\"line\"></span><br><span class=\"line\">char* p1 = &quot;if&quot;</span><br><span class=\"line\">char* p2 = &quot;for&quot;;</span><br><span class=\"line\">char* p3 = &quot;while&quot;;</span><br><span class=\"line\">char* p4 = &quot;switch&quot;;</span><br><span class=\"line\">char* keyword[] = &#123;p1,p2,p3,p4&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">for(int i=0;i&lt;4;i++)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    printf(&quot;%s\\n&quot;,*(arr+i));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230127133346425.png\" alt=\"image-20230127133346425\"></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">TagPlayer</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> id;</span><br><span class=\"line\">\t<span class=\"type\">int</span> level;</span><br><span class=\"line\">&#125;Player;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span> data[] = &#123;</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x01</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x04</span>,<span class=\"number\">0x05</span>,<span class=\"number\">0x06</span>,<span class=\"number\">0x07</span>,<span class=\"number\">0x07</span>,<span class=\"number\">0x09</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x20</span>,<span class=\"number\">0x10</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x03</span>,<span class=\"number\">0x0C</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x44</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x33</span>,<span class=\"number\">0x01</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x08</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0A</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x10</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x74</span>,<span class=\"number\">0x0F</span>,<span class=\"number\">0x41</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x01</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x08</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0A</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x02</span>,<span class=\"number\">0x57</span>,<span class=\"number\">0x4F</span>,<span class=\"number\">0x57</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x06</span>,<span class=\"number\">0x08</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0F</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x0D</span>,<span class=\"number\">0x00</span>,</span><br><span class=\"line\">\t<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x23</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x00</span>,<span class=\"number\">0x64</span>,<span class=\"number\">0x00</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">fun</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* haha = data;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>; i&lt;<span class=\"keyword\">sizeof</span>(data)/<span class=\"keyword\">sizeof</span>(data[<span class=\"number\">0</span>])-<span class=\"keyword\">sizeof</span>(Player); i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tPlayer* hehe = (Player*)(haha+i);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(hehe-&gt;id == <span class=\"number\">0x01</span> &amp;&amp; hehe-&gt;level == <span class=\"number\">0x08</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\ %d \\n&quot;</span>,&amp;(hehe-&gt;id),hehe-&gt;id);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfun();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">*(p1+x)  = p1[x]</span><br><span class=\"line\">两种写法一样</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span>** p2;</span><br><span class=\"line\">*(*(p2+<span class=\"number\">1</span>)) +<span class=\"number\">4</span></span><br><span class=\"line\">*(*(p2+<span class=\"number\">1</span>)+<span class=\"number\">1</span>) +<span class=\"number\">4</span>+<span class=\"number\">1</span></span><br><span class=\"line\">*(*(p2+<span class=\"number\">2</span>)+<span class=\"number\">3</span>) == p2[<span class=\"number\">2</span>][<span class=\"number\">3</span>]  +<span class=\"number\">8</span>+<span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">char</span>*** p3;</span><br><span class=\"line\">*(*(*(p3+<span class=\"number\">1</span>)+<span class=\"number\">2</span>)+<span class=\"number\">3</span>) == p3[<span class=\"number\">1</span>][<span class=\"number\">2</span>][<span class=\"number\">3</span>]  +<span class=\"number\">4</span>+<span class=\"number\">8</span>+<span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//结构体指针</span></span><br><span class=\"line\">Student* s;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//数组指针</span></span><br><span class=\"line\"><span class=\"built_in\">int</span> (*px)[<span class=\"number\">5</span>];  </span><br><span class=\"line\"><span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,<span class=\"built_in\">sizeof</span>(px));  <span class=\"comment\">//4</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//赋值</span></span><br><span class=\"line\">px = ((*px)[<span class=\"number\">5</span>])<span class=\"number\">10</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//*px 指向 int[5]</span></span><br><span class=\"line\">px++;  +<span class=\"number\">20</span> </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> arr[<span class=\"number\">16</span>] = &#123;<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>&#125;;</span><br><span class=\"line\"><span class=\"built_in\">int</span> (*px)[<span class=\"number\">2</span>];</span><br><span class=\"line\">px = (<span class=\"built_in\">int</span> (*px)[<span class=\"number\">2</span>])arr;  </span><br><span class=\"line\">*px == &amp;arr[<span class=\"number\">0</span>]</span><br><span class=\"line\">*(*px) == arr[<span class=\"number\">0</span>]</span><br><span class=\"line\">*(*(px)) = <span class=\"number\">1</span></span><br><span class=\"line\">*(*(px+<span class=\"number\">1</span>)+<span class=\"number\">1</span>) == <span class=\"number\">4</span>  +<span class=\"number\">8b</span>yte+<span class=\"number\">4b</span>yte   <span class=\"number\">1</span>+<span class=\"number\">3</span> </span><br><span class=\"line\">*(*(px+<span class=\"number\">3</span>)+<span class=\"number\">3</span>) == <span class=\"number\">4</span>  +<span class=\"number\">3</span>*<span class=\"number\">8b</span>yte+<span class=\"number\">3</span>*<span class=\"number\">4b</span>yte   <span class=\"number\">3</span>*<span class=\"number\">2</span>+<span class=\"number\">3</span> </span><br><span class=\"line\"><span class=\"comment\">//px 和 *px 里面的值一样</span></span><br><span class=\"line\"><span class=\"comment\">//但运算时宽度不一样  </span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//指针数组</span></span><br><span class=\"line\"><span class=\"type\">int</span>* p[<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"comment\">//这个数组的所有元素都是指针类型</span></span><br><span class=\"line\"><span class=\"comment\">//数组指针</span></span><br><span class=\"line\"><span class=\"built_in\">int</span> (*p)[<span class=\"number\">5</span>];</span><br><span class=\"line\"><span class=\"comment\">//这个指针存放着一个数组的首地址，或者说这个指针指向一个数组的首地址。</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//int (*p)[5] 可以不指向一个数组</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">int</span> (*px)[<span class=\"number\">5</span>];</span><br><span class=\"line\">*(*(px+<span class=\"number\">2</span>)+<span class=\"number\">2</span>)  <span class=\"number\">2</span>*<span class=\"number\">4</span>*<span class=\"number\">5</span>+<span class=\"number\">2</span>*<span class=\"number\">4</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\">//二维数组指针</span></span><br><span class=\"line\"><span class=\"built_in\">char</span> (*px)[<span class=\"number\">2</span>][<span class=\"number\">3</span>];</span><br><span class=\"line\">*(*(*(px+<span class=\"number\">2</span>)+<span class=\"number\">3</span>)+<span class=\"number\">4</span>)  <span class=\"number\">2</span>*<span class=\"number\">3</span>*<span class=\"number\">2</span>+<span class=\"number\">3</span>*<span class=\"number\">3</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">char</span> (*px)[<span class=\"number\">2</span>][<span class=\"number\">3</span>][<span class=\"number\">2</span>];</span><br><span class=\"line\">px = (<span class=\"built_in\">char</span> (*px)[<span class=\"number\">2</span>][<span class=\"number\">3</span>][<span class=\"number\">2</span>])code;</span><br><span class=\"line\">*(*(*(*(px+<span class=\"number\">2</span>)+<span class=\"number\">3</span>)+<span class=\"number\">1</span>)+<span class=\"number\">4</span>)</span><br><span class=\"line\"><span class=\"number\">2</span>*<span class=\"number\">2</span>*<span class=\"number\">3</span>*<span class=\"number\">2</span>*<span class=\"number\">1</span> + <span class=\"number\">3</span>*<span class=\"number\">3</span>*<span class=\"number\">2</span>*<span class=\"number\">1</span> + <span class=\"number\">1</span>*<span class=\"number\">2</span>*<span class=\"number\">1</span> + <span class=\"number\">4</span>*<span class=\"number\">1</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"built_in\">int</span> (*pFun)(<span class=\"type\">int</span>,<span class=\"type\">int</span>)    <span class=\"comment\">//sizeof() = 4   是返回值为int，有两个int参数</span></span><br><span class=\"line\">pFun++   <span class=\"comment\">//illegal 因为宽度不确定</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Function</span><span class=\"params\">(<span class=\"type\">int</span> a,<span class=\"type\">int</span> b)</span>  </span>&#123; &#125;</span><br><span class=\"line\">pFun = Function;</span><br><span class=\"line\"><span class=\"type\">int</span> sb = <span class=\"built_in\">pFun</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>);</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225163935045.png\" alt=\"image-20230225163935045\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225172241524.png\" alt=\"image-20230225172241524\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint arr[] = &#123;1,2,3,4,5,6,7&#125;;</span><br><span class=\"line\">\tint (*px)[5];</span><br><span class=\"line\">\tpx = (int (*)[5])arr;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%X %X\\n&quot;,*(px+1)[2],px[1][2]);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">0040D768 C7 45 E4 01 00 00 00 mov         dword ptr [ebp-1Ch],1</span><br><span class=\"line\">0040D76F C7 45 E8 02 00 00 00 mov         dword ptr [ebp-18h],2</span><br><span class=\"line\">0040D776 C7 45 EC 03 00 00 00 mov         dword ptr [ebp-14h],3</span><br><span class=\"line\">0040D77D C7 45 F0 04 00 00 00 mov         dword ptr [ebp-10h],4</span><br><span class=\"line\">0040D784 C7 45 F4 05 00 00 00 mov         dword ptr [ebp-0Ch],5</span><br><span class=\"line\">0040D78B C7 45 F8 06 00 00 00 mov         dword ptr [ebp-8],6</span><br><span class=\"line\">0040D792 C7 45 FC 07 00 00 00 mov         dword ptr [ebp-4],7</span><br><span class=\"line\">0040D799 8D 45 E4             lea         eax,[ebp-1Ch]   &amp;arr[0]</span><br><span class=\"line\">0040D79C 89 45 E0             mov         dword ptr [ebp-20h],eax  </span><br><span class=\"line\">0040D79F 8B 4D E0             mov         ecx,dword ptr [ebp-20h]</span><br><span class=\"line\">0040D7A2 8B 51 1C             mov         edx,dword ptr [ecx+1Ch]</span><br><span class=\"line\">0040D7A5 52                   push        edx</span><br><span class=\"line\">0040D7A6 8B 45 E0             mov         eax,dword ptr [ebp-20h]</span><br><span class=\"line\">0040D7A9 8B 48 3C             mov         ecx,dword ptr [eax+3Ch]</span><br><span class=\"line\">0040D7AC 51                   push        ecx</span><br><span class=\"line\">0040D7AD 68 1C 20 42 00       push        offset string &quot;%d %d %d\\n&quot; (0042201c)</span><br><span class=\"line\">0040D7B2 E8 09 39 FF FF       call        printf (004010c0)</span><br><span class=\"line\">0040D7B7 83 C4 0C             add         esp,0Ch</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint arr[] = &#123;1,2,3,4,5,6,7&#125;;</span><br><span class=\"line\">\tint (*px)[5];</span><br><span class=\"line\">\tpx = (int (*)[5])arr;</span><br><span class=\"line\">\tfor(int i=0; i&lt;sizeof(arr)/sizeof(arr[0]); i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tprintf(&quot;%d\\n&quot;,*(*(px)+i));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"../AppData/Roaming/Typora/typora-user-images/image-20230130142624937.png\" alt=\"image-20230130142624937\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int (*px)[2];</span><br><span class=\"line\">int (*py)[2][3];</span><br><span class=\"line\">char (*pz)[2];</span><br><span class=\"line\">char (*pk)[2][3];</span><br><span class=\"line\"></span><br><span class=\"line\">*(*(px+0)+0)   03020100</span><br><span class=\"line\">*(*(px+1)+0)    20000907</span><br><span class=\"line\">*(*(px+2)+3)   1100</span><br><span class=\"line\">*(*(*(py+1)+2)+3)   01</span><br><span class=\"line\">*(*(pz+2)+3)  07</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int *(pFunc)(int,int)</span><br><span class=\"line\">sizeof = 4</span><br><span class=\"line\"></span><br><span class=\"line\">int Function(int x, int y)</span><br><span class=\"line\">&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int (*pFun)(int,int);</span><br><span class=\"line\">pFun = Function;</span><br><span class=\"line\">int x= pFun(1,2);</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230130145723603.png\" alt=\"image-20230130145723603\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int Func(int x,int y)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\treturn x*y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">0040D770 55                   push        ebp</span><br><span class=\"line\">0040D771 8B EC                mov         ebp,esp</span><br><span class=\"line\">0040D773 83 EC 40             sub         esp,40h</span><br><span class=\"line\">0040D776 53                   push        ebx</span><br><span class=\"line\">0040D777 56                   push        esi</span><br><span class=\"line\">0040D778 57                   push        edi</span><br><span class=\"line\">0040D779 8D 7D C0             lea         edi,[ebp-40h]</span><br><span class=\"line\">0040D77C B9 10 00 00 00       mov         ecx,10h</span><br><span class=\"line\">0040D781 B8 CC CC CC CC       mov         eax,0CCCCCCCCh</span><br><span class=\"line\">0040D786 F3 AB                rep stos    dword ptr [edi]</span><br><span class=\"line\">0040D788 8B 45 08             mov         eax,dword ptr [ebp+8]</span><br><span class=\"line\">0040D78B 0F AF 45 0C          imul        eax,dword ptr [ebp+0Ch]</span><br><span class=\"line\">0040D78F 5F                   pop         edi</span><br><span class=\"line\">0040D790 5E                   pop         esi</span><br><span class=\"line\">0040D791 5B                   pop         ebx</span><br><span class=\"line\">0040D792 8B E5                mov         esp,ebp</span><br><span class=\"line\">0040D794 5D                   pop         ebp</span><br><span class=\"line\">0040D795 C3                   ret</span><br><span class=\"line\">55</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">unsigned char Func[] = &#123;</span><br><span class=\"line\">\t0x55,              </span><br><span class=\"line\">    0x8B, 0xEC,           </span><br><span class=\"line\">    0x83, 0xEC, 0x40,        </span><br><span class=\"line\">    0x53,              </span><br><span class=\"line\">    0x56,              </span><br><span class=\"line\">    0x57,              </span><br><span class=\"line\">    0x8D, 0x7D, 0xC0,        </span><br><span class=\"line\">    0xB9, 0x10, 0x00, 0x00, 0x00,  </span><br><span class=\"line\">    0xB8, 0xCC, 0xCC, 0xCC, 0xCC,  </span><br><span class=\"line\">    0xF3, 0xAB,    </span><br><span class=\"line\">    0x8B, 0x45, 0x08,     </span><br><span class=\"line\">    0x0F, 0xAF, 0x45, 0x0C,</span><br><span class=\"line\">    0x5F,              </span><br><span class=\"line\">    0x5E,              </span><br><span class=\"line\">    0x5B,              </span><br><span class=\"line\">    0x8B, 0xE5,           </span><br><span class=\"line\">    0x5D,              </span><br><span class=\"line\">    0xC3              </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint (*p)(int,int);</span><br><span class=\"line\">\tp = (int (*)(int,int))&amp;Func;</span><br><span class=\"line\">\tint x = p(3,4);</span><br><span class=\"line\">\tprintf(&quot;%d\\n&quot;,x);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"位运算\"><a class=\"markdownIt-Anchor\" href=\"#位运算\">#</a> 位运算</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">算术移位</span><br><span class=\"line\">SAL/SAR Reg/Mem,CL/Imm</span><br><span class=\"line\"></span><br><span class=\"line\">SAL:算术左移，补0</span><br><span class=\"line\">SAR:算术右移，补符号位</span><br><span class=\"line\"></span><br><span class=\"line\">逻辑位移</span><br><span class=\"line\">SHL 补0</span><br><span class=\"line\">SHR 补0</span><br><span class=\"line\"></span><br><span class=\"line\">循环位移 </span><br><span class=\"line\">ROL</span><br><span class=\"line\">ROR</span><br><span class=\"line\"></span><br><span class=\"line\">带进位的循环移位指令</span><br><span class=\"line\">RCL</span><br><span class=\"line\">RCR</span><br><span class=\"line\"></span><br><span class=\"line\">2&amp;3 = 2</span><br><span class=\"line\">2|3 = 3</span><br><span class=\"line\">~2 = fd</span><br><span class=\"line\">2^3 = 1</span><br><span class=\"line\"></span><br><span class=\"line\">int x</span><br><span class=\"line\">x &gt;&gt; rol</span><br><span class=\"line\">x &lt;&lt; shr</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"define\"><a class=\"markdownIt-Anchor\" href=\"#define\">#</a> define</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">替换</span><br><span class=\"line\">编译</span><br><span class=\"line\">连接</span><br><span class=\"line\"></span><br><span class=\"line\">typedef只能给类型起别名</span><br><span class=\"line\">define可以给任何起别名</span><br><span class=\"line\"></span><br><span class=\"line\">define定义的变量不在常量区，在替换的环节直接替换为</span><br><span class=\"line\"></span><br><span class=\"line\">#define PI 3.14   //无参数宏</span><br><span class=\"line\">#define MAX(A,B) ((A)&gt;(B)?(A):(B))     //无堆栈调用</span><br><span class=\"line\">#define \\ 定义多行</span><br><span class=\"line\"></span><br><span class=\"line\">//避免重复包含</span><br><span class=\"line\">#if !define(ZZZ)</span><br><span class=\"line\">#define ZZZ </span><br><span class=\"line\">...</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//stdafx.h</span><br><span class=\"line\"></span><br><span class=\"line\">#if !defined(AFX_STDAFX_H__7058845C_68A9_4312_A9CE_A08FAB5CE1F2__INCLUDED_)</span><br><span class=\"line\">#define AFX_STDAFX_H__7058845C_68A9_4312_A9CE_A08FAB5CE1F2__INCLUDED_</span><br><span class=\"line\"></span><br><span class=\"line\">#if _MSC_VER &gt; 1000</span><br><span class=\"line\">#pragma once     //pragma对编译器兼容不好，如果版本&gt;1000才使用pragma once ,否则就使用上面的方法</span><br><span class=\"line\">#endif // _MSC_VER &gt; 1000</span><br><span class=\"line\"></span><br><span class=\"line\">#define WIN32_LEAN_AND_MEAN\t\t// Exclude rarely-used stuff from Windows headers</span><br><span class=\"line\"></span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"malloc\"><a class=\"markdownIt-Anchor\" href=\"#malloc\">#</a> malloc</h3>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;malloc.h&gt;</span></span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;</span> 先到当前目录，&lt;&gt;先到安装目录</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span>* ptr;</span><br><span class=\"line\">ptr = (<span class=\"type\">int</span>*)<span class=\"built_in\">malloc</span>(<span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>)*<span class=\"number\">128</span>); <span class=\"comment\">//void* malloc(size_t size)   void*类型不确定，用的时候强转</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (ptr == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"number\">0</span>;        <span class=\"comment\">//无法分配内存的时候返回NULL</span></span><br><span class=\"line\"><span class=\"built_in\">memset</span>(ptr,<span class=\"number\">0</span>,<span class=\"keyword\">sizeof</span>(<span class=\"type\">int</span>)*<span class=\"number\">128</span>);    <span class=\"comment\">//初始化分配的内存空间</span></span><br><span class=\"line\">*(ptr) = <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"built_in\">free</span>(ptr);   <span class=\"comment\">//释放堆空间</span></span><br><span class=\"line\">ptr = <span class=\"literal\">NULL</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fopen</span><br><span class=\"line\">fseek  设置文件指针</span><br><span class=\"line\">ftell  文件大小</span><br><span class=\"line\">fclose</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230201143200063.png\" alt=\"image-20230201143200063\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &quot;stdlib.h&quot;</span><br><span class=\"line\">#include &quot;malloc.h&quot;</span><br><span class=\"line\">#include &lt;string.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tFILE *fp = NULL;</span><br><span class=\"line\">\tfp = fopen(&quot;C:\\\\Windows\\\\System32\\\\notepad.exe&quot;,&quot;rb&quot;);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tif(fp == NULL) return -1;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfseek(fp,0,SEEK_END);</span><br><span class=\"line\"></span><br><span class=\"line\">\tint len = ftell(fp);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t//printf(&quot;%d\\n&quot;,len);</span><br><span class=\"line\">\tchar* ptr;</span><br><span class=\"line\">\tptr = (char*)malloc(len);</span><br><span class=\"line\">\tif(ptr == NULL) return -1;</span><br><span class=\"line\">\tmemset(ptr,0,len);</span><br><span class=\"line\"></span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\twhile(1)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tc = fgetc(fp);</span><br><span class=\"line\">\t\tif(feof(fp)) break;</span><br><span class=\"line\">\t\tprintf(&quot;%c&quot;, c);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;%X\\n&quot;,ptr);</span><br><span class=\"line\"></span><br><span class=\"line\">\tfree(ptr);</span><br><span class=\"line\">\tptr = NULL;</span><br><span class=\"line\">\tfclose(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"pe\"><a class=\"markdownIt-Anchor\" href=\"#pe\">#</a> PE</h2>\n<h3 id=\"pe结构\"><a class=\"markdownIt-Anchor\" href=\"#pe结构\">#</a> PE 结构</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sys dll exe 4D5A开头 MZ的ASCII</span><br><span class=\"line\"></span><br><span class=\"line\">PE结构是分节的</span><br><span class=\"line\">1.节省硬盘空间，内存中的空隙会更大(任何exe都有自己的4G空间，2G程序，2G操作系统，通过指针访问低2G,通过驱动访问高2G)</span><br><span class=\"line\">2.对齐：早期程序硬盘对齐200H，内存对齐1000H.现在大部分都是1000H字节对齐，增加读写速度</span><br><span class=\"line\">3.节省内存，不在复制全部节</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203140027163.png\" alt=\"image-20230203140027163\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DOS头</span><br><span class=\"line\">WORD e_magic    MZ判断是否是可执行文件</span><br><span class=\"line\">DWORD e_lfanew  从文件开始算，偏移e_lfanew个字节就是PE文件开始 </span><br><span class=\"line\"></span><br><span class=\"line\">NT头</span><br><span class=\"line\">Machine</span><br><span class=\"line\">NumberOfSections</span><br><span class=\"line\">TimeDateStamp</span><br><span class=\"line\">SizeOfOptionalHeader</span><br><span class=\"line\">Characteristics</span><br><span class=\"line\"></span><br><span class=\"line\">可选PE头</span><br><span class=\"line\">Magic</span><br><span class=\"line\">SizeOfCode</span><br><span class=\"line\">SizeOfInitializedData</span><br><span class=\"line\">SizeOfUnInitializedData</span><br><span class=\"line\">AddressOfEntryPoint</span><br><span class=\"line\">BaseOfCode</span><br><span class=\"line\">BaseOfData</span><br><span class=\"line\">ImageBase</span><br><span class=\"line\">SectionAlignment;</span><br><span class=\"line\">FileAlignment</span><br><span class=\"line\">SizeOfImage</span><br><span class=\"line\">SizeOfHeaders</span><br><span class=\"line\">CheckSum</span><br><span class=\"line\">SizeOfStackReverse</span><br><span class=\"line\">SizeOfStackCommit</span><br><span class=\"line\">SizeOfHeapReverse</span><br><span class=\"line\">SizeOfHeapCommit</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//x64 regedit.exe</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">IMAGE_DOS_HEADER</span> &#123;</span>      <span class=\"comment\">// DOS .EXE header</span></span><br><span class=\"line\">    WORD   e_magic;  <span class=\"number\">5</span>A4D                     <span class=\"comment\">// Magic number MZ标记用于判断是否是可执行文件\t\t\t\t\t\t\t\t</span></span><br><span class=\"line\">    WORD   e_cblp;   <span class=\"number\">0090</span>                   <span class=\"comment\">// Bytes on last page of file</span></span><br><span class=\"line\">    WORD   e_cp;     <span class=\"number\">0003</span>                   <span class=\"comment\">// Pages in file</span></span><br><span class=\"line\">    WORD   e_crlc;   <span class=\"number\">0000</span>                   <span class=\"comment\">// Relocations</span></span><br><span class=\"line\">    WORD   e_cparhdr;   <span class=\"number\">0004</span>                <span class=\"comment\">// Size of header in paragraphs</span></span><br><span class=\"line\">    WORD   e_minalloc;  <span class=\"number\">0000</span>                <span class=\"comment\">// Minimum extra paragraphs needed</span></span><br><span class=\"line\">    WORD   e_maxalloc;  FFFF                <span class=\"comment\">// Maximum extra paragraphs needed</span></span><br><span class=\"line\">    WORD   e_ss;  <span class=\"number\">0000</span>                      <span class=\"comment\">// Initial (relative) SS value</span></span><br><span class=\"line\">    WORD   e_sp;  <span class=\"number\">00B</span>8                      <span class=\"comment\">// Initial SP value</span></span><br><span class=\"line\">    WORD   e_csum;  <span class=\"number\">0000</span>                     <span class=\"comment\">// Checksum</span></span><br><span class=\"line\">    WORD   e_ip;    <span class=\"number\">0000</span>                     <span class=\"comment\">// Initial IP value</span></span><br><span class=\"line\">    WORD   e_cs;    <span class=\"number\">0000</span>                    <span class=\"comment\">// Initial (relative) CS value</span></span><br><span class=\"line\">    WORD   e_lfarlc;     <span class=\"number\">0040</span>                <span class=\"comment\">// File address of relocation table</span></span><br><span class=\"line\">    WORD   e_ovno;       <span class=\"number\">0000</span>               <span class=\"comment\">// Overlay number</span></span><br><span class=\"line\">    WORD   e_res[<span class=\"number\">4</span>];     <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span>               <span class=\"comment\">// Reserved words</span></span><br><span class=\"line\">    WORD   e_oemid;      <span class=\"number\">0000</span>               <span class=\"comment\">// OEM identifier (for e_oeminfo)</span></span><br><span class=\"line\">    WORD   e_oeminfo;    <span class=\"number\">0000</span>               <span class=\"comment\">// OEM information; e_oemid specific</span></span><br><span class=\"line\">    WORD   e_res2[<span class=\"number\">10</span>];   <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span> <span class=\"number\">0000</span>               <span class=\"comment\">// Reserved words</span></span><br><span class=\"line\">    DWORD  e_lfanew;     <span class=\"number\">0000</span> <span class=\"number\">00F</span>8               <span class=\"comment\">// File address of new exe header PE头相对于文件的偏移，定位PE文件</span></span><br><span class=\"line\">&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br><span class=\"line\"><span class=\"comment\">//0x40</span></span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">IMAGE_NT_HEADERS</span> &#123;</span></span><br><span class=\"line\">    DWORD Signature;    <span class=\"number\">00004550</span></span><br><span class=\"line\">    IMAGE_FILE_HEADER FileHeader;</span><br><span class=\"line\">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class=\"line\">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class=\"line\"><span class=\"comment\">//E0+14+4=0xF8</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">IMAGE_FILE_HEADER</span> &#123;</span></span><br><span class=\"line\">    WORD    Machine;        <span class=\"number\">8664</span>   <span class=\"comment\">//程序运行的CPU型号，0x0任何处理器，0x14C 386及后续处理器</span></span><br><span class=\"line\">    WORD    NumberOfSections;    <span class=\"number\">0007</span>   <span class=\"comment\">//文件中节的总数，要新增或者合并节，修改值</span></span><br><span class=\"line\">    DWORD   TimeDateStamp;     AC6AAA87   <span class=\"comment\">//时间戳：文件创建时间，编译器填写，可以用于判断map文件生成时间</span></span><br><span class=\"line\">    DWORD   PointerToSymbolTable; <span class=\"number\">00000000</span>  </span><br><span class=\"line\">    DWORD   NumberOfSymbols;   <span class=\"number\">00000000</span></span><br><span class=\"line\">    WORD    SizeOfOptionalHeader;   <span class=\"number\">00F</span>0   <span class=\"comment\">//可选PE头大小，32位默认E0H，64位默认F0，大小可以自定义</span></span><br><span class=\"line\">    WORD    Characteristics;     <span class=\"number\">0022</span>      <span class=\"comment\">//可执行文件为10F，每位有不同含义</span></span><br><span class=\"line\">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br><span class=\"line\"><span class=\"comment\">//0x14</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> _<span class=\"title\">IMAGE_OPTIONAL_HEADER</span> &#123;</span></span><br><span class=\"line\">    WORD    Magic;\t\t <span class=\"number\">020B</span>     <span class=\"comment\">//10B 32位下PE   20B 64位下pe</span></span><br><span class=\"line\">    BYTE    MajorLinkerVersion; <span class=\"number\">0</span>E</span><br><span class=\"line\">    BYTE    MinorLinkerVersion; <span class=\"number\">14</span></span><br><span class=\"line\">    DWORD   SizeOfCode;  <span class=\"number\">00023400</span>     <span class=\"comment\">//所有 节的和，必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class=\"line\">    DWORD   SizeOfInitializedData;  <span class=\"number\">00079400</span>    <span class=\"comment\">//已初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class=\"line\">    DWORD   SizeOfUninitializedData; <span class=\"number\">00000000</span>   <span class=\"comment\">//未初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span></span><br><span class=\"line\">    DWORD   AddressOfEntryPoint;   <span class=\"number\">00023520</span>     <span class=\"comment\">//程序入口，但在内存中真正的入口在imagebase+OEP,一个exe中包含多个pe文件，且exe有独立空间</span></span><br><span class=\"line\">    DWORD   BaseOfCode;\t\t\t<span class=\"number\">00001000</span>\t\t<span class=\"comment\">//代码开始的基址</span></span><br><span class=\"line\">    DWORD   BaseOfData;\t\t\t<span class=\"number\">40000000</span>\t\t<span class=\"comment\">//数据开始的基址</span></span><br><span class=\"line\">    DWORD   ImageBase;\t\t\t<span class=\"number\">00000100</span>\t\t<span class=\"comment\">//内存镜像地址，内存中数据是哪里开始的</span></span><br><span class=\"line\">    DWORD   SectionAlignment;\t<span class=\"number\">00001000</span>        <span class=\"comment\">//内存对齐</span></span><br><span class=\"line\">    DWORD   FileAlignment;\t\t<span class=\"number\">00000002</span>        <span class=\"comment\">//文件对齐</span></span><br><span class=\"line\">    WORD    MajorOperatingSystemVersion;\t<span class=\"number\">000</span>A\t\t</span><br><span class=\"line\">    WORD    MinorOperatingSystemVersion;    <span class=\"number\">0000</span></span><br><span class=\"line\">    WORD    MajorImageVersion;\t\t\t\t<span class=\"number\">000</span>A</span><br><span class=\"line\">    WORD    MinorImageVersion;\t\t\t\t<span class=\"number\">0000</span></span><br><span class=\"line\">    WORD    MajorSubsystemVersion;\t\t\t<span class=\"number\">000</span>A</span><br><span class=\"line\">    WORD    MinorSubsystemVersion;\t\t\t<span class=\"number\">0000</span></span><br><span class=\"line\">    DWORD   Win32VersionValue;\t\t\t\t<span class=\"number\">00000000</span></span><br><span class=\"line\">    DWORD   SizeOfImage;\t\t\t\t\t<span class=\"number\">000</span>A2000    <span class=\"comment\">//内存中整个PE文件的映射的尺寸，必须是FileAlignment的整数倍</span></span><br><span class=\"line\">    DWORD   SizeOfHeaders;\t\t\t\t\t<span class=\"number\">00000400</span>    <span class=\"comment\">//所有头+节表按照文件对齐后的大小</span></span><br><span class=\"line\">    DWORD   CheckSum;\t\t\t\t\t\t<span class=\"number\">0005</span>D8CD</span><br><span class=\"line\">    WORD    Subsystem;\t\t\t\t\t\t<span class=\"number\">0020</span></span><br><span class=\"line\">    WORD    DllCharacteristics;\t\t\t\tC160</span><br><span class=\"line\">    DWORD   SizeOfStackReserve;\t\t\t\t<span class=\"number\">00080000</span>\t<span class=\"comment\">//初始化时保留的堆栈大小</span></span><br><span class=\"line\">    DWORD   SizeOfStackCommit;\t\t\t\t<span class=\"number\">00000000</span></span><br><span class=\"line\">    DWORD   SizeOfHeapReserve;\t\t\t\t<span class=\"number\">00004000</span></span><br><span class=\"line\">    DWORD   SizeOfHeapCommit;\t\t\t\t<span class=\"number\">00000000</span></span><br><span class=\"line\">    DWORD   LoaderFlags;\t\t\t\t\t<span class=\"number\">00100000</span>\t</span><br><span class=\"line\">    DWORD   NumberOfRvaAndSizes;\t\t\t<span class=\"number\">00000000</span>\t<span class=\"comment\">//目录项目数</span></span><br><span class=\"line\">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class=\"line\">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class=\"line\"><span class=\"comment\">//0xE0</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//Unpacker.exe</span><br><span class=\"line\">typedef struct _IMAGE_DOS_HEADER &#123;      // DOS .EXE header</span><br><span class=\"line\">    WORD   e_magic;  5A4D                     // Magic number MZ标记用于判断是否是可执行文件\t\t\t\t\t\t\t\t</span><br><span class=\"line\">    WORD   e_cblp;   0090                   // Bytes on last page of file</span><br><span class=\"line\">    WORD   e_cp;     0003                   // Pages in file</span><br><span class=\"line\">    WORD   e_crlc;   0000                   // Relocations</span><br><span class=\"line\">    WORD   e_cparhdr;   0004                // Size of header in paragraphs</span><br><span class=\"line\">    WORD   e_minalloc;  0000                // Minimum extra paragraphs needed</span><br><span class=\"line\">    WORD   e_maxalloc;  FFFF                // Maximum extra paragraphs needed</span><br><span class=\"line\">    WORD   e_ss;  0000                      // Initial (relative) SS value</span><br><span class=\"line\">    WORD   e_sp;  00B8                      // Initial SP value</span><br><span class=\"line\">    WORD   e_csum;  0000                     // Checksum</span><br><span class=\"line\">    WORD   e_ip;    0000                     // Initial IP value</span><br><span class=\"line\">    WORD   e_cs;    0000                    // Initial (relative) CS value</span><br><span class=\"line\">    WORD   e_lfarlc;     0040                // File address of relocation table</span><br><span class=\"line\">    WORD   e_ovno;       0000               // Overlay number</span><br><span class=\"line\">    WORD   e_res[4];     0000 0000 0000 0000               // Reserved words</span><br><span class=\"line\">    WORD   e_oemid;      0000               // OEM identifier (for e_oeminfo)</span><br><span class=\"line\">    WORD   e_oeminfo;    0000               // OEM information; e_oemid specific</span><br><span class=\"line\">    WORD   e_res2[10];   0000 0000 0000 0000 0000 0000 0000 0000 0000 0000               // Reserved words</span><br><span class=\"line\">    DWORD  e_lfanew;     0000 0108               // File address of new exe header PE头相对于文件的偏移，定位PE文件</span><br><span class=\"line\">&#125; IMAGE_DOS_HEADER, *PIMAGE_DOS_HEADER;</span><br><span class=\"line\">//0x40</span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">typedef struct _IMAGE_NT_HEADERS &#123;</span><br><span class=\"line\">    DWORD Signature;    00004550</span><br><span class=\"line\">    IMAGE_FILE_HEADER FileHeader;</span><br><span class=\"line\">    IMAGE_OPTIONAL_HEADER32 OptionalHeader;</span><br><span class=\"line\">&#125; IMAGE_NT_HEADERS32, *PIMAGE_NT_HEADERS32;</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct _IMAGE_FILE_HEADER &#123;</span><br><span class=\"line\">    WORD    Machine;        014C   //程序运行的CPU型号，0x0任何处理器，0x14 386及后续处理器</span><br><span class=\"line\">    WORD    NumberOfSections;    0004   //文件中节的总数，要新增或者合并节，修改值</span><br><span class=\"line\">    DWORD   TimeDateStamp;     491D4B09   //时间戳：文件创建时间，编译器填写</span><br><span class=\"line\">    DWORD   PointerToSymbolTable; 00000000  </span><br><span class=\"line\">    DWORD   NumberOfSymbols;   00000000</span><br><span class=\"line\">    WORD    SizeOfOptionalHeader;   00E0   //可选PE投大小，32位默认E0H，64位默认F0，大小可以自定义</span><br><span class=\"line\">    WORD    Characteristics;     010F      //可执行文件尾10F</span><br><span class=\"line\">&#125; IMAGE_FILE_HEADER, *PIMAGE_FILE_HEADER;</span><br><span class=\"line\">//0x14</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct _IMAGE_OPTIONAL_HEADER &#123;</span><br><span class=\"line\">    WORD    Magic;\t\t 10B     //10B32位下PE   20B64位下pe</span><br><span class=\"line\">    BYTE    MajorLinkerVersion; 06</span><br><span class=\"line\">    BYTE    MinorLinkerVersion; 00</span><br><span class=\"line\">    DWORD   SizeOfCode;  11000     //所有代码节的和，必须是FileAlignment的整数倍，编译器填的没用</span><br><span class=\"line\">    DWORD   SizeOfInitializedData;  2F000    //已初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span><br><span class=\"line\">    DWORD   SizeOfUninitializedData; 00000000   //未初始化数据大小的和必须是FileAlignment的整数倍，编译器填的没用</span><br><span class=\"line\">    DWORD   AddressOfEntryPoint;   10D4F     //程序入口</span><br><span class=\"line\">    DWORD   BaseOfCode;\t\t\t00001000\t\t//代码开始的基址</span><br><span class=\"line\">    DWORD   BaseOfData;\t\t\t12000\t\t//数据开始的基址</span><br><span class=\"line\">    DWORD   ImageBase;\t\t\t400000\t\t//内存镜像地址</span><br><span class=\"line\">    DWORD   SectionAlignment;\t00001000        //内存对齐</span><br><span class=\"line\">    DWORD   FileAlignment;\t\t00001000        //文件对齐</span><br><span class=\"line\">    WORD    MajorOperatingSystemVersion;\t0004\t\t</span><br><span class=\"line\">    WORD    MinorOperatingSystemVersion;    0000</span><br><span class=\"line\">    WORD    MajorImageVersion;\t\t\t\t0000</span><br><span class=\"line\">    WORD    MinorImageVersion;\t\t\t\t0000</span><br><span class=\"line\">    WORD    MajorSubsystemVersion;\t\t\t0004</span><br><span class=\"line\">    WORD    MinorSubsystemVersion;\t\t\t0000</span><br><span class=\"line\">    DWORD   Win32VersionValue;\t\t\t\t00000000</span><br><span class=\"line\">    DWORD   SizeOfImage;\t\t\t\t\t41000    //内存中整个PE文件的映射的尺寸，必须是FileAlignment的整数倍，即拉伸后大小，imagebuffer</span><br><span class=\"line\">    DWORD   SizeOfHeaders;\t\t\t\t\t1000    //所有头+节表按照文件对齐后的大小，严格按照FileAlignment对齐</span><br><span class=\"line\">    DWORD   CheckSum;\t\t\t\t\t\t00000000  //每两个字节相加，存到checksum，存不下自然溢出</span><br><span class=\"line\">    WORD    Subsystem;\t\t\t\t\t\t0002</span><br><span class=\"line\">    WORD    DllCharacteristics;\t\t\t\t0000</span><br><span class=\"line\">    DWORD   SizeOfStackReserve;\t\t\t\t100000\t//初始化时保留的堆栈大小</span><br><span class=\"line\">    DWORD   SizeOfStackCommit;\t\t\t\t1000</span><br><span class=\"line\">    DWORD   SizeOfHeapReserve;\t\t\t\t100000</span><br><span class=\"line\">    DWORD   SizeOfHeapCommit;\t\t\t\t1000</span><br><span class=\"line\">    DWORD   LoaderFlags;\t\t\t\t\t00000000\t</span><br><span class=\"line\">    DWORD   NumberOfRvaAndSizes;\t\t\t00000010\t//目录项目数</span><br><span class=\"line\">    IMAGE_DATA_DIRECTORY DataDirectory[IMAGE_NUMBEROF_DIRECTORY_ENTRIES];</span><br><span class=\"line\">&#125; IMAGE_OPTIONAL_HEADER32, *PIMAGE_OPTIONAL_HEADER32;</span><br><span class=\"line\">//E0</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230203150643470.png\" alt=\"image-20230203150643470\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230204150314850.png\" alt=\"image-20230204150314850\"></p>\n<p>将文件读取到内存中，此时称 FileBuffer，如果内存对齐和文件对齐一样，那么不拉伸，但还是不能直接加载</p>\n<p>如果两者不一样，需要先在内存中进行拉伸，此事成为 image buffer</p>\n<p>image buffer 从 imagebase 开始</p>\n<p>imagebase 用于模块对齐和保护指针</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301170240621.png\" alt=\"image-20230301170240621\"></p>\n<p>正常情况下 OEP 在 text 代码段中，OEP 真正的位置 = OEP + imagebase</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdlib.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;malloc.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> _CRT_SECURE_NO_WARNINGS</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> FILEPATH <span class=\"string\">&quot;C:\\\\Users\\\\shinya\\\\Desktop\\\\Unpacker.exe&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">LPVOID <span class=\"title function_\">ReadPELoader</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> len = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tFILE *fp = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfp = fopen(FILEPATH, <span class=\"string\">&quot;rb&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (fp == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;fp = NULL&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tfseek(fp, <span class=\"number\">0</span>, SEEK_END);</span><br><span class=\"line\"></span><br><span class=\"line\">\tlen = ftell(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\tfseek(fp, <span class=\"number\">0</span>, SEEK_SET);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpFileBuffer = <span class=\"built_in\">malloc</span>(len);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!pFileBuffer)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;ptr = NULL&quot;</span>);</span><br><span class=\"line\">\t\tfclose(fp);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">size_t</span> reader = fread(pFileBuffer, len, <span class=\"number\">1</span>, fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!reader)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;reader= 0&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\tpFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\tfclose(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s\\n&quot;</span>, pFileBuffer);</span><br><span class=\"line\">\tfclose(fp);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> pFileBuffer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">void</span> <span class=\"title function_\">PrintNTHeader</span><span class=\"params\">()</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pPEHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER32 pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpFileBuffer = ReadPELoader();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!pFileBuffer)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;文件读取失败&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (*((PWORD)pFileBuffer) != IMAGE_DOS_SIGNATURE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;不是有效mz标识&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;MZ标志:%X\\n&quot;</span>, pDosHeader-&gt;e_magic);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;PE偏移:%X\\n&quot;</span>, pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//判断是否是有效的PE标志</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (*((PDWORD)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew)) != IMAGE_NT_SIGNATURE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;不是有效的PE标志\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//打印NT头</span></span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;NT:%X\\n&quot;</span>, pNTHeader-&gt;Signature);</span><br><span class=\"line\">\tpPEHeader = (PIMAGE_FILE_HEADER)(((DWORD)pNTHeader) + <span class=\"number\">4</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;PE:%X\\n&quot;</span>, pPEHeader-&gt;Machine);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;节的数量:%X\\n&quot;</span>, pPEHeader-&gt;NumberOfSections);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;SizeOfOptionalHeader:%X\\n&quot;</span>, pPEHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//可选PE头</span></span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pPEHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional_PE:%X\\n&quot;</span>, pOptionHeader-&gt;Magic);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPrintNTHeader();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\">LPVOID <span class=\"title\">OpenFile</span><span class=\"params\">(<span class=\"type\">char</span>* FilePath)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tFILE* fp;</span><br><span class=\"line\">\tfp = <span class=\"built_in\">fopen</span>(FilePath,<span class=\"string\">&quot;rb&quot;</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(fp == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fseek</span>(fp,<span class=\"number\">0</span>,SEEK_END);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//获得文件指针长度</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> len = <span class=\"built_in\">ftell</span>(fp);  </span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fseek</span>(fp,<span class=\"number\">0</span>,SEEK_SET);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//开辟堆区</span></span><br><span class=\"line\">\tLPVOID ptr;</span><br><span class=\"line\">\tptr = (LPVOID)<span class=\"built_in\">malloc</span>(len);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ptr == <span class=\"literal\">NULL</span>) </span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout&lt;&lt; <span class=\"string\">&quot;ptr == NULL&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">\t\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(ptr,<span class=\"number\">0</span>,len);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//读文件</span></span><br><span class=\"line\">\t<span class=\"type\">size_t</span> reader = <span class=\"built_in\">fread</span>(ptr,len,<span class=\"number\">1</span>,fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(reader == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout&lt;&lt; <span class=\"string\">&quot;reader == NULL&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">\t\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ptr;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ResolvePEHeader</span><span class=\"params\">(<span class=\"type\">char</span>* FilePath)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = (LPVOID)<span class=\"built_in\">OpenFile</span>(FilePath);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(pFileBuffer == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pFileBuffer == NULL\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (*(PWORD)pDosHeader != IMAGE_DOS_SIGNATURE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;not a valid mz signature\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;valid mz signature\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------DOS header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;DOS header: e_magic=%X\\n&quot;</span>,pDosHeader-&gt;e_magic);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;DOS header: e_lfanew=%X\\n&quot;</span>,pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------NT header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;NT header: Signature=%X\\n&quot;</span>,pNTHeader-&gt;Signature);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------File header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: Machine=%X\\n&quot;</span>,pFileHeader-&gt;Machine);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: NumberOfSections=%X\\n&quot;</span>,pFileHeader-&gt;NumberOfSections);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: TimeDateStamp=%X\\n&quot;</span>,pFileHeader-&gt;TimeDateStamp);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: SizeOfOptionalHeader=%X\\n&quot;</span>,pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: Characteristics=%X\\n&quot;</span>,pFileHeader-&gt;Characteristics);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------Optional header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: Magic=%X\\n&quot;</span>,pOptionHeader-&gt;Magic);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfCode=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfCode);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: AddressOfEntryPoint=%X\\n&quot;</span>,pOptionHeader-&gt;AddressOfEntryPoint);\t</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: BaseOfCode=%X\\n&quot;</span>,pOptionHeader-&gt;BaseOfCode);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: BaseOfData=%X\\n&quot;</span>,pOptionHeader-&gt;BaseOfData);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: ImageBase=%X\\n&quot;</span>,pOptionHeader-&gt;ImageBase);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SectionAlignment=%X\\n&quot;</span>,pOptionHeader-&gt;SectionAlignment);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: FileAlignment=%X\\n&quot;</span>,pOptionHeader-&gt;FileAlignment);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfImage=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfImage);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfHeaders=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfHeaders);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: CheckSum=%X\\n&quot;</span>,pOptionHeader-&gt;CheckSum);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">test</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* FilePath = <span class=\"string\">&quot;C:\\\\Users\\\\shinya\\\\Desktop\\\\Unpacker.exe&quot;</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">ResolvePEHeader</span>(FilePath) ;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">union Test     //类型</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">sizeof取成员变量中最大的</span><br><span class=\"line\"></span><br><span class=\"line\">1、联合体的成员是共享内存空间的中</span><br><span class=\"line\">2、联合体的内存空间大小是联合体成员中对内存空间大小要求最大的空间大小</span><br><span class=\"line\">3、联合体最多只有一个成员有效</span><br><span class=\"line\"></span><br><span class=\"line\">Test test;</span><br><span class=\"line\">test.y = 0x12345678;</span><br><span class=\"line\">printf(&quot;%X\\n&quot;,test.x);\t//0x78</span><br><span class=\"line\">printf(&quot;%X\\n&quot;,test.y);  //0x12345678</span><br><span class=\"line\"></span><br><span class=\"line\">union</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;Testhaha;      //变量</span><br><span class=\"line\">Testhaha.y = 0x12345678;</span><br><span class=\"line\">printf(&quot;%d&quot;,Testhaha)   //0x12345678</span><br><span class=\"line\"></span><br><span class=\"line\">结构体也可以这么写</span><br><span class=\"line\">struct</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;shabi;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"节表\"><a class=\"markdownIt-Anchor\" href=\"#节表\">#</a> 节表</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef struct _IMAGE_SECTION_HEADER &#123;</span><br><span class=\"line\">    BYTE    Name[IMAGE_SIZEOF_SHORT_NAME];// 节表名称,如“.text” ,如果不是以\\0结尾，系统会截取8个字节长度处理</span><br><span class=\"line\">  //IMAGE_SIZEOF_SHORT_NAME=8,创建长度为9的数组，最后以0结尾，不要用char*</span><br><span class=\"line\">    union &#123;</span><br><span class=\"line\">      //　共用体，也叫联合体，在一个“联合”内可以定义多种不同的数据类型， </span><br><span class=\"line\">//一个被说明为该“联合”类型的变量中，允许装入该“联合”所定义的任何一种数据，这些数据共享同一段内存，</span><br><span class=\"line\">//以达到节省空间的目的。union变量所占用的内存长度等于最长的成员的内存长度。</span><br><span class=\"line\">            DWORD   PhysicalAddress; //当前节的名称 ， 占8字节</span><br><span class=\"line\">            DWORD   VirtualSize; //内存中文件对齐大小</span><br><span class=\"line\">    &#125; Misc;   //对齐前的真实尺寸，可以不准确,没有程序照样运行，misc可以大于sizeofrawdata</span><br><span class=\"line\">    DWORD   VirtualAddress; //在内存中的偏移地址 +imageOfBase=真正的位置</span><br><span class=\"line\">    DWORD   SizeOfRawData; //当前节在文件中对齐后的大小 也就是节点的大小</span><br><span class=\"line\">    DWORD   PointerToRawData; //当前节在文件中的偏移 也就是文件的开始位置，一定是文件对齐的整数倍</span><br><span class=\"line\">    DWORD   PointerToRelocations; // 调试相关</span><br><span class=\"line\">    DWORD   PointerToLinenumbers;// 调试相关</span><br><span class=\"line\">    WORD    NumberOfRelocations;// 调试相关</span><br><span class=\"line\">    WORD    NumberOfLinenumbers;// 调试相关</span><br><span class=\"line\">    DWORD   Characteristics; //文件属性，比如该节数据属性是否为可执行属性，都在这里面</span><br><span class=\"line\">&#125; IMAGE_SECTION_HEADER, *PIMAGE_SECTION_HEADER;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205140709262.png\" alt=\"image-20230205140709262\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230302175633767.png\" alt=\"image-20230302175633767\"></p>\n<p>MISC = a - b</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205140950190.png\" alt=\"image-20230205140950190\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230205143439207.png\" alt=\"image-20230205143439207\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">标志(属性块) 常用特征值对照表：</span><br><span class=\"line\"></span><br><span class=\"line\">[值:00000020h] [IMAGE_SCN_CNT_CODE                // Section contains code.(包含可执行代码)]</span><br><span class=\"line\">[值:00000040h] [IMAGE_SCN_CNT_INITIALIZED_DATA    // Section contains initialized data.(该块包含已初始化的数据)]</span><br><span class=\"line\">[值:00000080h] [IMAGE_SCN_CNT_UNINITIALIZED_DATA  // Section contains uninitialized data.(该块包含未初始化的数据)]</span><br><span class=\"line\">[值:00000200h] [IMAGE_SCN_LNK_INFO                // Section contains comments or some other type of information.]</span><br><span class=\"line\">[值:00000800h] [IMAGE_SCN_LNK_REMOVE              // Section contents will not become part of image.]</span><br><span class=\"line\">[值:00001000h] [IMAGE_SCN_LNK_COMDAT              // Section contents comdat.]</span><br><span class=\"line\">[值:00004000h] [IMAGE_SCN_NO_DEFER_SPEC_EXC       // Reset speculative exceptions handling bits in the TLB entries for this section.]</span><br><span class=\"line\">[值:00008000h] [IMAGE_SCN_GPREL                   // Section content can be accessed relative to GP.]</span><br><span class=\"line\">[值:00500000h] [IMAGE_SCN_ALIGN_16BYTES           // Default alignment if no others are specified.]</span><br><span class=\"line\">[值:01000000h] [IMAGE_SCN_LNK_NRELOC_OVFL         // Section contains extended relocations.]</span><br><span class=\"line\">[值:02000000h] [IMAGE_SCN_MEM_DISCARDABLE         // Section can be discarded.]</span><br><span class=\"line\">[值:04000000h] [IMAGE_SCN_MEM_NOT_CACHED          // Section is not cachable.]</span><br><span class=\"line\">[值:08000000h] [IMAGE_SCN_MEM_NOT_PAGED           // Section is not pageable.]</span><br><span class=\"line\">[值:10000000h] [IMAGE_SCN_MEM_SHARED              // Section is shareable(该块为共享块).]</span><br><span class=\"line\">[值:20000000h] [IMAGE_SCN_MEM_EXECUTE             // Section is executable.(该块可执行)]</span><br><span class=\"line\">[值:40000000h] [IMAGE_SCN_MEM_READ                // Section is readable.(该块可读)]</span><br><span class=\"line\">[值:80000000h] [IMAGE_SCN_MEM_WRITE               // Section is writeable.(该块可写)]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>手动画图列数据</p>\n<p>写程序解析节表</p>\n<p>使用 notepad</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DOS头 00h-40h</span><br><span class=\"line\">40H-F7 垃圾数据</span><br><span class=\"line\">F8-FB signature</span><br><span class=\"line\">FC-10F 标准PE头 NumberOfSection = 7  sizeofoptionalheader = 0xF0</span><br><span class=\"line\">110H-1FF 可选PE头</span><br><span class=\"line\">200-227 节表1 .text   025E00  400</span><br><span class=\"line\">228-24F 节表2 .rdata  9A00    26200</span><br><span class=\"line\">250-277 节表3 .data   0E00    2FC00</span><br><span class=\"line\">278-29F 节表4 .pdata  1200    30A00</span><br><span class=\"line\">2A0-2C7 节表5 .didat  0200    31C00  </span><br><span class=\"line\">2C8-2ef 节表6 .rsrc   0C00    31E00</span><br><span class=\"line\">2f0-317 节表7 .reloc  0400    32A00</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>Unpacker.exe</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DOS头 00h-39h</span><br><span class=\"line\">垃圾数据 40h-107h</span><br><span class=\"line\">NT头 108h-</span><br><span class=\"line\">file header 10Ch-11f</span><br><span class=\"line\">optional header 120-1ff</span><br><span class=\"line\">section </span><br><span class=\"line\">200 - 227 </span><br><span class=\"line\">.text  </span><br><span class=\"line\">misc 10AF0</span><br><span class=\"line\">VA 1000</span><br><span class=\"line\">soraw 11000</span><br><span class=\"line\">ptrd 1000</span><br><span class=\"line\">char 60000020</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"><span class=\"keyword\">while</span>(pFileHeader-&gt;NumberOfSections &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> name[<span class=\"number\">9</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">8</span>;i++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        name[i] = pSectionHeader-&gt;Name[i];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------SECTION_HEADER---------\\n&quot;</span>);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Name=%s\\n&quot;</span>, name);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Misc=%X\\n&quot;</span>, pSectionHeader-&gt;Misc);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: VirtualAddress=%X\\n&quot;</span>, pSectionHeader-&gt;VirtualAddress);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: SizeOfRawData=%X\\n&quot;</span>, pSectionHeader-&gt;SizeOfRawData);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: PointerToRawData=%X\\n&quot;</span>, pSectionHeader-&gt;PointerToRawData);</span><br><span class=\"line\">    <span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Characteristics=%X\\n&quot;</span>, pSectionHeader-&gt;Characteristics);</span><br><span class=\"line\">    pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">    pFileHeader-&gt;NumberOfSections--;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303182144938.png\" alt=\"image-20230303182144938\"></p>\n<p>sizeofheader = 所有头 + 节表 文件对齐后大小</p>\n<p>MISC 可能大于 sizeofrawdata，含有未初始化的数据，比如 char arr [1000]; 文件中不分配，但内存中分配</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FileBuffer -&gt; ImageBuffer</span><br><span class=\"line\"></span><br><span class=\"line\">1.分配新的内存，分配sizeofimage大小，初始化为0  (FileBuffer是按照文件大小分的，即ftell得出的尺寸)</span><br><span class=\"line\"></span><br><span class=\"line\">----接下来分块移动到内存中</span><br><span class=\"line\"></span><br><span class=\"line\">2.复制sizeofheaders，注意内存和文件的对齐，即内存中headers之后不一定直接是节</span><br><span class=\"line\"></span><br><span class=\"line\">3.循环复制节，从pintertorawdata开始，复制sizeofrawdata大小，复制到virtualaddress</span><br><span class=\"line\"></span><br><span class=\"line\">ImageBuffer -&gt; NewBuffer</span><br><span class=\"line\">1.开辟最后一个节的pointertorawdaata + sizeofrawdata</span><br><span class=\"line\"></span><br><span class=\"line\">2.复制头</span><br><span class=\"line\"></span><br><span class=\"line\">3.把virtualaddress 复制到 pointertorawdata ，大小为sizeofrawdata</span><br><span class=\"line\"></span><br><span class=\"line\">空闲节添加代码</span><br><span class=\"line\">1/读到filebuffer</span><br><span class=\"line\">2.到imagebuffer</span><br><span class=\"line\">3.判断空闲区是否够</span><br><span class=\"line\">4.判断加哪 imagebase + VA + MISC</span><br><span class=\"line\">5.复制shellcode</span><br><span class=\"line\">6.修正E8 x-imagebuffer+imagebase</span><br><span class=\"line\">7.修正E9</span><br><span class=\"line\">8.修改OEP</span><br><span class=\"line\">9.image -&gt; nnew</span><br><span class=\"line\">10.存盘</span><br><span class=\"line\"></span><br><span class=\"line\">如果不往代码区里填，需要改属性，判断拉伸后剩余空间是否够</span><br><span class=\"line\">在任意节里添加，封装函数</span><br><span class=\"line\">属性通过 | 取并集</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230206140901033.png\" alt=\"image-20230206140901033\"></p>\n<p>用函数写</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DWORD ReadPEFile(IN LPSTR lpszFile, OUT LPVOID* pFileBuffer); //失败返回0，否则实际读取大小</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD CopyFileBufferToImageBuffer(IN LPVOID PFileBuffer, OUT LPVOID* pImageBuffer);  //失败返回0，否则返回复制大小</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">bool MemeryToFile(IN LPVOID pMemBuffer, IN SIZE_T size, OUT LPSTR lpszFile);</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, IN DWORD dwRva); //dwrva rva的值，返回转换后的rva的值，是吧返回0</span><br></pre></td></tr></table></figure>\n<p>2. 将 RVA 转为 FOA   RVA 相对偏移地址就是下面的 1234，即内存中相对的偏移</p>\n<p>FOA 文件中偏移，即下面的 634</p>\n<p>imagebuffer 中并不能运行，还需要做一些别的工作</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">imagebuffer中为501234的节在文件中什么位置 ，malloc返回500000</span><br><span class=\"line\">imagebuffer开始的地址时malloc分的地址</span><br><span class=\"line\"></span><br><span class=\"line\">1.用501234-500000 = 1234</span><br><span class=\"line\"></span><br><span class=\"line\">2.循环判断1234在那个节中，大于第n个节virtualaddress，小于第n个节的virtualaddress+misc.virtualsize</span><br><span class=\"line\"></span><br><span class=\"line\">3.1234-第n个节表 = 1234 - 1000 = 234，即距离当前节开始的偏移</span><br><span class=\"line\"></span><br><span class=\"line\">4.pointertorawdata  +  234 = 400 + 234</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, IN char* FilePath, DWORD dwRva)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(sizeof(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;pFileBuffer: %X\\n&quot;, pFileBuffer); //450068</span><br><span class=\"line\">\tprintf(&quot;DWRVA: %X\\n&quot;, dwRva); </span><br><span class=\"line\">\tDWORD MemOffset = (dwRva - (DWORD)pFileBuffer); //45C29C - 450068 = C234</span><br><span class=\"line\">\tprintf(&quot;MemOffset: %X\\n&quot;, MemOffset); </span><br><span class=\"line\">\tint NumOfSec = 0;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD thisVA = 0;</span><br><span class=\"line\">\tDWORD thisFile = 0;</span><br><span class=\"line\">\twhile (pFileHeader-&gt;NumberOfSections &gt; 0)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tif ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tthisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class=\"line\">\t\t\tthisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class=\"line\">\t\t\tprintf(&quot;thisVA:%X\\n&quot;,thisVA);  //C000</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">\t\tpFileHeader-&gt;NumberOfSections--;</span><br><span class=\"line\">\t\tNumOfSec++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;NumOfSec:%d\\n&quot;, NumOfSec+1);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD thisoffset = MemOffset - thisVA; //C234-C000 = 234;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;thisoffset:%X\\n&quot;,thisoffset);</span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD FilePos = thisoffset + thisFile; // 234 + AC00 = AE34</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;FilePos:%X\\n&quot;,FilePos);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn FilePos;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void test()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//char* FilePath = &quot;C:\\\\Windows\\\\System32\\\\notepad.exe&quot;;</span><br><span class=\"line\">\tchar* FilePath = &quot;C:\\\\Users\\\\shinya\\\\Desktop\\\\Unpacker.exe&quot;;</span><br><span class=\"line\">\tLPVOID pFileBuffer = (LPVOID)OpenFile(FilePath);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//ResolvePEHeader(pFileBuffer, FilePath);</span><br><span class=\"line\">\tRvaToFileOffset(pFileBuffer, FilePath,((DWORD)pFileBuffer+0x19543));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303212608618.png\" alt=\"image-20230303212608618\"></p>\n<h3 id=\"代码节空白区添加代码\"><a class=\"markdownIt-Anchor\" href=\"#代码节空白区添加代码\">#</a> 代码节空白区添加代码</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">12:       MessageBox(0,0,0,0);</span><br><span class=\"line\">004011A8 8B F4                mov         esi,esp</span><br><span class=\"line\">004011AA 6A 00                push        0</span><br><span class=\"line\">004011AC 6A 00                push        0</span><br><span class=\"line\">004011AE 6A 00                push        0</span><br><span class=\"line\">004011B0 6A 00                push        0</span><br><span class=\"line\">004011B2 FF 15 E4 F2 43 00    call        dword ptr [__imp__MessageBoxA@16 (0043f2e4)]</span><br><span class=\"line\"></span><br><span class=\"line\">75EBFD1E 8B FF                mov         edi,edi</span><br><span class=\"line\">75EBFD20 55                   push        ebp</span><br><span class=\"line\">75EBFD21 8B EC                mov         ebp,esp</span><br><span class=\"line\">75EBFD23 6A 00                push        0</span><br><span class=\"line\">75EBFD25 FF 75 14             push        dword ptr [ebp+14h]</span><br><span class=\"line\">75EBFD28 FF 75 10             push        dword ptr [ebp+10h]</span><br><span class=\"line\">75EBFD2B FF 75 0C             push        dword ptr [ebp+0Ch]</span><br><span class=\"line\">75EBFD2E FF 75 08             push        dword ptr [ebp+8]</span><br><span class=\"line\">75EBFD31 E8 A0 FF FF FF       call        75EBFCD6</span><br><span class=\"line\">75EBFD36 5D                   pop         ebp</span><br><span class=\"line\">75EBFD37 C2 10 00             ret         10h</span><br><span class=\"line\"></span><br><span class=\"line\">call E8</span><br><span class=\"line\">jmp E9</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">7650FD1E &gt;  8BFF            mov     edi,edi</span><br><span class=\"line\">7650FD20    55              push    ebp</span><br><span class=\"line\">7650FD21    8BEC            mov     ebp,esp</span><br><span class=\"line\">7650FD23    6A 00           push    0x0</span><br><span class=\"line\">7650FD25    FF75 14         push    dword ptr ss:[ebp+0x14]</span><br><span class=\"line\">7650FD28    FF75 10         push    dword ptr ss:[ebp+0x10]</span><br><span class=\"line\">7650FD2B    FF75 0C         push    dword ptr ss:[ebp+0xC]</span><br><span class=\"line\">7650FD2E    FF75 08         push    dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">7650FD31    E8 A0FFFFFF     call    MessageBoxExA</span><br><span class=\"line\">7650FD36    5D              pop     ebp</span><br><span class=\"line\">7650FD37    C2 1000         retn    0x10</span><br><span class=\"line\"></span><br><span class=\"line\">760634D0 &lt;user32.MessageB | 8BFF                        | mov edi,edi                           |</span><br><span class=\"line\">760634D2                  | 55                          | push ebp                              |</span><br><span class=\"line\">760634D3                  | 8BEC                        | mov ebp,esp                           |</span><br><span class=\"line\">760634D5                  | 833D 948C0876 00            | cmp dword ptr ds:[76088C94],0         |</span><br><span class=\"line\">760634DC                  | 74 22                       | je user32.76063500                    |</span><br><span class=\"line\">760634DE                  | 64:A1 18000000              | mov eax,dword ptr fs:[18]             |</span><br><span class=\"line\">760634E4                  | BA 9C910876                 | mov edx,user32.7608919C               |</span><br><span class=\"line\">760634E9                  | 8B48 24                     | mov ecx,dword ptr ds:[eax+24]         |</span><br><span class=\"line\">760634EC                  | 33C0                        | xor eax,eax                           |</span><br><span class=\"line\">760634EE                  | F0:0FB10A                   | lock cmpxchg dword ptr ds:[edx],ecx   |</span><br><span class=\"line\">760634F2                  | 85C0                        | test eax,eax                          |</span><br><span class=\"line\">760634F4                  | 75 0A                       | jne user32.76063500                   |</span><br><span class=\"line\">760634F6                  | C705 008D0876 01000000      | mov dword ptr ds:[76088D00],1         |</span><br><span class=\"line\">76063500                  | 6A FF                       | push FFFFFFFF                         |</span><br><span class=\"line\">76063502                  | 6A 00                       | push 0                                |</span><br><span class=\"line\">76063504                  | FF75 14                     | push dword ptr ss:[ebp+14]            |</span><br><span class=\"line\">76063507                  | FF75 10                     | push dword ptr ss:[ebp+10]            |</span><br><span class=\"line\">7606350A                  | FF75 0C                     | push dword ptr ss:[ebp+C]             |</span><br><span class=\"line\">7606350D                  | FF75 08                     | push dword ptr ss:[ebp+8]             |</span><br><span class=\"line\">76063510                  | E8 3B020000                 | call &lt;user32.MessageBoxTimeoutA&gt;      |</span><br><span class=\"line\">76063515                  | 5D                          | pop ebp                               |</span><br><span class=\"line\">76063516                  | C2 1000                     | ret 10                                |</span><br><span class=\"line\"></span><br><span class=\"line\">E8 3B020000                 | call &lt;user32.MessageBoxTimeoutA&gt;</span><br><span class=\"line\">E9 ????????\t\t\t\t\t| jmp ????????</span><br><span class=\"line\"></span><br><span class=\"line\">跳转的地址 = E8这条指令下一行地址 + X\t\t\t\t\t  X =  跳转的地址 - E8这条指令下一行地址</span><br><span class=\"line\">跳转的地址 = E8当前的地址 + 5 + X\t\t\t\t\t\tX = 跳转的地址 - （E8的地址 + 5）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">6A 00 6A 00 6A 00 6A 00 E8 00 00 00 00 E9 00 00 00 00</span><br><span class=\"line\"></span><br><span class=\"line\">ImageBase = 400000</span><br><span class=\"line\">400000 + 10D4F = 410D4F</span><br><span class=\"line\">410D4F-411b02</span><br><span class=\"line\">760634D0 - 411afd</span><br><span class=\"line\">11af0</span><br><span class=\"line\"></span><br><span class=\"line\">1.将节中多余部分改写为6A 00 6A 00 6A 00 6A 00 E8 00 00 00 00 E9 00 00 00 00</span><br><span class=\"line\">2.计算E8 和 E9之后的地址</span><br><span class=\"line\">跳转的地址 = E8这条指令下一行地址 + X</span><br><span class=\"line\">E8 = 760634D0 - 411afd     (411afd为E9的地址，就是E8的下一条地址)</span><br><span class=\"line\">E9 = 410D4F - 411b02       (imagebase+OEP)-(imagebase+E9下一条地址)</span><br><span class=\"line\">3.更改OEP为我们代码开始的地址 ，不需要加imagebase</span><br><span class=\"line\"></span><br><span class=\"line\">程序开始时先执行我们的代码，执行结束后在由我们写的jmp跳转到OEP，执行正常的程序</span><br><span class=\"line\">MessageBox  = 76E534D0</span><br><span class=\"line\">E9 = 11afd</span><br><span class=\"line\">76E534D0 - (400000+11afd) = 76A419D3</span><br><span class=\"line\">E9-&gt;next = 11b02</span><br><span class=\"line\">410D4F - 411b02</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">MessageBox = 75BDFD1E</span><br><span class=\"line\">E9 = b5fd</span><br><span class=\"line\">75BDFD1E - 100b5fd = 74BD 4721</span><br><span class=\"line\">E9-&gt;next = b602</span><br><span class=\"line\">3689 - b602 =FFFF 8087</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">创建新节</span><br><span class=\"line\">1.新增一个节</span><br><span class=\"line\">2.在新节后面填充一个节大小的00</span><br><span class=\"line\">3.修改PE头中节的数量</span><br><span class=\"line\">4.修改sizeofimage</span><br><span class=\"line\">5.原有数据后新增内存对齐整数倍的一个节</span><br><span class=\"line\">6.修改节表</span><br><span class=\"line\"></span><br><span class=\"line\">notepad中节表后面存在非零的有用数据，所以需要把nt，file，option，节表提升抬升，提升到垃圾数据中</span><br><span class=\"line\"></span><br><span class=\"line\">如果提升也不能用就需要扩大节，只能扩大最后一个节</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">扩大节</span><br><span class=\"line\">1.拉伸到内存 -&gt; filebuffer -&gt; imagebuffer</span><br><span class=\"line\">2.分配一块显得空间,newimagebuffer，大小为 sizeofimage + x</span><br><span class=\"line\">3.将最后一个接的sizeofrawdata和virtualsize 改为N     N=内存对齐后尺寸+新增大小</span><br><span class=\"line\">3.修改sizeofimage大小</span><br><span class=\"line\">扩大节：</span><br><span class=\"line\"></span><br><span class=\"line\">1、拉伸到内存（只是逻辑上，实际代码操作并不需要这一步），需要注入的代码为 ShellCode</span><br><span class=\"line\"></span><br><span class=\"line\">2、分配一块新的空间：SizeOfImage + sizeof ( ShellCode)</span><br><span class=\"line\"></span><br><span class=\"line\">3、扩大节，修改最后一个节的 SizeOfRawData 和 VirtualSize</span><br><span class=\"line\"></span><br><span class=\"line\">   OrgSecSize = max ( SizeOfRawData 或 VirtualSize内存对齐后的值 ) </span><br><span class=\"line\"></span><br><span class=\"line\">   ∵ 有些初始化数据未全部写入文件，VirtualSize 可能比 SizeOfRawData 大，必须保证添加的代码不影响到原程序</span><br><span class=\"line\"></span><br><span class=\"line\">   VirtualSize = OrgSecSize + sizeof ( ShellCode)</span><br><span class=\"line\"></span><br><span class=\"line\">   SizeOfRawData = ( OrgSecSize + sizeof(ShellCode) ) 按文件对齐后的值</span><br><span class=\"line\"></span><br><span class=\"line\">4、修改SizeOfImage大小</span><br><span class=\"line\"></span><br><span class=\"line\">   SizeOfImage = (最后一节 VirtualAddress + VirtualSize) 按内存对齐后的值</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">合并节 可以节省节表</span><br><span class=\"line\">0.拉伸到内存 </span><br><span class=\"line\">1.修改sectionnumber</span><br><span class=\"line\">2.将第一个节内存大小，文件大小改成一样</span><br><span class=\"line\">VirtualSize=sizeofrawdata=sizeofimage-virtualaddress[0]=VA[-1]+max&#123;sizeofraw,VSize&#125;-headers(内存对齐后)</span><br><span class=\"line\">3.virtualaddress不改  pointertorawdata 不改</span><br><span class=\"line\">4.该属性</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">扩大最后一个节</span><br><span class=\"line\">合并所有节</span><br><span class=\"line\">输出全部目录</span><br><span class=\"line\">返回对齐后大小 Align(int x, int y);</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307192218718.png\" alt=\"image-20230307192218718\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">image_directory </span><br><span class=\"line\">记录编译器生成的数据在哪里</span><br><span class=\"line\"></span><br><span class=\"line\">#define IIAGE_NUMBEROF_DIRECTORY_ENTRIES 16</span><br><span class=\"line\">分别是:导出表、导入表、资源表、异常信息表、安全证书表、重定位表、调试信息表、版权所以表、全局指针表TLS表、加载配置表、绑定导入表、IAT表、延迟导入表、COM信息表最后一个保留未使用。</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//关于节表的所有实验：</span></span><br><span class=\"line\"><span class=\"comment\">//千万不要做黑盒!!!</span></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">ReadPEFile</span><span class=\"params\">(IN LPSTR lpszFile, OUT LPVOID* pFileBuffer)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tFILE* fp;</span><br><span class=\"line\">\tfp = <span class=\"built_in\">fopen</span>((LPSTR)lpszFile, <span class=\"string\">&quot;rb&quot;</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(fp == <span class=\"literal\">NULL</span>) <span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fseek</span>(fp,<span class=\"number\">0</span>,SEEK_END);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//获得文件指针长度</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> len = <span class=\"built_in\">ftell</span>(fp);  </span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fseek</span>(fp,<span class=\"number\">0</span>,SEEK_SET);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//开辟堆区</span></span><br><span class=\"line\">\tLPVOID ptr = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tptr = (LPVOID)<span class=\"built_in\">malloc</span>(len);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(ptr == <span class=\"literal\">NULL</span>) </span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout&lt;&lt; <span class=\"string\">&quot;ptr == NULL&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">\t\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(ptr,<span class=\"number\">0</span>,len);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//读文件</span></span><br><span class=\"line\">\t<span class=\"type\">size_t</span> reader = <span class=\"built_in\">fread</span>(ptr,len,<span class=\"number\">1</span>,fp);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(reader == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout&lt;&lt; <span class=\"string\">&quot;reader == NULL&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(ptr);</span><br><span class=\"line\">\t\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//传出参数复制</span></span><br><span class=\"line\">\t*pFileBuffer = ptr;</span><br><span class=\"line\">\tptr = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> len;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">ResolvePEHeader</span><span class=\"params\">(IN LPVOID pFileBuffer)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(pFileBuffer == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pFileBuffer == NULL\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//定义PE结构</span></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//判断MZ标记</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (*(PWORD)pDosHeader != IMAGE_DOS_SIGNATURE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;not a valid mz signature\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;valid mz signature\\n&quot;);</span></span><br><span class=\"line\">\t<span class=\"comment\">//DOS头</span></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------DOS header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;DOS header: e_magic=%X\\n&quot;</span>,pDosHeader-&gt;e_magic);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;DOS header: e_lfanew=%X\\n&quot;</span>,pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//NT header\t</span></span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------NT header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;NT header: Signature=%X\\n&quot;</span>,pNTHeader-&gt;Signature);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//file header</span></span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------File header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: Machine=%X\\n&quot;</span>,pFileHeader-&gt;Machine);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: NumberOfSections=%X\\n&quot;</span>,pFileHeader-&gt;NumberOfSections);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: TimeDateStamp=%X\\n&quot;</span>,pFileHeader-&gt;TimeDateStamp);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: SizeOfOptionalHeader=%X\\n&quot;</span>,pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;File header: Characteristics=%X\\n&quot;</span>,pFileHeader-&gt;Characteristics);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//optional header</span></span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------Optional header---------\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: Magic=%X\\n&quot;</span>,pOptionHeader-&gt;Magic);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfCode=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfCode);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: AddressOfEntryPoint=%X\\n&quot;</span>,pOptionHeader-&gt;AddressOfEntryPoint);\t</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: BaseOfCode=%X\\n&quot;</span>,pOptionHeader-&gt;BaseOfCode);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: BaseOfData=%X\\n&quot;</span>,pOptionHeader-&gt;BaseOfData);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: ImageBase=%X\\n&quot;</span>,pOptionHeader-&gt;ImageBase);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SectionAlignment=%X\\n&quot;</span>,pOptionHeader-&gt;SectionAlignment);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: FileAlignment=%X\\n&quot;</span>,pOptionHeader-&gt;FileAlignment);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfImage=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfImage);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: SizeOfHeaders=%X\\n&quot;</span>,pOptionHeader-&gt;SizeOfHeaders);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Optional header: CheckSum=%X\\n&quot;</span>,pOptionHeader-&gt;CheckSum);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//section header</span></span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\">\t<span class=\"keyword\">while</span>(pFileHeader-&gt;NumberOfSections &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//防止在name=8个字符时产生越界</span></span><br><span class=\"line\">\t\t<span class=\"type\">unsigned</span> <span class=\"type\">char</span> name[<span class=\"number\">9</span>] = &#123;<span class=\"number\">0</span>&#125;;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">8</span>;i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tname[i] = pSectionHeader-&gt;Name[i];</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"comment\">//section header print</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;---------SECTION_HEADER---------\\n&quot;</span>);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Name=%s\\n&quot;</span>, name);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Misc=%X\\n&quot;</span>, pSectionHeader-&gt;Misc);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: VirtualAddress=%X\\n&quot;</span>, pSectionHeader-&gt;VirtualAddress);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: SizeOfRawData=%X\\n&quot;</span>, pSectionHeader-&gt;SizeOfRawData);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: PointerToRawData=%X\\n&quot;</span>, pSectionHeader-&gt;PointerToRawData);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Section header: Characteristics=%X\\n&quot;</span>, pSectionHeader-&gt;Characteristics);</span><br><span class=\"line\">\t\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">\t\tpFileHeader-&gt;NumberOfSections--;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">RvaToFileOffset</span><span class=\"params\">(IN LPVOID pFileBuffer, DWORD dwRva)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//define pe structure</span></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 0</span></span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionTemp = pSectionHeader;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwRva &lt;= pOptionHeader-&gt;SizeOfHeaders)</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (DWORD)dwRva;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> n = <span class=\"number\">0</span>; n &lt; pFileHeader-&gt;NumberOfSections; n++, pSectionTemp++)</span><br><span class=\"line\">\t\t&#123;\t<span class=\"comment\">//判断 :   文件对齐+文件偏移&gt;file_panyi&gt;文件偏移  (即是在文件的哪个节中)</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ((dwRva &gt;= pSectionTemp-&gt;VirtualAddress) &amp;&amp; (dwRva &lt; pSectionTemp-&gt;VirtualAddress + pSectionTemp-&gt;Misc.VirtualSize))</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">return</span> dwRva - pSectionTemp-&gt;VirtualAddress + pSectionTemp-&gt;PointerToRawData;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;pFileBuffer: %X\\n&quot;, pFileBuffer); //450068</span></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;DWRVA: %X\\n&quot;, dwRva); </span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD MemOffset = (dwRva - (DWORD)pImageBuffer); //45C29C - 450068 = C234，内存中的rva</span></span><br><span class=\"line\">\tDWORD MemOffset = (dwRva);</span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;MemOffset: %X\\n&quot;, MemOffset); </span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//当前RVA在哪个节中</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> NumOfSec = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//RVA所在节的VirtualAddress</span></span><br><span class=\"line\">\tDWORD thisVA = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//RVA所在节的PointerToRawData</span></span><br><span class=\"line\">\tDWORD thisFile = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//距离当前节开始的便宜</span></span><br><span class=\"line\">\tDWORD thisoffset = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//在文件中的FOA</span></span><br><span class=\"line\">\tDWORD FilePos = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//判断在哪个节的条件</span></span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (pFileHeader-&gt;NumberOfSections &gt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tthisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class=\"line\">\t\t\tthisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//printf(&quot;thisVA:%X\\n&quot;,thisVA);  //C000</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">break</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">\t\tpFileHeader-&gt;NumberOfSections--;</span><br><span class=\"line\">\t\tNumOfSec++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;NumOfSec:%d\\n&quot;, NumOfSec+1);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tthisoffset = MemOffset - thisVA; <span class=\"comment\">//C234-C000 = 234;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;thisoffset:%X\\n&quot;,thisoffset);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tFilePos = thisoffset + thisFile; <span class=\"comment\">// 234 + AC00 = AE34</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;FilePos:%X\\n&quot;,FilePos);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> FilePos;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">CopyFileBufferToImageBuffer</span><span class=\"params\">(IN LPVOID pFileBuffer, OUT LPVOID* pImageBuffer)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\tvoid *memset(void *s,int c,size_t n)</span></span><br><span class=\"line\"><span class=\"comment\">\t将已开辟内存空间 s 的首 n 个字节的值设为值 c（给空间初始化）</span></span><br><span class=\"line\"><span class=\"comment\">\tvoid *memcpy(void *dest, const void *src, size_t n);</span></span><br><span class=\"line\"><span class=\"comment\">\t用来将src地址处的内容拷贝n个字节的数据至目标地址dest指向的内存中去  ,函数返回指向dest的指针</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//定义PE header</span></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//计算共复制了多少</span></span><br><span class=\"line\">\tDWORD TotalSize = <span class=\"number\">0</span>;\t</span><br><span class=\"line\">\t<span class=\"comment\">//为imagebuffer开辟堆空间</span></span><br><span class=\"line\">\tLPVOID pTempImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tpTempImageBuffer = (LPVOID)<span class=\"built_in\">malloc</span>(pOptionHeader-&gt;SizeOfImage);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pTempImageBuffer == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;为imagebuffer申请内存失败&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(pTempImageBuffer, <span class=\"number\">0</span>, pOptionHeader-&gt;SizeOfImage);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//复制headers , 从filebuffer 到 imagebuffer</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(pTempImageBuffer, pFileBuffer, pOptionHeader-&gt;SizeOfHeaders);</span><br><span class=\"line\">\tTotalSize += pOptionHeader-&gt;SizeOfHeaders;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//文件和内存对齐不一样的情况</span></span><br><span class=\"line\">\t<span class=\"comment\">//if (pOptionHeader-&gt;FileAlignment &lt; pOptionHeader-&gt;SectionAlignment)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tint memcal = pOptionHeader-&gt;SizeOfHeaders / pOptionHeader-&gt;SectionAlignment;    //if header in file = 1234 , 1234/1000 , then 1000*2 in image</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tpImageBuffer += memcal * pOptionHeader-&gt;SectionAlignment;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\t//memset(pImageBuffer + pOptionHeader-&gt;SizeOfHeaders, 0, memcal * pOptionHeader-&gt;SectionAlignment);</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//循环复制节表</span></span><br><span class=\"line\">\t<span class=\"comment\">//while (pFileHeader-&gt;NumberOfSections &gt; 0)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tmemcpy((LPVOID)((DWORD)pTempImageBuffer + pSectionHeader-&gt;VirtualAddress), (LPVOID)((DWORD)pFileBuffer + pSectionHeader-&gt;PointerToRawData), pSectionHeader-&gt;SizeOfRawData);</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tTotalSize += pSectionHeader-&gt;SizeOfRawData;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tpFileHeader-&gt;NumberOfSections--;</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; pFileHeader-&gt;NumberOfSections; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>((LPVOID)((DWORD)pTempImageBuffer + pSectionHeader[i].VirtualAddress), (LPVOID)((DWORD)pFileBuffer + pSectionHeader[i].PointerToRawData), pSectionHeader[i].SizeOfRawData);</span><br><span class=\"line\">\t\tTotalSize += pSectionHeader[i].SizeOfRawData;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t*pImageBuffer = pTempImageBuffer;</span><br><span class=\"line\">\t<span class=\"comment\">//return TotalSize;</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> TotalSize;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">CopyImageBufferToNewBuffer</span><span class=\"params\">(LPVOID pImageBuffer, LPVOID *pNewBuffer)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID pFileBuffer = (LPVOID)OpenFile();</span></span><br><span class=\"line\">\t<span class=\"comment\">//pMemBuffer = CopyFileBufferToImageBuffer(pFileBuffer);</span></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID pFileBuffer = NULL;</span></span><br><span class=\"line\">\t<span class=\"comment\">//pMemBuffer = CopyFileBufferToImageBuffer(pFileBuffer,&amp;pFileBuffer);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//定义PE header</span></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//为newbuffer开辟堆空间</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> secNum = pFileHeader-&gt;NumberOfSections;  <span class=\"comment\">//节的数量</span></span><br><span class=\"line\">\tDWORD pointerdata = <span class=\"number\">0</span>;    <span class=\"comment\">//当前节的PointerToRawData</span></span><br><span class=\"line\">\tDWORD sizedata = <span class=\"number\">0</span>;   <span class=\"comment\">//当前节的SizeOfRawData</span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD FileAlig = pOptionHeader-&gt;FileAlignment;   //文件对齐</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//计算最后一个节所在位置+大小，用于后续开辟空间</span></span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\twhile (secNum &gt; 0)</span></span><br><span class=\"line\"><span class=\"comment\">\t&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tif (secNum == 1)</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tpointerdata = pSectionHeader-&gt;PointerToRawData;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\tsizedata = pSectionHeader-&gt;SizeOfRawData;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t//cout &lt;&lt;  pointerdata &lt;&lt; &quot; &quot; &lt;&lt; sizedata &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\t\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class=\"line\"><span class=\"comment\">\t\tsecNum--;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> m=<span class=\"number\">0</span>;m&lt;pFileHeader-&gt;NumberOfSections;m++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(m == pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tpointerdata = pSectionHeader[m].PointerToRawData;</span><br><span class=\"line\">\t\t\tsizedata = pSectionHeader[m].SizeOfRawData;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">continue</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//开辟内存</span></span><br><span class=\"line\">\t*pNewBuffer = (LPVOID)<span class=\"built_in\">malloc</span>(pointerdata + sizedata);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (*pNewBuffer == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;为imagebuffer申请内存失败\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(*pNewBuffer, <span class=\"number\">0</span>, pointerdata + sizedata);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//复制headers , 从filebuffer 到 imagebuffer</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(*pNewBuffer, pImageBuffer, pOptionHeader-&gt;SizeOfHeaders);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//复制section</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; pFileHeader-&gt;NumberOfSections; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>((LPVOID)((DWORD)(*pNewBuffer) + pSectionHeader[i].PointerToRawData), (LPVOID)((DWORD)pImageBuffer + pSectionHeader[i].VirtualAddress), pSectionHeader[i].SizeOfRawData);</span><br><span class=\"line\">\t\t<span class=\"comment\">//memcpy((LPVOID)((DWORD)(*pNewBuffer) + pSectionHeader[i].PointerToRawData), (LPVOID)((DWORD)pImageBuffer + pSectionHeader[i].VirtualAddress), pSectionHeader[i].SizeOfRawData);</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> pointerdata + sizedata;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">MemeryToFile</span><span class=\"params\">(IN LPVOID pMemBuffer, IN <span class=\"type\">size_t</span> size, OUT LPSTR lpszFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tFILE *fp = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tfp = <span class=\"built_in\">fopen</span>(lpszFile, <span class=\"string\">&quot;wb+&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (fp == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"built_in\">fwrite</span>(pMemBuffer, size, <span class=\"number\">1</span>, fp);</span><br><span class=\"line\">\t<span class=\"built_in\">fclose</span>(fp);</span><br><span class=\"line\">\tfp = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestAddCodeInCodeSec</span><span class=\"params\">(IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; sizeof(shellcode)/sizeof(shellcode[0]) &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//判断空闲区大小是否足够添加shellcode</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(pSectionHeader-&gt;SizeOfRawData - pSectionHeader-&gt;Misc.VirtualSize &lt; <span class=\"built_in\">sizeof</span>(shellcode)/<span class=\"built_in\">sizeof</span>(shellcode[<span class=\"number\">0</span>]))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;空闲区不够!!\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pImageBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//加shellcode的位置</span></span><br><span class=\"line\">\tPBYTE addPos = (PBYTE)((DWORD)pImageBuffer + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//复制shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; (PBYTE)addPos &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos ,shellcode, <span class=\"built_in\">sizeof</span>(shellcode)/<span class=\"built_in\">sizeof</span>(shellcode[<span class=\"number\">0</span>]));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正E8</span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD) - (DWORD)pImageBuffer));</span></span><br><span class=\"line\">\tDWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize +<span class=\"number\">8</span> +<span class=\"number\">5</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,e8);</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos+<span class=\"number\">9</span>,&amp;e8,<span class=\"built_in\">sizeof</span>(DWORD));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正E9</span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD+5) - (DWORD)pImageBuffer));</span></span><br><span class=\"line\">\tDWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize + <span class=\"number\">13</span> + <span class=\"number\">5</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,e9);</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos+<span class=\"number\">14</span>,&amp;e9,<span class=\"built_in\">sizeof</span>(DWORD));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正OEP</span></span><br><span class=\"line\">\t<span class=\"comment\">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos - (DWORD)pImageBuffer;</span></span><br><span class=\"line\">\tpOptionHeader-&gt;AddressOfEntryPoint = pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize;</span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD size = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestAddCodeInAnySec</span><span class=\"params\">(DWORD NumOfSec, IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; sizeof(shellcode)/sizeof(shellcode[0]) &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(NumOfSec &gt; pFileHeader-&gt;NumberOfSections)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;超出最大节数量\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//判断空闲区大小是否足够添加shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(pSectionHeader[NumOfSec<span class=\"number\">-1</span>].SizeOfRawData - pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Misc.VirtualSize &lt; <span class=\"built_in\">sizeof</span>(shellcode)/<span class=\"built_in\">sizeof</span>(shellcode[<span class=\"number\">0</span>]))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;空闲区不够!!\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pImageBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//加shellcode的位置</span></span><br><span class=\"line\">\tPBYTE addPos = (PBYTE)((DWORD)pImageBuffer + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Misc.VirtualSize);</span><br><span class=\"line\">    <span class=\"comment\">//PVOID codeBegin = (PBYTE)((pFileOptionHeader-&gt;SizeOfHeaders) + (DWORD)ImageBuffer + pFileSectionHeader-&gt;Misc.VirtualSize);</span></span><br><span class=\"line\">\t<span class=\"comment\">//复制shellcode</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; (PBYTE)addPos &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos ,shellcode, <span class=\"built_in\">sizeof</span>(shellcode)/<span class=\"built_in\">sizeof</span>(shellcode[<span class=\"number\">0</span>]));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正E8</span></span><br><span class=\"line\">\tDWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Misc.VirtualSize +<span class=\"number\">8</span> +<span class=\"number\">5</span>);</span><br><span class=\"line\">\t<span class=\"comment\">//DWORD e8 = MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD) - (DWORD)pImageBuffer));</span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD e8 = ((DWORD)MessageAddr - (pOptionHeader-&gt;ImageBase + ((DWORD)((DWORD)addPos + 0xD) - (DWORD)pImageBuffer)));</span></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,e8);</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos+<span class=\"number\">9</span>,&amp;e8,<span class=\"built_in\">sizeof</span>(DWORD));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正E9</span></span><br><span class=\"line\">\t<span class=\"comment\">//DWORD e9 = (pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint) - (pOptionHeader-&gt;ImageBase + ((DWORD)(addPos+0xD+5) - (DWORD)pImageBuffer));</span></span><br><span class=\"line\">    <span class=\"comment\">//DWORD e9 = (pOptionHeader-&gt;AddressOfEntryPoint+pOptionHeader-&gt;ImageBase-(pOptionHeader-&gt;ImageBase + 18) + (DWORD)pImageBuffer);</span></span><br><span class=\"line\">\tDWORD e9 = pOptionHeader-&gt;ImageBase + pOptionHeader-&gt;AddressOfEntryPoint - (pOptionHeader-&gt;ImageBase + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Misc.VirtualSize + <span class=\"number\">13</span> + <span class=\"number\">5</span>);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%X\\n&quot;</span>,e9);</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(addPos+<span class=\"number\">14</span>,&amp;e9,<span class=\"built_in\">sizeof</span>(DWORD));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修正OEP</span></span><br><span class=\"line\">\t<span class=\"comment\">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos - (DWORD)pImageBuffer;</span></span><br><span class=\"line\">\t<span class=\"comment\">//pOptionHeader-&gt;AddressOfEntryPoint = (DWORD)addPos;</span></span><br><span class=\"line\">\tpOptionHeader-&gt;AddressOfEntryPoint = pSectionHeader[NumOfSec<span class=\"number\">-1</span>].VirtualAddress + pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Misc.VirtualSize;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tpSectionHeader[NumOfSec<span class=\"number\">-1</span>].Characteristics = pSectionHeader[NumOfSec<span class=\"number\">-1</span>].Characteristics | pSectionHeader[<span class=\"number\">0</span>].Characteristics;</span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD size = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestAddSec</span><span class=\"params\">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//判断空闲区大小是否足够添加节表</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> ((DWORD)pImageBuffer + pOptionHeader-&gt;SizeOfHeaders - pDosHeader-&gt;e_lfanew - IMAGE_SIZEOF_FILE_HEADER - pFileHeader-&gt;SizeOfOptionalHeader - pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER &lt; <span class=\"number\">2</span> * IMAGE_SIZEOF_SECTION_HEADER)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;headers中空闲区不够!!\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(pImageBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//把节表中第一个节复制到节表中最后一个节</span></span><br><span class=\"line\">\t<span class=\"comment\">//计算开始复制的位置和第一个节的位置</span></span><br><span class=\"line\">\tLPVOID SecBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + <span class=\"number\">4</span>);</span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID MyBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class=\"line\">\tLPVOID MyBegin = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader+(pFileHeader-&gt;NumberOfSections)*IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(MyBegin, SecBegin, IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//在新增节表后面再加IMAGE_SIZEOF_SECTION_HEADER个0</span></span><br><span class=\"line\">\tLPVOID ZeroBegin = (PIMAGE_SECTION_HEADER)MyBegin + <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(ZeroBegin, <span class=\"number\">0</span>, <span class=\"number\">40</span>);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">//修改NumberOfSections</span></span><br><span class=\"line\">\tpFileHeader-&gt;NumberOfSections += <span class=\"number\">1</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//新增节，NewSize为新增节的大小</span></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID codeBegin = (LPVOID)((DWORD)pImageBuffer + pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - 1].SizeOfRawData);</span></span><br><span class=\"line\">\t<span class=\"comment\">//memset(codeBegin, 1, AddNumber);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改SizeOfImage</span></span><br><span class=\"line\">\tpOptionHeader-&gt;SizeOfImage += ((AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class=\"number\">1</span>)* pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改节表</span></span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[0] = (BYTE)&quot;s&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[1] = (BYTE)&quot;b&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[2] = (BYTE)&quot;s&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[3] = (BYTE)&quot;b&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[4] = (BYTE)&quot;s&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[5] = (BYTE)&quot;b&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[6] = (BYTE)&quot;s&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - 1].Name[7] = (BYTE)&quot;b&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].Misc.VirtualSize = AddNumber;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].VirtualAddress = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].SizeOfRawData;</span><br><span class=\"line\">\tDWORD num = (AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class=\"number\">1</span>;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].SizeOfRawData = ((AddNumber/pOptionHeader-&gt;SectionAlignment)+<span class=\"number\">1</span>) * pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].Characteristics = pSectionHeader[<span class=\"number\">0</span>].Characteristics;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].PointerToRawData =  pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].PointerToRawData + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].SizeOfRawData;</span><br><span class=\"line\">\tDWORD size = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestAddSecInDosStub</span><span class=\"params\">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tDWORD elfanew = pDosHeader-&gt;e_lfanew;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\">\t<span class=\"comment\">//保留原始属性???</span></span><br><span class=\"line\">\tDWORD NumOfSec = pFileHeader-&gt;NumberOfSections;</span><br><span class=\"line\">\tDWORD virtualsize = pSectionHeader[NumOfSec - <span class=\"number\">1</span>].Misc.VirtualSize;</span><br><span class=\"line\">\tDWORD virtualaddress = pSectionHeader[NumOfSec - <span class=\"number\">1</span>].VirtualAddress;</span><br><span class=\"line\">\tDWORD pointertorawdata = pSectionHeader[NumOfSec - <span class=\"number\">1</span>].PointerToRawData;</span><br><span class=\"line\">\tDWORD sizeofrawdata = pSectionHeader[NumOfSec - <span class=\"number\">1</span>].SizeOfRawData;</span><br><span class=\"line\">\tDWORD sectionalignment = pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\">\t<span class=\"comment\">//判断空闲区大小是否足够添加节表</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//if ((DWORD)pImageBuffer + pOptionHeader-&gt;SizeOfHeaders - pDosHeader-&gt;e_lfanew - IMAGE_SIZEOF_FILE_HEADER - pFileHeader-&gt;SizeOfOptionalHeader - pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER &lt; 2 * IMAGE_SIZEOF_SECTION_HEADER)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;提升并覆盖dos stub!\\n&quot;</span>;</span><br><span class=\"line\">\tLPVOID dest = (LPVOID)((DWORD)pImageBuffer + <span class=\"number\">0x40</span>);  <span class=\"comment\">//DOS有用数据结束，垃圾数据开始</span></span><br><span class=\"line\">\tLPVOID source = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew); <span class=\"comment\">//NT begin position</span></span><br><span class=\"line\">\tDWORD size = pDosHeader-&gt;e_lfanew - <span class=\"number\">0x40</span>;  <span class=\"comment\">//向上提升的空间</span></span><br><span class=\"line\">\tcout &lt;&lt; size &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\tDWORD shabi = (<span class=\"number\">4</span> + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER); <span class=\"comment\">//signature，nt，file，option，节表提升抬升</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(dest, source, shabi);</span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID newone = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER + 4 - size);</span></span><br><span class=\"line\">\t<span class=\"comment\">//memset(newone,0,size);</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//更新e-&gt;lfanew</span></span><br><span class=\"line\">\tpDosHeader-&gt;e_lfanew = elfanew - size;</span><br><span class=\"line\">\t<span class=\"comment\">//更新头指针</span></span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\t<span class=\"comment\">//PE头</span></span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(((DWORD)pNTHeader) + <span class=\"number\">4</span>);\t<span class=\"comment\">//NT头地址 + 4 为 FileHeader 首址</span></span><br><span class=\"line\">\t<span class=\"comment\">//可选PE头\t</span></span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);<span class=\"comment\">//SIZEOF_FILE_HEADER为固定值且不存在于PE文件字段中</span></span><br><span class=\"line\">\t<span class=\"comment\">//首个节表</span></span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//开始新增节</span></span><br><span class=\"line\">\t<span class=\"comment\">//把节表中第一个节复制到节表中最后一个节</span></span><br><span class=\"line\">\t<span class=\"comment\">//计算开始复制的位置和第一个节的位置</span></span><br><span class=\"line\">\tLPVOID SecBegin = (LPVOID)pSectionHeader; <span class=\"comment\">//第一个节的位置</span></span><br><span class=\"line\">\tLPVOID MyBegin =  (LPVOID)((DWORD)SecBegin + pFileHeader-&gt;NumberOfSections * <span class=\"number\">40</span>);<span class=\"comment\">//复制到的目标位置</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID SecBegin = (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader - size); //第一个节的位置</span></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID MyBegin =  (LPVOID)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER + pFileHeader-&gt;SizeOfOptionalHeader + pFileHeader-&gt;NumberOfSections * IMAGE_SIZEOF_SECTION_HEADER - size);//复制到的目标位置</span></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID MyBegin = (LPVOID)(PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + (pFileHeader-&gt;NumberOfSections)*IMAGE_SIZEOF_SECTION_HEADER - size);  //复制到的目标位置</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; pFileHeader-&gt;NumberOfSections &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(MyBegin, SecBegin, <span class=\"number\">40</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//在新增节表后面再加IMAGE_SIZEOF_SECTION_HEADER个0</span></span><br><span class=\"line\">\t<span class=\"comment\">//memset((PBYTE)MyBegin + NumOfSec * 40 + IMAGE_SIZEOF_SECTION_HEADER, 0, IMAGE_SIZEOF_SECTION_HEADER);</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>((PBYTE)MyBegin + <span class=\"number\">40</span>, <span class=\"number\">0</span>, <span class=\"number\">40</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改NumberOfSections</span></span><br><span class=\"line\">\tpFileHeader-&gt;NumberOfSections += <span class=\"number\">1</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\t<span class=\"comment\">//新增节，NewSize为新增节的大小</span></span><br><span class=\"line\">\t<span class=\"comment\">//LPVOID codeBegin = (LPVOID)((DWORD)pImageBuffer + pSectionHeader[pFileHeader-&gt;NumberOfSections-2].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections-2].SizeOfRawData);</span></span><br><span class=\"line\">\t<span class=\"comment\">//memset(codeBegin, 0, AddNumber);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改SizeOfImage</span></span><br><span class=\"line\">\tpOptionHeader-&gt;SizeOfImage += ((AddNumber / sectionalignment) + <span class=\"number\">1</span>)* sectionalignment;</span><br><span class=\"line\">\t<span class=\"comment\">//修改节表</span></span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].Misc.VirtualSize = AddNumber;  <span class=\"comment\">//vitualsize = 新增大小</span></span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].VirtualAddress = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].VirtualAddress + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].SizeOfRawData;  <span class=\"comment\">//上一个节的VirtualAddress+sizeofrawdata</span></span><br><span class=\"line\">\tDWORD num = (AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class=\"number\">1</span>;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].SizeOfRawData = ((AddNumber / pOptionHeader-&gt;SectionAlignment) + <span class=\"number\">1</span>) * pOptionHeader-&gt;SectionAlignment; <span class=\"comment\">//sizeofrawdata 对齐后</span></span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].Characteristics = pSectionHeader[<span class=\"number\">0</span>].Characteristics;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].PointerToRawData = pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].PointerToRawData + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">2</span>].SizeOfRawData;</span><br><span class=\"line\">\tDWORD size1 = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//valid program</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestExpandLastSec</span><span class=\"params\">(IN LPSTR lpszFile, IN DWORD AddNumber, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//开辟大小为SizeOfImage + x的空间</span></span><br><span class=\"line\">\tLPVOID newspace = (LPVOID)<span class=\"built_in\">malloc</span>(pOptionHeader-&gt;SizeOfImage + AddNumber);</span><br><span class=\"line\">\t<span class=\"comment\">//修改最后一个节的属性</span></span><br><span class=\"line\">\t<span class=\"comment\">//virtualsize内存对齐后的值</span></span><br><span class=\"line\">\tDWORD newvirtualsize = (pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].Misc.VirtualSize / pOptionHeader-&gt;SectionAlignment +<span class=\"number\">1</span> ) * pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\">\t<span class=\"comment\">//max(sizeofrawdat,virtualsize)</span></span><br><span class=\"line\">\tDWORD maxsize = newvirtualsize &gt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].SizeOfRawData ? newvirtualsize : pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].SizeOfRawData;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].SizeOfRawData = (((maxsize + AddNumber)/pOptionHeader-&gt;SectionAlignment)+<span class=\"number\">1</span>) *  pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].Misc.VirtualSize = maxsize + AddNumber;</span><br><span class=\"line\">\tcout &lt;&lt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].SizeOfRawData &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].Misc.VirtualSize &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改sizeofimage</span></span><br><span class=\"line\">\t<span class=\"comment\">//注意修正SizeofImage，错误的sizeofimage会导致非法的win32程序</span></span><br><span class=\"line\">\t<span class=\"comment\">//pOptionHeader-&gt;SizeOfImage = ((pSectionHeader[pFileHeader-&gt;NumberOfSections-1].Misc.VirtualSize + pSectionHeader[pFileHeader-&gt;NumberOfSections-1].VirtualAddress + AddNumber)/pOptionHeader-&gt;SectionAlignment + 1) * pOptionHeader-&gt;SectionAlignment;</span></span><br><span class=\"line\">\tpOptionHeader-&gt;SizeOfImage = \\</span><br><span class=\"line\">\t\t(((pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].Misc.VirtualSize + pSectionHeader[pFileHeader-&gt;NumberOfSections - <span class=\"number\">1</span>].VirtualAddress) / pOptionHeader-&gt;SectionAlignment) + <span class=\"number\">1</span>) * pOptionHeader-&gt;SectionAlignment;</span><br><span class=\"line\">\t<span class=\"comment\">//修改character</span></span><br><span class=\"line\">\tpSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].Characteristics = pSectionHeader[<span class=\"number\">0</span>].Characteristics | pSectionHeader[pFileHeader-&gt;NumberOfSections<span class=\"number\">-1</span>].Characteristics;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tDWORD size1 = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">free</span>(newspace);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//返回对齐后大小，x为对齐前大小，y为pOptionHeader-&gt;SectionAlignment/pOptionHeader-&gt;FileAlignment</span></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">Align</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ((x/y)+<span class=\"number\">1</span>)*y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//merge all section to one section</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">TestMergeSec</span><span class=\"params\">(IN LPSTR lpszFile, OUT LPSTR lpszOutFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pFirstSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\">\tpFirstSectionHeader = pSectionHeader;</span><br><span class=\"line\">\t<span class=\"comment\">//保留原来节表数量</span></span><br><span class=\"line\">\tDWORD origin_sec = pFileHeader-&gt;NumberOfSections;</span><br><span class=\"line\">\t<span class=\"comment\">//修改第一个节的属性</span></span><br><span class=\"line\">\tpSectionHeader[<span class=\"number\">0</span>].Misc.VirtualSize = pSectionHeader[<span class=\"number\">0</span>].SizeOfRawData = (((copySizeFromFile - pSectionHeader[<span class=\"number\">0</span>].VirtualAddress)/pOptionHeader-&gt;FileAlignment)+<span class=\"number\">1</span>)*pOptionHeader-&gt;FileAlignment;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">1</span>;i&lt;pFileHeader-&gt;NumberOfSections;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpSectionHeader[<span class=\"number\">0</span>].Characteristics = pSectionHeader[<span class=\"number\">0</span>].Characteristics | pSectionHeader[i].Characteristics;</span><br><span class=\"line\">\t\t<span class=\"built_in\">memset</span>(pSectionHeader+i, <span class=\"number\">0</span>, IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//modify sectionnumber</span></span><br><span class=\"line\">\tpFileHeader-&gt;NumberOfSections = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//memset(pFirstSectionHeader+40,0,(origin_sec-1)*40);</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\tDWORD size1 = <span class=\"built_in\">CopyImageBufferToNewBuffer</span>(pImageBuffer, &amp;pNewBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> isSucc = <span class=\"built_in\">MemeryToFile</span>(pNewBuffer, size1, lpszOutFile);</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (isSucc == <span class=\"literal\">true</span>) cout &lt;&lt; <span class=\"string\">&quot;Success\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> cout &lt;&lt; <span class=\"string\">&quot;woshishabi\\n&quot;</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">PrintImageDirectory</span><span class=\"params\">(IN LPSTR lpszFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pImageBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tLPVOID pNewBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\">\tDWORD copySizeFromFile = <span class=\"built_in\">CopyFileBufferToImageBuffer</span>(pFileBuffer, &amp;pImageBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pImageBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pImageBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"comment\">//pSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span></span><br><span class=\"line\">\t<span class=\"type\">char</span>* name[<span class=\"number\">16</span>] = &#123;<span class=\"string\">&quot;导出表&quot;</span>,<span class=\"string\">&quot;导入表&quot;</span>,<span class=\"string\">&quot;资源表&quot;</span>,<span class=\"string\">&quot;异常表&quot;</span>,<span class=\"string\">&quot;安全证书表&quot;</span>,<span class=\"string\">&quot;重定位表&quot;</span>,<span class=\"string\">&quot;调试信息表&quot;</span>,<span class=\"string\">&quot;版权所有表&quot;</span>,<span class=\"string\">&quot;全局指针表&quot;</span>,<span class=\"string\">&quot;TLS表&quot;</span>,<span class=\"string\">&quot;加载配置表&quot;</span>,<span class=\"string\">&quot;绑定导入表&quot;</span>,<span class=\"string\">&quot;IAT表&quot;</span>,<span class=\"string\">&quot;延迟导入表&quot;</span>,<span class=\"string\">&quot;COM&quot;</span>,<span class=\"string\">&quot;Reverse&quot;</span>&#125;;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;pOptionHeader-&gt;NumberOfRvaAndSizes;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;------------------------------------\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s\\n&quot;</span>,name[i]);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Size:%X\\n&quot;</span>,pOptionHeader-&gt;DataDirectory[i].Size);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;VirtualAddress:%X\\n&quot;</span>,pOptionHeader-&gt;DataDirectory[i].VirtualAddress);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>参考了大佬们的文章:</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NsYXlvYS9hcnRpY2xlL2RldGFpbHMvMTIyNDU5NDM5\"> 增节_ma_lic 的博客 - CSDN 博客</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5ODA1NDc3L2FydGljbGUvZGV0YWlscy8xMjA1NDQ4OTA=\">扩大节_滴水逆向扩大节_Revival_S 的博客 - CSDN 博客</span></p>\n</blockquote>\n<h3 id=\"静态链接库\"><a class=\"markdownIt-Anchor\" href=\"#静态链接库\">#</a> 静态链接库</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.创建静态lib</span><br><span class=\"line\">2.复制debug下的 .lib 和 ../.h到当前工程 </span><br><span class=\"line\">3.使用静态或者动态链接</span><br><span class=\"line\">静态： 在需要使用的项目中 #include &quot;x.h&quot;   #pragma comment(lib,&quot;x.lib&quot;)</span><br><span class=\"line\">隐式：不写第二个pragama ，使用setting -&gt; link -&gt; 对象/模块库  -&gt; 复制自己的lib名称</span><br><span class=\"line\"></span><br><span class=\"line\">使用：和普通函数调用一样</span><br><span class=\"line\">int x= Plus(1,2);</span><br></pre></td></tr></table></figure>\n<p>手动连接</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230212154955361.png\" alt=\"image-20230212154955361\"></p>\n<p>#include 中只有函数说明，没有实现，VC 中对象 / 库模块中默认包含了很多，见上图</p>\n<p>代码的重复使用</p>\n<p>二进制代码直接编译到 exe 中</p>\n<p>改 lib 代码需要重新编译 exe</p>\n<h3 id=\"动态链接库\"><a class=\"markdownIt-Anchor\" href=\"#动态链接库\">#</a> 动态链接库</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">函数声明：</span><br><span class=\"line\">extern &quot;C&quot; _declspec(dllexport) __stdcall int Add(int ,int);</span><br><span class=\"line\"></span><br><span class=\"line\">1、 extern表示这是个全局函数，可以供各个其他的函数调用;  </span><br><span class=\"line\">2、&quot;℃”按照c语言的方式进行编译、链接</span><br><span class=\"line\">3、declspec(dllexport)告诉编译器此函数为导出函数;</span><br><span class=\"line\"></span><br><span class=\"line\">如果不加 “C”会按照C++导出为了防止重载会在函数名后加上符号</span><br><span class=\"line\"></span><br><span class=\"line\">动态链接库代码编译后在自己的dll中</span><br></pre></td></tr></table></figure>\n<p>VC6 自带 depend 识别 dll</p>\n<p>如果不加 extern “C” 导出：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308194335559.png\" alt=\"image-20230308194335559\"></p>\n<p>如果加 extern “C” ：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308194531511.png\" alt=\"image-20230308194531511\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">使用dll</span><br><span class=\"line\">1.隐式连接</span><br><span class=\"line\">1.将lib，dll放在工程目录下，代码存在于dll中</span><br><span class=\"line\">2.#pragma comment(lib,&quot;x.lib&quot;)</span><br><span class=\"line\">3.extern &quot;C&quot; _declspec(dllimport) __stdcall int Add(int ,int); 添加到调用文件中</span><br><span class=\"line\">如果导出时加了__stdcall，那么在导入时也需要加，建议导出方式为stdcall</span><br><span class=\"line\"></span><br><span class=\"line\">2,.显示连接</span><br><span class=\"line\">定义函数指针 typedef int (__stdcall *lpPlus)(int ,int);</span><br><span class=\"line\">声明指针类型变量 lpPlus myPlus;</span><br><span class=\"line\">动态加载dll到内存中 #include &lt;Windows.h&gt;  HINSTANCE hModule = LoadLibrary(&quot;x.dll&quot;);   如果加了__stdcall ,函数名会变为_Plus@8 </span><br><span class=\"line\">获取函数地址 mpPlus = (lpPlus)GetProcAddress(hModule, &quot;Plus&quot;);</span><br><span class=\"line\">myPlus(1,2);</span><br></pre></td></tr></table></figure>\n<p>dll 中代码修改后不需要重新编译 exe，dll 的代码不在 exe 里，在 dll’的空间中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Handle是代表系统的内核对象，如文件句柄，线程句柄，进程句柄。</span><br><span class=\"line\">HMODULE是代表应用程序载入的模块</span><br><span class=\"line\">HINSTANCE在win32下与HMODULE是相同的东西Win16遗留</span><br><span class=\"line\">HWND是窗口句柄</span><br><span class=\"line\">本质都是无符号整数 unsigned int</span><br><span class=\"line\">这么设计可以可读性更好，避免进行运算</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">.def无函数名导出</span><br><span class=\"line\">新建.def文件,使用序号到达隐藏</span><br><span class=\"line\">头文件不能再加export</span><br><span class=\"line\">创建.def</span><br><span class=\"line\">@是导出序号</span><br><span class=\"line\"></span><br><span class=\"line\">EXPORTS</span><br><span class=\"line\">Plus @12</span><br><span class=\"line\">Sub @15 NONAME</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308202844475.png\" alt=\"image-20230308202844475\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#pragma comment(lib,&quot;TestDll.lib&quot;)</span><br><span class=\"line\">extern &quot;C&quot; _declspec(dllimport) int Add(int ,int);</span><br><span class=\"line\">extern &quot;C&quot; _declspec(dllimport) int Mul(int ,int);</span><br><span class=\"line\"></span><br><span class=\"line\">void testDll()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\ttypedef int (*lpAdd)(int ,int);</span><br><span class=\"line\">\ttypedef int (*lpMul)(int ,int);</span><br><span class=\"line\">\tlpAdd myadd;</span><br><span class=\"line\">\tlpMul mymul;</span><br><span class=\"line\">\tHINSTANCE hModule = LoadLibrary(&quot;TestDll.dll&quot;);</span><br><span class=\"line\">\tmyadd = (lpAdd)GetProcAddress(hModule, &quot;Add&quot;);</span><br><span class=\"line\">\tmymul = (lpMul)GetProcAddress(hModule, &quot;Mul&quot;);</span><br><span class=\"line\">\tcout &lt;&lt; myadd(3,4) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\tcout &lt;&lt; mymul(3,4) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"导出表\"><a class=\"markdownIt-Anchor\" href=\"#导出表\">#</a> 导出表</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exe和dll都可以提供函数。一般情况是dll提供函数。</span><br><span class=\"line\">提供函数给别人用必须要用导出表</span><br><span class=\"line\">如果导出表的RVA和size都是00000000证明他没有导出表</span><br><span class=\"line\"></span><br><span class=\"line\">IMAGE_DIRECTORY_ENTRY_EXPORT</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tDWORD VitualAddress;</span><br><span class=\"line\">\tDWORD Size;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">virtualaddress是内存中的，需要转成FOA</span><br><span class=\"line\">DWORD RvaToFileOffset(IN LPVOID pFileBuffer, DWORD dwRva)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t//define pe structure</span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(sizeof(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pOptionHeader + pFileHeader-&gt;SizeOfOptionalHeader);</span><br><span class=\"line\"></span><br><span class=\"line\">\tprintf(&quot;pFileBuffer: %X\\n&quot;, pFileBuffer); //450068</span><br><span class=\"line\">\tprintf(&quot;DWRVA: %X\\n&quot;, dwRva); </span><br><span class=\"line\">\tDWORD MemOffset = (dwRva - (DWORD)pFileBuffer); //45C29C - 450068 = C234，内存中的rva</span><br><span class=\"line\">\tprintf(&quot;MemOffset: %X\\n&quot;, MemOffset); </span><br><span class=\"line\"></span><br><span class=\"line\">\t//当前RVA在哪个节中</span><br><span class=\"line\">\tint NumOfSec = 0;</span><br><span class=\"line\">\t//RVA所在节的VirtualAddress</span><br><span class=\"line\">\tDWORD thisVA = 0;</span><br><span class=\"line\">\t//RVA所在节的PointerToRawData</span><br><span class=\"line\">\tDWORD thisFile = 0;</span><br><span class=\"line\">\t//距离当前节开始的便宜</span><br><span class=\"line\">\tDWORD thisoffset = 0;</span><br><span class=\"line\">\t//在文件中的FOA</span><br><span class=\"line\">\tDWORD FilePos = 0;</span><br><span class=\"line\">\t//判断在哪个节的条件</span><br><span class=\"line\">\twhile (pFileHeader-&gt;NumberOfSections &gt; 0)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tif ((DWORD)MemOffset &gt; (DWORD)pSectionHeader-&gt;VirtualAddress &amp;&amp; (DWORD)MemOffset &lt; (DWORD)pSectionHeader-&gt;VirtualAddress + pSectionHeader-&gt;Misc.VirtualSize)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tthisVA = pSectionHeader-&gt;VirtualAddress;</span><br><span class=\"line\">\t\t\tthisFile = pSectionHeader-&gt;PointerToRawData;</span><br><span class=\"line\">\t\t\tprintf(&quot;thisVA:%X\\n&quot;,thisVA);  //C000</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tpSectionHeader = (PIMAGE_SECTION_HEADER)((DWORD)pSectionHeader + IMAGE_SIZEOF_SECTION_HEADER);</span><br><span class=\"line\">\t\tpFileHeader-&gt;NumberOfSections--;</span><br><span class=\"line\">\t\tNumOfSec++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tprintf(&quot;NumOfSec:%d\\n&quot;, NumOfSec+1);</span><br><span class=\"line\">\tthisoffset = MemOffset - thisVA; //C234-C000 = 234;</span><br><span class=\"line\">\tprintf(&quot;thisoffset:%X\\n&quot;,thisoffset);</span><br><span class=\"line\">\tFilePos = thisoffset + thisFile; // 234 + AC00 = AE3</span><br><span class=\"line\">\tprintf(&quot;FilePos:%X\\n&quot;,FilePos);</span><br><span class=\"line\">\treturn FilePos;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> </span><br><span class=\"line\">typedef struct _IMAGE_EXPORT_DIRECTORY &#123;</span><br><span class=\"line\">    DWORD   Characteristics;</span><br><span class=\"line\">    DWORD   TimeDateStamp;</span><br><span class=\"line\">    WORD    MajorVersion;</span><br><span class=\"line\">    WORD    MinorVersion;</span><br><span class=\"line\">    DWORD   Name;</span><br><span class=\"line\">    DWORD   Base;</span><br><span class=\"line\">    DWORD   NumberOfFunctions;</span><br><span class=\"line\">    DWORD   NumberOfNames;</span><br><span class=\"line\">    DWORD   AddressOfFunctions;     // RVA from base of image</span><br><span class=\"line\">    DWORD   AddressOfNames;         // RVA from base of image</span><br><span class=\"line\">    DWORD   AddressOfNameOrdinals;  // RVA from base of image</span><br><span class=\"line\">&#125; IMAGE_EXPORT_DIRECTORY, *PIMAGE_EXPORT_DIRECTORY;</span><br><span class=\"line\"></span><br><span class=\"line\">AddressofFunctions是函数地址，但是他是RVA</span><br><span class=\"line\">导出函数数量由NumberofFunctions决定</span><br><span class=\"line\">AddressOfName是函数名的地址，还是RVA，noname导出这里就不会有</span><br><span class=\"line\">名字的数量是由NumberOfNames决定，这里只包含以函数名导出的函数的个数</span><br><span class=\"line\">AddressOfFunctions 和 AddressOfnames 长度可以不一样，可以存在noname函数或者两个函数名称指向一个函数地址</span><br><span class=\"line\">NumberofName只代表以函数名导出的个数</span><br><span class=\"line\">AddressOfNameOrdinals，大小是NumberOfNames，导出序号 = base + AddressOfNameOrdinals</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">通过函数名找函数时，先把AddressOfName转成FOA找到里面的名字，再进行比较字符串</span><br><span class=\"line\">再把查找到的AddressOfNames索引到AddressOfNameOrdinals中找索引对应的值，这个值就是AddressOfFunctions里面的值</span><br><span class=\"line\">比如AddressOfNames中索引为2，到AddressOfNameOrdinals也找索引为2对应的序号，这个序号就是AddressOfFunctions中对应的下标</span><br><span class=\"line\"></span><br><span class=\"line\">系统认为的导出函数的个数 = AddressOfNameOrdinals最大序号 - 最小序号 + 1</span><br><span class=\"line\">如果序号不连续这个数量就会有问题</span><br><span class=\"line\"></span><br><span class=\"line\">用序号找</span><br><span class=\"line\">序号 - base = AddressOfFunctions的下标</span><br><span class=\"line\"></span><br><span class=\"line\">为什么要分成3张表?</span><br><span class=\"line\">1、函数导出的个数与函数名的个数未必一样.所以要将函数地址表和函数名称表分开</span><br><span class=\"line\">2、函数地址表是不是一定大于函数名称表?</span><br><span class=\"line\">未必，一个相同的函数地址，可能有多个不同的名字</span><br><span class=\"line\">3、如何根据函数的名字获取一个函数的地址?</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310152135716.png\" alt=\"image-20230310152135716\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310154212089.png\" alt=\"image-20230310154212089\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310160821694.png\" alt=\"image-20230310160821694\"></p>\n<p>hmodule 是拉伸后的，filebuffer 是文件中的</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">PrintfExportDir</span><span class=\"params\">(IN LPSTR lpszFile)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//从filebuffer - imagebuffer</span></span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pFirstSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\"><span class=\"comment\">//\tcout &lt;&lt; hex &lt;&lt; pOptionHeader-&gt;DataDirectory[0].VirtualAddress &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//把VirtualAddress转为foa</span></span><br><span class=\"line\">\tDWORD FOA = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class=\"number\">0</span>].VirtualAddress);</span><br><span class=\"line\">\t<span class=\"comment\">//打印export ditectory</span></span><br><span class=\"line\"><span class=\"comment\">//\tcout &lt;&lt; hex &lt;&lt; FOA &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\tPIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;Characteristics:%X\\n&quot;</span>,pExportDirectory-&gt;Characteristics);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;TimeDateStamp:%X\\n&quot;</span>,pExportDirectory-&gt;TimeDateStamp);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;MajorVersion:%X\\n&quot;</span>,pExportDirectory-&gt;MajorVersion);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;MinorVersion:%X\\n&quot;</span>,pExportDirectory-&gt;MinorVersion);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;Name:%X\\n&quot;</span>,pExportDirectory-&gt;Name);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;Base:%X\\n&quot;</span>,pExportDirectory-&gt;Base);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;NumberOfFunctions:%X\\n&quot;</span>,pExportDirectory-&gt;NumberOfFunctions);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;NumberOfNames:%X\\n&quot;</span>,pExportDirectory-&gt;NumberOfNames);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;AddressOfFunctions:%X\\n&quot;</span>,pExportDirectory-&gt;AddressOfFunctions);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;AddressOfNameOrdinals:%X\\n&quot;</span>,pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;pExportDirectory-&gt;AddressOfNames:%X\\n&quot;</span>,pExportDirectory-&gt;AddressOfNames);</span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;-------------------&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//打印addresofFunction</span></span><br><span class=\"line\">\tDWORD NumOfFunFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;pExportDirectory-&gt;NumberOfFunctions;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; hex &lt;&lt; *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + i*<span class=\"number\">4</span>) &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;-------------------&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//打印addressofnames</span></span><br><span class=\"line\">\tDWORD AddressFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class=\"line\">\tDWORD nameFOA = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* name = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> k=<span class=\"number\">0</span>;k&lt;pExportDirectory-&gt;NumberOfNames;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tnameFOA = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, *(PDWORD)((DWORD)pFileBuffer + AddressFoa));</span><br><span class=\"line\">\t\tname = (<span class=\"type\">char</span>*)(nameFOA + (DWORD)pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%s\\n&quot;</span>,name);</span><br><span class=\"line\">\t\tAddressFoa += <span class=\"number\">4</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;-------------------&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//打印AddressOfNameOrdinals</span></span><br><span class=\"line\">\tDWORD OrdinalFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> m=<span class=\"number\">0</span>;m&lt;pExportDirectory-&gt;NumberOfNames;m++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; hex &lt;&lt; *(PWORD)((DWORD)pFileBuffer + OrdinalFoa + m*<span class=\"number\">2</span>) + pExportDirectory-&gt;Base &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">GetFunctionAddrByName</span><span class=\"params\">(IN LPSTR lpszFile, IN LPVOID pFileBuffer, IN <span class=\"type\">char</span>* pFuncName)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pFirstSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"comment\">//把VirtualAddress转为foa</span></span><br><span class=\"line\">\tDWORD FOA = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class=\"number\">0</span>].VirtualAddress);</span><br><span class=\"line\">\tDWORD nameFOA = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* name = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class=\"line\">\tDWORD AddressFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class=\"line\">\tDWORD OrdinalFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class=\"line\">\tDWORD NumOfFunFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> k=<span class=\"number\">0</span>;k&lt;pExportDirectory-&gt;NumberOfNames;k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tnameFOA = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, *(PDWORD)((DWORD)pFileBuffer + AddressFoa));</span><br><span class=\"line\">\t\tname = (<span class=\"type\">char</span>*)(nameFOA + (DWORD)pFileBuffer);</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">strcmp</span>(name,(<span class=\"type\">char</span>*)pFuncName) == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tDWORD num = *(PWORD)((DWORD)pFileBuffer + OrdinalFoa + k*<span class=\"number\">2</span>);</span><br><span class=\"line\">\t\t\tDWORD haha = *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + num*<span class=\"number\">4</span>);</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//cout &lt;&lt; hex &lt;&lt; haha &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> haha;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tAddressFoa += <span class=\"number\">4</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\">DWORD <span class=\"title\">GetFunctionAddrByOrdinals</span><span class=\"params\">(IN LPSTR lpszFile, IN LPVOID pFileBuffer, IN DWORD OutNum)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tDWORD fileLen = <span class=\"built_in\">ReadPEFile</span>(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pFirstSectionHeader = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;</span><br><span class=\"line\">\tpNTHeader = (PIMAGE_NT_HEADERS)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew);</span><br><span class=\"line\">\tpFileHeader = (PIMAGE_FILE_HEADER)(<span class=\"built_in\">sizeof</span>(pNTHeader-&gt;Signature) + (DWORD)pNTHeader);</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER)((DWORD)pFileHeader + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\t<span class=\"comment\">//把VirtualAddress转为foa</span></span><br><span class=\"line\">\tDWORD FOA = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pOptionHeader-&gt;DataDirectory[<span class=\"number\">0</span>].VirtualAddress);</span><br><span class=\"line\">\tDWORD nameFOA = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* name = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tPIMAGE_EXPORT_DIRECTORY pExportDirectory = (PIMAGE_EXPORT_DIRECTORY)((DWORD)pFileBuffer + FOA);</span><br><span class=\"line\">\tDWORD AddressFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNames);</span><br><span class=\"line\">\tDWORD OrdinalFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfNameOrdinals);</span><br><span class=\"line\">\tDWORD NumOfFunFoa = <span class=\"built_in\">RvaToFileOffset</span>(pFileBuffer, pExportDirectory-&gt;AddressOfFunctions);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">int</span> xiabiao = OutNum - pExportDirectory-&gt;Base;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;pExportDirectory-&gt;NumberOfFunctions;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (i == xiabiao)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tDWORD address = *(PDWORD)((DWORD)pFileBuffer + NumOfFunFoa + i*<span class=\"number\">4</span>);</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> address;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"重定位表\"><a class=\"markdownIt-Anchor\" href=\"#重定位表\">#</a> 重定位表</h3>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311170507585.png\" alt=\"image-20230311170507585\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">程序加载可以理解为贴图的过程，先开辟4G虚拟内存，先把exe放在ImageBase，分SizeOfimage大小</span><br><span class=\"line\">在加载dll，一般在70000000开始，每个dll都从自己的imagebase开始，分sizeofimage大小</span><br><span class=\"line\">dll贴完，指向oep，程序就可以运行了</span><br><span class=\"line\"></span><br><span class=\"line\">一般情况下，EX都是可以按照ImageBase的地址进行加载的.因为Exe拥有自己独立的4GB 的虚拟内存空间但DLL不是DLL是有EXE使用它，才加载到相关EXE的进程空间的.</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">为了提高搜索的速度，模块间地址也是要对齐的模块地址对齐为10000H也就是64K</span><br><span class=\"line\"></span><br><span class=\"line\">编译时生成的地址= ImageBase + RVA</span><br><span class=\"line\">如果加载的时候没有按照预定加载，那么绝对地址会不可用</span><br><span class=\"line\">所以需要一张表保存绝对地址</span><br><span class=\"line\"></span><br><span class=\"line\">目录向的第六个结构是重定位表</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct _IMAGE_DATA_DIRECTORY &#123;</span><br><span class=\"line\">    DWORD   VirtualAddress;</span><br><span class=\"line\">    DWORD   Size;</span><br><span class=\"line\">&#125; IMAGE_DATA_DIRECTORY, *PIMAGE_DATA_DIRECTORY;</span><br><span class=\"line\"></span><br><span class=\"line\">RVA -&gt; FOA</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct _IMAGE_BASE_RELOCATION &#123;</span><br><span class=\"line\">    DWORD   VirtualAddress;</span><br><span class=\"line\">    DWORD   SizeOfBlock;</span><br><span class=\"line\">&#125; IMAGE_BASE_RELOCATION;</span><br><span class=\"line\">typedef IMAGE_BASE_RELOCATION UNALIGNED * PIMAGE_BASE_RELOCATION;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311173859344.png\" alt=\"image-20230311173859344\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">virtualaddress放修改的起始地址</span><br><span class=\"line\">Virtualaddress + 块中数据 = 要修改的地址的RVA</span><br><span class=\"line\">每一块中是一页中需要修改的地址</span><br><span class=\"line\">每页为4k，每个页只需要12位二进制，因此2字节够标识所有的地址，即块内数据都是2字节</span><br><span class=\"line\">内存中的页大小是1000H也就是说2的12次方就可以表示一个页内所有的偏移地址具体项的宽度是16字节高四位代表类型:值为3代表的是需要修改的数据值为o代表的是用于数据对齐的数据，可以不用修改.也就是说我们只关注高四位为3</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">但分空间还是要分16个，因为内存对齐</span><br><span class=\"line\">因此计算RVA时只需要计算低12位，低12位 + x就是需要修改的RVA</span><br><span class=\"line\">高四位果 = 3，那么需要改修， =0代表不需要修复</span><br><span class=\"line\"></span><br><span class=\"line\">最后一个块是一个全0结构， &amp; 判断</span><br><span class=\"line\"></span><br><span class=\"line\">块中多少 = (SizeOfBlock - 8) / 2</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311175130539.png\" alt=\"image-20230311175130539\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void PrintRelocationDirectory(IN LPSTR lpszFile)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tLPVOID pFileBuffer = NULL;</span><br><span class=\"line\">\tDWORD fileLen = ReadPEFile(lpszFile, &amp;pFileBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">\tPIMAGE_DOS_HEADER pDosHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_NT_HEADERS pNTHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_FILE_HEADER pFileHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_OPTIONAL_HEADER pOptionHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_SECTION_HEADER pSectionHeader = NULL;</span><br><span class=\"line\">\tPIMAGE_EXPORT_DIRECTORY pExportDirectory = NULL;</span><br><span class=\"line\">\tPIMAGE_BASE_RELOCATION pRelocationDirectory = NULL;</span><br><span class=\"line\">\tPIMAGE_BASE_RELOCATION pRelocationTable = NULL;</span><br><span class=\"line\"></span><br><span class=\"line\">\tpDosHeader = (PIMAGE_DOS_HEADER)pFileBuffer;\t// 强转 DOS_HEADER 结构体指针</span><br><span class=\"line\">\t//可选PE头\t  简化后的处理</span><br><span class=\"line\">\tpOptionHeader = (PIMAGE_OPTIONAL_HEADER32)((DWORD)pFileBuffer + pDosHeader-&gt;e_lfanew + 4 + IMAGE_SIZEOF_FILE_HEADER);</span><br><span class=\"line\">\tpRelocationTable = (PIMAGE_BASE_RELOCATION)((DWORD)pFileBuffer + RvaToFileOffset(pFileBuffer, pOptionHeader-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress));</span><br><span class=\"line\">\t//pRelocationTable = (PIMAGE_BASE_RELOCATION)(RvaToFileOffset(pFileBuffer, pOptionHeader-&gt;DataDirectory[IMAGE_DIRECTORY_ENTRY_BASERELOC].VirtualAddress));</span><br><span class=\"line\">\tprintf(&quot;Relocation Table Rva: %#x\\n&quot;, pRelocationTable-&gt;VirtualAddress);</span><br><span class=\"line\">#if 1</span><br><span class=\"line\">\tint i = 1;</span><br><span class=\"line\">\t//pRelocationTable = (PIMAGE_BASE_RELOCATION)RvaToFileOffset(pFileBuffer,pRelocationTable-&gt;VirtualAddress);</span><br><span class=\"line\">\twhile ( pRelocationTable-&gt;VirtualAddress &amp;&amp; pRelocationTable-&gt;SizeOfBlock)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tprintf(&quot;第%d个块VirtualAddress:%X\\n&quot;, i, pRelocationTable-&gt;VirtualAddress);</span><br><span class=\"line\">\t\tprintf(&quot;第%d个块SizeOfBlock:%X\\n&quot;, i,pRelocationTable-&gt;SizeOfBlock);</span><br><span class=\"line\">\t\tprintf(&quot;第%d个块项数:%X\\n&quot;, i, (pRelocationTable-&gt;SizeOfBlock - 8)/2);</span><br><span class=\"line\">\t\tpRelocationTable = (PIMAGE_BASE_RELOCATION)(pRelocationTable-&gt;SizeOfBlock + (DWORD)pRelocationTable);</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">#endif</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x5Z2wzNS9hcnRpY2xlL2RldGFpbHMvMTE4OTMxNTI4\"> 打印出重定位表（C 语言实现）_打印重定位表_lygl35 的博客 - CSDN 博客</span></p>\n<h3 id=\"移动导出表\"><a class=\"markdownIt-Anchor\" href=\"#移动导出表\">#</a> 移动导出表</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.在DLL中新增节，返回FOA</span><br><span class=\"line\">2.复制AddressOfFunctions 长度 4*NumberOfFunctions</span><br><span class=\"line\">3.移动AddressOfNameOrdinals 长度 2*NumberOfNames</span><br><span class=\"line\">4.复制AddressOfNames 长度  4*NumberOfNames</span><br><span class=\"line\">5.复制函数名 长度不确定，直接修复AddressOfNames，复制完一个名字，算下一个地址在哪里，算完在修复Names表</span><br><span class=\"line\">6.复制_IMAGE_EXPORT_DIRECTORY结构</span><br><span class=\"line\">7.修复_IMAGE_EXPORT_DIRECTORY中的AddressOfFunctions，AddressOfNames，AddressOfNameOrdinals</span><br><span class=\"line\">8.修复目录项中的值，指向新的_IMAGE_EXPORT_DIRECTORY</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.新增节</span><br><span class=\"line\">2.目录项改为新增节起始位置</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230312153214517.png\" alt=\"image-20230312153214517\"></p>\n<h3 id=\"iat\"><a class=\"markdownIt-Anchor\" href=\"#iat\">#</a> IAT</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">12:       MessageBox(0,0,0,0);</span><br><span class=\"line\">00401658 8B F4                mov         esi,esp</span><br><span class=\"line\">0040165A 6A 00                push        0</span><br><span class=\"line\">0040165C 6A 00                push        0</span><br><span class=\"line\">0040165E 6A 00                push        0</span><br><span class=\"line\">00401660 6A 00                push        0</span><br><span class=\"line\">00401662 FF 15 44 63 48 00    call        dword ptr [__imp__MessageBoxA@16 (00486344)]</span><br><span class=\"line\">00401668 3B F4                cmp         esi,esp</span><br><span class=\"line\">0040166A E8 91 23 02 00       call        __chkesp (00423a00)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">我们自己写的程序，call后的地址是写死的，直接编译到exe中，不管中间是否有jmp</span><br><span class=\"line\">调用dll的程序，call后是[x],[x]才是dll中函数真实的地址，x是exe空间内，[x]在dll空间内，x只有在所有dll都贴完只有才改x</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313165403957.png\" alt=\"image-20230313165403957\"></p>\n<p>重定位表只能保证自己程序中的地址是正确的</p>\n<p>IAT 是保证调用 dll 的时候 call 的地址是正确的</p>\n<p>E8 call 是偏移</p>\n<p>FF 15 call 是绝对地址</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313171609509.png\" alt=\"image-20230313171609509\"></p>\n<p>只要用 dll 函数，全都是通过 [x] 调用，这样形成的表叫做 IAT 表</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230313171956653.png\" alt=\"image-20230313171956653\"></p>\n<p>IAThook</p>\n<h3 id=\"导入表\"><a class=\"markdownIt-Anchor\" href=\"#导入表\">#</a> 导入表</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123;</span><br><span class=\"line\">    union &#123;</span><br><span class=\"line\">        DWORD   Characteristics;            // 0 for terminating null import descriptor</span><br><span class=\"line\">        DWORD   OriginalFirstThunk;         // RVA to original unbound IAT (PIMAGE_THUNK_DATA)</span><br><span class=\"line\">    &#125; DUMMYUNIONNAME;</span><br><span class=\"line\">    DWORD   TimeDateStamp;                  // 0 if not bound,</span><br><span class=\"line\">                                            // -1 if bound, and real date\\time stamp</span><br><span class=\"line\">                                            //     in IMAGE_DIRECTORY_ENTRY_BOUND_IMPORT (new BIND)</span><br><span class=\"line\">                                            // O.W. date/time stamp of DLL bound to (Old BIND)</span><br><span class=\"line\"> </span><br><span class=\"line\">    DWORD   ForwarderChain;                 // -1 if no forwarders</span><br><span class=\"line\">    DWORD   Name;</span><br><span class=\"line\">    DWORD   FirstThunk;                     // RVA to IAT (if bound this IAT has actual addresses)</span><br><span class=\"line\">&#125; IMAGE_IMPORT_DESCRIPTOR;</span><br><span class=\"line\">typedef IMAGE_IMPORT_DESCRIPTOR UNALIGNED *PIMAGE_IMPORT_DESCRIPTOR;</span><br></pre></td></tr></table></figure>\n<p>PE 文件加载前</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230222142303612.png\" alt=\"image-20230222142303612\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">通过导入表的FirstThunk找到IAT</span><br><span class=\"line\">或者通过IMAGE_DATA_DIRECTORY的倒数第三张表找到IAT</span><br></pre></td></tr></table></figure>\n<p>加载后</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230222143253824.png\" alt=\"image-20230222143253824\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">INT 表作为加载后函数名的备份</span><br></pre></td></tr></table></figure>\n<p>定位导入表</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">目录项目的第二个结构就是导入表</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"绑定导入表\"><a class=\"markdownIt-Anchor\" href=\"#绑定导入表\">#</a> 绑定导入表</h3>\n<p>timedatestamp = -1 代表已经绑定了地址，真正的绑定时间为 IMAGE_BOUND_IMPORT_DES 的 TimeDateStamp</p>\n<p>0 带包代表还没绑定</p>\n<p>绑定导入表位于数据目录的第 12 项</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef struct _IMAGE_BOUND_IMPORT_DESCRIPTOR &#123;</span><br><span class=\"line\">    DWORD   TimeDateStamp;</span><br><span class=\"line\">    WORD    OffsetModuleName;</span><br><span class=\"line\">    WORD    NumberOfModuleForwarderRefs;    // Array of zero or more IMAGE_BOUND_FORWARDER_REF follows</span><br><span class=\"line\">&#125; IMAGE_BOUND_IMPORT_DESCRIPTOR,  *PIMAGE_BOUND_IMPORT_DESCRIPTOR;</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct _IMAGE_BOUND_FORWARDER_REF &#123;</span><br><span class=\"line\">    DWORD   TimeDateStamp;</span><br><span class=\"line\">    WORD    OffsetModuleName;</span><br><span class=\"line\">    WORD    Reserved;</span><br><span class=\"line\">&#125; IMAGE_BOUND_FORWARDER_REF, *PIMAGE_BOUND_FORWARDER_REF;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"c\"><a class=\"markdownIt-Anchor\" href=\"#c\">#</a> C++</h2>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">haha</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">\t<span class=\"type\">int</span> z;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">fun</span><span class=\"params\">(haha h)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\thaha sb;</span><br><span class=\"line\">\t<span class=\"built_in\">fun</span>(sb);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401068</span> <span class=\"number\">83</span> EC <span class=\"number\">0</span>C             sub         esp,<span class=\"number\">0</span>Ch</span><br><span class=\"line\"><span class=\"number\">0040106B</span> <span class=\"number\">8B</span> C4                mov         eax,esp</span><br><span class=\"line\"><span class=\"number\">0040106</span>D <span class=\"number\">8B</span> <span class=\"number\">4</span>D F4             mov         ecx,dword ptr [ebp<span class=\"number\">-0</span>Ch]</span><br><span class=\"line\"><span class=\"number\">00401070</span> <span class=\"number\">89</span> <span class=\"number\">08</span>                mov         dword ptr [eax],ecx</span><br><span class=\"line\"><span class=\"number\">00401072</span> <span class=\"number\">8B</span> <span class=\"number\">55</span> F8             mov         edx,dword ptr [ebp<span class=\"number\">-8</span>]</span><br><span class=\"line\"><span class=\"number\">00401075</span> <span class=\"number\">89</span> <span class=\"number\">50</span> <span class=\"number\">04</span>             mov         dword ptr [eax+<span class=\"number\">4</span>],edx</span><br><span class=\"line\"><span class=\"number\">00401078</span> <span class=\"number\">8B</span> <span class=\"number\">4</span>D FC             mov         ecx,dword ptr [ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040107B</span> <span class=\"number\">89</span> <span class=\"number\">48</span> <span class=\"number\">08</span>             mov         dword ptr [eax+<span class=\"number\">8</span>],ecx</span><br><span class=\"line\"><span class=\"number\">0040107</span>E E8 <span class=\"number\">82</span> FF FF FF       call        @ILT+<span class=\"number\">0</span>(fun) (<span class=\"number\">00401005</span>)</span><br><span class=\"line\"><span class=\"number\">00401083</span> <span class=\"number\">83</span> C4 <span class=\"number\">0</span>C             add         esp,<span class=\"number\">0</span>Ch</span><br><span class=\"line\"></span><br><span class=\"line\">结构体作为参数时传的是结构体的副本，应该使用结构体指针</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Max</span><span class=\"params\">(haha* sb)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span>(sb-&gt;x &gt; sb-&gt;y);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//结构体指针用-&gt;取结构体的成员</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">haha</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">\t<span class=\"type\">int</span> z;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Max</span><span class=\"params\">(haha* sb)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(sb-&gt;x &gt; sb-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//结构体中不计算函数的大小</span></span><br><span class=\"line\"><span class=\"comment\">//函数在结构体里时会默认传递一个参数，即结构体的首地址，放在ECX中，用于标识成员在那个对象中</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//当参数和变量同名时使用this</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>-&gt;x = x;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>-&gt;y = y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//返回当前对象首地址</span></span><br><span class=\"line\"><span class=\"keyword\">return</span> *(<span class=\"type\">int</span>*)<span class=\"keyword\">this</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//this不允许重新赋值</span></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230225145426715.png\" alt=\"image-20230225145426715\"></p>\n<p>3. 孔结构体大小是多少</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Cal</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Add</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>-&gt;x + <span class=\"keyword\">this</span>-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Sub</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>-&gt;x - <span class=\"keyword\">this</span>-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Mul</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>-&gt;x * <span class=\"keyword\">this</span>-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Div</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (<span class=\"keyword\">this</span>-&gt;x / <span class=\"keyword\">this</span>-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tCal haha;</span><br><span class=\"line\">\thaha.x = <span class=\"number\">5</span>;</span><br><span class=\"line\">\thaha.y = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a = haha.<span class=\"built_in\">Add</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d \\n&quot;</span>, a);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D768 C7 <span class=\"number\">45</span> F8 <span class=\"number\">05</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-8</span>],<span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D76F C7 <span class=\"number\">45</span> FC <span class=\"number\">02</span> <span class=\"number\">00</span> <span class=\"number\">00</span> <span class=\"number\">00</span> mov         dword ptr [ebp<span class=\"number\">-4</span>],<span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D776 <span class=\"number\">8</span>D <span class=\"number\">4</span>D F8             lea         ecx,[ebp<span class=\"number\">-8</span>]</span><br><span class=\"line\"><span class=\"number\">0040</span>D779 E8 B4 <span class=\"number\">38</span> FF FF       call        @ILT+<span class=\"number\">45</span>(Cal::Add) (<span class=\"number\">00401032</span>)</span><br><span class=\"line\"><span class=\"number\">0040</span>D77E <span class=\"number\">89</span> <span class=\"number\">45</span> F4             mov         dword ptr [ebp<span class=\"number\">-0</span>Ch],eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D781 <span class=\"number\">8B</span> <span class=\"number\">45</span> F4             mov         eax,dword ptr [ebp<span class=\"number\">-0</span>Ch]</span><br><span class=\"line\"><span class=\"number\">0040</span>D784 <span class=\"number\">50</span>                   push        eax</span><br><span class=\"line\"><span class=\"number\">0040</span>D785 <span class=\"number\">68</span> <span class=\"number\">1</span>C <span class=\"number\">20</span> <span class=\"number\">42</span> <span class=\"number\">00</span>       push        offset string <span class=\"string\">&quot;%d %d %d %d\\n&quot;</span> (<span class=\"number\">0042201</span>c)</span><br><span class=\"line\"><span class=\"number\">0040</span>D78A E8 <span class=\"number\">31</span> <span class=\"number\">39</span> <span class=\"function\">FF FF       call        <span class=\"title\">printf</span> <span class=\"params\">(<span class=\"number\">004010</span>c0)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D78F 83 C4 08             add         esp,8</span></span><br><span class=\"line\"><span class=\"function\">0040D792 33 C0                <span class=\"keyword\">xor</span>         eax,eax</span></span><br><span class=\"line\"><span class=\"function\">0040D794 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040D795 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040D796 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040D797 83 C4 4C             add         esp,4Ch</span></span><br><span class=\"line\"><span class=\"function\">0040D79A 3B EC                cmp         ebp,esp</span></span><br><span class=\"line\"><span class=\"function\">0040D79C E8 9F 39 FF FF       call        __<span class=\"title\">chkesp</span> <span class=\"params\">(<span class=\"number\">00401140</span>)</span></span></span><br><span class=\"line\"><span class=\"function\">0040D7A1 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D7A3 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D7A4 C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">0040D80A 89 4D FC             mov         dword ptr [ebp-4],ecx</span></span><br><span class=\"line\"><span class=\"function\">0040D80D 8B 45 FC             mov         eax,dword ptr [ebp-4]</span></span><br><span class=\"line\"><span class=\"function\">0040D810 8B 00                mov         eax,dword ptr [eax]</span></span><br><span class=\"line\"><span class=\"function\">0040D812 8B 4D FC             mov         ecx,dword ptr [ebp-4]</span></span><br><span class=\"line\"><span class=\"function\">0040D815 03 41 04             add         eax,dword ptr [ecx+4]</span></span><br><span class=\"line\"><span class=\"function\">0040D818 5F                   pop         edi</span></span><br><span class=\"line\"><span class=\"function\">0040D819 5E                   pop         esi</span></span><br><span class=\"line\"><span class=\"function\">0040D81A 5B                   pop         ebx</span></span><br><span class=\"line\"><span class=\"function\">0040D81B 8B E5                mov         esp,ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D81D 5D                   pop         ebp</span></span><br><span class=\"line\"><span class=\"function\">0040D81E C3                   ret</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//空结构体大小为1，如果没有成员变量只有成员函数，那么大小也是1</span></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Cal</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Add</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Sub</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Mul</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Div</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d \\n&quot;</span>, <span class=\"built_in\">sizeof</span>(Cal));   <span class=\"comment\">//1</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Cal</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Add</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Sub</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Mul</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">3</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Div</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">4</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d \\n&quot;</span>, <span class=\"built_in\">sizeof</span>(Cal));   <span class=\"comment\">//1</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//入栈顺序从右到左</span></span><br><span class=\"line\"><span class=\"comment\">//最后在把this使用ecx传参</span></span><br><span class=\"line\"><span class=\"comment\">//采用内平栈</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Cal</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">\t<span class=\"type\">int</span> z;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">init</span><span class=\"params\">(<span class=\"type\">int</span> x,<span class=\"type\">int</span> y, <span class=\"type\">int</span> z)</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;x = x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;y = y;\t\t</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;z = z;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tCal haha;</span><br><span class=\"line\">\thaha.<span class=\"built_in\">init</span>(<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//printf(&quot;%d \\n&quot;, a);</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D768 <span class=\"number\">6</span>A <span class=\"number\">05</span>                push        <span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D76A <span class=\"number\">6</span>A <span class=\"number\">04</span>                push        <span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D76C <span class=\"number\">6</span>A <span class=\"number\">03</span>                push        <span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">0040</span>D76E <span class=\"number\">8</span>D <span class=\"number\">4</span>D F4             lea         ecx,[ebp<span class=\"number\">-0</span>Ch]</span><br><span class=\"line\"><span class=\"number\">0040</span>D771 E8 C1 <span class=\"number\">38</span> FF FF       call        @ILT+<span class=\"number\">50</span>(Cal::init) (<span class=\"number\">00401037</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">0040</span>D7C9 <span class=\"number\">5B</span>                   pop         ebx</span><br><span class=\"line\"><span class=\"number\">0040</span>D7CA <span class=\"number\">8B</span> E5                mov         esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7CC <span class=\"number\">5</span>D                   pop         ebp</span><br><span class=\"line\"><span class=\"number\">0040</span>D7CD C2 <span class=\"number\">0</span>C <span class=\"number\">00</span>             ret         <span class=\"number\">0</span>Ch</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"构造函数\"><a class=\"markdownIt-Anchor\" href=\"#构造函数\">#</a> 构造函数</h3>\n<p>1. 没有返回值</p>\n<p>2. 根类同名</p>\n<p>3. 在创建对象的时候调用</p>\n<p>可以重载构造函数，但参数不能完全一样</p>\n<p>成员函数也可以重载，名字一样，参数类型或者个数不一样</p>\n<h3 id=\"析构函数\"><a class=\"markdownIt-Anchor\" href=\"#析构函数\">#</a> 析构函数</h3>\n<p>堆是动态分配，自己申请自己释放</p>\n<p>析构函数不能重载</p>\n<p>不能有任何参数</p>\n<p>不能有返回值</p>\n<p>用于清理工作</p>\n<p>不一定一定要有</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Person</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">\t<span class=\"type\">char</span>* arr;</span><br><span class=\"line\">\t<span class=\"built_in\">Person</span>(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;x = x;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;y = y;</span><br><span class=\"line\">\t\tarr = (<span class=\"type\">char</span>*)<span class=\"built_in\">malloc</span>(<span class=\"number\">100</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t~<span class=\"built_in\">Person</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">free</span>(arr);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"继承\"><a class=\"markdownIt-Anchor\" href=\"#继承\">#</a> 继承</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct Man</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct Mankind:Man</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">int main()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tMankind m;</span><br><span class=\"line\">\tm.a = 1;</span><br><span class=\"line\">\tm.d = 2;</span><br><span class=\"line\">    std::cout &lt;&lt; &quot;Hello World!\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">上面的代码反汇编时和: 一样</span><br><span class=\"line\">struct Mankind</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>继承就是数据复制</p>\n<p>减少重复代码</p>\n<p>父类 基类</p>\n<p>子类 派生类</p>\n<p>可以用父类的指针访问子类的对象，但该指针不能访问子类特有的成员</p>\n<p>子类的指针访问父类的对象需要强转，但可能会访问到父类不存在的对象</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Man</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a;</span><br><span class=\"line\">\t<span class=\"type\">int</span> b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">struct</span> <span class=\"title class_\">Mankind</span>:Man</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> c;</span><br><span class=\"line\">\t<span class=\"type\">int</span> d;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">fun</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tMan n;</span><br><span class=\"line\">\tMankind m;</span><br><span class=\"line\"></span><br><span class=\"line\">\tMan* haha = &amp;m;</span><br><span class=\"line\">\tMankind* xixi = (Mankind*)&amp;n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">fun</span>();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>多层继承时会计算所有成员变量的大小</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct B:A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct C:B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint e;</span><br><span class=\"line\">\tint f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void fun()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tC c;</span><br><span class=\"line\">\tA* pa = &amp;c;</span><br><span class=\"line\">\tB* pb = &amp;c;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tsizeof(c);  //24</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct B:A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct C:B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint e;</span><br><span class=\"line\">\tint f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">void fun()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tC c;</span><br><span class=\"line\">\tc.A::a = 1;</span><br><span class=\"line\">\tc.B::a = 2;</span><br><span class=\"line\">\t//不指定空间全部按照子类处理</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>多重继承</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint c;</span><br><span class=\"line\">\tint d;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct C:A,B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint e;</span><br><span class=\"line\">\tint f;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">sizeof()  //24</span><br></pre></td></tr></table></figure>\n<p>多重继承增加了程序的复杂度，容易出错</p>\n<p>微软建议使用单继承，如果需要多重继承可以改为多层继承</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230226151844722.png\" alt=\"image-20230226151844722\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230226152028331.png\" alt=\"image-20230226152028331\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct DateInfo</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint year;</span><br><span class=\"line\">\tint month;</span><br><span class=\"line\">\tint day;</span><br><span class=\"line\">\tDateInfo(int x, int y, int z)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tthis-&gt;year = x;</span><br><span class=\"line\">\t\tthis-&gt;month = y;</span><br><span class=\"line\">\t\tthis-&gt;day = z;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDateInfo()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tthis-&gt;year = 2015;</span><br><span class=\"line\">\t\tthis-&gt;month = 4;</span><br><span class=\"line\">\t\tthis-&gt;day = 2;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvoid SetDay(int day)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tthis-&gt;day = day;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tint GetDay()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tprintf(&quot;%d\\n&quot;, this-&gt;day);</span><br><span class=\"line\">\t\treturn this-&gt;day;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">struct TimeInfo:DateInfo</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint hours;</span><br><span class=\"line\">\tint minutes;</span><br><span class=\"line\">\tint seconds;</span><br><span class=\"line\">\tTimeInfo(int x, int y, int z)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tthis-&gt;hours = x;</span><br><span class=\"line\">\t\tthis-&gt;minutes = y;</span><br><span class=\"line\">\t\tthis-&gt;seconds = z;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tint GetHour()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; this-&gt;hours &lt;&lt; &quot; \\n&quot;;</span><br><span class=\"line\">\t\treturn this-&gt;hours;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void func1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tDateInfo d;</span><br><span class=\"line\">\tTimeInfo t(1,2,3);</span><br><span class=\"line\"></span><br><span class=\"line\">\tDateInfo* date = &amp;t;</span><br><span class=\"line\">\tTimeInfo* time = &amp;t;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::cout &lt;&lt; date-&gt;day &lt;&lt; &quot; &quot; &lt;&lt; time-&gt;hours &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">struct MyString</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tchar* arr;</span><br><span class=\"line\">\tMyString()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tarr = (char*)malloc(1024);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tMyString(int length)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tarr = (char*)malloc(length);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t~MyString()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tfree(arr);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvoid SetString(char* str)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tint i = 0;</span><br><span class=\"line\">\t\tint length = strlen(str);</span><br><span class=\"line\">\t\twhile(str[i] != 0 &amp;&amp; length&gt;0)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tarr[i] = str[i];</span><br><span class=\"line\">\t\t\ti++;</span><br><span class=\"line\">\t\t\tlength--;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tarr[i] = &#x27;\\0&#x27;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvoid PrintString()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tint i = 0;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\twhile(arr[i] != 0)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tprintf(&quot;%c&quot;, arr[i]);</span><br><span class=\"line\">\t\t\ti++;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\tprintf(&quot;\\n&quot;,i);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvoid AppendString(char* str2)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstrcat(arr, str2);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvoid Size()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; strlen(arr) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\tMyString string1;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.SetString(&quot;woshishabi&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.PrintString();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.AppendString(&quot;haha&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.PrintString();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.Size();</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tprintf(&quot;Hello World!\\n&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//formbase.h</span><br><span class=\"line\">class formbase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\"></span><br><span class=\"line\">\tformbase();</span><br><span class=\"line\">\t~formbase();</span><br><span class=\"line\"></span><br><span class=\"line\">\tvoid fun1();</span><br><span class=\"line\">\tvoid fun2();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">//formbase.cpp</span><br><span class=\"line\">#include &quot;formbase.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">formbase::formbase()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">formbase::~formbase()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void formbase::fun1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void formbase::fun2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>1、xxx.h 只是一个文件，可以是任何的后缀名，如果你愿意，可以叫 xxx.exe</p>\n<p>2、#include 的作用只是把里面的内容复制过来仅此而已。如: #include “abc.exe”</p>\n<p>3、xxx.h 与 xxx.cpp 并不要求一定同名</p>\n<h3 id=\"权限控制\"><a class=\"markdownIt-Anchor\" href=\"#权限控制\">#</a> 权限控制</h3>\n<p>public 的意思是，这个成员哪里都可以用，不用担心被修改，所以，一旦发布成 public 的成员，是不能够改名字的.</p>\n<p>private 的意思是，这个成员只用于内部使用，不要在其他的地方使用.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">struct Person</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tvoid fun1();</span><br><span class=\"line\">\tvoid fun2();</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>1、对外提供的函数或者变量，发布成 public 的但不能随意改动.</p>\n<p>2、可能会变动的函数或者变量，定义成 private 的这样编译器会在使用的时候做检测.</p>\n<p>3、只有结构体内部的函数才可以访问 private 的成员.</p>\n<p>4、public/private 可以修饰函数也可以修饰变量.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//通过指针强制访问private</span><br><span class=\"line\">void haha()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPerson p;</span><br><span class=\"line\">\tp.init(45, 67);</span><br><span class=\"line\">\tint* x = (int*)&amp;p;</span><br><span class=\"line\">\tint m = *(x + 0);</span><br><span class=\"line\">\tint n = *(x + 1);</span><br><span class=\"line\">\tstd::cout &lt;&lt; m &lt;&lt; &quot; &quot; &lt;&lt; n &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>struct 中默认全是 public</p>\n<p>class 中默认全是 private</p>\n<p><strong>class 继承时会将原来的 public 变为 private，如果想要保持 pubic，需要 <code>class Sub:public Person</code> </strong></p>\n<p>构造时先构造父类，在构造子类，因为需要继承构造之后的子类</p>\n<p>没有构造函数的时候系统会给一个默认的构造函数，</p>\n<p>public 继承会复制父类私有的成员，但无法直接使用，需要通过指针访问</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class shabi</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tshabi()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\ta= 99;</span><br><span class=\"line\">\t\tb= 88;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tint a;</span><br><span class=\"line\">\tint b;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">class zhizhang:public shabi</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void xixi()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tzhizhang zz;</span><br><span class=\"line\">\tzz.x = 77;</span><br><span class=\"line\">\tzz.y = 66;</span><br><span class=\"line\">\tint *q = (int*)&amp;zz;</span><br><span class=\"line\">\tstd::cout &lt;&lt; *(q+0) &lt;&lt; &quot; &quot; &lt;&lt; *(q+1) &lt;&lt; &quot; &quot; &lt;&lt; *(q+2) &lt;&lt; &quot; &quot; &lt;&lt; *(q+3) &lt;&lt; &quot; \\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//99 88 77 66 </span><br></pre></td></tr></table></figure>\n<p>将上一节课的所有练习改为 class 实现</p>\n<p>1、添加 private/public 进行权限控制.</p>\n<p>2、将类的定义与实现分开来写：定义写到 xxx.h 中函数实现写在 xx.x…cpp 中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//xixixi.h</span><br><span class=\"line\">class MyString</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tMyString();</span><br><span class=\"line\">\tMyString(int length);</span><br><span class=\"line\">\t~MyString();</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tchar* arr;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tvoid SetString(char* str);</span><br><span class=\"line\">\tvoid PrintString();</span><br><span class=\"line\">\tvoid AppendString(char* str2);</span><br><span class=\"line\">\tvoid Size();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">//xixixi.cpp</span><br><span class=\"line\">MyString::MyString()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tarr = (char*)malloc(1024);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">MyString::MyString(int length)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tarr = (char*)malloc(length);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">MyString::~MyString()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tfree(arr);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void MyString::SetString(char* str)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    int i = 0;</span><br><span class=\"line\">    int length = strlen(str);</span><br><span class=\"line\">    while(str[i] != 0 &amp;&amp; length&gt;0)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        arr[i] = str[i];</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">        length--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    arr[i] = &#x27;\\0&#x27;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void MyString::PrintString()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    int i = 0;</span><br><span class=\"line\"></span><br><span class=\"line\">    while(arr[i] != 0)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        printf(&quot;%c&quot;, arr[i]);</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    printf(&quot;\\n&quot;,i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void MyString::AppendString(char* str2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tstrcat(arr, str2);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void MyString::Size()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tstd::cout &lt;&lt; strlen(arr) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\"></span><br><span class=\"line\">\tMyString string1;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.SetString(&quot;woshishabi&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.PrintString();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.AppendString(&quot;haha&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.PrintString();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstring1.Size();</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tprintf(&quot;Hello World!\\n&quot;);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"虚函数表\"><a class=\"markdownIt-Anchor\" href=\"#虚函数表\">#</a> 虚函数表</h3>\n<p>直接调用和间接调用</p>\n<p>直接调用 call 地址 E8 …</p>\n<p>间接调用 call […]  FF …</p>\n<p>虚函数通过对象调用时和普通函数没有区别</p>\n<p>虚函数通过指针调用时是间接调用的</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Test</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> x;</span><br><span class=\"line\">    <span class=\"type\">int</span> y;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func1</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; <span class=\"string\">&quot;Hello World 111 !\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"type\">void</span> <span class=\"title\">func2</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; <span class=\"string\">&quot;Hello World! 222 \\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tTest t;</span><br><span class=\"line\">\tTest* pt = &amp;t;</span><br><span class=\"line\">\tpt-&gt;<span class=\"built_in\">func1</span>();</span><br><span class=\"line\">\tpt-&gt;<span class=\"built_in\">func2</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;Hello World!\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">00401398</span> <span class=\"number\">8</span>D <span class=\"number\">4</span>D FC             lea         ecx,[ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040139B</span> E8 F1 FC FF FF       call        @ILT+<span class=\"number\">140</span>(Test::Test) (<span class=\"number\">00401091</span>)</span><br><span class=\"line\"><span class=\"number\">24</span>:       Test* pt = &amp;t;</span><br><span class=\"line\"><span class=\"number\">004013</span>A0 <span class=\"number\">8</span>D <span class=\"number\">45</span> FC             lea         eax,[ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">004013</span>A3 <span class=\"number\">89</span> <span class=\"number\">45</span> F8             mov         dword ptr [ebp<span class=\"number\">-8</span>],eax</span><br><span class=\"line\"><span class=\"number\">25</span>:       pt-&gt;<span class=\"built_in\">func1</span>();</span><br><span class=\"line\"><span class=\"number\">004013</span>A6 <span class=\"number\">8B</span> <span class=\"number\">4</span>D F8             mov         ecx,dword ptr [ebp<span class=\"number\">-8</span>]</span><br><span class=\"line\"><span class=\"number\">004013</span>A9 E8 <span class=\"number\">61</span> FC FF FF       call        @ILT+<span class=\"number\">10</span>(Test::func1) (<span class=\"number\">0040100f</span>)</span><br><span class=\"line\"><span class=\"number\">26</span>:       pt-&gt;<span class=\"built_in\">func2</span>();</span><br><span class=\"line\"><span class=\"number\">004013</span>AE <span class=\"number\">8B</span> <span class=\"number\">4</span>D F8             mov         ecx,dword ptr [ebp<span class=\"number\">-8</span>]</span><br><span class=\"line\"><span class=\"number\">004013B</span>1 <span class=\"number\">8B</span> <span class=\"number\">11</span>                mov         edx,dword ptr [ecx]</span><br><span class=\"line\"><span class=\"number\">004013B</span>3 <span class=\"number\">8B</span> F4                mov         esi,esp</span><br><span class=\"line\"><span class=\"number\">004013B</span>5 <span class=\"number\">8B</span> <span class=\"number\">4</span>D F8             mov         ecx,dword ptr [ebp<span class=\"number\">-8</span>]</span><br><span class=\"line\"><span class=\"number\">004013B</span>8 FF <span class=\"number\">12</span>                call        dword ptr [edx]</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"built_in\">sizeof</span>(Test) = <span class=\"number\">12</span>;</span><br><span class=\"line\">虚函数 + <span class=\"number\">4</span>字节，不管有多少虚函数，他指向一个数组，数组中存储对象中所有虚函数地址</span><br><span class=\"line\">虚函数表在对象的首地址，是一个四字节的地址 </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230228161556184.png\" alt=\"image-20230228161556184\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;333\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">class Sub :Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func4()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;444\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func5()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;555\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func6()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;666\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">//打印Sub虚函数表，画图</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Base* bp1 = &amp;base;</span><br><span class=\"line\">Base* bp2 = (Base*)&amp;sub;</span><br><span class=\"line\">printf(&quot;%X\\n&quot;,bp1);</span><br><span class=\"line\">printf(&quot;%X\\n&quot;,bp2);</span><br><span class=\"line\"></span><br><span class=\"line\">printf(&quot;%X\\n&quot;, *(((int*)bp1) + 0));</span><br><span class=\"line\">printf(&quot;%X\\n&quot;, *(((int*)bp1) + 1));</span><br><span class=\"line\"></span><br><span class=\"line\">printf(&quot;%X\\n&quot;, *(((int*)bp2) + 0));</span><br><span class=\"line\">printf(&quot;%X\\n&quot;, *(((int*)bp2) + 1));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">18FF44</span><br><span class=\"line\">18FF40</span><br><span class=\"line\">432020</span><br><span class=\"line\">18FF88</span><br><span class=\"line\">432048</span><br><span class=\"line\">432020</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">0018FF38  40 FF 18 00  @...  //sub</span><br><span class=\"line\">0018FF3C  44 FF 18 00  D...  //Base</span><br><span class=\"line\">0018FF40  48 20 43 00  H C.  //sub虚表</span><br><span class=\"line\">0018FF44  20 20 43 00    C.</span><br><span class=\"line\">0018FF48  88 FF 18 00  ....  //ebp</span><br><span class=\"line\"></span><br><span class=\"line\">00432020  05 10 40 00  ..@.</span><br><span class=\"line\">00432024  78 10 40 00  x.@.</span><br><span class=\"line\">00432028  96 10 40 00  ..@.</span><br><span class=\"line\">0043202C  00 00 00 00  ....</span><br><span class=\"line\">00432030  31 31 31 0A  111.</span><br><span class=\"line\">00432034  00 00 00 00  ....</span><br><span class=\"line\">00432038  32 32 32 0A  222.</span><br><span class=\"line\">0043203C  00 00 00 00  ....</span><br><span class=\"line\">00432040  33 33 33 0A  333.</span><br><span class=\"line\">00432044  00 00 00 00  ....</span><br><span class=\"line\">00432048  05 10 40 00  ..@.</span><br><span class=\"line\">0043204C  78 10 40 00  x.@.</span><br><span class=\"line\">00432050  96 10 40 00  ..@.</span><br><span class=\"line\">00432054  69 10 40 00  i.@.</span><br><span class=\"line\">00432058  C3 10 40 00  ..@.</span><br><span class=\"line\">0043205C  14 10 40 00  ..@.</span><br><span class=\"line\">00432060  00 00 00 00  ....</span><br><span class=\"line\">00432064  34 34 34 0A  444.</span><br><span class=\"line\">00432068  00 00 00 00  ....</span><br><span class=\"line\">0043206C  35 35 35 0A  555.</span><br><span class=\"line\">00432070  00 00 00 00  ....</span><br><span class=\"line\">00432074  36 36 36 0A  666.</span><br><span class=\"line\">00432078  00 00 00 00  ....</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tBase base;</span><br><span class=\"line\">\tSub sub;</span><br><span class=\"line\"></span><br><span class=\"line\">\tBase* bp1 = &amp;base;</span><br><span class=\"line\">\tBase* bp2 = (Base*)&amp;sub;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttypedef void(*pFunc)(void);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpFunc ppp;</span><br><span class=\"line\"></span><br><span class=\"line\">\tppp = (pFunc)*((int*)(*(int*)(bp1)+0)+0);   //取值范围bp1+0+0 - bp1+0+2   111-333</span><br><span class=\"line\">\tppp = (pFunc)*((int*)(*(int*)(bp2)+0)+3);   //取值范围bp2+0+0 - bp2+0+5   111-666</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tppp();</span><br><span class=\"line\">\t</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230228181939235.png\" alt=\"image-20230228181939235\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;333\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">class Sub :Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;sub:111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;Sub:222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func6()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;666\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">//打印Sub虚函数表，画图</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">0018FF38  40 FF 18 00  @...  //sub</span><br><span class=\"line\">0018FF3C  44 FF 18 00  D...  //Base</span><br><span class=\"line\">0018FF40  48 20 43 00  H C.  //sub虚表</span><br><span class=\"line\">0018FF44  20 20 43 00    C.</span><br><span class=\"line\">0018FF48  88 FF 18 00  ....  //ebp</span><br><span class=\"line\"></span><br><span class=\"line\">0432020  0A 10 40 00  ..@.</span><br><span class=\"line\">00432024  7D 10 40 00  &#125;.@.</span><br><span class=\"line\">00432028  9B 10 40 00  ..@.</span><br><span class=\"line\">0043202C  00 00 00 00  ....</span><br><span class=\"line\">00432030  31 31 31 0A  111.</span><br><span class=\"line\">00432034  00 00 00 00  ....</span><br><span class=\"line\">00432038  32 32 32 0A  222.</span><br><span class=\"line\">0043203C  00 00 00 00  ....</span><br><span class=\"line\">00432040  33 33 33 0A  333.</span><br><span class=\"line\">00432044  00 00 00 00  ....</span><br><span class=\"line\">00432048  1E 10 40 00  ..@.</span><br><span class=\"line\">0043204C  3C 10 40 00  &lt;.@.</span><br><span class=\"line\">00432050  9B 10 40 00  ..@.</span><br><span class=\"line\">00432054  05 10 40 00  ..@.</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tBase base;</span><br><span class=\"line\">\tSub sub;</span><br><span class=\"line\"></span><br><span class=\"line\">\tBase* bp1 = &amp;base;</span><br><span class=\"line\">\tBase* bp2 = (Base*)&amp;sub;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttypedef void(*pFunc)(void);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpFunc ppp;</span><br><span class=\"line\"></span><br><span class=\"line\">\tppp = (pFunc)*((int*)(*(int*)(bp1)+0)+0);   //取值范围bp1+0+0 - bp1+0+2   111-333</span><br><span class=\"line\">\tppp = (pFunc)*((int*)(*(int*)(bp2)+0)+3);   //取值范围bp2+0+0 - bp2+0+3   sub111-sub222-333-666</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tppp();</span><br><span class=\"line\">\t</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>多继承</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;333\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func4()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;444\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class C:A,B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func5()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;555\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func6()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;666\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">sizeof(C) = 8;</span><br><span class=\"line\">有几个直接分类就有几个虚函数表</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301140806277.png\" alt=\"image-20230301140806277\"></p>\n<p>多重继承有覆盖</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;333\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func4()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;444\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class C:A,B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;sub:555\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;sub:666\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t\tvirtual void func7()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;77\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">sizeof(C) = 8;</span><br><span class=\"line\">有几个直接分类就有几个虚函数表</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func1()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;111\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func2()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;222\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class B:A</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func3()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;333\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func4()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;444\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">class C: B</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tvirtual void func5()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;555\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tvirtual void func6()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; &quot;666\\n&quot;;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"动态绑定\"><a class=\"markdownIt-Anchor\" href=\"#动态绑定\">#</a> 动态绑定</h3>\n<p>编译器确定的成为前期或者编译器绑定</p>\n<p>调用时再知道地址的成为运行期绑定 / 动态绑定 / 晚绑定</p>\n<p>成员变量和普通的成员函数时编译时绑定</p>\n<p>virtual 函数时动态绑定，call 是 FFcall，通过虚表实现</p>\n<p>动态绑定就是多态，相同函数体现出了不同的行为</p>\n<p>多态实现了父类的指针访问子类的方法</p>\n<p>虚析构在继承的时候有用，把父类的析构定义成虚函数，这样子类在析构时不会调用父类的析构</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301150809049.png\" alt=\"image-20230301150809049\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230301150833000.png\" alt=\"image-20230301150833000\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Base</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">\t<span class=\"built_in\">Base</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;x = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;y = <span class=\"number\">2</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d\\n&quot;</span>,<span class=\"keyword\">this</span>-&gt;x,<span class=\"keyword\">this</span>-&gt;y);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Sub1</span>:Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> A;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">Sub1</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;x = <span class=\"number\">3</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;y = <span class=\"number\">4</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;A = <span class=\"number\">5</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,<span class=\"keyword\">this</span>-&gt;x,<span class=\"keyword\">this</span>-&gt;y,<span class=\"keyword\">this</span>-&gt;A);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Sub2</span>:Base</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> B;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">Sub2</span>()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;x = <span class=\"number\">6</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;y = <span class=\"number\">7</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">this</span>-&gt;B = <span class=\"number\">8</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d %d %d\\n&quot;</span>,<span class=\"keyword\">this</span>-&gt;x,<span class=\"keyword\">this</span>-&gt;y,<span class=\"keyword\">this</span>-&gt;B);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tBase b;</span><br><span class=\"line\">\tSub1 s1;</span><br><span class=\"line\">\tSub2 s2;</span><br><span class=\"line\">\tBase* arr[] = &#123;&amp;b,(Base*)&amp;s1,(Base*)&amp;s2&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">3</span>;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tarr[i]-&gt;<span class=\"built_in\">print</span>();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Hello World!\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//如果Base的print存在virtual，那么结果为1 2  3 4 5  6 7 8，可以使用父类的指针访问子类的print</span></span><br><span class=\"line\"><span class=\"comment\">//如果没有virtual,那么结果为1 2  3 4  6 7，调用的都是父类的方法</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Animal</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">virtual</span> <span class=\"type\">void</span> <span class=\"title\">sing</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tstd::cout&lt;&lt; <span class=\"string\">&quot;nishishabi&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Dog</span>:<span class=\"keyword\">public</span> Animal</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">sing</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tstd::cout&lt;&lt; <span class=\"string\">&quot;wangwang&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Cat</span>:<span class=\"keyword\">public</span> Animal</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">sing</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\">\t\tstd::cout&lt;&lt; <span class=\"string\">&quot;miaomiao!!!&quot;</span> &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tDog d;</span><br><span class=\"line\"></span><br><span class=\"line\">\tAnimal* a = (Animal*)&amp;d;</span><br><span class=\"line\">\ta-&gt;<span class=\"built_in\">sing</span>();   <span class=\"comment\">//if virtual exists,print wangwang,else print nishishabi</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"模板\"><a class=\"markdownIt-Anchor\" href=\"#模板\">#</a> 模板</h3>\n<p>函数模板</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">sort</span><span class=\"params\">(T arr, <span class=\"type\">int</span> nLength)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> k=<span class=\"number\">0</span>; k&lt;nLength<span class=\"number\">-1</span>; k++)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;nLength-k<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(arr[i]&gt;arr[i+<span class=\"number\">1</span>])</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                T temp = arr[i];</span><br><span class=\"line\">                arr[i] = arr[i+<span class=\"number\">1</span>];</span><br><span class=\"line\">                arr[i+<span class=\"number\">1</span>] = temp;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>, <span class=\"keyword\">class</span> <span class=\"title class_\">E</span>&gt;</span><br><span class=\"line\"><span class=\"comment\">//T和E是两个不同的类型，T是int* E是int</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">Find</span><span class=\"params\">(T arr, <span class=\"type\">int</span> nLength, E nElement)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> nBegin = <span class=\"number\">0</span>, nEnd = nLength - <span class=\"number\">1</span>, nIndex;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (nBegin &lt;= nEnd)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tnIndex = (nBegin + nEnd) / <span class=\"number\">2</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (nElement &gt; arr[nIndex])</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tnBegin = nIndex + <span class=\"number\">1</span>;</span><br><span class=\"line\">;\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (nElement &lt; arr[nIndex])</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tnEnd = nIndex - <span class=\"number\">1</span>;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> nIndex;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">-1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>类模板</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>, <span class=\"keyword\">class</span> <span class=\"title class_\">M</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">MyClass</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\">T <span class=\"title\">Max</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"function\">M <span class=\"title\">Min</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\">\t</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\tT x;</span><br><span class=\"line\">\tT y;</span><br><span class=\"line\">\tM a;</span><br><span class=\"line\">\tM b;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230302153313237.png\" alt=\"image-20230302153313237\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>, <span class=\"keyword\">class</span> <span class=\"title class_\">E</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">swap</span><span class=\"params\">(T x, T y, E sb)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tE temp = *x;</span><br><span class=\"line\">\t*x = *y;</span><br><span class=\"line\">\t*y = temp;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">double</span> a = <span class=\"number\">4.45</span>, b = <span class=\"number\">8.99</span>, c;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::cout &lt;&lt; a &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; b &lt;&lt; <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">swap</span>(&amp;a,&amp;b,c);</span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::cout &lt;&lt; a &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; b &lt;&lt; <span class=\"string\">&#x27;\\n&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;Hello World!\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Base</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span> &lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>, <span class=\"keyword\">class</span> <span class=\"title class_\">E</span>&gt;</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">sort</span><span class=\"params\">(T arr, <span class=\"type\">int</span> nLength, E sb)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> k = <span class=\"number\">0</span>; k &lt; nLength - <span class=\"number\">1</span>; k++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; nLength - k - <span class=\"number\">1</span>; i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">            <span class=\"comment\">//class Base&#x27; does not define this operator or a conversion to a type acceptable to the predefined operator</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (*arr[i] &gt; *arr[i + <span class=\"number\">1</span>])</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tE temp = *arr[i];</span><br><span class=\"line\">\t\t\t\t*arr[i] = *arr[i + <span class=\"number\">1</span>];</span><br><span class=\"line\">\t\t\t\t*arr[i + <span class=\"number\">1</span>] = *temp;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tBase b1, b2, b3, b4, b5;</span><br><span class=\"line\">\tBase* arr1[<span class=\"number\">5</span>] = &#123; &amp;b1, &amp;b2, &amp;b3, &amp;b4, &amp;b5 &#125;;</span><br><span class=\"line\">\t<span class=\"built_in\">sort</span>(arr1, <span class=\"number\">5</span>, &amp;b1);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span>(<span class=\"type\">int</span> i=<span class=\"number\">0</span>;i&lt;<span class=\"number\">5</span>;i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>,arr1[i]);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    std::cout &lt;&lt; <span class=\"string\">&quot;Hello World!\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br></pre></td></tr></table></figure>\n<h3 id=\"引用类型\"><a class=\"markdownIt-Anchor\" href=\"#引用类型\">#</a> 引用类型</h3>\n<p>指针传递的时候指针可以修改</p>\n<p>能使用指针的就能使用引用</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Test</span><span class=\"params\">(<span class=\"type\">int</span>&amp; x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tx = <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Test2</span><span class=\"params\">(<span class=\"type\">int</span>* x)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t*x = <span class=\"number\">10086</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> a = <span class=\"number\">100</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">Test</span>(a);</span><br><span class=\"line\">\tstd::cout&lt;&lt; a &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;  <span class=\"comment\">//1</span></span><br><span class=\"line\">\t<span class=\"built_in\">Test2</span>(&amp;a);</span><br><span class=\"line\">\tstd::cout&lt;&lt; a &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;  <span class=\"comment\">//10086</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"number\">174</span>:      <span class=\"built_in\">Test</span>(a);</span><br><span class=\"line\"><span class=\"number\">0040181F</span> <span class=\"number\">8</span>D <span class=\"number\">45</span> FC             lea         eax,[ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">00401822</span> <span class=\"number\">50</span>                   push        eax</span><br><span class=\"line\"><span class=\"number\">00401823</span> E8 <span class=\"number\">04</span> F9 FF FF       call        @ILT+<span class=\"number\">295</span>(Test) (<span class=\"number\">0040112</span>c)</span><br><span class=\"line\"><span class=\"number\">00401828</span> <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">176</span>:      <span class=\"built_in\">Test2</span>(&amp;a);</span><br><span class=\"line\"><span class=\"number\">00401847</span> <span class=\"number\">8</span>D <span class=\"number\">55</span> FC             lea         edx,[ebp<span class=\"number\">-4</span>]</span><br><span class=\"line\"><span class=\"number\">0040184</span>A <span class=\"number\">52</span>                   push        edx</span><br><span class=\"line\"><span class=\"number\">0040184B</span> E8 E0 F9 FF FF       call        @ILT+<span class=\"number\">555</span>(Test2) (<span class=\"number\">00401230</span>)</span><br><span class=\"line\"><span class=\"number\">00401850</span> <span class=\"number\">83</span> C4 <span class=\"number\">04</span>             add         esp,<span class=\"number\">4</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>引用和指针在汇编是一样的，都是 lea，但编译器不允许引用再指向别的地方</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1、引用类型是C++里面的类型</span><br><span class=\"line\">2、引用类型只能赋值一次，不能重新赋值</span><br><span class=\"line\">3、引用只是变量的一个别名.</span><br><span class=\"line\">4、引用可以理解成是编译器维护的一个指针，但并不占用空间(如何去理解这句话?).</span><br><span class=\"line\">5、使用引用可以像指针那样去访问、修改对象的内容，但更加安全.</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>2、从反汇编的角度说说引用与指针的区  参数传递，读写变量</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int sb = 100;</span><br><span class=\"line\">const int&amp; x = sb;</span><br><span class=\"line\">std::cout&lt;&lt; x &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">sb = 15;</span><br><span class=\"line\">std::cout&lt;&lt; x &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\"></span><br><span class=\"line\">x = 13;  //error</span><br><span class=\"line\">std::cout&lt;&lt; x &lt;&lt; &quot;\\n&quot;;</span><br></pre></td></tr></table></figure>\n<p><a href=\"https://blog.csdn.net/kingcat666/article/details/44852565\">C<ins> 中引用（&amp;）的用法和拷贝 / 赋值函数的区别_c</ins> 拷贝和引用的区别_Zenhobby 的博客 - CSDN 博客</a></p>\n<p>可以参考一下上面的连接，对但不完全对</p>\n<h3 id=\"友元函数\"><a class=\"markdownIt-Anchor\" href=\"#友元函数\">#</a> 友元函数</h3>\n<p>让类外面的方法也可以访问类中的私有成员</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Person</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tPerson(int x, int y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tthis-&gt;x = x;</span><br><span class=\"line\">\t\tthis-&gt;y = y;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t//声明友元函数</span><br><span class=\"line\">\tfriend void Print(const Person&amp; refPer);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">void Print(const Person&amp; refPer)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tstd::cout &lt;&lt; refPer.x;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>友元类让另一个类访问一个类的私有成员</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">什么情况下需要友元函数:</span><br><span class=\"line\">1）运算符重载的某些场合需要使用友元.</span><br><span class=\"line\">2两个类要共享数据的时候.中</span><br><span class=\"line\">友元函数和类的成员函数的区别</span><br><span class=\"line\">(1）成员函数有this指针，而友元函数没有this指针</span><br><span class=\"line\">(2)友元函数是不能被继承的，就像父亲的朋友未必是儿子的朋友</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"运算符重载\"><a class=\"markdownIt-Anchor\" href=\"#运算符重载\">#</a> 运算符重载</h3>\n<p>函数必须返回自己的类型</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Number</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tint x;</span><br><span class=\"line\">\tint y;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tNumber();</span><br><span class=\"line\">\tNumber operator++();</span><br><span class=\"line\">\tNumber operator+(const Number&amp; p);</span><br><span class=\"line\">\t//bool operator&gt;(const Number&amp; p);</span><br><span class=\"line\">\tvoid print();</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">Number::Number()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tthis-&gt;x = 1;</span><br><span class=\"line\">\tthis-&gt;y = 2;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number Number::operator++()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tthis-&gt;x++;</span><br><span class=\"line\">\tthis-&gt;y++;</span><br><span class=\"line\">\treturn *this;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number Number::operator+(const Number&amp; p)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tthis-&gt;x += p.x;</span><br><span class=\"line\">\tthis-&gt;y += p.y;</span><br><span class=\"line\">\t//return Number();</span><br><span class=\"line\">\treturn *this;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void Number::print()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tstd::cout &lt;&lt; this-&gt;x &lt;&lt; &quot; &quot; &lt;&lt; this-&gt;y &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tNumber n;</span><br><span class=\"line\">\tNumber n1;</span><br><span class=\"line\">\tn.print();</span><br><span class=\"line\">\tn = n + n1;</span><br><span class=\"line\">\tn.print();</span><br><span class=\"line\">\tprintf(&quot;Hello World!\\n&quot;);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">. :: ?: sizeof # 不能重载</span><br><span class=\"line\">运算符重载就是函数替换</span><br><span class=\"line\">常用的运算符重载 &lt; &gt; == =</span><br></pre></td></tr></table></figure>\n<p>定义一个类使用友元函数实现重载 operator</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303155110456.png\" alt=\"image-20230303155110456\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230303155158528.png\" alt=\"image-20230303155158528\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">可实现对不同类的操作，不使用友元一定会对<span class=\"keyword\">this</span>操作</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Number</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> x;</span><br><span class=\"line\">\t<span class=\"type\">int</span> y;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">Number</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">Number</span>(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y);</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 1</span></span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>++(Number&amp; p1);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>--(Number&amp; p1);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>+(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>-(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>*(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> Number <span class=\"keyword\">operator</span>/(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> <span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&gt;(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> <span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&lt;(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> <span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&gt;=(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"keyword\">friend</span> <span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&lt;=(Number&amp; p1, Number&amp; p2);</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"keyword\">friend</span> <span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">(Number&amp; p1)</span></span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">(Number&amp; p1)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tstd::cout &lt;&lt; p1.x &lt;&lt; <span class=\"string\">&quot; &quot;</span> &lt;&lt; p1.y &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number::<span class=\"built_in\">Number</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;x = <span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;y = <span class=\"number\">2</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number::<span class=\"built_in\">Number</span>(<span class=\"type\">int</span> x, <span class=\"type\">int</span> y)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;x = x;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;y = y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>++(Number&amp; p1)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x++;</span><br><span class=\"line\">\tp1.y++;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>--(Number&amp; p1)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x--;</span><br><span class=\"line\">\tp1.y--;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>+(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x += p2.x;</span><br><span class=\"line\">\tp1.y += p2.y;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>-(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x -= p2.x;</span><br><span class=\"line\">\tp1.y -= p2.y;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>*(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x *= p2.x;</span><br><span class=\"line\">\tp1.y *= p2.y;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">Number <span class=\"keyword\">operator</span>/(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tp1.x /= p2.x;</span><br><span class=\"line\">\tp1.y /= p2.y;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> p1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&gt;(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (p1.x &gt; p2.x &amp;&amp; p1.y &gt; p2.y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&lt;(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (p1.x &lt; p2.x &amp;&amp; p1.y &lt; p2.y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&gt;=(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (p1.x &gt;= p2.x &amp;&amp; p1.y &gt;= p2.y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">bool</span> <span class=\"keyword\">operator</span>&lt;=(Number&amp; p1, Number&amp; p2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (p1.x &lt;= p2.x &amp;&amp; p1.y &lt;= p2.y)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\tNumber n1;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n1);</span><br><span class=\"line\">\tn1++;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n1);</span><br><span class=\"line\">\tn1--;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n1);</span><br><span class=\"line\">\t<span class=\"function\">Number <span class=\"title\">n2</span><span class=\"params\">(<span class=\"number\">10</span>,<span class=\"number\">11</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Number <span class=\"title\">n3</span><span class=\"params\">(<span class=\"number\">100</span>, <span class=\"number\">200</span>)</span></span>;</span><br><span class=\"line\">\tn2 = n2 + n3;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n2);</span><br><span class=\"line\">\tn2 = n2 - n3;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n2);</span><br><span class=\"line\">\t<span class=\"function\">Number <span class=\"title\">n4</span><span class=\"params\">(<span class=\"number\">100</span>, <span class=\"number\">200</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Number <span class=\"title\">n5</span><span class=\"params\">(<span class=\"number\">10</span>, <span class=\"number\">50</span>)</span></span>;</span><br><span class=\"line\">\tn4 = n4 / n5;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n4);</span><br><span class=\"line\">\tn4 = n4 * n5;</span><br><span class=\"line\">\t<span class=\"built_in\">print</span>(n4);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (n4 &gt; n5)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; <span class=\"string\">&quot;both n4 x&amp;y &gt; n5 \\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (n4 &lt; n5)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tstd::cout &lt;&lt; <span class=\"string\">&quot;both n4 x&amp;y &lt; n5 \\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Hello World!\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"new-delete\"><a class=\"markdownIt-Anchor\" href=\"#new-delete\">#</a> new-delete</h3>\n<p>静态库函数直接编译到 exe 里，dll 在自己模块里</p>\n<p>找 call 时先找函数修改的内存空间，在看哪个 call 改写了这个空间</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">malloc -&gt; _nh_malloc_dbg -&gt; _heap_alloc_dbg -&gt; _heap_alloc_base -&gt; HeapAlloc</span><br><span class=\"line\">free -&gt; free_dbg -&gt; _free_base -&gt; HeapFree</span><br><span class=\"line\">HeapAlloc 和 HeapFree 是Kernel32的 DLL</span><br><span class=\"line\"></span><br><span class=\"line\">new -&gt; _free_dbg -&gt; _nh_malloc_dbg -&gt; _heap_alloc_dbg -&gt; _heap_alloc_base -&gt; HeapAlloc</span><br><span class=\"line\">delete -&gt; free_dbg -&gt; _free_base -&gt; HeapFree</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int* pi = new int;</span><br><span class=\"line\">delete pi;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int* pi = new int(5);   //初始值为5的int</span><br><span class=\"line\"></span><br><span class=\"line\">Person* pa = new Person();</span><br><span class=\"line\"></span><br><span class=\"line\">int* i = new int[5];</span><br><span class=\"line\">delete[] i;</span><br></pre></td></tr></table></figure>\n<h3 id=\"vector\"><a class=\"markdownIt-Anchor\" href=\"#vector\">#</a> Vector</h3>\n<p>1、本质就是一个数组</p>\n<p>2、可以动态扩充容量</p>\n<p>3、支持下标方法，查询性能好</p>\n<p>4、新增数据和删除数据较差</p>\n<p>1、实现一个 Vector 类</p>\n<p>2、读懂每一个方法的反汇编实现</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230304154132126.png\" alt=\"image-20230304154132126\"></p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SUCCESS 1</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> MALLOC_ERROR -2   <span class=\"comment\">//申请内存失败</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> INDEX_ERROR -3     <span class=\"comment\">//失败的索引号</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Vector</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">Vector</span>();</span><br><span class=\"line\">\t<span class=\"built_in\">Vector</span>(DWORD dwSize);</span><br><span class=\"line\">\t~<span class=\"built_in\">Vector</span>();</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">at</span><span class=\"params\">(DWORD dwIndex, OUT T * pEle)</span></span>;   <span class=\"comment\">//根据给定的元素得到索引</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">push_back</span><span class=\"params\">(T Element)</span></span>;    <span class=\"comment\">//将元素存储到容器最后一个位置</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">pop_back</span><span class=\"params\">()</span></span>;   <span class=\"comment\">//删除最后一个元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">insert</span><span class=\"params\">(DWORD dwIndex, T Element)</span></span>;  <span class=\"comment\">//向指定位置新增一个元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">capacity</span><span class=\"params\">()</span></span>;  <span class=\"comment\">//返回在不增容的情况下还能存储多少元素</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>;     <span class=\"comment\">//清空所有元素</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">empty</span><span class=\"params\">()</span></span>;    <span class=\"comment\">//判断vector是否为空，返回true时为空</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">erase</span><span class=\"params\">(DWORD dwIndex)</span></span>;  <span class=\"comment\">//删除指定元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">size</span><span class=\"params\">()</span></span>;  <span class=\"comment\">//返回vector元素数量大小</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">print</span><span class=\"params\">()</span></span>;   <span class=\"comment\">//打印</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">expand</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\tDWORD m_dwIndex;  <span class=\"comment\">//下一个可用索引</span></span><br><span class=\"line\">\tDWORD m_dwIncrement; <span class=\"comment\">//每次新增容大小</span></span><br><span class=\"line\">\tDWORD m_dwLen;   <span class=\"comment\">//当前容器长度</span></span><br><span class=\"line\">\tDWORD m_dwInitSize;  <span class=\"comment\">//默认初始化大小</span></span><br><span class=\"line\">\tT *m_pVector;  <span class=\"comment\">//容器指针</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">Vector&lt;T&gt;::<span class=\"built_in\">Vector</span>():<span class=\"built_in\">m_dwInitSize</span>(<span class=\"number\">100</span>),<span class=\"built_in\">m_dwIncrement</span>(<span class=\"number\">5</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//int* i = new int[5];</span></span><br><span class=\"line\">\t<span class=\"comment\">//创建长度为m_dwInitSize个T对象</span></span><br><span class=\"line\">\tm_pVector = <span class=\"keyword\">new</span> T[m_dwInitSize];</span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(m_pVector, <span class=\"number\">0</span>, m_dwInitSize * <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t<span class=\"comment\">//设置其他值</span></span><br><span class=\"line\">\tm_dwIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tm_dwLen = m_dwInitSize;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">Vector&lt;T&gt;::<span class=\"built_in\">Vector</span>(DWORD dwSize)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//创建长度为dwSize个T对象</span></span><br><span class=\"line\">\tm_pVector = <span class=\"keyword\">new</span> T[dwSize];</span><br><span class=\"line\">\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(m_pVector, <span class=\"number\">0</span>, dwSize * <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t<span class=\"comment\">//设置其他值</span></span><br><span class=\"line\">\tm_dwIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tm_dwLen = dwSize;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">Vector&lt;T&gt;::~<span class=\"built_in\">Vector</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">delete</span>[] m_pVector;</span><br><span class=\"line\">\tm_pVector = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">at</span>(DWORD dwIndex, OUT T* pEle)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//判断索引是否越界</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex &lt; <span class=\"number\">0</span> || dwIndex &gt; m_dwIndex)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//复制到pEle中</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(pEle, &amp;m_pVector[dwIndex], <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">push_back</span>(T Element)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//判断是否需要增容</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_dwIndex &gt;= m_dwLen)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">expand</span>();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//复制到最后一个位置</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(&amp;m_pVector[m_dwIndex], &amp;Element, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\tm_dwIndex++;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">pop_back</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(&amp;m_pVector[m_dwLen - <span class=\"number\">1</span>], <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\tm_dwIndex--;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">insert</span>(DWORD dwIndex, T Element)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//判断合理区间</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex&lt;<span class=\"number\">0</span> || dwIndex&gt;m_dwIndex)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//判断是否需要增容，如果需要就调用增容的函数\t\t\t\t\t\t\t\t\t\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_dwIndex &gt;= m_dwLen)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">expand</span>();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//后移</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = m_dwIndex; i &gt; dwIndex; i--)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>(&amp;m_pVector[i], &amp;m_pVector[i<span class=\"number\">-1</span>], <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//复制</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(&amp;m_pVector[dwIndex], &amp;Element, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//修改其他值</span></span><br><span class=\"line\">\tm_dwIndex++;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">capacity</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m_dwLen - m_dwIndex;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">clear</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(m_pVector, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(T) * m_dwLen);</span><br><span class=\"line\">\tm_dwIndex = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tm_dwLen = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">bool</span> Vector&lt;T&gt;::<span class=\"built_in\">empty</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_dwLen == <span class=\"number\">0</span> &amp; m_dwIndex == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">erase</span>(DWORD dwIndex)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex &gt; m_dwIndex &amp;&amp; dwIndex &lt; <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = dwIndex; i &lt; m_dwLen; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>(&amp;m_pVector[i], &amp;m_pVector[i + <span class=\"number\">1</span>], <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tm_dwIndex--;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD Vector&lt;T&gt;::<span class=\"built_in\">size</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> m_dwLen;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> Vector&lt;T&gt;::<span class=\"built_in\">print</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">int</span> i = <span class=\"number\">0</span>; i &lt; m_dwLen; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; m_pVector[i] &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">bool</span> Vector&lt;T&gt;::<span class=\"built_in\">expand</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tT* newPointer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"comment\">//计算增加后的长度</span></span><br><span class=\"line\">\tDWORD newLen = m_dwIncrement + m_dwLen;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//申请空间</span></span><br><span class=\"line\">\tnewPointer = <span class=\"keyword\">new</span> T[newLen];</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(newPointer, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(T)*newLen);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//数据复制到新空间</span></span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(newPointer, m_pVector, <span class=\"built_in\">sizeof</span>(T)*m_dwLen);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//释放原来空间</span></span><br><span class=\"line\">\t<span class=\"keyword\">delete</span>[] m_pVector;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//属性赋值</span></span><br><span class=\"line\">\tm_pVector = newPointer;</span><br><span class=\"line\">\tnewPointer = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tm_dwLen = newLen;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> 0</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_dwIndex &gt;= m_dwLen) </span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//创建一个新容器</span></span><br><span class=\"line\">\t\tT* p = <span class=\"keyword\">new</span> T[m_dwLen + m_dwIncrement];</span><br><span class=\"line\">\t\t<span class=\"comment\">//复制原来容器元素到新容器</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>(p, m_pVector, <span class=\"built_in\">sizeof</span>(T)*m_dwLen);</span><br><span class=\"line\">\t\t<span class=\"comment\">//删除原数据</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">delete</span>[] m_pVector;</span><br><span class=\"line\">\t\tm_pVector = p;</span><br><span class=\"line\">\t\tm_dwLen = m_dwLen + m_dwIncrement;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;当前容量充足&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"function\">Vector&lt;<span class=\"type\">int</span>&gt; <span class=\"title\">haha</span><span class=\"params\">(<span class=\"number\">5</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"comment\">//for (size_t i = 0; i &lt; haha.size(); i++)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\thaha.insert(i, i);</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//int p = 0;</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.at(50, &amp;p);</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; p &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt;haha.capacity() &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//haha.erase(90);</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.erase(91);</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; haha.capacity() &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//if (haha.empty() == 1)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tcout &lt;&lt; &quot;empty!\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t<span class=\"comment\">//else</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tcout &lt;&lt; &quot;not empty\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//haha.clear();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//if (haha.empty() == 1)</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tcout &lt;&lt; &quot;empty!\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\">\t<span class=\"comment\">//else</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#123;</span></span><br><span class=\"line\">\t<span class=\"comment\">//\tcout &lt;&lt; &quot;not empty\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//&#125;</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//haha.clear();</span></span><br><span class=\"line\">\thaha.<span class=\"built_in\">push_back</span>(<span class=\"number\">5</span>);</span><br><span class=\"line\">\thaha.<span class=\"built_in\">push_back</span>(<span class=\"number\">4</span>);</span><br><span class=\"line\">\thaha.<span class=\"built_in\">push_back</span>(<span class=\"number\">3</span>);</span><br><span class=\"line\">\thaha.<span class=\"built_in\">push_back</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">\thaha.<span class=\"built_in\">push_back</span>(<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"comment\">//haha.print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//haha.print();</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.pop_back();</span></span><br><span class=\"line\">\t<span class=\"comment\">//haha.print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tcout &lt;&lt; haha.<span class=\"built_in\">size</span>() &lt;&lt; <span class=\"string\">&quot;\\n\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\thaha.<span class=\"built_in\">insert</span>(<span class=\"number\">1</span>, <span class=\"number\">100</span>);</span><br><span class=\"line\">\tcout &lt;&lt; haha.<span class=\"built_in\">size</span>() &lt;&lt; <span class=\"string\">&quot;\\n\\n&quot;</span>;</span><br><span class=\"line\">\thaha.<span class=\"built_in\">print</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::cout &lt;&lt; <span class=\"string\">&quot;Hello World!\\n&quot;</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"链表\"><a class=\"markdownIt-Anchor\" href=\"#链表\">#</a> 链表</h3>\n<p>1、数据分散存储</p>\n<p>2、查询性能没有 Vector 好</p>\n<p>3、新增与删除的性能好于 Vector</p>\n<p>单链表，循环链表，双向链表</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;iostream&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;Windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;string.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;malloc.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdlib.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SUCCESS 1</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> INDEX_ERROR -2    <span class=\"comment\">//失败的索引号</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> BUFFER_ERROR -3   <span class=\"comment\">//申请内存失败</span></span></span><br><span class=\"line\"><span class=\"keyword\">using</span> <span class=\"keyword\">namespace</span> std;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">LinkList</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">LinkList</span>();</span><br><span class=\"line\">\t~<span class=\"built_in\">LinkList</span>();</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">IsEmpty</span><span class=\"params\">()</span></span>;  <span class=\"comment\">//是否为空，空1 非空0</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">clear</span><span class=\"params\">()</span></span>;   <span class=\"comment\">//清空链表</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">GetElement</span><span class=\"params\">(IN DWORD dwIndex, OUT T&amp; Element)</span></span>;    <span class=\"comment\">//根据索引获取元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">GetElementIndex</span><span class=\"params\">(IN T&amp; Element)</span></span>;    <span class=\"comment\">//根据元素获取索引</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">Insert</span><span class=\"params\">(IN T Element)</span></span>;     <span class=\"comment\">//新增元素到最后</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">Insert</span><span class=\"params\">(IN DWORD dwIndex, IN T Element)</span></span>;    <span class=\"comment\">//根据索引新增元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">Delete</span><span class=\"params\">(IN DWORD dwIndex)</span></span>;    <span class=\"comment\">//根据索引删除元素</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">GetSize</span><span class=\"params\">()</span></span>;    <span class=\"comment\">//获取链表元素数量</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Print</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"keyword\">typedef</span> <span class=\"keyword\">struct</span> <span class=\"title class_\">_NODE</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tT  Data;</span><br><span class=\"line\">\t\t_NODE *pNext;</span><br><span class=\"line\">\t&#125;NODE, *PNODE;</span><br><span class=\"line\">\t<span class=\"comment\">//PNODE GetIndexCurrentNode(DWORD dwIndex); //获取索引为dwIndex的指针</span></span><br><span class=\"line\">\t<span class=\"comment\">//PNODE GetIndexPreviousNode(DWORD dwIndex); //获取索引为dwIndex的前一个节点指针</span></span><br><span class=\"line\">\t<span class=\"comment\">//PNODE GetIndexNextNode(DWORD dwIndex); //获取索引为dwIndex的后一个节点指针</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\tPNODE m_pList;\t\t\t\t\t\t<span class=\"comment\">//链表头指针，指向第一个节点\t\t\t\t</span></span><br><span class=\"line\">\tDWORD m_dwLength;\t\t\t\t\t\t<span class=\"comment\">//元素的数量\t\t</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">LinkList&lt;T&gt;::<span class=\"built_in\">LinkList</span>():<span class=\"built_in\">m_pList</span>(<span class=\"literal\">NULL</span>),<span class=\"built_in\">m_dwLength</span>(<span class=\"number\">0</span>)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">LinkList&lt;T&gt;::~<span class=\"built_in\">LinkList</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"built_in\">clear</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">bool</span> LinkList&lt;T&gt;::<span class=\"built_in\">IsEmpty</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//判断头结点</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_pList == <span class=\"literal\">NULL</span> || m_dwLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;invalid index\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> LinkList&lt;T&gt;::<span class=\"built_in\">clear</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//判断链表是否非空</span></span><br><span class=\"line\">\t<span class=\"built_in\">IsEmpty</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//循环删除节点</span></span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\">\tPNODE pdeleteNode = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; m_dwLength; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpdeleteNode = ptempNode;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t\t<span class=\"keyword\">delete</span> pdeleteNode;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//删除最后一个二节点，长度置0</span></span><br><span class=\"line\">\tm_dwLength = <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">GetElement</span>(IN DWORD dwIndex, OUT T &amp; Element) <span class=\"comment\">//根据索引获取元素</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex &lt;<span class=\"number\">0</span> || dwIndex &gt; m_dwLength)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;index out of range\\n&quot;</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\">\tDWORD data = <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; dwIndex; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tdata = ptempNode-&gt;Data;</span><br><span class=\"line\">\tElement = data;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">GetElementIndex</span>(IN T &amp; Element)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_pList == <span class=\"literal\">NULL</span> || m_dwLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;invalid index\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; m_dwLength; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//memcmp(ptempNode,Element,sizeof(T))</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (ptempNode-&gt;Data == Element)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tElement == ptempNode-&gt;Data;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> i;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> ERROR;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">Insert</span>(IN T Element)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//有元素，遍历到最后一个</span></span><br><span class=\"line\">\tPNODE pNewnode = <span class=\"keyword\">new</span> NODE;</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(pNewnode, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(NODE));</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(&amp;pNewnode-&gt;Data, &amp;Element, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//是否为空,空就往头结点后面插</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_pList == <span class=\"literal\">NULL</span> || m_dwLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tm_pList = pNewnode;</span><br><span class=\"line\">\t\tm_dwLength++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//不为空</span></span><br><span class=\"line\">\tPNODE ptempNode = m_pList;   <span class=\"comment\">//保存头指针</span></span><br><span class=\"line\">\t<span class=\"comment\">//while(ptempNode-&gt;next != NULL)</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; m_dwLength<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tptempNode-&gt;pNext = pNewnode;</span><br><span class=\"line\">\tpNewnode-&gt;pNext = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\tm_dwLength++;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">Insert</span>(IN DWORD dwIndex, IN T Element)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tPNODE pNewnode = <span class=\"keyword\">new</span> NODE;</span><br><span class=\"line\">\t<span class=\"built_in\">memset</span>(pNewnode, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(PNODE));</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(&amp;pNewnode-&gt;Data, &amp;Element, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t<span class=\"comment\">//判断是否为空,即此时链表为空，要往第1个位置插</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_pList == <span class=\"literal\">NULL</span> || m_dwLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (dwIndex == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tm_pList = pNewnode;</span><br><span class=\"line\">\t\t\tm_dwLength++;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//是否索引有效</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex &lt;<span class=\"number\">0</span> || dwIndex &gt; m_dwLength)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;index out of range\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//如果索引为0，即链表不为空，但想往第一个位置插</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpNewnode-&gt;pNext = m_pList;</span><br><span class=\"line\">\t\tm_pList = pNewnode;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tm_dwLength++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex == m_dwLength)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//如果索引为链表尾，即链表不为空，但要往最后一个插</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; m_dwLength - <span class=\"number\">1</span>; i++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tptempNode-&gt;pNext = pNewnode;</span><br><span class=\"line\">\t\tpNewnode-&gt;pNext = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\tm_dwLength++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//如果索引为链表中</span></span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; dwIndex<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;  <span class=\"comment\">//循环到前一个节点</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tptempNode-&gt;pNext = pNewnode;  <span class=\"comment\">//把前一个节点和新节点相连</span></span><br><span class=\"line\">\tpNewnode-&gt;pNext = ptempNode-&gt;pNext-&gt;pNext;  <span class=\"comment\">//新节点和原来的next相连</span></span><br><span class=\"line\">\tm_dwLength++;</span><br><span class=\"line\">\t<span class=\"comment\">// 1 2 3   5  6</span></span><br><span class=\"line\">\t<span class=\"comment\">//       4</span></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">Delete</span>(IN DWORD dwIndex)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//  1. 判断链表是否为空\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (m_pList == <span class=\"literal\">NULL</span> || m_dwLength == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//  2. 判断索引值是否有效</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex &lt;<span class=\"number\">0</span> || dwIndex &gt; m_dwLength)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tcout &lt;&lt; <span class=\"string\">&quot;index out of range\\n&quot;</span>;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> INDEX_ERROR;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\">\t<span class=\"comment\">//  3. 如果链表中只有头节点，且要删除头节点\t\t\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex == <span class=\"number\">0</span> &amp;&amp; m_dwLength == <span class=\"number\">1</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">delete</span> m_pList;</span><br><span class=\"line\">\t\tm_pList = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\tm_dwLength--;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//  4. 如果要删除头节点\t\t</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (dwIndex == <span class=\"number\">0</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//H 1 2 3 4 5</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">delete</span> m_pList;</span><br><span class=\"line\">\t\tm_pList = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t\tm_dwLength--;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//  5. 如果是其他情况</span></span><br><span class=\"line\">\tptempNode = m_pList;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (<span class=\"type\">size_t</span> i = <span class=\"number\">0</span>; i &lt; dwIndex<span class=\"number\">-1</span>; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// H 1 2 3 4 5</span></span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tptempNode-&gt;pNext = ptempNode-&gt;pNext-&gt;pNext;</span><br><span class=\"line\">\t<span class=\"keyword\">delete</span> ptempNode-&gt;pNext;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_dwLength--;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD LinkList&lt;T&gt;::<span class=\"built_in\">GetSize</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tDWORD size = <span class=\"number\">0</span>;</span><br><span class=\"line\">\tPNODE ptempNode = m_pList;</span><br><span class=\"line\">\t<span class=\"keyword\">while</span> (ptempNode != <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tptempNode = ptempNode-&gt;pNext;</span><br><span class=\"line\">\t\tsize++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> size;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> LinkList&lt;T&gt;::<span class=\"built_in\">Print</span>()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPNODE pTempNode = m_pList;</span><br><span class=\"line\">\t<span class=\"keyword\">for</span> (DWORD i = <span class=\"number\">0</span>; i &lt; m_dwLength; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, pTempNode-&gt;Data);</span><br><span class=\"line\">\t\tpTempNode = pTempNode-&gt;pNext;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//LinkList&lt;int&gt; Link;</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Insert(0,9);</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Insert(1,8);</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Insert(7);</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Insert(6);</span></span><br><span class=\"line\">\t<span class=\"comment\">//9 8 7 6</span></span><br><span class=\"line\">\t<span class=\"comment\">//int x = 6;</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; Link.GetElementIndex(x) &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; Link.GetSize() &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//int w;</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.GetElement(3,w);</span></span><br><span class=\"line\">\t<span class=\"comment\">//cout &lt;&lt; w &lt;&lt; &quot;\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Delete(2);</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Delete(0);</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//bool haha = IsEmpty();</span></span><br><span class=\"line\">\t<span class=\"comment\">//if(haha == true) cout &lt;&lt; &quot;empty\\n&quot;;</span></span><br><span class=\"line\">\t<span class=\"comment\">//else cout &lt;&lt; &quot;not empty\\n&quot;;</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//Link.clear();</span></span><br><span class=\"line\">\t<span class=\"comment\">//Link.Print();</span></span><br><span class=\"line\"></span><br><span class=\"line\">\tLinkList&lt;<span class=\"type\">int</span>&gt;* shabi = <span class=\"keyword\">new</span> LinkList&lt;<span class=\"type\">int</span>&gt;;</span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">Insert</span>(<span class=\"number\">0</span>,<span class=\"number\">9</span>);</span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">Insert</span>(<span class=\"number\">1</span>,<span class=\"number\">8</span>);</span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">Insert</span>(<span class=\"number\">7</span>);</span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">Insert</span>(<span class=\"number\">6</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"comment\">//shabi-&gt;Print();</span></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">Delete</span>(<span class=\"number\">2</span>);</span><br><span class=\"line\">\t<span class=\"comment\">//shabi-&gt;Print();</span></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\tshabi-&gt;<span class=\"built_in\">clear</span>();</span><br><span class=\"line\">\t<span class=\"comment\">//shabi-&gt;Print();</span></span><br><span class=\"line\">\tcout &lt;&lt; <span class=\"string\">&quot;\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Hello World!\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"二叉树\"><a class=\"markdownIt-Anchor\" href=\"#二叉树\">#</a> 二叉树</h3>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307171158951.png\" alt=\"image-20230307171158951\"></p>\n<p>前序遍历</p>\n<p>​\t根左右</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">G D A F E M H Z</span><br></pre></td></tr></table></figure>\n<p>中序遍历</p>\n<p>​\t左根右</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>后序遍历</p>\n<p>​\t左右根</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230307171937417.png\" alt=\"image-20230307171937417\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;windows.h&quot;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &quot;stdlib.h&quot;</span><br><span class=\"line\">#include &quot;malloc.h&quot;</span><br><span class=\"line\">#include &lt;string.h&gt;</span><br><span class=\"line\">#include &lt;iostream&gt;</span><br><span class=\"line\">using namespace std;</span><br><span class=\"line\"></span><br><span class=\"line\">#define SUCCESS           \t\t\t  1 // 执行成功\t</span><br><span class=\"line\">#define ERRORR\t\t\t\t\t\t -1 // 执行失败\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//基础怪物模板</span><br><span class=\"line\">class Monster &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">public:</span><br><span class=\"line\">\tint Id;  //怪物编号</span><br><span class=\"line\">\tchar Name[20];//名字</span><br><span class=\"line\">\tint Level;//等级</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tMonster() &#123;&#125;;//构造 ,默认怪物</span><br><span class=\"line\">\tMonster(int Id, char* Name, int Level);   //怪物参数</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Monster::Monster(int Id, char* Name, int Level) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tthis-&gt;Id = Id;</span><br><span class=\"line\">\tthis-&gt;Level = Level;</span><br><span class=\"line\">\tmemcpy(&amp;this-&gt;Name, Name, strlen(Name) + 1);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">class TreeNode &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tT element; //节点数据</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pLeft; //左树指针</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pRight;//右树指针</span><br><span class=\"line\"></span><br><span class=\"line\">\tTreeNode(T&amp; ele) &#123;</span><br><span class=\"line\">\t\t//初始化node节点</span><br><span class=\"line\">\t\tmemset(&amp;element, 0, sizeof(TreeNode));</span><br><span class=\"line\">\t\t//为元素复制</span><br><span class=\"line\">\t\tmemcpy(&amp;element, &amp;ele, sizeof(T));</span><br><span class=\"line\">\t\tpLeft = pRight = NULL;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">class BsortTree &#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tBsortTree();</span><br><span class=\"line\">\t~BsortTree();</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tvoid InOrderTraverse(TreeNode&lt;T&gt;* pNode); //中序遍历</span><br><span class=\"line\">\tvoid PreOrderTraverse(TreeNode&lt;T&gt;* pNode);//前序遍历</span><br><span class=\"line\">\tvoid PostOrderTraverse(TreeNode&lt;T&gt;* pNode);//后序遍历</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* GetRoot();//返回根节点</span><br><span class=\"line\">\tint GetDepth(TreeNode&lt;T&gt;* Node);// 返回当前节点高度</span><br><span class=\"line\"></span><br><span class=\"line\">private:</span><br><span class=\"line\">\tvoid Init();//初始化一些数值</span><br><span class=\"line\">\tvoid Destroy(TreeNode&lt;T&gt;* Node);</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pRootNode; //根节点指针</span><br><span class=\"line\">\tint size;//树中元素总数</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">void BsortTree&lt;T&gt;::Init()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tMonster m1(1, (char*)&quot;AAA&quot;, 50);</span><br><span class=\"line\">\tMonster m2(2, (char*)&quot;BBB&quot;, 100);</span><br><span class=\"line\">\tMonster m3(3, (char*)&quot;CCC&quot;, 74);</span><br><span class=\"line\">\tMonster m4(4, (char*)&quot;DDD&quot;, 56);</span><br><span class=\"line\">\tMonster m5(5, (char*)&quot;EEE&quot;, 88);</span><br><span class=\"line\">\tMonster m6(6, (char*)&quot;FFF&quot;, 999);</span><br><span class=\"line\">\tMonster m7(7, (char*)&quot;GGG&quot;, 7);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n1 = new TreeNode&lt;Monster&gt;(m1);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n2 = new TreeNode&lt;Monster&gt;(m2);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n3 = new TreeNode&lt;Monster&gt;(m3);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n4 = new TreeNode&lt;Monster&gt;(m4);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n5 = new TreeNode&lt;Monster&gt;(m5);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n6 = new TreeNode&lt;Monster&gt;(m6);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n7 = new TreeNode&lt;Monster&gt;(m7);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpRootNode = n5;</span><br><span class=\"line\">\tn5-&gt;pLeft = n4;</span><br><span class=\"line\">\tn5-&gt;pRight = n6;</span><br><span class=\"line\">\tn4-&gt;pLeft = n1;</span><br><span class=\"line\">\tn1-&gt;pRight = n2;</span><br><span class=\"line\">\tn6-&gt;pLeft = n3;</span><br><span class=\"line\">\tn3-&gt;pRight = n7;</span><br><span class=\"line\">\tsize = 7;</span><br><span class=\"line\">\t\t//\t\t\t\t\t\t5</span><br><span class=\"line\">\t\t//\t\t\t4\t\t\t\t\t\t\t\t\t6</span><br><span class=\"line\">\t\t//1\t\t\t\t\t\t\t\t\t3</span><br><span class=\"line\">\t\t//\t\t2\t\t\t\t\t\t\t\t\t7</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">void BsortTree&lt;T&gt;::Destroy(TreeNode&lt;T&gt;* pNode)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif (pNode == NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tDestroy(pNode-&gt;pLeft);</span><br><span class=\"line\">\t\tDestroy(pNode-&gt;pRight);</span><br><span class=\"line\">\t\tdelete pNode;</span><br><span class=\"line\">\t\tpNode = NULL;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">BsortTree&lt;T&gt;::BsortTree() &#123;</span><br><span class=\"line\">\tInit();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">BsortTree&lt;T&gt;::~BsortTree()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//释放所有节点空间</span><br><span class=\"line\">\tDestroy(pRootNode);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 返回当前节点高度Node</span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">int BsortTree&lt;T&gt;::GetDepth(TreeNode&lt;T&gt;* Node) &#123;</span><br><span class=\"line\">\tif (Node == NULL) &#123;</span><br><span class=\"line\">\t\treturn 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tint Left = GetDepth(Node-&gt;pLeft);</span><br><span class=\"line\">\t\tint Right = GetDepth(Node-&gt;pRight);</span><br><span class=\"line\">\t\treturn (Left &gt; Right) ? (Left + 1) : (Right + 1);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//获取根节点</span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::GetRoot() </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\treturn pRootNode;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//中序遍历</span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">void BsortTree&lt;T&gt;::InOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//列出怪的名字</span><br><span class=\"line\">\tif (pNode == NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tInOrderTraverse(pNode-&gt;pLeft);</span><br><span class=\"line\">\tcout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\tInOrderTraverse(pNode-&gt;pRight);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//前序遍历</span><br><span class=\"line\">template&lt;class T&gt;//前序遍历</span><br><span class=\"line\">void BsortTree&lt;T&gt;::PreOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif (pNode == NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tcout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\tPreOrderTraverse(pNode-&gt;pLeft);</span><br><span class=\"line\">\tPreOrderTraverse(pNode-&gt;pRight);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//后序遍历</span><br><span class=\"line\">template&lt;class T&gt;</span><br><span class=\"line\">void BsortTree&lt;T&gt;::PostOrderTraverse(TreeNode&lt;T&gt;* pNode) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif (pNode == NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tPostOrderTraverse(pNode-&gt;pLeft);</span><br><span class=\"line\">\tPostOrderTraverse(pNode-&gt;pRight);</span><br><span class=\"line\">\tcout &lt;&lt; pNode-&gt;element.Name &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void test()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tBsortTree&lt;Monster&gt;* p = new BsortTree&lt;Monster&gt;();</span><br><span class=\"line\">\tp-&gt;InOrderTraverse(p-&gt;GetRoot());</span><br><span class=\"line\">\tp-&gt;PostOrderTraverse(p-&gt;GetRoot());</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int main()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\ttest();</span><br><span class=\"line\">    std::cout &lt;&lt; &quot;Hello World!\\n&quot;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>搜索二叉树</p>\n<p>1. 有很好的查询性能</p>\n<p>2. 有很好的新增和删除性能</p>\n<p>3. 若左子树不空，则左子树上所有结点的值均小于它的根结点的值</p>\n<p>即 左小右大</p>\n<p>搜索二叉树中序遍历后就是排序后的结果</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230308170011973.png\" alt=\"image-20230308170011973\"></p>\n<p>删除叶子节点，直接删</p>\n<p>删除节点只有一个子树，直接把下面节点提上去</p>\n<p>既有左也有右，用右子树最小节点取代原节点，递归删除最小节点   、 或者左边最大</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;windows.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> SUCCESS           \t\t\t  1 <span class=\"comment\">// 执行成功\t</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ERRORR\t\t\t -1 <span class=\"comment\">// 执行失败\t</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//基础怪物模板</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Monster</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"type\">int</span> Id;  <span class=\"comment\">//怪物编号</span></span><br><span class=\"line\">\t<span class=\"type\">char</span> Name[<span class=\"number\">20</span>];<span class=\"comment\">//名字</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> Level;<span class=\"comment\">//等级</span></span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">Monster</span>() &#123;&#125;;<span class=\"comment\">//构造 ,默认怪物</span></span><br><span class=\"line\">\t<span class=\"built_in\">Monster</span>(<span class=\"type\">int</span> Id, <span class=\"type\">char</span>* Name, <span class=\"type\">int</span> Level);   <span class=\"comment\">//怪物参数</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"type\">bool</span> Monster::<span class=\"keyword\">operator</span>&lt;(<span class=\"type\">const</span> Monster&amp; p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>  <span class=\"keyword\">this</span>-&gt;Id &lt; p.Id ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"type\">bool</span> Monster::<span class=\"keyword\">operator</span>&gt;(<span class=\"type\">const</span> Monster&amp; p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>  <span class=\"keyword\">this</span>-&gt;Id &gt; p.Id ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"type\">bool</span> Monster::<span class=\"keyword\">operator</span>==(<span class=\"type\">const</span> Monster&amp; p) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>   <span class=\"keyword\">this</span>-&gt;Id == p.Id ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">Monster::<span class=\"built_in\">Monster</span>(<span class=\"type\">int</span> Id, <span class=\"type\">char</span>* Name, <span class=\"type\">int</span> Level) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;Id = Id;</span><br><span class=\"line\">\t<span class=\"built_in\">memcpy</span>(&amp;<span class=\"keyword\">this</span>-&gt;Name, Name, <span class=\"built_in\">strlen</span>(Name)+<span class=\"number\">1</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">this</span>-&gt;Level=Level;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TreeNode</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\tT element; <span class=\"comment\">//节点数据</span></span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pLeft; <span class=\"comment\">//左树指针</span></span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pRight;<span class=\"comment\">//右树指针</span></span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pParent;<span class=\"comment\">//父节点指针</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"built_in\">TreeNode</span>(T&amp; ele) &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//初始化</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">memset</span>(&amp;element, <span class=\"number\">0</span>, <span class=\"built_in\">sizeof</span>(TreeNode));</span><br><span class=\"line\">\t\t<span class=\"built_in\">memcpy</span>(&amp;element, &amp;ele, <span class=\"built_in\">sizeof</span>(T));</span><br><span class=\"line\">\t\tpLeft = pRight = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\tbool operator&lt;(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\treturn  this-&gt;element&lt;p-&gt;element  ? true : false;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\tbool operator&gt;(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\treturn this-&gt;element&gt;p-&gt;element ? true : false;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;</span></span><br><span class=\"line\"><span class=\"comment\">\tbool operator==(const TreeNode&lt;T&gt;&amp; p) &#123;</span></span><br><span class=\"line\"><span class=\"comment\">\t\treturn this-&gt;element == p-&gt;element ? true : false;</span></span><br><span class=\"line\"><span class=\"comment\">\t&#125;*/</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">BsortTree</span> &#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"built_in\">BsortTree</span>();</span><br><span class=\"line\">\t~<span class=\"built_in\">BsortTree</span>();</span><br><span class=\"line\"><span class=\"keyword\">public</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">InOrderTraverse</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>; <span class=\"comment\">//中序遍历</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">PreOrderTraverse</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class=\"comment\">//前序遍历</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">PostOrderTraverse</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class=\"comment\">//后序遍历</span></span><br><span class=\"line\">\t<span class=\"function\">TreeNode&lt;T&gt;* <span class=\"title\">GetRoot</span><span class=\"params\">()</span></span>;<span class=\"comment\">//返回根节点</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">GetDepth</span><span class=\"params\">(TreeNode&lt;T&gt;* Node)</span></span>;<span class=\"comment\">// 返回当前节点高度</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">bool</span> <span class=\"title\">IsEmpty</span><span class=\"params\">()</span></span>;<span class=\"comment\">//判断树是否为空</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">Insert</span><span class=\"params\">(T element)</span></span>;<span class=\"comment\">//新增节点</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Delete</span><span class=\"params\">(T element)</span></span>;<span class=\"comment\">//删除节点</span></span><br><span class=\"line\">\t</span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">Init</span><span class=\"params\">()</span></span>;<span class=\"comment\">//初始化一些数值</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">clear</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class=\"comment\">//删除所有节点</span></span><br><span class=\"line\">\t<span class=\"function\">DWORD <span class=\"title\">InsertNode</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode, T element)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">TreeNode&lt;T&gt;* <span class=\"title\">DeleteNode</span><span class=\"params\">(T element, TreeNode&lt;T&gt;* pNode)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">TreeNode&lt;T&gt;* <span class=\"title\">GetMinNode</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class=\"comment\">//获取以pNode为根的最小节点，注：删除NODE下，寻找PNODE右树的最小节点顶到NODE节点上。再删除原最小节点</span></span><br><span class=\"line\">\t<span class=\"function\">TreeNode&lt;T&gt;* <span class=\"title\">GetMaxNode</span><span class=\"params\">(TreeNode&lt;T&gt;* pNode)</span></span>;<span class=\"comment\">//获取以pNode为根的最大节点</span></span><br><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pRootNode; <span class=\"comment\">//根节点指针</span></span><br><span class=\"line\">\t<span class=\"type\">int</span> size;<span class=\"comment\">//树中元素总数</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class=\"built_in\">GetMinNode</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pMin = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode!=<span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> data = pNode-&gt;element;<span class=\"comment\">//说一下，这里为什么不用T类型，因为T代表整个类型大小，但是我们只需要NODE头4个字节的数据,这里有一点不通用，节点的头四个字节数据类型被限制了。</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (data&gt;=pNode-&gt;element) &#123;</span><br><span class=\"line\">\t\t\tpMin = (TreeNode&lt;T&gt;*)pNode-&gt;element;<span class=\"comment\">//把下一个比较小的节点存起来</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"built_in\">GetMinNode</span>(pNode-&gt;pLeft); <span class=\"comment\">//这里为什么用pNode-&gt;pLeft呢，因为根据左树节点比根树节点小。</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> pMin;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class=\"built_in\">DeleteNode</span>(T element, TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pRootNode == <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element == pNode-&gt;element)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (pNode-&gt;pLeft != <span class=\"literal\">NULL</span> &amp;&amp; pNode-&gt;pRight == <span class=\"literal\">NULL</span>) </span><br><span class=\"line\">\t\t&#123;<span class=\"comment\">//左子树</span></span><br><span class=\"line\">\t\t\tTreeNode&lt;T&gt;* pPt = pNode-&gt;pParent;<span class=\"comment\">//拿到当前节点的父节点</span></span><br><span class=\"line\">\t\t\tpPt-&gt;pLeft = pNode-&gt;pLeft;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">delete</span> pNode;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pNode-&gt;pLeft = <span class=\"literal\">NULL</span> &amp;&amp; pNode-&gt;pRight != <span class=\"literal\">NULL</span>) </span><br><span class=\"line\">\t\t&#123;<span class=\"comment\">//右子树</span></span><br><span class=\"line\">\t\t\tTreeNode&lt;T&gt;* pPt = pNode-&gt;pParent;<span class=\"comment\">//拿到当前节点的父节点</span></span><br><span class=\"line\">\t\t\tpPt-&gt;pRight = pNode-&gt;pRight;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">delete</span> pNode;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pNode-&gt;pLeft == <span class=\"literal\">NULL</span>&amp;&amp;pNode-&gt;pRight == <span class=\"literal\">NULL</span>) </span><br><span class=\"line\">\t\t&#123;<span class=\"comment\">//左右树均为空</span></span><br><span class=\"line\">\t\t\tTreeNode&lt;T&gt;* p;</span><br><span class=\"line\">\t\t\tp = pNode-&gt;pParent;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p-&gt;pLeft != <span class=\"literal\">NULL</span>&amp;&amp;p-&gt;pRight == <span class=\"literal\">NULL</span>) &#123;<span class=\"comment\">//这里实际意义就是看当前节点在父节点的左边还是右边</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">delete</span> p-&gt;pLeft;</span><br><span class=\"line\">\t\t\t\tp-&gt;pLeft = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> (p-&gt;pLeft == <span class=\"literal\">NULL</span>&amp;&amp;p-&gt;pRight != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">delete</span> p-&gt;pRight;</span><br><span class=\"line\">\t\t\t\tp-&gt;pRight = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">delete</span> p-&gt;pRight;</span><br><span class=\"line\">\t\t\tp-&gt;pRight = <span class=\"literal\">NULL</span>;     <span class=\"comment\">//这两行就是代表子节点一样，且不为空，删除哪个都一样。</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (pNode-&gt;pLeft != <span class=\"literal\">NULL</span>&amp;&amp;pNode-&gt;pRight != <span class=\"literal\">NULL</span>) &#123;<span class=\"comment\">//左右子树均不为空</span></span><br><span class=\"line\">\t\t\tTreeNode&lt;T&gt;* pCurrent = pNode-&gt;pRight;</span><br><span class=\"line\">\t\t\tTreeNode&lt;T&gt;* pMin = <span class=\"built_in\">GetMinNode</span>(pNode-&gt;pRight);<span class=\"comment\">//GetMinNode是一个递归函数，返回NODE子树里的最小节点</span></span><br><span class=\"line\">\t\t\tpNode-&gt;element = (<span class=\"type\">int</span>)pMin;<span class=\"comment\">//把最小的节点元素抬到Pnode节点这里来</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">DeleteNode</span>(pNode-&gt;element, pCurrent);<span class=\"comment\">//此时此刻，Pnode已经替换为最小节点的元素了，</span></span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t\t\t <span class=\"comment\">//那么只需要删除pCurrent（pNode-&gt;pRight）下的子树最小节点就可以了，这里用的递归。</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (element &gt; pNode-&gt;element) </span><br><span class=\"line\">\t\t&#123;<span class=\"comment\">//Element 大于Pnode的E。那么就往Pnode右树开始找</span></span><br><span class=\"line\">\t\t\t<span class=\"built_in\">DeleteNode</span>(element, pNode-&gt;pRight);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">DeleteNode</span>(element, pNode-&gt;pLeft);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">Delete</span>(T element) &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">DeleteNode</span>(T element, TreeNode&lt;T&gt;* pNode);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD BsortTree&lt;T&gt;::<span class=\"built_in\">InsertNode</span>(TreeNode&lt;T&gt;* pNode, T element) &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//建立一个节点，把元素存进去</span></span><br><span class=\"line\">\tTreeNode&lt;T&gt;* pElement = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;T&gt;(element);</span><br><span class=\"line\">\t<span class=\"comment\">//如果元素等于当前节点就直接返回</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode-&gt;element==element  ) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//如果pnode节点的左子节点为null且element&lt;pnode节点</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode-&gt;pLeft == <span class=\"literal\">NULL</span> &amp;&amp; pNode-&gt;element&gt;element  ) &#123;</span><br><span class=\"line\">\t\tpNode-&gt;pLeft = pElement;</span><br><span class=\"line\">\t\tsize++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//如果pnode节点的右子节点为null且element&gt;pnode节点</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode-&gt;pRight == <span class=\"literal\">NULL</span>&amp;&amp;pNode-&gt;element&lt;element  ) &#123;</span><br><span class=\"line\">\t\tpNode-&gt;pRight = pElement;</span><br><span class=\"line\">\t\tsize++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"comment\">//pnode左节点不为空且element&lt;pnode节点----------此处为递归</span></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode-&gt;element&gt;element) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"built_in\">InsertNode</span>(pNode-&gt;pLeft, element);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">InsertNode</span>(pNode-&gt;pRight, element);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">DWORD BsortTree&lt;T&gt;::<span class=\"built_in\">Insert</span>(T element) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!pRootNode) &#123;<span class=\"comment\">//如果根节点为空</span></span><br><span class=\"line\">\t\tpRootNode = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;T&gt;(element);</span><br><span class=\"line\">\t\tsize++;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> SUCCESS;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"built_in\">InsertNode</span>(pRootNode, element);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">bool</span> BsortTree&lt;T&gt;::<span class=\"built_in\">IsEmpty</span>() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> size == <span class=\"number\">0</span> ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">BsortTree&lt;T&gt;::~<span class=\"built_in\">BsortTree</span>() &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//循环删除节点元素</span></span><br><span class=\"line\">\t<span class=\"built_in\">clear</span>(pRootNode);</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">clear</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">clear</span>(pNode-&gt;pLeft);</span><br><span class=\"line\">\t\t<span class=\"built_in\">clear</span>(pNode-&gt;pRight);</span><br><span class=\"line\">\t\t<span class=\"keyword\">delete</span> pNode;</span><br><span class=\"line\">\t\tpNode = <span class=\"literal\">NULL</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\">BsortTree&lt;T&gt;::<span class=\"built_in\">BsortTree</span>() &#123;</span><br><span class=\"line\">\t<span class=\"built_in\">Init</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;<span class=\"comment\">// 返回当前节点高度,Node</span></span><br><span class=\"line\"><span class=\"type\">int</span> BsortTree&lt;T&gt;::<span class=\"built_in\">GetDepth</span>(TreeNode&lt;T&gt;* Node) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (Node == NUll) &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> Left = <span class=\"built_in\">GetDepth</span>(Node-&gt;pLeft);</span><br><span class=\"line\">\t\t<span class=\"type\">int</span> Right = <span class=\"built_in\">GetDepth</span>(Node-&gt;pRight);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> (Left &gt; Right) ? (Left + <span class=\"number\">1</span>) : (Right + <span class=\"number\">1</span>);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//获取根节点</span></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"> TreeNode&lt;T&gt;* BsortTree&lt;T&gt;::<span class=\"built_in\">GetRoot</span>() &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> pRootNode;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//中序遍历</span></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">InOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode == <span class=\"literal\">NULL</span>)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">InOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, pNode-&gt;element);</span><br><span class=\"line\">\t\t<span class=\"built_in\">InOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//前序遍历</span></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;<span class=\"comment\">//前序遍历</span></span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">PreOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, pNode-&gt;element);</span><br><span class=\"line\">\t\t<span class=\"built_in\">PreOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class=\"line\">\t\t<span class=\"built_in\">PreOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//后序遍历</span></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">PostOrderTraverse</span>(TreeNode&lt;T&gt;* pNode) &#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (pNode != <span class=\"literal\">NULL</span>) &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">PostOrderTraverse</span>(pNode-&gt;pLeft);</span><br><span class=\"line\">\t\t<span class=\"built_in\">PostOrderTraverse</span>(pNode-&gt;pRight);</span><br><span class=\"line\">\t\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;%d\\n&quot;</span>, pNode-&gt;element);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">template</span>&lt;<span class=\"keyword\">class</span> <span class=\"title class_\">T</span>&gt;</span><br><span class=\"line\"><span class=\"type\">void</span> BsortTree&lt;T&gt;::<span class=\"built_in\">Init</span>() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m1</span><span class=\"params\">(<span class=\"number\">1</span>, <span class=\"string\">&quot;混世魔王&quot;</span>,<span class=\"number\">50</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m2</span><span class=\"params\">(<span class=\"number\">2</span>, <span class=\"string\">&quot;金斯尔&quot;</span>, <span class=\"number\">100</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m3</span><span class=\"params\">(<span class=\"number\">3</span>, <span class=\"string\">&quot;游离&quot;</span>, <span class=\"number\">74</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m4</span><span class=\"params\">(<span class=\"number\">4</span>, <span class=\"string\">&quot;尔康&quot;</span>, <span class=\"number\">56</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m5</span><span class=\"params\">(<span class=\"number\">5</span>, <span class=\"string\">&quot;二讹&quot;</span>, <span class=\"number\">88</span>)</span></span>;</span><br><span class=\"line\">\t<span class=\"function\">Monster <span class=\"title\">m6</span><span class=\"params\">(<span class=\"number\">6</span>, <span class=\"string\">&quot;传奇&quot;</span>, <span class=\"number\">999</span>)</span></span>;</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n1 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m1);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n2 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m2);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n3 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m3);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n4 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m4);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n5 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m5);</span><br><span class=\"line\">\tTreeNode&lt;Monster&gt;* n6 = <span class=\"keyword\">new</span> <span class=\"built_in\">TreeNode</span>&lt;Monster&gt;(m6);</span><br><span class=\"line\"></span><br><span class=\"line\">\tpRootNode = n3;</span><br><span class=\"line\">\tn3-&gt;pLeft = n2;</span><br><span class=\"line\">\tn3-&gt;pRight = n1;</span><br><span class=\"line\">\tn1-&gt;pLeft = n4;</span><br><span class=\"line\">\tn1-&gt;pRight = n5;</span><br><span class=\"line\">\t<span class=\"comment\">//n5-&gt;pRight = n6;</span></span><br><span class=\"line\">\t<span class=\"comment\">//size = 6;</span></span><br><span class=\"line\">\t</span><br><span class=\"line\">\t<span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">\t 3</span></span><br><span class=\"line\"><span class=\"comment\">  2     1</span></span><br><span class=\"line\"><span class=\"comment\">      4    5</span></span><br><span class=\"line\"><span class=\"comment\">\t          6</span></span><br><span class=\"line\"><span class=\"comment\">\t</span></span><br><span class=\"line\"><span class=\"comment\">\t</span></span><br><span class=\"line\"><span class=\"comment\">\t*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">()</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>上面的代码参参考了<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjQwODgzMi9hcnRpY2xlL2RldGFpbHMvMTE2NDY2MTM3\">滴水二叉树实现详细注释_wow. 的博客 - CSDN 博客</span>的代码，实在写不出</p>\n<h3 id=\"vectorlinklistbtree反汇编\"><a class=\"markdownIt-Anchor\" href=\"#vectorlinklistbtree反汇编\">#</a> Vector，LinkList，Btree 反汇编</h3>\n<h2 id=\"win32\"><a class=\"markdownIt-Anchor\" href=\"#win32\">#</a> win32</h2>\n<h3 id=\"宽字符\"><a class=\"markdownIt-Anchor\" href=\"#宽字符\">#</a> 宽字符</h3>\n<p>ASCII：0xxxxxxx</p>\n<p>extend ASCII：0xxxxxxx-1xxxxxxx</p>\n<p>GB2312：用两个字节存储一个汉字，最高位都是 1，可能乱码，因为可能不同国家都对他做了扩展，其次存储不方便</p>\n<p>Unicode：解决乱码</p>\n<p>乱码就是一个多个符号对应同一个编码</p>\n<p>utf8/utf16: 变长的 Unicode</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//中ASCII d6 d0  unicode 4e 2d</span><br><span class=\"line\">char x = &#x27;中&#x27;;    //产生截断D0</span><br><span class=\"line\">wchar_t x1 = &#x27;中&#x27;;   //D0 D6,按照ASCII解析</span><br><span class=\"line\">wchar_t x2 = L&#x27;中&#x27;;   //2d 4e按照Unicode解析</span><br><span class=\"line\"></span><br><span class=\"line\">char x[] = &quot;中国&quot;;  //使用扩展ASCII，以00(\\n)结尾</span><br><span class=\"line\">wchar_t x1[] = L&quot;中国&quot;;   //使用Unicode，结尾是00 00 (\\0\\0)</span><br><span class=\"line\"></span><br><span class=\"line\">printf(&quot;%s\\n&quot;,x);</span><br><span class=\"line\">wprintf(L&quot;%s\\n&quot;,x1);</span><br><span class=\"line\"></span><br><span class=\"line\">#include &lt;locale.h&gt;</span><br><span class=\"line\">int main &#123;</span><br><span class=\"line\">\tsetlocale(LC_ALL,&quot;&quot;)</span><br><span class=\"line\">&#125;//设置地域，这样才能正常打印</span><br><span class=\"line\"></span><br><span class=\"line\">#include &lt;string.h&gt;</span><br><span class=\"line\">strlen(x)</span><br><span class=\"line\">wcslen(x1);</span><br><span class=\"line\"></span><br><span class=\"line\">wcscpy(x1,x1);</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309190055917.png\" alt=\"image-20230309190055917\"></p>\n<p>Win32 API  (应用程序接口)</p>\n<p>主要存放在 windows/system32 下面所有的 DLL，是 Windows 提供的函数，供使用</p>\n<p>Kernel32.dll: 最核心的功能模块，比如管理内存、进程和线程相关的函数等</p>\n<p>User32.dll: 是 Windows 用户界面相关应用程序接口，如创建窗口和发送消息等.</p>\n<p>GDI32.dll: 全称是 Graphical Device Interface (图形设备接口), 包含用于画图和显示文本的函数比如要显示一个程序窗口，就调用了其中的函数来画这个窗口</p>\n<p>这些 dll 是一个 ring3 接口，通过这些 dll 调用内核函数，可以理解为 ring3 和 ring0 的接口</p>\n<p>Windows 类型</p>\n<p>CHAR</p>\n<p>WCHAR</p>\n<p>TCHAR 是个可变类型，取决于当前工程是宽字节还是窄字节</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CHAR cha[] = &quot;中国&quot;;</span><br><span class=\"line\">WCHAR chw[] = L&quot;中国&quot;;</span><br><span class=\"line\">TCHAR cht[] = TEXT(&quot;中国&quot;);</span><br></pre></td></tr></table></figure>\n<p>LPSTR（PSTR）</p>\n<p>LPTSTR（PTSTR）</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PSTR pszChar[] = &quot;中国&quot;;</span><br><span class=\"line\">PWSTR pszWChar[] = L&quot;中国&quot;;</span><br><span class=\"line\">PTSTR pszTChar[] = TEXT(&quot;中国&quot;);</span><br></pre></td></tr></table></figure>\n<p>Windows 内核函数都是 w 的，如果是 a 调用，系统会先转成 w 在调用。并且都是用 c 写的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MessageBox() 也是一个宏，根据当前项目决定使用a还是w</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309192926826.png\" alt=\"image-20230309192926826\"></p>\n<p>创建 win32application</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230309193255058.png\" alt=\"image-20230309193255058\"></p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//APIENTRY = winapi = __stdcall</span></span><br><span class=\"line\"><span class=\"type\">int</span> APIENTRY <span class=\"title function_\">WinMain</span><span class=\"params\">(HINSTANCE hInstance,</span></span><br><span class=\"line\"><span class=\"params\">                     HINSTANCE hPrevInstance,</span></span><br><span class=\"line\"><span class=\"params\">                     LPSTR     lpCmdLine,</span></span><br><span class=\"line\"><span class=\"params\">                     <span class=\"type\">int</span>       nCmdShow)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> \t<span class=\"comment\">// <span class=\"doctag\">TODO:</span> Place code here.</span></span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//hinstance 就是imagebase,在setting-&gt;Link-&gt;output-&gt;base address,里面是十进制</span></span><br><span class=\"line\"><span class=\"comment\">//win32没有控制台，没法输出，要是用OutputDebugString()需要按照以下方法，新建一个类，在源文件中包含</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\">.h</span><br><span class=\"line\"><span class=\"type\">void</span> __cdecl <span class=\"title function_\">OutputDebugStringF</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">char</span>* format, ...)</span>;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifdef</span> DEBUG</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> DbgPrintf OutputDebugStringF</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">else</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> DbgPrintf</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span> <span class=\"comment\">// DEBUG </span></span></span><br><span class=\"line\"></span><br><span class=\"line\">.cpp</span><br><span class=\"line\"><span class=\"type\">void</span> __cdecl <span class=\"title function_\">OutputDebugStringF</span><span class=\"params\">(<span class=\"type\">const</span> <span class=\"type\">char</span>* format, ...)</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tva_list vlArgs;</span><br><span class=\"line\">\t<span class=\"type\">char</span> *strBuffer = (<span class=\"type\">char</span>*)GlobalAlloc(GPTR, <span class=\"number\">4096</span>);</span><br><span class=\"line\">\tva_start(vlArgs, format);</span><br><span class=\"line\">\t_vsnprintf(strBuffer, <span class=\"number\">4096</span> - <span class=\"number\">1</span>, format, vlArgs);</span><br><span class=\"line\">\tva_end(vlArgs);</span><br><span class=\"line\">\t<span class=\"built_in\">strcat</span>(strBuffer, <span class=\"string\">&quot;\\n&quot;</span>);</span><br><span class=\"line\">\tOutputDebugStringF(strBuffer);</span><br><span class=\"line\">\tGlobalFree(strBuffer);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD errors = GetLastError(); 放到出问题那行下面，得到错误编号</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int WINAPI wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PWSTR pCmdLine, int nCmdShow);</span><br><span class=\"line\">hInstance 称为“实例句柄”或“模块句柄”。操作系统使用此值在内存中加载可执行文件时标识可执行文件 (EXE) 。 某些Windows函数需要实例句柄，例如加载图标或位图。</span><br><span class=\"line\">hPrevInstance 没有意义。 它在 16 位Windows中使用，但现在始终为零。</span><br><span class=\"line\">pCmdLine 包含命令行参数作为 Unicode 字符串。</span><br><span class=\"line\">nCmdShow 是一个标志，指示主应用程序窗口是最小化、最大化还是正常显示。</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;locale.h&gt;</span><br><span class=\"line\">#include &lt;iostream&gt;</span><br><span class=\"line\">using namespace std;</span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t//TestVector();</span><br><span class=\"line\">\tsetlocale(LC_ALL,&quot;&quot;);</span><br><span class=\"line\">\twchar_t x1[] = L&quot;傻逼&quot;;</span><br><span class=\"line\">\twprintf(L&quot;%s\\n&quot;,x1);</span><br><span class=\"line\">\tcout &lt;&lt; wcslen(x1) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\twchar_t x2[] = L&quot;你是智障&quot;;</span><br><span class=\"line\">\t//wcscpy(x2,x1);</span><br><span class=\"line\">\t//wprintf(L&quot;%s\\n&quot;,x2);</span><br><span class=\"line\">\t//cout &lt;&lt; wcscmp(x1,x1) &lt;&lt; &quot;\\n&quot;; </span><br><span class=\"line\">\twchar_t x3[] = L&quot;你是傻逼&quot;;</span><br><span class=\"line\">\t//x1第一次在x3中出现的位置，否则返回null</span><br><span class=\"line\">\tcout &lt;&lt; wcsstr(x3,x1) &lt;&lt; &quot;\\n&quot;;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t</span><br><span class=\"line\">\tprintf(&quot;Hello World!\\n&quot;);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"事件-消息\"><a class=\"markdownIt-Anchor\" href=\"#事件-消息\">#</a> 事件、消息</h3>\n<p>Windows 中的事件是一个 “动作”，这个动作可能是用户操作应用程序产生的，也可能是 Windows 自己产生的</p>\n<p>而消息，就是用来描述这些 “动作” 的，比如:</p>\n<p>Windows 为了能够准确的描述这些信息，提供了一个结构体：ISG，该结构体里面记录的事件的详细信息</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">typedef struct tagMsg</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tHWND hwnd;      //窗口句柄，由那个窗口处理</span><br><span class=\"line\">\tUINT message;   //动作类型/消息类型</span><br><span class=\"line\">\tWPARAM wParam;  //消息的详细说明</span><br><span class=\"line\">\tLPARAM lParam;  //消息的详细说明</span><br><span class=\"line\">\tDWORD time;     //时间</span><br><span class=\"line\">\tPOINT pt;       //坐标,x,y</span><br><span class=\"line\">&#125;MSG,*PMSG;</span><br></pre></td></tr></table></figure>\n<p>系统消息队列与应用程序消息队列</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310192516428.png\" alt=\"image-20230310192516428\"></p>\n<p>判断消息的类型是不是我关心的是就处理不是让 windows 去处理</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310193925308.png\" alt=\"image-20230310193925308\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310194619857.png\" alt=\"image-20230310194619857\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230310203005194.png\" alt=\"image-20230310203005194\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// Win32 Less 2.cpp : Defines the entry point for the application.</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &quot;Tools.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">//声明WindowProc,否则在定义前使用会报错,WindowProc 定义窗口的行为-其外观、用户交互方式等。</span><br><span class=\"line\">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam);</span><br><span class=\"line\"></span><br><span class=\"line\">int APIENTRY WinMain(HINSTANCE hInstance,</span><br><span class=\"line\">                     HINSTANCE hPrevInstance,</span><br><span class=\"line\">                     LPSTR     lpCmdLine,</span><br><span class=\"line\">                     int       nCmdShow)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> \t// TODO: Place code here.</span><br><span class=\"line\"></span><br><span class=\"line\">\t//创建窗口名字</span><br><span class=\"line\">\tTCHAR className[] = &quot;shabi&quot;; </span><br><span class=\"line\"></span><br><span class=\"line\">\t//定义一个自己的窗口，并定义样式</span><br><span class=\"line\">\tWNDCLASS wndclass = &#123;0&#125;;</span><br><span class=\"line\">\twndclass.hbrBackground = (HBRUSH)COLOR_MENU;</span><br><span class=\"line\">\twndclass.lpfnWndProc = WindowProc;</span><br><span class=\"line\">\twndclass.lpszClassName = className;</span><br><span class=\"line\">\twndclass.hInstance = hInstance;</span><br><span class=\"line\"></span><br><span class=\"line\">\t//注册窗口</span><br><span class=\"line\">\tRegisterClass(&amp;wndclass);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//创建窗口并接收唯一标识窗口的句柄。</span><br><span class=\"line\">\tHWND hwnd = CreateWindowEx(</span><br><span class=\"line\">\t\t0,                              // Optional window styles.</span><br><span class=\"line\">\t\tclassName,                     // Window class</span><br><span class=\"line\">\t\tTEXT(&quot;Learn to Program Windows&quot;),    // Window text</span><br><span class=\"line\">\t\tWS_OVERLAPPEDWINDOW,            // Window style</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// Size and position</span><br><span class=\"line\">\t\tCW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT, CW_USEDEFAULT,</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tNULL,       // Parent window    </span><br><span class=\"line\">\t\tNULL,       // Menu</span><br><span class=\"line\">\t\thInstance,  // Instance handle</span><br><span class=\"line\">\t\tNULL        // Additional application data</span><br><span class=\"line\">\t);</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (hwnd == NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tShowWindow(hwnd, nCmdShow);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//消息处理</span><br><span class=\"line\">\tMSG msg;</span><br><span class=\"line\">    while (GetMessage(&amp;msg, NULL, 0, 0) &gt; 0)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        TranslateMessage(&amp;msg);</span><br><span class=\"line\">        DispatchMessage(&amp;msg);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//</span><br><span class=\"line\">LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    switch (uMsg)</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">\t\tcase WM_DESTROY:</span><br><span class=\"line\">\t\t\tPostQuitMessage(0);</span><br><span class=\"line\">\t\t\treturn 0;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\tcase WM_PAINT:</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            PAINTSTRUCT ps;</span><br><span class=\"line\">            HDC hdc = BeginPaint(hwnd, &amp;ps);</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">            // All painting occurs here, between BeginPaint and EndPaint.</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">            FillRect(hdc, &amp;ps.rcPaint, (HBRUSH) (COLOR_WINDOW+1));</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">            EndPaint(hwnd, &amp;ps);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        return 0;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">\t//处理不关注事件</span><br><span class=\"line\">    return DefWindowProc(hwnd, uMsg, wParam, lParam);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL3dpbmRvd3Mvd2luMzIvbGVhcm53aW4zMi9jcmVhdGluZy1hLXdpbmRvdw==\">创建窗口 - Win32 apps | Microsoft Learn</span></p>\n<p>消息类型</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MDIxMTgwL2FydGljbGUvZGV0YWlscy8xMDAwMjA5MTE=\">Windows 消息类型及说明（全面）_战胜。的博客 - CSDN 博客</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybi5taWNyb3NvZnQuY29tL3poLWNuL3dpbmRvd3Mvd2luMzIvd2lubXNnL2Fib3V0LW1lc3NhZ2VzLWFuZC1tZXNzYWdlLXF1ZXVlcw==\">关于消息和消息队列 - Win32 apps | Microsoft Learn</span></p>\n<blockquote>\n<p>如果直接定义而不初始化，那么没初始化的参数的地方还是 CC，系统执行到这里就会产生中断，</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311112852539.png\" alt=\"image-20230311112852539\"></p>\n<p>WNDCLASS wndclass = {0}；</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401061   mov         dword ptr [ebp-30h],0</span><br><span class=\"line\">00401068   mov         ecx,9</span><br><span class=\"line\">0040106D   xor         eax,eax</span><br><span class=\"line\">0040106F   lea         edi,[ebp-2Ch]</span><br><span class=\"line\">00401072   rep stos    dword ptr [edi]</span><br></pre></td></tr></table></figure>\n<p>系统会循环填充所有参数为 0</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230311113120902.png\" alt=\"image-20230311113120902\"></p>\n</blockquote>\n",
            "tags": [
                "逆向"
            ]
        },
        {
            "id": "http://example.com/2022/11/11/reverse/",
            "url": "http://example.com/2022/11/11/reverse/",
            "title": "逆向",
            "date_published": "2022-11-11T05:38:45.000Z",
            "content_html": "<h2 id=\"c与汇编的关系\"><a class=\"markdownIt-Anchor\" href=\"#c与汇编的关系\">#</a> C 与汇编的关系</h2>\n<h3 id=\"应用层技术栈\"><a class=\"markdownIt-Anchor\" href=\"#应用层技术栈\">#</a> 应用层技术栈：</h3>\n<ol>\n<li>加密与解密（四）看雪论坛</li>\n<li>X86/X64/arm 汇编语言</li>\n<li>windows 核心编程</li>\n<li>c 语言从入门到精通 (第三版) （清华）</li>\n</ol>\n<h3 id=\"学习逆向环境配置\"><a class=\"markdownIt-Anchor\" href=\"#学习逆向环境配置\">#</a> 学习逆向环境配置</h3>\n<p>工具类：</p>\n<ul>\n<li>吾爱破解工具类</li>\n<li>Hxd (十六进制编辑工具)</li>\n</ul>\n<p>开发类：</p>\n<ol>\n<li>VS2008 IDE</li>\n<li>VC6.0 SP6 IDE</li>\n</ol>\n<h3 id=\"进制转换\"><a class=\"markdownIt-Anchor\" href=\"#进制转换\">#</a> 进制转换</h3>\n<ol>\n<li>十进制的定义：由十个符号组成，分别是 0 1 2 3 4 5 6 7 8 9 逢十进一</li>\n<li>九进制的定义：由九个符号组成，分别是 0 1 2 3 4 5 6 7 8 逢九进一</li>\n<li>十六进制的定义：由十六个符号组成，分别是 0 1 2 3 4 5 6 7 8 9 A B C D E F</li>\n<li>N 进制的定义：由 N 个符号组成 逢 N 进一</li>\n</ol>\n<h3 id=\"数据类型与逻辑运算\"><a class=\"markdownIt-Anchor\" href=\"#数据类型与逻辑运算\">#</a> 数据类型与逻辑运算</h3>\n<p>在计算机中，由于硬件的制约，数据是有长度限制的，超过数据宽度的数据会被丢弃</p>\n<p>同一个数据，表示无符号数和有符号数则其含义不同</p>\n<ol>\n<li>无符号数：正数</li>\n<li>有符号数：正数、负数</li>\n</ol>\n<h3 id=\"常见的数据类型重要\"><a class=\"markdownIt-Anchor\" href=\"#常见的数据类型重要\">#</a> 常见的数据类型（重要）</h3>\n<ul>\n<li>BYTE                    字节          8BIT</li>\n<li>WORD                 字             16BIT 2 字节</li>\n<li>DWORD              双字          32BIT 4 字节</li>\n</ul>\n<h3 id=\"常见的运算符类型重要\"><a class=\"markdownIt-Anchor\" href=\"#常见的运算符类型重要\">#</a> <strong>常见的运算符类型（重要）</strong></h3>\n<p><strong>或运算（or |）</strong></p>\n<p>只要有一个为 1 则结果为 1</p>\n<p><strong>与运算（and &amp;）</strong></p>\n<p>两个都是 1 结果才为 1</p>\n<p><strong>异或运算（xor ^）</strong></p>\n<p>相同为 0 不同为 1</p>\n<p><strong>非运算 (not !)</strong></p>\n<p>取反 1 是 0 0 是 1</p>\n<h3 id=\"32位寄存器\"><a class=\"markdownIt-Anchor\" href=\"#32位寄存器\">#</a> 32 位寄存器</h3>\n<p>EAX</p>\n<p>EBX</p>\n<p>ECX</p>\n<p>EDX</p>\n<p>只有通用寄存器能拆成高位和低位</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov byte [local.3+2],ah     //由于只是高位地址，因此是3+2</span><br><span class=\"line\">mov byte [local.3+3],ah     //同时注意是byte，所以是2</span><br></pre></td></tr></table></figure>\n<p>command 中</p>\n<p>?al 可以显示 al 中的值，即查看寄存器中的值</p>\n<p>dd  内存 display dword</p>\n<p>dw 内存</p>\n<p>db 内存</p>\n<h3 id=\"cpu计算23\"><a class=\"markdownIt-Anchor\" href=\"#cpu计算23\">#</a> CPU 计算 2+3</h3>\n<p>1. 先异或，得到 R</p>\n<p>2. 在与运算，将结果左移一位</p>\n<p>3. 如果 (2) 的结果为全 0，那么 R 就是最终答案，如果不是，将 R 赋值给 x，将 (2) 的结果赋值给 y</p>\n<p>4. 重复操作直至 (2) 的结果为全 0，那么此时 R 就是我们的答案</p>\n<h3 id=\"cpu计算2-3\"><a class=\"markdownIt-Anchor\" href=\"#cpu计算2-3\">#</a> CPU 计算 2-3</h3>\n<p>1. 异或，得到 R</p>\n<p>2. 在与运算，将结果再左移一位</p>\n<p>3. 如果结果为全 0，那么 R 就是结果，否则重复</p>\n<p>在 debug 的模式下是用常量来分配的 print hello world</p>\n<h3 id=\"堆栈的原理\"><a class=\"markdownIt-Anchor\" href=\"#堆栈的原理\">#</a> 堆栈的原理：</h3>\n<ol>\n<li>临时存放一些寄存器已无法存放的数据，比如超过内存对齐的数据类型</li>\n<li>存放临时数据，野指针，指针初始化时的数据</li>\n</ol>\n<p>Windows 分配栈时 是从高地址往低地址分配:</p>\n<ol>\n<li>MOV EBX,0x13FFDC        BASE</li>\n<li>MOV EDX,0x13FFDC        TOP</li>\n</ol>\n<p>EBP 和 ESP：</p>\n<p>ESP：该指针永远指向系统栈最上面一个栈帧的栈顶。</p>\n<p>EBP：该指针永远指向系统栈最上面一个栈帧的底部。</p>\n<p>栈底和栈顶原理：</p>\n<ol>\n<li>控制栈顶和栈底分别为两个固定的寄存器 (EBP 基址指针寄存器 和 ESP 堆栈指针寄存器）</li>\n</ol>\n<p>ebp = esp</p>\n<p>esp -= 0x40</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1654236227177-d37c824f-e09f-4e3d-9a41-c4d81ee6de30.png\" alt=\"img\"></p>\n<p>ESP 和 EBP 不够的时候会相互借用，两个都用作传参</p>\n<p>初始状态下，ebp 指向高地址，ESP 指向低地址</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095016154.png\" alt=\"image-20221105095016154\"></p>\n<p>push eax</p>\n<blockquote>\n<p>先把 esp-4，再把 eax 中的值压栈</p>\n</blockquote>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095049237.png\" alt=\"image-20221105095049237\"></p>\n<p>pop eax</p>\n<blockquote>\n<p>将 esp 指向的值给 eax，esp+4</p>\n</blockquote>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105095144317.png\" alt=\"image-20221105095144317\"></p>\n<h4 id=\"一个helloworld的main函数\"><a class=\"markdownIt-Anchor\" href=\"#一个helloworld的main函数\">#</a> 一个 helloworld 的 main 函数</h4>\n<p>一般来说，VC 6.0 的 main 函数在  <code>call 00401005</code></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105093859109.png\" alt=\"image-20221105093859109\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401005  /$ /E9 06000000   jmp     main</span><br><span class=\"line\">0040100A  |  |CC            int3</span><br><span class=\"line\">0040100B  |  |CC            int3</span><br><span class=\"line\">0040100C  |  |CC            int3</span><br><span class=\"line\">0040100D  |  |CC            int3</span><br><span class=\"line\">0040100E  |  |CC            int3</span><br><span class=\"line\">0040100F  |  |CC            int3</span><br><span class=\"line\">00401010 &gt;|&gt; \\55            push    ebp</span><br><span class=\"line\">00401011  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401013  |.  83EC 40       sub     esp,0x40</span><br><span class=\"line\">00401016  |.  53            push    ebx</span><br><span class=\"line\">00401017  |.  56            push    esi</span><br><span class=\"line\">00401018  |.  57            push    edi</span><br><span class=\"line\">00401019  |.  8D7D C0       lea     edi,[local.16]</span><br><span class=\"line\">0040101C  |.  B9 10000000   mov     ecx,0x10</span><br><span class=\"line\">00401021  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401026  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00401028  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class=\"line\">&quot;</span><br><span class=\"line\">0040102D  |.  E8 2E000000   call    printf                           ; \\printf</span><br><span class=\"line\">00401032  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00401035  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00401037  |.  5F            pop     edi</span><br><span class=\"line\">00401038  |.  5E            pop     esi</span><br><span class=\"line\">00401039  |.  5B            pop     ebx</span><br><span class=\"line\">0040103A  |.  83C4 40       add     esp,0x40</span><br><span class=\"line\">0040103D  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">0040103F  |.  E8 9C000000   call    _chkesp</span><br><span class=\"line\">00401044  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">00401046  |.  5D            pop     ebp</span><br><span class=\"line\">00401047  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>假设当前我们有这样一个程序</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// add_main.cpp : Defines the entry point for the console application.</span></span><br><span class=\"line\"><span class=\"comment\">//</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">func</span><span class=\"params\">(<span class=\"type\">int</span> m, <span class=\"type\">int</span> n)</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> a, b;</span><br><span class=\"line\">    a = m;</span><br><span class=\"line\">    b = n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">int</span> <span class=\"title\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"type\">int</span> m=<span class=\"number\">3</span>,n=<span class=\"number\">4</span>;</span><br><span class=\"line\">\t<span class=\"built_in\">func</span>(m,n);</span><br><span class=\"line\">\t<span class=\"built_in\">printf</span>(<span class=\"string\">&quot;Hello World!\\n&quot;</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在调用 func 之前，main 的栈帧：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105100143457.png\" alt=\"image-20221105100143457\"></p>\n<p>从低地址 esp 到高地址 ebp 的这块区域，就是当前 main 函数的栈帧。当 main 中调用 func 时，写成汇编大致是：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push m</span><br><span class=\"line\">push n; 两个参数压入栈</span><br><span class=\"line\">call func; 调用func，将返回地址填入栈，并跳转到func</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401078  |.  C745 FC 03000&gt;mov     dword ptr ss:[ebp-0x4],0x3</span><br><span class=\"line\">0040107F  |.  C745 F8 04000&gt;mov     dword ptr ss:[ebp-0x8],0x4</span><br><span class=\"line\">00401086  |.  8B45 F8       mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">00401089  |.  50            push    eax</span><br><span class=\"line\">0040108A  |.  8B4D FC       mov     ecx,dword ptr ss:[ebp-0x4]</span><br><span class=\"line\">0040108D  |.  51            push    ecx</span><br><span class=\"line\">0040108E  |.  E8 72FFFFFF   call    00401005</span><br><span class=\"line\">00401093  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">00401096  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class=\"line\">&quot;</span><br><span class=\"line\">0040109B  |.  E8 30000000   call    printf                           ; \\printf</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105100732747.png\" alt=\"image-20221105100732747\"></p>\n<p>当跳转到了 func，来看看 func 的汇编大致的样子：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401020 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">00401021  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401023  |.  83EC 48       sub     esp,0x48</span><br><span class=\"line\">00401026  |.  53            push    ebx</span><br><span class=\"line\">00401027  |.  56            push    esi</span><br><span class=\"line\">00401028  |.  57            push    edi</span><br></pre></td></tr></table></figure>\n<p>push ebp 需要保存 main 的栈底，因为现在到了一个新的函数，但栈顶不需要保存，因为上一个栈帧的顶部讲会是 func 的栈帧底部。（两栈帧相邻的）</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105101018994.png\" alt=\"image-20221105101018994\"></p>\n<p>到这里，新的栈帧开始了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">mov     dword ptr ss:[ebp-0x4],eax</span><br><span class=\"line\">mov     ecx,dword ptr ss:[ebp+0xC]</span><br><span class=\"line\">mov     dword ptr ss:[ebp-0x8],ecx</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221105101240579.png\" alt=\"image-20221105101240579\"></p>\n<p>retn   ; 返回，然后 8 是什么意思呢，就是参数占用的字节数，当返回后，esp-n，释放参数 m,n 的空间</p>\n<p>由此可见，通过 ebp，能够很容易定位到上面的参数。当从 func 函数返回时，首先 esp 移动到栈帧底部（即释放局部变量），然后把上一个函数的栈帧底部指针弹出到 ebp, 再弹出返回地址到 cs:ip 上，esp 继续移动划过参数，这样，ebp,esp 就回到了调用函数前的状态，即现在恢复了原来的 main 的栈帧</p>\n<p>大佬的文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1R1eGVkb0xpbnV4L2FydGljbGUvZGV0YWlscy8xMDA5MjE5OTQ=\">栈帧 ebp,esp 详解_TuxedoLinux 的博客 - CSDN 博客_ebp esp</span></p>\n<h4 id=\"提升堆栈\"><a class=\"markdownIt-Anchor\" href=\"#提升堆栈\">#</a> <strong>提升堆栈</strong></h4>\n<p>对应语句为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401060 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">00401061  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401063  |.  83EC 48       sub     esp,0x40</span><br></pre></td></tr></table></figure>\n<p>将堆栈提升了 0x40</p>\n<p>将 esp 的值减去 0x40=64，我们这里的相差的数据宽度为 4 即 16,64/4=16，因此堆栈图里多了 16 格（蓝色部分），这种操作常被叫做<strong>提升堆栈</strong>，此时堆栈图为：</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20210228212917496.png\" alt=\"image-20210228212917496\" style=\"zoom:50%;\" />\n<p>此时 ESP 指向新的栈顶，蓝色区域为我们 CALL 0040100A 之后新的栈，下面的区域为原来的栈</p>\n<p>此时蓝色中的数据为脏数据，因为栈中放的是临时数据，可能是之前没有清理的数据</p>\n<h4 id=\"保护现场\"><a class=\"markdownIt-Anchor\" href=\"#保护现场\">#</a> <strong>保护现场</strong></h4>\n<p>对应语句为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401066  |.  53            push    ebx</span><br><span class=\"line\">00401067  |.  56            push    esi</span><br><span class=\"line\">00401068  |.  57            push    edi</span><br></pre></td></tr></table></figure>\n<p>将 ebx、esi、edi 三个通用寄存器保存到堆栈中，前面的 push ebp 其实也属于保护现场</p>\n<h4 id=\"初始化提升的堆栈\"><a class=\"markdownIt-Anchor\" href=\"#初始化提升的堆栈\">#</a> <strong>初始化提升的堆栈</strong></h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401069  |.  8D7D B8       lea     edi,dword ptr ss:[ebp-0x48]  ;就是将刚开始的esp给的edi</span><br><span class=\"line\">0040106C  |.  B9 12000000   mov     ecx,0x12     ;ecx是为了之后的rep做准备的，ecx是rep循环次数</span><br><span class=\"line\">00401071  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC     ;使用CC防止缓冲溢出</span><br><span class=\"line\">00401076  |.  F3:AB         rep     stos dword ptr es:[edi]  ;将eax的值赋值给edi所指向的内存地址里的值，并且每执行一次edi都会增加4（D标志位为0所以是增加</span><br></pre></td></tr></table></figure>\n<p>这里将我们提升的堆栈中的内容全部初始化为 CCCCCCCC</p>\n<p>为什么是初始化为 CC？防止<strong>缓冲</strong>溢出</p>\n<p>CC 的<strong>硬编码</strong>对应的指令为 int 3，即断点</p>\n<p>这么做有什么好处呢？当程序执行超过缓冲区时，遇到 int 3 就会自动停下来</p>\n<h4 id=\"执行实际的内容\"><a class=\"markdownIt-Anchor\" href=\"#执行实际的内容\">#</a> 执行实际的内容</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401058 |. 8B45 08    mov eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">0040105B |. 0345 0C    add eax,dword ptr ss:[ebp+0xC]</span><br></pre></td></tr></table></figure>\n<p>就是将前面压入的参数 2 和 1 进行相加得到 3</p>\n<h4 id=\"恢复现场\"><a class=\"markdownIt-Anchor\" href=\"#恢复现场\">#</a> 恢复现场</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401145  |.  5F            pop     edi</span><br><span class=\"line\">00401146  |.  5E            pop     esi</span><br><span class=\"line\">00401147  |.  5B            pop     ebx</span><br><span class=\"line\">00401148  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">0040114A  |.  5D            pop     ebp</span><br></pre></td></tr></table></figure>\n<p>与前面保护现场相对应</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20210228224826624.png\" alt=\"image-20210228224826624\" style=\"zoom:50%;\" />\n<h4 id=\"返回\"><a class=\"markdownIt-Anchor\" href=\"#返回\">#</a> 返回</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0040114B  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<h4 id=\"call返回后\"><a class=\"markdownIt-Anchor\" href=\"#call返回后\">#</a> CALL 返回后</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0040112B  |.  83C4 0C       add     esp,0xC</span><br></pre></td></tr></table></figure>\n<p>作用为平衡堆栈</p>\n<p>注意 CALL 之前和 CALL 之后，其前后环境要一致，这就是所谓的<strong>堆栈平衡</strong></p>\n<h4 id=\"堆栈平衡\"><a class=\"markdownIt-Anchor\" href=\"#堆栈平衡\">#</a> 堆栈平衡</h4>\n<p>如果通过堆栈传递参数了。那么在程序执行完毕后，要平衡因参数导致的堆栈变化</p>\n<p>当我们使用堆栈传参的时候，在程序执行完毕后这些参数应该一起被清理掉，也就是加了几条参数，就要在堆栈中加几个地址，这么做可以理解为清理垃圾。</p>\n<p>处理方法：</p>\n<p>第一种 ：在函数外部添加 ADD 处理</p>\n<p>第二种：在函数内部添加 ret8</p>\n<h4 id=\"逆推c语言代码\"><a class=\"markdownIt-Anchor\" href=\"#逆推c语言代码\">#</a> 逆推 C 语言代码</h4>\n<p>根据我们前面的分析，我们不难发现这其实就是个简单的加法函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void func(int m, int n) &#123;</span><br><span class=\"line\">    int a, b;</span><br><span class=\"line\">    a = m;</span><br><span class=\"line\">    b = n;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuNTJwb2ppZS5jbi90aHJlYWQtMTM3OTk1Mi0xLTEuaHRtbA==\">逆向基础笔记七 堆栈图（重点） - 『软件调试区』 - 吾爱破解 - LCG - LSG | 安卓破解 | 病毒分析 | www.52pojie.cn</span></p>\n<p>我们最后在总结一下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401060 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">;现在到了一个新的函数，需要有自己的栈底，因此需要把上一个栈底保存起来，栈顶不用保存，因为栈顶是新函数的栈底</span><br><span class=\"line\">00401061  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00401063  |.  83EC 48       sub     esp,0x48</span><br><span class=\"line\">;堆栈提升</span><br><span class=\"line\">00401066  |.  53            push    ebx</span><br><span class=\"line\">00401067  |.  56            push    esi</span><br><span class=\"line\">00401068  |.  57            push    edi</span><br><span class=\"line\">;保护现场，为了retn后回恢复</span><br><span class=\"line\">00401069  |.  8D7D B8       lea     edi,[local.18]</span><br><span class=\"line\">0040106C  |.  B9 12000000   mov     ecx,0x12</span><br><span class=\"line\">00401071  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401076  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">;初始化堆栈，防止脏数据</span><br><span class=\"line\">00401078  |.  C745 FC 03000&gt;mov     [local.1],0x3</span><br><span class=\"line\">0040107F  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class=\"line\">00401086  |.  8B45 F8       mov     eax,[local.2]</span><br><span class=\"line\">00401089  |.  50            push    eax</span><br><span class=\"line\">0040108A  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">0040108D  |.  51            push    ecx</span><br><span class=\"line\">;形参压入栈中</span><br><span class=\"line\">0040108E  |.  E8 72FFFFFF   call    00401005</span><br><span class=\"line\">;调用add函数</span><br><span class=\"line\">00401093  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">;堆栈平衡，将esp带回call以前的位置，call之前push了两次，2*4=8</span><br><span class=\"line\">00401096  |.  68 1C204200   push    0042201C                         ; /format = &quot;Hello World!</span><br><span class=\"line\">0040109B  |.  E8 30000000   call    printf                           ; \\printf</span><br><span class=\"line\">;嗲用printf函数，操作和上面调用add一样</span><br><span class=\"line\">004010A0  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">;堆栈平衡</span><br><span class=\"line\">004010A3  |.  33C0          xor     eax,eax</span><br><span class=\"line\">004010A5  |.  5F            pop     edi</span><br><span class=\"line\">004010A6  |.  5E            pop     esi</span><br><span class=\"line\">004010A7  |.  5B            pop     ebx</span><br><span class=\"line\">;恢复现场</span><br><span class=\"line\">004010A8  |.  83C4 48       add     esp,0x48</span><br><span class=\"line\">004010AB  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">004010AD  |.  E8 9E000000   call    _chkesp</span><br><span class=\"line\">004010B2  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">004010B4  |.  5D            pop     ebp</span><br><span class=\"line\">004010B5  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>分配堆栈向下减少。堆栈传递参数向上相加</p>\n<h4 id=\"堆栈结构图重点\"><a class=\"markdownIt-Anchor\" href=\"#堆栈结构图重点\">#</a> 堆栈结构图（重点）</h4>\n<ol>\n<li>调用 CALL 又可以分为六个部分：</li>\n<li>提升堆栈</li>\n<li>保护现场</li>\n<li>初始化提升的堆栈</li>\n<li>执行实际内容</li>\n<li>恢复现场</li>\n<li>返回</li>\n</ol>\n<h3 id=\"如何右键启动od\"><a class=\"markdownIt-Anchor\" href=\"#如何右键启动od\">#</a> 如何右键启动 od</h3>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108181646294.png\" alt=\"image-20221108181646294\"></p>\n<p>通过以上方式右键启动 od</p>\n<h3 id=\"标志寄存器\"><a class=\"markdownIt-Anchor\" href=\"#标志寄存器\">#</a> 标志寄存器</h3>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108181822816.png\" alt=\"image-20221108181822816\"></p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108193731856.png\" alt=\"image-20221108193731856\" style=\"zoom:80%;\" />\n<ol>\n<li>进位标志 CF (Carry Flag)</li>\n<li>奇偶标志 PF (Parity  Flag)</li>\n<li>辅助进位标志 AF (Auxiliary  Carry Flag)</li>\n<li>零标志 ZF (Zero  Flag)</li>\n<li>符号标志 SF (Sign  Flag)</li>\n<li>溢出标志 OF (Overflow  Flag)</li>\n<li>方向标志 DF (Direction Flag)</li>\n</ol>\n<h4 id=\"进位标志cfcarry-flag\"><a class=\"markdownIt-Anchor\" href=\"#进位标志cfcarry-flag\">#</a> 进位标志 CF (Carry Flag)</h4>\n<p>如果运算结果的<strong>最高位</strong>产生了一个进位或借位，那么，其值为 1，否则其值为 0</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm&#123;</span><br><span class=\"line\">\t\tpushad   <span class=\"comment\">//通用寄存器入栈</span></span><br><span class=\"line\">\t\tpushfd   <span class=\"comment\">//标志寄存器入栈</span></span><br><span class=\"line\">\t\tmov al,<span class=\"number\">0xff</span></span><br><span class=\"line\">\t\tadd al,<span class=\"number\">1</span> <span class=\"comment\">//C,P,A,Z = 1</span></span><br><span class=\"line\">\t\tpopad</span><br><span class=\"line\">\t\tpopfd</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"奇偶标志pfparity-flag\"><a class=\"markdownIt-Anchor\" href=\"#奇偶标志pfparity-flag\">#</a> 奇偶标志 PF (Parity Flag)</h4>\n<p>奇偶标志 PF 用于反映运算结果中<strong>最低有效字节</strong>中 “1” 的个数的奇偶性，如果 “1” 的个数为偶数，则 PF 的值为 1，否则其值为 0。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MOV AX,803</span><br><span class=\"line\">ADD AX,1</span><br><span class=\"line\">0x804: 0000 1000 0000 0100        总共2个1 ,PF应为1，但实际运行结果PF为0</span><br><span class=\"line\">因为PF是根据最低有效字节来看，即804后面04的这部分</span><br></pre></td></tr></table></figure>\n<h4 id=\"辅助进位标志afauxiliary-carry-flag\"><a class=\"markdownIt-Anchor\" href=\"#辅助进位标志afauxiliary-carry-flag\">#</a> 辅助进位标志 AF (Auxiliary Carry Flag)</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在发生下列情况时，辅助进位标志AF的值被置为1，否则其值为0：</span><br><span class=\"line\"></span><br><span class=\"line\">在字操作时，发生低字节向高字节进位或借位时</span><br><span class=\"line\">在字节操作时，发生低4位向高4位进位或借位时</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>AF 与<strong>数据宽度</strong>相关</p>\n<p>32 位时 FFFF <strong>F</strong> FFF</p>\n<p>16 位时 FF <strong>F</strong> F</p>\n<p>8 位时 F <strong>F</strong></p>\n<p>加黑的字体为 AF 标志位判断的位置，如果该位置要向前进位则 AF 为 1，否则为 0，和 CF 相似，不过判断的位置不同</p>\n</blockquote>\n<h4 id=\"零标志zfzero-flag\"><a class=\"markdownIt-Anchor\" href=\"#零标志zfzero-flag\">#</a> 零标志 ZF (Zero Flag)</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">零标志ZF用来反映运算结果是否为0</span><br><span class=\"line\">如果运算结果为0，则其值为1，否则其值为0</span><br><span class=\"line\">作用：在判断运算结果是否为0时，可使用此标志位</span><br><span class=\"line\">XOR EAX,EAX   //通过xor将eax清零，会改变zf标志位为1</span><br><span class=\"line\">MOV EAX,0     //通过MOV将EAX赋值为0，非运算，不改变zf标志位</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"符号标志sfsign-flag\"><a class=\"markdownIt-Anchor\" href=\"#符号标志sfsign-flag\">#</a> 符号标志 SF (Sign Flag)</h4>\n<blockquote>\n<p>符号标志 SF 用来反映运算结果的符号位，它与运算结果的最高位相同</p>\n</blockquote>\n<h4 id=\"溢出标志ofoverflow-flag\"><a class=\"markdownIt-Anchor\" href=\"#溢出标志ofoverflow-flag\">#</a> 溢出标志 OF (Overflow Flag)</h4>\n<blockquote>\n<p>溢出标志 OF 用于反映有符号数加减运算所得结果是否溢出</p>\n<p>进位标志表示<strong>无符号数</strong>运算结果是否超出范围.</p>\n<p>溢出标志表示<strong>有符号数</strong>运算结果是否超出范围.</p>\n<ul>\n<li>正 + 正 = 正 如果结果是负数，则说明有溢出</li>\n<li>负 + 负 = 负 如果结果是正数，则说明有溢出</li>\n<li>正 + 负 永远都不会有溢出</li>\n</ul>\n<p>CPU 如何计算 OF</p>\n<ul>\n<li>符号位有进位</li>\n<li>最高有效数值位向符号位产生的进位</li>\n</ul>\n<p>对于一个有符号数：如 0x80 和 0xC0</p>\n<p>符号位有进位</p>\n<p>0x80:<strong>1</strong> 000 0000</p>\n<p>0xC0:<strong>1</strong> 100 0000</p>\n<p>最高有效数值位向符号位产生的进位</p>\n<p>0x80:1 <strong>0</strong> 00 0000</p>\n<p>0xC0:1 <strong>1</strong> 00 0000</p>\n<p>就是运算 0x80+0xc0</p>\n<p>0x80:<strong>1</strong> <strong>0</strong> 00 0000</p>\n<p>0xC0:<strong>1</strong> <strong>1</strong> 00 0000</p>\n<p>符号位 1+1 有产生进位，于是符号位有进位为 1</p>\n<p>最高有效数值位向符号位产生的进位 0+1 没有产生进位，于是最高有效数值位向符号位产生的进位为 0</p>\n<p><strong>OF = 符号位有进位 xor 最高有效数值位向符号位产生的进位</strong></p>\n<p>OF = 1 xor 0 = 1 所以此时 OF=1</p>\n</blockquote>\n<h4 id=\"方向标志dfdirection-flag\"><a class=\"markdownIt-Anchor\" href=\"#方向标志dfdirection-flag\">#</a> 方向标志 DF (Direction Flag)</h4>\n<blockquote>\n<p>DF=1 时串操作为减地址方式 DF=0 为增地址方式</p>\n</blockquote>\n<h3 id=\"相关汇编指令\"><a class=\"markdownIt-Anchor\" href=\"#相关汇编指令\">#</a> 相关汇编指令</h3>\n<blockquote>\n<p>ADC 指令：带进位加法</p>\n<p>SBB 指令：带借位减法</p>\n<p>XCHG 指令：交换数据</p>\n<p>格式：XCHG R/M,R/M 两边不能同时为内存  <strong>数据宽度</strong>要一样</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MOV AL,1</span><br><span class=\"line\">MOV CL,2</span><br><span class=\"line\">XCHG AL,CL</span><br><span class=\"line\">执行前：AL=1 CL=2</span><br><span class=\"line\">执行后：AL=2 CL=1</span><br></pre></td></tr></table></figure>\n<p>MOVS 指令：移动数据 内存 - 内存</p>\n<p>MOVS 指令常用于复制字符串</p>\n<p>可以将不同宽度的指令简写为 movsb movsw movsd</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MOV EDI,12FFD8</span><br><span class=\"line\">MOV ESI,12FFD0</span><br><span class=\"line\">MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI]</span><br><span class=\"line\">EDI内存里的值被修改为ESI内存里的值，且EDI和ESI各加4,和DOWRD数据宽度相关，如果为WORD 则各加2</span><br><span class=\"line\">由DF（Direction Flag）方向标志位决定，当DF位为1时为减，当DF位为0时，则为加</span><br></pre></td></tr></table></figure>\n<p>movsx 操作数 A，操作数 B  符号扩展传送</p>\n<p>movzx 零扩展传送</p>\n<p>movsx，movzx 操作数 A 的空间必须大于操作数 b</p>\n<p>如果大的给小的，会产生截断</p>\n<p>STOS 指令</p>\n<p>将 Al/AX/EAX 的值存储到 [EDI] 指定的内存单元，和<strong>数据宽度</strong>相关</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">STOS BYTE PTR ES:[EDI]                将AL存储到[EDI]</span><br><span class=\"line\">STOS WORD PTR ES:[EDI]                将AX存储到[EDI]</span><br><span class=\"line\">STOS DWORD PTR ES:[EDI]                将EAX存储到[EDI]</span><br><span class=\"line\">注意这里使用的是ES</span><br><span class=\"line\">当后面为[EDI]时要使用ES</span><br><span class=\"line\">存储完数据后EDI地址的变化方向也受DF标志控制，1减0增</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00401019  |.  8D7D C0       lea     edi,[local.16]</span><br><span class=\"line\">0040101C  |.  B9 10000000   mov     ecx,0x10</span><br><span class=\"line\">00401021  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00401026  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">现在在看看这几行代码，先把eax的值变为cccccccc，stos将其存储到es中，通过rep循环存储</span><br></pre></td></tr></table></figure>\n<p>REP 指令</p>\n<p>按计数寄存器 (ECX) 中指定的次数重复执行指令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MOV ECX,10</span><br><span class=\"line\">REP MOVS DWORD PTR ES:[EDI],DWORD PTR DS:[ESI]        也可以写成REP MOVSD</span><br><span class=\"line\">代码将会重复执行16次</span><br><span class=\"line\">因为每执行一次EDI和ESI都会变化4，变化方向由DF决定</span><br></pre></td></tr></table></figure>\n<p>LEA 指令</p>\n<p>地址传送指令</p>\n<p>将操作数 B 的有效地址传送到指定的某个寄存器，操作数 A 必须是寄存器</p>\n</blockquote>\n<h3 id=\"跳转和比较指令\"><a class=\"markdownIt-Anchor\" href=\"#跳转和比较指令\">#</a> 跳转和比较指令</h3>\n<h4 id=\"jcc指令\"><a class=\"markdownIt-Anchor\" href=\"#jcc指令\">#</a> JCC 指令</h4>\n<blockquote>\n<p>cc 代表 condition code (状态码)</p>\n<p>Jcc 不是单个指令，它只是描述了跳转之前检查条件代码的跳转助记符</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221031210918994.png\" alt=\"image-20221031210918994\" style=\"zoom: 50%;\" />\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY3MucHJpbmNldG9uLmVkdS9jb3Vyc2VzL2FyY2hpdmUvZmFsbDEyL2NvczM3NS9JQTMySmNjLnBkZg==\">https://www.cs.princeton.edu/courses/archive/fall12/cos375/IA32Jcc.pdf</span></p>\n<p>JCC 指令用于改变 EIP（CPU 要读取的指令地址）</p>\n</blockquote>\n<h4 id=\"jmp指令\"><a class=\"markdownIt-Anchor\" href=\"#jmp指令\">#</a> JMP 指令</h4>\n<p>JMP 指令：修改 EIP 的值</p>\n<p>JMP 指令只影响了 EIP，不影响堆栈和其它通用寄存器</p>\n<p>JMP 寄存器 / 立即数相当于 MOV EIP, 寄存器 / 立即数</p>\n<h4 id=\"call指令\"><a class=\"markdownIt-Anchor\" href=\"#call指令\">#</a> CALL 指令</h4>\n<p>CALL 指令和 JMP 指令都会修改 EIP 的值</p>\n<p>但 CALL 指令会将返回地址（CALL 指令的下一条指令地址）压入堆栈</p>\n<p>因此也会引起 esp 的变化</p>\n<h4 id=\"ret指令\"><a class=\"markdownIt-Anchor\" href=\"#ret指令\">#</a> RET 指令</h4>\n<p>call 调用跳转后执行完相关代码完要返回到 call 的下一条指令时使用 ret 指令</p>\n<p>ret 指令相当于 pop eip</p>\n<h4 id=\"cmp指令\"><a class=\"markdownIt-Anchor\" href=\"#cmp指令\">#</a> CMP 指令</h4>\n<p>指令格式：CMP R/M,R/M/IMM</p>\n<p>CMP 指令只改变标志寄存器的值</p>\n<p>该指令是比较两个操作数，实际上，它相当于 SUB 指令，但是相减的结果并不保存到第一个操作数中</p>\n<p>只是根据相减的结果来改变 ZF 零标志位的，当两个操作数相等的时候，零标志位置 1</p>\n<h4 id=\"test指令\"><a class=\"markdownIt-Anchor\" href=\"#test指令\">#</a> TEST 指令</h4>\n<p>指令格式：TEST R/M,R/M/IMM</p>\n<p>该指令在一定程度上和 CMP 指令时类似的，两个数值进行与操作，结果不保存，但是会改变相应标志位</p>\n<p>常见用法：用这个指令，可以确定某寄存器是否等于 0</p>\n<p>观察 ZF（零标志位）就可以判断 EAX 是否为 0</p>\n<h3 id=\"if指令编译结果\"><a class=\"markdownIt-Anchor\" href=\"#if指令编译结果\">#</a> if 指令编译结果</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">int main(int argc, char* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a = 1;</span><br><span class=\"line\">\tif (a == 1) &#123;</span><br><span class=\"line\">\t\tprintf(&quot;%d\\n&quot;,11);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse &#123;</span><br><span class=\"line\">\t\tprintf(&quot;%d\\n&quot;,22);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0040D440 &gt;/&gt; \\55            push    ebp</span><br><span class=\"line\">0040D441  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">0040D443  |.  83EC 44       sub     esp,0x44</span><br><span class=\"line\">0040D446  |.  53            push    ebx</span><br><span class=\"line\">0040D447  |.  56            push    esi</span><br><span class=\"line\">0040D448  |.  57            push    edi</span><br><span class=\"line\">0040D449  |.  8D7D BC       lea     edi,[local.17]</span><br><span class=\"line\">0040D44C  |.  B9 11000000   mov     ecx,0x11</span><br><span class=\"line\">0040D451  |.  B8 CCCCCCCC   mov     eax,0xCCCCCCCC</span><br><span class=\"line\">0040D456  |.  F3:AB         rep     stos dword ptr es:[edi]</span><br><span class=\"line\">//上面都是堆栈提升，初始化堆栈，if从这里开始</span><br><span class=\"line\"></span><br><span class=\"line\">// a=1</span><br><span class=\"line\">0040D458  |.  C745 FC 01000&gt;mov     dword ptr ss:[ebp-0x4],0x1</span><br><span class=\"line\">// a==1?a=11:a=22</span><br><span class=\"line\">// 如果a!=1 jmp 0040D476</span><br><span class=\"line\">// 如果a!=1 printf(11) jmp(0040D485)</span><br><span class=\"line\">// jmp(0040D485)就是跳转到if判断结束的地方，继续执行下面的语句</span><br><span class=\"line\">0040D45F  |.  837D FC 01    cmp     dword ptr ss:[ebp-0x4],0x1</span><br><span class=\"line\">0040D463  |.  75 11         jnz     short 0040D476</span><br><span class=\"line\">0040D465  |.  6A 0B         push    0xB                              ; /&lt;%d&gt; = B (11.)</span><br><span class=\"line\">0040D467  |.  68 0C214200   push    0042210C                         ; |format = &quot;%d</span><br><span class=\"line\"></span><br><span class=\"line\">0040D46C  |.  E8 4F020000   call    printf                           ; \\printf</span><br><span class=\"line\">0040D471  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">0040D474  |.  EB 0F         jmp     short 0040D485</span><br><span class=\"line\">0040D476  |&gt;  6A 16         push    0x16                             ; /&lt;%d&gt; = 16 (22.)</span><br><span class=\"line\">0040D478  |.  68 0C214200   push    0042210C                         ; |format = &quot;%d</span><br><span class=\"line\"></span><br><span class=\"line\">0040D47D  |.  E8 3E020000   call    printf                           ; \\printf</span><br><span class=\"line\">0040D482  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">0040D485  |&gt;  33C0          xor     eax,eax</span><br><span class=\"line\">0040D487  |.  5F            pop     edi</span><br><span class=\"line\">0040D488  |.  5E            pop     esi</span><br><span class=\"line\">0040D489  |.  5B            pop     ebx</span><br><span class=\"line\">0040D48A  |.  83C4 44       add     esp,0x44</span><br><span class=\"line\">0040D48D  |.  3BEC          cmp     ebp,esp</span><br><span class=\"line\">0040D48F  |.  E8 BC3BFFFF   call    _chkesp</span><br><span class=\"line\">0040D494  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">0040D496  |.  5D            pop     ebp</span><br><span class=\"line\">0040D497  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"反汇编分析c语言\"><a class=\"markdownIt-Anchor\" href=\"#反汇编分析c语言\">#</a> 反汇编分析 C 语言</h3>\n<p>有了之前画堆栈图的经验，我们不难看出，尽管我们的函数是个空函数，但其汇编代码依然完成了以下流程：</p>\n<ol>\n<li>提升堆栈</li>\n<li>保护现场</li>\n<li>初始化提升的堆栈</li>\n<li>恢复现场</li>\n<li>返回</li>\n</ol>\n<figure class=\"highlight go\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">提升堆栈</span><br><span class=\"line\"> 复制代码 隐藏代码</span><br><span class=\"line\"><span class=\"number\">00401010</span>   push        ebp</span><br><span class=\"line\"><span class=\"number\">00401011</span>   mov         ebp,esp</span><br><span class=\"line\"><span class=\"number\">00401013</span>   sub         esp,<span class=\"number\">40</span>h</span><br><span class=\"line\">保护现场</span><br><span class=\"line\"> 复制代码 隐藏代码</span><br><span class=\"line\"><span class=\"number\">00401016</span>   push        ebx</span><br><span class=\"line\"><span class=\"number\">00401017</span>   push        esi</span><br><span class=\"line\"><span class=\"number\">00401018</span>   push        edi</span><br><span class=\"line\">PS：前面的push        ebp也是保护现场</span><br><span class=\"line\"></span><br><span class=\"line\">初始化提升的堆栈</span><br><span class=\"line\"> 复制代码 隐藏代码</span><br><span class=\"line\"><span class=\"number\">00401019</span>   lea         edi,[ebp<span class=\"number\">-40</span>h]</span><br><span class=\"line\"><span class=\"number\">0040101</span>C   mov         ecx,<span class=\"number\">10</span>h</span><br><span class=\"line\"><span class=\"number\">00401021</span>   mov         eax,<span class=\"number\">0</span>CCCCCCCCh</span><br><span class=\"line\"><span class=\"number\">00401026</span>   rep stos    dword ptr [edi]</span><br><span class=\"line\">恢复现场</span><br><span class=\"line\"> 复制代码 隐藏代码</span><br><span class=\"line\"><span class=\"number\">00401028</span>   pop         edi</span><br><span class=\"line\"><span class=\"number\">00401029</span>   pop         esi</span><br><span class=\"line\"><span class=\"number\">0040102</span>A   pop         ebx</span><br><span class=\"line\"><span class=\"number\">0040102</span>B   mov         esp,ebp</span><br><span class=\"line\"><span class=\"number\">0040102</span>D   pop         ebp</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108201930358.png\" alt=\"image-20221108201930358\"></p>\n<h3 id=\"内联汇编\"><a class=\"markdownIt-Anchor\" href=\"#内联汇编\">#</a> 内联汇编</h3>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;stdafx.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;windows.h&gt;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&lt;stdio.h&gt;</span></span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"type\">int</span> <span class=\"title function_\">main</span><span class=\"params\">(<span class=\"type\">int</span> argc, <span class=\"type\">char</span>* argv[])</span></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm&#123;</span><br><span class=\"line\">\t\tpushad   <span class=\"comment\">//通用寄存器入栈</span></span><br><span class=\"line\">\t\tpushfd   <span class=\"comment\">//标志寄存器入栈</span></span><br><span class=\"line\">\t\tmov al,<span class=\"number\">0xff</span></span><br><span class=\"line\">\t\tadd al,<span class=\"number\">1</span> <span class=\"comment\">//C,P,A,Z = 1</span></span><br><span class=\"line\">\t\tpopad</span><br><span class=\"line\">\t\tpopfd</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>使用 VS2008 创建一个 win32 application</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108192317976.png\" alt=\"image-20221108192317976\"></p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1654239398565-0af1e19d-f2a4-4772-b49a-495dcdf19dca.png\" alt=\"img\"></p>\n<p>使用多线程 /mt 之后，用户运行时不需要库既可运行，但文件会变大</p>\n<p>编译一个内联函数</p>\n<p>nake 声明一个裸函数，即堆栈的申请释放都需要我们自己进行</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;Windows.h&gt;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int __declspec (naked) Plus()&#123;</span><br><span class=\"line\">                __asm&#123;</span><br><span class=\"line\">\t\t\t\t\t\tpushad</span><br><span class=\"line\">\t\t\t\t\t\txor     eax,eax</span><br><span class=\"line\">\t\t\t\t\t\tcmp     byte ptr ds:[0x4F040],al</span><br><span class=\"line\">\t\t\t\t\t\tretn</span><br><span class=\"line\">\t\t\t\t\t\tpopad</span><br><span class=\"line\">        &#125;        </span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPlus();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Plus () 对应的汇编代码为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00FC2240 &gt; &gt; \\60            pushad</span><br><span class=\"line\">00FC2241   .  33C0          xor     eax,eax</span><br><span class=\"line\">00FC2243      61            popad                       </span><br></pre></td></tr></table></figure>\n<p>正常的函数：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">int Plus()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint x=1+2;</span><br><span class=\"line\">\treturn 1;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPlus();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">003813A0 &gt;  55              push    ebp</span><br><span class=\"line\">003813A1    8BEC            mov     ebp,esp</span><br><span class=\"line\">003813A3    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">003813A9    53              push    ebx</span><br><span class=\"line\">003813AA    56              push    esi</span><br><span class=\"line\">003813AB    57              push    edi</span><br><span class=\"line\">003813AC    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">003813B2    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">003813B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">003813BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">003813BE    C745 F8 0300000&gt;mov     dword ptr ss:[ebp-0x8],0x3</span><br><span class=\"line\">003813C5    B8 01000000     mov     eax,0x1</span><br><span class=\"line\">003813CA    5F              pop     edi</span><br><span class=\"line\">003813CB    5E              pop     esi</span><br><span class=\"line\">003813CC    5B              pop     ebx</span><br><span class=\"line\">003813CD    8BE5            mov     esp,ebp</span><br><span class=\"line\">003813CF    5D              pop     ebp</span><br><span class=\"line\">003813D0    C3              retn</span><br></pre></td></tr></table></figure>\n<p>正常的函数系统会自动帮我们进行堆栈的操作我们只需要关系自己的代码即可</p>\n<h3 id=\"寻找c程序入口\"><a class=\"markdownIt-Anchor\" href=\"#寻找c程序入口\">#</a> 寻找 C 程序入口</h3>\n<p>为什么能看到 wmain 的名称</p>\n<p>因为有 pdb 文件，od 读取 pdb 读取 debug 信息</p>\n<p>PDB 全称为程序数据库文件，存储了被编译文件的调试信息，一般用在调式程序中</p>\n<p>1. 找到 wmainCRTStartup</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210348946.png\" alt=\"image-20221108210348946\"></p>\n<p>2. 找到__tmainCRTStartup</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210432400.png\" alt=\"image-20221108210432400\"></p>\n<p>3. 这个 call 002C108C 就是我们的 main 函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">002C260E   .  FF35 70F02D00 push    dword ptr ds:[__wargv]</span><br><span class=\"line\">002C2614   .  FF35 68F02D00 push    dword ptr ds:[__argc]</span><br><span class=\"line\">002C261A   .  E8 6DEAFFFF   call    002C108C</span><br></pre></td></tr></table></figure>\n<p>4.wmain 就是我们的 main 函数</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210639094.png\" alt=\"image-20221108210639094\"></p>\n<blockquote>\n<p>mainCRTStartup 和 wmainCRTStartup 是控制台环境下多字节编码和 Unicode 编码的启动函数</p>\n<p>而 WinMainCRTStartup 和 wWinMainCRTStartup 是 windows 环境下多字节编码和 Unicode 编码的启动函数</p>\n<p>mainCRTStartup 做了哪些事：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210737730.png\" alt=\"image-20221108210737730\"></p>\n<ol>\n<li>前面我们已经知道了 mainCRTStartup 也就是程序入口，那么如何通过 mainCRTStartup 来找到 main 函数入口</li>\n<li>根据函数的参数来进行判断</li>\n<li>main 函数貌似只有两个参数，但实际上 main 函数一共有三个参数，只不过一般第三个参数我们并没有用到，于是在使用 main 函数时并没有加上，完整的 main 函数原型如下:</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int main(int argc,char *argv[],char *envp[])&#123;&#125;</span><br></pre></td></tr></table></figure>\n<p>这里的 argv 和 envp 对应 mainCRTStartup 里_setargv () 和_setenvp ()</p>\n<p>main 中参数</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221108210850705.png\" alt=\"image-20221108210850705\"></p>\n</blockquote>\n<p>另一种歪门邪道：</p>\n<p>找一个有标示性的断点</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221111213357060.png\" alt=\"image-20221111213357060\"></p>\n<p>下断，跳转到断点，F9 执行到断点</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221111213436905.png\" alt=\"image-20221111213436905\"></p>\n<p>在堆栈窗口中选中，enter 建进入 main</p>\n<p>或者在有 printf 或者 MessageBox 时可以 F9   CTRL+F9</p>\n<h3 id=\"调试方式\"><a class=\"markdownIt-Anchor\" href=\"#调试方式\">#</a> 调试方式</h3>\n<p>1.OD 直接打开</p>\n<p>2. 附加到已经打开的进程</p>\n<h3 id=\"od常用操作\"><a class=\"markdownIt-Anchor\" href=\"#od常用操作\">#</a> OD 常用操作</h3>\n<p>F9 程序运行到所设断点处</p>\n<p>F2 设置软件断点</p>\n<p>ALT+C 初始页面</p>\n<p>bp  指令地址    设置软件断点</p>\n<p>bc 清除断点</p>\n<p>dd ecx / 内存地址  查看 ecx 寄存器，寄存器中值 以双字显示</p>\n<p>dw 以字显示</p>\n<p>db 以字节显示</p>\n<p>dc 以字符串显示数据</p>\n<p>? 计算表达式</p>\n<p>F8 单步步过</p>\n<p>F7 单步步入</p>\n<p>CTRL + F9  执行到返回</p>\n<p>ALT + F9 执行到用户代码</p>\n<p>CTRL+F2 重新开始</p>\n<p>转到地址 Ctrl +G</p>\n<p>断点窗口 Alt +B</p>\n<p><code>-</code>  到上一步</p>\n<p><code>* </code> 转到当前指令地址</p>\n<p><code>+</code>  转到下一步</p>\n<p>选中汇编，按空格，输入汇编代码</p>\n<h3 id=\"函数调用\"><a class=\"markdownIt-Anchor\" href=\"#函数调用\">#</a> 函数调用</h3>\n<p>注意先关闭 c/c++ 优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">int add(int a, int b)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\treturn a+b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int aaa=1;</span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tMessageBox(0,NULL,NULL,MB_OK);</span><br><span class=\"line\">\taaa = add(3,4);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"release\"><a class=\"markdownIt-Anchor\" href=\"#release\">#</a> release</h4>\n<p>优化的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00371000 &gt;/$  6A 00         push    0x0                              ; /Style = MB_OK|MB_APPLMODAL</span><br><span class=\"line\">00371002  |.  6A 00         push    0x0                              ; |Title = NULL</span><br><span class=\"line\">00371004  |.  6A 00         push    0x0                              ; |Text = NULL</span><br><span class=\"line\">00371006  |.  6A 00         push    0x0                              ; |hOwner = NULL</span><br><span class=\"line\">00371008  |.  FF15 A4203700 call    dword ptr ds:[&lt;&amp;USER32.MessageBo&gt;; \\MessageBoxW</span><br><span class=\"line\">0037100E  |.  C705 18303700&gt;mov     dword ptr ds:[aaa],0x7</span><br><span class=\"line\">00371018  |.  33C0          xor     eax,eax</span><br><span class=\"line\">0037101A  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>未被优化的</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">012B1010 &gt;/$  55            push    ebp</span><br><span class=\"line\">012B1011  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">012B1013  |.  6A 00         push    0x0                                            ; /Style = MB_OK|MB_APPLMODAL</span><br><span class=\"line\">012B1015  |.  6A 00         push    0x0                                            ; |Title = NULL</span><br><span class=\"line\">012B1017  |.  6A 00         push    0x0                                            ; |Text = NULL</span><br><span class=\"line\">012B1019  |.  6A 00         push    0x0                                            ; |hOwner = NULL</span><br><span class=\"line\">012B101B  |.  FF15 E4802B01 call    dword ptr ds:[&lt;&amp;USER32.MessageBoxW&gt;]           ; \\MessageBoxW</span><br><span class=\"line\">012B1021  |.  6A 04         push    0x4</span><br><span class=\"line\">012B1023  |.  6A 03         push    0x3</span><br><span class=\"line\">012B1025  |.  E8 D6FFFFFF   call    add</span><br><span class=\"line\">012B102A  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">012B102D  |.  A3 40AC2B01   mov     dword ptr ds:[aaa],eax</span><br><span class=\"line\">012B1032  |.  33C0          xor     eax,eax</span><br><span class=\"line\">012B1034  |.  5D            pop     ebp</span><br><span class=\"line\">012B1035  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>如果我们此时将代码改为如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">int add(int a, int b)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\treturn a+b;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int aaa=1;</span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tMessageBox(0,NULL,NULL,MB_OK);</span><br><span class=\"line\">\taaa = add(aaa,4);</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00EB13F0 &gt;  55              push    ebp</span><br><span class=\"line\">00EB13F1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00EB13F3    81EC C0000000   sub     esp,0xC0</span><br><span class=\"line\">00EB13F9    53              push    ebx</span><br><span class=\"line\">00EB13FA    56              push    esi</span><br><span class=\"line\">00EB13FB    57              push    edi</span><br><span class=\"line\">00EB13FC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class=\"line\">00EB1402    B9 30000000     mov     ecx,0x30</span><br><span class=\"line\">00EB1407    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00EB140C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00EB140E    8BF4            mov     esi,esp</span><br><span class=\"line\">00EB1410    6A 00           push    0x0</span><br><span class=\"line\">00EB1412    6A 00           push    0x0</span><br><span class=\"line\">00EB1414    6A 00           push    0x0</span><br><span class=\"line\">00EB1416    6A 00           push    0x0</span><br><span class=\"line\">00EB1418    FF15 3883EB00   call    dword ptr ds:[&lt;&amp;USER32.MessageBoxW&gt;]    ; user32.MessageBoxW</span><br><span class=\"line\">00EB141E    3BF4            cmp     esi,esp</span><br><span class=\"line\">00EB1420    E8 25FDFFFF     call    00EB114A</span><br><span class=\"line\">00EB1425    6A 04           push    0x4</span><br><span class=\"line\">00EB1427    A1 0070EB00     mov     eax,dword ptr ds:[aaa]</span><br><span class=\"line\">00EB142C    50              push    eax</span><br><span class=\"line\">00EB142D    E8 69FCFFFF     call    00EB109B</span><br><span class=\"line\">00EB1432    83C4 08         add     esp,0x8</span><br><span class=\"line\">00EB1435    A3 0070EB00     mov     dword ptr ds:[aaa],eax</span><br><span class=\"line\">00EB143A    33C0            xor     eax,eax</span><br><span class=\"line\">00EB143C    5F              pop     edi</span><br><span class=\"line\">00EB143D    5E              pop     esi</span><br><span class=\"line\">00EB143E    5B              pop     ebx</span><br><span class=\"line\">00EB143F    81C4 C0000000   add     esp,0xC0</span><br><span class=\"line\">00EB1445    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00EB1447    E8 FEFCFFFF     call    00EB114A</span><br><span class=\"line\">00EB144C    8BE5            mov     esp,ebp</span><br><span class=\"line\">00EB144E    5D              pop     ebp</span><br><span class=\"line\">00EB144F    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00EB13B0 &gt;  55              push    ebp</span><br><span class=\"line\">00EB13B1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00EB13B3    81EC C0000000   sub     esp,0xC0</span><br><span class=\"line\">00EB13B9    53              push    ebx</span><br><span class=\"line\">00EB13BA    56              push    esi</span><br><span class=\"line\">00EB13BB    57              push    edi</span><br><span class=\"line\">00EB13BC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class=\"line\">00EB13C2    B9 30000000     mov     ecx,0x30</span><br><span class=\"line\">00EB13C7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00EB13CC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00EB13CE    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">00EB13D1    0345 0C         add     eax,dword ptr ss:[ebp+0xC]</span><br><span class=\"line\">00EB13D4    5F              pop     edi                                     ; 0038FB84</span><br><span class=\"line\">00EB13D5    5E              pop     esi</span><br><span class=\"line\">00EB13D6    5B              pop     ebx</span><br><span class=\"line\">00EB13D7    8BE5            mov     esp,ebp</span><br><span class=\"line\">00EB13D9    5D              pop     ebp</span><br><span class=\"line\">00EB13DA    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"进制与内存单元长度修饰\"><a class=\"markdownIt-Anchor\" href=\"#进制与内存单元长度修饰\">#</a> 进制与内存单元长度修饰</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">add [ebx],0x333</span><br><span class=\"line\">然在实际汇编出来： add byte ptr [ebx], 33</span><br><span class=\"line\"></span><br><span class=\"line\">eax是双字</span><br><span class=\"line\">内存单元访问，默认byte</span><br><span class=\"line\">因此会截断</span><br></pre></td></tr></table></figure>\n<h3 id=\"补充\"><a class=\"markdownIt-Anchor\" href=\"#补充\">#</a> 补充</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int a = 0x109     //a = local.1</span><br><span class=\"line\">int b = 8         //b = local.2</span><br><span class=\"line\"></span><br><span class=\"line\">sub 会影响zf</span><br><span class=\"line\"></span><br><span class=\"line\">je/jz 如果zf=1跳转</span><br><span class=\"line\">jne/jnz</span><br><span class=\"line\"></span><br><span class=\"line\">__asm &#123;</span><br><span class=\"line\">\tmob eax,3</span><br><span class=\"line\">\tsub eax,a</span><br><span class=\"line\">\tjz end</span><br><span class=\"line\">end:</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">无符号JL/JNGE  小于/不大于等于跳转 根据sf，of跳转</span><br><span class=\"line\">有符号JNG/JLE  不大于/小于等于  sf=1||zf=1|||OF=1      ZF=1 || sf!=of</span><br><span class=\"line\">有符号JG/JNLE  大于/不小于等于   ZF=0 &amp;&amp; SF=OF</span><br><span class=\"line\">无符号JA/JG  无符号大于</span><br><span class=\"line\">无符号JBE/JNA 小于等于/大于</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221115213554357.png\" alt=\"image-20221115213554357\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221115213632575.png\" alt=\"image-20221115213632575\"></p>\n<blockquote>\n<p>EBP 栈底指针 base pointer</p>\n<p>ESP 栈顶指针</p>\n<p>EBP  -/+ 偏移量可以访问 call 里的局部变量</p>\n<p>ESP 栈顶指针与 EBP 构成了一段空间，一般就是本 call 局部变量的空间大小总和</p>\n<p>空函数中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push ebp   //保存上一个函数的栈底，上一个函数的栈顶就是新的ebp，即原来的esp</span><br><span class=\"line\">mov ebp,esp  //确定新的栈底</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116195359372.png\" alt=\"image-20221116195359372\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116200409461.png\" alt=\"image-20221116200409461\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int a = 3</span><br><span class=\"line\">int b = 5</span><br><span class=\"line\">char c = 1</span><br><span class=\"line\"></span><br><span class=\"line\">char s[17]  //如果微软编译器可能会多分配几个字节防止数组越界导致程序崩溃</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sub esp,0C   //0c因为内存对齐</span><br><span class=\"line\">mov dword ptr [local.1],3   //local.1 == ebp-4</span><br><span class=\"line\">mov dword ptr [local.2],5   //local.2 == ebp-4</span><br><span class=\"line\">mov byte ptr [local.3+3],1 //local.3 == ebp+3   //因为只使用了一个字节，从顶往下减少三个</span><br><span class=\"line\">mov esp,ebp</span><br><span class=\"line\">pop ebp</span><br><span class=\"line\">ret</span><br></pre></td></tr></table></figure>\n<p>每个 call 分配独立的栈段空间，供局部变量使用</p>\n<p>call 平衡，pop 后 ebp 和 esp 不变</p>\n<p>栈的上面小，下面大</p>\n<p>push ebp      //sub esp,4  mov esp,[ebp]</p>\n<p>pop ebp       //mov ebp,[esp] add esp,4</p>\n<p>参数入栈又右向左入栈</p>\n<p>ecx 放 this 指针，eax 放返回值</p>\n<p>call 执行 push eIP</p>\n<p>retn pop eip</p>\n<p>32 位内存中，EIP (32 位) 已经能表达所有内存地址。而 16 位系统中的内存地址是 20 位，所以需要 IP 和 CS 同时入栈</p>\n<p><strong>参数局部变量的表示   [EBP - x] 本 call 中的局部变量      [EBP+x] 上一个 call 的局部变量作为传入参数</strong></p>\n<p>[ebp +4] 是父函数 EBP 的值，[EBP+8] 大概率是外部传进来的参数值</p>\n<p>调用约定：</p>\n<p>​\t__cdecl 是 c declaration 缩写，所有参数从右到左依次入栈，这些参数由调用者清除，称为手动清栈，即清栈是在 call 后面   call 0010000h   add esp+x   VC 默认约定</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __cdecl add(int a, int b)</span><br></pre></td></tr></table></figure>\n<p>​\t__stdcall api 函数调用约定，是 c++ 标准调用方式，所有参数从右到左依次入栈，如果调用类成员，最后一个入栈的是 this 指针，这些堆栈由被调用者在返回后清除，retx，x 代表参数占用字节数，cpu 在 ret 之后自动弹出 x 个栈空间，称为自动清栈</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __stdcall add2(int a, int b)</span><br></pre></td></tr></table></figure>\n<p>​\t__fastcall 调用约定，是编译器指定的快速调用方式。fastcall 规定将前两个 (若干个参数由寄存器传递，其余参数通过堆栈传递)，返回方式和 stdcall 一样，如果只有两个参数，不用栈，不需要堆栈平衡，如果有很多参数，还需要用堆栈平衡部分堆栈</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int __fastcall add3(int a, int b)</span><br></pre></td></tr></table></figure>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116223933037.png\" alt=\"image-20221116223933037\" style=\"zoom: 67%;\" />\n<p>c 中不加默认说明为_cedcl 方式，c++ 也一样，默认调用方式可以在 ide 中设置</p>\n<p>带有可变参数的函数必须使用_cdecl 方式，比如 printf (char *fmtstr, …) scanf</p>\n</blockquote>\n<h4 id=\"if-else\"><a class=\"markdownIt-Anchor\" href=\"#if-else\">#</a> if-else</h4>\n<blockquote>\n<p><strong>if-else:</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;haha&quot;);</span><br><span class=\"line\">\tint a=1, b=2;</span><br><span class=\"line\">\tif (a&gt;b)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\t&#125; else &#123;</span><br><span class=\"line\">\t\tprintf(&quot;zhizhang&quot;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>debug</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00EF13A0 &gt;  55              push    ebp</span><br><span class=\"line\">00EF13A1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00EF13A3    81EC D8000000   sub     esp,0xD8</span><br><span class=\"line\">00EF13A9    53              push    ebx</span><br><span class=\"line\">00EF13AA    56              push    esi</span><br><span class=\"line\">00EF13AB    57              push    edi</span><br><span class=\"line\">00EF13AC    8DBD 28FFFFFF   lea     edi,dword ptr ss:[ebp-0xD8]</span><br><span class=\"line\">00EF13B2    B9 36000000     mov     ecx,0x36</span><br><span class=\"line\">00EF13B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00EF13BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">//堆栈操作上面有写，自己看啊</span><br><span class=\"line\"></span><br><span class=\"line\">00EF13BE    8BF4            mov     esi,esp</span><br><span class=\"line\">00EF13C0    68 5057EF00     push    00EF5750                              ; ASCII &quot;haha&quot;</span><br><span class=\"line\">00EF13C5    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00EF13CB    83C4 04         add     esp,0x4</span><br><span class=\"line\">//printf调用结束后保护现场，属于手动清栈</span><br><span class=\"line\"></span><br><span class=\"line\">00EF13CE    3BF4            cmp     esi,esp</span><br><span class=\"line\">00EF13D0    E8 70FDFFFF     call    00EF1145</span><br><span class=\"line\">//00EF1145   /E9 16030000     jmp     _RTC_CheckEsp</span><br><span class=\"line\"></span><br><span class=\"line\">00EF13D5    C745 F8 0100000&gt;mov     dword ptr ss:[ebp-0x8],0x1</span><br><span class=\"line\">00EF13DC    C745 EC 0200000&gt;mov     dword ptr ss:[ebp-0x14],0x2</span><br><span class=\"line\">//局部变量a,b入栈</span><br><span class=\"line\"></span><br><span class=\"line\">00EF13E3    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">00EF13E6    3B45 EC         cmp     eax,dword ptr ss:[ebp-0x14]</span><br><span class=\"line\">比较a 和 b的大小</span><br><span class=\"line\">00EF13E9    7E 19           jle     short 00EF1404</span><br><span class=\"line\">00EF13EB    8BF4            mov     esi,esp</span><br><span class=\"line\">00EF13ED    68 4857EF00     push    00EF5748                              ; ASCII &quot;shabi&quot;</span><br><span class=\"line\">00EF13F2    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00EF13F8    83C4 04         add     esp,0x4</span><br><span class=\"line\">00EF13FB    3BF4            cmp     esi,esp</span><br><span class=\"line\">00EF13FD    E8 43FDFFFF     call    00EF1145</span><br><span class=\"line\">00EF1402    EB 17           jmp     short 00EF141B</span><br><span class=\"line\">00EF1404    8BF4            mov     esi,esp</span><br><span class=\"line\">00EF1406    68 3C57EF00     push    00EF573C                              ; ASCII &quot;zhizhang&quot;</span><br><span class=\"line\">00EF140B    FF15 BC82EF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00EF1411    83C4 04         add     esp,0x4</span><br><span class=\"line\">00EF1414    3BF4            cmp     esi,esp</span><br><span class=\"line\">00EF1416    E8 2AFDFFFF     call    00EF1145</span><br><span class=\"line\">00EF141B    33C0            xor     eax,eax</span><br><span class=\"line\">00EF141D    5F              pop     edi</span><br><span class=\"line\">00EF141E    5E              pop     esi</span><br><span class=\"line\">00EF141F    5B              pop     ebx</span><br><span class=\"line\">00EF1420    81C4 D8000000   add     esp,0xD8</span><br><span class=\"line\">00EF1426    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00EF1428    E8 18FDFFFF     call    00EF1145</span><br><span class=\"line\">00EF142D    8BE5            mov     esp,ebp</span><br><span class=\"line\">00EF142F    5D              pop     ebp</span><br><span class=\"line\">00EF1430    C3              retn</span><br></pre></td></tr></table></figure>\n<p>release</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000E1000 &gt;/$  56            push    esi</span><br><span class=\"line\">000E1001  |.  8B35 A0200E00 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]    ;  msvcr90.printf</span><br><span class=\"line\">000E1007  |.  68 F4200E00   push    000E20F4                                ; /format = &quot;haha&quot;</span><br><span class=\"line\">000E100C  |.  FFD6          call    esi                                     ; \\printf</span><br><span class=\"line\">000E100E  |.  68 FC200E00   push    000E20FC                                ;  ASCII &quot;zhizhang&quot;</span><br><span class=\"line\">000E1013  |.  FFD6          call    esi</span><br><span class=\"line\">000E1015  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">000E1018  |.  33C0          xor     eax,eax</span><br><span class=\"line\">000E101A  |.  5E            pop     esi</span><br><span class=\"line\">000E101B  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>OD 文件夹中有 UDD 作为缓存</p>\n</blockquote>\n<h4 id=\"switch-case\"><a class=\"markdownIt-Anchor\" href=\"#switch-case\">#</a> switch case</h4>\n<blockquote>\n<p><strong>switch-case</strong></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;haha&quot;);</span><br><span class=\"line\">\tint a=1, b=2;</span><br><span class=\"line\">\tswitch(a)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\tcase 1:</span><br><span class=\"line\">\t\tprintf(&quot;1111&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\tcase 2:</span><br><span class=\"line\">\t\tprintf(&quot;2222&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\tcase 3:</span><br><span class=\"line\">\t\tprintf(&quot;3333&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\tdefault:</span><br><span class=\"line\">\t\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00FF13BE    8BF4            mov     esi,esp</span><br><span class=\"line\">00FF13C0    <span class=\"number\">68</span> 5C57FF00     push    00FF575C                                ; ASCII <span class=\"string\">&quot;haha&quot;</span></span><br><span class=\"line\">00FF13C5    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">00FF13CB    83C4 04         add     esp,<span class=\"number\">0x4</span></span><br><span class=\"line\">00FF13CE    3BF4            cmp     esi,esp</span><br><span class=\"line\">00FF13D0    E8 70FDFFFF     call    00FF1145</span><br><span class=\"line\"></span><br><span class=\"line\">00FF13D5    C745 F8 <span class=\"number\">0</span>100000&gt;mov     dword ptr ss:[ebp-<span class=\"number\">0x8</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\">00FF13DC    C745 EC 0200000&gt;mov     dword ptr ss:[ebp-<span class=\"number\">0x14</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\">//局部变量a,b入栈</span><br><span class=\"line\">00FF13E3    8B45 F8         mov     eax,dword ptr ss:[ebp-<span class=\"number\">0x8</span>]</span><br><span class=\"line\">00FF13E6    <span class=\"number\">8985</span> 24FFFFFF   mov     dword ptr ss:[ebp-<span class=\"number\">0xDC</span>],eax</span><br><span class=\"line\">//[ebp-<span class=\"number\">0xdc</span>] = a</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00FF13EC    83BD 24FFFFFF <span class=\"number\">0</span>&gt;cmp     dword ptr ss:[ebp-<span class=\"number\">0xDC</span>],<span class=\"number\">0x1</span></span><br><span class=\"line\">00FF13F3    <span class=\"number\">74</span> <span class=\"number\">14</span>           je      short 00FF1409</span><br><span class=\"line\">00FF13F5    83BD 24FFFFFF <span class=\"number\">0</span>&gt;cmp     dword ptr ss:[ebp-<span class=\"number\">0xDC</span>],<span class=\"number\">0x2</span></span><br><span class=\"line\">00FF13FC    <span class=\"number\">74</span> <span class=\"number\">24</span>           je      short 00FF1422</span><br><span class=\"line\">00FF13FE    83BD 24FFFFFF <span class=\"number\">0</span>&gt;cmp     dword ptr ss:[ebp-<span class=\"number\">0xDC</span>],<span class=\"number\">0x3</span></span><br><span class=\"line\">00FF1405    <span class=\"number\">74</span> <span class=\"number\">34</span>           je      short 00FF143B</span><br><span class=\"line\">//比较a和<span class=\"keyword\">case</span>中值，如果相等那么跳转</span><br><span class=\"line\"></span><br><span class=\"line\">00FF1407    EB 4B           jmp     short 00FF1454</span><br><span class=\"line\">//<span class=\"keyword\">case</span></span><br><span class=\"line\"></span><br><span class=\"line\">00FF1409    8BF4            mov     esi,esp</span><br><span class=\"line\">00FF140B    <span class=\"number\">68</span> 5457FF00     push    00FF5754                                ; ASCII <span class=\"string\">&quot;1111&quot;</span></span><br><span class=\"line\">00FF1410    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">00FF1416    83C4 04         add     esp,<span class=\"number\">0x4</span></span><br><span class=\"line\"></span><br><span class=\"line\">00FF1419    3BF4            cmp     esi,esp</span><br><span class=\"line\">00FF141B    E8 25FDFFFF     call    00FF1145</span><br><span class=\"line\"></span><br><span class=\"line\">00FF1420    EB <span class=\"number\">49</span>           jmp     short 00FF146B</span><br><span class=\"line\">//<span class=\"keyword\">break</span></span><br><span class=\"line\"></span><br><span class=\"line\">00FF1422    8BF4            mov     esi,esp</span><br><span class=\"line\">00FF1424    <span class=\"number\">68</span> 4C57FF00     push    00FF574C                                ; ASCII <span class=\"string\">&quot;2222&quot;</span></span><br><span class=\"line\">00FF1429    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">00FF142F    83C4 04         add     esp,<span class=\"number\">0x4</span></span><br><span class=\"line\"></span><br><span class=\"line\">00FF1432    3BF4            cmp     esi,esp</span><br><span class=\"line\">00FF1434    E8 0CFDFFFF     call    00FF1145</span><br><span class=\"line\"></span><br><span class=\"line\">00FF1439    EB <span class=\"number\">30</span>           jmp     short 00FF146B</span><br><span class=\"line\"></span><br><span class=\"line\">00FF143B    8BF4            mov     esi,esp</span><br><span class=\"line\">00FF143D    <span class=\"number\">68</span> 4457FF00     push    00FF5744                                ; ASCII <span class=\"string\">&quot;3333&quot;</span></span><br><span class=\"line\">00FF1442    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">00FF1448    83C4 04         add     esp,<span class=\"number\">0x4</span></span><br><span class=\"line\">00FF144B    3BF4            cmp     esi,esp</span><br><span class=\"line\">00FF144D    E8 F3FCFFFF     call    00FF1145</span><br><span class=\"line\">00FF1452    EB <span class=\"number\">17</span>           jmp     short 00FF146B</span><br><span class=\"line\">00FF1454    8BF4            mov     esi,esp</span><br><span class=\"line\">00FF1456    <span class=\"number\">68</span> 3C57FF00     push    00FF573C                                ; ASCII <span class=\"string\">&quot;shabi&quot;</span></span><br><span class=\"line\">00FF145B    FF15 BC82FF00   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">00FF1461    83C4 04         add     esp,<span class=\"number\">0x4</span></span><br><span class=\"line\">00FF1464    3BF4            cmp     esi,esp</span><br><span class=\"line\">00FF1466    E8 DAFCFFFF     call    00FF1145</span><br><span class=\"line\"></span><br><span class=\"line\">00FF146B    33C0            xor     eax,eax</span><br><span class=\"line\">00FF146D    5F              pop     edi</span><br><span class=\"line\">00FF146E    5E              pop     esi</span><br><span class=\"line\">00FF146F    5B              pop     ebx</span><br><span class=\"line\">00FF1470    81C4 DC000000   add     esp,<span class=\"number\">0xDC</span></span><br><span class=\"line\">00FF1476    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00FF1478    E8 C8FCFFFF     call    00FF1145</span><br><span class=\"line\">00FF147D    8BE5            mov     esp,ebp</span><br><span class=\"line\">00FF147F    5D              pop     ebp</span><br><span class=\"line\">00FF1480    C3              retn</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>release</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">011C1000 &gt;/$  56            push    esi</span><br><span class=\"line\">011C1001  |.  8B35 A0201C01 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]   ;  msvcr90.printf</span><br><span class=\"line\">011C1007  |.  68 F4201C01   push    011C20F4                               ; /format = &quot;haha&quot;</span><br><span class=\"line\">011C100C  |.  FFD6          call    esi                                    ; \\printf</span><br><span class=\"line\">011C100E  |.  68 FC201C01   push    011C20FC                               ;  ASCII &quot;1111&quot;</span><br><span class=\"line\">011C1013  |.  FFD6          call    esi</span><br><span class=\"line\">011C1015  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">011C1018  |.  33C0          xor     eax,eax</span><br><span class=\"line\">011C101A  |.  5E            pop     esi</span><br><span class=\"line\">011C101B  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>如果 case 很多的时候，会使用导出表</p>\n<p>用 case 最大的 - case 最小的，得出的范围称为 k，如果要判断的值 - case 最小的值不在范围 k 之内，直接 default</p>\n<p>其实这样的，edx 存放的是 a 与 case 中最小值的差值，而 eax*4 + 地址存放的是每个 case 的地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;haha&quot;);</span><br><span class=\"line\">\tint a=5;</span><br><span class=\"line\">\tswitch(a)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\tcase 1:</span><br><span class=\"line\">\t\tprintf(&quot;1&quot;);</span><br><span class=\"line\">\tcase 5:</span><br><span class=\"line\">\t\tprintf(&quot;5&quot;);</span><br><span class=\"line\">\tcase 9:</span><br><span class=\"line\">\t\tprintf(&quot;9&quot;);</span><br><span class=\"line\">\tcase 2:</span><br><span class=\"line\">\t\tprintf(&quot;2&quot;);</span><br><span class=\"line\">\tcase 7:</span><br><span class=\"line\">\t\tprintf(&quot;7&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\tcase 13:</span><br><span class=\"line\">\t\tprintf(&quot;13&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\tdefault:</span><br><span class=\"line\">\t\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00F713A0 &gt;  55              push    ebp</span><br><span class=\"line\">00F713A1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00F713A3    81EC D0000000   sub     esp,0xD0</span><br><span class=\"line\">00F713A9    53              push    ebx</span><br><span class=\"line\">00F713AA    56              push    esi</span><br><span class=\"line\">00F713AB    57              push    edi</span><br><span class=\"line\">00F713AC    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class=\"line\">00F713B2    B9 34000000     mov     ecx,0x34</span><br><span class=\"line\">00F713B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00F713BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00F713BE    8BF4            mov     esi,esp</span><br><span class=\"line\">00F713C0    68 5C57F700     push    00F7575C                              ; ASCII &quot;haha&quot;</span><br><span class=\"line\">00F713C5    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F713CB    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F713CE    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F713D0    E8 70FDFFFF     call    00F71145</span><br><span class=\"line\">00F713D5    C745 F8 0500000&gt;mov     dword ptr ss:[ebp-0x8],0x5            ; a = 5</span><br><span class=\"line\">00F713DC    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">00F713DF    8985 30FFFFFF   mov     dword ptr ss:[ebp-0xD0],eax</span><br><span class=\"line\">00F713E5    8B8D 30FFFFFF   mov     ecx,dword ptr ss:[ebp-0xD0]           ; ecx = eax = 5</span><br><span class=\"line\">00F713EB    83E9 01         sub     ecx,0x1                               ; ecx = ecx - 1 计算a与case中最小值的差值</span><br><span class=\"line\">00F713EE    898D 30FFFFFF   mov     dword ptr ss:[ebp-0xD0],ecx           ; [ebp-0x0d] = 4 4在13-1的范围之间</span><br><span class=\"line\">00F713F4    83BD 30FFFFFF 0&gt;cmp     dword ptr ss:[ebp-0xD0],0xC           ; 将a 与case 中最小值的差1值和case最大最小差值12相比</span><br><span class=\"line\">00F713FB    0F87 A2000000   ja      00F714A3                              ; 如果当前要比较的值和case最小值的差值&gt;12,直接default</span><br><span class=\"line\">00F71401    8B95 30FFFFFF   mov     edx,dword ptr ss:[ebp-0xD0]           ; edx中存放的就是a与case最小值的差值 0xF714EC存放导出表地址</span><br><span class=\"line\">00F71407    0FB682 EC14F700 movzx   eax,byte ptr ds:[edx+0xF714EC]        ; eax=2</span><br><span class=\"line\">00F7140E    FF2485 D014F700 jmp     dword ptr ds:[eax*4+0xF714D0]         ; 2*4 + 0xF714D0</span><br><span class=\"line\">00F71415    8BF4            mov     esi,esp</span><br><span class=\"line\">00F71417    68 5857F700     push    00F75758                              ; UNICODE &quot;1&quot;</span><br><span class=\"line\">00F7141C    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F71422    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F71425    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F71427    E8 19FDFFFF     call    00F71145</span><br><span class=\"line\">00F7142C    8BF4            mov     esi,esp</span><br><span class=\"line\">00F7142E    68 5457F700     push    00F75754                              ; UNICODE &quot;5&quot;</span><br><span class=\"line\">00F71433    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F71439    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F7143C    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F7143E    E8 02FDFFFF     call    00F71145</span><br><span class=\"line\">00F71443    8BF4            mov     esi,esp</span><br><span class=\"line\">00F71445    68 5057F700     push    00F75750                              ; UNICODE &quot;9&quot;</span><br><span class=\"line\">00F7144A    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F71450    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F71453    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F71455    E8 EBFCFFFF     call    00F71145</span><br><span class=\"line\">00F7145A    8BF4            mov     esi,esp</span><br><span class=\"line\">00F7145C    68 4C57F700     push    00F7574C                              ; UNICODE &quot;2&quot;</span><br><span class=\"line\">00F71461    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F71467    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F7146A    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F7146C    E8 D4FCFFFF     call    00F71145</span><br><span class=\"line\">00F71471    8BF4            mov     esi,esp</span><br><span class=\"line\">00F71473    68 4857F700     push    00F75748                              ; UNICODE &quot;7&quot;</span><br><span class=\"line\">00F71478    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F7147E    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F71481    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F71483    E8 BDFCFFFF     call    00F71145</span><br><span class=\"line\">00F71488    EB 30           jmp     short printf</span><br><span class=\"line\">00F7148A    8BF4            mov     esi,esp</span><br><span class=\"line\">00F7148C    68 4457F700     push    00F75744                              ; ASCII &quot;13&quot;</span><br><span class=\"line\">00F71491    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F71497    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F7149A    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F7149C    E8 A4FCFFFF     call    00F71145</span><br><span class=\"line\">00F714A1    EB 17           jmp     short printf</span><br><span class=\"line\">00F714A3    8BF4            mov     esi,esp</span><br><span class=\"line\">00F714A5    68 3C57F700     push    00F7573C                              ; ASCII &quot;shabi&quot;</span><br><span class=\"line\">00F714AA    FF15 BC82F700   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">00F714B0    83C4 04         add     esp,0x4</span><br><span class=\"line\">00F714B3    3BF4            cmp     esi,esp</span><br><span class=\"line\">00F714B5    E8 8BFCFFFF     call    00F71145</span><br><span class=\"line\">00F714BA &gt;  33C0            xor     eax,eax</span><br><span class=\"line\">00F714BC    5F              pop     edi</span><br><span class=\"line\">00F714BD    5E              pop     esi</span><br><span class=\"line\">00F714BE    5B              pop     ebx</span><br><span class=\"line\">00F714BF    81C4 D0000000   add     esp,0xD0</span><br><span class=\"line\">00F714C5    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00F714C7    E8 79FCFFFF     call    00F71145</span><br><span class=\"line\">00F714CC    8BE5            mov     esp,ebp</span><br><span class=\"line\">00F714CE    5D              pop     ebp</span><br><span class=\"line\">00F714CF    C3              retn</span><br><span class=\"line\">\t</span><br></pre></td></tr></table></figure>\n<blockquote>\n<p>如果 a=9, 9-1=8<br>\ndb 8+0xF714EC   ==  4      db 8+0xF714EC</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102654407.png\" alt=\"image-20221119102654407\"><a href=\"\"></a></p>\n<p>dd 4 * 4 + 0xF714D0 ==</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102748365.png\" alt=\"image-20221119102748365\">\\</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119102822429.png\" alt=\"image-20221119102822429\">`</p>\n<p>也就是说 F714EC 中存放的就是导出表</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119103208537.png\" alt=\"image-20221119103208537\">·</p>\n</blockquote>\n</blockquote>\n<h4 id=\"for\"><a class=\"markdownIt-Anchor\" href=\"#for\">#</a> for</h4>\n<blockquote>\n<p>for 循环</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">for (int i=1;i&lt;=10;++i) &#123;</span><br><span class=\"line\">\tprintf(&quot;%d&quot;,i);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>debug，禁止优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">013013BE    C745 F8 0100000&gt;mov     dword ptr ss:[ebp-0x8],0x1</span><br><span class=\"line\">013013C5    EB 09           jmp     short 013013D0</span><br><span class=\"line\">013013C7    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">013013CA    83C0 01         add     eax,0x1</span><br><span class=\"line\">013013CD    8945 F8         mov     dword ptr ss:[ebp-0x8],eax</span><br><span class=\"line\">013013D0    837D F8 0A      cmp     dword ptr ss:[ebp-0x8],0xA</span><br><span class=\"line\">013013D4    7F 1D           jg      short 013013F3</span><br><span class=\"line\">013013D6    8BF4            mov     esi,esp</span><br><span class=\"line\">013013D8    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">013013DB    50              push    eax</span><br><span class=\"line\">013013DC    68 3C573001     push    0130573C                                ; ASCII &quot;%d&quot;</span><br><span class=\"line\">013013E1    FF15 BC823001   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]       ; msvcr90d.printf</span><br><span class=\"line\">013013E7    83C4 08         add     esp,0x8</span><br><span class=\"line\">013013EA    3BF4            cmp     esi,esp</span><br><span class=\"line\">013013EC    E8 54FDFFFF     call    01301145</span><br><span class=\"line\">013013F1  ^ EB D4           jmp     short 013013C7</span><br><span class=\"line\">013013F3    33C0            xor     eax,eax    \t\t\t\t\t\t\t\t;eax清零，作为返回值</span><br><span class=\"line\">013013F5    5F              pop     edi</span><br><span class=\"line\">013013F6    5E              pop     esi</span><br><span class=\"line\">013013F7    5B              pop     ebx</span><br><span class=\"line\">013013F8    81C4 CC000000   add     esp,0xCC</span><br><span class=\"line\">013013FE    3BEC            cmp     ebp,esp</span><br><span class=\"line\">01301400    E8 40FDFFFF     call    01301145</span><br><span class=\"line\">01301405    8BE5            mov     esp,ebp</span><br><span class=\"line\">01301407    5D              pop     ebp                              </span><br><span class=\"line\">01301408    C3              retn</span><br></pre></td></tr></table></figure>\n<p>release，O/2 优化</p>\n<p>最大化速度优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00361000 &gt;/$  56            push    esi</span><br><span class=\"line\">00361001  |.  68 84B33600   push    0036B384                              ; /format = &quot;shabi&quot;</span><br><span class=\"line\">00361006  |.  E8 2F000000   call    printf                                ; \\printf</span><br><span class=\"line\">0036100B  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">0036100E  |.  BE 01000000   mov     esi,0x1</span><br><span class=\"line\">00361013  |&gt;  56            /push    esi                                  ; /&lt;%d&gt;</span><br><span class=\"line\">00361014  |.  68 8CB33600   |push    0036B38C                             ; |format = &quot;%d&quot;</span><br><span class=\"line\">00361019  |.  E8 1C000000   |call    printf                               ; \\printf</span><br><span class=\"line\">0036101E  |.  46            |inc     esi</span><br><span class=\"line\">0036101F  |.  83C4 08       |add     esp,0x8</span><br><span class=\"line\">00361022  |.  83FE 0A       |cmp     esi,0xA</span><br><span class=\"line\">00361025  |.^ 7E EC         \\jle     short 00361013</span><br><span class=\"line\">00361027  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00361029  |.  5E            pop     esi</span><br><span class=\"line\">0036102A  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>release，O/1 优化</p>\n<p>大小最小化优化情况下，for</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01161000 &gt;/$  56            push    esi</span><br><span class=\"line\">01161001  |.  57            push    edi\t\t\t\t\t\t\t\t\t\t ; 保护edi</span><br><span class=\"line\">01161002  |.  8B3D A0201601 mov     edi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]     ;  printf给edi，调用时直接call edi，用寄存器代替内存</span><br><span class=\"line\">01161008  |.  68 F4201601   push    011620F4                                 ; /format = &quot;shabi&quot;，printf参数入栈</span><br><span class=\"line\">0116100D  |.  FFD7          call    edi                                      ; call printf</span><br><span class=\"line\">0116100F  |.  33F6          xor     esi,esi\t\t\t\t\t\t\t\t\t ; esi = 0</span><br><span class=\"line\">01161011  |.  59            pop     ecx\t\t\t\t\t\t\t\t\t\t ; 堆栈平衡，可以理解为esp+4</span><br><span class=\"line\">01161012  |.  46            inc     esi</span><br><span class=\"line\"></span><br><span class=\"line\">//循环代码段</span><br><span class=\"line\">01161013  |&gt;  56            /push    esi\t\t\t\t\t\t\t\t\t ; i 入栈</span><br><span class=\"line\">01161014  |.  68 FC201601   |push    011620FC                                ;  ASCII &quot;%d&quot;入栈</span><br><span class=\"line\">01161019  |.  FFD7          |call    edi\t\t\t\t\t\t\t\t\t ; call printf 编译器判断第一次可以执行，直接优化</span><br><span class=\"line\">0116101B  |.  46            |inc     esi</span><br><span class=\"line\">0116101C &gt;|.  83FE 0A       |cmp     esi,0xA</span><br><span class=\"line\">0116101F  |.  59            |pop     ecx</span><br><span class=\"line\">01161020  |.  59            |pop     ecx \t\t\t\t\t\t\t\t\t ; 两次pop堆栈平衡 esp+8</span><br><span class=\"line\">01161021  |.^ 7E F0         \\jle     short 01161013</span><br><span class=\"line\"></span><br><span class=\"line\">01161023  |.  5F            pop     edi</span><br><span class=\"line\">01161024  |.  33C0          xor     eax,eax</span><br><span class=\"line\">01161026 &gt;|.  5E            pop     esi</span><br><span class=\"line\">01161027  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\">//inc 一个字节，pop edi一个字节，</span><br><span class=\"line\">//add 三个字节，</span><br></pre></td></tr></table></figure>\n<p>release，关闭优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00191000 &gt; $  55            push    ebp</span><br><span class=\"line\">00191001   .  8BEC          mov     ebp,esp</span><br><span class=\"line\">00191003   .  51            push    ecx</span><br><span class=\"line\">//这个ecx在最后没有出栈，所以不是用来保护的，而是用来分配堆栈空间的</span><br><span class=\"line\"></span><br><span class=\"line\">00191004   .  C745 FC 01000&gt;mov     dword ptr ss:[ebp-0x4],0x1</span><br><span class=\"line\">0019100B   .  EB 09         jmp     short 00191016</span><br><span class=\"line\">0019100D   &gt;  8B45 FC       mov     eax,dword ptr ss:[ebp-0x4]</span><br><span class=\"line\">00191010   .  83C0 01       add     eax,0x1</span><br><span class=\"line\">00191013   .  8945 FC       mov     dword ptr ss:[ebp-0x4],eax</span><br><span class=\"line\">00191016   &gt;  837D FC 0A    cmp     dword ptr ss:[ebp-0x4],0xA</span><br><span class=\"line\">0019101A   .  7F 14         jg      short 00191030</span><br><span class=\"line\">0019101C   .  8B4D FC       mov     ecx,dword ptr ss:[ebp-0x4]</span><br><span class=\"line\">0019101F   .  51            push    ecx         \t\t\t\t\t ;  根据从右到左的入栈数据，i先入栈，%d后入</span><br><span class=\"line\">00191020   .  68 F4201900   push    001920F4                         ;  ASCII &quot;%d&quot;</span><br><span class=\"line\">00191025      FF            db      FF</span><br><span class=\"line\">00191026 &gt; .  15 A0201900   adc     eax,&lt;&amp;MSVCR90.printf&gt;</span><br><span class=\"line\">0019102B   .  83C4 08       add     esp,0x8  \t\t\t\t\t\t ;  printf有两个参数，因此堆栈平衡时需要+8</span><br><span class=\"line\">0019102E   .^ EB DD         jmp     short 0019100D</span><br><span class=\"line\">00191030   &gt;  33C0          xor     eax,eax\t\t\t\t\t\t\t ;  eax作为函数返回值，此处将eax清零</span><br><span class=\"line\">00191032   .  8BE5          mov     esp,ebp</span><br><span class=\"line\">00191034   .  5D            pop     ebp</span><br><span class=\"line\">00191035 &gt; .  C3            retn</span><br></pre></td></tr></table></figure>\n<p>release，完全优化 / Ox</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">010E1000 &gt;/$  56            push    esi</span><br><span class=\"line\">010E1001  |.  68 84B30E01   push    010EB384                         ; /format = &quot;shabi&quot;</span><br><span class=\"line\">010E1006  |.  E8 2F000000   call    printf                           ; \\printf</span><br><span class=\"line\">010E100B  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">010E100E  |.  BE 01000000   mov     esi,0x1</span><br><span class=\"line\">010E1013  |&gt;  56            /push    esi                             ; /&lt;%d&gt;</span><br><span class=\"line\">010E1014  |.  68 8CB30E01   |push    010EB38C                        ; |format = &quot;%d&quot;</span><br><span class=\"line\">010E1019  |.  E8 1C000000   |call    printf                          ; \\printf</span><br><span class=\"line\">010E101E  |.  46            |inc     esi</span><br><span class=\"line\">010E101F  |.  83C4 08       |add     esp,0x8</span><br><span class=\"line\">010E1022  |.  83FE 0A       |cmp     esi,0xA</span><br><span class=\"line\">010E1025  |.^ 7E EC         \\jle     short 010E1013</span><br><span class=\"line\">010E1027  |.  33C0          xor     eax,eax</span><br><span class=\"line\">010E1029  |.  5E            pop     esi</span><br><span class=\"line\">010E102A  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> ++ –</h4>\n<blockquote>\n<p>inc a  //i++  ++i  速度比 add 快，占用空间小，指令执行影响 AS，OF，PF，SF，ZF 标志位，不影响 CF</p>\n<p>dec a</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">010E100B  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">01161012  |.  46            inc     esi</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tint i=0;</span><br><span class=\"line\">\ti++;</span><br><span class=\"line\">\ti--;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">003A1000 &gt;/$  55            push    ebp</span><br><span class=\"line\">003A1001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">003A1003  |.  51            push    ecx</span><br><span class=\"line\">003A1004  |.  68 F4203A00   push    003A20F4                         ; /format = &quot;shabi&quot;</span><br><span class=\"line\">003A1009  |.  FF15 A0203A00 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \\printf</span><br><span class=\"line\">003A100F  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">003A1012  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class=\"line\">003A1019  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">003A101C  |.  83C0 01       add     eax,0x1</span><br><span class=\"line\">003A101F  |.  8945 FC       mov     [local.1],eax</span><br><span class=\"line\">003A1022  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">003A1025  |.  83E9 01       sub     ecx,0x1</span><br><span class=\"line\">003A1028  |.  894D FC       mov     [local.1],ecx</span><br><span class=\"line\">003A102B  |.  33C0          xor     eax,eax</span><br><span class=\"line\">003A102D  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">003A102F  |.  5D            pop     ebp</span><br><span class=\"line\">003A1030  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>速度最大化的时候因为 i 没有实际用途，所以直接返回</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01251000 &gt;/$  68 F4202501   push    012520F4                         ; /format = &quot;shabi&quot;</span><br><span class=\"line\">01251005  |.  FF15 A0202501 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \\printf</span><br><span class=\"line\">0125100B  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">0125100E  |.  33C0          xor     eax,eax</span><br><span class=\"line\">01251010  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01201000 &gt;/$  56            push    esi</span><br><span class=\"line\">01201001  |.  8B35 A0202001 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]   ;  msvcr90.printf</span><br><span class=\"line\">01201007  |.  68 F4202001   push    012020F4                               ; /format = &quot;shabi&quot;</span><br><span class=\"line\">0120100C  |.  FFD6          call    esi                                    ; \\printf</span><br><span class=\"line\">0120100E  |.  6A 01         push    0x1</span><br><span class=\"line\">01201010  |.  68 FC202001   push    012020FC                               ;  ASCII &quot;%d&quot;</span><br><span class=\"line\">01201015  |.  FFD6          call    esi</span><br><span class=\"line\">01201017  |.  6A 00         push    0x0</span><br><span class=\"line\">01201019  |.  68 FC202001   push    012020FC                               ;  ASCII &quot;%d&quot;</span><br><span class=\"line\">0120101E  |.  FFD6          call    esi</span><br><span class=\"line\">01201020  |.  83C4 14       add     esp,0x14\t\t\t\t\t\t\t   ; 堆栈平衡，2+2+1=20/4</span><br><span class=\"line\">01201023  |.  33C0          xor     eax,eax</span><br><span class=\"line\">01201025  |.  5E            pop     esi</span><br><span class=\"line\">01201026  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\">//添加打印i后的代码</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">012B1000 &gt;/$  51            push    ecx</span><br><span class=\"line\">012B1001  |.  56            push    esi</span><br><span class=\"line\">012B1002  |.  8B35 A0202B01 mov     esi,dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ;  msvcr90.printf</span><br><span class=\"line\">012B1008  |.  57            push    edi</span><br><span class=\"line\">012B1009  |.  68 F4202B01   push    012B20F4                                     ; /format = &quot;shabi&quot;</span><br><span class=\"line\">012B100E  |.  FFD6          call    esi                                          ; \\printf</span><br><span class=\"line\">012B1010  |.  8B7C24 0C     mov     edi,dword ptr ss:[esp+0xC]                   ;  msvcr90.__winitenv</span><br><span class=\"line\">012B1014  |.  47            inc     edi</span><br><span class=\"line\">012B1015  |.  57            push    edi</span><br><span class=\"line\">012B1016  |.  68 FC202B01   push    012B20FC                                     ;  ASCII &quot;%d&quot;</span><br><span class=\"line\">012B101B  |.  FFD6          call    esi</span><br><span class=\"line\">012B101D  |.  4F            dec     edi</span><br><span class=\"line\">012B101E  |.  57            push    edi</span><br><span class=\"line\">012B101F  |.  68 FC202B01   push    012B20FC                                     ;  ASCII &quot;%d&quot;</span><br><span class=\"line\">012B1024  |.  FFD6          call    esi</span><br><span class=\"line\">012B1026  |.  83C4 14       add     esp,0x14</span><br><span class=\"line\">012B1029  |.  5F            pop     edi</span><br><span class=\"line\">012B102A  |.  33C0          xor     eax,eax</span><br><span class=\"line\">012B102C  |.  5E            pop     esi</span><br><span class=\"line\">012B102D  |.  59            pop     ecx</span><br><span class=\"line\">012B102E  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\">//如果不赋初值的话</span><br></pre></td></tr></table></figure>\n<p>前<ins>后</ins>（–）的区别</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tint i;</span><br><span class=\"line\">\ti++;</span><br><span class=\"line\">\tprintf(&quot;%d&quot;,i);</span><br><span class=\"line\">\ti--;</span><br><span class=\"line\">\tprintf(&quot;%d&quot;,i);</span><br><span class=\"line\"></span><br><span class=\"line\">\tint j=0;</span><br><span class=\"line\">\tj=i++;</span><br><span class=\"line\">\tprintf(&quot;i++%d&quot;,j);</span><br><span class=\"line\">\tj=++i;</span><br><span class=\"line\">\tprintf(&quot;++i%d&quot;,j);</span><br><span class=\"line\">\tj=i--;</span><br><span class=\"line\">\tprintf(&quot;i--%d&quot;,j);</span><br><span class=\"line\">\tj=--i;</span><br><span class=\"line\">\tprintf(&quot;--i%d&quot;,j);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>禁止优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01281000 &gt;/$  55            push    ebp</span><br><span class=\"line\">01281001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">01281003  |.  83EC 08       sub     esp,0x8</span><br><span class=\"line\">01281006  |.  68 F4202801   push    012820F4                                  ; /format = &quot;shabi&quot;</span><br><span class=\"line\">0128100B  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">01281011  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">01281014  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">01281017  |.  83C0 01       add     eax,0x1</span><br><span class=\"line\">0128101A  |.  8945 FC       mov     [local.1],eax</span><br><span class=\"line\">0128101D  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">01281020  |.  51            push    ecx                                       ; /&lt;%d&gt;</span><br><span class=\"line\">01281021  |.  68 FC202801   push    012820FC                                  ; |format = &quot;%d&quot;</span><br><span class=\"line\">01281026  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">0128102C  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">0128102F  |.  8B55 FC       mov     edx,[local.1]</span><br><span class=\"line\">01281032  |.  83EA 01       sub     edx,0x1</span><br><span class=\"line\">01281035  |.  8955 FC       mov     [local.1],edx</span><br><span class=\"line\">01281038  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">0128103B  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class=\"line\">0128103C  |.  68 00212801   push    01282100                                  ; |format = &quot;%d&quot;</span><br><span class=\"line\">01281041  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">01281047  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">0128104A  |.  C745 F8 00000&gt;mov     [local.2],0x0</span><br><span class=\"line\">01281051  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">01281054  |.  894D F8       mov     [local.2],ecx</span><br><span class=\"line\">01281057  |.  8B55 FC       mov     edx,[local.1]</span><br><span class=\"line\">0128105A  |.  83C2 01       add     edx,0x1</span><br><span class=\"line\">0128105D  |.  8955 FC       mov     [local.1],edx</span><br><span class=\"line\">01281060  |.  8B45 F8       mov     eax,[local.2]</span><br><span class=\"line\">01281063  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class=\"line\">01281064  |.  68 04212801   push    01282104                                  ; |format = &quot;i++%d&quot;</span><br><span class=\"line\">01281069  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">0128106F  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">01281072  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">01281075  |.  83C1 01       add     ecx,0x1</span><br><span class=\"line\">01281078  |.  894D FC       mov     [local.1],ecx</span><br><span class=\"line\">0128107B  |.  8B55 FC       mov     edx,[local.1]</span><br><span class=\"line\">0128107E  |.  8955 F8       mov     [local.2],edx</span><br><span class=\"line\">01281081  |.  8B45 F8       mov     eax,[local.2]</span><br><span class=\"line\">01281084  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class=\"line\">01281085  |.  68 0C212801   push    0128210C                                  ; |format = &quot;++i%d&quot;</span><br><span class=\"line\">0128108A  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">01281090  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">01281093  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">01281096  |.  894D F8       mov     [local.2],ecx</span><br><span class=\"line\">01281099  |.  8B55 FC       mov     edx,[local.1]</span><br><span class=\"line\">0128109C  |.  83EA 01       sub     edx,0x1</span><br><span class=\"line\">0128109F  |.  8955 FC       mov     [local.1],edx</span><br><span class=\"line\">012810A2  |.  8B45 F8       mov     eax,[local.2]</span><br><span class=\"line\">012810A5  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class=\"line\">012810A6  |.  68 14212801   push    01282114                                  ; |format = &quot;i--%d&quot;</span><br><span class=\"line\">012810AB  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">012810B1  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">012810B4  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">012810B7  |.  83E9 01       sub     ecx,0x1</span><br><span class=\"line\">012810BA  |.  894D FC       mov     [local.1],ecx</span><br><span class=\"line\">012810BD  |.  8B55 FC       mov     edx,[local.1]</span><br><span class=\"line\">012810C0  |.  8955 F8       mov     [local.2],edx</span><br><span class=\"line\">012810C3  |.  8B45 F8       mov     eax,[local.2]</span><br><span class=\"line\">012810C6  |.  50            push    eax                                       ; /&lt;%d&gt;</span><br><span class=\"line\">012810C7  |.  68 1C212801   push    0128211C                                  ; |format = &quot;--i%d&quot;</span><br><span class=\"line\">012810CC  |.  FF15 A0202801 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]          ; \\printf</span><br><span class=\"line\">012810D2  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">012810D5  |.  33C0          xor     eax,eax</span><br><span class=\"line\">012810D7  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">012810D9  |.  5D            pop     ebp</span><br><span class=\"line\">012810DA  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"do-while\"><a class=\"markdownIt-Anchor\" href=\"#do-while\">#</a> do - while</h4>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint i = 0;</span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\ti++;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\twhile (i&lt;=10); </span><br><span class=\"line\">\tprintf(&quot;%d&quot;,i);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>/O2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00071000 &gt;/$  6A 0B         push    0xB                                      ; /&lt;%d&gt; = B (11.)</span><br><span class=\"line\">00071002  |.  68 F4200700   push    000720F4                                 ; |format = &quot;%d&quot;</span><br><span class=\"line\">00071007  |.  FF15 A0200700 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ; \\printf</span><br><span class=\"line\">0007100D  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">00071010  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00071012  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>禁用</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; 00251000 &gt;/$  55            push    ebp</span><br><span class=\"line\">&gt; 00251001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">&gt; 00251003  |.  51            push    ecx</span><br><span class=\"line\">&gt; 00251004  |.  C745 FC 00000&gt;mov     [local.1],0x0</span><br><span class=\"line\">&gt; 0025100B  |&gt;  8B45 FC       /mov     eax,[local.1]</span><br><span class=\"line\">&gt; 0025100E  |.  83C0 01       |add     eax,0x1</span><br><span class=\"line\">&gt; 00251011  |.  8945 FC       |mov     [local.1],eax</span><br><span class=\"line\">&gt; 00251014  |.  837D FC 0A    |cmp     [local.1],0xA</span><br><span class=\"line\">&gt; 00251018  |.^ 7E F1         \\jle     short 0025100B</span><br><span class=\"line\">&gt; 0025101A  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">&gt; 0025101D  |.  51            push    ecx                                     ; /&lt;%d&gt;</span><br><span class=\"line\">&gt; 0025101E  |.  68 F4202500   push    002520F4                                ; |format = &quot;%d&quot;</span><br><span class=\"line\">&gt; 00251023  |.  FF15 A0202500 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]        ; \\printf</span><br><span class=\"line\">&gt; 00251029  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">&gt; 0025102C  |.  33C0          xor     eax,eax</span><br><span class=\"line\">&gt; 0025102E  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">&gt; 00251030  |.  5D            pop     ebp</span><br><span class=\"line\">&gt; 00251031  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"浮点指令\"><a class=\"markdownIt-Anchor\" href=\"#浮点指令\">#</a> 浮点指令</h4>\n<blockquote>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tfloat a=8.123f;</span><br><span class=\"line\">\ta++;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">012B1000 &gt;/$  55            push    ebp</span><br><span class=\"line\">012B1001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">012B1003  |.  51            push    ecx</span><br><span class=\"line\">012B1004  |.  68 F4202B01   push    012B20F4                            ; /format = &quot;shabi&quot;</span><br><span class=\"line\">012B1009  |.  FF15 A0202B01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]    ; \\printf</span><br><span class=\"line\">012B100F  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">012B1012  |.  D905 08212B01 fld     dword ptr ds:[_real]</span><br><span class=\"line\">012B1018  |.  D95D FC       fstp    [local.1]</span><br><span class=\"line\">012B101B  |.  D945 FC       fld     [local.1]</span><br><span class=\"line\">012B101E  |.  DC05 00212B01 fadd    qword ptr ds:[_real]</span><br><span class=\"line\">012B1024  |.  D95D FC       fstp    [local.1]</span><br><span class=\"line\">012B1027  |.  33C0          xor     eax,eax</span><br><span class=\"line\">012B1029  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">012B102B  |.  5D            pop     ebp</span><br><span class=\"line\">012B102C  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>浮点寄存器 - fpu - 浮点运算单元</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120195516311.png\" alt=\"image-20221120195516311\"></p>\n<p>精度为 80 位，10 字节</p>\n<p>MMX - 用于处理多媒体功能</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120195604566.png\" alt=\"image-20221120195604566\"></p>\n<p>st0 至 st7 80 位的两用寄存器   MMX - FPU</p>\n<p>3.FLD，FSTP，FADD</p>\n<blockquote>\n<ol>\n<li></li>\n</ol>\n<p>fld     dword ptr ds:[_real]     //fld     dword ptr ds:[0x12B2108]</p>\n<p>类似于 push 指令，将数字放入 st 中</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120200304416.png\" alt=\"image-20221120200304416\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120200412594.png\" alt=\"image-20221120200412594\"></p>\n<ol start=\"2\">\n<li></li>\n</ol>\n<p>fstp    [local.1]</p>\n<p>类似于 pop 指令，将 st 中的值给 local.1</p>\n<p>调用多次 fld 时，会使用多个 st 寄存器</p>\n<ol start=\"3\">\n<li></li>\n</ol>\n<p>fadd    qword ptr ds:[_real]    //fadd    qword ptr ds:[0x12B2100]</p>\n<p>类似于 add 指令，做加法  qword 64 位，8 各字</p>\n<p>4.fsub</p>\n<p>类似于 sub 指令</p>\n<p>5.fmul</p>\n<p>类似于乘法</p>\n<p>6.fdiv</p>\n<p>类似于除法</p>\n<p>7.FILD 指令</p>\n<p>整数入栈指令，将整数转为浮点数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tfloat a=8.123f;</span><br><span class=\"line\">\tint b = 2;</span><br><span class=\"line\">\ta= a + b;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">012F1000 &gt;/$  55            push    ebp</span><br><span class=\"line\">012F1001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">012F1003  |.  83EC 08       sub     esp,0x8</span><br><span class=\"line\">012F1006  |.  68 F4202F01   push    012F20F4                         ; /format = &quot;shabi&quot;</span><br><span class=\"line\">012F100B  |.  FF15 A0202F01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;] ; \\printf</span><br><span class=\"line\">012F1011  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">012F1014  |.  D905 FC202F01 fld     dword ptr ds:[_real]</span><br><span class=\"line\">012F101A  |.  D95D FC       fstp    [local.1]</span><br><span class=\"line\">012F101D  |.  C745 F8 02000&gt;mov     [local.2],0x2</span><br><span class=\"line\">012F1024  |.  DB45 F8       fild    [local.2]</span><br><span class=\"line\">012F1027  |.  D845 FC       fadd    [local.1]</span><br><span class=\"line\">012F102A  |.  D95D FC       fstp    [local.1]</span><br><span class=\"line\">012F102D &gt;|.  33C0          xor     eax,eax</span><br><span class=\"line\">012F102F  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">012F1031  |.  5D            pop     ebp</span><br><span class=\"line\">012F1032  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120202918750.png\" alt=\"image-20221120202918750\"></p>\n<p>8.cvttsd2si eax,dword ptr ss:[ebp-4]</p>\n<p>浮点转整数指令，运用截断处理将 mmx/m32 中的一个单精度浮点值转换成 r32 中的一个有符号的双字整数</p>\n</blockquote>\n</blockquote>\n<h4 id=\"位移指令\"><a class=\"markdownIt-Anchor\" href=\"#位移指令\">#</a> 位移指令</h4>\n<blockquote>\n<p>1. 逻辑位移</p>\n<p>shr 逻辑右移指令</p>\n<p>相当于整除 2，用 0 来补位</p>\n<p>shl 逻辑右移指令</p>\n<p>相当于乘 2，用 0 来补位，有可能移除</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tunsigned int i = 0x77883322;</span><br><span class=\"line\">\ti = i &gt;&gt; 8;</span><br><span class=\"line\">\ti = i &gt;&gt; 2;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">011D1000 &gt;/$  55            push    ebp</span><br><span class=\"line\">011D1001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">011D1003  |.  51            push    ecx</span><br><span class=\"line\">011D1004  |.  68 F4201D01   push    011D20F4                                ; /format = &quot;shabi&quot;</span><br><span class=\"line\">011D1009  |.  FF15 A0201D01 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]        ; \\printf</span><br><span class=\"line\">011D100F  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">011D1012  |.  C745 FC 22330&gt;mov     [local.1],0x3322</span><br><span class=\"line\">011D1019  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">011D101C  |.  C1E8 08       shr     eax,0x8\t\t\t\t\t\t\t\t\t; 0x 00 77 88 33  ÷(2^8)</span><br><span class=\"line\">011D101F  |.  8945 FC       mov     [local.1],eax</span><br><span class=\"line\">011D1022  |.  8B4D FC       mov     ecx,[local.1]</span><br><span class=\"line\">011D1025  |.  C1E9 02       shr     ecx,0x2\t\t\t\t\t\t\t\t\t; ÷ 4</span><br><span class=\"line\">011D1028  |.  894D FC       mov     [local.1],ecx</span><br><span class=\"line\">011D102B  |.  33C0          xor     eax,eax</span><br><span class=\"line\">011D102D  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">011D102F  |.  5D            pop     ebp</span><br><span class=\"line\">011D1030  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>2. 算术位移</p>\n<p>SAR 算术右移指令</p>\n<p>​\tSAR 右移时保留操作数符号，用符号位补</p>\n<p>​\tSHR 右移时用 0 部位</p>\n<p>SAL 算术左移指令</p>\n<p>​\tSAL 与 SHL 功能一样</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tint i = -100000000;</span><br><span class=\"line\">\ti = i &lt;&lt; 5;</span><br><span class=\"line\">\tprintf(&quot;%d&quot;,i);  //1094967296</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>3. 循环位移指令</p>\n<p>ROL 循环左移</p>\n<p>ROR 循环右移</p>\n</blockquote>\n<h4 id=\"逻辑运算符\"><a class=\"markdownIt-Anchor\" href=\"#逻辑运算符\">#</a> 逻辑运算符</h4>\n<blockquote>\n<p>逻辑或 ||</p>\n<p>截断原理，如果前面为真，那么不在判断后面的。因此在代码优化层面，把可能性大的放在前面提高效率</p>\n<p>按位或 |</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01321000 &gt;/$  55            push    ebp</span><br><span class=\"line\">01321001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">01321003  |.  83EC 10       sub     esp,0x10</span><br><span class=\"line\">01321006  |.  68 F4203201   push    013220F4                                    ; /format = &quot;shabi&quot;</span><br><span class=\"line\">0132100B  |.  FF15 A0203201 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]            ; \\printf</span><br><span class=\"line\">01321011  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">01321014  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class=\"line\">0132101B  |.  C745 F8 03000&gt;mov     [local.2],0x3</span><br><span class=\"line\">01321022  |.  837D FC 00    cmp     [local.1],0x0</span><br><span class=\"line\">01321026  |.  75 0F         jnz     short 01321037</span><br><span class=\"line\">01321028  |.  837D F8 00    cmp     [local.2],0x0</span><br><span class=\"line\">0132102C  |.  75 09         jnz     short 01321037</span><br><span class=\"line\">0132102E  |.  C745 F0 00000&gt;mov     [local.4],0x0</span><br><span class=\"line\">01321035  |.  EB 07         jmp     short 0132103E</span><br><span class=\"line\">01321037  |&gt;  C745 F0 01000&gt;mov     [local.4],0x1</span><br><span class=\"line\">0132103E  |&gt;  8B45 F0       mov     eax,[local.4]</span><br><span class=\"line\">01321041  |.  8945 F4       mov     [local.3],eax</span><br><span class=\"line\">01321044  |.  33C0          xor     eax,eax</span><br><span class=\"line\">01321046  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">01321048  |.  5D            pop     ebp</span><br><span class=\"line\">01321049  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>逻辑与  &amp;&amp;</p>\n<p>按位与 &amp;</p>\n<p>非运算 ！</p>\n<p>按位取反 ～</p>\n<p>sete al   // 取 ZF 位的值，保存到寄存器中</p>\n<p>setne  al  //zf 取反保存到寄存器中</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tint a =5,b=4,c,d;</span><br><span class=\"line\"></span><br><span class=\"line\">\tc = !a;</span><br><span class=\"line\">\td = ~b;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00FC1000 &gt;/$  55            push    ebp</span><br><span class=\"line\">00FC1001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00FC1003  |.  83EC 10       sub     esp,0x10</span><br><span class=\"line\">00FC1006  |.  68 F420FC00   push    00FC20F4                                 ; /format = &quot;shabi&quot;</span><br><span class=\"line\">00FC100B  |.  FF15 A020FC00 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]         ; \\printf</span><br><span class=\"line\">00FC1011  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00FC1014  |.  C745 FC 05000&gt;mov     [local.1],0x5</span><br><span class=\"line\">00FC101B  |.  C745 F8 04000&gt;mov     [local.2],0x4</span><br><span class=\"line\">00FC1022  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00FC1024  |.  837D FC 00    cmp     [local.1],0x0</span><br><span class=\"line\">00FC1028  |.  0F94C0        sete    al</span><br><span class=\"line\">00FC102B  |.  8945 F0       mov     [local.4],eax</span><br><span class=\"line\">00FC102E  |.  8B4D F8       mov     ecx,[local.2]</span><br><span class=\"line\">00FC1031  |.  F7D1          not     ecx</span><br><span class=\"line\">00FC1033  |.  894D F4       mov     [local.3],ecx</span><br><span class=\"line\">00FC1036  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00FC1038  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">00FC103A  |.  5D            pop     ebp</span><br><span class=\"line\">00FC103B  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>异或运算</p>\n<p>按位异或 ^</p>\n<p>xor eax,eax   //eax 清零</p>\n<p>可以看成没有进位的加法</p>\n<p>交换 a,b</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a = a + b</span><br><span class=\"line\">b = a - b</span><br><span class=\"line\">a = a - b</span><br><span class=\"line\"></span><br><span class=\"line\">//</span><br><span class=\"line\">a = a ^ b</span><br><span class=\"line\">b = a ^ b</span><br><span class=\"line\">a = a ^ b</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</blockquote>\n<h4 id=\"字符操作相关指令\"><a class=\"markdownIt-Anchor\" href=\"#字符操作相关指令\">#</a> 字符操作相关指令</h4>\n<blockquote>\n<p>strcmp</p>\n<p>需要将优化中的启动内部函数设为否，关闭优化</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00F81000 &gt;/$  55            push    ebp</span><br><span class=\"line\">00F81001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00F81003  |.  83EC 08       sub     esp,0x8</span><br><span class=\"line\">00F81006  |.  68 F420F800   push    00F820F4                               ; /format = &quot;shabi&quot;</span><br><span class=\"line\">00F8100B  |.  FF15 A420F800 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]       ; \\printf</span><br><span class=\"line\">00F81011  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00F81014  |.  C745 F8 FC20F&gt;mov     [local.2],00F820FC                     ;  ASCII &quot;123456&quot;</span><br><span class=\"line\">00F8101B  |.  C745 FC 0421F&gt;mov     [local.1],00F82104                     ;  ASCII &quot;shabishabi&quot;</span><br><span class=\"line\">00F81022  |.  8B45 FC       mov     eax,[local.1]</span><br><span class=\"line\">00F81025  |.  50            push    eax                                    ; /s2</span><br><span class=\"line\">00F81026  |.  8B4D F8       mov     ecx,[local.2]                          ; |</span><br><span class=\"line\">00F81029  |.  51            push    ecx                                    ; |s1</span><br><span class=\"line\">00F8102A  |.  E8 19000000   call    strcmp                                 ; \\strcmp</span><br><span class=\"line\">00F8102F  |.  83C4 08       add     esp,0x8</span><br><span class=\"line\">00F81032  |.  33C0          xor     eax,eax</span><br><span class=\"line\">00F81034  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">00F81036  |.  5D            pop     ebp</span><br><span class=\"line\">00F81037  \\.  C3            retn</span><br></pre></td></tr></table></figure>\n<p>strcmp</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">74D6B8E0 &gt;  8B5424 04       mov     edx,dword ptr ss:[esp+0x4]</span><br><span class=\"line\">74D6B8E4    8B4C24 08       mov     ecx,dword ptr ss:[esp+0x8]</span><br><span class=\"line\">74D6B8E8    F7C2 03000000   test    edx,0x3</span><br><span class=\"line\">74D6B8EE    75 3C           jnz     short 74D6B92C</span><br><span class=\"line\">74D6B8F0    8B02            mov     eax,dword ptr ds:[edx]</span><br><span class=\"line\">74D6B8F2    3A01            cmp     al,byte ptr ds:[ecx]</span><br><span class=\"line\">74D6B8F4    75 2E           jnz     short 74D6B924</span><br><span class=\"line\">74D6B8F6    0AC0            or      al,al</span><br><span class=\"line\">74D6B8F8    74 26           je      short 74D6B920</span><br><span class=\"line\">74D6B8FA    3A61 01         cmp     ah,byte ptr ds:[ecx+0x1]</span><br><span class=\"line\">74D6B8FD    75 25           jnz     short 74D6B924</span><br><span class=\"line\">74D6B8FF    0AE4            or      ah,ah</span><br><span class=\"line\">74D6B901    74 1D           je      short 74D6B920</span><br><span class=\"line\">74D6B903    C1E8 10         shr     eax,0x10</span><br><span class=\"line\">74D6B906    3A41 02         cmp     al,byte ptr ds:[ecx+0x2]</span><br><span class=\"line\">74D6B909    75 19           jnz     short 74D6B924</span><br><span class=\"line\">74D6B90B    0AC0            or      al,al</span><br><span class=\"line\">74D6B90D    74 11           je      short 74D6B920</span><br><span class=\"line\">74D6B90F    3A61 03         cmp     ah,byte ptr ds:[ecx+0x3]</span><br><span class=\"line\">74D6B912    75 10           jnz     short 74D6B924</span><br><span class=\"line\">74D6B914    83C1 04         add     ecx,0x4</span><br><span class=\"line\">74D6B917    83C2 04         add     edx,0x4</span><br><span class=\"line\">74D6B91A    0AE4            or      ah,ah</span><br><span class=\"line\">74D6B91C  ^ 75 D2           jnz     short 74D6B8F0</span><br><span class=\"line\">74D6B91E    8BFF            mov     edi,edi</span><br><span class=\"line\">74D6B920    33C0            xor     eax,eax</span><br><span class=\"line\">74D6B922    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>每次取四个字节依次比较</p>\n<p>SCASB</p>\n<p>SCAS byte ptr es:[EDI]   用于查找 AL 的字符在 edi 中的位置</p>\n<p>相当于</p>\n<p>cmp byte ptr [edi],al</p>\n<p>对标志位的影响相当于 sub 指令，还会修改 edi 的值</p>\n<p>DF=0 ，inc edi</p>\n<p>DF=1,  dec edi</p>\n<p>REPNE</p>\n<p>repne scasb</p>\n<p>ecx !=0 ,zf=0，重复执行后面指令，每执行一次 ecx-1</p>\n<p>REPNE 与 REPNZ 是同一条指令不同助记符</p>\n<p>// 通过 repne 计算字符串长度</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tprintf(&quot;shabi&quot;);</span><br><span class=\"line\">\tchar *s1 = &quot;123456&quot;;</span><br><span class=\"line\">\t__asm &#123;  //cal length</span><br><span class=\"line\">\t\t\tmov al,0</span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tmov ecx,-1</span><br><span class=\"line\">\t\t\trepnz scasb</span><br><span class=\"line\">\t\t\tmov eax,-1</span><br><span class=\"line\">\t\t\tsub eax,ecx </span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t__asm &#123;   //find index</span><br><span class=\"line\">\t\t\txor eax,rax</span><br><span class=\"line\">\t\t\tmov al,0x33</span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tmov ecx,-1</span><br><span class=\"line\">\t\t\trepnz scasb</span><br><span class=\"line\">\t\t\tnot ecx</span><br><span class=\"line\">\t\t\tdec ecx</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tstd::string str1 = s1;</span><br><span class=\"line\">\tint haha = str1.find(&quot;3&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00901000 &gt;/$  55            push    ebp</span><br><span class=\"line\">00901001  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">00901003  |.  51            push    ecx</span><br><span class=\"line\">00901004  |.  57            push    edi</span><br><span class=\"line\">00901005  |.  68 F4209000   push    009020F4                               ; /format = &quot;shabi&quot;</span><br><span class=\"line\">0090100A  |.  FF15 A0209000 call    dword ptr ds:[&lt;&amp;MSVCR90.printf&gt;]       ; \\printf</span><br><span class=\"line\">00901010  |.  83C4 04       add     esp,0x4</span><br><span class=\"line\">00901013  |.  C745 FC FC209&gt;mov     [local.1],009020FC                     ;  ASCII &quot;123456&quot;</span><br><span class=\"line\">0090101A  |.  B0 00         mov     al,0x0</span><br><span class=\"line\">0090101C  |.  8B7D FC       mov     edi,[local.1]</span><br><span class=\"line\">0090101F  |.  B9 FFFFFFFF   mov     ecx,-0x1</span><br><span class=\"line\">00901024  |.  F2:AE         repne   scas byte ptr es:[edi]</span><br><span class=\"line\">00901026  |.  B8 FFFFFFFF   mov     eax,-0x1</span><br><span class=\"line\">0090102B  |.  2BC1          sub     eax,ecx</span><br><span class=\"line\">0090102D  |.  33C0          xor     eax,eax</span><br><span class=\"line\">0090102F  |.  5F            pop     edi</span><br><span class=\"line\">00901030  |.  8BE5          mov     esp,ebp</span><br><span class=\"line\">00901032  |.  5D            pop     ebp</span><br><span class=\"line\">00901033  \\.  C3            retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>SCASB  SCASW  SCASD</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221124212255214.png\" alt=\"image-20221124212255214\"></p>\n<p>mov ax,L’7’</p>\n<p>实例运用</p>\n<p>1. 计算字符串长度</p>\n<p>2. 定位特定字符串位置（索引)</p>\n<p>3. 在内存中定位一串特征码</p>\n<p>REPNZ/REPNE 与 SCASB 指令结合使用，表示当串未结束 (ECX!=0)，且当对应串元素不相同 (ZF=0) 时，继续重复执行串比较指令</p>\n<p>REPE/REPZ 和 CMPSB，CMPSW，CMPSD</p>\n<p>1.CMPS</p>\n<p>cmps byte ptr [edi], byte ptr [esi]</p>\n<p>对标志位的影响相当于 sub 指令，同时还会修改 edi 和 esi 的值</p>\n<p>如果 df 为 0，则 edi，esi 按相对大小递增</p>\n<p>df 为 1，递减</p>\n<p>2.REPE、REPZ</p>\n<p>repe/repz cmpsb 当 ecx!=0，zf=1，重复执行后面指令，每执行一次 ecx-1</p>\n<p>用于比较字符串是否相等</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__asm &#123;</span><br><span class=\"line\">\t\txor al,al</span><br><span class=\"line\">\t\tmov edi,s1</span><br><span class=\"line\">\t\tmov ecx,-1</span><br><span class=\"line\">\t\trepnz scasb  //finish position</span><br><span class=\"line\">\t\tnot ecx    //cal length </span><br><span class=\"line\"></span><br><span class=\"line\">\t\tmov edi,s1</span><br><span class=\"line\">\t\tmov esi,s2</span><br><span class=\"line\">\t\trepz cmpsb  //compare equal</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t\txor al,al</span><br><span class=\"line\">\t\tsete al</span><br><span class=\"line\">\t\tcmp al,1</span><br><span class=\"line\">\t\tjnz result1</span><br><span class=\"line\">\t\tcmp ecx,0</span><br><span class=\"line\">\t\tjz result2</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">result1:</span><br><span class=\"line\">\tprintf(&quot;S1!=S2&quot;);</span><br><span class=\"line\">\tgoto end</span><br><span class=\"line\">result2:</span><br><span class=\"line\">\tprintf(&quot;s1==s2&quot;);</span><br><span class=\"line\">end:</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>汇编编写比较函数</p>\n<p>__declspec (naked)   纯汇编编译函数，不添加寄存器保护和堆栈平衡代码</p>\n<p>窄字节版</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__declspec(naked) int strcmpa(char *s1, char *s2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm&#123;</span><br><span class=\"line\">\t\t\tpush ebp  //esp-4-4</span><br><span class=\"line\">\t\t\tmov ebp,esp   //s1:ebp+4+4   s2:ebp+4+8</span><br><span class=\"line\">\t\t\tpush ecx</span><br><span class=\"line\">\t\t\tpush edi</span><br><span class=\"line\">\t\t\tpush esi</span><br><span class=\"line\">\t\t\tpush edx</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\txor al,al</span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tCLD</span><br><span class=\"line\">\t\t\tmov ecx,-1</span><br><span class=\"line\">\t\t\trepnz scasb  //finish position</span><br><span class=\"line\">\t\t\tnot ecx    //cal length </span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tmov esi,s2</span><br><span class=\"line\">\t\t\trepz cmpsb  //compare equal</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\txor eax,eax</span><br><span class=\"line\">\t\t\txor edx,edx</span><br><span class=\"line\">\t\t\tmov al,[edi-1]</span><br><span class=\"line\">\t\t\tmov dl,[esi-1]</span><br><span class=\"line\">\t\t\tsub eax,edx</span><br><span class=\"line\">\t\t\tpop edx</span><br><span class=\"line\">\t\t\tpop esi</span><br><span class=\"line\">\t\t\tpop edi</span><br><span class=\"line\">\t\t\tpop ecx </span><br><span class=\"line\">\t\t\tpop ebp</span><br><span class=\"line\">\t\t\tretn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>宽字节版</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__declspec(naked) int strcmpW(wchar_t *s1, wchar_t *s2)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm&#123;</span><br><span class=\"line\">\t\t\tpush ebp  //esp-4-4</span><br><span class=\"line\">\t\t\tmov ebp,esp   //s1:ebp+4+4   s2:ebp+4+8</span><br><span class=\"line\">\t\t\tpush ecx</span><br><span class=\"line\">\t\t\tpush edi</span><br><span class=\"line\">\t\t\tpush esi</span><br><span class=\"line\">\t\t\tpush edx</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\txor ax,ax</span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tmov ecx,-1</span><br><span class=\"line\">\t\t\tCLD</span><br><span class=\"line\">\t\t\trepnz scasw  //finish position</span><br><span class=\"line\">\t\t\tnot ecx      //cal length </span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\tmov edi,s1</span><br><span class=\"line\">\t\t\tmov esi,s2</span><br><span class=\"line\">\t\t\trepz cmpsw   //compare equal</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t\txor eax,eax</span><br><span class=\"line\">\t\t\txor edx,edx</span><br><span class=\"line\">\t\t\tmov al,[edi-2]</span><br><span class=\"line\">\t\t\tmov dl,[esi-2]</span><br><span class=\"line\">\t\t\tsub eax,edx</span><br><span class=\"line\">\t\t\tpop edx</span><br><span class=\"line\">\t\t\tpop esi</span><br><span class=\"line\">\t\t\tpop edi</span><br><span class=\"line\">\t\t\tpop ecx </span><br><span class=\"line\">\t\t\tpop ebp</span><br><span class=\"line\">\t\t\tretn</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>ESP+4 是 call 的下一个命令的地址</p>\n<p>ESP+8 是外部传进来的第一个变量</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126203249743.png\" alt=\"image-20221126203249743\"></p>\n<p>STD/CLD</p>\n<p>修改 DF</p>\n<p>STD DF=1</p>\n<p>CLD DF=0</p>\n<p>串存储和加载指令</p>\n<p>1. 串存储指令 STOSB STOSW  STOSD</p>\n<p>stos btye ptr [edi]</p>\n<p>相当于 mov byte ptr [edi],al</p>\n<p>rep stosb     //rep stos byte ptr [edi]</p>\n<p>用 al 的值填充 byte ptr [edi]，每次 ecx-1，edi+1</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &lt;cstdio&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">int main() </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint a[0x22];</span><br><span class=\"line\">\ta[0] = 1;</span><br><span class=\"line\">\ta[0x12] = 222;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">013F13A0    55              push    ebp</span><br><span class=\"line\">013F13A1    8BEC            mov     ebp,esp</span><br><span class=\"line\">013F13A3    81EC 50010000   sub     esp,0x150</span><br><span class=\"line\">013F13A9    53              push    ebx</span><br><span class=\"line\">013F13AA    56              push    esi</span><br><span class=\"line\">013F13AB    57              push    edi</span><br><span class=\"line\">013F13AC    8DBD B0FEFFFF   lea     edi,dword ptr ss:[ebp-0x150]</span><br><span class=\"line\">013F13B2    B9 54000000     mov     ecx,0x54</span><br><span class=\"line\">013F13B7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">013F13BC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">013F13BE    C785 74FFFFFF 0&gt;mov     dword ptr ss:[ebp-0x8C],0x1</span><br><span class=\"line\">013F13C8    C745 BC DE00000&gt;mov     dword ptr ss:[ebp-0x44],0xDE</span><br><span class=\"line\">013F13CF    33C0            xor     eax,eax</span><br><span class=\"line\">013F13D1    52              push    edx</span><br><span class=\"line\">013F13D2    8BCD            mov     ecx,ebp</span><br><span class=\"line\">013F13D4    50              push    eax</span><br><span class=\"line\">013F13D5    8D15 EC133F01   lea     edx,dword ptr ds:[0x13F13EC]</span><br><span class=\"line\">013F13DB    E8 A7FCFFFF     call    013F1087</span><br></pre></td></tr></table></figure>\n<p>手动初始化数组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__asm &#123;</span><br><span class=\"line\">\tmov ecx,0x22</span><br><span class=\"line\">\txor eax,eax</span><br><span class=\"line\">\tlea edi,a</span><br><span class=\"line\">\trep stosd</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>debug 找 main 函数</p>\n<p>退出函数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">013F199F    FF15 7C823F01   call    dword ptr ds:[&lt;&amp;MSVCR90D.exit&gt;]                      ; msvcr90d.exit</span><br></pre></td></tr></table></figure>\n<p>退出函数的上一个函数即使 main 函数</p>\n<p>release 中程序中断位置不在 main 上，在 jmp 上才时 main</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126213639997.png\" alt=\"image-20221126213639997\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221126213710284.png\" alt=\"image-20221126213710284\"></p>\n<p>看 exit 找 main 或者看 main 的 argv ，argc 参数找 main 也可以</p>\n<p>这边没删 pdb，删了一样</p>\n<p>同时注意，main 有三个参数，argv 参数个数，argc 参数数组，envp 环境变量</p>\n<p>envp 是二级指针，需要两次寻址，存放系统环境变量</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190321276.png\" alt=\"image-20221127190321276\"></p>\n<p>argv 也是二级指针，存在文件路径</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190413354.png\" alt=\"image-20221127190413354\"></p>\n<p>argc 存放 argv 中参数个数</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127190503930.png\" alt=\"image-20221127190503930\"></p>\n<p>串载入指令</p>\n<blockquote>\n<p>loadSB ,LOADSW,LOASSD</p>\n<p>相当于 mov al,byte ptr [esi] 将内存中数据放到寄存器中</p>\n<p>rep loadsb</p>\n<p>rep loads word ptr [esi]</p>\n<p>用 byte ptr [esi] 填充 al，每次 ecx-1，esi+1</p>\n</blockquote>\n<p>循环控制指令</p>\n<blockquote>\n<p>loop start</p>\n<p>1.ecx-1</p>\n<p>2.ecx！=0 转移到标号处循环执行</p>\n<p>3. 直至 ecx=0</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint i = 100;</span><br><span class=\"line\">\tchar *s = &quot;%d&quot;;</span><br><span class=\"line\">\t__asm mov ecx,i</span><br><span class=\"line\"></span><br><span class=\"line\">\t__asm &#123;</span><br><span class=\"line\">start:</span><br><span class=\"line\">\t\tpush ecx</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tpush ecx</span><br><span class=\"line\">\t\tmov eax,s</span><br><span class=\"line\">\t\tpush eax</span><br><span class=\"line\">\t\tcall dword ptr [printf]</span><br><span class=\"line\">\t\tadd esp,8</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tpop ecx</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tloop start</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>条件置位指令</p>\n<blockquote>\n<p>sete  setz</p>\n<p>sete al  取 zf 标志位的值</p>\n<p>setnz 、 setne</p>\n<p>将 zf 的值取反保存</p>\n<p>setg al</p>\n<p>大于比较时 ZF =0&amp;&amp; sf=0 &amp;&amp; OF=1 时 al=1</p>\n<p>setl al</p>\n<p>小于比较</p>\n<p>sf=1 || of=1 ，al=1</p>\n<p>setge</p>\n<p>操作数可以是一个字节存储单元，可以是一个字节宽度寄存器</p>\n<p>&gt;= 时，操作数值 1，否则为 0，一般与 cmp 结合使用</p>\n<p>SF=OF ，操作数置 1</p>\n<p>setle</p>\n<p>操作数可以是一个字节存储单元，可以是一个字节宽度寄存器</p>\n<p>&lt;= 时，操作数值 1，否则为 0，一般与 cmp 结合使用</p>\n<p>ZF = 1 || sf!= of 操作数置 1</p>\n</blockquote>\n<h2 id=\"实战\"><a class=\"markdownIt-Anchor\" href=\"#实战\">#</a> 实战</h2>\n<h3 id=\"1游戏call\"><a class=\"markdownIt-Anchor\" href=\"#1游戏call\">#</a> 1. 游戏 call</h3>\n<blockquote>\n<p>调用 MessageBoxA 函数 call</p>\n<p>1. 找到 messageboxA call 地址</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">76C4FD1E &gt;  8BFF            mov     edi,edi</span><br></pre></td></tr></table></figure>\n<p>2. 找到 MessageBoxA call 参数</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int MessageBox(</span><br><span class=\"line\">[in, optional] HWND    hWnd,</span><br><span class=\"line\">[in, optional] LPCTSTR lpText,</span><br><span class=\"line\">[in, optional] LPCTSTR lpCaption,</span><br><span class=\"line\">[in]           UINT    uType</span><br><span class=\"line\">);</span><br><span class=\"line\"></span><br><span class=\"line\">我们用四个push 0，因为都可以传0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br></pre></td></tr></table></figure>\n<p>3. 注入代码测试调用 MessageBoxA call</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127205600961.png\" alt=\"image-20221127205600961\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127205625663.png\" alt=\"image-20221127205625663\"></p>\n<p>或者在第二个和第三个参数传入字符指针，，第一个参数改变窗口格式</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 0</span><br><span class=\"line\">push 01005148</span><br><span class=\"line\">push 01005148</span><br><span class=\"line\">push 0</span><br><span class=\"line\">call 76C4FD1E</span><br></pre></td></tr></table></figure>\n<p>2. 窗口菜单类 call 分析</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127212738634.png\" alt=\"image-20221127212738634\"></p>\n<p>follow poc，定位窗口处理函数位置</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221127214017807.png\" alt=\"image-20221127214017807\"></p>\n<p>窗口处理函数原型</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">LRESULT CALLBACK WindowProc(</span><br><span class=\"line\">HWND hwnd, </span><br><span class=\"line\">UINT uMsg, </span><br><span class=\"line\">WPARAM wParam, </span><br><span class=\"line\">LPARAM lParam </span><br><span class=\"line\">); </span><br></pre></td></tr></table></figure>\n<p>菜单被点击的时候发送的是 WM_COMMAND 消息</p>\n<p>当点击菜单的时候，WindowProc 会被系统调用，</p>\n<p>uMsg = WM_COMMAND</p>\n<p>wPARAM = 窗口菜单的 id</p>\n<p>在 WindowProc 函数下条件断点</p>\n<p>条件时：uMSG == WM_COMMAND</p>\n<p>如  edx == WM_COMMAND 条件断点</p>\n<p>点击菜单时条件断点被中断</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128192802977.png\" alt=\"image-20221128192802977\"></p>\n<p>点击初级时 edx == VMCOMMAND == 0x111</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">01001BC9  /.  55            push    ebp</span><br><span class=\"line\">01001BCA  |.  8BEC          mov     ebp,esp</span><br><span class=\"line\">01001BCC  |.  83EC 40       sub     esp,0x40</span><br><span class=\"line\">01001BCF  |.  8B55 0C       mov     edx,[arg.2]   ; uMsg</span><br><span class=\"line\">01001BD2 &gt;|.  8B4D 14       mov     ecx,[arg.4]   ; edx == WM_COMMAND</span><br><span class=\"line\">01001BD5  |.  53            push    ebx</span><br><span class=\"line\">01001BD6  |.  56            push    esi</span><br><span class=\"line\">01001BD7  |.  33DB          xor     ebx,ebx</span><br><span class=\"line\">01001BD9  |.  57            push    edi</span><br></pre></td></tr></table></figure>\n<p>分析出各项菜单被点击时四个参数的值</p>\n<p>wParam（菜单 ID）参数：</p>\n<p>​\t初级菜单 ID：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EBP+8    &gt;|0011029C   HWND hwnd</span><br><span class=\"line\">EBP+C    &gt;|00000111   uMsg</span><br><span class=\"line\">EBP+10   &gt;|00000209   wParam</span><br><span class=\"line\">EBP+14   &gt;|00000000   lParam</span><br></pre></td></tr></table></figure>\n<p>​\t中级菜单 ID：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EBP+8    &gt;|0011029C</span><br><span class=\"line\">EBP+C    &gt;|00000111</span><br><span class=\"line\">EBP+10   &gt;|0000020A</span><br><span class=\"line\">EBP+14   &gt;|00000000</span><br></pre></td></tr></table></figure>\n<p>​\t高级菜单 ID：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">EBP+8    &gt;|0011029C</span><br><span class=\"line\">EBP+C    &gt;|00000111</span><br><span class=\"line\">EBP+10   &gt;|0000020B</span><br><span class=\"line\">EBP+14   &gt;|00000000</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128194129162.png\" alt=\"image-20221128194129162\"></p>\n<p>注入代码调试</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push 0</span><br><span class=\"line\">push 0x20b</span><br><span class=\"line\">push 0x111</span><br><span class=\"line\">push 0x001A03DA</span><br><span class=\"line\">call 0x01001BC9</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128204020367.png\" alt=\"image-20221128204020367\"></p>\n</blockquote>\n<h3 id=\"2分析游戏基地址\"><a class=\"markdownIt-Anchor\" href=\"#2分析游戏基地址\">#</a> 2. 分析游戏基地址</h3>\n<blockquote>\n<p>基地址概念</p>\n<p>全局变量，字符常量等的地址</p>\n<p>1. 使用 CE 内存查找工具查找数据的地址</p>\n<p>2. 在 od 中验证是否为基地址</p>\n<p>​\t通过下内存断点方式验证</p>\n<p>通过 ce 找到基地址，new scan 后改变数值进行 next scan</p>\n<p>1. 首次先让要查找的数据稳定在某个范围 (或者某个精确的值)</p>\n<p>2. 改变要查找的数据，根据变化筛选出数据的地址</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221128205517107.png\" alt=\"image-20221128205517107\"></p>\n<p>在扫雷中，小旗子剩余数量的基地址为 01005194</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0100346E  |.  0105 94510001 add     dword ptr ds:[0x1005194],eax</span><br></pre></td></tr></table></figure>\n<p>立即数寻址的一般都是基地址</p>\n</blockquote>\n<h3 id=\"3游戏菜单点击与读取基地址\"><a class=\"markdownIt-Anchor\" href=\"#3游戏菜单点击与读取基地址\">#</a> 3. 游戏菜单点击与读取基地址</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void CsaoleiDlg::OnBnClickedButton1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tHWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hwnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t::SendMessage(hwnd, WM_COMMAND, 0x20A, 0);  //发送WindowProc的参数</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tHWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hwnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t::SendMessage(hwnd, WM_COMMAND, 0x20B, 0);  //发送WindowProc的参数</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\twhile (TRUE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tOnBnClickedButton1();</span><br><span class=\"line\">\t\tSleep(1000);</span><br><span class=\"line\">\t\tOnBnClickedButton2();</span><br><span class=\"line\">\t\tSleep(1000);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t\t/*</span><br><span class=\"line\">\tBOOL ReadProcessMemory(</span><br><span class=\"line\">\t  HANDLE hProcess,</span><br><span class=\"line\">\t  LPCVOID lpBaseAddress,</span><br><span class=\"line\">\t  LPVOID lpBuffer,</span><br><span class=\"line\">\t  DWORD nSize,</span><br><span class=\"line\">\t  LPDWORD lpNumberOfBytesRead</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\tHANDLE OpenProcess( </span><br><span class=\"line\">\t  DWORD fdwAccess, </span><br><span class=\"line\">\t  BOOL fInherit, </span><br><span class=\"line\">\t  DWORD IDProcess</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\tDWORD GetWindowThreadProcessId(</span><br><span class=\"line\">\t  HWND hWnd,</span><br><span class=\"line\">\t  LPDWORD lpdwProcessId</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t*/</span><br><span class=\"line\">\tDWORD pid;</span><br><span class=\"line\">\tHWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hWnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tGetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class=\"line\">\tif (NULL == hProcess)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t//m_editbase1 是编辑框的绑定变量，类别为value，变量类型为int，变量名为m_editbase1</span><br><span class=\"line\">\tReadProcessMemory(hProcess, (LPCVOID)0x1005194, &amp;m_editbase1, sizeof(m_editbase1), &amp;pid);</span><br><span class=\"line\"></span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221130104547356.png\" alt=\"image-20221130104547356\"></p>\n<h3 id=\"4扫雷游戏辅助编写\"><a class=\"markdownIt-Anchor\" href=\"#4扫雷游戏辅助编写\">#</a> 4. 扫雷游戏辅助编写</h3>\n<blockquote>\n<p>1. 雷区数据分析</p>\n<p>中级 char a [24][32]  //ReadProcessMemory</p>\n<p>数据雷区基地址 0x01005361    ==  扫雷.exe+5361</p>\n<p>找基地址：new scan 时使用未知数，之后每一次 next scan 根据 change 或者 unchange 进行 next scan</p>\n<p>初级 9*9 ，内存中隔行存放，因为每一行占两行内存，10 代表结束</p>\n<p>只有点击第一下之后才开始布雷，winxp 扫雷特性</p>\n<p>0x8F 是雷，40 空白，40 对应 1，0x10 代表行 / 列结束标识</p>\n<p>宽基地址 0x01005334</p>\n<p>高基地址 0x01005338</p>\n</blockquote>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221130111727184.png\" alt=\"image-20221130111727184\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void CsaoleiDlg::OnBnClickedButton1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tHWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hwnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t::SendMessage(hwnd, WM_COMMAND, 0x20A, 0);  //发送WindowProc的参数</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tHWND hwnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hwnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t::SendMessage(hwnd, WM_COMMAND, 0x20B, 0);  //发送WindowProc的参数</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\twhile (TRUE)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tOnBnClickedButton1();</span><br><span class=\"line\">\t\tSleep(1000);</span><br><span class=\"line\">\t\tOnBnClickedButton2();</span><br><span class=\"line\">\t\tSleep(1000);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t\t/*</span><br><span class=\"line\">\tBOOL ReadProcessMemory(</span><br><span class=\"line\">\t  HANDLE hProcess,</span><br><span class=\"line\">\t  LPCVOID lpBaseAddress,</span><br><span class=\"line\">\t  LPVOID lpBuffer,</span><br><span class=\"line\">\t  DWORD nSize,</span><br><span class=\"line\">\t  LPDWORD lpNumberOfBytesRead</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\tHANDLE OpenProcess( </span><br><span class=\"line\">\t  DWORD fdwAccess, </span><br><span class=\"line\">\t  BOOL fInherit, </span><br><span class=\"line\">\t  DWORD IDProcess</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\tDWORD GetWindowThreadProcessId(</span><br><span class=\"line\">\t  HWND hWnd,</span><br><span class=\"line\">\t  LPDWORD lpdwProcessId</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t*/</span><br><span class=\"line\">\tDWORD pid;</span><br><span class=\"line\">\tHWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hWnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tGetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class=\"line\">\tif (NULL == hProcess)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tReadProcessMemory(hProcess, (LPCVOID)0x1005194, &amp;m_editbase1, sizeof(m_editbase1), &amp;pid);</span><br><span class=\"line\"></span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CsaoleiDlg::OnBnClickedButton5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tDWORD pid;</span><br><span class=\"line\">\tHWND hWnd = ::FindWindow(NULL, _T(&quot;扫雷&quot;));   //找到扫雷窗口</span><br><span class=\"line\">\tif (NULL == hWnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tGetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, pid);  //通过进程ID拿到进程句柄</span><br><span class=\"line\">\tif (NULL == hProcess)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t/*</span><br><span class=\"line\">\t&gt; 0x8F是雷，40空白，40对应1，0x10代表行/列结束标识</span><br><span class=\"line\">\t&gt;</span><br><span class=\"line\">\t&gt; 宽基地址 0x01005334</span><br><span class=\"line\">\t&gt;</span><br><span class=\"line\">\t&gt; 高基地址 0x01005338</span><br><span class=\"line\">\t*/</span><br><span class=\"line\"></span><br><span class=\"line\">\tunsigned char gamedata[24][32] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x01005361, &amp;gamedata, 32*24, &amp;pid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开12&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tint dwHigth = 0;</span><br><span class=\"line\">\tm_strshowdata.Empty();</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x01005338, &amp;dwHigth, sizeof(dwHigth), &amp;pid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未打开13&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCString strTemp = _T(&quot;&quot;);</span><br><span class=\"line\">\t//第一个格子位置</span><br><span class=\"line\">\tshort gamex = 20;</span><br><span class=\"line\">\tshort gamey = 60;</span><br><span class=\"line\">\tunsigned  short xypos[2] = &#123; 0 &#125;;</span><br><span class=\"line\">\tfor (int i = 0; i &lt; dwHigth; i++)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tfor (int j = 0; j &lt; 32; j++)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tif (0x10 == gamedata[i][j])</span><br><span class=\"line\">\t\t\t\tbreak;</span><br><span class=\"line\">\t\t\txypos[0] = gamex + j * 16;</span><br><span class=\"line\">\t\t\txypos[1] = gamey + i * 16;</span><br><span class=\"line\">\t\t\tif (0x8F != gamedata[i][j])</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\t::PostMessage(hWnd, WM_LBUTTONDOWN,MK_LBUTTON,*(int *)xypos);</span><br><span class=\"line\">\t\t\t\t::PostMessage(hWnd, WM_LBUTTONUP,0,*(int *)xypos);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tstrTemp.Format(_T(&quot;%02X &quot;), gamedata[i][j]);</span><br><span class=\"line\">\t\t\tm_strshowdata += strTemp;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tm_strshowdata += _T(&quot;\\r\\n&quot;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"5植物大战僵尸\"><a class=\"markdownIt-Anchor\" href=\"#5植物大战僵尸\">#</a> 5. 植物大战僵尸</h3>\n<p>1. 找阳光地址和基地址</p>\n<p>某一个程序每次运行都不改变的地址（基地址）里面存着阳光的地址</p>\n<p>我们需要找到不会改变的地址，通过偏移拿到阳光的地址</p>\n<p>1. 通过 ce 找到阳光地址，并且在 od 中定位</p>\n<p>dd 0F2EE158</p>\n<p>2. 下内存写入断点</p>\n<p>要是 CE 找的地址在 OD 中没有这个地址的话请在 CE 地址右键谁改写了此地址然后对照着到 OD 找</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221201211117079.png\" alt=\"image-20221201211117079\"></p>\n<p>第一个偏移地址</p>\n<p>阳光地址 0EDD32F8</p>\n<p>当前阳光地址 = eax + 0x5560     eax=0EDCDD98</p>\n<p>00430A11  |.  0188 60550000 add     dword ptr [eax+5560], ecx</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221202195211747.png\" alt=\"image-20221202195211747\"></p>\n<p>第二个偏移地址，找到谁改了 eax=0EDCDD98 的值</p>\n<p>还是去下内存断点</p>\n<p>00538090  |&gt; \\8B01          |mov     eax, dword ptr [ecx]          ;  PlantsVs.00656CA8</p>\n<p>ecx = 0EDCDD98</p>\n<p>eax = [ecx+5560]</p>\n<p>第三个偏移地址</p>\n<p>0053807D  |.  8B49 08       |mov     ecx, dword ptr [ecx+8]</p>\n<p>eax = [[ecx+8]+5560]     0EDCDD98</p>\n<p>基地址 [[6A9EC0]+768]+5560</p>\n<p>2. 分析金币基地址</p>\n<p>通过 ce 工具收集游戏金币基地址</p>\n<p>可能和金币 1:1，也可能是其他比例</p>\n<p>金币显示的值不是数字 1:1 对应关系，我们只能通过范围搜素定位金币地址</p>\n<p>金币的地址不是绿色的基地址所有，所以我们需要找到基地址 + 偏移地址表示他</p>\n<p>第一个偏移地址 06BA60A0</p>\n<p>0041A3BB - 8B 41 28  - mov eax,[ecx+28]         ECX=06BA6078</p>\n<p>金币的地址 = ecx  + 28</p>\n<p>第二个偏移地址</p>\n<p>0040EB41 - 8B 88 2C080000  - mov ecx,[eax+0000082C]        EAX=02101E48</p>\n<p>金币地址 = [eax+0000082c]+28</p>\n<p>第三个偏移地址</p>\n<p>00467B00 - 8B 0D C09E6A00  - mov ecx,[006A9EC0]</p>\n<p>金币地址 =[[006A9EC0]+82c]+28</p>\n<p>3. 分析植物安放冷却时间</p>\n<p>第一步</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0048728C - 83 47 24 01           - add dword ptr [edi+24],01 &#123; 1 &#125;</span><br><span class=\"line\">00487290 - 8B 47 24              - mov eax,[edi+24]</span><br><span class=\"line\">00487293 - 3B 47 28              - cmp eax,[edi+28]</span><br><span class=\"line\">00487296 - 7E 14                 - jle 004872AC</span><br><span class=\"line\">00487298 - C7 47 24 00000000     - mov [edi+24],00000000 &#123; 0 &#125;</span><br><span class=\"line\">0048729F - C6 47 49 00           - mov byte ptr [edi+49],00 &#123; 0 &#125;</span><br><span class=\"line\">004872A3 - C6 47 48 01           - mov byte ptr [edi+48],01 &#123; 1 &#125;</span><br><span class=\"line\">004872A7 - E8 E4FEFFFF           - call 00487190</span><br><span class=\"line\">004872AC - 8B 47 3C              - mov eax,[edi+3C]</span><br><span class=\"line\"></span><br><span class=\"line\">0BE14EC0</span><br></pre></td></tr></table></figure>\n<p>CD 计数器地址 = edi + 24</p>\n<p>CD 计数器上线 = edi + 28</p>\n<p>思路一：该计数器上限的值，缩短冷却时间</p>\n<p>思路二：改写代码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0048728C - 83 47 24 01           - add dword ptr [edi+24],01 &#123; 1 &#125;</span><br><span class=\"line\">00487290 - 8B 47 24              - mov eax,[edi+24]</span><br><span class=\"line\">00487293 - 3B 47 28              - cmp eax,[edi+28]</span><br><span class=\"line\">00487296 - 90                    - nop </span><br><span class=\"line\">00487297 - 90                    - nop </span><br><span class=\"line\">00487298 - C7 47 24 00000000     - mov [edi+24],00000000 &#123; 0 &#125;</span><br><span class=\"line\">0048729F - C6 47 49 00           - mov byte ptr [edi+49],00 &#123; 0 &#125;</span><br><span class=\"line\">004872A3 - C6 47 48 01           - mov byte ptr [edi+48],01 &#123; 1 &#125;</span><br><span class=\"line\">004872A7 - E8 E4FEFFFF           - call 00487190</span><br><span class=\"line\">004872AC - 8B 47 3C              - mov eax,[edi+3C]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>3. 分析大嘴花吞噬时间代码</p>\n<p>1. 定位大嘴花吞噬时间计数器变量的地址</p>\n<p>2. 通过 ce 或者 od 定位谁访问了这个地址，从而定位到判断大嘴花吞噬冷却时间的代码</p>\n<p 0=\"\">00461561 - 83 7F 54 00           - cmp dword ptr [edi+54],00</p>\n<p>00461565 - 75 5F                     - jne 004615C6</p>\n<p>4. 分析种植植物 call</p>\n<p>思路：找出安放植物的 call</p>\n<p>1. 通过鼠标右键选中植物的地址</p>\n<p>2. 分析 call 代码参数及堆栈</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00410A91 - 8B 40 28              - mov eax,[eax+28]</span><br><span class=\"line\">00410A94 - 52                    - push edx</span><br><span class=\"line\">00410A95 - 50                    - push eax</span><br><span class=\"line\">00410A96 - 8B 44 24 20           - mov eax,[esp+20]</span><br><span class=\"line\">00410A9A - 57                    - push edi</span><br><span class=\"line\">00410A9B - 55                    - push ebp</span><br><span class=\"line\">00410A9C - E8 7FC6FFFF           - call 0040D120</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push -1</span><br><span class=\"line\">push 3</span><br><span class=\"line\">mov eax,1</span><br><span class=\"line\">push 2</span><br><span class=\"line\">push 0EC01BD0</span><br><span class=\"line\">call 0040D120</span><br></pre></td></tr></table></figure>\n<p>3. 注入代码，将自己写的植物安放的汇编代码注入到游戏进程空间中，验证</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push -1     ;固定的值</span><br><span class=\"line\">push 2      ;植物类型id,樱桃是2 </span><br><span class=\"line\">mov eax,4   ;x</span><br><span class=\"line\">push 4      ;y</span><br><span class=\"line\">push 147E5FF8    ;[[6A9EC0]+768]</span><br><span class=\"line\">push 0040D120</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>坐标范围为 [4][8] = 5 * 9 = 45</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push -1     ;固定的值</span><br><span class=\"line\">push 2      ;植物类型id,樱桃是2,坚果3</span><br><span class=\"line\">mov eax,0   ;y 0-4</span><br><span class=\"line\">push 4      ;x 0-8</span><br><span class=\"line\">mov ebx,[6A9EC0]</span><br><span class=\"line\">mov ebx,[ebx+768]</span><br><span class=\"line\">push ebx</span><br><span class=\"line\">push 0040D120</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push -1</span><br><span class=\"line\">push 2</span><br><span class=\"line\">mov eax,0</span><br><span class=\"line\">push 2</span><br><span class=\"line\">mov ebx,[6A9EC0]</span><br><span class=\"line\">mov ebx,[ebx+768]</span><br><span class=\"line\">push ebx</span><br><span class=\"line\">call 0040D120</span><br></pre></td></tr></table></figure>\n<p>5. 远程注入代码</p>\n<p>1. 打开目标进程 OpenProcess，获取目标进程句柄</p>\n<p>2. 在目标进程分配内存空间 VirtualAllocEx</p>\n<p>3. 往分配的内存空间中写入代码</p>\n<p>4. 远程调用 CreateRemoteThread  执行目标进程指定地址的代码</p>\n<p>5. 等待远程线程执行完成  WaitForSingleObject</p>\n<p>6. 释放目标进程空间   VirtualFreeEx</p>\n<p>7. 关闭目标进程句柄</p>\n<p>植物血量</p>\n<p>后台运行  有一个标识 1,0</p>\n<p>关键代码位置 0054E1C2，  0F 95 C0  -&gt; B1 01 90</p>\n<p>毁灭菇</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210004852205.png\" alt=\"image-20221210004852205\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210004902774.png\" alt=\"image-20221210004902774\"></p>\n<p>排错思路：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221210211445273.png\" alt=\"image-20221210211445273\"></p>\n<p>到 od 中找到对应位置，查看我们插入的额汇编是否正确</p>\n<p>冰冻</p>\n<p>土豆</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br><span class=\"line\">543</span><br><span class=\"line\">544</span><br><span class=\"line\">545</span><br><span class=\"line\">546</span><br><span class=\"line\">547</span><br><span class=\"line\">548</span><br><span class=\"line\">549</span><br><span class=\"line\">550</span><br><span class=\"line\">551</span><br><span class=\"line\">552</span><br><span class=\"line\">553</span><br><span class=\"line\">554</span><br><span class=\"line\">555</span><br><span class=\"line\">556</span><br><span class=\"line\">557</span><br><span class=\"line\">558</span><br><span class=\"line\">559</span><br><span class=\"line\">560</span><br><span class=\"line\">561</span><br><span class=\"line\">562</span><br><span class=\"line\">563</span><br><span class=\"line\">564</span><br><span class=\"line\">565</span><br><span class=\"line\">566</span><br><span class=\"line\">567</span><br><span class=\"line\">568</span><br><span class=\"line\">569</span><br><span class=\"line\">570</span><br><span class=\"line\">571</span><br><span class=\"line\">572</span><br><span class=\"line\">573</span><br><span class=\"line\">574</span><br><span class=\"line\">575</span><br><span class=\"line\">576</span><br><span class=\"line\">577</span><br><span class=\"line\">578</span><br><span class=\"line\">579</span><br><span class=\"line\">580</span><br><span class=\"line\">581</span><br><span class=\"line\">582</span><br><span class=\"line\">583</span><br><span class=\"line\">584</span><br><span class=\"line\">585</span><br><span class=\"line\">586</span><br><span class=\"line\">587</span><br><span class=\"line\">588</span><br><span class=\"line\">589</span><br><span class=\"line\">590</span><br><span class=\"line\">591</span><br><span class=\"line\">592</span><br><span class=\"line\">593</span><br><span class=\"line\">594</span><br><span class=\"line\">595</span><br><span class=\"line\">596</span><br><span class=\"line\">597</span><br><span class=\"line\">598</span><br><span class=\"line\">599</span><br><span class=\"line\">600</span><br><span class=\"line\">601</span><br><span class=\"line\">602</span><br><span class=\"line\">603</span><br><span class=\"line\">604</span><br><span class=\"line\">605</span><br><span class=\"line\">606</span><br><span class=\"line\">607</span><br><span class=\"line\">608</span><br><span class=\"line\">609</span><br><span class=\"line\">610</span><br><span class=\"line\">611</span><br><span class=\"line\">612</span><br><span class=\"line\">613</span><br><span class=\"line\">614</span><br><span class=\"line\">615</span><br><span class=\"line\">616</span><br><span class=\"line\">617</span><br><span class=\"line\">618</span><br><span class=\"line\">619</span><br><span class=\"line\">620</span><br><span class=\"line\">621</span><br><span class=\"line\">622</span><br><span class=\"line\">623</span><br><span class=\"line\">624</span><br><span class=\"line\">625</span><br><span class=\"line\">626</span><br><span class=\"line\">627</span><br><span class=\"line\">628</span><br><span class=\"line\">629</span><br><span class=\"line\">630</span><br><span class=\"line\">631</span><br><span class=\"line\">632</span><br><span class=\"line\">633</span><br><span class=\"line\">634</span><br><span class=\"line\">635</span><br><span class=\"line\">636</span><br><span class=\"line\">637</span><br><span class=\"line\">638</span><br><span class=\"line\">639</span><br><span class=\"line\">640</span><br><span class=\"line\">641</span><br><span class=\"line\">642</span><br><span class=\"line\">643</span><br><span class=\"line\">644</span><br><span class=\"line\">645</span><br><span class=\"line\">646</span><br><span class=\"line\">647</span><br><span class=\"line\">648</span><br><span class=\"line\">649</span><br><span class=\"line\">650</span><br><span class=\"line\">651</span><br><span class=\"line\">652</span><br><span class=\"line\">653</span><br><span class=\"line\">654</span><br><span class=\"line\">655</span><br><span class=\"line\">656</span><br><span class=\"line\">657</span><br><span class=\"line\">658</span><br><span class=\"line\">659</span><br><span class=\"line\">660</span><br><span class=\"line\">661</span><br><span class=\"line\">662</span><br><span class=\"line\">663</span><br><span class=\"line\">664</span><br><span class=\"line\">665</span><br><span class=\"line\">666</span><br><span class=\"line\">667</span><br><span class=\"line\">668</span><br><span class=\"line\">669</span><br><span class=\"line\">670</span><br><span class=\"line\">671</span><br><span class=\"line\">672</span><br><span class=\"line\">673</span><br><span class=\"line\">674</span><br><span class=\"line\">675</span><br><span class=\"line\">676</span><br><span class=\"line\">677</span><br><span class=\"line\">678</span><br><span class=\"line\">679</span><br><span class=\"line\">680</span><br><span class=\"line\">681</span><br><span class=\"line\">682</span><br><span class=\"line\">683</span><br><span class=\"line\">684</span><br><span class=\"line\">685</span><br><span class=\"line\">686</span><br><span class=\"line\">687</span><br><span class=\"line\">688</span><br><span class=\"line\">689</span><br><span class=\"line\">690</span><br><span class=\"line\">691</span><br><span class=\"line\">692</span><br><span class=\"line\">693</span><br><span class=\"line\">694</span><br><span class=\"line\">695</span><br><span class=\"line\">696</span><br><span class=\"line\">697</span><br><span class=\"line\">698</span><br><span class=\"line\">699</span><br><span class=\"line\">700</span><br><span class=\"line\">701</span><br><span class=\"line\">702</span><br><span class=\"line\">703</span><br><span class=\"line\">704</span><br><span class=\"line\">705</span><br><span class=\"line\">706</span><br><span class=\"line\">707</span><br><span class=\"line\">708</span><br><span class=\"line\">709</span><br><span class=\"line\">710</span><br><span class=\"line\">711</span><br><span class=\"line\">712</span><br><span class=\"line\">713</span><br><span class=\"line\">714</span><br><span class=\"line\">715</span><br><span class=\"line\">716</span><br><span class=\"line\">717</span><br><span class=\"line\">718</span><br><span class=\"line\">719</span><br><span class=\"line\">720</span><br><span class=\"line\">721</span><br><span class=\"line\">722</span><br><span class=\"line\">723</span><br><span class=\"line\">724</span><br><span class=\"line\">725</span><br><span class=\"line\">726</span><br><span class=\"line\">727</span><br><span class=\"line\">728</span><br><span class=\"line\">729</span><br><span class=\"line\">730</span><br><span class=\"line\">731</span><br><span class=\"line\">732</span><br><span class=\"line\">733</span><br><span class=\"line\">734</span><br><span class=\"line\">735</span><br><span class=\"line\">736</span><br><span class=\"line\">737</span><br><span class=\"line\">738</span><br><span class=\"line\">739</span><br><span class=\"line\">740</span><br><span class=\"line\">741</span><br><span class=\"line\">742</span><br><span class=\"line\">743</span><br><span class=\"line\">744</span><br><span class=\"line\">745</span><br><span class=\"line\">746</span><br><span class=\"line\">747</span><br><span class=\"line\">748</span><br><span class=\"line\">749</span><br><span class=\"line\">750</span><br><span class=\"line\">751</span><br><span class=\"line\">752</span><br><span class=\"line\">753</span><br><span class=\"line\">754</span><br><span class=\"line\">755</span><br><span class=\"line\">756</span><br><span class=\"line\">757</span><br><span class=\"line\">758</span><br><span class=\"line\">759</span><br><span class=\"line\">760</span><br><span class=\"line\">761</span><br><span class=\"line\">762</span><br><span class=\"line\">763</span><br><span class=\"line\">764</span><br><span class=\"line\">765</span><br><span class=\"line\">766</span><br><span class=\"line\">767</span><br><span class=\"line\">768</span><br><span class=\"line\">769</span><br><span class=\"line\">770</span><br><span class=\"line\">771</span><br><span class=\"line\">772</span><br><span class=\"line\">773</span><br><span class=\"line\">774</span><br><span class=\"line\">775</span><br><span class=\"line\">776</span><br><span class=\"line\">777</span><br><span class=\"line\">778</span><br><span class=\"line\">779</span><br><span class=\"line\">780</span><br><span class=\"line\">781</span><br><span class=\"line\">782</span><br><span class=\"line\">783</span><br><span class=\"line\">784</span><br><span class=\"line\">785</span><br><span class=\"line\">786</span><br><span class=\"line\">787</span><br><span class=\"line\">788</span><br><span class=\"line\">789</span><br><span class=\"line\">790</span><br><span class=\"line\">791</span><br><span class=\"line\">792</span><br><span class=\"line\">793</span><br><span class=\"line\">794</span><br><span class=\"line\">795</span><br><span class=\"line\">796</span><br><span class=\"line\">797</span><br><span class=\"line\">798</span><br><span class=\"line\">799</span><br><span class=\"line\">800</span><br><span class=\"line\">801</span><br><span class=\"line\">802</span><br><span class=\"line\">803</span><br><span class=\"line\">804</span><br><span class=\"line\">805</span><br><span class=\"line\">806</span><br><span class=\"line\">807</span><br><span class=\"line\">808</span><br><span class=\"line\">809</span><br><span class=\"line\">810</span><br><span class=\"line\">811</span><br><span class=\"line\">812</span><br><span class=\"line\">813</span><br><span class=\"line\">814</span><br><span class=\"line\">815</span><br><span class=\"line\">816</span><br><span class=\"line\">817</span><br><span class=\"line\">818</span><br><span class=\"line\">819</span><br><span class=\"line\">820</span><br><span class=\"line\">821</span><br><span class=\"line\">822</span><br><span class=\"line\">823</span><br><span class=\"line\">824</span><br><span class=\"line\">825</span><br><span class=\"line\">826</span><br><span class=\"line\">827</span><br><span class=\"line\">828</span><br><span class=\"line\">829</span><br><span class=\"line\">830</span><br><span class=\"line\">831</span><br><span class=\"line\">832</span><br><span class=\"line\">833</span><br><span class=\"line\">834</span><br><span class=\"line\">835</span><br><span class=\"line\">836</span><br><span class=\"line\">837</span><br><span class=\"line\">838</span><br><span class=\"line\">839</span><br><span class=\"line\">840</span><br><span class=\"line\">841</span><br><span class=\"line\">842</span><br><span class=\"line\">843</span><br><span class=\"line\">844</span><br><span class=\"line\">845</span><br><span class=\"line\">846</span><br><span class=\"line\">847</span><br><span class=\"line\">848</span><br><span class=\"line\">849</span><br><span class=\"line\">850</span><br><span class=\"line\">851</span><br><span class=\"line\">852</span><br><span class=\"line\">853</span><br><span class=\"line\">854</span><br><span class=\"line\">855</span><br><span class=\"line\">856</span><br><span class=\"line\">857</span><br><span class=\"line\">858</span><br><span class=\"line\">859</span><br><span class=\"line\">860</span><br><span class=\"line\">861</span><br><span class=\"line\">862</span><br><span class=\"line\">863</span><br><span class=\"line\">864</span><br><span class=\"line\">865</span><br><span class=\"line\">866</span><br><span class=\"line\">867</span><br><span class=\"line\">868</span><br><span class=\"line\">869</span><br><span class=\"line\">870</span><br><span class=\"line\">871</span><br><span class=\"line\">872</span><br><span class=\"line\">873</span><br><span class=\"line\">874</span><br><span class=\"line\">875</span><br><span class=\"line\">876</span><br><span class=\"line\">877</span><br><span class=\"line\">878</span><br><span class=\"line\">879</span><br><span class=\"line\">880</span><br><span class=\"line\">881</span><br><span class=\"line\">882</span><br><span class=\"line\">883</span><br><span class=\"line\">884</span><br><span class=\"line\">885</span><br><span class=\"line\">886</span><br><span class=\"line\">887</span><br><span class=\"line\">888</span><br><span class=\"line\">889</span><br><span class=\"line\">890</span><br><span class=\"line\">891</span><br><span class=\"line\">892</span><br><span class=\"line\">893</span><br><span class=\"line\">894</span><br><span class=\"line\">895</span><br><span class=\"line\">896</span><br><span class=\"line\">897</span><br><span class=\"line\">898</span><br><span class=\"line\">899</span><br><span class=\"line\">900</span><br><span class=\"line\">901</span><br><span class=\"line\">902</span><br><span class=\"line\">903</span><br><span class=\"line\">904</span><br><span class=\"line\">905</span><br><span class=\"line\">906</span><br><span class=\"line\">907</span><br><span class=\"line\">908</span><br><span class=\"line\">909</span><br><span class=\"line\">910</span><br><span class=\"line\">911</span><br><span class=\"line\">912</span><br><span class=\"line\">913</span><br><span class=\"line\">914</span><br><span class=\"line\">915</span><br><span class=\"line\">916</span><br><span class=\"line\">917</span><br><span class=\"line\">918</span><br><span class=\"line\">919</span><br><span class=\"line\">920</span><br><span class=\"line\">921</span><br><span class=\"line\">922</span><br><span class=\"line\">923</span><br><span class=\"line\">924</span><br><span class=\"line\">925</span><br><span class=\"line\">926</span><br><span class=\"line\">927</span><br><span class=\"line\">928</span><br><span class=\"line\">929</span><br><span class=\"line\">930</span><br><span class=\"line\">931</span><br><span class=\"line\">932</span><br><span class=\"line\">933</span><br><span class=\"line\">934</span><br><span class=\"line\">935</span><br><span class=\"line\">936</span><br><span class=\"line\">937</span><br><span class=\"line\">938</span><br><span class=\"line\">939</span><br><span class=\"line\">940</span><br><span class=\"line\">941</span><br><span class=\"line\">942</span><br><span class=\"line\">943</span><br><span class=\"line\">944</span><br><span class=\"line\">945</span><br><span class=\"line\">946</span><br><span class=\"line\">947</span><br><span class=\"line\">948</span><br><span class=\"line\">949</span><br><span class=\"line\">950</span><br><span class=\"line\">951</span><br><span class=\"line\">952</span><br><span class=\"line\">953</span><br><span class=\"line\">954</span><br><span class=\"line\">955</span><br><span class=\"line\">956</span><br><span class=\"line\">957</span><br><span class=\"line\">958</span><br><span class=\"line\">959</span><br><span class=\"line\">960</span><br><span class=\"line\">961</span><br><span class=\"line\">962</span><br><span class=\"line\">963</span><br><span class=\"line\">964</span><br><span class=\"line\">965</span><br><span class=\"line\">966</span><br><span class=\"line\">967</span><br><span class=\"line\">968</span><br><span class=\"line\">969</span><br><span class=\"line\">970</span><br><span class=\"line\">971</span><br><span class=\"line\">972</span><br><span class=\"line\">973</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// plantDlg.cpp : 实现文件</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &quot;plant.h&quot;</span><br><span class=\"line\">#include &quot;plantDlg.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#ifdef _DEBUG</span><br><span class=\"line\">#define new DEBUG_NEW</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// 用于应用程序“关于”菜单项的 CAboutDlg 对话框</span><br><span class=\"line\"></span><br><span class=\"line\">class CAboutDlg : public CDialog</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tCAboutDlg();</span><br><span class=\"line\"></span><br><span class=\"line\">// 对话框数据</span><br><span class=\"line\">\tenum &#123; IDD = IDD_ABOUTBOX &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">\tprotected:</span><br><span class=\"line\">\tvirtual void DoDataExchange(CDataExchange* pDX);    // DDX/DDV 支持</span><br><span class=\"line\"></span><br><span class=\"line\">// 实现</span><br><span class=\"line\">protected:</span><br><span class=\"line\">\tDECLARE_MESSAGE_MAP()</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">CAboutDlg::CAboutDlg() : CDialog(CAboutDlg::IDD)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CAboutDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialog::DoDataExchange(pDX);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CAboutDlg, CDialog)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// CplantDlg 对话框</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">CplantDlg::CplantDlg(CWnd* pParent /*=NULL*/)</span><br><span class=\"line\">\t: CDialog(CplantDlg::IDD, pParent)</span><br><span class=\"line\">\t, m_edit_sun(9999)</span><br><span class=\"line\">\t, m_edit_gold(9999)</span><br><span class=\"line\">\t, m_nocd(FALSE)</span><br><span class=\"line\">\t, m_bigmouth_nocd(FALSE)</span><br><span class=\"line\">\t, m_x(0)</span><br><span class=\"line\">\t, m_y(0)</span><br><span class=\"line\">\t, m_noblood(FALSE)</span><br><span class=\"line\">\t, no_run(FALSE)</span><br><span class=\"line\">\t, no_pit(FALSE)</span><br><span class=\"line\">\t, m_nomubei(FALSE)</span><br><span class=\"line\">\t, m_tudou(FALSE)</span><br><span class=\"line\">\t, m_frozen(FALSE)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tm_hIcon = AfxGetApp()-&gt;LoadIcon(IDR_MAINFRAME);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::DoDataExchange(CDataExchange* pDX)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialog::DoDataExchange(pDX);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT1, m_edit_sun);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT2, m_edit_gold);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK1, m_nocd);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK2, m_bigmouth_nocd);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT3, m_x);</span><br><span class=\"line\">\tDDX_Text(pDX, IDC_EDIT4, m_y);</span><br><span class=\"line\">\tDDX_Control(pDX, IDC_COMBO1, m_cbPlantsChoose);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK3, m_noblood);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK4, no_run);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK5, no_pit);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK6, m_nomubei);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK7, m_tudou);</span><br><span class=\"line\">\tDDX_Check(pDX, IDC_CHECK8, m_frozen);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BEGIN_MESSAGE_MAP(CplantDlg, CDialog)</span><br><span class=\"line\">\tON_WM_SYSCOMMAND()</span><br><span class=\"line\">\tON_WM_PAINT()</span><br><span class=\"line\">\tON_WM_QUERYDRAGICON()</span><br><span class=\"line\">\t//&#125;&#125;AFX_MSG_MAP</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON1, &amp;CplantDlg::OnBnClickedButton1)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON2, &amp;CplantDlg::OnBnClickedButton2)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON3, &amp;CplantDlg::OnBnClickedButton3)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON4, &amp;CplantDlg::OnBnClickedButton4)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK1, &amp;CplantDlg::OnBnClickedCheck1)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK2, &amp;CplantDlg::OnBnClickedCheck2)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON5, &amp;CplantDlg::OnBnClickedButton5)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON6, &amp;CplantDlg::OnBnClickedButton6)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK3, &amp;CplantDlg::OnBnClickedCheck3)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK4, &amp;CplantDlg::OnBnClickedCheck4)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK5, &amp;CplantDlg::OnBnClickedCheck5)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK6, &amp;CplantDlg::OnBnClickedCheck6)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_BUTTON7, &amp;CplantDlg::OnBnClickedButton7)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK7, &amp;CplantDlg::OnBnClickedCheck7)</span><br><span class=\"line\">\tON_BN_CLICKED(IDC_CHECK8, &amp;CplantDlg::OnBnClickedCheck8)</span><br><span class=\"line\">END_MESSAGE_MAP()</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">// CplantDlg 消息处理程序</span><br><span class=\"line\"></span><br><span class=\"line\">BOOL CplantDlg::OnInitDialog()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tCDialog::OnInitDialog();</span><br><span class=\"line\"></span><br><span class=\"line\">\t// 将“关于...”菜单项添加到系统菜单中。</span><br><span class=\"line\"></span><br><span class=\"line\">\t// IDM_ABOUTBOX 必须在系统命令范围内。</span><br><span class=\"line\">\tASSERT((IDM_ABOUTBOX &amp; 0xFFF0) == IDM_ABOUTBOX);</span><br><span class=\"line\">\tASSERT(IDM_ABOUTBOX &lt; 0xF000);</span><br><span class=\"line\"></span><br><span class=\"line\">\tenableDebugPriv();</span><br><span class=\"line\"></span><br><span class=\"line\">\tCMenu* pSysMenu = GetSystemMenu(FALSE);</span><br><span class=\"line\">\tif (pSysMenu != NULL)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCString strAboutMenu;</span><br><span class=\"line\">\t\tstrAboutMenu.LoadString(IDS_ABOUTBOX);</span><br><span class=\"line\">\t\tif (!strAboutMenu.IsEmpty())</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_SEPARATOR);</span><br><span class=\"line\">\t\t\tpSysMenu-&gt;AppendMenu(MF_STRING, IDM_ABOUTBOX, strAboutMenu);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t// 设置此对话框的图标。当应用程序主窗口不是对话框时，框架将自动</span><br><span class=\"line\">\t//  执行此操作</span><br><span class=\"line\">\tSetIcon(m_hIcon, TRUE);\t\t\t// 设置大图标</span><br><span class=\"line\">\tSetIcon(m_hIcon, FALSE);\t\t// 设置小图标</span><br><span class=\"line\"></span><br><span class=\"line\">\t// TODO: 在此添加额外的初始化代码</span><br><span class=\"line\">\taddPlantsToCombox();</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn TRUE;  // 除非将焦点设置到控件，否则返回 TRUE</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnSysCommand(UINT nID, LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif ((nID &amp; 0xFFF0) == IDM_ABOUTBOX)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCAboutDlg dlgAbout;</span><br><span class=\"line\">\t\tdlgAbout.DoModal();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnSysCommand(nID, lParam);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 如果向对话框添加最小化按钮，则需要下面的代码</span><br><span class=\"line\">//  来绘制该图标。对于使用文档/视图模型的 MFC 应用程序，</span><br><span class=\"line\">//  这将由框架自动完成。</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnPaint()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tif (IsIconic())</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCPaintDC dc(this); // 用于绘制的设备上下文</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tSendMessage(WM_ICONERASEBKGND, reinterpret_cast&lt;WPARAM&gt;(dc.GetSafeHdc()), 0);</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// 使图标在工作区矩形中居中</span><br><span class=\"line\">\t\tint cxIcon = GetSystemMetrics(SM_CXICON);</span><br><span class=\"line\">\t\tint cyIcon = GetSystemMetrics(SM_CYICON);</span><br><span class=\"line\">\t\tCRect rect;</span><br><span class=\"line\">\t\tGetClientRect(&amp;rect);</span><br><span class=\"line\">\t\tint x = (rect.Width() - cxIcon + 1) / 2;</span><br><span class=\"line\">\t\tint y = (rect.Height() - cyIcon + 1) / 2;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// 绘制图标</span><br><span class=\"line\">\t\tdc.DrawIcon(x, y, m_hIcon);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCDialog::OnPaint();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//当用户拖动最小化窗口时系统调用此函数取得光标</span><br><span class=\"line\">//显示。</span><br><span class=\"line\">HCURSOR CplantDlg::OnQueryDragIcon()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\treturn static_cast&lt;HCURSOR&gt;(m_hIcon);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD CplantDlg::FindGameProcessidByWndTitle(CString strTitle)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tDWORD pid = 0;</span><br><span class=\"line\">\tHWND hWnd = ::FindWindow(NULL, strTitle.GetBuffer());   //找到窗口</span><br><span class=\"line\">\tif (NULL == hWnd)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;未找到指定游戏&quot;), _T(&quot;错误&quot;), MB_OK);</span><br><span class=\"line\">\t\treturn 0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tGetWindowThreadProcessId(hWnd, &amp;pid);  //通过窗口句柄拿到进程ID</span><br><span class=\"line\">\treturn pid;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t// 计算基地址  [[6A9EC0]+768]+5560</span><br><span class=\"line\">\tDWORD dwTemp = 0;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdwTemp += 0x768;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDWORD dwsun = 99999;</span><br><span class=\"line\">\tdwTemp += 0x5560;</span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwsun, sizeof(DWORD), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t// 计算基地址  [[006A9EC0]+82c]+28</span><br><span class=\"line\">\tDWORD dwTemp = 0;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdwTemp += 0x82c;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDWORD dwGold = 99999;</span><br><span class=\"line\">\tdwTemp += 0x28;</span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwGold, sizeof(DWORD), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t// 计算基地址  [[6A9EC0]+768]+5560</span><br><span class=\"line\">\tDWORD dwTemp = 0;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdwTemp += 0x768;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDWORD dwsun = m_edit_sun;</span><br><span class=\"line\">\tdwTemp += 0x5560;</span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwsun, sizeof(DWORD), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t// 计算基地址  [[006A9EC0]+82c]+28</span><br><span class=\"line\">\tDWORD dwTemp = 0;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPCVOID)0x6A9EC0, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdwTemp += 0x82c;</span><br><span class=\"line\">\tif (!ReadProcessMemory(hProcess, (LPVOID)dwTemp, (LPVOID)&amp;dwTemp, sizeof(DWORD), &amp;dwPid))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;读取数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDWORD dwGold = m_edit_gold;;</span><br><span class=\"line\">\tdwTemp += 0x28;</span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(dwTemp), &amp;dwGold, sizeof(DWORD), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck1()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t// 00487296 - 7E 14                 - jle 004872AC  植物cd判断跳转代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[2] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_nocd)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x7E;</span><br><span class=\"line\">\t\tbuf[1] = 0x14;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x00487296), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck2()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t//00461565 - 75 5F   - jne 004615C6</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[2] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_bigmouth_nocd)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x75;</span><br><span class=\"line\">\t\tbuf[1] = 0x5f;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x00461565), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"># if 0 </span><br><span class=\"line\">// 裸函数，不需要编译器添加任何代码</span><br><span class=\"line\">__declspec(naked) void putPlant()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpushad</span><br><span class=\"line\">\t\tpush -1</span><br><span class=\"line\">\t\tpush 2</span><br><span class=\"line\">\t\tmov eax, 4</span><br><span class=\"line\">\t\tpush 4</span><br><span class=\"line\">\t\tmov ebx, ds:[0x6A9EC0]</span><br><span class=\"line\">\t\tmov ebx, ds:[ebx + 0x768]</span><br><span class=\"line\">\t\tpush ebx</span><br><span class=\"line\">\t\tmov edx, 0x40D120</span><br><span class=\"line\">\t\tcall edx</span><br><span class=\"line\">\t\tpopad</span><br><span class=\"line\">\t\tret</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t// 打开目标进程</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\t// 在目标进程分配内存空间</span><br><span class=\"line\">\tPVOID ThreadFunAdd = VirtualAllocEx(hProcess, NULL, 4096, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\"></span><br><span class=\"line\">\t// 往分配的内存空间中写入代码</span><br><span class=\"line\">\tDWORD byWrite = 0;</span><br><span class=\"line\">\tbool bret = WriteProcessMemory(hProcess, ThreadFunAdd, putPlant, 4096, &amp;byWrite);</span><br><span class=\"line\"></span><br><span class=\"line\">\t// 执行目标进程指定地址的代码</span><br><span class=\"line\">\tCreateRemoteThread(hProcess, NULL, NULL, (LPTHREAD_START_ROUTINE)ThreadFunAdd, NULL, NULL, NULL);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">#endif</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">bool CplantDlg::enableDebugPriv()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tHANDLE hToken;</span><br><span class=\"line\">\tLUID sedebugnameValue;</span><br><span class=\"line\">\tTOKEN_PRIVILEGES tkp;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!OpenProcessToken(GetCurrentProcess(), TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, &amp;hToken))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\treturn false;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!LookupPrivilegeValue(NULL, SE_DEBUG_NAME, &amp;sedebugnameValue))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCloseHandle(hToken);</span><br><span class=\"line\">\t\treturn false;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\ttkp.PrivilegeCount = 1;</span><br><span class=\"line\">\ttkp.Privileges[0].Luid = sedebugnameValue;</span><br><span class=\"line\">\ttkp.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!AdjustTokenPrivileges(hToken, FALSE, &amp;tkp, sizeof(tkp), NULL, NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCloseHandle(hToken);</span><br><span class=\"line\">\t\treturn false;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn true;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::addPlantsToCombox()</span><br><span class=\"line\">&#123;\t</span><br><span class=\"line\">\tint i = 0;</span><br><span class=\"line\">\ti = m_cbPlantsChoose.AddString(_T(&quot;樱桃炸弹&quot;));</span><br><span class=\"line\">\tm_cbPlantsChoose.SetItemData(i, 2);</span><br><span class=\"line\">\ti = m_cbPlantsChoose.AddString(_T(&quot;毁灭菇&quot;));</span><br><span class=\"line\">\tm_cbPlantsChoose.SetItemData(i, 15);</span><br><span class=\"line\">\ti = m_cbPlantsChoose.AddString(_T(&quot;寒冰菇&quot;));</span><br><span class=\"line\">\tm_cbPlantsChoose.SetItemData(i, 14);</span><br><span class=\"line\">\ti = m_cbPlantsChoose.AddString(_T(&quot;魅惑菇&quot;));</span><br><span class=\"line\">\tm_cbPlantsChoose.SetItemData(i, 12);</span><br><span class=\"line\">\ti = m_cbPlantsChoose.AddString(_T(&quot;坚果墙&quot;));</span><br><span class=\"line\">\tm_cbPlantsChoose.SetItemData(i, 3);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">typedef struct PutPlantsPareame</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUINT u_x;</span><br><span class=\"line\">\tUINT u_y;</span><br><span class=\"line\">\tUINT u_plantID;</span><br><span class=\"line\">&#125;PutPlantsParame,*PPutPlantsPareame;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">DWORD __stdcall CplantDlg::PutPlants(LPVOID lpThreadParame)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tPPutPlantsPareame pParame = (PPutPlantsPareame)lpThreadParame;</span><br><span class=\"line\">\tUINT u_x = pParame-&gt;u_x;</span><br><span class=\"line\">\tUINT u_y = pParame-&gt;u_x;</span><br><span class=\"line\">\tUINT u_plantid = pParame-&gt;u_plantID;</span><br><span class=\"line\"></span><br><span class=\"line\">\t__asm</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpushad</span><br><span class=\"line\">\t\tpush -1</span><br><span class=\"line\">\t\tpush u_plantid</span><br><span class=\"line\">\t\tmov eax, u_x</span><br><span class=\"line\">\t\tpush u_y</span><br><span class=\"line\">\t\tmov ebx, dword ptr ds:[0x6A9EC0]</span><br><span class=\"line\">\t\tmov ebx, dword ptr ds:[ebx + 0x768]</span><br><span class=\"line\">\t\tpush ebx</span><br><span class=\"line\">\t\tmov edx, 0x0040D120</span><br><span class=\"line\">\t\tcall edx</span><br><span class=\"line\">\t\tpopad</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int CplantDlg::GetPlantsIDByName(CString name)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tint i = m_cbPlantsChoose.FindString(-1, name);</span><br><span class=\"line\">\treturn m_cbPlantsChoose.GetItemData(i);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tUpdateData(TRUE);   //从页面读取变量</span><br><span class=\"line\">\tCString strPlantName = _T(&quot;&quot;);</span><br><span class=\"line\">\tDWORD dwPlantID = 0;</span><br><span class=\"line\">\tDWORD dwPid = 0;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_cbPlantsChoose.GetWindowText(strPlantName);</span><br><span class=\"line\">\tdwPlantID = GetPlantsIDByName(strPlantName);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//打开进程</span><br><span class=\"line\">\tdwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">\t//远程调用参数</span><br><span class=\"line\">\tPutPlantsPareame parame;</span><br><span class=\"line\">\tparame.u_plantID = dwPlantID;</span><br><span class=\"line\">\tparame.u_x = m_x;</span><br><span class=\"line\">\tparame.u_y = m_y;</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\tif (!InjectRemoteFunc(dwPid, PutPlants, &amp;parame, sizeof(parame)))</span><br><span class=\"line\">\t\tMessageBox(_T(&quot;远程调用失败&quot;), NULL, 0);</span><br><span class=\"line\">\t</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">BOOL CplantDlg::InjectRemoteFunc(DWORD dwPid, LPVOID mFunc, LPVOID pRemoteParam, DWORD dwParameSize, DWORD dwWaitTime)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tHANDLE hProcess = NULL;</span><br><span class=\"line\">\tLPVOID ThreadAdd = NULL;</span><br><span class=\"line\">\tDWORD lpNumberofBytes = 0;</span><br><span class=\"line\">\tBOOL bret = FALSE, bSucc = TRUE;</span><br><span class=\"line\">\tLPVOID ParamAdd = NULL;</span><br><span class=\"line\">\tHANDLE hThread = NULL;</span><br><span class=\"line\">\tDWORD dwWait = 0;</span><br><span class=\"line\"></span><br><span class=\"line\">\tdo</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//打开被注入的进程</span><br><span class=\"line\">\t\thProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\t\tif (NULL == hProcess) break;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t//装载函数的空间</span><br><span class=\"line\">\t\tThreadAdd = VirtualAllocEx(hProcess, NULL, 4096, MEM_COMMIT, PAGE_EXECUTE_READWRITE);</span><br><span class=\"line\">\t\tif (NULL == ThreadAdd) break;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t//写入函数</span><br><span class=\"line\">\t\tbret = WriteProcessMemory(hProcess, ThreadAdd, mFunc, 4096, &amp;lpNumberofBytes);</span><br><span class=\"line\">\t\tif (FALSE == bret) break;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tif (0 != dwParameSize)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t//装在函数所需要的参数空间</span><br><span class=\"line\">\t\t\tParamAdd = VirtualAllocEx(hProcess, NULL, dwParameSize, MEM_COMMIT, PAGE_READWRITE);</span><br><span class=\"line\">\t\t\tif (NULL == ParamAdd) break;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t\t//写入参数地址</span><br><span class=\"line\">\t\t\tbret = WriteProcessMemory(hProcess, ParamAdd, pRemoteParam, dwParameSize, &amp;lpNumberofBytes);</span><br><span class=\"line\">\t\t\tif (FALSE == bret) break;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t// 创建远程线程</span><br><span class=\"line\">\t\thThread = CreateRemoteThread(hProcess, NULL, NULL, (LPTHREAD_START_ROUTINE)ThreadAdd, ParamAdd, NULL, &amp;lpNumberofBytes);</span><br><span class=\"line\">\t\tif (NULL == hThread) break;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tbSucc = TRUE;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125; while (FALSE);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//等待线程结束</span><br><span class=\"line\">\tif (bSucc)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tdwWait = WaitForSingleObject(hThread, dwWaitTime);</span><br><span class=\"line\">\t\tif (WAIT_TIMEOUT == dwWait) goto end;   //如果超时放弃释放资源，防止目标进程在使用</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t//释放目标线程中分配的资源</span><br><span class=\"line\">\tif (bSucc &amp;&amp; ThreadAdd &amp;&amp; hProcess)</span><br><span class=\"line\">\t\tVirtualFreeEx(hProcess, ThreadAdd, 0, MEM_RELEASE);</span><br><span class=\"line\"></span><br><span class=\"line\">\tif (bSucc &amp;&amp; (0 != dwParameSize) &amp;&amp; pRemoteParam &amp;&amp; hProcess)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tVirtualFreeEx(hProcess, pRemoteParam, 0, MEM_RELEASE);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">end:</span><br><span class=\"line\">\tif (NULL != hThread) CloseHandle(hThread);</span><br><span class=\"line\">\tif (NULL != hProcess) CloseHandle(hProcess);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn bSucc;</span><br><span class=\"line\"></span><br><span class=\"line\">\t//如果使用stdcall,，然后WriteProcessMemory使用单独计算的地址，我的程序会崩溃，只知道是写入多了很多编译器加的代码，但这些代码为什么会出错暂时没找到原因</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton6()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck3()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[4] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_noblood)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x83;</span><br><span class=\"line\">\t\tbuf[1] = 0x46;</span><br><span class=\"line\">\t\tbuf[2] = 0x40;</span><br><span class=\"line\">\t\tbuf[3] = 0x01;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x83;</span><br><span class=\"line\">\t\tbuf[1] = 0x46;</span><br><span class=\"line\">\t\tbuf[2] = 0x40;</span><br><span class=\"line\">\t\tbuf[3] = 0xFC;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052FCF0), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck4()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[3] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_noblood)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t\tbuf[2] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x0F;</span><br><span class=\"line\">\t\tbuf[1] = 0x95;</span><br><span class=\"line\">\t\tbuf[2] = 0xC0;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052FCF0), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck5()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[2] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (no_pit)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x75;</span><br><span class=\"line\">\t\tbuf[1] = 0x05;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0041D79E), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck6()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[2] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_nomubei)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x75;</span><br><span class=\"line\">\t\tbuf[1] = 0x5F;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0045FD07), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD __stdcall CplantDlg::PutAllPlants(LPVOID lpThreadParame)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t__asm</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tpushad</span><br><span class=\"line\">\t\tpush -1</span><br><span class=\"line\">\t\tpush 2</span><br><span class=\"line\">\t\tmov eax, 1</span><br><span class=\"line\">\t\tpush 1</span><br><span class=\"line\">\t\tmov ebx, dword ptr ds:[0x6A9EC0]</span><br><span class=\"line\">\t\tmov ebx, dword ptr ds:[ebx + 0x768]</span><br><span class=\"line\">\t\tpush ebx</span><br><span class=\"line\">\t\tmov edx, 0x0040D120</span><br><span class=\"line\">\t\tcall edx</span><br><span class=\"line\">\t\tpopad</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedButton7()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);   //从页面读取变量</span><br><span class=\"line\">\tCString strPlantName = _T(&quot;&quot;);</span><br><span class=\"line\">\tDWORD dwPlantID = 0;</span><br><span class=\"line\">\tDWORD dwPid = 0;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_cbPlantsChoose.GetWindowText(strPlantName);</span><br><span class=\"line\">\tdwPlantID = GetPlantsIDByName(strPlantName);</span><br><span class=\"line\"></span><br><span class=\"line\">\t//打开进程</span><br><span class=\"line\">\tdwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\"></span><br><span class=\"line\">\t//远程调用参数</span><br><span class=\"line\">\tPutPlantsPareame parame;</span><br><span class=\"line\">\tparame.u_plantID = dwPlantID;</span><br><span class=\"line\">\tparame.u_x = m_x;</span><br><span class=\"line\">\tparame.u_y = m_y;</span><br><span class=\"line\"></span><br><span class=\"line\">\t</span><br><span class=\"line\">\tif (!InjectRemoteFunc(dwPid, PutAllPlants, &amp;parame, sizeof(parame)))</span><br><span class=\"line\">\t\tMessageBox(_T(&quot;远程调用失败&quot;), NULL, 0);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck7()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[6] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_tudou)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x90;</span><br><span class=\"line\">\t\tbuf[1] = 0x90;</span><br><span class=\"line\">\t\tbuf[2] = 0x90;</span><br><span class=\"line\">\t\tbuf[3] = 0x90;</span><br><span class=\"line\">\t\tbuf[4] = 0x90;</span><br><span class=\"line\">\t\tbuf[5] = 0x90;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x0F;</span><br><span class=\"line\">\t\tbuf[1] = 0x85;</span><br><span class=\"line\">\t\tbuf[2] = 0xFA;</span><br><span class=\"line\">\t\tbuf[3] = 0x01;</span><br><span class=\"line\">\t\tbuf[4] = 0x00;</span><br><span class=\"line\">\t\tbuf[5] = 0x00;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0045FE53), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">void CplantDlg::OnBnClickedCheck8()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加控件通知处理程序代码</span><br><span class=\"line\">\tUpdateData(TRUE);</span><br><span class=\"line\">\tDWORD dwPid = FindGameProcessidByWndTitle(_T(&quot;植物大战僵尸中文版&quot;));</span><br><span class=\"line\">\tHANDLE hProcess = OpenProcess(PROCESS_ALL_ACCESS, FALSE, dwPid);</span><br><span class=\"line\">\tif (!hProcess)    //处理未找到时操作</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;进程打开失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\tUCHAR buf[3] = &#123; 0 &#125;;</span><br><span class=\"line\">\tif (m_frozen)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//nop nop</span><br><span class=\"line\">\t\t//禁用cd</span><br><span class=\"line\">\t\tbuf[0] = 0x83;</span><br><span class=\"line\">\t\tbuf[1] = 0xC0;</span><br><span class=\"line\">\t\tbuf[2] = 0x01;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\telse</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t//7e 14 </span><br><span class=\"line\">\t\t//启用cd时间</span><br><span class=\"line\">\t\tbuf[0] = 0x83;</span><br><span class=\"line\">\t\tbuf[1] = 0xC0;</span><br><span class=\"line\">\t\tbuf[2] = 0xFD;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">\tif (!::WriteProcessMemory(hProcess, (LPVOID)(0x0052B41F), buf, sizeof(buf), NULL))</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t::MessageBox(NULL, _T(&quot;写入数据失败&quot;), NULL, MB_OK);</span><br><span class=\"line\">\t\tCloseHandle(hProcess);</span><br><span class=\"line\">\t\treturn;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tCloseHandle(hProcess);</span><br><span class=\"line\">\tUpdateData(FALSE);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"6网游辅助实战训练\"><a class=\"markdownIt-Anchor\" href=\"#6网游辅助实战训练\">#</a> 6. 网游辅助实战训练</h3>\n<p>LoadLibrary    // 加载模块</p>\n<p>FreeLibrary    // 卸载模块</p>\n<p>CreateRemoteThread    // 创建远程线程</p>\n<p>GetModuleHandle      // 通过模块名称获取模块句柄</p>\n<h4 id=\"角色人物分析\"><a class=\"markdownIt-Anchor\" href=\"#角色人物分析\">#</a> 角色人物分析</h4>\n<p>角色名</p>\n<p>血量</p>\n<p>魔法</p>\n<p>等级</p>\n<p>职业</p>\n<p>找人物的属性信息，其实是找 this 指针，通过偏移来找人物属性</p>\n<p>1. 人物真气</p>\n<p>1.CE 搜索真气值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00B2CC25 - 89 86 8C070000        - mov [esi+0000078C],eax</span><br><span class=\"line\">eax = 00000212</span><br><span class=\"line\">esi = 15E71F60   5B14C038</span><br><span class=\"line\">当前血量 = [esi + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B2CB07 - 8B F1                 - mov esi,ecx</span><br><span class=\"line\">ECX = 514FA270</span><br><span class=\"line\">当前血量 = [ECX + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B37131 - 56                    - push esi</span><br><span class=\"line\">00B37132 - E8 C959FFFF           - call 00B2CB00</span><br><span class=\"line\">00B37137 - B0 01                 - mov al,01 &#123; 1 &#125;</span><br><span class=\"line\">ecx = 514FA270</span><br><span class=\"line\"></span><br><span class=\"line\">00BEF846 - 8B 10                 - mov edx,[eax]</span><br><span class=\"line\">00BEF848 - FF 52 68              - call dword ptr [edx+68]</span><br><span class=\"line\">00BEF84B - B0 01                 - mov al,01 &#123; 1 &#125;</span><br><span class=\"line\">ecx = 514FA270</span><br><span class=\"line\"></span><br><span class=\"line\">00BEF844 - 8B C8                 - mov ecx,eax</span><br><span class=\"line\">eax = 514FA270</span><br><span class=\"line\">当前血量 = [EAX + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BED9C0 - 8B 41 08              - mov eax,[ecx+08]</span><br><span class=\"line\">eax = 265489C0 ecx = 063A9708</span><br><span class=\"line\">00BED9C3 - 8B 40 30              - mov eax,[eax+30]</span><br><span class=\"line\">00BED9C6 - C3                    - ret </span><br><span class=\"line\">eax = 514FA270</span><br><span class=\"line\">当前血量 = [[[ecx+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BEFDBB  | E8 00DCFFFF          | call elementclient.BED9C0                 |</span><br><span class=\"line\"></span><br><span class=\"line\">00BEFDB9  | 8BCB                 | mov ecx,ebx                               |</span><br><span class=\"line\">当前血量 = [[[ebx+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BEFBCB  | 8BD9                 | mov ebx,ecx                               |</span><br><span class=\"line\">当前血量 = [[[ecx+08]+30] + 78C]</span><br><span class=\"line\">BCB F51</span><br><span class=\"line\"></span><br><span class=\"line\">009BBED5  | FFD0                 | call eax                                  |</span><br><span class=\"line\"></span><br><span class=\"line\">009BBECB  | 8B0F                 | mov ecx,dword ptr ds:[edi]                |</span><br><span class=\"line\">当前血量 = [[[[edi]+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">009BBEC1  | 83C7 1C              | add edi,1C                                |</span><br><span class=\"line\">当前血量 = [[[[edi+1c]+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">009BBEB9  | 8B78 1C              | mov edi,dword ptr ds:[eax+1C]             |</span><br><span class=\"line\">当前血量 = [[[[[eax+1C]+1c]+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">009BBEAE  | 8B40 1C              | mov eax,dword ptr ds:[eax+1C]             | eax:&quot;ff&amp;?&quot;</span><br><span class=\"line\">当前血量 = [[[[[[eax+1C]+1C]+1c]+08]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">009BBEA4  | A1 A8DD4F01          | mov eax,dword ptr ds:[14FDDA8]            |</span><br><span class=\"line\">当前血量 = [[[[[[[14FDDA8]+1C]+1C]+1C]+08]+30] + 78C]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00B2E1C5 - 89 86 8C070000        - mov [esi+0000078C],eax</span><br><span class=\"line\">esi = 4098A518</span><br><span class=\"line\">当前血量 = [esi + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B2E0A7  | 8BF1                    | mov esi,ecx                          |</span><br><span class=\"line\">当前血量 = [ecx + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B38612  | E8 895AFFFF             | call elementclient.B2E0A0            |</span><br><span class=\"line\">ecx = 4098A518</span><br><span class=\"line\"></span><br><span class=\"line\">00BF0808  | FF52 68                 | call dword ptr ds:[edx+68]           | </span><br><span class=\"line\"></span><br><span class=\"line\">00BF0804  | 8BC8                    | mov ecx,eax                          |</span><br><span class=\"line\">eax = 4098A518</span><br><span class=\"line\">当前血量 = [eax + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BEE980  | 8B41 08                 | mov eax,dword ptr ds:[ecx+8]         |</span><br><span class=\"line\">00BEE983  | 8B40 30                 | mov eax,dword ptr ds:[eax+30]        |</span><br><span class=\"line\">00BEE986  | C3                      | ret                                  |</span><br><span class=\"line\">当前血量 = [[[ecx+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BE3ED9  | FF50 34                 | call dword ptr ds:[eax+34]           |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE3ECB  | 8B4C88 1C               | mov ecx,dword ptr ds:[eax+ecx*4+1C]  |</span><br><span class=\"line\">当前血量 = [[[[eax+ecx*4+1C]+8]+30] + 78C]</span><br><span class=\"line\">eax = 08D8EF00</span><br><span class=\"line\">ecx = 00000001</span><br><span class=\"line\"></span><br><span class=\"line\">00BE3EC1  | 8B46 04                 | mov eax,dword ptr ds:[esi+4]         |</span><br><span class=\"line\">00BE3EC4  | 8B40 1C                 | mov eax,dword ptr ds:[eax+1C]        |</span><br><span class=\"line\">当前血量 = [[[[[[esi+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00BE3E98  | 8BF1                    | mov esi,ecx                          |</span><br><span class=\"line\">当前血量 = [[[[[[ecx+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A4A55E  | E8 0D991900             | call elementclient.BE3E70            |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4A553  | 8B8F 98000000           | mov ecx,dword ptr ds:[edi+98]        |</span><br><span class=\"line\">当前血量 = [[[[[[[edi+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A4A4E4  | 8BF9                    | mov edi,ecx                          |</span><br><span class=\"line\">当前血量 = [[[[[[[ecx+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A4A1BF  | E8 1C030000             | call elementclient.A4A4E0            |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00A4A1B9  | 8BCE                    | mov ecx,esi                          |</span><br><span class=\"line\">当前血量 = [[[[[[[esi+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A4A0B8  | 8BF1                    | mov esi,ecx                          |</span><br><span class=\"line\">当前血量 = [[[[[[[ecx+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A3F231  | E8 7AAE0000             | call elementclient.A4A0B0            |</span><br><span class=\"line\"></span><br><span class=\"line\">00A3F22E  | 8B4F 1C                 | mov ecx,dword ptr ds:[edi+1C]        |</span><br><span class=\"line\">当前血量 = [[[[[[[[edi+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A3EF57  | 8BF9                    | mov edi,ecx                          | </span><br><span class=\"line\">当前血量 = [[[[[[[[ecx+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A3F840  | E8 0BF7FFFF             | call elementclient.A3EF50            |</span><br><span class=\"line\"></span><br><span class=\"line\">00A3F83E  | 8BCF                    | mov ecx,edi                          |</span><br><span class=\"line\">当前血量 = [[[[[[[[edi+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00A3F7A5  | 8BF9                    | mov edi,ecx                          |</span><br><span class=\"line\">当前血量 = [[[[[[[[ecx+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">00D35072  | E8 29A7D0FF             | call elementclient.A3F7A0            |</span><br><span class=\"line\"></span><br><span class=\"line\">00D3506D  | B9 F8845001             | mov ecx,elementclient.15084F8        |</span><br><span class=\"line\">当前血量 = [[[[[[[[0x15084F8+1C]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"> [[[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ + 78C 为血量</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 7E4 为血量上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 790 为真气</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 7E8 为真气上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 784 为等级</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 794 为经验</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 798 为元神</span><br><span class=\"line\"></span><br><span class=\"line\">??? $ + 79C 为元气上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + B00 / $ + B04 为角色姓名</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 930 为银币</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"../../../AppData/Roaming/Typora/typora-user-images/image-20221222191354658.png\" alt=\"image-20221222191354658\"></p>\n<p>如图可知，this 指针的基地址为 5F7FB0D8</p>\n<p>$ + 78C 为血量</p>\n<p>$ + 7E4 为血量上限</p>\n<p>$ + 790 为真气</p>\n<p>$ + 7E8 为真气上限</p>\n<p>$ + 784 为等级</p>\n<p>$ + 794 为经验</p>\n<p>$ + 798 为元神</p>\n<p>$ + 79C 为元气上限</p>\n<p>34416B58</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">773       77+400=477   +3C  x</span><br><span class=\"line\">177       17           +40  z</span><br><span class=\"line\">-349      -34+550=516  +44  y</span><br></pre></td></tr></table></figure>\n<p>搜索角色名称</p>\n<p>方法 1</p>\n<p>1.ce 搜索角色名称，注意，宽字节和窄字节都要考虑</p>\n<p>2. 使用定位基地址的方式，一个一个关键点网上找</p>\n<p>方法 2（在已知任务角色信息基地址的前提下）</p>\n<p>在 ce 里面搜索</p>\n<p>逐个分析这些地址，找出与任务角色基地址信息相近的地址，然后计算偏移</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221227170809963.png\" alt=\"image-20221227170809963\"></p>\n<p>34417B58-34416B58=B00</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221227170851601.png\" alt=\"image-20221227170851601\"></p>\n<p>释放技能 call 查找</p>\n<p>思路一：技能应该有技能 ID，索引，技能文字信息和描述</p>\n<p>可以从技能文字信息为入口，用 CE 搜索字符信息，可以根据内存读写断点。定位技能的关键 call</p>\n<p>思路二：分析游戏按键和鼠标点击处理机制，找到技能 call</p>\n<p>思路三：针对网游，一般网络游戏会将攻击和伤害的计算放在服务器端处理</p>\n<p>失望技能需要与服务端进行网络通信，通过游戏数据网络数据收发机制，跟踪 send，recv 函数，用条件过滤，保证 send 的是释放技能的数据，看函数堆栈反推上层函数，找到技能 call</p>\n<p>bp send, 对网络发送数据的函数下断点</p>\n<p>排除其他数据包发送的干扰，定位到使用技能时触发的数据包的发送</p>\n<p>ctrl + F9 定位到游戏程序模块 (OD 上 module 为游戏进程名) 然后逐层分析函数，看谁更适合作为技能 call</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">UserSkill ()</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\txxx()</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tsend() </span><br><span class=\"line\">\t\t//send处下断点，根据堆栈回溯可以定位技能call</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CC3F37  | 57                      | push edi                              |</span><br><span class=\"line\">00CC3F38  | 56                      | push esi                              | esi:L&quot;)q&quot;</span><br><span class=\"line\">00CC3F39  | 8B49 20                 | mov ecx,dword ptr ds:[ecx+20]         |</span><br><span class=\"line\">00CC3F3C  | E8 0F780B00             | call elementclient.D7B750             |</span><br></pre></td></tr></table></figure>\n<p>发送消息或者触发事件 SendNotyxxx</p>\n<p>消息事件处理线程</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">while(1)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tswitch</span><br><span class=\"line\">\t\tcase xxx;</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\t\tcase yyy;</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">764B58A0  | 8BFF                   | mov edi,edi                           |</span><br><span class=\"line\"></span><br><span class=\"line\">00D7AD35  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00D7AD37  | 6A 01                  | push 1                                |</span><br><span class=\"line\">00D7AD39  | 68 31AC2F01            | push elementclient.12FAC31            |</span><br><span class=\"line\">00D7AD3E  | FF35 7CAD5001          | push dword ptr ds:[150AD7C]           |</span><br><span class=\"line\">00D7AD44  | FF15 486A1E01          | call dword ptr ds:[&lt;&amp;send&gt;]           |</span><br><span class=\"line\"></span><br><span class=\"line\">00D7AC71  |.  FF75 10       push [arg.3]</span><br><span class=\"line\">00D7AC74  |.  FF75 0C       push [arg.2]</span><br><span class=\"line\">00D7AC77  |.  E8 24000000   call ElementC.00D7ACA0</span><br><span class=\"line\"></span><br><span class=\"line\">00D7B9CC  |&gt; \\FF75 0C       push [arg.2]</span><br><span class=\"line\">00D7B9CF  |.  8B8E AC000000 mov ecx,dword ptr ds:[esi+0xAC]</span><br><span class=\"line\">00D7B9D5  |.  57            push edi</span><br><span class=\"line\">00D7B9D6  |.  FFB6 B0000000 push dword ptr ds:[esi+0xB0]</span><br><span class=\"line\">00D7B9DC  |.  E8 0FF2FFFF   call ElementC.00D7ABF0</span><br><span class=\"line\"></span><br><span class=\"line\">00D7B7D1  |.  66:8906       mov word ptr ds:[esi],ax</span><br><span class=\"line\">00D7B7D4  |&gt;  6A 00         push 0x0</span><br><span class=\"line\">00D7B7D6  |.  8D45 DC       lea eax,[local.9]</span><br><span class=\"line\">00D7B7D9  |.  8BCF          mov ecx,edi</span><br><span class=\"line\">00D7B7DB  |.  50            push eax</span><br><span class=\"line\">00D7B7DC  |.  E8 9F000000   call ElementC.00D7B880</span><br><span class=\"line\">//以上三个除了技能也能中断</span><br><span class=\"line\"></span><br><span class=\"line\">00CC3F31  |&gt; \\8B0D 38EE4F01 mov ecx,dword ptr ds:[0x14FEE38]         ;  ElementC.015084F8     </span><br><span class=\"line\">00CC3F37  |.  57            push edi                                    0C</span><br><span class=\"line\">00CC3F38  |.  56            push esi                                    04229034  </span><br><span class=\"line\">00CC3F39  |.  8B49 20       mov ecx,dword ptr ds:[ecx+0x20]  \t\t\t24BC4028</span><br><span class=\"line\">00CC3F3C  |.  E8 0F780B00   call ElementC.00D7B750</span><br><span class=\"line\">//没有技能ID</span><br><span class=\"line\"></span><br><span class=\"line\">009AC4F5  |.  FF75 14       push [arg.4]\t\t\t\t\t\t\t\t0019EE7C</span><br><span class=\"line\">009AC4F8  |.  C701 00000000 mov dword ptr ds:[ecx],0x0\t\t\t\t\t[24A1B180]</span><br><span class=\"line\">009AC4FE  |.  FF75 10       push [arg.3]\t\t\t\t\t\t\t\t01</span><br><span class=\"line\">009AC501  |.  FF75 0C       push [arg.2]\t\t\t\t\t\t\t\t215AAB00</span><br><span class=\"line\">009AC504  |.  FF75 08       push [arg.1]\t\t\t\t\t\t\t\t7D</span><br><span class=\"line\">009AC507  |.  E8 D4793100   call ElementC.00CC3EE0</span><br><span class=\"line\">//技能不可用</span><br><span class=\"line\"></span><br><span class=\"line\">00B42E62   .  50            push eax\t\t\t0019EE7C</span><br><span class=\"line\">00B42E63   .  8B87 00280000 mov eax,dword ptr ds:[edi+0x2800]    4E492C40</span><br><span class=\"line\">00B42E69   .  6A 01         push 0x1</span><br><span class=\"line\">00B42E6B   .  FF75 C8       push dword ptr ss:[ebp-0x38]      215AAB00</span><br><span class=\"line\">00B42E6E   .  FF70 08       push dword ptr ds:[eax+0x8]     7D        44EE61B8 + 08</span><br><span class=\"line\">00B42E71   .  A1 38EE4F01   mov eax,dword ptr ds:[0x14FEE38]   015084F8</span><br><span class=\"line\">00B42E76   .  8B48 20       mov ecx,dword ptr ds:[eax+0x20]   24B53028</span><br><span class=\"line\">00B42E79   .  81C1 EC000000 add ecx,0xEC</span><br><span class=\"line\">00B42E7F   .  E8 3C96E6FF   call ElementC.009AC4C0</span><br><span class=\"line\">//技能不可用</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00B69E06  |.  6A 00         push 0x0\t\t\t0</span><br><span class=\"line\">00B69E08  |.  50            push eax          0</span><br><span class=\"line\">00B69E09  |.  FF76 08       push dword ptr ds:[esi+0x8]    80001A0B  80001C4D</span><br><span class=\"line\">00B69E0C  |.  E8 5F87FDFF   call ElementC.00B42570</span><br><span class=\"line\">//无技能ID</span><br><span class=\"line\">//以下执行频率很高，消息或者类似事件派发的一个地方</span><br><span class=\"line\"></span><br><span class=\"line\">00B697CF  |&gt; \\8B40 0C       mov eax,dword ptr ds:[eax+0xC]</span><br><span class=\"line\">00B697D2  |.  FFD0          call eax</span><br><span class=\"line\"></span><br><span class=\"line\">00B6A4CF   .  8BCE          mov ecx,esi</span><br><span class=\"line\">00B6A4D1   .  E8 9AF2FFFF   call ElementC.00B69770</span><br><span class=\"line\"></span><br><span class=\"line\">00B5F6E4  |.  8B03          |mov eax,dword ptr ds:[ebx]</span><br><span class=\"line\">00B5F6E6  |.  8BCB          |mov ecx,ebx</span><br><span class=\"line\">00B5F6E8  |.  FF75 08       |push [arg.1]</span><br><span class=\"line\">00B5F6EB  |.  FF50 04       |call dword ptr ds:[eax+0x4]</span><br><span class=\"line\"></span><br><span class=\"line\">00B55D68  |.  53            push ebx</span><br><span class=\"line\">00B55D69  |.  E8 12990000   call ElementC.00B5F680</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CE9231 - FF 71 08  - push [ecx+08]</span><br><span class=\"line\">00CE92C7 - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00CE92DE - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00B3E488 - FF 73 08  - push [ebx+08]</span><br><span class=\"line\">00B3E62E - FF 73 08  - push [ebx+08]</span><br><span class=\"line\">00B41F83 - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00B425F8 - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00B42E6E - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00B356C7 - FF 70 08  - push [eax+08]</span><br><span class=\"line\">00B356DB - 8B 78 08  - mov edi,[eax+08]</span><br><span class=\"line\">00B5E550 - FF 70 08  - push [eax+08]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CE922A  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]        | 015084F8</span><br><span class=\"line\">00CE922F  | 56                     | push esi                              | 06CBDD48</span><br><span class=\"line\">00CE9230  | 57                     | push edi                              | 52B640C8</span><br><span class=\"line\">00CE9231  | FF71 08                | push dword ptr ds:[ecx+8]             | 0000007D</span><br><span class=\"line\">00CE9234  | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]         | 1D27F9C0</span><br><span class=\"line\">00CE9237  | 8B70 30                | mov esi,dword ptr ds:[eax+30]         | 36FAC5B8</span><br><span class=\"line\">00CE923A  | FF15 E8601E01          | call dword ptr ds:[&lt;&amp;?IsGoblinSkill@E | 034CFD30</span><br><span class=\"line\">00CE9240  | 83C4 04                | add esp,4                             |</span><br><span class=\"line\">//游戏崩溃</span><br><span class=\"line\"></span><br><span class=\"line\">00CE92C1  | 6A FF                  | push FFFFFFFF                         | FFFFFFFF</span><br><span class=\"line\">00CE92C3  | 6A 00                  | push 0                                | 0</span><br><span class=\"line\">00CE92C5  | 6A 00                  | push 0                                | 0</span><br><span class=\"line\">00CE92C7  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class=\"line\">00CE92CA  | 8B42 0C                | mov eax,dword ptr ds:[edx+C]          | 00969460</span><br><span class=\"line\">00CE92CD  | FFD0                   | call eax                              | </span><br><span class=\"line\">//游戏崩溃</span><br><span class=\"line\"></span><br><span class=\"line\">00CE92D3  | 8B43 08                | mov eax,dword ptr ds:[ebx+8]          | 4DB4BCF0</span><br><span class=\"line\">00CE92D6  | 8BCE                   | mov ecx,esi                           | 7082C9E8</span><br><span class=\"line\">00CE92D8  | 6A FF                  | push FFFFFFFF                         |</span><br><span class=\"line\">00CE92DA  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00CE92DC  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00CE92DE  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class=\"line\">00CE92E1  | E8 4A4BE5FF            | call elementclient.B3DE30             |</span><br><span class=\"line\">//技能call</span><br><span class=\"line\"></span><br><span class=\"line\">00B3E487  | 57                     | push edi                              | 687763E8</span><br><span class=\"line\">00B3E488  | FF73 08                | push dword ptr ds:[ebx+8]             | 7D</span><br><span class=\"line\">00B3E48B  | E8 A0A9E7FF            | call elementclient.9B8E30             |</span><br><span class=\"line\">//游戏崩溃</span><br><span class=\"line\"></span><br><span class=\"line\">00B3E62D  | 50                     | push eax                              | 0</span><br><span class=\"line\">00B3E62E  | FF73 08                | push dword ptr ds:[ebx+8]             | 7D</span><br><span class=\"line\">00B3E631  | FF75 10                | push dword ptr ss:[ebp+10]            | 80001A0B</span><br><span class=\"line\">00B3E634  | 68 886D2701            | push elementclient.1276D88            | 1276D88</span><br><span class=\"line\">00B3E639  | 6A 01                  | push 1                                |</span><br><span class=\"line\">00B3E63B  | E8 C0F83100            | call elementclient.E5DF00             |</span><br><span class=\"line\">00B3E640  | 8B8F F4270000          | mov ecx,dword ptr ds:[edi+27F4]       | 6F3CAE58  edi= 5F4F6320 + 0x27F4</span><br><span class=\"line\">00B3E646  | 83C4 14                | add esp,14                            |</span><br><span class=\"line\">//无反应</span><br><span class=\"line\"></span><br><span class=\"line\">00B41F83  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class=\"line\">00B41F86  | E8 75750000            | call elementclient.B49500             |</span><br><span class=\"line\">//无反应</span><br><span class=\"line\"></span><br><span class=\"line\">00B425F8  | FF70 08                | push dword ptr ds:[eax+8]             | 7D </span><br><span class=\"line\">00B425FB  | E8 5034E5FF            | call elementclient.995A50             </span><br><span class=\"line\">//游戏崩溃</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00B42E62  | 50                     | push eax                              | 0019EE7C</span><br><span class=\"line\">00B42E63  | 8B87 00280000          | mov eax,dword ptr ds:[edi+2800]       | 5395BDF0</span><br><span class=\"line\">00B42E69  | 6A 01                  | push 1                                | 1</span><br><span class=\"line\">00B42E6B  | FF75 C8                | push dword ptr ss:[ebp-38]            | 241D4300</span><br><span class=\"line\">00B42E6E  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class=\"line\">00B42E71  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]        | 015084F8</span><br><span class=\"line\">00B42E76  | 8B48 20                | mov ecx,dword ptr ds:[eax+20]         | 29EBB028</span><br><span class=\"line\">00B42E79  | 81C1 EC000000          | add ecx,EC                            |</span><br><span class=\"line\">00B42E7F  | E8 3C96E6FF            | call elementclient.9AC4C0             |</span><br><span class=\"line\">//技能不可用</span><br><span class=\"line\"></span><br><span class=\"line\">00B356C5  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00B356C7  | FF70 08                | push dword ptr ds:[eax+8]             | 7D</span><br><span class=\"line\">00B356CA  | E8 F14C1100            | call elementclient.C4A3C0             |</span><br><span class=\"line\">//无反应</span><br><span class=\"line\"></span><br><span class=\"line\">00B5E54D  | FF71 04                | push dword ptr ds:[ecx+4]                      |</span><br><span class=\"line\">00B5E550  | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class=\"line\">00B5E553  | E8 D8A8E5FF            | call elementclient.9B8E30                      |</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CE922A  | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 | 015084F8</span><br><span class=\"line\">00CE922F  | 56                     | push esi                                       | 06D077F8</span><br><span class=\"line\">00CE9230  | 57                     | push edi                                       | 658C4488</span><br><span class=\"line\">00CE9231  | FF71 08                | push dword ptr ds:[ecx+8]                      | 0000007D</span><br><span class=\"line\">00CE9234  | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]                  | 1D2429C0</span><br><span class=\"line\">00CE9237  | 8B70 30                | mov esi,dword ptr ds:[eax+30]                  | 7082C9E8</span><br><span class=\"line\"></span><br><span class=\"line\">...</span><br><span class=\"line\"></span><br><span class=\"line\">00CE92D3  | 8B43 08                | mov eax,dword ptr ds:[ebx+8]          | 4DB4BCF0</span><br><span class=\"line\">00CE92D6  | 8BCE                   | mov ecx,esi                           | 7082C9E8，ecx的值，人物信息基地址  5F4F6320</span><br><span class=\"line\">00CE92D8  | 6A FF                  | push FFFFFFFF                         |</span><br><span class=\"line\">00CE92DA  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00CE92DC  | 6A 00                  | push 0                                |</span><br><span class=\"line\">00CE92DE  | FF70 08                | push dword ptr ds:[eax+8]             | 7D，技能ID</span><br><span class=\"line\">00CE92E1  | E8 4A4BE5FF            | call elementclient.B3DE30             |</span><br><span class=\"line\"></span><br><span class=\"line\">[[[14FEE38]+1C]+30] = 7082C9E8   即为this指针</span><br><span class=\"line\">[[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30] = 7082C9E8</span><br><span class=\"line\">[[[[[[[[0x15084F8+1C]+98]+4]+1C]+1*4+1C]+8]+30] = 7082C9E8</span><br></pre></td></tr></table></figure>\n<p>人物选择目标（玩家，怪物，npc 分析）</p>\n<p>选中</p>\n<p>当前 this 指针 [[[14FEE38]+1C]+30] = 5F4F6320</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115006092.png\" alt=\"image-20230101115006092\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115309026.png\" alt=\"image-20230101115309026\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115332221.png\" alt=\"image-20230101115332221\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">80001A0B 是戒灵的ID</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230101115607140.png\" alt=\"image-20230101115607140\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">对于不同的囚徒怨魂有不同的ID</span><br><span class=\"line\">80001C4A - 80001C4F</span><br><span class=\"line\">推测某个地域上囚徒怨魂有ID范围，每个ID唯一</span><br><span class=\"line\">戒灵唯一，因此ID也只有一个</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">009AC900 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class=\"line\">00B31E36 - 89 86 04090000  - mov [esi+00000904],eax</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>思路：</p>\n<p>1. 在人物对象偏移地址中找找看是否有与选中的目标相关的信息 (譬如：ID 或者目标对象的地址)，然后通过内存断点分析访问这些信息的代码，来确定选中目标的 call</p>\n<p>2. 网游可以通过 send 函数断点来分析选中目标的操作 (和释放技能 call 分析类似)</p>\n<p>思路一：</p>\n<p>1. 上面已经找到一个与任务选中目标的相关信息 (人物选择中的目标 ID)</p>\n<p>2. 对这个内存下写入访问 / 写入的断点</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">009AC900  |.  89B0 04090000 mov dword ptr ds:[eax+0x904],esi</span><br><span class=\"line\"></span><br><span class=\"line\">00B54582  |&gt; \\A1 38EE4F01   mov eax,dword ptr ds:[0x14FEE38]      015084F8</span><br><span class=\"line\">00B54587  |.  56            push esi                              80001C56</span><br><span class=\"line\">00B54588  |.  8B48 20       mov ecx,dword ptr ds:[eax+0x20]       11B3C028</span><br><span class=\"line\">00B5458B  |.  81C1 EC000000 add ecx,0xEC</span><br><span class=\"line\">00B54591  |.  E8 3A83E5FF   call ElementC.009AC8D0</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax,dword ptr ds:[0x14FEE38]</span><br><span class=\"line\">push 80001A0B</span><br><span class=\"line\">mov ecx,dword ptr ds:[eax+0x20]</span><br><span class=\"line\">add ecx,0x0EC</span><br><span class=\"line\">call 009AC8D0</span><br></pre></td></tr></table></figure>\n<h4 id=\"更新-202315\"><a class=\"markdownIt-Anchor\" href=\"#更新-202315\">#</a> 更新 2023.1.5</h4>\n<p>释放技能 call</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CE9EE3              | 8B43 08                | mov eax,dword ptr ds:[ebx+8]                   |</span><br><span class=\"line\">00CE9EE6              | 8BCE                   | mov ecx,esi                                    |</span><br><span class=\"line\">00CE9EE8              | 6A FF                  | push FFFFFFFF                                  |</span><br><span class=\"line\">00CE9EEA              | 6A 00                  | push 0                                         |</span><br><span class=\"line\">00CE9EEC              | 6A 00                  | push 0                                         |</span><br><span class=\"line\">00CE9EEE              | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class=\"line\">00CE9EF1              | E8 7A4BE5FF            | call elementclient.B3EA70                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00CE9E3A              | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 |</span><br><span class=\"line\">00CE9E3F              | 56                     | push esi                                       |</span><br><span class=\"line\">00CE9E40              | 57                     | push edi                                       |</span><br><span class=\"line\">00CE9E41              | FF71 08                | push dword ptr ds:[ecx+8]                      |</span><br><span class=\"line\">00CE9E44              | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]                  |</span><br><span class=\"line\">00CE9E47              | 8B70 30                | mov esi,dword ptr ds:[eax+30]                  |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ecx = esi = [eax+30] = [[[14FEE38]+1C]+30]</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx,14FEE38</span><br><span class=\"line\">mov ecx,[ecx]</span><br><span class=\"line\">mov ecx,[ecx+1C]</span><br><span class=\"line\">mov ecx,[ecx+30]</span><br><span class=\"line\">push -1</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 7D</span><br><span class=\"line\">call 0x0B3EA70</span><br><span class=\"line\"></span><br><span class=\"line\">ecx 就是this指针 [[[14FEE38]+1C]+30] = 65573810 = [[[[[[[0x1508514]+98]+4]+1C]+1*4+1C]+8]+30]</span><br></pre></td></tr></table></figure>\n<p>定位怪物 ID</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00B6AC16  |.  6A 00         push 0x0</span><br><span class=\"line\">00B6AC18  |.  50            push eax</span><br><span class=\"line\">00B6AC19  |.  FF76 08       push dword ptr ds:[esi+0x8]  80001A0B</span><br><span class=\"line\">00B6AC1C  |.  E8 8F85FDFF   call ElementC.00B431B0</span><br><span class=\"line\"></span><br><span class=\"line\">在CE中通过选中怪物切换得到30E32FC4,并且和this指针相邻</span><br><span class=\"line\">65574114 - 65573810 = 904</span><br><span class=\"line\">即人物this指针的+904的位置是所选定怪物</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105200144107.png\" alt=\"image-20230105200144107\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">009AD0A0 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class=\"line\">00B32816 - 89 86 04090000  - mov [esi+00000904],eax</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">009AD0A0              | 89B0 04090000          | mov dword ptr ds:[eax+904],esi                 |</span><br><span class=\"line\">009AD0A6              | 8D45 F8                | lea eax,dword ptr ss:[ebp-8]                   |</span><br><span class=\"line\">009AD0A9              | 50                     | push eax                                       |</span><br><span class=\"line\">009AD0AA              | 8D45 08                | lea eax,dword ptr ss:[ebp+8]                   |</span><br><span class=\"line\">009AD0AD              | 50                     | push eax                                       |</span><br><span class=\"line\">009AD0AE              | E8 0D070000            | call elementclient.9AD7C0                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00B551C2              | A1 38EE4F01            | mov eax,dword ptr ds:[14FEE38]                 | 015084F8</span><br><span class=\"line\">00B551C7              | 56                     | push esi                                       | 80001A0B</span><br><span class=\"line\">00B551C8              | 8B48 20                | mov ecx,dword ptr ds:[eax+20]                  | 1D01F028</span><br><span class=\"line\">00B551CB              | 81C1 EC000000          | add ecx,EC                                     |</span><br><span class=\"line\">00B551D1              | E8 9A7EE5FF            | call elementclient.9AD070                      |</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax,dword ptr ds:[14FEE38]      </span><br><span class=\"line\">push 80001A0B</span><br><span class=\"line\">mov ecx,dword ptr ds:[eax+20]</span><br><span class=\"line\">add ecx,0x0EC           </span><br><span class=\"line\">call 9AD070</span><br></pre></td></tr></table></figure>\n<p>人物技能分析</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00CE9EEE              | FF70 08                | push dword ptr ds:[eax+8]                      |</span><br><span class=\"line\"></span><br><span class=\"line\">回城术 A7</span><br><span class=\"line\">458AB5E0</span><br><span class=\"line\"></span><br><span class=\"line\">清心咒 71</span><br><span class=\"line\">493BCA60</span><br><span class=\"line\"></span><br><span class=\"line\">羽剑 7D</span><br><span class=\"line\">458AB880</span><br><span class=\"line\"></span><br><span class=\"line\">龙卷风 7F</span><br><span class=\"line\">4589E0D0</span><br><span class=\"line\"></span><br><span class=\"line\">静心咒 72</span><br><span class=\"line\">458AB6F8</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">3D82F288 493BCA60 `Ê;I   </span><br><span class=\"line\">3D82F28C 458AB6F8 ø¶.E   </span><br><span class=\"line\">3D82F290 458AB880 .¸.E   </span><br><span class=\"line\">3D82F294 4589E0D0 Ðà.E   </span><br><span class=\"line\">3D82F298 458AB5E0 àµ.E   </span><br><span class=\"line\"></span><br><span class=\"line\">493BCA60 01297268 hr). </span><br><span class=\"line\">493BCA64 2E164EA8 ¨N.. </span><br><span class=\"line\">493BCA68 00000071 q... </span><br><span class=\"line\">493BCA6C 00000005 .... </span><br><span class=\"line\"></span><br><span class=\"line\">2E164EA8 1046C5DC ÜÅF. </span><br><span class=\"line\">2E164EAC 10830198 .... </span><br><span class=\"line\">2E164EB0 00000000 .... </span><br><span class=\"line\">2E164EB4 00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\">10830198 10542A90 .*T. elementskill.&amp;?GetRequiredGenius@ElementSkill@GNET@@UAEPAHH@Z</span><br><span class=\"line\">1083019C 00000071 q... </span><br><span class=\"line\">108301A0 00000007 .... </span><br><span class=\"line\">108301A4 10542AE8 è*T. L&quot;清心咒&quot;</span><br><span class=\"line\">108301A8 10542AF0 ð*T. &quot;清心咒&quot;</span><br><span class=\"line\">108301AC 10542AF8 ø*T. &quot;清心咒.dds&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">10542AE8 5FC36E05 .nÃ_ </span><br><span class=\"line\">10542AEC 00005492 .T.. </span><br><span class=\"line\">10542AF0 C4D0E5C7 ÇåÐÄ </span><br><span class=\"line\">10542AF4 0000E4D6 Öä.. </span><br><span class=\"line\">10542AF8 C4D0E5C7 ÇåÐÄ </span><br><span class=\"line\"></span><br><span class=\"line\">[[[[3D82F288]+4]+4]+0x0C]</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105204555127.png\" alt=\"image-20230105204555127\"></p>\n<p>5E5D69F8 - 5E5D41D8 = 2820</p>\n<p>人物 this 指针 + 2820 就是技能数组的首地址，通过技能数组的首地址可以找到技能的全部信息</p>\n<h4 id=\"更新结束\"><a class=\"markdownIt-Anchor\" href=\"#更新结束\">#</a> 更新结束</h4>\n<h4 id=\"更新2023111\"><a class=\"markdownIt-Anchor\" href=\"#更新2023111\">#</a> 更新 2023.1.11</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.人物this指针</span><br><span class=\"line\">00B2ECD5 - 89 86 8C070000  - mov [esi+0000078C],eax</span><br><span class=\"line\">当前血量 = [esi + 78C]    esi = 5EB45680</span><br><span class=\"line\"></span><br><span class=\"line\">00B2EBB7             | 8BF1                  | mov esi,ecx                           |</span><br><span class=\"line\">当前血量 = [ecx + 78C]    ecx = 5EB45680</span><br><span class=\"line\"></span><br><span class=\"line\">00B391E2             | E8 C959FFFF           | call elementclient.B2EBB0             |</span><br><span class=\"line\"></span><br><span class=\"line\">00BF23C8             | FF52 68               | call dword ptr ds:[edx+68]            |</span><br><span class=\"line\"></span><br><span class=\"line\">00BF23C4             | 8BC8                  | mov ecx,eax                           |</span><br><span class=\"line\">当前血量 = [eax + 78C]    eax = 5EB45680</span><br><span class=\"line\"></span><br><span class=\"line\">00BF0540             | 8B41 08               | mov eax,dword ptr ds:[ecx+8]          |</span><br><span class=\"line\">00BF0543             | 8B40 30               | mov eax,dword ptr ds:[eax+30]         |</span><br><span class=\"line\">当前血量 = [[[ecx+8]+30] + 78C]     ecx = 0648E5A0</span><br><span class=\"line\"></span><br><span class=\"line\">00BE5869             | FF50 34               | call dword ptr ds:[eax+34]            |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4B8AE             | E8 4D9F1900           | call elementclient.BE5800             |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4B89A             | 8B4F 30               | mov ecx,dword ptr ds:[edi+30]         |</span><br><span class=\"line\">当前血量 = [[[0150B6FC]+30] + 78C]</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 78C 为血量</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 7E4 为血量上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 790 为真气</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 7E8 为真气上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 784 为等级</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 794 为经验</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 798 为元神</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 79C 为元气上限</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 7A0 为真元</span><br><span class=\"line\"></span><br><span class=\"line\">$ + B00 / $ + B04 为角色姓名</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 864 为最大真元</span><br><span class=\"line\"></span><br><span class=\"line\">$ + 930 为银币</span><br><span class=\"line\"></span><br><span class=\"line\">$ +7A0/864+8FC  为  99/100</span><br><span class=\"line\"> </span><br><span class=\"line\"></span><br><span class=\"line\">2.人物技能call</span><br><span class=\"line\">009ADDF5             | FF75 14               | push dword ptr ss:[ebp+14]            | 0019EE7C</span><br><span class=\"line\">009ADDF8             | C701 00000000         | mov dword ptr ds:[ecx],0              | [1DC7CDB8]</span><br><span class=\"line\">009ADDFE             | FF75 10               | push dword ptr ss:[ebp+10]            | 1 </span><br><span class=\"line\">009ADE01             | FF75 0C               | push dword ptr ss:[ebp+C]             | 01518200</span><br><span class=\"line\">009ADE04             | FF75 08               | push dword ptr ss:[ebp+8]             | 0000007D</span><br><span class=\"line\">009ADE07             | E8 84803100           | call elementclient.CC5E90             |</span><br><span class=\"line\"></span><br><span class=\"line\">00B43CB2             | 50                    | push eax                              | 0019EE7C</span><br><span class=\"line\">00B43CB3             | 8B87 00280000         | mov eax,dword ptr ds:[edi+2800]       | 43336E60</span><br><span class=\"line\">00B43CB9             | 6A 01                 | push 1                                | 1</span><br><span class=\"line\">00B43CBB             | FF75 C8               | push dword ptr ss:[ebp-38]            | 181E4F00</span><br><span class=\"line\">00B43CBE             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class=\"line\">00B43CC1             | A1 20205001           | mov eax,dword ptr ds:[1502020]        | 0150B6E0</span><br><span class=\"line\">00B43CC6             | 8B48 20               | mov ecx,dword ptr ds:[eax+20]         | 1DEB6028</span><br><span class=\"line\">00B43CC9             | 81C1 EC000000         | add ecx,EC                            | </span><br><span class=\"line\">00B43CCF             | E8 ECA0E6FF           | call elementclient.9ADDC0             |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00CEB35C - 8B 43 08  - mov eax,[ebx+08]</span><br><span class=\"line\">00CEB35C             | 8B43 08               | mov eax,dword ptr ds:[ebx+8]          | 43336E60</span><br><span class=\"line\">00CEB35F             | 8B11                  | mov edx,dword ptr ds:[ecx]            | 012787BC</span><br><span class=\"line\">00CEB361             | 6A FF                 | push FFFFFFFF                         |</span><br><span class=\"line\">00CEB363             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00CEB365             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00CEB367             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class=\"line\">00CEB36A             | 8B42 0C               | mov eax,dword ptr ds:[edx+C]          | 0096B5A0</span><br><span class=\"line\">00CEB36D             | FFD0                  | call eax                              |</span><br><span class=\"line\"></span><br><span class=\"line\">00CEB373 - 8B 43 08  - mov eax,[ebx+08]</span><br><span class=\"line\">00CEB373             | 8B43 08               | mov eax,dword ptr ds:[ebx+8]          | 43336E60</span><br><span class=\"line\">00CEB376             | 8BCE                  | mov ecx,esi                           | 5EB45680</span><br><span class=\"line\">00CEB378             | 6A FF                 | push FFFFFFFF                         |</span><br><span class=\"line\">00CEB37A             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00CEB37C             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00CEB37E             | FF70 08               | push dword ptr ds:[eax+8]             | 0000007D</span><br><span class=\"line\">00CEB381             | E8 FA38E5FF           | call elementclient.B3EC80             |</span><br><span class=\"line\"></span><br><span class=\"line\">00CEB2D7             | 8B70 30               | mov esi,dword ptr ds:[eax+30]         |</span><br><span class=\"line\">esi = [eax + 30]</span><br><span class=\"line\">00CEB2D4             | 8B40 1C               | mov eax,dword ptr ds:[eax+1C]         |</span><br><span class=\"line\">esi = [[eax+1C] + 30]</span><br><span class=\"line\">00CEB2CA             | A1 20205001           | mov eax,dword ptr ds:[1502020]        |</span><br><span class=\"line\">esi = [[[1502020] + 1C] + 30]</span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx,1502020</span><br><span class=\"line\">mov ecx,[ecx]</span><br><span class=\"line\">mov ecx,[ecx+1C]</span><br><span class=\"line\">mov ecx,[ecx+30]</span><br><span class=\"line\">push  -1</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 7D</span><br><span class=\"line\">call 0x0B3EC80</span><br><span class=\"line\"></span><br><span class=\"line\">3.人物选中call</span><br><span class=\"line\">009AE200 - 89 B0 04090000  - mov [eax+00000904],esi</span><br><span class=\"line\">00B55402             | A1 20205001           | mov eax,dword ptr ds:[1502020]        |</span><br><span class=\"line\">00B55407             | 56                    | push esi                              | 80001A0B</span><br><span class=\"line\">00B55408             | 8B48 20               | mov ecx,dword ptr ds:[eax+20]         |</span><br><span class=\"line\">00B5540B             | 81C1 EC000000         | add ecx,EC                            |</span><br><span class=\"line\">00B55411             | E8 BA8DE5FF           | call elementclient.9AE1D0             |</span><br><span class=\"line\"></span><br><span class=\"line\">mov eax,dword ptr ds:[1502020]</span><br><span class=\"line\">push 80001C4A</span><br><span class=\"line\">mov ecx,dword ptr ds:[eax+20] </span><br><span class=\"line\">add ecx,0x0EC        </span><br><span class=\"line\">call 9AE1D0     </span><br><span class=\"line\"></span><br><span class=\"line\">//通过寻找上一层的代码确定call</span><br><span class=\"line\"></span><br><span class=\"line\">4.人物技能分析</span><br><span class=\"line\">00CEB37E             | FF70 08               | push dword ptr ds:[eax+8]             |</span><br><span class=\"line\">eax = 4483FFB0</span><br><span class=\"line\"></span><br><span class=\"line\">41930A50  47B991C0 À.¹G </span><br><span class=\"line\">41930A54  4483FE28 (þ.D </span><br><span class=\"line\">41930A58  4483FFB0 °ÿ.D </span><br><span class=\"line\">41930A5C  44832800 .(.D </span><br><span class=\"line\">41930A60  4483FD10 .ý.D </span><br><span class=\"line\"></span><br><span class=\"line\">47B991C0 01299498 ..). </span><br><span class=\"line\">47B991C4 30F749F0 ðI÷0 </span><br><span class=\"line\">47B991C8 00000071 q... </span><br><span class=\"line\">47B991CC 00000005 .... </span><br><span class=\"line\">47B991D0 00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\">30F749F0 1046E60C .æF. </span><br><span class=\"line\">30F749F4 10833F48 H?.. </span><br><span class=\"line\">30F749F8 00000000 .... </span><br><span class=\"line\">30F749FC 00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\">10833F48 105450F8 øPT. elementskill.&amp;?GetRequiredGenius@ElementSkill@GNET@@UAEPAHH@Z</span><br><span class=\"line\">10833F4C 00000071 q... </span><br><span class=\"line\">10833F50 00000007 .... </span><br><span class=\"line\">10833F54 10545150 PQT. L&quot;清心咒&quot;</span><br><span class=\"line\">10833F58 10545158 XQT. &quot;清心咒&quot;</span><br><span class=\"line\">10833F5C 10545160 `QT. &quot;清心咒.dds&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">10545150 清心咒</span><br><span class=\"line\"></span><br><span class=\"line\">2CAC0CF8 - [[[0150B6FC]+30] = 2CAC0CF8 - 2CABE4D8 = 2820</span><br><span class=\"line\">[[[0150B6FC]+30]+2820]   //即可得到技能列表首地址</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">5.周围怪物列表</span><br><span class=\"line\">00BE8626 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class=\"line\"></span><br><span class=\"line\">00BE8615   &gt; \\8B72 0C       mov esi,dword ptr ds:[edx+0xC]           ;  Case 21 of switch 00BE84E0</span><br><span class=\"line\">00BE8618   .  FF36          push dword ptr ds:[esi]       </span><br><span class=\"line\">00BE861A   .  E8 F10D0000   call ElementC.00BE9410</span><br><span class=\"line\">00BE861F   .  85C0          test eax,eax</span><br><span class=\"line\">00BE8621   .  74 60         je XElementC.00BE8683</span><br><span class=\"line\">00BE8623   .  8B4E 04       mov ecx,dword ptr ds:[esi+0x4]</span><br><span class=\"line\">00BE8626   .  8988 2C010000 mov dword ptr ds:[eax+0x12C],ecx</span><br><span class=\"line\">00BE862C   .  8B4E 08       mov ecx,dword ptr ds:[esi+0x8]</span><br><span class=\"line\">00BE862F   .  8988 84010000 mov dword ptr ds:[eax+0x184],ecx</span><br><span class=\"line\">00BE8635   .  8B4E 0C       mov ecx,dword ptr ds:[esi+0xC]</span><br><span class=\"line\">00BE8638   .  5F            pop edi</span><br><span class=\"line\">00BE8639   .  5E            pop esi</span><br><span class=\"line\">00BE863A   .  8988 0C020000 mov dword ptr ds:[eax+0x20C],ecx</span><br><span class=\"line\"></span><br><span class=\"line\">00BF4E10   $  55            push ebp</span><br><span class=\"line\">00BF4E11   .  8BEC          mov ebp,esp</span><br><span class=\"line\">00BF4E13   .  8B45 0C       mov eax,dword ptr ss:[ebp+0xC]</span><br><span class=\"line\">00BF4E16   .  33D2          xor edx,edx</span><br><span class=\"line\">00BF4E18   .  56            push esi</span><br><span class=\"line\">00BF4E19   .  8B30          mov esi,dword ptr ds:[eax]     80001C4A</span><br><span class=\"line\">00BF4E1B   .  8BC6          mov eax,esi</span><br><span class=\"line\">00BF4E1D   .  F771 14       div dword ptr ds:[ecx+0x14]    ecx = 0A345DEC</span><br><span class=\"line\">00BF4E20   .  8B41 08       mov eax,dword ptr ds:[ecx+0x8]    51A10448</span><br><span class=\"line\">00BF4E23   .  8B0490        mov eax,dword ptr ds:[eax+edx*4]  41AEC578 edx=000002CB</span><br><span class=\"line\">00BF4E26   .  85C0          test eax,eax</span><br><span class=\"line\"></span><br><span class=\"line\">00BE9421  |.  8D4E 14       lea ecx,dword ptr ds:[esi+0x14]</span><br><span class=\"line\">ecx = [esi+0x14] = [ecx + 0x14] = [[eax+2*4+0x1C] + 0x14] = [[[[esi+0x4]+0x1C]+2*4+0x1C] + 0x14] = [[[[ecx+0x4]+0x1C]+2*4+0x1C] + 0x14] = [[[[[0150B6FC]+0x98]+0x4]+0x1C]+2*4+0x1C] + 0x14</span><br><span class=\"line\"></span><br><span class=\"line\">eax = [eax+edx*4] = 41AEC578</span><br><span class=\"line\"></span><br><span class=\"line\">41AEC578  00000000</span><br><span class=\"line\">41AEC57C  2D9E78D0</span><br><span class=\"line\">41AEC580  80001C4A</span><br><span class=\"line\"></span><br><span class=\"line\">2D9E78D0  01282E8C  ElementC.01282E8C</span><br><span class=\"line\">2D9E78D4  00000012</span><br><span class=\"line\">2D9E78D8  01518328  ElementC.01518328</span><br><span class=\"line\">2D9E78DC  3F7F4E6D</span><br><span class=\"line\">2D9E78E0  80000000</span><br><span class=\"line\">2D9E78E4  3D96A916</span><br><span class=\"line\">2D9E78E8  00000000</span><br><span class=\"line\">2D9E78EC  00000000</span><br><span class=\"line\">2D9E78F0  3F800000</span><br><span class=\"line\">2D9E78F4  00000000</span><br><span class=\"line\">2D9E78F8  00000000</span><br><span class=\"line\">2D9E78FC  BD96A917</span><br><span class=\"line\">2D9E7900  00000000</span><br><span class=\"line\">2D9E7904  3F7F4E6F</span><br><span class=\"line\">2D9E7908  00000000</span><br><span class=\"line\">2D9E790C  44339366</span><br><span class=\"line\">2D9E7910  42855E22</span><br><span class=\"line\">2D9E7914  C2B205F5</span><br><span class=\"line\">2D9E7918  3F800000</span><br><span class=\"line\">2D9E791C  3F7F4E6D</span><br><span class=\"line\">2D9E7920  80000000</span><br><span class=\"line\">2D9E7924  3D96A916</span><br><span class=\"line\">2D9E7928  00000000</span><br><span class=\"line\">2D9E792C  00000000</span><br><span class=\"line\">2D9E7930  3F800000</span><br><span class=\"line\">2D9E7934  00000000</span><br><span class=\"line\">2D9E7938  00000000</span><br><span class=\"line\">2D9E793C  BD96A917</span><br><span class=\"line\">2D9E7940  00000000</span><br><span class=\"line\">2D9E7944  3F7F4E6F</span><br><span class=\"line\">2D9E7948  00000000</span><br><span class=\"line\">2D9E794C  44339366</span><br><span class=\"line\">2D9E7950  42855E22</span><br><span class=\"line\">2D9E7954  C2B205F5</span><br><span class=\"line\">2D9E7958  3F800000</span><br><span class=\"line\">2D9E795C  00000000</span><br><span class=\"line\">2D9E7960  00000000</span><br><span class=\"line\">2D9E7964  012BC8F8  ElementC.012BC8F8</span><br><span class=\"line\">2D9E7968  01248974  ElementC.01248974</span><br><span class=\"line\">2D9E797C  0000000A</span><br><span class=\"line\">2D9E7980  00000000</span><br><span class=\"line\">2D9E7984  00000006</span><br><span class=\"line\">2D9E7988  420136DA</span><br><span class=\"line\">2D9E798C  75490100  windows_.75490100</span><br><span class=\"line\">2D9E7990  00000000</span><br><span class=\"line\">2D9E7994  BD471982</span><br><span class=\"line\">2D9E7998  80000000</span><br><span class=\"line\">2D9E799C  3F7FB288</span><br><span class=\"line\">2D9E79A0  00000000</span><br><span class=\"line\">2D9E79A4  BD16C33D</span><br><span class=\"line\">2D9E79A8  80000000</span><br><span class=\"line\">2D9E79AC  3F7FD398</span><br><span class=\"line\">2D9E79B0  00000096</span><br><span class=\"line\">2D9E79B4  0000009C</span><br><span class=\"line\">2D9E79B8  0000000F</span><br><span class=\"line\">2D9E79BC  77000100  gdi32ful.77000100</span><br><span class=\"line\">2D9E79C0  BDC16CBC</span><br><span class=\"line\">2D9E79C4  3F77956C</span><br><span class=\"line\">2D9E79C8  3E71C8DE</span><br><span class=\"line\">2D9E79CC  BDC16CBC</span><br><span class=\"line\">2D9E79D0  3F77956C</span><br><span class=\"line\">2D9E79D4  3E71C8E3  ASCII &quot;s</span><br><span class=\"line\">2D9E79D8  676F4800  igc32.676F4800</span><br><span class=\"line\">2D9E79DC  01518340  ElementC.01518340</span><br><span class=\"line\">2D9E79E0  41BCBCE0</span><br><span class=\"line\">2D9E79E4  0A345DD8</span><br><span class=\"line\">2D9E79E8  80001C4A</span><br><span class=\"line\">2D9E79EC  0000AE41</span><br><span class=\"line\">2D9E79F0  0000AE41</span><br><span class=\"line\">2D9E79F4  00000010</span><br><span class=\"line\">2D9E79F8  00000000</span><br><span class=\"line\">2D9E79FC  000003BE</span><br><span class=\"line\">2D9E7A54  000003BE</span><br><span class=\"line\">2D9E7ADC  FFFFFFFF</span><br><span class=\"line\">2D9E7AE0  3F800000</span><br><span class=\"line\">2D9E7AE4  78443800</span><br><span class=\"line\">2D9E7AE8  0000000C</span><br><span class=\"line\">2D9E7B40  00001388</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$+3C     4430814B K.0D    ;x</span><br><span class=\"line\">$+40     427230F2 ò0rB    ;z</span><br><span class=\"line\">$+44     C2D852B3 ³RØÂ    ;y</span><br><span class=\"line\">$+124    00000010 ....     ;怪物等级</span><br><span class=\"line\">$+128    00000000 .... </span><br><span class=\"line\">$+12C    000003BE ¾...     ;当前血量</span><br><span class=\"line\">$+184    000003BE ¾...     ;最大血量</span><br><span class=\"line\">$+270    00001388 ....         </span><br><span class=\"line\">$+284    3E312F14 ./1&gt;      L&quot;囚徒怨魂&quot;</span><br></pre></td></tr></table></figure>\n<h4 id=\"更新结束-2\"><a class=\"markdownIt-Anchor\" href=\"#更新结束-2\">#</a> 更新结束</h4>\n<p>5. 人物技能信息分析</p>\n<p>1. 每个技能所包含的数据</p>\n<p>技能名称 ID</p>\n<p>技能冷却时间</p>\n<p>可以猜想：有一个技能类，每个技能都是这个类的对象</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Skill</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_skillNamel</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_skillID</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_skillInterval;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_skillLevel;</span><br><span class=\"line\"></span><br><span class=\"line\">\tm_skillInfo;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">class skillInfo</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">push [eax+0x08]    </span><br><span class=\"line\">eax = 4C270380    4AAE4A38</span><br><span class=\"line\"></span><br><span class=\"line\">46A30A60 01297268 hr). </span><br><span class=\"line\">46A30A64 49C40C18 ..ÄI </span><br><span class=\"line\">46A30A68 00000071 q... </span><br><span class=\"line\">46A30A6C 00000005 .... </span><br><span class=\"line\">46A30A70 00000000 .... </span><br><span class=\"line\">46A30A74 00000000 .... </span><br><span class=\"line\">46A30A78 000003E8 è... </span><br><span class=\"line\">46A30A7C A2B70000 ..·¢ </span><br><span class=\"line\">46A30A80 00000000 .... </span><br><span class=\"line\">46A30A84 00000000 .... </span><br><span class=\"line\">46A30A88 005F7800 .x_. </span><br><span class=\"line\">46A30A8C 00000000 .... </span><br><span class=\"line\">46A30A90 00020100 .... </span><br><span class=\"line\">46A30A94 00000000 .... </span><br><span class=\"line\">46A30A98 00000001 .... </span><br><span class=\"line\">46A30A9C 0000001E .... </span><br><span class=\"line\">46A30AA0 0000001F .... </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4272ED50</span><br><span class=\"line\">4C270380  01297268  ElementC.01297268</span><br><span class=\"line\">4C270384  553935B0</span><br><span class=\"line\">4C270388  0000007D       技能ID</span><br><span class=\"line\">4C27038C  00000005       技能等级   C</span><br><span class=\"line\">4C270390  00000000</span><br><span class=\"line\">4C270394  00000000       冷却倒计时</span><br><span class=\"line\">4C270398  000003E8       冷却时间 1000ms</span><br><span class=\"line\">4C27039C  A2B70000</span><br><span class=\"line\">4C2703A0  00000000</span><br><span class=\"line\">4C2703A4  00000000</span><br><span class=\"line\">4C2703A8  005F7800       入口地址</span><br><span class=\"line\">4C2703AC  00000000</span><br><span class=\"line\">4C2703B0  00020100</span><br><span class=\"line\">4C2703B4  00000000</span><br><span class=\"line\"></span><br><span class=\"line\">4C27D890</span><br><span class=\"line\">4C27D890  01297268  ElementC.01297268</span><br><span class=\"line\">4C27D894  55393CB8</span><br><span class=\"line\">4C27D898  0000007F</span><br><span class=\"line\">4C27D89C  00000004</span><br><span class=\"line\">4C27D8A0  00000000</span><br><span class=\"line\">4C27D8A4  00000000   </span><br><span class=\"line\">4C27D8A8  00000BB8</span><br><span class=\"line\">4C27D8AC  D25FF800</span><br><span class=\"line\">4C27D8B0  00000000</span><br><span class=\"line\">4C27D8B4  00000000</span><br><span class=\"line\">4C27D8B8  00000000</span><br><span class=\"line\">4C27D8BC  00000000</span><br><span class=\"line\">4C27D8C0  00020100</span><br><span class=\"line\">4C27D8C4  00000000</span><br><span class=\"line\">4C27D8C8  00000001</span><br><span class=\"line\">4C27D8CC  00000019</span><br><span class=\"line\">4C27D8D0  0000001F</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>推测 00CE92DE</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">46A30A60 01297268 hr). </span><br><span class=\"line\">46A30A64 49C40C18 ..ÄI </span><br><span class=\"line\">46A30A68 00000071 q... </span><br><span class=\"line\">46A30A6C 00000005 .... </span><br><span class=\"line\">46A30A70 00000000 .... </span><br><span class=\"line\">46A30A74 00000000 .... </span><br><span class=\"line\">46A30A78 000003E8 è... </span><br><span class=\"line\">46A30A7C A2B70000 ..·¢ </span><br><span class=\"line\">46A30A80 00000000 .... </span><br><span class=\"line\">46A30A84 00000000 .... </span><br><span class=\"line\">46A30A88 005F7800 .x_. </span><br><span class=\"line\">46A30A8C 00000000 .... </span><br><span class=\"line\">46A30A90 00020100 .... </span><br><span class=\"line\">46A30A94 00000000 .... </span><br><span class=\"line\">46A30A98 00000001 .... </span><br><span class=\"line\">46A30A9C 0000001E .... </span><br><span class=\"line\">46A30AA0 0000001F .... </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">495A6148  01297268  ElementC.01297268</span><br><span class=\"line\">495A614C  605D0978</span><br><span class=\"line\">495A6150  0000007D</span><br><span class=\"line\">495A6154  00000005</span><br><span class=\"line\">495A6158  00000000</span><br><span class=\"line\">495A615C  00000000</span><br><span class=\"line\">495A6160  000003E8</span><br><span class=\"line\">495A6164  00726F00  ElementC.00726F00</span><br><span class=\"line\">495A6168  00000000</span><br><span class=\"line\">495A616C  00000000</span><br><span class=\"line\">495A6170  00000000</span><br><span class=\"line\">495A6174  00000000</span><br><span class=\"line\">495A6178  00020100</span><br><span class=\"line\">495A617C  00000000</span><br><span class=\"line\">495A6180  00030000</span><br><span class=\"line\">495A6184  00090006</span><br><span class=\"line\">495A6188  000F000C</span><br><span class=\"line\">495A618C  00190013</span><br><span class=\"line\">495A6190  0021001E</span><br><span class=\"line\">495A6194  00270024</span><br><span class=\"line\">495A6198  002C0029</span><br><span class=\"line\">495A619C  0032002F</span><br><span class=\"line\">495A61A0  003B0036</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">4272EED8 01297268 hr). </span><br><span class=\"line\">4272EEDC 49C403A8 ¨.ÄI </span><br><span class=\"line\">4272EEE0 0000007F .... </span><br><span class=\"line\">4272EEE4 00000004 .... </span><br><span class=\"line\">4272EEE8 00000000 .... </span><br><span class=\"line\">4272EEEC 00000000 .... </span><br><span class=\"line\">4272EEF0 00000BB8 ¸... </span><br><span class=\"line\">4272EEF4 00726F00 .or. </span><br><span class=\"line\">4272EEF8 00000000 .... </span><br><span class=\"line\">4272EEFC 00000000 .... </span><br><span class=\"line\">4272EF00 00000000 .... </span><br><span class=\"line\">4272EF04 00000000 .... </span><br><span class=\"line\">4272EF08 00020100 .... </span><br><span class=\"line\">4272EF0C 00000000 .... </span><br><span class=\"line\">4272EF10 01297268 hr). </span><br><span class=\"line\">4272EF14 4F3C3E50 P&gt;&lt;O </span><br><span class=\"line\">4272EF18 00000C9E .... </span><br><span class=\"line\">4272EF1C 00000001 .... </span><br><span class=\"line\">4272EF20 00000000 .... </span><br><span class=\"line\">4272EF24 00000000 .... </span><br><span class=\"line\">4272EF28 000003E8 è... </span><br><span class=\"line\">4272EF2C 00000000 .... </span><br><span class=\"line\">4272EF30 00000000 .... </span><br><span class=\"line\">4272EF34 00000000 .... </span><br><span class=\"line\">4272EF38 00000000 .... </span><br><span class=\"line\">4272EF3C 00000000 .... </span><br><span class=\"line\">4272EF40 00020100 .... </span><br><span class=\"line\">4272EF44 00000000 .... </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">495A6148  01297268  ElementC.01297268</span><br><span class=\"line\">495A614C  605D0978  技能信息</span><br><span class=\"line\">495A6150  0000007D</span><br><span class=\"line\">495A6154  00000005</span><br><span class=\"line\">495A6158  00000000</span><br><span class=\"line\">495A615C  00000000</span><br><span class=\"line\">495A6160  000003E8</span><br><span class=\"line\">495A6164  00726F00  ElementC.00726F00</span><br><span class=\"line\"></span><br><span class=\"line\">605D0978  0203A5AC  ElementS.0203A5AC</span><br><span class=\"line\">605D097C  023F72B0  ElementS.023F72B0 技能详细信息</span><br><span class=\"line\">605D0980  00000000</span><br><span class=\"line\">605D0984  00000000</span><br><span class=\"line\">605D0988  00000000</span><br><span class=\"line\">605D098C  00000000</span><br><span class=\"line\">605D0990  00000000</span><br><span class=\"line\">605D0994  00000000</span><br><span class=\"line\">605D0998  00000000</span><br><span class=\"line\">605D099C  00000000</span><br><span class=\"line\">605D09A0  00000000</span><br><span class=\"line\">605D09A4  00000000</span><br><span class=\"line\">605D09A8  00000000</span><br><span class=\"line\">605D09AC  0000007D</span><br><span class=\"line\">605D09B0  00000005</span><br><span class=\"line\"></span><br><span class=\"line\">023F72B0  02110B04  ElementS.02110B04</span><br><span class=\"line\">023F72B4  0000007D</span><br><span class=\"line\">023F72B8  00000007</span><br><span class=\"line\">023F72BC  020DBFE4  ElementS.020DBFE4  技能名称</span><br><span class=\"line\">023F72C0  020DBFEC  ElementS.020DBFEC</span><br><span class=\"line\">023F72C4  020DBFF4  ElementS.020DBFF4</span><br><span class=\"line\">023F72C8  0000000A</span><br><span class=\"line\">023F72CC  00020001</span><br><span class=\"line\">023F72D0  00000000</span><br><span class=\"line\"></span><br><span class=\"line\">020DBFE4  7BAD7FBD</span><br><span class=\"line\">020DBFE8  00000000</span><br><span class=\"line\">020DBFEC  FDBCF0D3</span><br><span class=\"line\">020DBFF0  00000000</span><br><span class=\"line\">020DBFF4  FDBCF0D3</span><br><span class=\"line\"></span><br><span class=\"line\">020DBFE4  羽箭..</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>猜测：技能列表使用一个数组存储的</p>\n<p>通过 OD 中下断点 <code>push dword ptr ds:[eax+0x8]</code>  在 OD 中 eax 的值</p>\n<p>491B2710 A7</p>\n<p>4B637FE8 71</p>\n<p>491B2828 72</p>\n<p>491B29B0 7D</p>\n<p>491A5200 7F</p>\n<h4 id=\"角色人物技能列表\"><a class=\"markdownIt-Anchor\" href=\"#角色人物技能列表\">#</a> 角色人物技能列表</h4>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103134451637.png\" alt=\"image-20230103134451637\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103134511620.png\" alt=\"image-20230103134511620\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">432CF230  4B637FE8</span><br><span class=\"line\">432CF234  491B2828</span><br><span class=\"line\">432CF238  491B29B0</span><br><span class=\"line\">432CF23C  491A5200</span><br><span class=\"line\">432CF240  491B2710</span><br><span class=\"line\">432CF244  CDD0A3C4</span><br><span class=\"line\">[432CF230]</span><br><span class=\"line\"></span><br><span class=\"line\">4B637FE8  01297268  ElementC.01297268</span><br><span class=\"line\">4B637FEC  4C573D48</span><br><span class=\"line\">4B637FF0  00000071</span><br><span class=\"line\">4B637FF4  00000005</span><br><span class=\"line\">4B637FF8  00000000</span><br><span class=\"line\">4B637FFC  00000000</span><br><span class=\"line\">4B638000  000003E8</span><br><span class=\"line\">[[432CF230]+4]</span><br><span class=\"line\"></span><br><span class=\"line\">4C573D48  0208A5AC  ElementS.0208A5AC</span><br><span class=\"line\">4C573D4C  0244D660  ElementS.0244D660</span><br><span class=\"line\">4C573D50  00000000</span><br><span class=\"line\">4C573D54  00000000</span><br><span class=\"line\">4C573D58  00000000</span><br><span class=\"line\">4C573D5C  00000000</span><br><span class=\"line\">[[[432CF230]+4]+4]</span><br><span class=\"line\"></span><br><span class=\"line\">0244D660  02160550  ElementS.02160550</span><br><span class=\"line\">0244D664  00000071</span><br><span class=\"line\">0244D668  00000007</span><br><span class=\"line\">0244D66C  021605A8  ElementS.021605A8</span><br><span class=\"line\">0244D670  021605B0  ElementS.021605B0</span><br><span class=\"line\">0244D674  021605B8  ElementS.021605B8</span><br><span class=\"line\">0244D678  0000000A</span><br><span class=\"line\">0244D67C  00000002</span><br><span class=\"line\">[[[[432CF230]+4]+4]+0x0C]</span><br><span class=\"line\"></span><br><span class=\"line\">021605A8  5FC36E05</span><br><span class=\"line\">021605AC  00005492</span><br><span class=\"line\">021605B0  C4D0E5C7</span><br><span class=\"line\">021605B4  0000E4D6</span><br><span class=\"line\">021605B8  C4D0E5C7</span><br><span class=\"line\">021605BC  642EE4D6</span><br><span class=\"line\"></span><br><span class=\"line\">021605A8  清心咒.쓐</span><br><span class=\"line\">[[[[432CF230]+4]+4]+0x0C] = 清心咒</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230103135837650.png\" alt=\"image-20230103135837650\"></p>\n<p>2EEDD430 - [[[14FEE38]+1C]+30] = 2EEDD430 - 2EEDAC10 = 2820</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">2EEDD430  432CF230   人物技能列表</span><br><span class=\"line\">2EEDD434  00000005   人物技能列表长度</span><br><span class=\"line\">2EEDD438  00000010</span><br><span class=\"line\">2EEDD43C  00000010</span><br><span class=\"line\">2EEDD440  01276380  ElementC.01276380</span><br><span class=\"line\">2EEDD444  011ED3B8  ElementC.011ED3B8</span><br><span class=\"line\">2EEDD448  00000000</span><br><span class=\"line\">2EEDD44C  00000000</span><br><span class=\"line\">2EEDD450  00000000</span><br><span class=\"line\">2EEDD454  00000010</span><br><span class=\"line\"></span><br><span class=\"line\">dd [[[14FEE38]+1C]+30] + 2820 = 2EEDD430</span><br></pre></td></tr></table></figure>\n<h4 id=\"人物周围怪物\"><a class=\"markdownIt-Anchor\" href=\"#人物周围怪物\">#</a> 人物周围怪物</h4>\n<p>猜想：怪物</p>\n<figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Monster</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">    m_dwMonsterID;</span><br><span class=\"line\">    MonsterInfo monIfo;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">MonsterInfo</span></span></span><br><span class=\"line\"><span class=\"class\">&#123;</span></span><br><span class=\"line\">\tm_strMonsterName;</span><br><span class=\"line\">    m_dwMonsterID;</span><br><span class=\"line\">    m_Mode;</span><br><span class=\"line\">    m_MonsterGrade;</span><br><span class=\"line\">    m_MonsterShengMing;</span><br><span class=\"line\">    m_MonsterMaxShengMing;</span><br><span class=\"line\">    m_Monster_X_POS;</span><br><span class=\"line\">    m_Monster_Y_POS;</span><br><span class=\"line\">    m_Monster_Z_POS;</span><br><span class=\"line\">    m_MonsterType;    <span class=\"comment\">//npc,monster</span></span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230105211901057.png\" alt=\"image-20230105211901057\"></p>\n<p>00BE9BA4 - 8B 86 18010000  - mov eax,[esi+00000118]  ESI=5F21EBA8</p>\n<p>思路一：</p>\n<p>在游戏中用 CE 搜索怪物的相关信息 (怪物的 ID，生命，名字等信息) 定位到怪物对象的地址，然后通过 OD 下访问断点，找到相关代码，分析代码逻辑，最终找到怪物列表</p>\n<p>思路二：</p>\n<p>网游通过 send 函数断点分析相关操作</p>\n<p>1. 怪物的信息偏移地址分析</p>\n<p>2. 人物周围的怪物列表</p>\n<p>80001C4A</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00BE7E26 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class=\"line\"></span><br><span class=\"line\">eax = 3EB9CE70</span><br><span class=\"line\"></span><br><span class=\"line\">$+124    00000010 .... </span><br><span class=\"line\">$+128    00000000 .... </span><br><span class=\"line\">$+12C    000003BE ¾... </span><br><span class=\"line\">$+180    00000000 .... </span><br><span class=\"line\">$+184    000003BE ¾... </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00C1BD4B - 8B B8 18010000  - mov edi,[eax+00000118]</span><br><span class=\"line\">00C1BD48              | 8B46 04                | mov eax,dword ptr ds:[esi+4]                   | 3EB978D0</span><br><span class=\"line\">00C1BD4B              | 8BB8 18010000          | mov edi,dword ptr ds:[eax+118]                 | 80001C46</span><br><span class=\"line\">00C1BD51              | 8BB0 B4000000          | mov esi,dword ptr ds:[eax+B4]                  | 00000006</span><br><span class=\"line\">00C1BD57              | E8 F40D0100            | call elementclient.C2CB50                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE9BA4 - 8B 86 18010000  - mov eax,[esi+00000118]</span><br><span class=\"line\"></span><br><span class=\"line\">00C17B6A - 8B BF 18010000  - mov edi,[edi+00000118]   3EB9CE70</span><br><span class=\"line\">00C17B64              | 8BB7 B4000000          | mov esi,dword ptr ds:[edi+B4]                  | 00000006</span><br><span class=\"line\">00C17B6A              | 8BBF 18010000          | mov edi,dword ptr ds:[edi+118]                 | 80001C4A</span><br><span class=\"line\">00C17B70              | E8 DB4F0100            | call elementclient.C2CB50                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE8603 - 8B 86 18010000  - mov eax,[esi+00000118]</span><br><span class=\"line\">00BE8601              | 8B36                   | mov esi,dword ptr ds:[esi]                     |</span><br><span class=\"line\">00BE8603              | 8B86 18010000          | mov eax,dword ptr ds:[esi+118]                 |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE7E26 - 89 88 2C010000  - mov [eax+0000012C],ecx</span><br><span class=\"line\">00BE7E23              | 8B4E 04                | mov ecx,dword ptr ds:[esi+4]                   | 00000291</span><br><span class=\"line\">00BE7E26              | 8988 2C010000          | mov dword ptr ds:[eax+12C],ecx                 | </span><br><span class=\"line\">00BE7E2C              | 8B4E 08                | mov ecx,dword ptr ds:[esi+8]                   | 000003BE</span><br><span class=\"line\">00BE7E2F              | 8988 84010000          | mov dword ptr ds:[eax+184],ecx                 | </span><br><span class=\"line\">00BE7E35              | 8B4E 0C                | mov ecx,dword ptr ds:[esi+C]                   |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00F30DED              | 8B89 EC000000          | mov ecx,dword ptr ds:[ecx+EC]                  | </span><br><span class=\"line\">00F30DF3              | 8B45 08                | mov eax,dword ptr ss:[ebp+8]                   |</span><br><span class=\"line\">00F30DF6              | 8B0481                 | mov eax,dword ptr ds:[ecx+eax*4]               |</span><br><span class=\"line\">00F30DF9              | 85C0                   | test eax,eax                                   |</span><br><span class=\"line\">00C50D74              | E8 67002E00            | call elementclient.F30DE0                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00B69BBB - FF B3 18010000  - push [ebx+00000118]</span><br><span class=\"line\"></span><br><span class=\"line\">00B69BBB              | FFB3 18010000          | push dword ptr ds:[ebx+118]                    |</span><br><span class=\"line\">00B69BC1              | F3:0F114424 18         | movss dword ptr ss:[esp+18],xmm0               |</span><br><span class=\"line\">00B69BC7              | E8 64BAECFF            | call elementclient.A35630                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00C15CAB - FF B7 18010000  - push [edi+00000118]</span><br><span class=\"line\"></span><br><span class=\"line\">00C15CE5 - FF B7 18010000  - push [edi+00000118]</span><br><span class=\"line\">00C15CD5              | 8B75 18                | mov esi,dword ptr ss:[ebp+18]                  |</span><br><span class=\"line\">00C15CD8              | 8B4D F0                | mov ecx,dword ptr ss:[ebp-10]                  |</span><br><span class=\"line\">00C15CDB              | 53                     | push ebx                                       |</span><br><span class=\"line\">00C15CDC              | FF75 14                | push dword ptr ss:[ebp+14]                     |</span><br><span class=\"line\">00C15CDF              | 56                     | push esi                                       |</span><br><span class=\"line\">00C15CE0              | 6A 00                  | push 0                                         |</span><br><span class=\"line\">00C15CE2              | FF75 08                | push dword ptr ss:[ebp+8]                      |</span><br><span class=\"line\">00C15CE5              | FFB7 18010000          | push dword ptr ds:[edi+118]                    |</span><br><span class=\"line\">00C15CEB              | E8 9067FCFF            | call elementclient.BDC480                      |</span><br><span class=\"line\"></span><br><span class=\"line\">00C1DE59 - 8B B8 18010000  - mov edi,[eax+00000118]</span><br><span class=\"line\"></span><br><span class=\"line\">00BE7E15   &gt; \\8B72 0C       mov esi,dword ptr ds:[edx+0xC]           ;  6FC422FA</span><br><span class=\"line\">00BE7E18   .  FF36          push dword ptr ds:[esi]    80001C4A</span><br><span class=\"line\">00BE7E1A   .  E8 010E0000   call ElementC.00BE8C20    </span><br><span class=\"line\">00BE7E1F   .  85C0          test eax,eax   2A532888</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00A4AA6F              | E8 1C030000            | call elementclient.A4AD90             |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4AD94              | 8BF9                   | mov edi,ecx                           |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4AE03              | 8B8F 98000000          | mov ecx,dword ptr ds:[edi+98]         |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4AE0E              | E8 4DA21900            | call elementclient.BE5060             |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE5088              | 8BF1                   | mov esi,ecx                           |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE50B1              | 8B46 04                | mov eax,dword ptr ds:[esi+4]          |</span><br><span class=\"line\">00BE50B4              | 8B40 1C                | mov eax,dword ptr ds:[eax+1C]         |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE50BB              | 8B4C88 1C              | mov ecx,dword ptr ds:[eax+ecx*4+1C]   | eax = 095D9D28 ecx = 2</span><br><span class=\"line\">00BE50BF              | 85C9                   | test ecx,ecx                          |</span><br><span class=\"line\">00BE50C1              | 74 29                  | je elementclient.BE50EC               |</span><br><span class=\"line\">00BE50C3              | 8B01                   | mov eax,dword ptr ds:[ecx]            |</span><br><span class=\"line\">00BE50C5              | 8D55 D4                | lea edx,dword ptr ss:[ebp-2C]         |</span><br><span class=\"line\">00BE50C8              | 52                     | push edx                              |</span><br><span class=\"line\">00BE50C9              | FF50 34                | call dword ptr ds:[eax+34]            |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE8150              | E8 7BFBFFFF            | call elementclient.BE7CD0             |</span><br><span class=\"line\"></span><br><span class=\"line\">00BE7E15   &gt; \\8B72 0C       mov esi,dword ptr ds:[edx+0xC]          1C677902</span><br><span class=\"line\">00BE7E18   .  FF36          push dword ptr ds:[esi]                 80001C4A</span><br><span class=\"line\">00BE7E1A   .  E8 010E0000   call ElementC.00BE8C20</span><br><span class=\"line\">00BE7E1F   .  85C0          test eax,eax                            37327F00</span><br><span class=\"line\">00BE7E21   .  74 60         je XElementC.00BE7E83</span><br><span class=\"line\">00BE7E23   .  8B4E 04       mov ecx,dword ptr ds:[esi+0x4]</span><br><span class=\"line\">00BE7E26   .  8988 2C010000 mov dword ptr ds:[eax+0x12C],ecx</span><br><span class=\"line\">00BE7E2C   .  8B4E 08       mov ecx,dword ptr ds:[esi+0x8]</span><br><span class=\"line\">00BE7E2F   .  8988 84010000 mov dword ptr ds:[eax+0x184],ecx</span><br><span class=\"line\">00BE7E35   .  8B4E 0C       mov ecx,dword ptr ds:[esi+0xC]</span><br><span class=\"line\"></span><br><span class=\"line\">call 00BE8C20通过怪物ID得到怪物对象</span><br><span class=\"line\">00BE8C20  /$  55            push ebp</span><br><span class=\"line\">00BE8C21  |.  8BEC          mov ebp,esp</span><br><span class=\"line\">00BE8C23  |.  83EC 08       sub esp,0x8</span><br><span class=\"line\">00BE8C26  |.  56            push esi</span><br><span class=\"line\">00BE8C27  |.  8BF1          mov esi,ecx</span><br><span class=\"line\">00BE8C29  |.  8D45 08       lea eax,[arg.1]</span><br><span class=\"line\">00BE8C2C  |.  50            push eax</span><br><span class=\"line\">00BE8C2D  |.  8D45 F8       lea eax,[local.2]</span><br><span class=\"line\">00BE8C30  |.  50            push eax</span><br><span class=\"line\">00BE8C31  |.  8D4E 14       lea ecx,dword ptr ds:[esi+0x14]    esi = 0A3F6DD8</span><br><span class=\"line\">00BE8C34  |.  E8 57130000   call ElementC.00BE9F90</span><br><span class=\"line\"></span><br><span class=\"line\">00BE9F90   $  55            push ebp</span><br><span class=\"line\">00BE9F91   .  8BEC          mov ebp,esp</span><br><span class=\"line\">00BE9F93   .  8B45 0C       mov eax,dword ptr ss:[ebp+0xC]    0019EECC</span><br><span class=\"line\">00BE9F96   .  33D2          xor edx,edx</span><br><span class=\"line\">00BE9F98   .  56            push esi   0A3F6DD8 </span><br><span class=\"line\">00BE9F99   .  8B30          mov esi,dword ptr ds:[eax]   80001C4A</span><br><span class=\"line\">00BE9F9B   .  8BC6          mov eax,esi</span><br><span class=\"line\">00BE9F9D   .  F771 14       div dword ptr ds:[ecx+0x14]      eax/301   edx = 000002CB   ecx = 0A3F6DEC</span><br><span class=\"line\">00BE9FA0   .  8B41 08       mov eax,dword ptr ds:[ecx+0x8]  58A9B678 怪物列表地址</span><br><span class=\"line\">00BE9FA3   .  8B0490        mov eax,dword ptr ds:[eax+edx*4]  4F46B068 </span><br><span class=\"line\">00BE9FA6   .  85C0          test eax,eax</span><br><span class=\"line\">00BE9FA8   .  74 11         je XElementC.00BE9FBB</span><br><span class=\"line\">00BE9FB0   &gt;  3970 08       cmp dword ptr ds:[eax+0x8],esi</span><br><span class=\"line\">00BE9FB3   .  74 18         je XElementC.00BE9FCD</span><br><span class=\"line\">00BE9FB5   .  8B00          mov eax,dword ptr ds:[eax]</span><br><span class=\"line\">00BE9FB7   .  85C0          test eax,eax</span><br><span class=\"line\">00BE9FB9   .^ 75 F5         jnz XElementC.00BE9FB0</span><br><span class=\"line\">00BE9FBB   &gt;  8B45 08       mov eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">00BE9FBE   .  5E            pop esi</span><br><span class=\"line\">00BE9FBF   .  C700 00000000 mov dword ptr ds:[eax],0x0</span><br><span class=\"line\">00BE9FC5   .  C640 04 00    mov byte ptr ds:[eax+0x4],0x0</span><br><span class=\"line\">00BE9FC9   .  5D            pop ebp</span><br><span class=\"line\">00BE9FCA   .  C2 0800       retn 0x8 </span><br><span class=\"line\">00BE9FCD              | 8B4D 08                | mov ecx,dword ptr ss:[ebp+8]                      0019EEBC</span><br><span class=\"line\">00BE9FD0              | 83C0 04                | add eax,4                                      |  4F46B06C</span><br><span class=\"line\">00BE9FD3              | 5E                     | pop esi                                        | 0A3F6DD8</span><br><span class=\"line\">00BE9FD4              | 8901                   | mov dword ptr ds:[ecx],eax                     | </span><br><span class=\"line\">00BE9FD6              | 8BC1                   | mov eax,ecx                                    | 0019EEBC</span><br><span class=\"line\">00BE9FD8              | C641 04 01             | mov byte ptr ds:[ecx+4],1                      |</span><br><span class=\"line\">00BE9FDC              | 5D                     | pop ebp                                        |</span><br><span class=\"line\">00BE9FDD              | C2 0800                | ret 8                                          |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">怪物对象通过this指针偏移得到ID，当前血量和最大血量 </span><br><span class=\"line\">+ 12C</span><br><span class=\"line\">+ 184</span><br><span class=\"line\">+ 118</span><br><span class=\"line\"></span><br><span class=\"line\">0A3F6DEC     00000000  .... </span><br><span class=\"line\">0A3F6DF0     0000001E  .... </span><br><span class=\"line\">0A3F6DF4     58A9B678  x¶©X </span><br><span class=\"line\">0A3F6DF8     58A9C27C  |Â©X </span><br><span class=\"line\">0A3F6DFC     00000301  .... </span><br><span class=\"line\">0A3F6E00     00000301  .... </span><br><span class=\"line\">0A3F6E04     00000000  .... </span><br><span class=\"line\">0A3F6E08     00000000  .... </span><br><span class=\"line\">0A3F6E0C     0464E750  Pçd. </span><br><span class=\"line\">0A3F6E10     0464E824  $èd. </span><br><span class=\"line\">ecx + 8 = 58A9B678</span><br><span class=\"line\">58A9C27C - 58A9B678 = C04 </span><br><span class=\"line\"></span><br><span class=\"line\">ecx = esi + 14 = ecx + 14 = [eax+2*4+1C]+14 = [[[esi+4]+1C]+2*4+1C]+14 = [[[ecx+4]+1C]+2*4+1C]+14</span><br><span class=\"line\">= [[[[edi+98]+4]+1C]+2*4+1C]+14 = [[[[[1508514]+98]+4]+1C]+2*4+1C]+14</span><br><span class=\"line\"></span><br><span class=\"line\">$ ==&gt;    4F46B068     00000000 .... </span><br><span class=\"line\">$+4      4F46B06C     37327F00 ..27    ;怪物详细信息</span><br><span class=\"line\">$+8      4F46B070     80001C4A J...    ;怪物ID</span><br><span class=\"line\">$+C      4F46B074     00000000 .... </span><br><span class=\"line\">$+10     4F46B078     00000100 .... </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ ==&gt;    37327F00  01280C5C \\.(. </span><br><span class=\"line\">$+4      37327F04  00000012 .... </span><br><span class=\"line\">$+8      37327F08  01515140 @QQ. </span><br><span class=\"line\">$+C      37327F0C  BF514D40 @MQ¿ </span><br><span class=\"line\">$+10     37327F10  00000000 .... </span><br><span class=\"line\">$+14     37327F14  3F136828 (h.? </span><br><span class=\"line\">$+18     37327F18  00000000 .... </span><br><span class=\"line\">$+1C     37327F1C  00000000 .... </span><br><span class=\"line\">$+20     37327F20  3F800000 ...? </span><br><span class=\"line\">$+24     37327F24  00000000 .... </span><br><span class=\"line\">$+28     37327F28  00000000 .... </span><br><span class=\"line\">$+2C     37327F2C  BF136828 (h.¿ </span><br><span class=\"line\">$+30     37327F30  00000000 .... </span><br><span class=\"line\">$+34     37327F34  BF514D40 @MQ¿ </span><br><span class=\"line\">$+38     37327F38  00000000 .... </span><br><span class=\"line\">$+3C     37327F3C  4430814B K.0D    ;x</span><br><span class=\"line\">$+40     37327F40  427230F2 ò0rB    ;z</span><br><span class=\"line\">$+44     37327F44  C2D852B3 ³RØÂ    ;y</span><br><span class=\"line\">$+48     37327F48  3F800000 ...? </span><br><span class=\"line\">$+4C     37327F4C  BF514D40 @MQ¿ </span><br><span class=\"line\">$+50     37327F50  00000000 .... </span><br><span class=\"line\">$+54     37327F54  3F136828 (h.? </span><br><span class=\"line\">$+58     37327F58  00000000 .... </span><br><span class=\"line\">$+5C     37327F5C  00000000 .... </span><br><span class=\"line\">$+60     37327F60  3F800000 ...? </span><br><span class=\"line\">$+64     37327F64  00000000 .... </span><br><span class=\"line\">$+68     37327F68  00000000 .... </span><br><span class=\"line\">$+6C     37327F6C  BF136828 (h.¿ </span><br><span class=\"line\">$+70     37327F70  00000000 .... </span><br><span class=\"line\">$+74     37327F74  BF514D40 @MQ¿ </span><br><span class=\"line\">$+78     37327F78  00000000 .... </span><br><span class=\"line\">$+7C     37327F7C  4430814B K.0D  ;x</span><br><span class=\"line\">$+80     37327F80  427230F2 ò0rB </span><br><span class=\"line\">$+84     37327F84  C2D852B3 ³RØÂ </span><br><span class=\"line\">$+88     37327F88  3F800000 ...? </span><br><span class=\"line\">$+8C     37327F8C  00000000 .... </span><br><span class=\"line\">$+90     37327F90  00000000 .... </span><br><span class=\"line\">$+94     37327F94  012BA6C8 È¦+. </span><br><span class=\"line\">$+98     37327F98  01246824 $h$. </span><br><span class=\"line\">$+AC     37327FAC  0000000A .... </span><br><span class=\"line\">$+B0     37327FB0  00000000 .... </span><br><span class=\"line\">$+B4     37327FB4  00000006 ....   怪物类型 6 怪物 7 NPC 9 宠物 A GM</span><br><span class=\"line\">$+B8     37327FB8  4208CC54 TÌ.B </span><br><span class=\"line\">$+BC     37327FBC  FFFF0100 ..ÿÿ </span><br><span class=\"line\">$+C0     37327FC0  00000000 .... </span><br><span class=\"line\">$+C4     37327FC4  3F735658 XVs? </span><br><span class=\"line\">$+C8     37327FC8  00000000 .... </span><br><span class=\"line\">$+CC     37327FCC  BE9F08C1 Á..¾ </span><br><span class=\"line\">$+D0     37327FD0  00000000 .... </span><br><span class=\"line\">$+D4     37327FD4  3F740BDE Þ.t? </span><br><span class=\"line\">$+D8     37327FD8  00000000 .... </span><br><span class=\"line\">$+DC     37327FDC  BE9AA083 . .¾ </span><br><span class=\"line\">$+E0     37327FE0  00000096 .... </span><br><span class=\"line\">$+E4     37327FE4  00000096 .... </span><br><span class=\"line\">$+E8     37327FE8  000001B6 ¶... </span><br><span class=\"line\">$+EC     37327FEC  FF000101 ...ÿ </span><br><span class=\"line\">$+F0     37327FF0  A0A1F1A4 ¤ñ¡  </span><br><span class=\"line\">$+F4     37327FF4  3F800000 ...? </span><br><span class=\"line\">$+F8     37327FF8  A1D9690E .iÙ¡ </span><br><span class=\"line\">$+FC     37327FFC  80000000 .... </span><br><span class=\"line\">$+100    37328000  3F800000 ...? </span><br><span class=\"line\">$+104    37328004  00000000 .... </span><br><span class=\"line\">$+108    37328008  FFFFFF00 .ÿÿÿ </span><br><span class=\"line\">$+10C    3732800C  01515158 XQQ. </span><br><span class=\"line\">$+110    37328010  4DC50270 p.ÅM &amp;&quot;`剂&quot;</span><br><span class=\"line\">$+114    37328014  0A3F6DD8 Øm?. </span><br><span class=\"line\">$+118    37328018  80001C4A J... </span><br><span class=\"line\">$+11C    3732801C  0000AE41 A®.. </span><br><span class=\"line\">$+120    37328020  0000AE41 A®.. </span><br><span class=\"line\">$+124    37328024  00000010 ....     ;怪物等级</span><br><span class=\"line\">$+128    37328028  00000000 .... </span><br><span class=\"line\">$+12C    3732802C  000003BE ¾...     ;当前血量</span><br><span class=\"line\">$+184    37328084  000003BE ¾...     ;最大血量</span><br><span class=\"line\">$+250    37328028  00000000 ....     ;1.移动加速  3.防御强化  4.法术抵抗  5.攻击强化  6.法术强化  7.舍命突击   8.生命强化  9.虚弱</span><br><span class=\"line\">$+270    373281 00001388 ....         </span><br><span class=\"line\">$+284    373281 3E312F14 ./1&gt;      L&quot;囚徒怨魂&quot;</span><br><span class=\"line\">$+288    373281 00000000 ....      </span><br><span class=\"line\"></span><br><span class=\"line\">$+2E8    373281 00000000 ....       怪物攻击目标ID</span><br><span class=\"line\">$+2EC    373281 00000000 ....       怪物攻击目标ID</span><br><span class=\"line\">$+320 26674050   ;怪物状态列表基地址</span><br><span class=\"line\">$+324 0000       ;怪物状态个数</span><br></pre></td></tr></table></figure>\n<h4 id=\"挂机功能\"><a class=\"markdownIt-Anchor\" href=\"#挂机功能\">#</a> 挂机功能</h4>\n<p>1. 挂机需要创建一个线程</p>\n<p>2. 线程中循环执行</p>\n<p>while()</p>\n<p>{</p>\n<p>​\t选中怪物</p>\n<p>​\t靠近怪物 (向怪物移动至最远攻击距离内)</p>\n<p>​\t释放技能</p>\n<p>​\t判断怪物生命值</p>\n<p>​\t判断自己生命值</p>\n<p>​\t…</p>\n<p>}</p>\n<h4 id=\"找人物移动call\"><a class=\"markdownIt-Anchor\" href=\"#找人物移动call\">#</a> 找人物移动 call</h4>\n<p>思路一：人物移动与目标地点的坐标和人物当前地点坐标数据有联系，所以我们可以从这两个数据入手开始查找</p>\n<p>思路二：网友一般将人物移动时的数据的逻辑处理放在服务端，游戏客户端与服务端通过网络通讯</p>\n<p>所以通过 send 发包函数来定位人物移动的 call 的代码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00B503F7 - F3 0F5C 4F 3C  - subss xmm1,[edi+3C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B50421             | 8B8F F4270000         | mov ecx,dword ptr ds:[edi+27F4]                   |</span><br><span class=\"line\">00B50427             | 6A 01                 | push 1                                            |</span><br><span class=\"line\">00B50429             | E8 42F50000           | call elementclient.B5F970                         |</span><br><span class=\"line\"></span><br><span class=\"line\">00B5042E             | 8BF0                  | mov esi,eax                                       |</span><br><span class=\"line\">00B50430             | 8D45 D4               | lea eax,dword ptr ss:[ebp-2C]                     |</span><br><span class=\"line\">00B50433             | 50                    | push eax                                          |</span><br><span class=\"line\">00B50434             | 6A 00                 | push 0                                            |</span><br><span class=\"line\">00B50436             | 8BCE                  | mov ecx,esi                                       |</span><br><span class=\"line\">00B50438             | E8 735C0100           | call elementclient.B660B0                         |</span><br><span class=\"line\"></span><br><span class=\"line\">00B5043D             | 8D85 70FFFFFF         | lea eax,dword ptr ss:[ebp-90]                     |</span><br><span class=\"line\">00B50443             | 8BCE                  | mov ecx,esi                                       |</span><br><span class=\"line\">00B50445             | 50                    | push eax                                          |</span><br><span class=\"line\">00B50446             | 8D85 64FFFFFF         | lea eax,dword ptr ss:[ebp-9C]                     |</span><br><span class=\"line\">00B5044C             | 50                    | push eax                                          |</span><br><span class=\"line\">00B5044D             | E8 2E5A0100           | call elementclient.B65E80                         |</span><br><span class=\"line\"></span><br><span class=\"line\">00B5051A             | 8B8F F4270000         | mov ecx,dword ptr ds:[edi+27F4]                   |</span><br><span class=\"line\">00B50520             | 6A 00                 | push 0                                            |</span><br><span class=\"line\">00B50522             | 56                    | push esi                                          |</span><br><span class=\"line\">00B50523             | 6A 01                 | push 1                                            |</span><br><span class=\"line\">00B50525             | E8 36020100           | call elementclient.B60760                         |</span><br><span class=\"line\"></span><br><span class=\"line\">$-2C     0019EEA0  44DB58AF    </span><br><span class=\"line\">$-28     0019EEA4  43565AF2    </span><br><span class=\"line\">$-24     0019EEA8  45889118    </span><br><span class=\"line\"></span><br><span class=\"line\">$-90     0019EE3C  3D5ECC82    </span><br><span class=\"line\">$-8C     0019EE40  3F22F622    </span><br><span class=\"line\">$-88     0019EE44  BF44F0D6    </span><br><span class=\"line\"></span><br><span class=\"line\">$-9C     0019EE30  44DB97A2    </span><br><span class=\"line\">$-98     0019EE34  435B1654    </span><br><span class=\"line\">$-94     0019EE38  4588AF10    </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">sub esp,0x18</span><br><span class=\"line\">mov ecx,0150B6FC</span><br><span class=\"line\">mov ecx,[ecx]</span><br><span class=\"line\">mov ecx,[ecx+30]</span><br><span class=\"line\">mov ecx,[ecx+27F4]</span><br><span class=\"line\">push 1</span><br><span class=\"line\">call 0x0B5F970</span><br><span class=\"line\"></span><br><span class=\"line\">mov esi,eax</span><br><span class=\"line\">mov ebx,44DB58AF</span><br><span class=\"line\">mov [esp+0x0],ebx</span><br><span class=\"line\">mov ebx,43565AF2</span><br><span class=\"line\">mov [esp+0x4],ebx</span><br><span class=\"line\">mov ebx,45889118</span><br><span class=\"line\">mov [esp+0x8],ebx</span><br><span class=\"line\">lea eax,[esp]</span><br><span class=\"line\">push eax</span><br><span class=\"line\">push 0</span><br><span class=\"line\">mov ecx,esi</span><br><span class=\"line\">call 0x0B660B0   </span><br><span class=\"line\"></span><br><span class=\"line\">mov edx,3D5ECC82</span><br><span class=\"line\">mov [esp+0xC],edx</span><br><span class=\"line\">mov edx,3F22F622</span><br><span class=\"line\">mov [esp+0x10],edx</span><br><span class=\"line\">mov edx,0x0BF44F0D6</span><br><span class=\"line\">mov [esp+0x14],edx</span><br><span class=\"line\">mov ecx,esi</span><br><span class=\"line\">lea eax,[esp+0xC]</span><br><span class=\"line\">push eax</span><br><span class=\"line\">lea eax,[esp]</span><br><span class=\"line\">push eax</span><br><span class=\"line\">call 0x0B65E80 </span><br><span class=\"line\"></span><br><span class=\"line\">mov ecx,0150B6FC</span><br><span class=\"line\">mov ecx,[ecx]</span><br><span class=\"line\">mov ecx,[ecx+30]</span><br><span class=\"line\">mov ecx,[ecx+27F4]</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push esi</span><br><span class=\"line\">push 1</span><br><span class=\"line\">call 0x0B60760   </span><br><span class=\"line\"></span><br><span class=\"line\">add esp,0x18</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00B661C4 - F3 0F5C 50 3C  - subss xmm2,[eax+3C]</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"找人物背包物品列表\"><a class=\"markdownIt-Anchor\" href=\"#找人物背包物品列表\">#</a> 找人物背包物品列表</h4>\n<p>思路一：以背包中某一种物品来分析，最好是能叠加的，数量可以改变</p>\n<p>物品列表 -&gt; 多种物品 (名字，数量)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00BA02D6 - 01 41 14  - add [ecx+14],eax</span><br><span class=\"line\"></span><br><span class=\"line\">00BA02D0             | 55                    | push ebp                              |</span><br><span class=\"line\">00BA02D1             | 8BEC                  | mov ebp,esp                           |</span><br><span class=\"line\">00BA02D3             | 8B45 08               | mov eax,dword ptr ss:[ebp+8]          | FFFFFFFF</span><br><span class=\"line\">00BA02D6             | 0141 14               | add dword ptr ds:[ecx+14],eax         | ecx = 72221188</span><br><span class=\"line\">00BA02D9             | 8379 14 00            | cmp dword ptr ds:[ecx+14],0           | ecx+14:L&quot;ш&quot;</span><br><span class=\"line\">00BA02DD             | 7D 07                 | jge elementclient.BA02E6              |</span><br><span class=\"line\">00BA02DF             | C741 14 00000000      | mov dword ptr ds:[ecx+14],0           | ecx+14:L&quot;ш&quot;</span><br><span class=\"line\">00BA02E6             | 8B41 18               | mov eax,dword ptr ds:[ecx+18]         | 0000270F</span><br><span class=\"line\">00BA02E9             | 3941 14               | cmp dword ptr ds:[ecx+14],eax         | ecx+14:L&quot;ш&quot;</span><br><span class=\"line\">00BA02EC             | 7E 03                 | jle elementclient.BA02F1              |</span><br><span class=\"line\">00BA02EE             | 8941 14               | mov dword ptr ds:[ecx+14],eax         | ecx+14:L&quot;ш&quot;</span><br><span class=\"line\">00BA02F1             | 8B41 14               | mov eax,dword ptr ds:[ecx+14]         | 445</span><br><span class=\"line\">00BA02F4             | 5D                    | pop ebp                               |</span><br><span class=\"line\">00BA02F5             | C2 0400               | ret 4                                 |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">$ ==&gt;    722211 0127B5E4 äµ&#x27;. </span><br><span class=\"line\">$+4      722211 00000000 .... </span><br><span class=\"line\">$+8      722211 00000009 ....   ;物品类型 回血蓝0x09   0x08生产材料 0x1F仙药  0x0F武器 0x3装备 0x2弹药</span><br><span class=\"line\">$+C      722211 00000710 ....   ;ID    708(生命)  710(真气)</span><br><span class=\"line\">$+10     722211 00000000 .... </span><br><span class=\"line\">$+14     722211 00000447 G...   ;物品数量</span><br><span class=\"line\">$+18     722211 0000270F .&#x27;..   ;物品栏最大数量</span><br><span class=\"line\">$+1C     722211 00000000 .... </span><br><span class=\"line\">$+20     722211 00000384 .... </span><br><span class=\"line\"></span><br><span class=\"line\">$ ==&gt;    722225B8   4B684590 .EhK </span><br><span class=\"line\">$+4      722225BC   4B684518 .EhK </span><br><span class=\"line\">$+8      722225C0   72220770 p.&quot;r </span><br><span class=\"line\">$+C      722225C4   5D938E30 0..] </span><br><span class=\"line\">$+10     722225C8   4B6844A0  DhK </span><br><span class=\"line\">$+14     722225CC   4B684428 (DhK </span><br><span class=\"line\">$+18     722225D0   4B6843B0 °ChK </span><br><span class=\"line\">$+1C     722225D4   722207F8 ø.&quot;r </span><br><span class=\"line\">$+20     722225D8   4B684338 8ChK </span><br><span class=\"line\">$+24     722225DC   513FCC68 hÌ?Q </span><br><span class=\"line\">$+28     722225E0   70B166F8 øf±p </span><br><span class=\"line\">$+2C     722225E4   5FE23F60 `?â_ </span><br><span class=\"line\">$+30     722225E8   72221D38 8.&quot;r </span><br><span class=\"line\">$+34     722225EC   72221CB0 °.&quot;r </span><br><span class=\"line\">$+38     722225F0   72221188 ..&quot;r </span><br><span class=\"line\">$+3C     722225F4   4B683D20  =hK </span><br><span class=\"line\">$+40     722225F8   4B683CA8 ¨&lt;hK </span><br><span class=\"line\">$+44     722225FC   4B683C30 0&lt;hK </span><br><span class=\"line\">$+48     72222600   099B88E0 à... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+4C     72222604   099B8A28 (... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+50     72222608   099B8B70 p... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+54     7222260C   099B96F8 ø... &amp;&quot;P痈&quot;</span><br><span class=\"line\">$+58     72222610   099B8CB8 ¸... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+5C     72222614   4B683BB8 ¸;hK </span><br><span class=\"line\">$+60     72222618   099B8E00 .... </span><br><span class=\"line\">$+64     7222261C   099B8F48 H... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+68     72222620   099B9090 .... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+6C     72222624   099B91D8 Ø... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+70     72222628   099B9320  ... &amp;&quot; 品&quot;</span><br><span class=\"line\">$+74     7222262C   099B9468 h... &amp;&quot;P痈&quot;</span><br><span class=\"line\">$+78     72222630   099B95B0 °... &amp;&quot;P痈&quot;</span><br><span class=\"line\">$+7C     72222634   00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\">00B77B73 - 8B 47 0C  - mov eax,[edi+0C]</span><br><span class=\"line\">00B77B73             | 8B47 0C               | mov eax,dword ptr ds:[edi+C]          | 722225B8</span><br><span class=\"line\">00B77B76             | 53                    | push ebx                              | 72221188</span><br><span class=\"line\">00B77B77             | 8B1CB0                | mov ebx,dword ptr ds:[eax+esi*4]      |</span><br><span class=\"line\">00B77B7A             | 85DB                  | test ebx,ebx                          |</span><br><span class=\"line\">00B77B7C             | 74 1D                 | je elementclient.B77B9B               |</span><br><span class=\"line\">00B77B7E             | 8B45 0C               | mov eax,dword ptr ss:[ebp+C]          | 1</span><br><span class=\"line\">00B77B81             | 8BCB                  | mov ecx,ebx                           | 72221188</span><br><span class=\"line\">00B77B83             | F7D8                  | neg eax                               |</span><br><span class=\"line\">00B77B85             | 50                    | push eax                              | -1</span><br><span class=\"line\">00B77B86             | E8 45870200           | call elementclient.BA02D0             | eax = 0x441 edi = 30AD5BF8</span><br><span class=\"line\">[edi+c]</span><br><span class=\"line\"></span><br><span class=\"line\">00B34C88             | 51                    | push ecx                              |</span><br><span class=\"line\">00B34C89             | 8BC8                  | mov ecx,eax                           | eax = 30AD5BF8  30AD5BF8</span><br><span class=\"line\"></span><br><span class=\"line\">00B34CC2             | 8B4D 08               | mov ecx,dword ptr ss:[ebp+8]          |</span><br><span class=\"line\">00B34CCA             | 50                    | push eax                              | </span><br><span class=\"line\">00B34CCB             | E8 902E0400           | call elementclient.B77B60             |</span><br><span class=\"line\"></span><br><span class=\"line\">00B49A78             | FF2485 009BB400       | jmp dword ptr ds:[eax*4+B49B00]       |</span><br><span class=\"line\">00B49A7F             | 8B81 40180000         | mov eax,dword ptr ds:[ecx+1840]       | ecx = 3E1DA010</span><br><span class=\"line\">00B49A85             | 5D                    | pop ebp                               |</span><br><span class=\"line\">00B49A86             | C2 0400               | ret 4                                 |</span><br><span class=\"line\"></span><br><span class=\"line\">[[[[[[0150B6FC]+30] + 1840]+C]+x*4] +0x14]    x [0-31]       //物品数量</span><br><span class=\"line\">[[[[0150B6FC]+30] + 1840]+10]</span><br><span class=\"line\">$ ==&gt;    30AD5BF8   0127AB74 t«&#x27;. </span><br><span class=\"line\">$+4      30AD5BFC   0127AB6C l«&#x27;. </span><br><span class=\"line\">$+8      30AD5C00   011EF3B8 ¸ó..   </span><br><span class=\"line\">$+C      30AD5C04   722225B8 ¸%&quot;r  ;背包物品列表</span><br><span class=\"line\">$+10     30AD5C08   00000020  ...  ;背包大小</span><br><span class=\"line\">$+14     30AD5C0C   00000020  ... </span><br><span class=\"line\">$+18     30AD5C10   0000000A .... </span><br><span class=\"line\">$+1C     30AD5C14   00000000 .... </span><br><span class=\"line\">$+20     30AD5C18   00010100 .... </span><br><span class=\"line\">$+40     4B6845D0  3F800000 ...? </span><br><span class=\"line\">$+44     4B6845D4  00000000 .... </span><br><span class=\"line\">$+48     4B6845D8  00000000 .... </span><br><span class=\"line\">$+4C     4B6845DC  537177BC ¼wqS L&quot;^aa32ff星云散聚石 (12)\\\\r^ffffff价格^ffffff 1 银币^ffffff (12) \\\\r^00ffff\\\\r死亡保护\\\\r不可丢在地上\\\\r不可交易\\\\r不可放入账号仓库\\\\r^FF0000占星^ffcb4a必备之物，占星时星盘属性数目、\\\\r属性内容、属性位置同时随机变化。\\\\r\\\\r^96f5ff占星时提供星运经验：1&quot;</span><br><span class=\"line\">$+50     4B6845E0  00000000 .... </span><br><span class=\"line\">$+54     4B6845E4  00000000 .... </span><br><span class=\"line\">$+58     4B6845E8  00000000 .... </span><br><span class=\"line\">$+5C     4B6845EC  00000000 .... </span><br><span class=\"line\">$+60     4B6845F0  00000000 .... </span><br><span class=\"line\">$+64     4B6845F4  00000000 .... </span><br><span class=\"line\">$+68     4B6845F8  28B10B10 ..±(  ;物品属性地址</span><br><span class=\"line\">$+6C     4B6845FC  00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\">537177BC ^aa32ff星云散聚石 (12)\\r^ffffff价格^fff</span><br><span class=\"line\"></span><br><span class=\"line\">$ ==&gt;    28B10B10 0000B985 .¹.. </span><br><span class=\"line\">$+4      28B10B14 4E91661F .f.N </span><br><span class=\"line\">$+8      28B10B18 805A6563 ceZ. </span><br><span class=\"line\">$+C      28B10B1C 000077F3 ów.. </span><br><span class=\"line\">$+10     28B10B20 00000000 .... </span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">物品类型 = 0x09的偏移 [[[[[[0150B6FC]+30] + 1840]+C]+1*4] +0x68]+4</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20230125203049839.png\" alt=\"image-20230125203049839\"></p>\n<p>特征码</p>\n<p>使用 *？匹配通配符</p>\n<p>根据特征码找游戏更新之后的新 call</p>\n<h4 id=\"找使用背包物品call\"><a class=\"markdownIt-Anchor\" href=\"#找使用背包物品call\">#</a> 找使用背包物品 call</h4>\n<p>自动吃红药</p>\n<p>自动吃蓝药</p>\n<p>免疫药</p>\n<p>无敌药</p>\n<p>思路 1：</p>\n<p>以某种物品的相关信息为线索 (名称，数量，ID 等)，用 CE 监视当使用物品时哪些代码对这些信息有访问，大致定位出使用物品 call 的范围</p>\n<p>思路 2：</p>\n<p>对于网游，物品相关的逻辑处理一般是放在服务端处理，所以使用物品的时候必定与服务端有网络数据通讯，所以断点通过 send 函数也可以定位物品使用代码的位置</p>\n<p>bp sned 对 socket 库中的发包函数下断电</p>\n<p>send-&gt; 系统的发送数据的函数</p>\n<p>游戏本身 -&gt; 也有自己的发包函数 sendmsg，这函数里面调用了 send</p>\n<p>SendData(char* data, int length)</p>\n<p>{</p>\n<p>​\t…;</p>\n<p>​\tsend();</p>\n<p>}</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00B5A8AA - FF 77 0C  - push [edi+0C]</span><br><span class=\"line\"></span><br><span class=\"line\">00B5BC9F - FF 77 0C  - push [edi+0C]</span><br><span class=\"line\">00B5BC97             | 8B5D 0C               | mov ebx,dword ptr ss:[ebp+C]          | 0</span><br><span class=\"line\">00B5BC9A             | 8B4D E0               | mov ecx,dword ptr ss:[ebp-20]         | 1C58A028 1C58A028</span><br><span class=\"line\">00B5BC9D             | 6A 01                 | push 1                                | 1</span><br><span class=\"line\">00B5BC9F             | FF77 0C               | push dword ptr ds:[edi+C]             | 710</span><br><span class=\"line\">00B5BCA2             | 81C1 EC000000         | add ecx,EC                            |</span><br><span class=\"line\">00B5BCA8             | 53                    | push ebx                              |</span><br><span class=\"line\">00B5BCA9             | 6A 00                 | push 0                                | 0</span><br><span class=\"line\">00B5BCAB             | E8 9025E5FF           | call elementclient.9AE240             | 0</span><br><span class=\"line\"></span><br><span class=\"line\">push 1</span><br><span class=\"line\">push 710</span><br><span class=\"line\">mov ecx,1C58A028</span><br><span class=\"line\">add ecx,0x0EC</span><br><span class=\"line\">push 0</span><br><span class=\"line\">push 0</span><br><span class=\"line\">call 9AE240</span><br><span class=\"line\"></span><br><span class=\"line\">00B34C9D - 39 43 0C  - cmp [ebx+0C],eax</span><br><span class=\"line\"></span><br><span class=\"line\">00D7CC65             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00D7CC67             | 6A 01                 | push 1                                |</span><br><span class=\"line\">00D7CC69             | 68 61CE2F01           | push elementclient.12FCE61            |</span><br><span class=\"line\">00D7CC6E             | FF35 64DF5001         | push dword ptr ds:[150DF64]           |</span><br><span class=\"line\">00D7CC74             | FF15 488A1E01         | call dword ptr ds:[&lt;&amp;send&gt;]           |</span><br><span class=\"line\"></span><br><span class=\"line\">00D7CBA1             | FF75 10               | push dword ptr ss:[ebp+10]            |</span><br><span class=\"line\">00D7CBA4             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class=\"line\">00D7CBA7             | E8 24000000           | call elementclient.D7CBD0             |</span><br><span class=\"line\"></span><br><span class=\"line\">00D7D8FC             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class=\"line\">00D7D8FF             | 8B8E AC000000         | mov ecx,dword ptr ds:[esi+AC]         |</span><br><span class=\"line\">00D7D905             | 57                    | push edi                              |</span><br><span class=\"line\">00D7D906             | FFB6 B0000000         | push dword ptr ds:[esi+B0]            |</span><br><span class=\"line\">00D7D90C             | E8 0FF2FFFF           | call elementclient.D7CB20             |</span><br><span class=\"line\"></span><br><span class=\"line\">00D7D701             | 66:8906               | mov word ptr ds:[esi],ax              | esi:L&quot;萨ā&quot;</span><br><span class=\"line\">00D7D704             | 6A 00                 | push 0                                |</span><br><span class=\"line\">00D7D706             | 8D45 DC               | lea eax,dword ptr ss:[ebp-24]         |</span><br><span class=\"line\">00D7D709             | 8BCF                  | mov ecx,edi                           | 1C58A028</span><br><span class=\"line\">00D7D70B             | 50                    | push eax                              |</span><br><span class=\"line\">00D7D70C             | E8 9F000000           | call elementclient.D7D7B0             |</span><br><span class=\"line\"></span><br><span class=\"line\">//send packet</span><br><span class=\"line\">00CD2984             | 8A4D 08               | mov cl,byte ptr ss:[ebp+8]            |</span><br><span class=\"line\">00CD2987             | B8 28000000           | mov eax,28                            | 28:&#x27;(&#x27;</span><br><span class=\"line\">00CD298C             | 66:8906               | mov word ptr ds:[esi],ax              |</span><br><span class=\"line\">00CD298F             | 0FB645 0C             | movzx eax,byte ptr ss:[ebp+C]         |</span><br><span class=\"line\">00CD2993             | 66:8946 04            | mov word ptr ds:[esi+4],ax            |</span><br><span class=\"line\">00CD2997             | 8B45 10               | mov eax,dword ptr ss:[ebp+10]         |</span><br><span class=\"line\">00CD299A             | 8946 06               | mov dword ptr ds:[esi+6],eax          |</span><br><span class=\"line\">00CD299D             | 8A45 14               | mov al,byte ptr ss:[ebp+14]           |</span><br><span class=\"line\">00CD29A0             | 884E 02               | mov byte ptr ds:[esi+2],cl            |</span><br><span class=\"line\">00CD29A3             | 8846 03               | mov byte ptr ds:[esi+3],al            |</span><br><span class=\"line\">00CD29A6             | 8B0D 20205001         | mov ecx,dword ptr ds:[1502020]        |</span><br><span class=\"line\">00CD29AC             | 6A 0A                 | push A                                | 包长度</span><br><span class=\"line\">00CD29AE             | 56                    | push esi                              | 数据</span><br><span class=\"line\">00CD29AF             | 8B49 20               | mov ecx,dword ptr ds:[ecx+20]         |</span><br><span class=\"line\">00CD29B2             | E8 C9AC0A00           | call elementclient.D7D680             |</span><br><span class=\"line\"></span><br><span class=\"line\">00A4B758             | 50                    | push eax                              |</span><br><span class=\"line\">00A4B759             | A3 CC235001           | mov dword ptr ds:[15023CC],eax        |</span><br><span class=\"line\">00A4B75E             | E8 AD432800           | call elementclient.CCFB10             |</span><br><span class=\"line\"></span><br><span class=\"line\">00A408FE             | C787 D4040000 FA00000 | mov dword ptr ds:[edi+4D4],FA         | edi+4D4:L&quot; &quot;</span><br><span class=\"line\">00A40908             | FFB7 D4040000         | push dword ptr ds:[edi+4D4]           | edi+4D4:L&quot; &quot;</span><br><span class=\"line\">00A4090E             | 8B4F 1C               | mov ecx,dword ptr ds:[edi+1C]         |</span><br><span class=\"line\">00A40911             | E8 EAAA0000           | call elementclient.A4B400             |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">009AE282             | FF75 14               | push dword ptr ss:[ebp+14]            |</span><br><span class=\"line\">009AE285             | 8911                  | mov dword ptr ds:[ecx],edx            |</span><br><span class=\"line\">009AE287             | FF75 10               | push dword ptr ss:[ebp+10]            |</span><br><span class=\"line\">009AE28A             | FF75 0C               | push dword ptr ss:[ebp+C]             |</span><br><span class=\"line\">009AE28D             | FF75 08               | push dword ptr ss:[ebp+8]             |</span><br><span class=\"line\">009AE290             | E8 DB463200           | call elementclient.CD2970             |</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">04B6E034 28 00 00 01 00 00 10 07 00 00 DE FF 3F 01 28 E0 (.........Þÿ?.(à </span><br><span class=\"line\">0028 0100 0000 0710  0000</span><br></pre></td></tr></table></figure>\n<h2 id=\"从逆向的角度看c\"><a class=\"markdownIt-Anchor\" href=\"#从逆向的角度看c\">#</a> 从逆向的角度看 C++</h2>\n<h3 id=\"虚函数\"><a class=\"markdownIt-Anchor\" href=\"#虚函数\">#</a> 虚函数</h3>\n<ul>\n<li><strong>虚函数地址表（虚表）</strong></li>\n</ul>\n<ol>\n<li>\n<ol>\n<li>定义：当类中定义有虚函数时，编译器会把该类中所有虚函数的首地址保存在一张地址表中，即虚函数地址表。</li>\n<li>虚表信息在编译后被链接到执行文件中，因此所获得的虚表地址是一个固定的地址。</li>\n<li>虚表中虚函数的地址排列顺序依据虚函数在类中的声明顺序而定。</li>\n</ol>\n</li>\n</ol>\n<ul>\n<li>\n<p><strong>虚表指针</strong></p>\n</li>\n<li>\n<ul>\n<li>同时编译器还会在类的每个对象添加一个隐藏数据成员，称为虚表指针，保存着虚表的首地址，用于记录和查找虚函数。</li>\n<li>虚表指针的初始化是通过编译器在构造函数中插入代码实现的。由于必须初始化虚表指针，编译器会提供默认的构造函数。</li>\n</ul>\n</li>\n<li>\n<p><strong>虚函数调用过程</strong></p>\n</li>\n<li>\n<ul>\n<li>虚表间接寻址访问：<br>\n使用对象的指针或引用调用虚函数。根据对象的首地址，取出相应的虚表指针，在虚表查找对应的虚函数的首地址，并调用执行。</li>\n<li>直接调用访问：<br>\n使用对象调用虚函数，和调用普通成员函数一样。</li>\n<li>虚函数的识别：</li>\n<li>类中隐式定义一个数据成员</li>\n<li>数据成员在首地址处，占 4 字节</li>\n<li>构造函数初始化该数据成员为某个数组的首地址</li>\n<li>地址属于数据区，相对固定的地址</li>\n<li>数组的成员是函数指针</li>\n<li>函数被调用方式是 thiscall</li>\n<li>构造函数与析构函数都会将虚表指针设置为当前对象所属类中的虚表地址。</li>\n<li>构造函数中是完成虚表指针的初始化，此时虚表指针并没有指向虚表函数。</li>\n<li>执行析构函数时，其对象的虚表指针已经指向某个虚表首地址。虚函数是在还原虚表指针，让其指向自身的虚表首地址，防止在析构函数中调用虚函数时取到非自身虚表</li>\n</ul>\n</li>\n</ul>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1654326102652-35f05218-3401-41f7-a10f-3e70d9aed416.png\" alt=\"img\"></p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1654326120551-f6cd8e66-fc26-40bd-8d23-a8f6b93c7805.png\" alt=\"img\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\">#include &lt;iostream&gt;</span><br><span class=\"line\">using namespace std;</span><br><span class=\"line\"></span><br><span class=\"line\">class base_class</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">private:</span><br><span class=\"line\">    int m_base;</span><br><span class=\"line\">public:</span><br><span class=\"line\">    virtual void v_func1()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func1()&quot; &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual void v_func2()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func2()&quot; &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    virtual void v_func3()</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        cout &lt;&lt; &quot;This is base_class&#x27;s v_func3()&quot; &lt;&lt; endl;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tbase_class Myclass;</span><br><span class=\"line\">\tMyclass.v_func1();</span><br><span class=\"line\">\tMyclass.v_func2();</span><br><span class=\"line\">\tMyclass.v_func3();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>对应的汇编为</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">000A1520 &gt;  55              push    ebp</span><br><span class=\"line\">000A1521    8BEC            mov     ebp,esp</span><br><span class=\"line\">000A1523    81EC D0000000   sub     esp,0xD0</span><br><span class=\"line\">000A1529    53              push    ebx</span><br><span class=\"line\">000A152A    56              push    esi</span><br><span class=\"line\">000A152B    57              push    edi</span><br><span class=\"line\">000A152C    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class=\"line\">000A1532    B9 34000000     mov     ecx,0x34</span><br><span class=\"line\">000A1537    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">000A153C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">000A153E    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">000A1541    E8 A4FCFFFF     call    000A11EA</span><br><span class=\"line\"></span><br><span class=\"line\">000A1546    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">000A1549    E8 D0FAFFFF     call    000A101E</span><br><span class=\"line\"></span><br><span class=\"line\">000A154E    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">000A1551    E8 62FCFFFF     call    000A11B8</span><br><span class=\"line\"></span><br><span class=\"line\">000A1556    8D4D F4         lea     ecx,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">000A1559    E8 3CFCFFFF     call    000A119A</span><br><span class=\"line\"></span><br><span class=\"line\">000A155E    33C0            xor     eax,eax</span><br><span class=\"line\">000A1560    52              push    edx</span><br><span class=\"line\">000A1561    8BCD            mov     ecx,ebp</span><br><span class=\"line\">000A1563    50              push    eax</span><br><span class=\"line\">000A1564    8D15 88150A00   lea     edx,dword ptr ds:[0xA1588]</span><br><span class=\"line\">000A156A    E8 4FFBFFFF     call    000A10BE</span><br><span class=\"line\">000A156F    58              pop     eax</span><br><span class=\"line\">000A1570    5A              pop     edx</span><br><span class=\"line\">000A1571    5F              pop     edi</span><br><span class=\"line\">000A1572    5E              pop     esi</span><br><span class=\"line\">000A1573    5B              pop     ebx</span><br><span class=\"line\">000A1574    81C4 D0000000   add     esp,0xD0</span><br><span class=\"line\">000A157A    3BEC            cmp     ebp,esp</span><br><span class=\"line\">000A157C    E8 50FCFFFF     call    000A11D1</span><br><span class=\"line\">000A1581    8BE5            mov     esp,ebp</span><br><span class=\"line\">000A1583    5D              pop     ebp</span><br><span class=\"line\">000A1584    C3              retn</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//000A11EA处的代码为</span><br><span class=\"line\">013E11EA   /E9 61050000     jmp     base_class::base_class</span><br><span class=\"line\"></span><br><span class=\"line\">013E1750 &gt;  55              push    ebp</span><br><span class=\"line\">013E1751    8BEC            mov     ebp,esp</span><br><span class=\"line\">013E1753    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">013E1759    53              push    ebx</span><br><span class=\"line\">013E175A    56              push    esi</span><br><span class=\"line\">013E175B    57              push    edi</span><br><span class=\"line\">013E175C    51              push    ecx</span><br><span class=\"line\">013E175D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">013E1763    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">013E1768    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">013E176D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">013E176F    59              pop     ecx</span><br><span class=\"line\">013E1770    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">013E1773    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">013E1776    C700 7C783E01   mov     dword ptr ds:[eax],offset base_class::`vftable&#x27;</span><br><span class=\"line\">//此处为虚表的虚表指针eax中的值就是vftable的指针</span><br><span class=\"line\">013E177C    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">013E177F    5F              pop     edi</span><br><span class=\"line\">013E1780    5E              pop     esi</span><br><span class=\"line\">013E1781    5B              pop     ebx</span><br><span class=\"line\">013E1782    8BE5            mov     esp,ebp</span><br><span class=\"line\">013E1784    5D              pop     ebp</span><br><span class=\"line\">013E1785    C3              retn</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//000A101E处的代码为</span><br><span class=\"line\">013E101E   /E9 AD050000     jmp     base_class::v_func1</span><br><span class=\"line\"></span><br><span class=\"line\">013E15D0 &gt;  55              push    ebp</span><br><span class=\"line\">013E15D1    8BEC            mov     ebp,esp</span><br><span class=\"line\">013E15D3    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">013E15D9    53              push    ebx</span><br><span class=\"line\">013E15DA    56              push    esi</span><br><span class=\"line\">013E15DB    57              push    edi</span><br><span class=\"line\">013E15DC    51              push    ecx</span><br><span class=\"line\">013E15DD    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">013E15E3    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">013E15E8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">013E15ED    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">013E15EF    59              pop     ecx</span><br><span class=\"line\">013E15F0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">013E15F3    8BF4            mov     esi,esp</span><br><span class=\"line\">013E15F5    A1 10B33E01     mov     eax,dword ptr ds:[&lt;&amp;MSVCP90D.std::endl&gt;]</span><br><span class=\"line\">013E15FA    50              push    eax</span><br><span class=\"line\">013E15FB    68 00783E01     push    013E7800                                                                                     ; ASCII 54,&quot;his is base_class&#x27;s v_func1()&quot;</span><br><span class=\"line\">013E1600    8B0D 0CB33E01   mov     ecx,dword ptr ds:[&lt;&amp;MSVCP90D.std::cout&gt;]                                                     ; msvcp90d.std::cout</span><br><span class=\"line\">013E1606    51              push    ecx</span><br><span class=\"line\">013E1607    E8 6BFBFFFF     call    013E1177</span><br><span class=\"line\">013E160C    83C4 08         add     esp,0x8</span><br><span class=\"line\">013E160F    8BC8            mov     ecx,eax</span><br><span class=\"line\">013E1611    FF15 08B33E01   call    dword ptr ds:[&lt;&amp;MSVCP90D.std::basic_ostream&lt;char,std::char_traits&lt;char&gt; &gt;::operator&lt;&lt;&gt;]      ; msvcp90d.std::basic_ostream&lt;wchar_t,std::char_traits&lt;wchar_t&gt; &gt;::operator&lt;&lt;</span><br><span class=\"line\">013E1617    3BF4            cmp     esi,esp</span><br><span class=\"line\">013E1619    E8 B3FBFFFF     call    013E11D1</span><br><span class=\"line\">013E161E    5F              pop     edi</span><br><span class=\"line\">013E161F    5E              pop     esi</span><br><span class=\"line\">013E1620    5B              pop     ebx</span><br><span class=\"line\">013E1621    81C4 CC000000   add     esp,0xCC</span><br><span class=\"line\">013E1627    3BEC            cmp     ebp,esp</span><br><span class=\"line\">013E1629    E8 A3FBFFFF     call    013E11D1</span><br><span class=\"line\">013E162E    8BE5            mov     esp,ebp</span><br><span class=\"line\">013E1630    5D              pop     ebp</span><br><span class=\"line\">013E1631    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\">000A11B8</span><br><span class=\"line\">000A119A</span><br><span class=\"line\">分别是func2和func3的代码</span><br></pre></td></tr></table></figure>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109211943483.png\" alt=\"image-20221109211943483\"></p>\n<h3 id=\"debug版本和release版本\"><a class=\"markdownIt-Anchor\" href=\"#debug版本和release版本\">#</a> debug 版本和 release 版本</h3>\n<p>debug 版本：</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109212625495.png\" alt=\"image-20221109212625495\"></p>\n<p>release 版本</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109212653171.png\" alt=\"image-20221109212653171\"></p>\n<p>debug main</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1654330003859-a991baf8-cefe-46fb-83c2-602148a95ba5.png\" alt=\"img\"></p>\n<p>release main</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213010383.png\" alt=\"image-20221109213010383\"></p>\n<p>对于刚刚的虚函数</p>\n<p>debug</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213138880.png\" alt=\"image-20221109213138880\"></p>\n<p>release</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221109213209477.png\" alt=\"image-20221109213209477\"></p>\n<h3 id=\"c中类与继承在汇编中的关系\"><a class=\"markdownIt-Anchor\" href=\"#c中类与继承在汇编中的关系\">#</a> C++ 中类与继承在汇编中的关系</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">class employee</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\temployee() &#123; printf(&quot;employee()!\\n&quot;);&#125;</span><br><span class=\"line\">\t~employee() &#123; printf(&quot;~employee()!\\n&quot;);&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">class manager : public employee</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">\tmanager() &#123; printf(&quot;manager()!\\n&quot;);&#125;</span><br><span class=\"line\">\t~manager() &#123;  printf(&quot;~maneger()!\\n&quot;);&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tmanager my;</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">010D13D0 &gt;  55              push    ebp</span><br><span class=\"line\">010D13D1    8BEC            mov     ebp,esp</span><br><span class=\"line\">010D13D3    81EC D8000000   sub     esp,0xD8</span><br><span class=\"line\">010D13D9    53              push    ebx</span><br><span class=\"line\">010D13DA    56              push    esi</span><br><span class=\"line\">010D13DB    57              push    edi</span><br><span class=\"line\">010D13DC    8DBD 28FFFFFF   lea     edi,dword ptr ss:[ebp-0xD8]</span><br><span class=\"line\">010D13E2    B9 36000000     mov     ecx,0x36</span><br><span class=\"line\">010D13E7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">010D13EC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">//堆栈操作</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">010D13EE    8D4D FB         lea     ecx,dword ptr ss:[ebp-0x5]</span><br><span class=\"line\">010D13F1    E8 22FDFFFF     call    010D1118</span><br><span class=\"line\">//010D1118   /E9 63030000     jmp     manager::manager</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">010D13F6    8BF4            mov     esi,esp</span><br><span class=\"line\">010D13F8    FF15 C4820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.getchar&gt;]        ; msvcr90d.getchar</span><br><span class=\"line\">010D13FE    3BF4            cmp     esi,esp</span><br><span class=\"line\">010D1400    E8 54FDFFFF     call    010D1159</span><br><span class=\"line\">010D1405    C785 2CFFFFFF 0&gt;mov     dword ptr ss:[ebp-0xD4],0x0</span><br><span class=\"line\">010D140F    8D4D FB         lea     ecx,dword ptr ss:[ebp-0x5]</span><br><span class=\"line\">010D1412    E8 11FCFFFF     call    010D1028</span><br><span class=\"line\">//010D1028   /E9 33050000     jmp     manager::~manager</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">010D1417    8B85 2CFFFFFF   mov     eax,dword ptr ss:[ebp-0xD4]</span><br><span class=\"line\">010D141D    52              push    edx</span><br><span class=\"line\">010D141E    8BCD            mov     ecx,ebp</span><br><span class=\"line\">010D1420    50              push    eax</span><br><span class=\"line\">010D1421    8D15 44140D01   lea     edx,dword ptr ds:[0x10D1444]</span><br><span class=\"line\">010D1427    E8 6AFCFFFF     call    010D1096</span><br><span class=\"line\">010D142C    58              pop     eax</span><br><span class=\"line\">010D142D    5A              pop     edx</span><br><span class=\"line\">010D142E    5F              pop     edi</span><br><span class=\"line\">010D142F    5E              pop     esi</span><br><span class=\"line\">010D1430    5B              pop     ebx</span><br><span class=\"line\">010D1431    81C4 D8000000   add     esp,0xD8</span><br><span class=\"line\">010D1437    3BEC            cmp     ebp,esp</span><br><span class=\"line\">010D1439    E8 1BFDFFFF     call    010D1159</span><br><span class=\"line\">010D143E    8BE5            mov     esp,ebp</span><br><span class=\"line\">010D1440    5D              pop     ebp</span><br><span class=\"line\">010D1441    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">010D1118</span><br><span class=\"line\">010D1118   /E9 63030000     jmp     manager::manager</span><br><span class=\"line\"></span><br><span class=\"line\">010D1480 &gt;  55              push    ebp</span><br><span class=\"line\">010D1481    8BEC            mov     ebp,esp</span><br><span class=\"line\">010D1483    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">010D1489    53              push    ebx</span><br><span class=\"line\">010D148A    56              push    esi</span><br><span class=\"line\">010D148B    57              push    edi</span><br><span class=\"line\">010D148C    51              push    ecx</span><br><span class=\"line\">010D148D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">010D1493    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">010D1498    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">010D149D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">010D149F    59              pop     ecx</span><br><span class=\"line\">010D14A0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">010D14A3    8B4D F8         mov     ecx,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">010D14A6    E8 FAFBFFFF     call    010D10A5</span><br><span class=\"line\">//010D10A5   /E9 46040000     jmp     employee::employee</span><br><span class=\"line\"></span><br><span class=\"line\">-</span><br><span class=\"line\">010D14AB    8BF4            mov     esi,esp</span><br><span class=\"line\">010D14AD    68 3C570D01     push    010D573C                              ; ASCII &quot;manager()!\\n&quot;</span><br><span class=\"line\">010D14B2    FF15 BC820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]     ; msvcr90d.printf</span><br><span class=\"line\">010D14B8    83C4 04         add     esp,0x4</span><br><span class=\"line\">010D14BB    3BF4            cmp     esi,esp</span><br><span class=\"line\">010D14BD    E8 97FCFFFF     call    010D1159</span><br><span class=\"line\">010D14C2    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">010D14C5    5F              pop     edi</span><br><span class=\"line\">010D14C6    5E              pop     esi</span><br><span class=\"line\">010D14C7    5B              pop     ebx</span><br><span class=\"line\">010D14C8    81C4 CC000000   add     esp,0xCC</span><br><span class=\"line\">010D14CE    3BEC            cmp     ebp,esp</span><br><span class=\"line\">010D14D0    E8 84FCFFFF     call    010D1159</span><br><span class=\"line\">010D14D5    8BE5            mov     esp,ebp</span><br><span class=\"line\">010D14D7    5D              pop     ebp</span><br><span class=\"line\">010D14D8    C3              retn</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">010D1412    E8 11FCFFFF     call    010D1028</span><br><span class=\"line\">010D1028   /E9 33050000     jmp     manager::~manager</span><br><span class=\"line\"></span><br><span class=\"line\">010D1560 &gt;  55              push    ebp</span><br><span class=\"line\">010D1561    8BEC            mov     ebp,esp</span><br><span class=\"line\">010D1563    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">010D1569    53              push    ebx</span><br><span class=\"line\">010D156A    56              push    esi</span><br><span class=\"line\">010D156B    57              push    edi</span><br><span class=\"line\">010D156C    51              push    ecx</span><br><span class=\"line\">010D156D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">010D1573    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">010D1578    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">010D157D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">010D157F    59              pop     ecx</span><br><span class=\"line\">010D1580    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">010D1583    8BF4            mov     esi,esp</span><br><span class=\"line\">010D1585    68 5C570D01     push    010D575C                                  ; ASCII &quot;~maneger()!\\n&quot;</span><br><span class=\"line\">010D158A    FF15 BC820D01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]         ; msvcr90d.printf</span><br><span class=\"line\">010D1590    83C4 04         add     esp,0x4</span><br><span class=\"line\">010D1593    3BF4            cmp     esi,esp</span><br><span class=\"line\">010D1595    E8 BFFBFFFF     call    010D1159</span><br><span class=\"line\">010D159A    8B4D F8         mov     ecx,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">010D159D    E8 8BFAFFFF     call    010D102D</span><br><span class=\"line\">//010D102D   /E9 9E050000     jmp     employee::~employee</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">010D15A2    5F              pop     edi</span><br><span class=\"line\">010D15A3    5E              pop     esi</span><br><span class=\"line\">010D15A4    5B              pop     ebx</span><br><span class=\"line\">010D15A5    81C4 CC000000   add     esp,0xCC</span><br><span class=\"line\">010D15AB    3BEC            cmp     ebp,esp</span><br><span class=\"line\">010D15AD    E8 A7FBFFFF     call    010D1159</span><br><span class=\"line\">010D15B2    8BE5            mov     esp,ebp</span><br><span class=\"line\">010D15B4    5D              pop     ebp</span><br><span class=\"line\">010D15B5    C3              retn</span><br></pre></td></tr></table></figure>\n<p>private</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">class employee</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\temployee() &#123; printf(&quot;employee()!\\n&quot;);&#125;</span><br><span class=\"line\">\t~employee() &#123; printf(&quot;~employee()!\\n&quot;);&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">class manager : public employee</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">private:</span><br><span class=\"line\">\tmanager() &#123; printf(&quot;manager()!\\n&quot;);&#125;</span><br><span class=\"line\">\t~manager() &#123;  printf(&quot;~maneger()!\\n&quot;);&#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tmanager my;</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"从反汇编角度看this指针\"><a class=\"markdownIt-Anchor\" href=\"#从反汇编角度看this指针\">#</a> 从反汇编角度看 this 指针</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\"> </span><br><span class=\"line\">struct MyStruct</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    int x ;</span><br><span class=\"line\">    int y ;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">//函数在结构体外部</span><br><span class=\"line\">void Max(MyStruct* str)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if (str-&gt;x &gt; str-&gt;y)</span><br><span class=\"line\">        printf(&quot;%d&quot;,str-&gt;x);</span><br><span class=\"line\">    else</span><br><span class=\"line\">        printf(&quot;%d&quot;,str-&gt;y);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    MyStruct haha ;</span><br><span class=\"line\">    haha.x = 1 ;</span><br><span class=\"line\">    haha.y = 2 ;</span><br><span class=\"line\">    Max(&amp;haha);</span><br><span class=\"line\">    printf(&quot;%d\\n&quot;,sizeof(haha));</span><br><span class=\"line\">    return 0;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">012A1450 &gt;  55              push    ebp</span><br><span class=\"line\">012A1451    8BEC            mov     ebp,esp</span><br><span class=\"line\">012A1453    81EC D0000000   sub     esp,0xD0</span><br><span class=\"line\">012A1459    53              push    ebx</span><br><span class=\"line\">012A145A    56              push    esi</span><br><span class=\"line\">012A145B    57              push    edi</span><br><span class=\"line\">012A145C    8DBD 30FFFFFF   lea     edi,dword ptr ss:[ebp-0xD0]</span><br><span class=\"line\">012A1462    B9 34000000     mov     ecx,0x34</span><br><span class=\"line\">012A1467    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">012A146C    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">012A146E    C745 F4 0100000&gt;mov     dword ptr ss:[ebp-0xC],0x1</span><br><span class=\"line\">012A1475    C745 F8 0200000&gt;mov     dword ptr ss:[ebp-0x8],0x2</span><br><span class=\"line\">012A147C    8D45 F4         lea     eax,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">012A147F    50              push    eax</span><br><span class=\"line\">012A1480    E8 CAFCFFFF     call    012A114F</span><br><span class=\"line\">//012A114F   /E9 5C020000     jmp     Max</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">012A1485    83C4 04         add     esp,0x4</span><br><span class=\"line\">012A1488    8BF4            mov     esi,esp</span><br><span class=\"line\">012A148A    6A 08           push    0x8</span><br><span class=\"line\">012A148C    68 40572A01     push    012A5740                         ; ASCII &quot;%d\\n&quot;</span><br><span class=\"line\">012A1491    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;&gt;; msvcr90d.printf</span><br><span class=\"line\">012A1497    83C4 08         add     esp,0x8</span><br><span class=\"line\">012A149A    3BF4            cmp     esi,esp</span><br><span class=\"line\">012A149C    E8 A4FCFFFF     call    012A1145</span><br><span class=\"line\">012A14A1    33C0            xor     eax,eax</span><br><span class=\"line\">012A14A3    52              push    edx</span><br><span class=\"line\">012A14A4    8BCD            mov     ecx,ebp</span><br><span class=\"line\">012A14A6    50              push    eax</span><br><span class=\"line\">012A14A7    8D15 C8142A01   lea     edx,dword ptr ds:[0x12A14C8]</span><br><span class=\"line\">012A14AD    E8 DAFBFFFF     call    012A108C</span><br><span class=\"line\">012A14B2    58              pop     eax</span><br><span class=\"line\">012A14B3    5A              pop     edx</span><br><span class=\"line\">012A14B4    5F              pop     edi</span><br><span class=\"line\">012A14B5    5E              pop     esi</span><br><span class=\"line\">012A14B6    5B              pop     ebx</span><br><span class=\"line\">012A14B7    81C4 D0000000   add     esp,0xD0</span><br><span class=\"line\">012A14BD    3BEC            cmp     ebp,esp</span><br><span class=\"line\">012A14BF    E8 81FCFFFF     call    012A1145</span><br><span class=\"line\">012A14C4    8BE5            mov     esp,ebp</span><br><span class=\"line\">012A14C6    5D              pop     ebp</span><br><span class=\"line\">012A14C7    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>当 haha.x-&gt; 1 和 haha.x -&gt; 2</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221110101344910.png\" alt=\"image-20221110101344910\"></p>\n<p>Max:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">012A13B0 &gt;  55              push    ebp</span><br><span class=\"line\">012A13B1    8BEC            mov     ebp,esp</span><br><span class=\"line\">012A13B3    81EC C0000000   sub     esp,0xC0</span><br><span class=\"line\">012A13B9    53              push    ebx</span><br><span class=\"line\">012A13BA    56              push    esi</span><br><span class=\"line\">012A13BB    57              push    edi</span><br><span class=\"line\">012A13BC    8DBD 40FFFFFF   lea     edi,dword ptr ss:[ebp-0xC0]</span><br><span class=\"line\">012A13C2    B9 30000000     mov     ecx,0x30</span><br><span class=\"line\">012A13C7    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">012A13CC    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">012A13CE    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">012A13D1    8B4D 08         mov     ecx,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">012A13D4    8B10            mov     edx,dword ptr ds:[eax]</span><br><span class=\"line\">012A13D6    3B51 04         cmp     edx,dword ptr ds:[ecx+0x4]</span><br><span class=\"line\">012A13D9    7E 1F           jle     short 012A13FA</span><br><span class=\"line\">012A13DB    8BF4            mov     esi,esp</span><br><span class=\"line\">012A13DD    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">012A13E0    8B08            mov     ecx,dword ptr ds:[eax]</span><br><span class=\"line\">012A13E2    51              push    ecx</span><br><span class=\"line\">012A13E3    68 3C572A01     push    012A573C                               ; ASCII &quot;%d&quot;</span><br><span class=\"line\">012A13E8    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]      ; msvcr90d.printf</span><br><span class=\"line\">012A13EE    83C4 08         add     esp,0x8</span><br><span class=\"line\">012A13F1    3BF4            cmp     esi,esp</span><br><span class=\"line\">012A13F3    E8 4DFDFFFF     call    012A1145</span><br><span class=\"line\">012A13F8    EB 1E           jmp     short 012A1418</span><br><span class=\"line\">012A13FA    8BF4            mov     esi,esp</span><br><span class=\"line\">012A13FC    8B45 08         mov     eax,dword ptr ss:[ebp+0x8]</span><br><span class=\"line\">012A13FF    8B48 04         mov     ecx,dword ptr ds:[eax+0x4]</span><br><span class=\"line\">012A1402    51              push    ecx</span><br><span class=\"line\">012A1403    68 3C572A01     push    012A573C                               ; ASCII &quot;%d&quot;</span><br><span class=\"line\">012A1408    FF15 BC822A01   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]      ; msvcr90d.printf</span><br><span class=\"line\">012A140E    83C4 08         add     esp,0x8</span><br><span class=\"line\">012A1411    3BF4            cmp     esi,esp</span><br><span class=\"line\">012A1413    E8 2DFDFFFF     call    012A1145</span><br><span class=\"line\">012A1418    5F              pop     edi</span><br><span class=\"line\">012A1419    5E              pop     esi</span><br><span class=\"line\">012A141A    5B              pop     ebx</span><br><span class=\"line\">012A141B    81C4 C0000000   add     esp,0xC0</span><br><span class=\"line\">012A1421    3BEC            cmp     ebp,esp</span><br><span class=\"line\">012A1423    E8 1DFDFFFF     call    012A1145</span><br><span class=\"line\">012A1428    8BE5            mov     esp,ebp</span><br><span class=\"line\">012A142A    5D              pop     ebp</span><br><span class=\"line\">012A142B    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>this 看 ecx</p>\n<p>ecx 在内存中为：<br>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221110101730211.png\" alt=\"image-20221110101730211\"></p>\n<h3 id=\"反汇编中构造函数和析构函数的识别\"><a class=\"markdownIt-Anchor\" href=\"#反汇编中构造函数和析构函数的识别\">#</a> 反汇编中构造函数和析构函数的识别</h3>\n<p>代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &lt;stdio.h&gt;</span><br><span class=\"line\">#include &lt;windows.h&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">class MyTest</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">public:</span><br><span class=\"line\">    MyTest();</span><br><span class=\"line\">    ~MyTest();</span><br><span class=\"line\">    void SetTest(DWORD dwTest);</span><br><span class=\"line\">    DWORD GetTest();</span><br><span class=\"line\">public:</span><br><span class=\"line\">    DWORD m_dwTest;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"> MyTest::MyTest()</span><br><span class=\"line\"> &#123;</span><br><span class=\"line\">     printf(&quot;1111\\n&quot;);</span><br><span class=\"line\">     </span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"> MyTest::~MyTest()</span><br><span class=\"line\"> &#123;</span><br><span class=\"line\">    printf(&quot;2222\\n&quot;);</span><br><span class=\"line\"> &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">void MyTest::SetTest(DWORD dwTest)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    this-&gt;m_dwTest = dwTest;   </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">DWORD MyTest::GetTest()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    return this-&gt;m_dwTest;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">int _tmain(int argc, _TCHAR* argv[])</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tMyTest Test;</span><br><span class=\"line\">\tTest.SetTest(1);</span><br><span class=\"line\">\tint Number = Test.GetTest();</span><br><span class=\"line\">\tgetchar();</span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对应的汇编代码为：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00D11550 &gt;  55              push    ebp</span><br><span class=\"line\">00D11551    8BEC            mov     ebp,esp</span><br><span class=\"line\">00D11553    6A FF           push    -0x1</span><br><span class=\"line\">00D11555    68 E846D100     push    00D146E8</span><br><span class=\"line\">00D1155A    64:A1 00000000  mov     eax,dword ptr fs:[0]</span><br><span class=\"line\">00D11560    50              push    eax</span><br><span class=\"line\">00D11561    81EC E4000000   sub     esp,0xE4</span><br><span class=\"line\">00D11567    53              push    ebx</span><br><span class=\"line\">00D11568    56              push    esi</span><br><span class=\"line\">00D11569    57              push    edi</span><br><span class=\"line\">00D1156A    8DBD 10FFFFFF   lea     edi,dword ptr ss:[ebp-0xF0]</span><br><span class=\"line\">00D11570    B9 39000000     mov     ecx,0x39</span><br><span class=\"line\">00D11575    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00D1157A    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00D1157C    A1 0080D100     mov     eax,dword ptr ds:[__security_coo&gt;</span><br><span class=\"line\">00D11581    33C5            xor     eax,ebp</span><br><span class=\"line\">00D11583    50              push    eax</span><br><span class=\"line\">00D11584    8D45 F4         lea     eax,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">00D11587    64:A3 00000000  mov     dword ptr fs:[0],eax</span><br><span class=\"line\">00D1158D    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class=\"line\">00D11590    E8 D3FBFFFF     call    00D11168</span><br><span class=\"line\">//00D11168   /E9 73020000     jmp     MyTest::MyTest</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00D11595    C745 FC 0000000&gt;mov     dword ptr ss:[ebp-0x4],0x0</span><br><span class=\"line\">00D1159C    6A 01           push    0x1</span><br><span class=\"line\">00D1159E    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class=\"line\">00D115A1    E8 CCFBFFFF     call    00D11172</span><br><span class=\"line\">00D11172   /E9 49030000     jmp     MyTest::SetTest</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00D115A6    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class=\"line\">00D115A9    E8 3CFCFFFF     call    00D111EA</span><br><span class=\"line\">00D111EA   /E9 21030000     jmp     MyTest::GetTest</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00D115AE    8945 E0         mov     dword ptr ss:[ebp-0x20],eax</span><br><span class=\"line\">00D115B1    8BF4            mov     esi,esp</span><br><span class=\"line\">00D115B3    FF15 C492D100   call    dword ptr ds:[&lt;&amp;MSVCR90D.getchar&gt;; msvcr90d.getchar</span><br><span class=\"line\">00D115B9    3BF4            cmp     esi,esp</span><br><span class=\"line\">00D115BB    E8 8AFBFFFF     call    00D1114A</span><br><span class=\"line\">00D115C0    C785 14FFFFFF 0&gt;mov     dword ptr ss:[ebp-0xEC],0x0</span><br><span class=\"line\">00D115CA    C745 FC FFFFFFF&gt;mov     dword ptr ss:[ebp-0x4],-0x1</span><br><span class=\"line\">00D115D1    8D4D EC         lea     ecx,dword ptr ss:[ebp-0x14]</span><br><span class=\"line\">00D115D4    E8 4FFAFFFF     call    00D11028</span><br><span class=\"line\">00D115D9    8B85 14FFFFFF   mov     eax,dword ptr ss:[ebp-0xEC]</span><br><span class=\"line\">00D115DF    52              push    edx</span><br><span class=\"line\">00D115E0    8BCD            mov     ecx,ebp</span><br><span class=\"line\">00D115E2    50              push    eax</span><br><span class=\"line\">00D115E3    8D15 1016D100   lea     edx,dword ptr ds:[0xD11610]</span><br><span class=\"line\">00D115E9    E8 A3FAFFFF     call    00D11091</span><br><span class=\"line\">00D115EE    58              pop     eax</span><br><span class=\"line\">00D115EF    5A              pop     edx</span><br><span class=\"line\">00D115F0    8B4D F4         mov     ecx,dword ptr ss:[ebp-0xC]</span><br><span class=\"line\">00D115F3    64:890D 0000000&gt;mov     dword ptr fs:[0],ecx</span><br><span class=\"line\">00D115FA    59              pop     ecx</span><br><span class=\"line\">00D115FB    5F              pop     edi</span><br><span class=\"line\">00D115FC    5E              pop     esi</span><br><span class=\"line\">00D115FD    5B              pop     ebx</span><br><span class=\"line\">00D115FE    81C4 F0000000   add     esp,0xF0</span><br><span class=\"line\">00D11604    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00D11606    E8 3FFBFFFF     call    00D1114A</span><br><span class=\"line\">00D1160B    8BE5            mov     esp,ebp</span><br><span class=\"line\">00D1160D    5D              pop     ebp</span><br><span class=\"line\">00D1160E    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00D11590    E8 D3FBFFFF     call    00D11168</span><br><span class=\"line\">//00D11168   /E9 73020000     jmp     MyTest::MyTest</span><br><span class=\"line\"></span><br><span class=\"line\">00D113E0 &gt;  55              push    ebp</span><br><span class=\"line\">00D113E1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00D113E3    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">00D113E9    53              push    ebx</span><br><span class=\"line\">00D113EA    56              push    esi</span><br><span class=\"line\">00D113EB    57              push    edi</span><br><span class=\"line\">00D113EC    51              push    ecx</span><br><span class=\"line\">00D113ED    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">00D113F3    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">00D113F8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00D113FD    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00D113FF    59              pop     ecx</span><br><span class=\"line\">00D11400    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">00D11403    8BF4            mov     esi,esp</span><br><span class=\"line\">00D11405    68 3C67D100     push    00D1673C                                 ; ASCII &quot;1111\\n&quot;</span><br><span class=\"line\">00D1140A    FF15 CC92D100   call    dword ptr ds:[&lt;&amp;MSVCR90D.printf&gt;]        ; msvcr90d.printf</span><br><span class=\"line\">00D11410    83C4 04         add     esp,0x4</span><br><span class=\"line\">00D11413    3BF4            cmp     esi,esp</span><br><span class=\"line\">00D11415    E8 30FDFFFF     call    00D1114A</span><br><span class=\"line\">00D1141A    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">00D1141D    5F              pop     edi</span><br><span class=\"line\">00D1141E    5E              pop     esi</span><br><span class=\"line\">00D1141F    5B              pop     ebx</span><br><span class=\"line\">00D11420    81C4 CC000000   add     esp,0xCC</span><br><span class=\"line\">00D11426    3BEC            cmp     ebp,esp</span><br><span class=\"line\">00D11428    E8 1DFDFFFF     call    00D1114A</span><br><span class=\"line\">00D1142D    8BE5            mov     esp,ebp</span><br><span class=\"line\">00D1142F    5D              pop     ebp</span><br><span class=\"line\">00D11430    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00D115A1    E8 CCFBFFFF     call    00D11172</span><br><span class=\"line\">00D11172   /E9 49030000     jmp     MyTest::SetTest</span><br><span class=\"line\"></span><br><span class=\"line\">00D114C0 &gt;  55              push    ebp</span><br><span class=\"line\">00D114C1    8BEC            mov     ebp,esp</span><br><span class=\"line\">00D114C3    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">00D114C9    53              push    ebx</span><br><span class=\"line\">00D114CA    56              push    esi</span><br><span class=\"line\">00D114CB    57              push    edi</span><br><span class=\"line\">00D114CC    51              push    ecx</span><br><span class=\"line\">00D114CD    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">00D114D3    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">00D114D8    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00D114DD    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00D114DF    59              pop     ecx</span><br><span class=\"line\"></span><br><span class=\"line\">//以下四句为\tTest.SetTest(1);的关键代码</span><br><span class=\"line\">00D114E0    894D F8         mov     dword ptr ss:[ebp-0x8],ecx    ;ecx此时为this, i = this </span><br><span class=\"line\">00D114E3    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]\t  ;ebp-8是this, eax=this</span><br><span class=\"line\">00D114E6    8B4D 08         mov     ecx,dword ptr ss:[ebp+0x8]    ;ecx = 1 ,ebp+8是从外面传来的1</span><br><span class=\"line\">00D114E9    8908            mov     dword ptr ds:[eax],ecx        ;this-&gt;m = 1</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\">00D114EB    5F              pop     edi</span><br><span class=\"line\">00D114EC    5E              pop     esi</span><br><span class=\"line\">00D114ED    5B              pop     ebx</span><br><span class=\"line\">00D114EE    8BE5            mov     esp,ebp</span><br><span class=\"line\">00D114F0    5D              pop     ebp</span><br><span class=\"line\">00D114F1    C2 0400         retn    0x4</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">00D115A9    E8 3CFCFFFF     call    00D111EA</span><br><span class=\"line\">00D111EA   /E9 21030000     jmp     MyTest::GetTest</span><br><span class=\"line\"></span><br><span class=\"line\">00D11510 &gt;  55              push    ebp</span><br><span class=\"line\">00D11511    8BEC            mov     ebp,esp</span><br><span class=\"line\">00D11513    81EC CC000000   sub     esp,0xCC</span><br><span class=\"line\">00D11519    53              push    ebx</span><br><span class=\"line\">00D1151A    56              push    esi</span><br><span class=\"line\">00D1151B    57              push    edi</span><br><span class=\"line\">00D1151C    51              push    ecx</span><br><span class=\"line\">00D1151D    8DBD 34FFFFFF   lea     edi,dword ptr ss:[ebp-0xCC]</span><br><span class=\"line\">00D11523    B9 33000000     mov     ecx,0x33</span><br><span class=\"line\">00D11528    B8 CCCCCCCC     mov     eax,0xCCCCCCCC</span><br><span class=\"line\">00D1152D    F3:AB           rep     stos dword ptr es:[edi]</span><br><span class=\"line\">00D1152F    59              pop     ecx</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//以下三句为int Number = Test.GetTest();的关键代码</span><br><span class=\"line\">00D11530    894D F8         mov     dword ptr ss:[ebp-0x8],ecx</span><br><span class=\"line\">00D11533    8B45 F8         mov     eax,dword ptr ss:[ebp-0x8]</span><br><span class=\"line\">00D11536    8B00            mov     eax,dword ptr ds:[eax]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">00D11538    5F              pop     edi</span><br><span class=\"line\">00D11539    5E              pop     esi</span><br><span class=\"line\">00D1153A    5B              pop     ebx</span><br><span class=\"line\">00D1153B    8BE5            mov     esp,ebp</span><br><span class=\"line\">00D1153D    5D              pop     ebp</span><br><span class=\"line\">00D1153E    C3              retn</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"动态调试基础\"><a class=\"markdownIt-Anchor\" href=\"#动态调试基础\">#</a> 动态调试基础</h2>\n<h3 id=\"断点\"><a class=\"markdownIt-Anchor\" href=\"#断点\">#</a> 断点</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DR0~DR3这四个寄存器是断点地址存储器,用于保存断点的地址</span><br><span class=\"line\">DR6是调试状态寄存器用于指明DR0~DR3寄存器中哪一个产生了调试异常</span><br><span class=\"line\">DR6寄存器使用比特位B0~B3来指明DR0~DR3中哪个产生了调试异常</span><br><span class=\"line\">DR7是断点属性控制器</span><br><span class=\"line\">DR7寄存器分别保存着DR0~DR3的断点地址对应的断点的属性,属性有如下几种:</span><br><span class=\"line\">L0~L3:这个比特位等于1,则断点为本地断点.</span><br><span class=\"line\">G0~G3:这个比特位等于1,则断点为全局断点.</span><br><span class=\"line\">R/W0-R/W3:</span><br><span class=\"line\">00：执行断点</span><br><span class=\"line\">01：数据写入断点</span><br><span class=\"line\">10：I/0读写断点</span><br><span class=\"line\">11：读写断点()读取指令不算)</span><br></pre></td></tr></table></figure>\n<p>DR0-DR3 硬件断点</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655191812086-b457e0fc-6a04-403f-a7f4-848fd2617c6e.png\" alt=\"img\"></p>\n<p>删除硬件断点 调试 -&gt; 硬件断点</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655191872090-b8599c55-b435-459d-9cbc-ec378d651497.png\" alt=\"img\"></p>\n<p>设置硬件断点  右键 -&gt; 断点 -&gt; 硬件执行</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112211213663.png\" alt=\"image-20221112211213663\"></p>\n<p>取消硬件断点：  hd 基址</p>\n<p>对当前地址做中断，即添加硬件断点： hr 基址</p>\n<p>常用断点：软件断点，内存写入，内存访问，硬件执行</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655192756712-0636b463-746a-4c86-8b38-44b2bb9597c5.png\" alt=\"img\"></p>\n<p>ALT+M 内存镜像</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655192833816-1b08c4ac-e51c-419e-906d-f288dd1d9a22.png\" alt=\"img\"></p>\n<h3 id=\"常用调试器\"><a class=\"markdownIt-Anchor\" href=\"#常用调试器\">#</a> 常用调试器</h3>\n<h4 id=\"ollyice\"><a class=\"markdownIt-Anchor\" href=\"#ollyice\">#</a> OllyICE</h4>\n<p>查看在内存在对应的字节码，即指令在内存中的机器码</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655194426316-532565d9-fa78-44e2-b792-c1d4f47c3c65.png\" alt=\"img\"></p>\n<p>一般来说程序映射到内存中基址从 0040 开始，即 PE 文件头</p>\n<p>映射到代码段需要 + 1000，前 1000 是 PE 头信息</p>\n<p><img data-src=\"https://cdn.nlark.com/yuque/0/2022/png/2759285/1655194544858-688f3db0-11f9-4a14-b509-46464ef0c7e3.png\" alt=\"img\"></p>\n<p>8087 中浮点运行，反调试会用到</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214201466.png\" alt=\"image-20221112214201466\"></p>\n<p>用于轴坐标，准心，多用于游戏分析</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214252305.png\" alt=\"image-20221112214252305\"></p>\n<h4 id=\"xdbg\"><a class=\"markdownIt-Anchor\" href=\"#xdbg\">#</a> xdbg</h4>\n<p>1. 线程</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221112214836603.png\" alt=\"image-20221112214836603\"></p>\n<p>stdcall 一般在函数内部做 ret 做堆栈平衡</p>\n<p>windbg</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0:004&gt; g</span><br><span class=\"line\">(a5c.9dc): Break instruction exception - code 80000003 (first chance)</span><br><span class=\"line\">eax=7efda000 ebx=00000000 ecx=00000000 edx=77a4f7ea esi=00000000 edi=00000000</span><br><span class=\"line\">eip=779c000c esp=02adff5c ebp=02adff88 iopl=0         nv up ei pl zr na pe nc</span><br><span class=\"line\">cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00000246</span><br><span class=\"line\">ntdll!DbgBreakPoint:</span><br><span class=\"line\">779c000c cc              int     3</span><br><span class=\"line\">0:004&gt; bp kernel32!OpenProcess</span><br><span class=\"line\">0:004&gt; u kernel32!OpenProcess</span><br><span class=\"line\">kernel32!OpenProcess:</span><br><span class=\"line\">76831986 8bff            mov     edi,edi</span><br><span class=\"line\">76831988 55              push    ebp</span><br><span class=\"line\">76831989 8bec            mov     ebp,esp</span><br><span class=\"line\">7683198b 5d              pop     ebp</span><br><span class=\"line\">7683198c eb05            jmp     kernel32!OpenProcess+0xd (76831993)</span><br><span class=\"line\">7683198e 90              nop</span><br><span class=\"line\">7683198f 90              nop</span><br><span class=\"line\">76831990 90              nop</span><br><span class=\"line\">0:004&gt; u 76831993</span><br><span class=\"line\">kernel32!OpenProcess+0xd:</span><br><span class=\"line\">76831993 ff2554098376    jmp     dword ptr [kernel32+0x10954 (76830954)]</span><br><span class=\"line\">76831999 90              nop</span><br><span class=\"line\">7683199a 90              nop</span><br><span class=\"line\">7683199b 90              nop</span><br><span class=\"line\">7683199c 90              nop</span><br><span class=\"line\">7683199d 90              nop</span><br><span class=\"line\">kernel32!WaitForMultipleObjectsEx:</span><br><span class=\"line\">7683199e 8bff            mov     edi,edi</span><br><span class=\"line\">768319a0 55              push    ebp</span><br></pre></td></tr></table></figure>\n<p>VT</p>\n<p>需要开启</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221113204110511.png\" alt=\"image-20221113204110511\"></p>\n<h2 id=\"动态调试基础二\"><a class=\"markdownIt-Anchor\" href=\"#动态调试基础二\">#</a> 动态调试基础二</h2>\n<p>ALT+F9  返回调用本函数的函数的代码</p>\n<p>rpb radmin.rpb 存在 127.0.0.1 的配置信息</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116181239485.png\" alt=\"image-20221116181239485\" style=\"zoom:67%;\" />\n<h3 id=\"硬件断点\"><a class=\"markdownIt-Anchor\" href=\"#硬件断点\">#</a> 硬件断点</h3>\n<ol>\n<li>Intel 80306 以上的 CPU 给我们提供了调试寄存器用于软件调试，硬件断点是通过设置调试寄存器实现的。</li>\n</ol>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116183140142.png\" alt=\"image-20221116183140142\"></p>\n<p>调试时线程挂起</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116183413279.png\" alt=\"image-20221116183413279\"></p>\n<p>右键 resume all 激活</p>\n<p>实现硬件断点，首先要获取当前线程环境</p>\n<figure class=\"highlight cpp\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//获取线程环境</span></span><br><span class=\"line\">CONTEXT g_Context = &#123; <span class=\"number\">0</span> &#125;;</span><br><span class=\"line\">g_Context.ContextFlags = CONTEXT_CONTROL;</span><br><span class=\"line\"><span class=\"built_in\">GetThreadContext</span>(hThread, &amp;g_Context);</span><br></pre></td></tr></table></figure>\n<p>在 CONTEXT 结构体中，存放了诸多当前线程环境的信息</p>\n<img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221116184014697.png\" alt=\"image-20221116184014697\" style=\"zoom:67%;\" />\n<h2 id=\"ida动态分析基础\"><a class=\"markdownIt-Anchor\" href=\"#ida动态分析基础\">#</a> IDA 动态分析基础</h2>\n<p>导入表：编译时倒入，通过静态链接到输入表</p>\n<p>1.debug -&gt; local 32 debug</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221117210719141.png\" alt=\"image-20221117210719141\"></p>\n<p>IDA 远程调试</p>\n<p>将 dbgsrv 放到要调试的文件夹中</p>\n<h2 id=\"pe文件结构\"><a class=\"markdownIt-Anchor\" href=\"#pe文件结构\">#</a> PE 文件结构</h2>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221119190434856.png\" alt=\"image-20221119190434856\"></p>\n<h2 id=\"windows系统安全基础\"><a class=\"markdownIt-Anchor\" href=\"#windows系统安全基础\">#</a> Windows 系统安全基础</h2>\n<p>进程句柄表</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/563d88364cb24f768722413a352523a4.png\" alt=\"img\"></p>\n<p>当你输入用户名和口令时，Winlogon 将其发送给一个叫做 LSASS 的子进程。如果你执行对服务器或工作站的本地登录，LSASS 进程将在安全数据库（亦即 SAM）中查对有关用户名和口令。Winlogon 有两个子进程，即服务控制器和 LSASS。</p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120184811911.png\" alt=\"image-20221120184811911\"></p>\n<p><img data-src=\"https://kbshire-1308981697.cos.ap-shanghai.myqcloud.com/img/image-20221120184825383.png\" alt=\"image-20221120184825383\"></p>\n<p>Explorer 进程 在 Windows 系列的操作系统中，运行时都会启动一个名为 Explorer.exe 的进程。这个进程主要负责显示系统桌面上的图标以及任务栏。</p>\n",
            "tags": [
                "逆向"
            ]
        }
    ]
}